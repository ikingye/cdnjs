function X509(){var o=ASN1HEX,m=o.getChildIdx,k=o.getV,b=o.getTLV,h=o.getVbyList,n=o.getVbyListEx,c=o.getTLVbyList,e=o.getTLVbyListEx,i=o.getIdxbyList,d=o.getVidx,l=o.oidname,a=X509,g=pemtohex,f;try{f=KJUR.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch(j){}this.hex=null;this.version=0;this.foffset=0;this.aExtInfo=null;this.getVersion=function(){if(this.hex===null||this.version!==0){return this.version}if(c(this.hex,0,[0,0])!=="a003020102"){this.version=1;this.foffset=-1;return 1}this.version=3;return 3};this.getSerialNumberHex=function(){return h(this.hex,0,[0,1+this.foffset],"02")};this.getSignatureAlgorithmField=function(){var q=null;var p=e(this.hex,0,[0,1]);for(var r in f){if(p===f[r]){return r}}return l(n(this.hex,0,[0,1,0],"06"))};this.getIssuerHex=function(){return c(this.hex,0,[0,3+this.foffset],"30")};this.getIssuerString=function(){return a.hex2dn(this.getIssuerHex())};this.getSubjectHex=function(){return c(this.hex,0,[0,5+this.foffset],"30")};this.getSubjectString=function(){return a.hex2dn(this.getSubjectHex())};this.getNotBefore=function(){var p=h(this.hex,0,[0,4+this.foffset,0]);p=p.replace(/(..)/g,"%$1");p=decodeURIComponent(p);return p};this.getNotAfter=function(){var p=h(this.hex,0,[0,4+this.foffset,1]);p=p.replace(/(..)/g,"%$1");p=decodeURIComponent(p);return p};this.getPublicKeyHex=function(){return o.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")};this.getPublicKeyIdx=function(){return i(this.hex,0,[0,6+this.foffset],"30")};this.getPublicKeyContentIdx=function(){var p=this.getPublicKeyIdx();return i(this.hex,p,[1,0],"30")};this.getPublicKey=function(){return KEYUTIL.getKey(this.getPublicKeyHex(),null,"pkcs8pub")};this.getSignatureAlgorithmName=function(){return l(h(this.hex,0,[1,0],"06"))};this.getSignatureValueHex=function(){return h(this.hex,0,[2],"03",true)};this.verifySignature=function(r){var s=this.getSignatureAlgorithmField();var p=this.getSignatureValueHex();var q=c(this.hex,0,[0],"30");var t=new KJUR.crypto.Signature({alg:s});t.init(r);t.updateHex(q);return t.verify(p)};this.parseExt=function(y){var r,p,t;if(y===undefined){t=this.hex;if(this.version!==3){return -1}r=i(t,0,[0,7,0],"30");p=m(t,r)}else{t=pemtohex(y);var u=i(t,0,[0,3,0,0],"06");if(k(t,u)!="2a864886f70d01090e"){this.aExtInfo=new Array();return}r=i(t,0,[0,3,0,1,0],"30");p=m(t,r);this.hex=t}this.aExtInfo=new Array();for(var s=0;s<p.length;s++){var w={};w.critical=false;var v=m(t,p[s]);var q=0;if(v.length===3){w.critical=true;q=1}w.oid=o.hextooidstr(h(t,p[s],[0],"06"));var x=i(t,p[s],[1+q]);w.vidx=d(t,x);this.aExtInfo.push(w)}};this.getExtInfo=function(r){var p=this.aExtInfo;var s=r;if(!r.match(/^[0-9.]+$/)){s=KJUR.asn1.x509.OID.name2oid(r)}if(s===""){return undefined}for(var q=0;q<p.length;q++){if(p[q].oid===s){return p[q]}}return undefined};this.getExtBasicConstraints=function(){var r=this.getExtInfo("basicConstraints");if(r===undefined){return r}var p=k(this.hex,r.vidx);if(p===""){return{}}if(p==="0101ff"){return{cA:true}}if(p.substr(0,8)==="0101ff02"){var s=k(p,6);var q=parseInt(s,16);return{cA:true,pathLen:q}}throw"basicConstraints parse error"};this.getExtKeyUsageBin=function(){var s=this.getExtInfo("keyUsage");if(s===undefined){return""}var q=k(this.hex,s.vidx);if(q.length%2!=0||q.length<=2){throw new Error("malformed key usage value")}var p=parseInt(q.substr(0,2));var r=parseInt(q.substr(2),16).toString(2);r=("0000000"+r).slice(-8);return r.substr(0,r.length-p)};this.getExtKeyUsageString=function(){var r=this.getExtKeyUsageBin();var p=new Array();for(var q=0;q<r.length;q++){if(r.substr(q,1)=="1"){p.push(X509.KEYUSAGE_NAME[q])}}return p.join(",")};this.getExtSubjectKeyIdentifier=function(){var p=this.getExtInfo("subjectKeyIdentifier");if(p===undefined){return p}return k(this.hex,p.vidx)};this.getExtAuthorityKeyIdentifier=function(){var t=this.getExtInfo("authorityKeyIdentifier");if(t===undefined){return t}var p={};var s=b(this.hex,t.vidx);var q=m(s,0);for(var r=0;r<q.length;r++){if(s.substr(q[r],2)==="80"){p.kid=k(s,q[r])}}return p};this.getExtExtKeyUsageName=function(){var t=this.getExtInfo("extKeyUsage");if(t===undefined){return t}var p=new Array();var s=b(this.hex,t.vidx);if(s===""){return p}var q=m(s,0);for(var r=0;r<q.length;r++){p.push(l(k(s,q[r])))}return p};this.getExtSubjectAltName=function(){var q=this.getExtSubjectAltName2();var p=new Array();for(var r=0;r<q.length;r++){if(q[r][0]==="DNS"){p.push(q[r][1])}}return p};this.getExtSubjectAltName2=function(){var t,w,v;var u=this.getExtInfo("subjectAltName");if(u===undefined){return u}var p=new Array();var s=b(this.hex,u.vidx);var q=m(s,0);for(var r=0;r<q.length;r++){v=s.substr(q[r],2);t=k(s,q[r]);if(v==="81"){w=hextoutf8(t);p.push(["MAIL",w])}if(v==="82"){w=hextoutf8(t);p.push(["DNS",w])}if(v==="84"){w=X509.hex2dn(t,0);p.push(["DN",w])}if(v==="86"){w=hextoutf8(t);p.push(["URI",w])}if(v==="87"){w=hextoip(t);p.push(["IP",w])}}return p};this.getExtCRLDistributionPointsURI=function(){var u=this.getExtInfo("cRLDistributionPoints");if(u===undefined){return u}var p=new Array();var q=m(this.hex,u.vidx);for(var s=0;s<q.length;s++){try{var v=h(this.hex,q[s],[0,0,0],"86");var t=hextoutf8(v);p.push(t)}catch(r){}}return p};this.getExtAIAInfo=function(){var t=this.getExtInfo("authorityInfoAccess");if(t===undefined){return t}var p={ocsp:[],caissuer:[]};var q=m(this.hex,t.vidx);for(var r=0;r<q.length;r++){var u=h(this.hex,q[r],[0],"06");var s=h(this.hex,q[r],[1],"86");if(u==="2b06010505073001"){p.ocsp.push(hextoutf8(s))}if(u==="2b06010505073002"){p.caissuer.push(hextoutf8(s))}}return p};this.getExtCertificatePolicies=function(){var s=this.getExtInfo("certificatePolicies");if(s===undefined){return s}var p=b(this.hex,s.vidx);var y=[];var w=m(p,0);for(var v=0;v<w.length;v++){var x={};var r=m(p,w[v]);x.id=l(k(p,r[0]));if(r.length===2){var q=m(p,r[1]);for(var u=0;u<q.length;u++){var t=h(p,q[u],[0],"06");if(t==="2b06010505070201"){x.cps=hextoutf8(h(p,q[u],[1]))}else{if(t==="2b06010505070202"){x.unotice=hextoutf8(h(p,q[u],[1,0]))}}}}y.push(x)}return y};this.readCertPEM=function(p){this.readCertHex(g(p))};this.readCertHex=function(p){this.hex=p;this.getVersion();try{i(this.hex,0,[0,7],"a3");this.parseExt()}catch(q){}};this.getInfo=function(){var q=X509;var F,y,D;F="Basic Fields\n";F+="  serial number: "+this.getSerialNumberHex()+"\n";F+="  signature algorithm: "+this.getSignatureAlgorithmField()+"\n";F+="  issuer: "+this.getIssuerString()+"\n";F+="  notBefore: "+this.getNotBefore()+"\n";F+="  notAfter: "+this.getNotAfter()+"\n";F+="  subject: "+this.getSubjectString()+"\n";F+="  subject public key info: \n";y=this.getPublicKey();F+="    key algorithm: "+y.type+"\n";if(y.type==="RSA"){F+="    n="+hextoposhex(y.n.toString(16)).substr(0,16)+"...\n";F+="    e="+hextoposhex(y.e.toString(16))+"\n"}D=this.aExtInfo;if(D!==undefined&&D!==null){F+="X509v3 Extensions:\n";for(var w=0;w<D.length;w++){var r=D[w];var E=KJUR.asn1.x509.OID.oid2name(r.oid);if(E===""){E=r.oid}var B="";if(r.critical===true){B="CRITICAL"}F+="  "+E+" "+B+":\n";if(E==="basicConstraints"){var z=this.getExtBasicConstraints();if(z.cA===undefined){F+="    {}\n"}else{F+="    cA=true";if(z.pathLen!==undefined){F+=", pathLen="+z.pathLen}F+="\n"}}else{if(E==="keyUsage"){F+="    "+this.getExtKeyUsageString()+"\n"}else{if(E==="subjectKeyIdentifier"){F+="    "+this.getExtSubjectKeyIdentifier()+"\n"}else{if(E==="authorityKeyIdentifier"){var p=this.getExtAuthorityKeyIdentifier();if(p.kid!==undefined){F+="    kid="+p.kid+"\n"}}else{if(E==="extKeyUsage"){var A=this.getExtExtKeyUsageName();F+="    "+A.join(", ")+"\n"}else{if(E==="subjectAltName"){var x=this.getExtSubjectAltName2();F+="    "+x+"\n"}else{if(E==="cRLDistributionPoints"){var C=this.getExtCRLDistributionPointsURI();F+="    "+C+"\n"}else{if(E==="authorityInfoAccess"){var u=this.getExtAIAInfo();if(u.ocsp!==undefined){F+="    ocsp: "+u.ocsp.join(",")+"\n"}if(u.caissuer!==undefined){F+="    caissuer: "+u.caissuer.join(",")+"\n"}}else{if(E==="certificatePolicies"){var t=this.getExtCertificatePolicies();for(var v=0;v<t.length;v++){if(t[v].id!==undefined){F+="    policy oid: "+t[v].id+"\n"}if(t[v].cps!==undefined){F+="    cps: "+t[v].cps+"\n"}}}}}}}}}}}}}F+="signature algorithm: "+this.getSignatureAlgorithmName()+"\n";F+="signature: "+this.getSignatureValueHex().substr(0,16)+"...\n";return F}}X509.hex2dn=function(f,b){if(b===undefined){b=0}if(f.substr(b,2)!=="30"){throw"malformed DN"}var c=new Array();var d=ASN1HEX.getChildIdx(f,b);for(var e=0;e<d.length;e++){c.push(X509.hex2rdn(f,d[e]))}c=c.map(function(a){return a.replace("/","\\/")});return"/"+c.join("/")};X509.hex2rdn=function(f,b){if(b===undefined){b=0}if(f.substr(b,2)!=="31"){throw"malformed RDN"}var c=new Array();var d=ASN1HEX.getChildIdx(f,b);for(var e=0;e<d.length;e++){c.push(X509.hex2attrTypeValue(f,d[e]))}c=c.map(function(a){return a.replace("+","\\+")});return c.join("+")};X509.hex2attrTypeValue=function(d,i){var j=ASN1HEX;var h=j.getV;if(i===undefined){i=0}if(d.substr(i,2)!=="30"){throw"malformed attribute type and value"}var g=j.getChildIdx(d,i);if(g.length!==2||d.substr(g[0],2)!=="06"){"malformed attribute type and value"}var b=h(d,g[0]);var f=KJUR.asn1.ASN1Util.oidHexToInt(b);var e=KJUR.asn1.x509.OID.oid2atype(f);var a=h(d,g[1]);var c=hextorstr(a);return e+"="+c};X509.getPublicKeyFromCertHex=function(b){var a=new X509();a.readCertHex(b);return a.getPublicKey()};X509.getPublicKeyFromCertPEM=function(b){var a=new X509();a.readCertPEM(b);return a.getPublicKey()};X509.getPublicKeyInfoPropOfCertPEM=function(c){var e=ASN1HEX;var g=e.getVbyList;var b={};var a,f,d;b.algparam=null;a=new X509();a.readCertPEM(c);f=a.getPublicKeyHex();b.keyhex=g(f,0,[1],"03").substr(2);b.algoid=g(f,0,[0,0],"06");if(b.algoid==="2a8648ce3d0201"){b.algparam=g(f,0,[0,1],"06")}return b};X509.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"];