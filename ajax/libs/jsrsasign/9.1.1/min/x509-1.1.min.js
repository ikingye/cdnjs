function X509(){var q=ASN1HEX,o=q.getChildIdx,m=q.getV,c=q.getTLV,j=q.getVbyList,p=q.getVbyListEx,d=q.getTLVbyList,f=q.getTLVbyListEx,k=q.getIdxbyList,i=q.getIdxbyListEx,e=q.getVidx,n=q.oidname,a=q.hextooidstr,b=X509,h=pemtohex,g;try{g=KJUR.asn1.x509.AlgorithmIdentifier.PSSNAME2ASN1TLV}catch(l){}this.HEX2STAG={"0c":"utf8","13":"prn","16":"ia5","1a":"vis","1e":"bmp"};this.hex=null;this.version=0;this.foffset=0;this.aExtInfo=null;this.getVersion=function(){if(this.hex===null||this.version!==0){return this.version}if(d(this.hex,0,[0,0])!=="a003020102"){this.version=1;this.foffset=-1;return 1}this.version=3;return 3};this.getSerialNumberHex=function(){return p(this.hex,0,[0,0],"02")};this.getSignatureAlgorithmField=function(){var r=f(this.hex,0,[0,1]);return this.getAlgorithmIdentifierName(r)};this.getAlgorithmIdentifierName=function(r){for(var s in g){if(r===g[s]){return s}}return n(p(r,0,[0],"06"))};this.getIssuer=function(){var r={};r.array=this.getX500Name(this.getIssuerHex());r.str=this.getIssuerString();return r};this.getIssuerHex=function(){return d(this.hex,0,[0,3+this.foffset],"30")};this.getIssuerString=function(){return b.hex2dn(this.getIssuerHex())};this.getSubject=function(){var r={};r.array=this.getX500Name(this.getSubjectHex());r.str=this.getSubjectString();return r};this.getSubjectHex=function(){return d(this.hex,0,[0,5+this.foffset],"30")};this.getSubjectString=function(){return b.hex2dn(this.getSubjectHex())};this.getNotBefore=function(){var r=j(this.hex,0,[0,4+this.foffset,0]);r=r.replace(/(..)/g,"%$1");r=decodeURIComponent(r);return r};this.getNotAfter=function(){var r=j(this.hex,0,[0,4+this.foffset,1]);r=r.replace(/(..)/g,"%$1");r=decodeURIComponent(r);return r};this.getPublicKeyHex=function(){return q.getTLVbyList(this.hex,0,[0,6+this.foffset],"30")};this.getPublicKeyIdx=function(){return k(this.hex,0,[0,6+this.foffset],"30")};this.getPublicKeyContentIdx=function(){var r=this.getPublicKeyIdx();return k(this.hex,r,[1,0],"30")};this.getPublicKey=function(){return KEYUTIL.getKey(this.getPublicKeyHex(),null,"pkcs8pub")};this.getSignatureAlgorithmName=function(){var r=d(this.hex,0,[1],"30");return this.getAlgorithmIdentifierName(r)};this.getSignatureValueHex=function(){return j(this.hex,0,[2],"03",true)};this.verifySignature=function(t){var u=this.getSignatureAlgorithmField();var r=this.getSignatureValueHex();var s=d(this.hex,0,[0],"30");var v=new KJUR.crypto.Signature({alg:u});v.init(t);v.updateHex(s);return v.verify(r)};this.parseExt=function(A){var t,r,v;if(A===undefined){v=this.hex;if(this.version!==3){return -1}t=k(v,0,[0,7,0],"30");r=o(v,t)}else{v=pemtohex(A);var w=k(v,0,[0,3,0,0],"06");if(m(v,w)!="2a864886f70d01090e"){this.aExtInfo=new Array();return}t=k(v,0,[0,3,0,1,0],"30");r=o(v,t);this.hex=v}this.aExtInfo=new Array();for(var u=0;u<r.length;u++){var y={};y.critical=false;var x=o(v,r[u]);var s=0;if(x.length===3){y.critical=true;s=1}y.oid=q.hextooidstr(j(v,r[u],[0],"06"));var z=k(v,r[u],[1+s]);y.vidx=e(v,z);this.aExtInfo.push(y)}};this.getExtInfo=function(t){var r=this.aExtInfo;var u=t;if(!t.match(/^[0-9.]+$/)){u=KJUR.asn1.x509.OID.name2oid(t)}if(u===""){return undefined}for(var s=0;s<r.length;s++){if(r[s].oid===u){return r[s]}}return undefined};this.getExtBasicConstraints=function(s,w){if(s===undefined&&w===undefined){var u=this.getExtInfo("basicConstraints");if(u===undefined){return undefined}s=c(this.hex,u.vidx);w=u.critical}var r={extname:"basicConstraints"};if(w){r.critical=true}if(s==="3000"){return r}if(s==="30030101ff"){r.cA=true;return r}if(s.substr(0,12)==="30060101ff02"){var v=m(s,10);var t=parseInt(v,16);r.cA=true;r.pathLen=t;return r}throw new Error("hExtV parse error: "+s)};this.getExtKeyUsage=function(s,u){if(s===undefined&&u===undefined){var t=this.getExtInfo("keyUsage");if(t===undefined){return undefined}s=c(this.hex,t.vidx);u=t.critical}var r={extname:"keyUsage"};if(u){r.critical=true}r.names=this.getExtKeyUsageString(s).split(",");return r};this.getExtKeyUsageBin=function(t){if(t===undefined){var u=this.getExtInfo("keyUsage");if(u===undefined){return""}t=c(this.hex,u.vidx)}if(t.length!=8&&t.length!=10){throw new Error("malformed key usage value: "+t)}var r="000000000000000"+parseInt(t.substr(6),16).toString(2);if(t.length==8){r=r.slice(-8)}if(t.length==10){r=r.slice(-16)}r=r.replace(/0+$/,"");if(r==""){r="0"}return r};this.getExtKeyUsageString=function(t){var u=this.getExtKeyUsageBin(t);var r=new Array();for(var s=0;s<u.length;s++){if(u.substr(s,1)=="1"){r.push(X509.KEYUSAGE_NAME[s])}}return r.join(",")};this.getExtSubjectKeyIdentifier=function(t,v){if(t===undefined&&v===undefined){var u=this.getExtInfo("subjectKeyIdentifier");if(u===undefined){return undefined}t=c(this.hex,u.vidx);v=u.critical}var r={extname:"subjectKeyIdentifier"};if(v){r.critical=true}var s=m(t,0);r.kid={hex:s};return r};this.getExtAuthorityKeyIdentifier=function(x,v){if(x===undefined&&v===undefined){var r=this.getExtInfo("authorityKeyIdentifier");if(r===undefined){return undefined}x=c(this.hex,r.vidx);v=r.critical}var y={extname:"authorityKeyIdentifier"};if(v){y.critical=true}var w=o(x,0);for(var s=0;s<w.length;s++){var z=x.substr(w[s],2);if(z==="80"){y.kid={hex:m(x,w[s])}}if(z==="a1"){var u=c(x,w[s]);var t=this.getGeneralNames(u);y.issuer=t[0]["dn"]}if(z==="82"){y.sn={hex:m(x,w[s])}}}return y};this.getExtExtKeyUsage=function(u,w){if(u===undefined&&w===undefined){var v=this.getExtInfo("extKeyUsage");if(v===undefined){return undefined}u=c(this.hex,v.vidx);w=v.critical}var r={extname:"extKeyUsage",array:[]};if(w){r.critical=true}var s=o(u,0);for(var t=0;t<s.length;t++){r.array.push(n(m(u,s[t])))}return r};this.getExtExtKeyUsageName=function(){var v=this.getExtInfo("extKeyUsage");if(v===undefined){return v}var r=new Array();var u=c(this.hex,v.vidx);if(u===""){return r}var s=o(u,0);for(var t=0;t<s.length;t++){r.push(n(m(u,s[t])))}return r};this.getExtSubjectAltName=function(s,u){if(s===undefined&&u===undefined){var t=this.getExtInfo("subjectAltName");if(t===undefined){return undefined}s=c(this.hex,t.vidx);u=t.critical}var r={extname:"subjectAltName",array:[]};if(u){r.critical=true}r.array=this.getGeneralNames(s);return r};this.getExtIssuerAltName=function(s,u){if(s===undefined&&u===undefined){var t=this.getExtInfo("issuerAltName");if(t===undefined){return undefined}s=c(this.hex,t.vidx);u=t.critical}var r={extname:"issuerAltName",array:[]};if(u){r.critical=true}r.array=this.getGeneralNames(s);return r};this.getGeneralNames=function(v){var t=o(v,0);var r=[];for(var u=0;u<t.length;u++){var s=this.getGeneralName(c(v,t[u]));if(s!==undefined){r.push(s)}}return r};this.getGeneralName=function(s){var r=s.substr(0,2);var u=m(s,0);var t=hextorstr(u);if(r=="81"){return{rfc822:t}}if(r=="82"){return{dns:t}}if(r=="a4"){return{dn:{hex:u}}}if(r=="86"){return{uri:t}}if(r=="87"){return{ip:hextoip(u)}}return undefined};this.getExtSubjectAltName2=function(){var v,y,x;var w=this.getExtInfo("subjectAltName");if(w===undefined){return w}var r=new Array();var u=c(this.hex,w.vidx);var s=o(u,0);for(var t=0;t<s.length;t++){x=u.substr(s[t],2);v=m(u,s[t]);if(x==="81"){y=hextoutf8(v);r.push(["MAIL",y])}if(x==="82"){y=hextoutf8(v);r.push(["DNS",y])}if(x==="84"){y=X509.hex2dn(v,0);r.push(["DN",y])}if(x==="86"){y=hextoutf8(v);r.push(["URI",y])}if(x==="87"){y=hextoip(v);r.push(["IP",y])}}return r};this.getExtCRLDistributionPoints=function(v,x){if(v===undefined&&x===undefined){var w=this.getExtInfo("cRLDistributionPoints");if(w===undefined){return undefined}v=c(this.hex,w.vidx);x=w.critical}var s={extname:"cRLDistributionPoints",array:[]};if(x){s.critical=true}var t=o(v,0);for(var u=0;u<t.length;u++){var r=c(v,t[u]);s.array.push(this.getDistributionPoint(r))}return s};this.getDistributionPoint=function(w){var t={};var u=o(w,0);for(var v=0;v<u.length;v++){var s=w.substr(u[v],2);var r=c(w,u[v]);if(s=="a0"){t.dpname=this.getDistributionPointName(r)}}return t};this.getDistributionPointName=function(w){var t={};var u=o(w,0);for(var v=0;v<u.length;v++){var s=w.substr(u[v],2);var r=c(w,u[v]);if(s=="a0"){t.full=this.getGeneralNames(r)}}return t};this.getExtCRLDistributionPointsURI=function(){var w=this.getExtInfo("cRLDistributionPoints");if(w===undefined){return w}var r=new Array();var s=o(this.hex,w.vidx);for(var u=0;u<s.length;u++){try{var x=j(this.hex,s[u],[0,0,0],"86");var v=hextoutf8(x);r.push(v)}catch(t){}}return r};this.getExtAIAInfo=function(){var v=this.getExtInfo("authorityInfoAccess");if(v===undefined){return v}var r={ocsp:[],caissuer:[]};var s=o(this.hex,v.vidx);for(var t=0;t<s.length;t++){var w=j(this.hex,s[t],[0],"06");var u=j(this.hex,s[t],[1],"86");if(w==="2b06010505073001"){r.ocsp.push(hextoutf8(u))}if(w==="2b06010505073002"){r.caissuer.push(hextoutf8(u))}}return r};this.getExtAuthorityInfoAccess=function(y,w){if(y===undefined&&w===undefined){var r=this.getExtInfo("authorityInfoAccess");if(r===undefined){return undefined}y=c(this.hex,r.vidx);w=r.critical}var z={extname:"authorityInfoAccess",array:[]};if(w){z.critical=true}var x=o(y,0);for(var s=0;s<x.length;s++){var v=p(y,x[s],[0],"06");var t=j(y,x[s],[1],"86");var u=hextoutf8(t);if(v=="2b06010505073001"){z.array.push({ocsp:u})}else{if(v=="2b06010505073002"){z.array.push({caissuer:u})}else{throw new Error("unknown method: "+v)}}}return z};this.getExtCertificatePolicies=function(v,y){if(v===undefined&&y===undefined){var x=this.getExtInfo("certificatePolicies");if(x===undefined){return undefined}v=c(this.hex,x.vidx);y=x.critical}var r={extname:"certificatePolicies",array:[]};if(y){r.critical=true}var s=o(v,0);for(var t=0;t<s.length;t++){var w=c(v,s[t]);var u=this.getPolicyInformation(w);r.array.push(u)}return r};this.getPolicyInformation=function(v){var r={};var x=j(v,0,[0],"06");r.policyoid=n(x);var y=i(v,0,[1],"30");if(y!=-1){r.array=[];var s=o(v,y);for(var t=0;t<s.length;t++){var w=c(v,s[t]);var u=this.getPolicyQualifierInfo(w);r.array.push(u)}}return r};this.getPolicyQualifierInfo=function(s){var r={};var t=j(s,0,[0],"06");if(t==="2b06010505070201"){var v=p(s,0,[1],"16");r.cps=hextorstr(v)}else{if(t==="2b06010505070202"){var u=d(s,0,[1],"30");r.unotice=this.getUserNotice(u)}}return r};this.getUserNotice=function(v){var s={};var t=o(v,0);for(var u=0;u<t.length;u++){var r=c(v,t[u]);if(r.substr(0,2)!="30"){s.exptext=this.getDisplayText(r)}}return s};this.getDisplayText=function(s){var t={"0c":"utf8","16":"ia5","1a":"vis","1e":"bmp"};var r={};r.type=t[s.substr(0,2)];r.str=hextorstr(m(s,0));return r};this.getExtCRLNumber=function(s,t){var r={extname:"cRLNumber"};if(t){r.critical=true}if(s.substr(0,2)=="02"){r.num={hex:m(s,0)};return r}throw new Error("hExtV parse error: "+s)};this.getExtCRLReason=function(s,t){var r={extname:"cRLReason"};if(t){r.critical=true}if(s.substr(0,2)=="0a"){r.code=parseInt(m(s,0),16);return r}throw new Error("hExtV parse error: "+s)};this.getX500NameRule=function(r){var y=true;var C=true;var B=false;var s="";var v="";var E=null;var z=[];for(var u=0;u<r.length;u++){var w=r[u];for(var t=0;t<w.length;t++){z.push(w[t])}}for(var u=0;u<z.length;u++){var D=z[u];var F=D.ds;var A=D.value;var x=D.type;s+=":"+F;if(F!="prn"&&F!="utf8"&&F!="ia5"){return"mixed"}if(F=="ia5"){if(x!="CN"){return"mixed"}else{if(!KJUR.lang.String.isMail(A)){return"mixed"}else{continue}}}if(x=="C"){if(F=="prn"){continue}else{return"mixed"}}v+=":"+F;if(E==null){E=F}else{if(E!==F){return"mixed"}}}if(E==null){return"prn"}else{return E}};this.getX500Name=function(u){var r=[];var s=o(u,0);for(var t=0;t<s.length;t++){r.push(this.getRDN(c(u,s[t])))}return r};this.getRDN=function(u){var r=[];var s=o(u,0);for(var t=0;t<s.length;t++){r.push(this.getAttrTypeAndValue(c(u,s[t])))}return r};this.getAttrTypeAndValue=function(t){var r={type:null,value:null,ds:null};var s=o(t,0);var w=j(t,s[0],[],"06");var v=j(t,s[1],[]);var u=KJUR.asn1.ASN1Util.oidHexToInt(w);r.type=KJUR.asn1.x509.OID.oid2atype(u);r.value=hextorstr(v);r.ds=this.HEX2STAG[t.substr(s[1],2)];return r};this.readCertPEM=function(r){this.readCertHex(h(r))};this.readCertHex=function(r){this.hex=r;this.getVersion();try{k(this.hex,0,[0,7],"a3");this.parseExt()}catch(s){}};this.getParam=function(){var r={};r.version=this.getVersion();r.serial={hex:this.getSerialNumberHex()};r.sigalg=this.getSignatureAlgorithmField();r.issuer=this.getIssuer();r.notbefore=this.getNotBefore();r.notafter=this.getNotAfter();r.subject=this.getSubject();r.sbjpubkey=hextopem(this.getPublicKeyHex(),"PUBLIC KEY");if(this.aExtInfo.length>0){r.ext=this.getExtParamArray()}r.sighex=this.getSignatureValueHex();return r};this.getExtParamArray=function(s){if(s==undefined){var u=i(this.hex,0,[0,"[3]"]);if(u!=-1){s=f(this.hex,0,[0,"[3]",0],"30")}}var r=[];var t=o(s,0);for(var v=0;v<t.length;v++){var x=c(s,t[v]);var w=this.getExtParam(x);if(w!=null){r.push(w)}}return r};this.getExtParam=function(w){var r={};var s=o(w,0);var y=s.length;if(y!=2&&y!=3){throw new Error("wrong number elements in Extension: "+y+" "+w)}var v=a(j(w,0,[0],"06"));var x=false;if(y==3&&d(w,0,[1])=="0101ff"){x=true}var u=d(w,0,[y-1,0]);var t=undefined;if(v=="2.5.29.14"){t=this.getExtSubjectKeyIdentifier(u,x)}else{if(v=="2.5.29.15"){t=this.getExtKeyUsage(u,x)}else{if(v=="2.5.29.17"){t=this.getExtSubjectAltName(u,x)}else{if(v=="2.5.29.18"){t=this.getExtIssuerAltName(u,x)}else{if(v=="2.5.29.19"){t=this.getExtBasicConstraints(u,x)}else{if(v=="2.5.29.31"){t=this.getExtCRLDistributionPoints(u,x)}else{if(v=="2.5.29.32"){t=this.getExtCertificatePolicies(u,x)}else{if(v=="2.5.29.35"){t=this.getExtAuthorityKeyIdentifier(u,x)}else{if(v=="2.5.29.37"){t=this.getExtExtKeyUsage(u,x)}else{if(v=="1.3.6.1.5.5.7.1.1"){t=this.getExtAuthorityInfoAccess(u,x)}else{if(v=="2.5.29.20"){t=this.getExtCRLNumber(u,x)}else{if(v=="2.5.29.21"){t=this.getExtCRLReason(u,x)}}}}}}}}}}}}if(t!=undefined){return t}return null};this.getInfo=function(){var t=function(L){var K=JSON.stringify(L.array).replace(/[\[\]\{\}\"]/g,"");return K};var z=function(Q){var O="";var K=Q.array;for(var N=0;N<K.length;N++){var P=K[N];O+="    policy oid: "+P.policyoid+"\n";if(P.array===undefined){continue}for(var M=0;M<P.array.length;M++){var L=P.array[M];if(L.cps!==undefined){O+="    cps: "+L.cps+"\n"}}}return O};var C=function(O){var N="";var K=O.array;for(var M=0;M<K.length;M++){var P=K[M];try{if(P.dpname.full[0].uri!==undefined){N+="    "+P.dpname.full[0].uri+"\n"}}catch(L){}try{if(P.dname.full[0].dn.hex!==undefined){N+="    "+X509.hex2dn(P.dpname.full[0].dn.hex)+"\n"}}catch(L){}}return N};var A=function(O){var N="";var K=O.array;for(var L=0;L<K.length;L++){var M=K[L];if(M.caissuer!==undefined){N+="    caissuer: "+M.caissuer+"\n"}if(M.ocsp!==undefined){N+="    ocsp: "+M.ocsp+"\n"}}return N};var u=X509;var E,D,J;E="Basic Fields\n";E+="  serial number: "+this.getSerialNumberHex()+"\n";E+="  signature algorithm: "+this.getSignatureAlgorithmField()+"\n";E+="  issuer: "+this.getIssuerString()+"\n";E+="  notBefore: "+this.getNotBefore()+"\n";E+="  notAfter: "+this.getNotAfter()+"\n";E+="  subject: "+this.getSubjectString()+"\n";E+="  subject public key info: \n";D=this.getPublicKey();E+="    key algorithm: "+D.type+"\n";if(D.type==="RSA"){E+="    n="+hextoposhex(D.n.toString(16)).substr(0,16)+"...\n";E+="    e="+hextoposhex(D.e.toString(16))+"\n"}J=this.aExtInfo;if(J!==undefined&&J!==null){E+="X509v3 Extensions:\n";for(var G=0;G<J.length;G++){var I=J[G];var r=KJUR.asn1.x509.OID.oid2name(I.oid);if(r===""){r=I.oid}var F="";if(I.critical===true){F="CRITICAL"}E+="  "+r+" "+F+":\n";if(r==="basicConstraints"){var v=this.getExtBasicConstraints();if(v.cA===undefined){E+="    {}\n"}else{E+="    cA=true";if(v.pathLen!==undefined){E+=", pathLen="+v.pathLen}E+="\n"}}else{if(r==="keyUsage"){E+="    "+this.getExtKeyUsageString()+"\n"}else{if(r==="subjectKeyIdentifier"){E+="    "+this.getExtSubjectKeyIdentifier().kid.hex+"\n"}else{if(r==="authorityKeyIdentifier"){var w=this.getExtAuthorityKeyIdentifier();if(w.kid!==undefined){E+="    kid="+w.kid.hex+"\n"}}else{if(r==="extKeyUsage"){var H=this.getExtExtKeyUsage().array;E+="    "+H.join(", ")+"\n"}else{if(r==="subjectAltName"){var x=t(this.getExtSubjectAltName());E+="    "+x+"\n"}else{if(r==="cRLDistributionPoints"){var B=this.getExtCRLDistributionPoints();E+=C(B)}else{if(r==="authorityInfoAccess"){var y=this.getExtAuthorityInfoAccess();E+=A(y)}else{if(r==="certificatePolicies"){E+=z(this.getExtCertificatePolicies())}}}}}}}}}}}E+="signature algorithm: "+this.getSignatureAlgorithmName()+"\n";E+="signature: "+this.getSignatureValueHex().substr(0,16)+"...\n";return E}}X509.hex2dn=function(f,b){if(b===undefined){b=0}if(f.substr(b,2)!=="30"){throw new Error("malformed DN")}var c=new Array();var d=ASN1HEX.getChildIdx(f,b);for(var e=0;e<d.length;e++){c.push(X509.hex2rdn(f,d[e]))}c=c.map(function(a){return a.replace("/","\\/")});return"/"+c.join("/")};X509.hex2rdn=function(f,b){if(b===undefined){b=0}if(f.substr(b,2)!=="31"){throw new Error("malformed RDN")}var c=new Array();var d=ASN1HEX.getChildIdx(f,b);for(var e=0;e<d.length;e++){c.push(X509.hex2attrTypeValue(f,d[e]))}c=c.map(function(a){return a.replace("+","\\+")});return c.join("+")};X509.hex2attrTypeValue=function(d,i){var j=ASN1HEX;var h=j.getV;if(i===undefined){i=0}if(d.substr(i,2)!=="30"){throw new Error("malformed attribute type and value")}var g=j.getChildIdx(d,i);if(g.length!==2||d.substr(g[0],2)!=="06"){"malformed attribute type and value"}var b=h(d,g[0]);var f=KJUR.asn1.ASN1Util.oidHexToInt(b);var e=KJUR.asn1.x509.OID.oid2atype(f);var a=h(d,g[1]);var c=hextorstr(a);return e+"="+c};X509.getPublicKeyFromCertHex=function(b){var a=new X509();a.readCertHex(b);return a.getPublicKey()};X509.getPublicKeyFromCertPEM=function(b){var a=new X509();a.readCertPEM(b);return a.getPublicKey()};X509.getPublicKeyInfoPropOfCertPEM=function(c){var e=ASN1HEX;var g=e.getVbyList;var b={};var a,f,d;b.algparam=null;a=new X509();a.readCertPEM(c);f=a.getPublicKeyHex();b.keyhex=g(f,0,[1],"03").substr(2);b.algoid=g(f,0,[0,0],"06");if(b.algoid==="2a8648ce3d0201"){b.algparam=g(f,0,[0,1],"06")}return b};X509.KEYUSAGE_NAME=["digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","keyAgreement","keyCertSign","cRLSign","encipherOnly","decipherOnly"];