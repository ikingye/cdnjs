!function(n,t,e){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&module.exports?module.exports=e(n,t):t[n]=e(n,t)}("CAF",this,function(n,t){"use strict";class e{constructor(n=new AbortController){this.controller=n,this.signal=n.signal,this.signal.pr=new Promise((n,t)=>{l(this.signal,"abort",n=>{"reason"in this.signal||(this.signal.reason=n),t(n)}),this.rej=t}),this.signal.pr.catch(n=>n)}abort(n){"reason"in this.signal||(this.signal.reason=n),this.rej(n),this.controller.abort()}}const r=Symbol("Timeout Token");return Object.assign(i,{cancelToken:e,delay:o,timeout:function(n,t="Timeout"){n=Number(n)||0;var i=new e;return o(i.signal,n).then(a,a),Object.defineProperty(i,r,{value:!0,writable:!1,enumerable:!1,configurable:!1}),i;function a(){i.abort(t),i=null}},signalRace:function(n){var t=new e;return Promise.race(n.map(a)).catch(t.abort.bind(t)),t.signal},signalAll:function(n){var t=new e,r=n.map(function(n){return a(n).catch(n=>n)});return Promise.all(r).then(t.abort.bind(t)),t.signal}}),i;function i(n){return function(t,...e){var i,o;if(({tokenOrSignal:t,signal:i,signalPr:o}=u(t)),i.aborted)return o;var a=o.catch(function(n){try{var t=l.return();throw void 0!==t.value?t.value:n}finally{l=s=a=c=null}}),{it:l,result:s}=function(n,...t){var e=n.apply(this,t);return n=t=null,{it:e,result:function n(t){try{var r=e.next(t);t=null}catch(t){return Promise.reject(t)}return function t(r){var i=Promise.resolve(r.value);return r.done?e=null:(i=i.then(n,function(n){return Promise.resolve(e.throw(n)).then(t)})).catch(function(){e=null}),r=null,i}(r)}()}}.call(this,n,i,...e),c=Promise.race([s,a]);return t!==i&&t[r]?c.then(function(){t.abort()},function(){t.abort()}):c.catch(Function.prototype),i=e=null,c}}function o(n,t){var e,r;return"number"==typeof n&&"number"!=typeof t&&([t,n]=[n,t]),n&&({tokenOrSignal:n,signal:e,signalPr:r}=u(n)),e&&e.aborted?r:new Promise(function(n,i){e&&r.catch(function(){o&&(clearTimeout(o),i(`delay (${t}) interrupted`)),n=i=o=e=null});var o=setTimeout(function(){n("delayed: "+t),n=i=o=e=null},t)})}function a(n){return n.pr||new Promise(function(t,e){l(n,"abort",e)})}function l(n,t,e){n.addEventListener(t,function r(...i){n.removeEventListener(t,r),e(...i)})}function u(n){n instanceof AbortController&&(n=new e(n));var t=n&&n instanceof e?n.signal:n;return{tokenOrSignal:n,signal:t,signalPr:a(t)}}});