/*! caf.js
	v8.0.1 (c) 2019 Kyle Simpson
	MIT License: http://getify.mit-license.org
*/

!function UMD(n,e,t){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&module.exports?module.exports=t(n,e):e[n]=t(n,e)}("CAF",this,(function DEF(n,e){"use strict";class t{constructor(n=new AbortController){this.controller=n,this.signal=n.signal;this.signal.pr=new Promise((n,e)=>{once(this.signal,"abort",e),this.rej=e}),this.signal.pr.catch(n=>n)}abort(n){this.rej(n),this.controller.abort()}}const r=Symbol("Timeout Token");return Object.assign(CAF,{cancelToken:t,delay:delay,timeout:function timeout(n,e="Timeout"){n=Number(n)||0;var o=new t;return delay(o.signal,n).then(cleanup,cleanup),Object.defineProperty(o,r,{value:!0,writable:!1,enumerable:!1,configurable:!1}),o;function cleanup(){o.abort(e),o=null}},signalRace:function signalRace(n){var e=new t;return Promise.race(n.map(getSignalPr)).catch(e.abort.bind(e)),e.signal},signalAll:function signalAll(n){var e=new t,r=n.map((function normalize(n){return getSignalPr(n).catch(n=>n)}));return Promise.all(r).then(e.abort.bind(e)),e.signal}}),CAF;function CAF(n){return function instance(e,...o){var i,l;if(({tokenOrSignal:e,signal:i,signalPr:l}=processTokenOrSignal(e)),i.aborted)return l;var a=l.catch((function onCancelation(n){try{var e=u.return();throw void 0!==e.value?e.value:n}finally{u=s=a=f=null}})),{it:u,result:s}=_runner.call(this,n,i,...o),f=Promise.race([s,a]);return e!==i&&e[r]?f.then((function t(){e.abort()}),(function c(){e.abort()})):f.catch(Function.prototype),i=o=null,f}}function delay(n,e){var t,r;return"number"==typeof n&&"number"!=typeof e&&([e,n]=[n,e]),n&&({tokenOrSignal:n,signal:t,signalPr:r}=processTokenOrSignal(n)),t&&t.aborted?r:new Promise((function c(n,o){t&&r.catch((function onAbort(){i&&(clearTimeout(i),o(`delay (${e}) interrupted`)),n=o=i=t=null}));var i=setTimeout((function onTimeout(){n(`delayed: ${e}`),n=o=i=t=null}),e)}))}function getSignalPr(n){return n.pr||new Promise((function c(e,t){once(n,"abort",t)}))}function once(n,e,t){n.addEventListener(e,(function onEvt(...r){n.removeEventListener(e,onEvt),t(...r)}))}function processTokenOrSignal(n){n instanceof AbortController&&(n=new t(n));var e=n&&n instanceof t?n.signal:n;return{tokenOrSignal:n,signal:e,signalPr:getSignalPr(e)}}function _runner(n,...e){var t=n.apply(this,e);return n=e=null,{it:t,result:function getNextResult(n){try{var e=t.next(n);n=null}catch(n){return Promise.reject(n)}return function processResult(n){var e=Promise.resolve(n.value);return n.done?t=null:(e=e.then(getNextResult,(function onRejection(n){return Promise.resolve(t.throw(n)).then(processResult)}))).catch((function cleanup(){t=null})),n=null,e}(e)}()}}}));