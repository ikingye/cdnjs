import{voronoi}from"d3-voronoi";import{polygonCentroid,polygonArea}from"d3-polygon";import{selectAll,select}from"d3-selection";import"d3-brush";var _extendStatics=function(t,e){return(_extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function __extends(t,e){function n(){this.constructor=t}_extendStatics(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function __spreadArrays(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],c=0,a=i.length;c<a;c++,o++)r[o]=i[c];return r}var win=function(){var t=function(t){return void 0!==t&&t};return t(self)||t(window)||t(global)||t(globalThis)||Function("return this")()}(),doc=win&&win.document,isDefined=function(t){return void 0!==t},isObjectType=function(t){return"object"==typeof t},isArray=function(t){return Array.isArray(t)},isObject=function(t){return t&&!t.nodeType&&isObjectType(t)&&!isArray(t)};function mergeObj(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!e.length||1===e.length&&!e[0])return t;var r=e.shift();return isObject(t)&&isObject(r)&&Object.keys(r).forEach(function(e){var n=r[e];isObject(n)?(!t[e]&&(t[e]={}),t[e]=mergeObj(t[e],n)):t[e]=isArray(n)?n.concat():n}),mergeObj.apply(void 0,__spreadArrays([t],e))}var emulateEvent={mouse:function(){try{return new MouseEvent("t"),function(t,e,n){void 0===n&&(n={bubbles:!1,cancelable:!1,screenX:0,screenY:0,clientX:0,clientY:0}),t.dispatchEvent(new MouseEvent(e,n))}}catch(t){return function(t,e,n){void 0===n&&(n={bubbles:!1,cancelable:!1,screenX:0,screenY:0,clientX:0,clientY:0});var r=doc.createEvent("MouseEvent");r.initMouseEvent(e,n.bubbles,n.cancelable,win,0,n.screenX,n.screenY,n.clientX,n.clientY,!1,!1,!1,!1,0,null),t.dispatchEvent(r)}}}(),touch:function(t,e,n){var r=new Touch(mergeObj({identifier:Date.now(),target:t,radiusX:2.5,radiusY:2.5,rotationAngle:10,force:.5},n));t.dispatchEvent(new TouchEvent(e,{cancelable:!0,bubbles:!0,shiftKey:!0,touches:[r],targetTouches:[],changedTouches:[r]}))}};function loadConfig(t){var e,n,r,o=this.config,i=function(){var t=n.shift();return t&&e&&isObjectType(e)&&t in e?(e=e[t],i()):t?void 0:e};Object.keys(o).forEach(function(c){e=t,n=c.split("_"),r=i(),isDefined(r)&&(o[c]=r)})}var Plugin=function(){function t(t){void 0===t&&(t={}),this.options=t}return t.prototype.$beforeInit=function(){},t.prototype.$init=function(){},t.prototype.$afterInit=function(){},t.prototype.$redraw=function(){},t.prototype.$willDestroy=function(){var t=this;Object.keys(this).forEach(function(e){t[e]=null,delete t[e]})},t.version="2.0.2",t}(),Options=function(){return function(){return{selector:".bb-texts text",extent:1,area:0}}}(),TextOverlap=function(t){function e(e){var n=t.call(this,e)||this;return n.config=new Options,n}return __extends(e,t),e.prototype.$init=function(){loadConfig.call(this,this.options)},e.prototype.$redraw=function(){var t=selectAll(this.config.selector);!t.empty()&&this.preventLabelOverlap(t)},e.prototype.generateVoronoi=function(t){var e,n=this.$$.scale,r=["x","y"].map(function(t){return n[t].domain()}),o=r[0],i=r[1];return e=[i[0],o[1]],o[1]=e[0],i[0]=e[1],voronoi().extent([o,i]).polygons(t)},e.prototype.preventLabelOverlap=function(t){var e=this.config,n=e.extent,r=e.area,o=this.generateVoronoi(t.data().map(function(t){return[t.x,t.value]})),i=0;t.each(function(){var t=o[i++];if(t&&this){var e=t.data,c=e[0],a=e[1],s=polygonCentroid(t),u=s[0],l=s[1],f=Math.round(Math.atan2(l-a,u-c)/Math.PI*2),p=n*(0===f?1:-1),v=-1===f?-n:n+5,d=1===Math.abs(f)?"middle":0===f?"start":"end";select(this).attr("display",polygonArea(t)<r?"none":null).attr("text-anchor",d).attr("dy","0."+(1===f?71:35)+"em").attr("transform","translate("+p+", "+v+")")}})},e}(Plugin);export default TextOverlap;