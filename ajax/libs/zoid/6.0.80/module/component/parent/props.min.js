var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};import{ZalgoPromise}from"zalgo-promise/src";import{noop,denodeify,once,memoize,promisify,dotify}from"../../lib";function isDefined(e){return null!=e&&""!==e}export function normalizeProp(e,o,r,n,t){var i=e.getProp(n),a=void 0;!(a=i.value?i.value:!i.def||r.hasOwnProperty(n)&&isDefined(t)?t:i.def.call(e,r))&&i.alias&&r[i.alias]&&(a=r[i.alias]);var f=!1;i.decorate&&null!=a&&(a=i.decorate.call(o,a,r),f=!0);var u=i.type;if("boolean"===u)a=Boolean(a);else if("function"===u){if(!a&&i.noop&&(a=noop,!f&&i.decorate&&(a=i.decorate.call(o,noop,r))),a&&"function"==typeof a){a=a.bind(o),i.denodeify&&(a=denodeify(a)),i.promisify&&(a=promisify(a));var l=a;a=function(){return e.log("call_prop_"+n),l.apply(this,arguments)},i.once&&(a=once(a)),i.memoize&&(a=memoize(a))}}else"string"===u||"object"===u||"number"===u&&void 0!==a&&(a=parseInt(a,10));return a};export function normalizeProps(e,o,r){var n={};r=r||{};for(var t=0,i=Object.keys(r),a=null==i?0:i.length;t<a;t++){var f=i[t];-1!==e.getPropNames().indexOf(f)?n[f]=normalizeProp(e,o,r,f,r[f]):n[f]=r[f]}for(var u=0,l=e.getPropNames(),y=null==l?0:l.length;u<y;u++){var p=l[u];if(!(r.hasOwnProperty(p)||o.props&&o.props.hasOwnProperty(p))){var s=normalizeProp(e,o,r,p,r[p]);void 0!==s&&(n[p]=s)}}return n};function getQueryParam(e,o,r){return ZalgoPromise.try(function(){return"function"==typeof e.queryParam?e.queryParam(r):"string"==typeof e.queryParam?e.queryParam:o})}function getQueryValue(e,o,r){return ZalgoPromise.try(function(){return"function"==typeof e.queryValue?e.queryValue(r):r})}export function propsToQuery(e,o){var r={};return ZalgoPromise.all(Object.keys(o).map(function(n){var t=e[n];if(t)return ZalgoPromise.resolve().then(function(){var e=o[n];if(e&&t.queryParam)return e}).then(function(e){if(e)return ZalgoPromise.all([getQueryParam(t,n,e),getQueryValue(t,n,e)]).then(function(e){var o=e[0],i=e[1],a=void 0;if("boolean"==typeof i)a="1";else if("string"==typeof i)a=i.toString();else{if("function"==typeof i)return;if("object"===(void 0===i?"undefined":_typeof(i))&&null!==i){if("json"!==t.serialization){a=dotify(i,n);for(var f=0,u=Object.keys(a),l=null==u?0:u.length;f<l;f++){var y=u[f];r[y]=a[y]}return}a=JSON.stringify(i)}else"number"==typeof i&&(a=i.toString())}r[o]=a})})})).then(function(){return Object.keys(r).forEach(function(e){r[e]=escape(r[e])}),r})};