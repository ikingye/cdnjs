var _createClass=function(){function e(e,o){for(var t=0;t<o.length;t++){var r=o[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(o,t,r){return t&&e(o.prototype,t),r&&e(o,r),o}}();function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,o){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!o||"object"!=typeof o&&"function"!=typeof o?e:o}function _inherits(e,o){if("function"!=typeof o&&null!==o)throw new TypeError("Super expression must either be null or a function, not "+typeof o);e.prototype=Object.create(o&&o.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),o&&(Object.setPrototypeOf?Object.setPrototypeOf(e,o):e.__proto__=o)}import{onCloseWindow}from"cross-domain-utils/src";import{ZalgoPromise}from"zalgo-promise/src";import{BaseComponent}from"../base";import{ParentComponent}from"../parent";import{RENDER_DRIVERS}from"../parent/drivers";import{noop}from"../../lib";export var DelegateComponent=function(e){function o(t,r,n){_classCallCheck(this,o);var i=_possibleConstructorReturn(this,e.call(this));i.component=t,i.clean.set("source",r),i.context=n.context,i.props={uid:n.props.uid,dimensions:n.props.dimensions,onClose:n.props.onClose,onDisplay:n.props.onDisplay};for(var s=0,l=t.getPropNames(),a=null==l?0:l.length;s<a;s++){var c=l[s];i.component.getProp(c).allowDelegate&&(i.props[c]=n.props[c])}i.focus=function(){return ZalgoPromise.all([i.isWindowClosed().then(function(e){e||window.open("",i.childWindowName)}),n.overrides.focus.call(i)]).then(noop)},i.clean.register("destroyFocusOverride",function(){i.focus=noop}),i.userClose=n.overrides.userClose,i.getDomain=n.overrides.getDomain,i.error=n.overrides.error,i.on=n.overrides.on;for(var p=RENDER_DRIVERS[n.context].delegateOverrides,u=0,f=Object.keys(p),d=null==f?0:f.length;u<d;u++){var m=f[u];i[m]=ParentComponent.prototype[m]}return i.childWindowName=n.childWindowName,i.isWindowClosed=n.isWindowClosed,ParentComponent.prototype.registerActiveComponent.call(i),i.watchForClose(),i}return _inherits(o,e),o.prototype.watchForClose=function(){var e=this,o=onCloseWindow(this.source,function(){return e.destroy()},3e3);this.clean.register("destroyCloseWindowListener",o.cancel)},o.prototype.getOverrides=function(e){for(var o=RENDER_DRIVERS[e].delegateOverrides,t={},r=this,n=function(e,o,n){var i=o[e];t[i]=function(){return ParentComponent.prototype[i].apply(r,arguments)}},i=0,s=Object.keys(o),l=null==s?0:s.length;i<l;i++)n(i,s);return t},o.prototype.destroy=function(){return this.clean.all()},_createClass(o,[{key:"driver",get:function(){if(!this.context)throw new Error("Context not set");return RENDER_DRIVERS[this.context]}}]),o}(BaseComponent);