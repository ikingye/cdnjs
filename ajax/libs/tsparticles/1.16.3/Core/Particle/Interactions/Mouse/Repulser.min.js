"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Repulser=void 0;const Enums_1=require("../../../../Enums"),Utils_1=require("../../../../Utils");class Repulser{constructor(e){this.container=e}isEnabled(){const e=this.container,i=e.options,t=e.interactivity.mouse,s=i.interactivity.events,o=s.onDiv,n=Utils_1.Utils.isDivModeEnabled(Enums_1.DivMode.repulse,o);if(!(n||s.onHover.enable&&t.position||s.onClick.enable&&t.clickPosition))return!1;const l=s.onHover.mode,c=s.onClick.mode;return Utils_1.Utils.isInArray(Enums_1.HoverMode.repulse,l)||Utils_1.Utils.isInArray(Enums_1.ClickMode.repulse,c)||n}reset(){}interact(){const e=this.container,i=e.options,t=e.interactivity.status===Utils_1.Constants.mouseMoveEvent,s=i.interactivity.events,o=s.onHover.enable,n=s.onHover.mode,l=s.onClick.enable,c=s.onClick.mode,r=s.onDiv;t&&o&&Utils_1.Utils.isInArray(Enums_1.HoverMode.repulse,n)?this.hoverRepulse():l&&Utils_1.Utils.isInArray(Enums_1.ClickMode.repulse,c)?this.clickRepulse():Utils_1.Utils.divModeExecute(Enums_1.DivMode.repulse,r,(e,i)=>this.singleDivRepulse(e,i))}singleDivRepulse(e,i){const t=this.container,s=document.getElementById(e);if(!s)return;const o=t.retina.pixelRatio,n={x:(s.offsetLeft+s.offsetWidth/2)*o,y:(s.offsetTop+s.offsetHeight/2)*o},l=s.offsetWidth/2*o,c=i.type===Enums_1.DivType.circle?new Utils_1.Circle(n.x,n.y,l):new Utils_1.Rectangle(s.offsetLeft*o,s.offsetTop*o,s.offsetWidth*o,s.offsetHeight*o),r=t.options.interactivity.modes.repulse.divs,u=Utils_1.Utils.divMode(r,e);this.processRepulse(n,l,c,u)}hoverRepulse(){const e=this.container,i=e.interactivity.mouse.position;if(!i)return;const t=e.retina.repulseModeDistance;this.processRepulse(i,t,new Utils_1.Circle(i.x,i.y,t))}processRepulse(e,i,t,s){var o;const n=this.container,l=n.particles.quadTree.query(t);for(const t of l){const{dx:l,dy:c,distance:r}=Utils_1.Utils.getDistances(t.position,e),u={x:l/r,y:c/r},a=100*(null!==(o=null==s?void 0:s.speed)&&void 0!==o?o:n.options.interactivity.modes.repulse.speed),p=Utils_1.Utils.clamp((1-Math.pow(r/i,2))*a,0,50),v=t.particlesOptions.move.outMode,d=t.size.value,y={x:t.position.x+u.x*p,y:t.position.y+u.y*p};if(v===Enums_1.OutMode.bounce||v===Enums_1.OutMode.bounceVertical||v===Enums_1.OutMode.bounceHorizontal){const e={horizontal:y.x-d>0&&y.x+d<n.canvas.size.width,vertical:y.y-d>0&&y.y+d<n.canvas.size.height};(v===Enums_1.OutMode.bounceVertical||e.horizontal)&&(t.position.x=y.x),(v===Enums_1.OutMode.bounceHorizontal||e.vertical)&&(t.position.y=y.y)}else t.position.x=y.x,t.position.y=y.y}}clickRepulse(){const e=this.container;if(e.repulse.finish||(e.repulse.count||(e.repulse.count=0),e.repulse.count++,e.repulse.count===e.particles.count&&(e.repulse.finish=!0)),e.repulse.clicking){const i=e.retina.repulseModeDistance,t=Math.pow(i/6,3),s=e.interactivity.mouse.clickPosition;if(void 0===s)return;const o=new Utils_1.Circle(s.x,s.y,t),n=e.particles.quadTree.query(o);for(const i of n){const{dx:o,dy:n,distance:l}=Utils_1.Utils.getDistances(s,i.position),c=l*l,r=e.options.interactivity.modes.repulse.speed,u=-t*r/c;c<=t&&(e.repulse.particles.push(i),this.processClickRepulse(i,o,n,u))}}else if(!1===e.repulse.clicking){for(const i of e.repulse.particles)i.velocity.horizontal=i.initialVelocity.horizontal,i.velocity.vertical=i.initialVelocity.vertical;e.repulse.particles=[]}}processClickRepulse(e,i,t,s){const o=this.container,n=o.options,l=Math.atan2(t,i);e.velocity.horizontal=s*Math.cos(l),e.velocity.vertical=s*Math.sin(l);const c=n.particles.move.outMode;if(c===Enums_1.OutMode.bounce||c===Enums_1.OutMode.bounceHorizontal||c===Enums_1.OutMode.bounceVertical){const i={x:e.position.x+e.velocity.horizontal,y:e.position.y+e.velocity.vertical};c!==Enums_1.OutMode.bounceVertical&&(i.x+e.size.value>o.canvas.size.width||i.x-e.size.value<0)&&(e.velocity.horizontal*=-1),c!==Enums_1.OutMode.bounceHorizontal&&(i.y+e.size.value>o.canvas.size.height||i.y-e.size.value<0)&&(e.velocity.vertical*=-1)}}}exports.Repulser=Repulser;