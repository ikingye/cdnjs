"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Bubbler=void 0;const Utils_1=require("../../../../Utils"),Enums_1=require("../../../../Enums");class Bubbler{constructor(e){this.container=e}static calculateBubbleValue(e,i,t,o){if(i>t){const b=e+(i-t)*o;return Utils_1.Utils.clamp(b,e,i)}if(i<t){const b=e-(t-i)*o;return Utils_1.Utils.clamp(b,i,e)}}isEnabled(){const e=this.container,i=e.options,t=e.interactivity.mouse,o=i.interactivity.events,b=o.onDiv,s=Utils_1.Utils.isDivModeEnabled(Enums_1.DivMode.bubble,b);if(!(s||o.onHover.enable&&t.position||o.onClick.enable&&t.clickPosition))return!1;const l=o.onHover.mode,n=o.onClick.mode;return Utils_1.Utils.isInArray(Enums_1.HoverMode.bubble,l)||Utils_1.Utils.isInArray(Enums_1.ClickMode.bubble,n)||s}reset(e,i){e.bubble.inRange&&!i||(delete e.bubble.divId,delete e.bubble.opacity,delete e.bubble.radius,delete e.bubble.color)}interact(){const e=this.container.options.interactivity.events,i=e.onHover,t=e.onClick,o=i.enable,b=i.mode,s=t.enable,l=t.mode,n=e.onDiv;o&&Utils_1.Utils.isInArray(Enums_1.HoverMode.bubble,b)?this.hoverBubble():s&&Utils_1.Utils.isInArray(Enums_1.ClickMode.bubble,l)?this.clickBubble():Utils_1.Utils.divModeExecute(Enums_1.DivMode.bubble,n,(e,i)=>this.singleDivHover(e,i))}singleDivHover(e,i){const t=this.container,o=document.getElementById(e);if(!o)return;const b=t.retina.pixelRatio,s={x:(o.offsetLeft+o.offsetWidth/2)*b,y:(o.offsetTop+o.offsetHeight/2)*b},l=o.offsetWidth/2*b,n=i.type===Enums_1.DivType.circle?new Utils_1.Circle(s.x,s.y,l):new Utils_1.Rectangle(o.offsetLeft*b,o.offsetTop*b,o.offsetWidth*b,o.offsetHeight*b),u=t.particles.quadTree.query(n);for(const i of u.filter(e=>n.contains(e.getPosition()))){i.bubble.inRange=!0;const o=t.options.interactivity.modes.bubble.divs,b=Utils_1.Utils.divMode(o,e);i.bubble.divId&&i.bubble.divId===e||(this.reset(i,!0),i.bubble.divId=e),this.hoverBubbleSize(i,1,b),this.hoverBubbleOpacity(i,1,b),this.hoverBubbleColor(i,b)}}process(e,i,t,o){const b=this.container,s=o.bubbleObj.optValue;if(void 0===s)return;const l=b.options.interactivity.modes.bubble.duration,n=b.retina.bubbleModeDistance,u=o.particlesObj.optValue,r=o.bubbleObj.value,a=o.particlesObj.value||0,c=o.type;if(s!==u)if(b.bubble.durationEnd)r&&(c===Enums_1.ProcessBubbleType.size&&delete e.bubble.radius,c===Enums_1.ProcessBubbleType.opacity&&delete e.bubble.opacity);else if(i<=n){if((null!=r?r:a)!==s){const i=a-t*(a-s)/l;c===Enums_1.ProcessBubbleType.size&&(e.bubble.radius=i),c===Enums_1.ProcessBubbleType.opacity&&(e.bubble.opacity=i)}}else c===Enums_1.ProcessBubbleType.size&&delete e.bubble.radius,c===Enums_1.ProcessBubbleType.opacity&&delete e.bubble.opacity}clickBubble(){var e;const i=this.container,t=i.options,o=i.interactivity.mouse.clickPosition;if(void 0===o)return;const b=i.retina.bubbleModeDistance,s=i.particles.quadTree.query(new Utils_1.Circle(o.x,o.y,b));for(const b of s){b.bubble.inRange=!0;const s=b.getPosition(),l=Utils_1.Utils.getDistance(s,o),n=((new Date).getTime()-(i.interactivity.mouse.clickTime||0))/1e3;if(i.bubble.clicking){n>t.interactivity.modes.bubble.duration&&(i.bubble.durationEnd=!0),n>2*t.interactivity.modes.bubble.duration&&(i.bubble.clicking=!1,i.bubble.durationEnd=!1);const o={bubbleObj:{optValue:i.retina.bubbleModeSize,value:b.bubble.radius},particlesObj:{optValue:null!==(e=b.sizeValue)&&void 0!==e?e:i.retina.sizeValue,value:b.size.value},type:Enums_1.ProcessBubbleType.size};this.process(b,l,n,o);const s={bubbleObj:{optValue:t.interactivity.modes.bubble.opacity,value:b.bubble.opacity},particlesObj:{optValue:b.particlesOptions.opacity.value,value:b.opacity.value},type:Enums_1.ProcessBubbleType.opacity};this.process(b,l,n,s),i.bubble.durationEnd?delete b.bubble.color:l<=i.retina.bubbleModeDistance?this.hoverBubbleColor(b):delete b.bubble.color}}}hoverBubble(){const e=this.container,i=e.interactivity.mouse.position;if(void 0===i)return;const t=e.retina.bubbleModeDistance,o=e.particles.quadTree.query(new Utils_1.Circle(i.x,i.y,t));for(const t of o){t.bubble.inRange=!0;const o=t.getPosition(),b=Utils_1.Utils.getDistance(o,i),s=1-b/e.retina.bubbleModeDistance;b<=e.retina.bubbleModeDistance?s>=0&&e.interactivity.status===Utils_1.Constants.mouseMoveEvent&&(this.hoverBubbleSize(t,s),this.hoverBubbleOpacity(t,s),this.hoverBubbleColor(t)):this.reset(t),e.interactivity.status===Utils_1.Constants.mouseLeaveEvent&&this.reset(t)}}hoverBubbleSize(e,i,t){var o;const b=this.container,s=(null==t?void 0:t.size)?t.size*b.retina.pixelRatio:b.retina.bubbleModeSize;if(void 0===s)return;const l=null!==(o=e.sizeValue)&&void 0!==o?o:b.retina.sizeValue,n=e.size.value,u=Bubbler.calculateBubbleValue(n,s,l,i);void 0!==u&&(e.bubble.radius=u)}hoverBubbleOpacity(e,i,t){var o;const b=this.container.options,s=null!==(o=null==t?void 0:t.opacity)&&void 0!==o?o:b.interactivity.modes.bubble.opacity;if(void 0===s)return;const l=e.particlesOptions.opacity.value,n=e.opacity.value,u=Bubbler.calculateBubbleValue(n,s,l,i);void 0!==u&&(e.bubble.opacity=u)}hoverBubbleColor(e,i){var t;const o=this.container.options;if(void 0===e.bubble.color){const b=null!==(t=null==i?void 0:i.color)&&void 0!==t?t:o.interactivity.modes.bubble.color;if(void 0===b)return;const s=b instanceof Array?Utils_1.Utils.itemFromArray(b):b;e.bubble.color=Utils_1.ColorUtils.colorToHsl(s)}}}exports.Bubbler=Bubbler;