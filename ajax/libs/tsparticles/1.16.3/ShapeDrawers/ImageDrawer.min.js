"use strict";var __awaiter=this&&this.__awaiter||function(e,t,a,i){return new(a||(a=Promise))(function(s,o){function r(e){try{l(i.next(e))}catch(e){o(e)}}function n(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a(function(e){e(t)})).then(r,n)}l((i=i.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ImageDrawer=void 0;const Utils_1=require("../Utils"),Enums_1=require("../Enums");class ImageDrawer{constructor(){this.images=[]}getImages(e){const t=this.images.filter(t=>t.id===e.id);return t.length?t[0]:(this.images.push({id:e.id,images:[]}),this.getImages(e))}addImage(e,t){const a=this.getImages(e);null==a||a.images.push(t)}init(e){var t;return __awaiter(this,void 0,void 0,function*(){const a=e.options.particles.shape;if(!Utils_1.Utils.isInArray(Enums_1.ShapeType.image,a.type)&&!Utils_1.Utils.isInArray(Enums_1.ShapeType.images,a.type))return;const i=null!==(t=a.options[Enums_1.ShapeType.images])&&void 0!==t?t:a.options[Enums_1.ShapeType.image];if(i instanceof Array)for(const t of i)yield this.loadImageShape(e,t);else yield this.loadImageShape(e,i)})}destroy(){this.images=[]}loadImageShape(e,t){return __awaiter(this,void 0,void 0,function*(){try{const a=t.replaceColor?yield Utils_1.Utils.downloadSvgImage(t.src):yield Utils_1.Utils.loadImage(t.src);this.addImage(e,a)}catch(e){console.log(`tsParticles error - ${t.src} not found`)}})}draw(e,t,a,i){var s,o;if(!e)return;const r=t.image,n=null===(s=null==r?void 0:r.data)||void 0===s?void 0:s.element;if(!n)return;const l=null!==(o=null==r?void 0:r.ratio)&&void 0!==o?o:1,d={x:-a,y:-a};(null==r?void 0:r.data.svgData)&&(null==r?void 0:r.replaceColor)||(e.globalAlpha=i),e.drawImage(n,d.x,d.y,2*a,2*a/l),(null==r?void 0:r.data.svgData)&&(null==r?void 0:r.replaceColor)||(e.globalAlpha=1)}}exports.ImageDrawer=ImageDrawer;