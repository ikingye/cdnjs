"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.EmitterInstance=void 0;const Utils_1=require("../../Utils"),Enums_1=require("../../Enums"),EmitterSize_1=require("./Options/Classes/EmitterSize");class EmitterInstance{constructor(t,i,e,s){var o,n,r;this.emitters=t,this.container=i,this.initialPosition=s,this.emitterOptions=Utils_1.Utils.deepExtend({},e),this.position=null!==(o=this.initialPosition)&&void 0!==o?o:this.calcPosition();let h=Utils_1.Utils.deepExtend({},this.emitterOptions.particles);void 0===h&&(h={}),void 0===h.move&&(h.move={}),void 0===h.move.direction&&(h.move.direction=this.emitterOptions.direction),this.particlesOptions=h,this.size=null!==(n=this.emitterOptions.size)&&void 0!==n?n:(()=>{const t=new EmitterSize_1.EmitterSize;return t.load({height:0,mode:Enums_1.SizeMode.percent,width:0}),t})(),this.lifeCount=null!==(r=this.emitterOptions.life.count)&&void 0!==r?r:-1,this.play()}play(){(this.lifeCount>0||!this.emitterOptions.life.count)&&(void 0===this.startInterval&&(this.startInterval=window.setInterval(()=>{this.emit()},1e3*this.emitterOptions.rate.delay)),this.lifeCount>0&&this.prepareToDie())}pause(){const t=this.startInterval;void 0!==t&&(clearInterval(t),delete this.startInterval)}resize(){const t=this.initialPosition;this.position=t&&Utils_1.Utils.isPointInside(t,this.container.canvas.size)?t:this.calcPosition()}prepareToDie(){var t;this.lifeCount>0&&void 0!==(null===(t=this.emitterOptions.life)||void 0===t?void 0:t.duration)&&window.setTimeout(()=>{var t;this.pause(),this.lifeCount--,this.lifeCount>0?(this.position=this.calcPosition(),window.setTimeout(()=>{this.play()},null!==(t=this.emitterOptions.life.delay)&&void 0!==t?t:0)):this.destroy()},1e3*this.emitterOptions.life.duration)}destroy(){this.emitters.removeEmitter(this)}calcPosition(){var t;const i=this.container,e=null!==(t=this.emitterOptions.position)&&void 0!==t?t:{x:100*Math.random(),y:100*Math.random()};return{x:e.x/100*i.canvas.size.width,y:e.y/100*i.canvas.size.height}}emit(){const t=this.container,i=this.position,e=this.size.mode===Enums_1.SizeMode.percent?t.canvas.size.width*this.size.width/100:this.size.width,s=this.size.mode===Enums_1.SizeMode.percent?t.canvas.size.height*this.size.height/100:this.size.height;for(let o=0;o<this.emitterOptions.rate.quantity;o++)t.particles.addParticle({x:i.x+e*(Math.random()-.5),y:i.y+s*(Math.random()-.5)},this.particlesOptions)}}exports.EmitterInstance=EmitterInstance;