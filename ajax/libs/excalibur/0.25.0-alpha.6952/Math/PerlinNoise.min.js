import{Random}from"./Random";import{Color}from"../Drawing/Color";import*as Util from"../Util/Util";function _lerp(t,r,e){return r+t*(e-r)}function _fade(t){return t*t*t*(t*(6*t-15)+10)}var PerlinGenerator=function(){function t(t){this._perm=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],this._p=new Uint8Array(512),this._defaultPerlinOptions={octaves:1,frequency:1,amplitude:1,persistance:.5},t=Util.extend({},this._defaultPerlinOptions,t),this.persistance=t.persistance,this.amplitude=t.amplitude,this.frequency=t.frequency,this.octaves=t.octaves,t.seed?this._random=new Random(t.seed):this._random=new Random,this._perm=this._random.shuffle(this._perm);for(var r=0;r<512;r++)this._p[r]=255&this._perm[r%256]}return t.prototype.noise=function(){for(var t=this.amplitude,r=this.frequency,e=0,i=0,o=0;o<this.octaves;o++){switch(arguments.length){case 1:e+=this._noise1d(arguments[0]*r)*t;break;case 2:e+=this._noise2d(arguments[0]*r,arguments[1]*r)*t;break;case 3:e+=this._noise3d(arguments[0]*r,arguments[1]*r,arguments[2]*r)*t;break;default:throw new Error("Invalid arguments for perlin noise")}i+=t,t*=this.persistance,r*=2}return e/i},t.prototype.sequence=function(t,r){r||(r=1/t);for(var e=new Array(t),i=0;i<t;i++)e[i]=this.noise(i*r);return e},t.prototype.grid=function(t,r,e){e||(e=1/Math.min(t,r));for(var i=new Array(t*r),o=0;o<r;o++)for(var n=0;n<t;n++)i[n+o*t]=this.noise(n*e,o*e);return i},t.prototype._gradient3d=function(t,r,e,i){var o=15&t,n=o<8?r:e,a=o<4?e:12===o||14===o?r:i;return(0==(1&o)?n:-n)+(0==(2&o)?a:-a)},t.prototype._gradient2d=function(t,r,e){var i=0==(1&t)?r:e;return 0==(2&t)?-i:i},t.prototype._gradient1d=function(t,r){return 0==(1&t)?-r:r},t.prototype._noise1d=function(t){var r=255&Math.floor(t);return(_lerp(_fade(t-=Math.floor(t)),this._gradient1d(this._p[r],t),this._gradient1d(this._p[r+1],t-1))+1)/2},t.prototype._noise2d=function(t,r){var e=255&Math.floor(t),i=255&Math.floor(r);t-=Math.floor(t),r-=Math.floor(r);var o=_fade(t),n=_fade(r),a=this._p[e]+i,s=this._p[e+1]+i;return(_lerp(n,_lerp(o,this._gradient2d(this._p[a],t,r),this._gradient2d(this._p[s],t-1,r)),_lerp(o,this._gradient2d(this._p[a+1],t,r-1),this._gradient2d(this._p[s+1],t-1,r-1)))+1)/2},t.prototype._noise3d=function(t,r,e){var i=255&Math.floor(t),o=255&Math.floor(r),n=255&Math.floor(e);t-=Math.floor(t),r-=Math.floor(r),e-=Math.floor(e);var a=_fade(t),s=_fade(r),h=_fade(e),p=this._p[i]+o,d=this._p[i+1]+o,_=this._p[p]+n,f=this._p[d]+n,l=this._p[p+1]+n,u=this._p[d+1]+n;return(_lerp(h,_lerp(s,_lerp(a,this._gradient3d(this._p[_],t,r,e),this._gradient3d(this._p[f],t-1,r,e)),_lerp(a,this._gradient3d(this._p[l],t,r-1,e),this._gradient3d(this._p[u],t-1,r-1,e))),_lerp(s,_lerp(a,this._gradient3d(this._p[_+1],t,r,e-1),this._gradient3d(this._p[f+1],t-1,r,e-1)),_lerp(a,this._gradient3d(this._p[l+1],t,r-1,e-1),this._gradient3d(this._p[u+1],t-1,r-1,e-1))))+1)/2},t}();export{PerlinGenerator};var PerlinDrawer2D=function(){function t(t,r){this.generator=t,this.colorFcn=r,r||(this.colorFcn=function(t){return t<125?Color.Black:Color.White})}return t.prototype.image=function(t,r){var e=document.createElement("img"),i=document.createElement("canvas");i.width=t,i.height=r;var o=i.getContext("2d");return this.draw(o,0,0,t,r),e.src=i.toDataURL(),e},t.prototype.draw=function(t,r,e,i,o){for(var n=this.generator.grid(i,o),a=t.getImageData(r,e,i,o),s=0;s<o;s++)for(var h=0;h<i;h++){var p=n[h+i*s],d=255&Math.floor(255*p),_=4*(h+s*a.width),f=this.colorFcn(d);a.data[_]=f.r,a.data[_+1]=f.g,a.data[_+2]=f.b,a.data[_+3]=Math.floor(255*f.a)}t.putImageData(a,r,e)},t}();export{PerlinDrawer2D};