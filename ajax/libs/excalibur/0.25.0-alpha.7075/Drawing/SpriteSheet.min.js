var __extends=this&&this.__extends||function(){var t=function(i,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&(t[e]=i[e])})(i,e)};return function(i,e){function r(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}}();import{Sprite}from"./Sprite";import{Animation}from"./Animation";import{Color}from"./Color";import*as Effects from"./SpriteEffects";import{Texture}from"../Resources/Texture";import{Logger}from"../Util/Log";import{TextAlign,BaseAlign}from"../Label";import{Configurable}from"../Configurable";var SpriteSheetImpl=function(){function t(t,i,e,r,s,n){var o=this;this.sprites=[],this.image=null,this.columns=0,this.rows=0,this.spWidth=0,this.spHeight=0,this.spacing=0;var a=!1;if(t instanceof Array?this.sprites=t:(!t||t instanceof Texture?(this.image=t,this.columns=i,this.rows=e,this.spWidth=r,this.spHeight=s,this.spacing=n||0):(this.columns=t.columns,this.rows=t.rows,this.spWidth=t.spWidth,this.spHeight=t.spHeight,this.image=t.image,this.spacing=t.spacing||0),this.sprites=new Array(this.columns*this.rows),a=!0),this.image instanceof Texture){var h=!1,p=!1;if(this.image.loaded.then(function(t){h=o.spWidth*o.columns>t.naturalWidth,p=o.spHeight*o.rows>t.naturalHeight}),h)throw new RangeError("SpriteSheet specified is wider, "+this.columns+" cols x "+this.spWidth+" pixels > "+this.image.image.naturalWidth+" pixels than image width");if(p)throw new RangeError("SpriteSheet specified is taller, "+this.rows+" rows x "+this.spHeight+" pixels > "+this.image.image.naturalHeight+" pixels than image height")}if(a)for(var l=0;l<this.rows;l++)for(var c=0;c<this.columns;c++)this.sprites[c+l*this.columns]=new Sprite(this.image,c*this.spWidth+this.spacing*c+this.spacing,l*this.spHeight+this.spacing*l+this.spacing,this.spWidth,this.spHeight)}return t.prototype.getAnimationByIndices=function(t,i,e){var r=this,s=i.map(function(t){return r.sprites[t]});return s=s.map(function(t){return t.clone()}),new Animation(t,s,e)},t.prototype.getAnimationBetween=function(t,i,e,r){var s=this.sprites.slice(i,e);return s=s.map(function(t){return t.clone()}),new Animation(t,s,r)},t.prototype.getAnimationForAll=function(t,i){var e=this.sprites.map(function(t){return t.clone()});return new Animation(t,e,i)},t.prototype.getSprite=function(t){if(t>=0&&t<this.sprites.length)return this.sprites[t];throw new Error("Invalid index: "+t)},t.prototype.getAnimationByCoords=function(t,i,e){for(var r=0,s=0,n=new Array(i.length),o=0;o<i.length;o++){var a=i[o];a.image=a.image||this.image,r=Math.max(r,a.drawWidth),s=Math.max(s,a.drawHeight),n[o]=new Sprite(a)}var h=new Animation(t,n,e);return h.drawWidth=r,h.drawHeight=s,h},t}();export{SpriteSheetImpl};var SpriteSheet=function(t){function i(i,e,r,s,n,o){return t.call(this,i,e,r,s,n,o)||this}return __extends(i,t),i}(Configurable(SpriteSheetImpl));export{SpriteSheet};var SpriteFontImpl=function(t){function i(i,e,r,s,n,o,a,h){var p=t.call(this,i instanceof Texture?{image:i,spWidth:o,spHeight:a,rows:n,columns:s,spacing:h||0}:i)||this;return p._currentColor=Color.Black,p._currentOpacity=1,p._sprites={},p._textShadowOn=!1,p._textShadowDirty=!0,p._textShadowColor=Color.Black,p._textShadowSprites={},p._shadowOffsetX=5,p._shadowOffsetY=5,!i||i instanceof Texture||(e=i.alphabet,r=i.caseInsensitive),p._alphabet=e,p._caseInsensitive=r,p._sprites=p.getTextSprites(),p}return __extends(i,t),i.prototype.getTextSprites=function(){for(var t={},i=0;i<this._alphabet.length;i++){var e=this._alphabet[i];this._caseInsensitive&&(e=e.toLowerCase()),t[e]=this.sprites[i].clone()}return t},i.prototype.setTextShadow=function(t,i,e){for(var r in this._textShadowOn=!0,this._shadowOffsetX=t,this._shadowOffsetY=i,this._textShadowColor=e.clone(),this._textShadowDirty=!0,this._sprites)this._textShadowSprites[r]=this._sprites[r].clone()},i.prototype.useTextShadow=function(t){this._textShadowOn=t,t&&this.setTextShadow(5,5,this._textShadowColor)},i.prototype.draw=function(t,i,e,r,s){if(s=this._parseOptions(s),this._currentColor.toString()!==s.color.toString()||this._currentOpacity!==s.opacity)for(var n in this._currentOpacity=s.opacity,this._currentColor=s.color,this._sprites)this._sprites[n].clearEffects(),this._sprites[n].fill(s.color),this._sprites[n].opacity(s.opacity);if(this._textShadowOn&&this._textShadowDirty&&this._textShadowColor){for(var o in this._textShadowSprites)this._textShadowSprites[o].clearEffects(),this._textShadowSprites[o].addEffect(new Effects.Fill(this._textShadowColor.clone()));this._textShadowDirty=!1}var a=this.sprites[0],h=a.drawHeight,p=s.fontSize/h,l=i.length*a.drawWidth*p+i.length*s.letterSpacing,c=e;s.textAlign===TextAlign.Left||s.textAlign===TextAlign.Start?c=e:s.textAlign===TextAlign.Right||s.textAlign===TextAlign.End?c=e-l:s.textAlign===TextAlign.Center&&(c=e-l/2);var g=r-h*p;s.baseAlign===BaseAlign.Top||s.baseAlign===BaseAlign.Hanging?g=r:s.baseAlign===BaseAlign.Ideographic||s.baseAlign===BaseAlign.Bottom||s.baseAlign===BaseAlign.Alphabetic?g=r-h*p:s.baseAlign===BaseAlign.Middle&&(g=r-h*p/2);for(var f=0;f<i.length;f++){var u=i[f];this._caseInsensitive&&(u=u.toLowerCase());try{this._textShadowOn&&(this._textShadowSprites[u].scale.x=p,this._textShadowSprites[u].scale.y=p,this._textShadowSprites[u].draw(t,c+this._shadowOffsetX,g+this._shadowOffsetY));var d=this._sprites[u];d.scale.x=p,d.scale.y=p,d.draw(t,c,g),c+=d.drawWidth+s.letterSpacing}catch(t){Logger.getInstance().error("SpriteFont Error drawing char "+u)}}},i.prototype._parseOptions=function(t){return{fontSize:t.fontSize||10,letterSpacing:t.letterSpacing||0,color:t.color||Color.Black,textAlign:void 0===typeof t.textAlign?TextAlign.Left:t.textAlign,baseAlign:void 0===typeof t.baseAlign?BaseAlign.Bottom:t.baseAlign,maxWidth:t.maxWidth||-1,opacity:t.opacity||0}},i}(SpriteSheet);export{SpriteFontImpl};var SpriteFont=function(t){function i(i,e,r,s,n,o,a,h){return t.call(this,i,e,r,s,n,o,a,h)||this}return __extends(i,t),i}(Configurable(SpriteFontImpl));export{SpriteFont};