var __extends=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}();import{Class}from"../Class";import{Promise}from"../Promises";import{Logger}from"../Util/Log";var Resource=function(t){function e(e,o,r){void 0===r&&(r=!0);var n=t.call(this)||this;return n.path=e,n.responseType=o,n.bustCache=r,n.data=null,n.logger=Logger.getInstance(),n.arrayBuffer=null,n.onprogress=function(){},n.oncomplete=function(){},n.onerror=function(){},n}return __extends(e,t),e.prototype.isLoaded=function(){return null!==this.data},e.prototype.wireEngine=function(t){},e.prototype._cacheBust=function(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t},e.prototype._start=function(){this.logger.debug("Started loading resource "+this.path)},e.prototype.load=function(){var t=this,e=new Promise;if(null!==this.data)return this.logger.debug("Already have data for resource",this.path),e.resolve(this.data),this.oncomplete(),e;var o=new XMLHttpRequest;return o.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),o.responseType=this.responseType,o.onloadstart=function(){t._start()},o.onprogress=this.onprogress,o.onerror=this.onerror,o.onload=function(){if(0!==o.status&&200!==o.status)return t.logger.error("Failed to load resource ",t.path," server responded with error code",o.status),t.onerror(o.response),void e.resolve(o.response);t.data=t.processData(o.response),t.oncomplete(),t.logger.debug("Completed loading resource",t.path),e.resolve(t.data)},o.send(),e},e.prototype.getData=function(){return this.data},e.prototype.getArrayData=function(){return this.arrayBuffer},e.prototype.setData=function(t){this.data=this.processData(t)},e.prototype.processData=function(t){return"blob"===this.responseType?URL.createObjectURL(t):t},e}(Class);export{Resource};