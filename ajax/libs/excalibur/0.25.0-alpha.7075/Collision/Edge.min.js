import{BoundingBox}from"./BoundingBox";import{CollisionJumpTable}from"./CollisionJumpTable";import{Circle}from"./Circle";import{ConvexPolygon}from"./ConvexPolygon";import{Vector,Projection,Line}from"../Algebra";import{Physics}from"../Physics";import{Color}from"../Drawing/Color";import{ClosestLineJumpTable}from"./ClosestLineJumpTable";var Edge=function(){function e(e){this.begin=e.begin||Vector.Zero,this.end=e.end||Vector.Zero,this.collider=e.collider||null,this.offset=this.center}return e.prototype.clone=function(){return new e({begin:this.begin.clone(),end:this.end.clone(),collider:null})},Object.defineProperty(e.prototype,"worldPos",{get:function(){return this.collider&&this.collider.body?this.collider.body.pos.add(this.offset):this.offset},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return this.begin.average(this.end).add(this._getBodyPos())},enumerable:!1,configurable:!0}),e.prototype._getBodyPos=function(){var e=Vector.Zero;return this.collider&&this.collider.body&&(e=this.collider.body.pos),e},e.prototype._getTransformedBegin=function(){var e=this.collider?this.collider.body:null,t=e?e.rotation:0;return this.begin.rotate(t).add(this._getBodyPos())},e.prototype._getTransformedEnd=function(){var e=this.collider?this.collider.body:null,t=e?e.rotation:0;return this.end.rotate(t).add(this._getBodyPos())},e.prototype.getSlope=function(){var e=this._getTransformedBegin(),t=this._getTransformedEnd(),o=e.distance(t);return t.sub(e).scale(1/o)},e.prototype.getLength=function(){var e=this._getTransformedBegin(),t=this._getTransformedEnd();return e.distance(t)},e.prototype.contains=function(){return!1},e.prototype.rayCast=function(e,t){void 0===t&&(t=1/0);var o=this._getTransformedBegin().sub(e.pos);if(0===e.dir.cross(this.getSlope())&&0!==o.cross(e.dir))return null;var n=e.dir.cross(this.getSlope());if(0===n)return null;var r=o.cross(this.getSlope())/n;if(r>=0&&r<=t){var i=o.cross(e.dir)/n/this.getLength();if(i>=0&&i<=1)return e.getPoint(r)}return null},e.prototype.getClosestLineBetween=function(t){if(t instanceof Circle)return ClosestLineJumpTable.CircleEdgeClosestLine(t,this);if(t instanceof ConvexPolygon)return ClosestLineJumpTable.PolygonEdgeClosestLine(t,this).flip();if(t instanceof e)return ClosestLineJumpTable.EdgeEdgeClosestLine(this,t);throw new Error("Polygon could not collide with unknown CollisionShape "+typeof t)},e.prototype.collide=function(t){if(t instanceof Circle)return CollisionJumpTable.CollideCircleEdge(t,this);if(t instanceof ConvexPolygon)return CollisionJumpTable.CollidePolygonEdge(t,this);if(t instanceof e)return CollisionJumpTable.CollideEdgeEdge();throw new Error("Edge could not collide with unknown CollisionShape "+typeof t)},e.prototype.getFurthestPoint=function(e){var t=this._getTransformedBegin(),o=this._getTransformedEnd();return e.dot(t)>0?t:o},e.prototype._boundsFromBeginEnd=function(e,t){return new BoundingBox(Math.min(e.x,t.x),Math.min(e.y,t.y),Math.max(e.x,t.x),Math.max(e.y,t.y))},Object.defineProperty(e.prototype,"bounds",{get:function(){var e=this._getTransformedBegin(),t=this._getTransformedEnd();return this._boundsFromBeginEnd(e,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"localBounds",{get:function(){return this._boundsFromBeginEnd(this.begin,this.end)},enumerable:!1,configurable:!0}),e.prototype.asLine=function(){return new Line(this._getTransformedBegin(),this._getTransformedEnd())},e.prototype.asLocalLine=function(){return new Line(this.begin,this.end)},Object.defineProperty(e.prototype,"axes",{get:function(){var e=this._getTransformedEnd().sub(this._getTransformedBegin()).normal(),t=[];return t.push(e),t.push(e.negate()),t.push(e.normal()),t.push(e.normal().negate()),t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"inertia",{get:function(){var e=this.collider?this.collider.mass:Physics.defaultMass,t=this.end.sub(this.begin).distance()/2;return e*t*t},enumerable:!1,configurable:!0}),e.prototype.recalc=function(){},e.prototype.project=function(e){for(var t=[],o=[this._getTransformedBegin(),this._getTransformedEnd()],n=o.length,r=0;r<n;r++)t.push(o[r].dot(e));return new Projection(Math.min.apply(Math,t),Math.max.apply(Math,t))},e.prototype.draw=function(e,t,o){void 0===t&&(t=Color.Green),void 0===o&&(o=Vector.Zero);var n=this.begin.add(o),r=this.end.add(o);e.strokeStyle=t.toString(),e.beginPath(),e.moveTo(n.x,n.y),e.lineTo(r.x,r.y),e.closePath(),e.stroke()},e.prototype.debugDraw=function(e,t){void 0===t&&(t=Color.Red);var o=this._getTransformedBegin(),n=this._getTransformedEnd();e.strokeStyle=t.toString(),e.beginPath(),e.moveTo(o.x,o.y),e.lineTo(n.x,n.y),e.closePath(),e.stroke()},e}();export{Edge};