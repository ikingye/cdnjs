var __decorate=this&&this.__decorate||function(t,s,i,e){var o,r=arguments.length,h=r<3?s:null===e?e=Object.getOwnPropertyDescriptor(s,i):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)h=Reflect.decorate(t,s,i,e);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(h=(r<3?o(h):r>3?o(s,i,h):o(s,i))||h);return r>3&&h&&Object.defineProperty(s,i,h),h};import{RotationType}from"./RotationType";import{Vector}from"../Algebra";import{Logger}from"../Util/Log";import*as Util from"../Util/Util";import{obsolete}from"../Util/Decorators";var EaseTo=function(){function t(t,s,i,e,o){this.actor=t,this.easingFcn=o,this._currentLerpTime=0,this._lerpDuration=1e3,this._lerpStart=new Vector(0,0),this._lerpEnd=new Vector(0,0),this._initialized=!1,this._stopped=!1,this._distance=0,this._lerpDuration=e,this._lerpEnd=new Vector(s,i)}return t.prototype._initialize=function(){this._lerpStart=new Vector(this.actor.pos.x,this.actor.pos.y),this._currentLerpTime=0,this._distance=this._lerpStart.distance(this._lerpEnd)},t.prototype.update=function(t){this._initialized||(this._initialize(),this._initialized=!0);var s=this.actor.pos.x,i=this.actor.pos.y;this._currentLerpTime<this._lerpDuration?(s=this._lerpEnd.x<this._lerpStart.x?this._lerpStart.x-(this.easingFcn(this._currentLerpTime,this._lerpEnd.x,this._lerpStart.x,this._lerpDuration)-this._lerpEnd.x):this.easingFcn(this._currentLerpTime,this._lerpStart.x,this._lerpEnd.x,this._lerpDuration),i=this._lerpEnd.y<this._lerpStart.y?this._lerpStart.y-(this.easingFcn(this._currentLerpTime,this._lerpEnd.y,this._lerpStart.y,this._lerpDuration)-this._lerpEnd.y):this.easingFcn(this._currentLerpTime,this._lerpStart.y,this._lerpEnd.y,this._lerpDuration),this.actor.pos.x=s,this.actor.pos.y=i,this._currentLerpTime+=t):(this.actor.pos.x=this._lerpEnd.x,this.actor.pos.y=this._lerpEnd.y)},t.prototype.isComplete=function(t){return this._stopped||new Vector(t.pos.x,t.pos.y).distance(this._lerpStart)>=this._distance},t.prototype.reset=function(){this._initialized=!1},t.prototype.stop=function(){this._stopped=!0},t}();export{EaseTo};var MoveTo=function(){function t(t,s,i,e){this._started=!1,this._stopped=!1,this._actor=t,this._end=new Vector(s,i),this._speed=e}return t.prototype.update=function(t){this._started||(this._started=!0,this._start=new Vector(this._actor.pos.x,this._actor.pos.y),this._distance=this._start.distance(this._end),this._dir=this._end.sub(this._start).normalize());var s=this._dir.scale(this._speed);this._actor.vel.x=s.x,this._actor.vel.y=s.y,this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.isComplete=function(t){return this._stopped||new Vector(t.pos.x,t.pos.y).distance(this._start)>=this._distance},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();export{MoveTo};var MoveBy=function(){function t(t,s,i,e){if(this._started=!1,this._stopped=!1,this._actor=t,this._speed=e,this._offset=new Vector(s,i),e<=0)throw Logger.getInstance().error("Attempted to moveBy with speed less than or equal to zero : "+e),new Error("Speed must be greater than 0 pixels per second")}return t.prototype.update=function(t){this._started||(this._started=!0,this._start=new Vector(this._actor.pos.x,this._actor.pos.y),this._end=this._start.add(this._offset),this._distance=this._offset.size,this._dir=this._end.sub(this._start).normalize()),this._actor.vel=this._dir.scale(this._speed),this.isComplete(this._actor)&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.isComplete=function(t){return this._stopped||t.pos.distance(this._start)>=this._distance},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();export{MoveBy};var Follow=function(){function t(t,s,i){this._started=!1,this._stopped=!1,this._actor=t,this._actorToFollow=s,this._current=new Vector(this._actor.pos.x,this._actor.pos.y),this._end=new Vector(s.pos.x,s.pos.y),this._maximumDistance=void 0!==i?i:this._current.distance(this._end),this._speed=0}return t.prototype.update=function(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());var s=Math.sqrt(Math.pow(this._actorToFollow.vel.x,2)+Math.pow(this._actorToFollow.vel.y,2));if(0!==s&&(this._speed=s),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToFollow.pos.x,this._end.y=this._actorToFollow.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize(),this._distanceBetween>=this._maximumDistance){var i=this._dir.scale(this._speed);this._actor.vel.x=i.x,this._actor.vel.y=i.y}else this._actor.vel.x=0,this._actor.vel.y=0;this.isComplete()&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.isComplete=function(){return this._stopped},t.prototype.reset=function(){this._started=!1},t}();export{Follow};var Meet=function(){function t(t,s,i){this._started=!1,this._stopped=!1,this._speedWasSpecified=!1,this._actor=t,this._actorToMeet=s,this._current=new Vector(this._actor.pos.x,this._actor.pos.y),this._end=new Vector(s.pos.x,s.pos.y),this._speed=i||0,void 0!==i&&(this._speedWasSpecified=!0)}return t.prototype.update=function(t){this._started||(this._started=!0,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize());var s=Math.sqrt(Math.pow(this._actorToMeet.vel.x,2)+Math.pow(this._actorToMeet.vel.y,2));0===s||this._speedWasSpecified||(this._speed=s),this._current.x=this._actor.pos.x,this._current.y=this._actor.pos.y,this._end.x=this._actorToMeet.pos.x,this._end.y=this._actorToMeet.pos.y,this._distanceBetween=this._current.distance(this._end),this._dir=this._end.sub(this._current).normalize();var i=this._dir.scale(this._speed);this._actor.vel.x=i.x,this._actor.vel.y=i.y,this.isComplete()&&(this._actor.pos.x=this._end.x,this._actor.pos.y=this._end.y,this._actor.vel.y=0,this._actor.vel.x=0)},t.prototype.isComplete=function(){return this._stopped||this._distanceBetween<=1},t.prototype.stop=function(){this._actor.vel.y=0,this._actor.vel.x=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();export{Meet};var RotateTo=function(){function t(t,s,i,e){this._started=!1,this._stopped=!1,this._actor=t,this._end=s,this._speed=i,this._rotationType=e||RotationType.ShortestPath}return t.prototype.update=function(t){if(!this._started){this._started=!0,this._start=this._actor.rotation;var s=Math.abs(this._end-this._start),i=Util.TwoPI-s;switch(s>i?(this._shortDistance=i,this._longDistance=s):(this._shortDistance=s,this._longDistance=i),this._shortestPathIsPositive=(this._start-this._end+Util.TwoPI)%Util.TwoPI>=Math.PI,this._rotationType){case RotationType.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case RotationType.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case RotationType.Clockwise:this._direction=1,this._shortestPathIsPositive?this._distance=this._shortDistance:this._distance=this._longDistance;break;case RotationType.CounterClockwise:this._direction=-1,this._shortestPathIsPositive?this._distance=this._longDistance:this._distance=this._shortDistance}}this._actor.rx=this._direction*this._speed,this.isComplete()&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)},t.prototype.isComplete=function(){var t=Math.abs(this._actor.rotation-this._start);return this._stopped||t>=Math.abs(this._distance)},t.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();export{RotateTo};var RotateBy=function(){function t(t,s,i,e){this._started=!1,this._stopped=!1,this._actor=t,this._speed=i,this._offset=s,this._rotationType=e||RotationType.ShortestPath}return t.prototype.update=function(t){if(!this._started){this._started=!0,this._start=this._actor.rotation,this._end=this._start+this._offset;var s=Math.abs(this._end-this._start),i=Util.TwoPI-s;switch(s>i?(this._shortDistance=i,this._longDistance=s):(this._shortDistance=s,this._longDistance=i),this._shortestPathIsPositive=(this._start-this._end+Util.TwoPI)%Util.TwoPI>=Math.PI,this._rotationType){case RotationType.ShortestPath:this._distance=this._shortDistance,this._shortestPathIsPositive?this._direction=1:this._direction=-1;break;case RotationType.LongestPath:this._distance=this._longDistance,this._shortestPathIsPositive?this._direction=-1:this._direction=1;break;case RotationType.Clockwise:this._direction=1,this._shortDistance>=0?this._distance=this._shortDistance:this._distance=this._longDistance;break;case RotationType.CounterClockwise:this._direction=-1,this._shortDistance<=0?this._distance=this._shortDistance:this._distance=this._longDistance}}this._actor.rx=this._direction*this._speed,this.isComplete()&&(this._actor.rotation=this._end,this._actor.rx=0,this._stopped=!0)},t.prototype.isComplete=function(){var t=Math.abs(this._actor.rotation-this._start);return this._stopped||t>=Math.abs(this._distance)},t.prototype.stop=function(){this._actor.rx=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();export{RotateBy};var ScaleTo=function(){function t(t,s,i,e,o){this._started=!1,this._stopped=!1,this._actor=t,this._endX=s,this._endY=i,this._speedX=e,this._speedY=o}return t.prototype.update=function(t){if(this._started||(this._started=!0,this._startX=this._actor.scale.x,this._startY=this._actor.scale.y,this._distanceX=Math.abs(this._endX-this._startX),this._distanceY=Math.abs(this._endY-this._startY)),Math.abs(this._actor.scale.x-this._startX)>=this._distanceX)this._actor.sx=0;else{var s=this._endY<this._startY?-1:1;this._actor.sx=this._speedX*s}if(Math.abs(this._actor.scale.y-this._startY)>=this._distanceY)this._actor.sy=0;else{var i=this._endY<this._startY?-1:1;this._actor.sy=this._speedY*i}this.isComplete()&&(this._actor.scale.x=this._endX,this._actor.scale.y=this._endY,this._actor.sx=0,this._actor.sy=0)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.scale.y-this._startX)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startY)>=this._distanceY},t.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t=__decorate([obsolete({message:"ex.Action.ScaleTo will be removed in v0.25.0",alternateMethod:"Set width and hight directly"})],t)}();export{ScaleTo};var ScaleBy=function(){function t(t,s,i,e){this._started=!1,this._stopped=!1,this._actor=t,this._offset=new Vector(s,i),this._speedX=this._speedY=e}return t.prototype.update=function(t){this._started||(this._started=!0,this._startScale=this._actor.scale.clone(),this._endScale=this._startScale.add(this._offset),this._distanceX=Math.abs(this._endScale.x-this._startScale.x),this._distanceY=Math.abs(this._endScale.y-this._startScale.y),this._directionX=this._endScale.x<this._startScale.x?-1:1,this._directionY=this._endScale.y<this._startScale.y?-1:1),this._actor.sx=this._speedX*this._directionX,this._actor.sy=this._speedY*this._directionY,this.isComplete()&&(this._actor.scale=this._endScale,this._actor.sx=0,this._actor.sy=0)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.scale.x-this._startScale.x)>=this._distanceX&&Math.abs(this._actor.scale.y-this._startScale.y)>=this._distanceY},t.prototype.stop=function(){this._actor.sx=0,this._actor.sy=0,this._stopped=!0},t.prototype.reset=function(){this._started=!1},t=__decorate([obsolete({message:"ex.Action.ScaleBy will be removed in v0.25.0",alternateMethod:"Set width and hight directly"})],t)}();export{ScaleBy};var Delay=function(){function t(t,s){this._elapsedTime=0,this._started=!1,this._stopped=!1,this._actor=t,this._delay=s}return t.prototype.update=function(t){this._started||(this._started=!0),this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._elapsedTime+=t},t.prototype.isComplete=function(){return this._stopped||this._elapsedTime>=this._delay},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._elapsedTime=0,this._started=!1},t}();export{Delay};var Blink=function(){function t(t,s,i,e){void 0===e&&(e=1),this._timeVisible=0,this._timeNotVisible=0,this._elapsedTime=0,this._totalTime=0,this._stopped=!1,this._started=!1,this._actor=t,this._timeVisible=s,this._timeNotVisible=i,this._duration=(s+i)*e}return t.prototype.update=function(t){this._started||(this._started=!0),this._elapsedTime+=t,this._totalTime+=t,this._actor.visible&&this._elapsedTime>=this._timeVisible&&(this._actor.visible=!1,this._elapsedTime=0),!this._actor.visible&&this._elapsedTime>=this._timeNotVisible&&(this._actor.visible=!0,this._elapsedTime=0),this.isComplete()&&(this._actor.visible=!0)},t.prototype.isComplete=function(){return this._stopped||this._totalTime>=this._duration},t.prototype.stop=function(){this._actor.visible=!0,this._stopped=!0},t.prototype.reset=function(){this._started=!1,this._elapsedTime=0,this._totalTime=0},t}();export{Blink};var Fade=function(){function t(t,s,i){this._multiplier=1,this._started=!1,this._stopped=!1,this._actor=t,this._endOpacity=s,this._speed=i}return t.prototype.update=function(t){this._started||(this._started=!0,this._endOpacity<this._actor.opacity?this._multiplier=-1:this._multiplier=1),this._speed>0&&(this._actor.opacity+=this._multiplier*(Math.abs(this._actor.opacity-this._endOpacity)*t)/this._speed),this._speed-=t,this.isComplete()&&(this._actor.opacity=this._endOpacity),Logger.getInstance().debug("[Action fade] Actor opacity:",this._actor.opacity)},t.prototype.isComplete=function(){return this._stopped||Math.abs(this._actor.opacity-this._endOpacity)<.05},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._started=!1},t}();export{Fade};var Die=function(){function t(t){this._stopped=!1,this._actor=t}return t.prototype.update=function(t){this._actor.actionQueue.clearActions(),this._actor.kill(),this._stopped=!0},t.prototype.isComplete=function(){return this._stopped},t.prototype.stop=function(){},t.prototype.reset=function(){},t}();export{Die};var CallMethod=function(){function t(t,s){this._method=null,this._actor=null,this._hasBeenCalled=!1,this._actor=t,this._method=s}return t.prototype.update=function(t){this._method.call(this._actor),this._hasBeenCalled=!0},t.prototype.isComplete=function(){return this._hasBeenCalled},t.prototype.reset=function(){this._hasBeenCalled=!1},t.prototype.stop=function(){this._hasBeenCalled=!0},t}();export{CallMethod};var Repeat=function(){function t(t,s,i){this._stopped=!1,this._actor=t,this._actionQueue=new ActionQueue(t),this._repeat=s,this._originalRepeat=s;for(var e=i.length,o=0;o<e;o++)i[o].reset(),this._actionQueue.add(i[o])}return t.prototype.update=function(t){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._actionQueue.hasNext()||(this._actionQueue.reset(),this._repeat--),this._actionQueue.update(t)},t.prototype.isComplete=function(){return this._stopped||this._repeat<=0},t.prototype.stop=function(){this._stopped=!0},t.prototype.reset=function(){this._repeat=this._originalRepeat},t}();export{Repeat};var RepeatForever=function(){function t(t,s){this._stopped=!1,this._actor=t,this._actionQueue=new ActionQueue(t);for(var i=s.length,e=0;e<i;e++)s[e].reset(),this._actionQueue.add(s[e])}return t.prototype.update=function(t){this.x=this._actor.pos.x,this.y=this._actor.pos.y,this._stopped||(this._actionQueue.hasNext()||this._actionQueue.reset(),this._actionQueue.update(t))},t.prototype.isComplete=function(){return this._stopped},t.prototype.stop=function(){this._stopped=!0,this._actionQueue.clearActions()},t.prototype.reset=function(){},t}();export{RepeatForever};var ActionQueue=function(){function t(t){this._actions=[],this._completedActions=[],this._actor=t}return t.prototype.add=function(t){this._actions.push(t)},t.prototype.remove=function(t){var s=this._actions.indexOf(t);this._actions.splice(s,1)},t.prototype.clearActions=function(){this._actions.length=0,this._completedActions.length=0,this._currentAction&&this._currentAction.stop()},t.prototype.getActions=function(){return this._actions.concat(this._completedActions)},t.prototype.hasNext=function(){return this._actions.length>0},t.prototype.reset=function(){this._actions=this.getActions();for(var t=this._actions.length,s=0;s<t;s++)this._actions[s].reset();this._completedActions=[]},t.prototype.update=function(t){this._actions.length>0&&(this._currentAction=this._actions[0],this._currentAction.update(t),this._currentAction.isComplete(this._actor)&&this._completedActions.push(this._actions.shift()))},t}();export{ActionQueue};