var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};import{Vector}from"./Algebra";import{Logger}from"./Util/Log";import{BoundingBox}from"./Collision/Index";export var DisplayMode;!function(t){t.FullScreen="FullScreen",t.Container="Container",t.Fixed="Fixed",t.Position="Position"}(DisplayMode||(DisplayMode={}));var Resolution=function(){function t(){}return Object.defineProperty(t,"SVGA",{get:function(){return{width:800,height:600}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Standard",{get:function(){return{width:1920,height:1080}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"Atari2600",{get:function(){return{width:160,height:192}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"GameBoy",{get:function(){return{width:160,height:144}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"GameBoyAdvance",{get:function(){return{width:240,height:160}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"NintendoDS",{get:function(){return{width:256,height:192}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"NES",{get:function(){return{width:256,height:224}},enumerable:!1,configurable:!0}),Object.defineProperty(t,"SNES",{get:function(){return{width:256,height:244}},enumerable:!1,configurable:!0}),t}();export{Resolution};var Screen=function(){function t(t){var e,i,o,n=this;this._antialiasing=!0,this._resolutionStack=[],this._viewportStack=[],this._pixelRatio=null,this._isFullScreen=!1,this._isDisposed=!1,this._logger=Logger.getInstance(),this._pixelRatioChangeHandler=function(){n._logger.debug("Pixel Ratio Change",window.devicePixelRatio),n.applyResolutionAndViewport()},this._windowResizeHandler=function(){var t=n.displayMode===DisplayMode.Container?n.canvas.parentElement||document.body:window;n._logger.debug("View port resized"),n._setHeightByDisplayMode(t),n._logger.info("parent.clientHeight "+t.clientHeight),n.applyResolutionAndViewport()},this.viewport=t.viewport,this.resolution=null!==(e=t.resolution)&&void 0!==e?e:__assign({},this.viewport),this._displayMode=null!==(i=t.displayMode)&&void 0!==i?i:DisplayMode.Fixed,this._canvas=t.canvas,this._ctx=t.context,this._antialiasing=null!==(o=t.antialiasing)&&void 0!==o?o:this._antialiasing,this._browser=t.browser,this._position=t.position,this._pixelRatio=t.pixelRatio,this._applyDisplayMode(),this._mediaQueryList=this._browser.window.nativeComponent.matchMedia("(resolution: "+window.devicePixelRatio+"dppx)"),this._mediaQueryList.addEventListener("change",this._pixelRatioChangeHandler)}return t.prototype.dispose=function(){this._isDisposed||(this._isDisposed=!0,this._browser.window.off("resize",this._windowResizeHandler),this._mediaQueryList.removeEventListener("change",this._pixelRatioChangeHandler))},Object.defineProperty(t.prototype,"pixelRatio",{get:function(){return this._pixelRatio?this._pixelRatio:window.devicePixelRatio<1?1:window.devicePixelRatio||1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isHiDpi",{get:function(){return 1!==this.pixelRatio},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"displayMode",{get:function(){return this._displayMode},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resolution",{get:function(){return this._resolution},set:function(t){this._resolution=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"viewport",{get:function(){return this._viewport?this._viewport:this._resolution},set:function(t){this._viewport=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaledWidth",{get:function(){return this._resolution.width*this.pixelRatio},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scaledHeight",{get:function(){return this._resolution.height*this.pixelRatio},enumerable:!1,configurable:!0}),t.prototype.setCurrentCamera=function(t){this._camera=t},t.prototype.pushResolutionAndViewport=function(){this._resolutionStack.push(this.resolution),this._viewportStack.push(this.viewport),this.resolution=__assign({},this.resolution),this.viewport=__assign({},this.viewport)},t.prototype.popResolutionAndViewport=function(){this.resolution=this._resolutionStack.pop(),this.viewport=this._viewportStack.pop()},t.prototype.applyResolutionAndViewport=function(){this._canvas.width=this.scaledWidth,this._canvas.height=this.scaledHeight,this._canvas.style.imageRendering=this._antialiasing?"auto":"pixelated",this._canvas.style.width=this.viewport.width+"px",this._canvas.style.height=this.viewport.height+"px",this._ctx.resetTransform(),this._ctx.scale(this.pixelRatio,this.pixelRatio),this._ctx.imageSmoothingEnabled=this._antialiasing},Object.defineProperty(t.prototype,"antialiasing",{get:function(){return this._antialiasing},set:function(t){this._antialiasing=t,this._ctx.imageSmoothingEnabled=this._antialiasing},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isFullScreen",{get:function(){return this._isFullScreen},enumerable:!1,configurable:!0}),t.prototype.goFullScreen=function(){var t=this;return this._canvas.requestFullscreen().then(function(){t._isFullScreen=!0})},t.prototype.exitFullScreen=function(){var t=this;return document.exitFullscreen().then(function(){t._isFullScreen=!1})},t.prototype.screenToWorldCoordinates=function(t){var e,i,o,n,r=t.x,s=t.y;return r=r/this.viewport.width*this.drawWidth,s=s/this.viewport.height*this.drawHeight,r-=this.halfDrawWidth,s-=this.halfDrawHeight,r+=null!==(i=null===(e=this._camera)||void 0===e?void 0:e.x)&&void 0!==i?i:0,s+=null!==(n=null===(o=this._camera)||void 0===o?void 0:o.y)&&void 0!==n?n:0,new Vector(Math.floor(r),Math.floor(s))},t.prototype.worldToScreenCoordinates=function(t){var e,i,o,n,r=t.x,s=t.y;return r-=null!==(i=null===(e=this._camera)||void 0===e?void 0:e.x)&&void 0!==i?i:0,s-=null!==(n=null===(o=this._camera)||void 0===o?void 0:o.y)&&void 0!==n?n:0,r+=this.halfDrawWidth,s+=this.halfDrawHeight,r=r*this.viewport.width/this.drawWidth,s=s*this.viewport.height/this.drawHeight,new Vector(Math.floor(r),Math.floor(s))},t.prototype.getWorldBounds=function(){var t=this.screenToWorldCoordinates(Vector.Zero).x,e=this.screenToWorldCoordinates(Vector.Zero).y,i=t+this.drawWidth,o=e+this.drawHeight;return new BoundingBox(t,e,i,o)},Object.defineProperty(t.prototype,"canvasWidth",{get:function(){return this.canvas.width},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfCanvasWidth",{get:function(){return this.canvas.width/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"canvasHeight",{get:function(){return this.canvas.height},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfCanvasHeight",{get:function(){return this.canvas.height/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"drawWidth",{get:function(){return this._camera?this.scaledWidth/this._camera.z/this.pixelRatio:this.scaledWidth/this.pixelRatio},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfDrawWidth",{get:function(){return this.drawWidth/2},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"drawHeight",{get:function(){return this._camera?this.scaledHeight/this._camera.z/this.pixelRatio:this.scaledHeight/this.pixelRatio},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"halfDrawHeight",{get:function(){return this.drawHeight/2},enumerable:!1,configurable:!0}),t.prototype._applyDisplayMode=function(){if(this.displayMode===DisplayMode.FullScreen||this.displayMode===DisplayMode.Container){var t=this.displayMode===DisplayMode.Container?this.canvas.parentElement||document.body:window;this._setHeightByDisplayMode(t),this._browser.window.on("resize",this._windowResizeHandler)}else this.displayMode===DisplayMode.Position&&this._initializeDisplayModePosition(this._position)},t.prototype._setHeightByDisplayMode=function(t){this.displayMode===DisplayMode.Container&&(this.resolution={width:t.clientWidth,height:t.clientHeight},this.viewport=this.resolution),this.displayMode===DisplayMode.FullScreen&&(document.body.style.margin="0px",document.body.style.overflow="hidden",this.resolution={width:t.innerWidth,height:t.innerHeight},this.viewport=this.resolution)},t.prototype._initializeDisplayModePosition=function(t){if(!t)throw new Error("DisplayMode of Position was selected but no position option was given");if(this.canvas.style.display="block",this.canvas.style.position="absolute","string"==typeof t){var e=t.split(" ");switch(e[0]){case"top":this.canvas.style.top="0px";break;case"bottom":this.canvas.style.bottom="0px";break;case"middle":this.canvas.style.top="50%";var i=-this.halfDrawHeight;this.canvas.style.marginTop=i.toString();break;default:throw new Error("Invalid Position Given")}if(e[1])switch(e[1]){case"left":this.canvas.style.left="0px";break;case"right":this.canvas.style.right="0px";break;case"center":this.canvas.style.left="50%";var o=-this.halfDrawWidth;this.canvas.style.marginLeft=o.toString();break;default:throw new Error("Invalid Position Given")}}else t.top&&("number"==typeof t.top?this.canvas.style.top=t.top.toString()+"px":this.canvas.style.top=t.top),t.right&&("number"==typeof t.right?this.canvas.style.right=t.right.toString()+"px":this.canvas.style.right=t.right),t.bottom&&("number"==typeof t.bottom?this.canvas.style.bottom=t.bottom.toString()+"px":this.canvas.style.bottom=t.bottom),t.left&&("number"==typeof t.left?this.canvas.style.left=t.left.toString()+"px":this.canvas.style.left=t.left)},t}();export{Screen};