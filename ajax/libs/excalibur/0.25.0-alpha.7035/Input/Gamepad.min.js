var __extends=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();import{Class}from"./../Class";import{GamepadConnectEvent,GamepadDisconnectEvent,GamepadButtonEvent,GamepadAxisEvent}from"../Events";var Gamepads=function(t){function e(){var e=t.call(this)||this;return e.enabled=!1,e.supported=!!navigator.getGamepads,e._gamePadTimeStamps=[0,0,0,0],e._oldPads=[],e._pads=[],e._initSuccess=!1,e._navigator=navigator,e._minimumConfiguration=null,e}return __extends(e,t),e.prototype.init=function(){this.supported&&(this._initSuccess||(this._oldPads=this._clonePads(this._navigator.getGamepads()),this._oldPads.length&&this._oldPads[0]&&(this._initSuccess=!0)))},e.prototype.setMinimumGamepadConfiguration=function(t){this._enableAndUpdate(),this._minimumConfiguration=t},e.prototype._enableAndUpdate=function(){this.enabled||(this.enabled=!0,this.update())},e.prototype._isGamepadValid=function(t){if(!this._minimumConfiguration)return!0;if(!t)return!1;var e=t.axes.filter(function(t){return void 0!==typeof t}).length,n=t.buttons.filter(function(t){return void 0!==typeof t}).length;return e>=this._minimumConfiguration.axis&&n>=this._minimumConfiguration.buttons&&t.connected},e.prototype.on=function(e,n){this._enableAndUpdate(),t.prototype.on.call(this,e,n)},e.prototype.off=function(e,n){this._enableAndUpdate(),t.prototype.off.call(this,e,n)},e.prototype.update=function(){if(this.enabled&&this.supported){this.init();for(var t=this._navigator.getGamepads(),e=0;e<t.length;e++)if(t[e]){if(!this.at(e).connected&&this._isGamepadValid(t[e])&&this.eventDispatcher.emit("connect",new GamepadConnectEvent(e,this.at(e))),this.at(e).connected=!0,!t[e].timestamp||t[e].timestamp!==this._gamePadTimeStamps[e]){this._gamePadTimeStamps[e]=t[e].timestamp,this.at(e).navigatorGamepad=t[e];var n=void 0,i=void 0,a=void 0,o=void 0,s=void 0;for(n in Buttons)"number"==typeof(i=Buttons[n])&&t[e].buttons[i]&&(s=t[e].buttons[i].value)!==this._oldPads[e].getButton(i)&&(t[e].buttons[i].pressed?(this.at(e).updateButton(i,s),this.at(e).eventDispatcher.emit("button",new GamepadButtonEvent(i,s,this.at(e)))):this.at(e).updateButton(i,0));for(a in Axes)"number"==typeof(o=Axes[a])&&(s=t[e].axes[o])!==this._oldPads[e].getAxes(o)&&(this.at(e).updateAxes(o,s),this.at(e).eventDispatcher.emit("axis",new GamepadAxisEvent(o,s,this.at(e))));this._oldPads[e]=this._clonePad(t[e])}}else{var r=this.at(e);r.connected&&this.eventDispatcher.emit("disconnect",new GamepadDisconnectEvent(e,r)),r.connected=!1}}},e.prototype.at=function(t){if(this._enableAndUpdate(),t>=this._pads.length)for(var e=this._pads.length-1,n=t;e<n;e++)this._pads.push(new Gamepad),this._oldPads.push(new Gamepad);return this._pads[t]},e.prototype.getValidGamepads=function(){this._enableAndUpdate();for(var t=[],e=0;e<this._pads.length;e++)this._isGamepadValid(this.at(e).navigatorGamepad)&&this.at(e).connected&&t.push(this.at(e));return t},e.prototype.count=function(){return this._pads.filter(function(t){return t.connected}).length},e.prototype._clonePads=function(t){for(var e=[],n=0,i=t.length;n<i;n++)e.push(this._clonePad(t[n]));return e},e.prototype._clonePad=function(t){var e,n,i=new Gamepad;if(!t)return i;for(e=0,n=t.buttons.length;e<n;e++)t.buttons[e]&&i.updateButton(e,t.buttons[e].value);for(e=0,n=t.axes.length;e<n;e++)i.updateAxes(e,t.axes[e]);return i},e.MinAxisMoveThreshold=.05,e}(Class);export{Gamepads};var Gamepad=function(t){function e(){var e=t.call(this)||this;e.connected=!1,e._buttons=new Array(16),e._axes=new Array(4);for(var n=0;n<e._buttons.length;n++)e._buttons[n]=0;for(n=0;n<e._axes.length;n++)e._axes[n]=0;return e}return __extends(e,t),e.prototype.isButtonPressed=function(t,e){return void 0===e&&(e=1),this._buttons[t]>=e},e.prototype.getButton=function(t){return this._buttons[t]},e.prototype.getAxes=function(t){var e=this._axes[t];return Math.abs(e)<Gamepads.MinAxisMoveThreshold?0:e},e.prototype.updateButton=function(t,e){this._buttons[t]=e},e.prototype.updateAxes=function(t,e){this._axes[t]=e},e}(Class);export{Gamepad};export var Buttons;!function(t){t[t.Face1=0]="Face1",t[t.Face2=1]="Face2",t[t.Face3=2]="Face3",t[t.Face4=3]="Face4",t[t.LeftBumper=4]="LeftBumper",t[t.RightBumper=5]="RightBumper",t[t.LeftTrigger=6]="LeftTrigger",t[t.RightTrigger=7]="RightTrigger",t[t.Select=8]="Select",t[t.Start=9]="Start",t[t.LeftStick=10]="LeftStick",t[t.RightStick=11]="RightStick",t[t.DpadUp=12]="DpadUp",t[t.DpadDown=13]="DpadDown",t[t.DpadLeft=14]="DpadLeft",t[t.DpadRight=15]="DpadRight"}(Buttons||(Buttons={}));export var Axes;!function(t){t[t.LeftStickX=0]="LeftStickX",t[t.LeftStickY=1]="LeftStickY",t[t.RightStickX=2]="RightStickX",t[t.RightStickY=3]="RightStickY"}(Axes||(Axes={}));