var __extends=this&&this.__extends||function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function o(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(o.prototype=r.prototype,new o)}}();import{Class}from"../Class";import{Promise}from"../Promises";import{Logger}from"../Util/Log";var Resource=function(t){function e(e,r,o){void 0===o&&(o=!0);var n=t.call(this)||this;return n.path=e,n.responseType=r,n.bustCache=o,n.data=null,n.logger=Logger.getInstance(),n.arrayBuffer=null,n.onprogress=function(){},n.oncomplete=function(){},n.onerror=function(){},n}return __extends(e,t),e.prototype.isLoaded=function(){return null!==this.data},e.prototype.wireEngine=function(t){},e.prototype._cacheBust=function(t){return/\?\w*=\w*/.test(t)?t+="&__="+Date.now():t+="?__="+Date.now(),t},e.prototype._start=function(){this.logger.debug("Started loading resource "+this.path)},e.prototype.load=function(){var t=this,e=new Promise;if(null!==this.data)return this.logger.debug("Already have data for resource",this.path),e.resolve(this.data),this.oncomplete(),e;var r=new XMLHttpRequest;return r.open("GET",this.bustCache?this._cacheBust(this.path):this.path,!0),r.responseType=this.responseType,r.onloadstart=function(){t._start()},r.onprogress=this.onprogress,r.onerror=this.onerror,r.onload=function(){if(0!==r.status&&200!==r.status)return t.logger.error("Failed to load resource ",t.path," server responded with error code",r.status),t.onerror(r.response),void e.resolve(r.response);t.data=t.processData(r.response),t.oncomplete(),t.logger.debug("Completed loading resource",t.path),e.resolve(t.data)},r.send(),e},e.prototype.getData=function(){return this.data},e.prototype.getArrayData=function(){return this.arrayBuffer},e.prototype.setData=function(t){this.data=this.processData(t)},e.prototype.processData=function(t){return"blob"===this.responseType?URL.createObjectURL(t):t},e}(Class);export{Resource};