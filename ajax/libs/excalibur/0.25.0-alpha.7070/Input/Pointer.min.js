var __extends=this&&this.__extends||function(){var t=function(o,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])})(o,r)};return function(o,r){function e(){this.constructor=o}t(o,r),o.prototype=null===r?Object.create(r):(e.prototype=r.prototype,new e)}}(),__spreadArrays=this&&this.__spreadArrays||function(){for(var t=0,o=0,r=arguments.length;o<r;o++)t+=arguments[o].length;var e=Array(t),n=0;for(o=0;o<r;o++)for(var s=arguments[o],i=0,a=s.length;i<a;i++,n++)e[n]=s[i];return e};import{Vector}from"../Algebra";import{Class}from"../Class";import*as Actors from"../Util/Actors";import{removeItemFromArray}from"../Util/Util";export var PointerType;!function(t){t.Touch="Touch",t.Mouse="Mouse",t.Pen="Pen",t.Unknown="Unknown"}(PointerType||(PointerType={}));export var PointerScope;!function(t){t.Canvas="Canvas",t.Document="Document"}(PointerScope||(PointerScope={}));var Pointer=function(t){function o(){var r=t.call(this)||this;return r.id=o._MAX_ID++,r._isDown=!1,r._wasDown=!1,r._actorsUnderPointer={length:0},r._actors=[],r._actorsLastFrame=[],r._actorsNoLongerUnderPointer=[],r.lastPagePos=null,r.lastScreenPos=null,r.lastWorldPos=null,r.dragTarget=null,r.on("move",r._onPointerMove),r.on("down",r._onPointerDown),r.on("up",r._onPointerUp),r}return __extends(o,t),Object.defineProperty(o.prototype,"isDragging",{get:function(){return this._isDown},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isDragStart",{get:function(){return!this._wasDown&&this._isDown},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"isDragEnd",{get:function(){return this._wasDown&&!this._isDown},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"hasActorsUnderPointer",{get:function(){return!!this._actorsUnderPointer.length},enumerable:!1,configurable:!0}),o.prototype.on=function(o,r){t.prototype.on.call(this,o,r)},o.prototype.once=function(o,r){t.prototype.once.call(this,o,r)},o.prototype.off=function(o,r){t.prototype.off.call(this,o,r)},o.prototype.update=function(){this._wasDown&&!this._isDown?this._wasDown=!1:!this._wasDown&&this._isDown&&(this._wasDown=!0),this._actorsLastFrame=__spreadArrays(this._actors),this._actorsNoLongerUnderPointer=[]},o.prototype.addActorUnderPointer=function(t){this.isActorAliveUnderPointer(t)||(this._actorsUnderPointer[t.id]=t,this._actorsUnderPointer.length+=1,this._actors.push(t)),this._actors.sort(function(t,o){return t.z===o.z?t.id-o.id:t.z-o.z})},o.prototype.removeActorUnderPointer=function(t){this.isActorAliveUnderPointer(t)&&(delete this._actorsUnderPointer[t.id],this._actorsUnderPointer.length-=1,removeItemFromArray(t,this._actors),this._actorsNoLongerUnderPointer.push(t))},o.prototype.getActorsUnderPointer=function(){return this._actors},o.prototype.getActorsUnderPointerLastFrame=function(){return this._actorsLastFrame},o.prototype.getActorsForEvents=function(){return this._actors.concat(this._actorsLastFrame).filter(function(t,o,r){return r.indexOf(t)===o})},o.prototype.checkActorUnderPointer=function(t){return!!this.lastWorldPos&&t.contains(this.lastWorldPos.x,this.lastWorldPos.y,!Actors.isScreenElement(t))},o.prototype.wasActorUnderPointer=function(t){return this._actorsLastFrame.indexOf(t)>-1},o.prototype.isActorAliveUnderPointer=function(t){return!(t.isKilled()||!t.scene||!this._actorsUnderPointer.hasOwnProperty(t.id.toString()))},o.prototype._onPointerMove=function(t){this.lastPagePos=new Vector(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new Vector(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new Vector(t.worldPos.x,t.worldPos.y)},o.prototype._onPointerDown=function(t){this.lastPagePos=new Vector(t.pagePos.x,t.pagePos.y),this.lastScreenPos=new Vector(t.screenPos.x,t.screenPos.y),this.lastWorldPos=new Vector(t.worldPos.x,t.worldPos.y),this._isDown=!0},o.prototype._onPointerUp=function(t){this._isDown=!1,this.dragTarget=null},o._MAX_ID=0,o}(Class);export{Pointer};