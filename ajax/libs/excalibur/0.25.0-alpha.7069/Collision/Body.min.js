import{Vector}from"../Algebra";import{CollisionType}from"./CollisionType";import{Physics}from"../Physics";import{PreCollisionEvent,PostCollisionEvent,CollisionStartEvent,CollisionEndEvent}from"../Events";import{Shape}from"./Shape";var Body=function(){function t(t){var o=t.actor,e=t.collider;if(this.pos=new Vector(0,0),this.oldPos=new Vector(0,0),this.vel=new Vector(0,0),this.oldVel=new Vector(0,0),this.acc=new Vector(0,0),this.oldAcc=Vector.Zero,this.torque=0,this.motion=10,this.oldRotation=0,this.rotation=0,this.scale=Vector.One,this.oldScale=Vector.One,this.sx=0,this.sy=0,this.rx=0,this._geometryDirty=!1,this._totalMtv=Vector.Zero,!o&&!e)throw new Error("An actor or collider are required to create a body");this.actor=o,this.collider=!e&&o?this.useBoxCollider(o.width,o.height,o.anchor):e}return Object.defineProperty(t.prototype,"id",{get:function(){return this.actor?this.actor.id:-1},enumerable:!1,configurable:!0}),t.prototype.clone=function(){return new t({actor:null,collider:this.collider.clone()})},Object.defineProperty(t.prototype,"active",{get:function(){return!!this.actor&&!this.actor.isKilled()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"center",{get:function(){return this.pos},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"collider",{get:function(){return this._collider},set:function(t){t&&(this._collider=t,this._collider.body=this,this._wireColliderEventsToActor())},enumerable:!1,configurable:!0}),t.prototype.addMtv=function(t){this._totalMtv.addEqual(t)},t.prototype.applyMtv=function(){this.pos.addEqual(this._totalMtv),this._totalMtv.setTo(0,0)},t.prototype.markCollisionShapeDirty=function(){this._geometryDirty=!0},Object.defineProperty(t.prototype,"isColliderShapeDirty",{get:function(){return this._geometryDirty},enumerable:!1,configurable:!0}),t.prototype.captureOldTransform=function(){this.oldVel.setTo(this.vel.x,this.vel.y),this.oldPos.setTo(this.pos.x,this.pos.y),this.oldAcc.setTo(this.acc.x,this.acc.y),this.oldScale.setTo(this.scale.x,this.scale.y),this.oldRotation=this.rotation},t.prototype.integrate=function(t){var o=t/1e3,e=this.acc.clone();this.collider.type===CollisionType.Active&&e.addEqual(Physics.acc),this.vel.addEqual(e.scale(o)),this.pos.addEqual(this.vel.scale(o)).addEqual(e.scale(.5*o*o)),this.rx+=this.torque*(1/this.collider.inertia)*o,this.rotation+=this.rx*o,this.scale.x+=this.sx*t/1e3,this.scale.y+=this.sy*t/1e3,this.scale.equals(this.oldScale)||(this._geometryDirty=!0),this.collider.update(),this._geometryDirty=!1},t.prototype.useBoxCollider=function(t,o,e,i){return void 0===e&&(e=Vector.Half),void 0===i&&(i=Vector.Zero),null==t&&(t=this.actor?this.actor.width:0),null==o&&(o=this.actor?this.actor.height:0),this.collider.shape=Shape.Box(t,o,e,i),this.collider},t.prototype.usePolygonCollider=function(t,o){return void 0===o&&(o=Vector.Zero),this.collider.shape=Shape.Polygon(t,!1,o),this.collider},t.prototype.useCircleCollider=function(t,o){return void 0===o&&(o=Vector.Zero),this.collider.shape=Shape.Circle(t,o),this.collider},t.prototype.useEdgeCollider=function(t,o){return this.collider.shape=Shape.Edge(t,o),this.collider},t.prototype._wireColliderEventsToActor=function(){var t=this;this.collider.clear(),this.collider.on("precollision",function(o){t.actor&&t.actor.emit("precollision",new PreCollisionEvent(o.target.body.actor,o.other.body.actor,o.side,o.intersection))}),this.collider.on("postcollision",function(o){t.actor&&t.actor.emit("postcollision",new PostCollisionEvent(o.target.body.actor,o.other.body.actor,o.side,o.intersection))}),this.collider.on("collisionstart",function(o){t.actor&&t.actor.emit("collisionstart",new CollisionStartEvent(o.target.body.actor,o.other.body.actor,o.pair))}),this.collider.on("collisionend",function(o){t.actor&&t.actor.emit("collisionend",new CollisionEndEvent(o.target.body.actor,o.other.body.actor))})},t}();export{Body};