!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t=t||self).popmotion={})}(this,function(t){"use strict";var D=function(){return(D=Object.assign||function(t){for(var r,n=1,e=arguments.length;n<e;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o]);return t}).apply(this,arguments)};var r=(n.prototype.createSpring=function(){var n,t=this.options,r=t.velocity,e=t.from,o=t.to,a=t.damping,i=t.stiffness,u=t.mass,s=r?-r/1e3:0,f=o-e,p=a/(2*Math.sqrt(i*u)),c=Math.sqrt(i/u)/1e3;p<1?this.resolveSpring=function(t){var r=Math.exp(-p*c*t),n=c*Math.sqrt(1-p*p);return o-r*((s+p*c*f)/n*Math.sin(n*t)+f*Math.cos(n*t))}:1==p?this.resolveSpring=function(t){var r=Math.exp(-c*t);return o-r*(1+c*t)}:(n=c*Math.sqrt(p*p-1),this.resolveSpring=function(t){var r=Math.exp(-p*c*t);return o-r*((s+p*c*f)*Math.sinh(n*t)+n*f*Math.cosh(n*t))/n})},n.prototype.update=function(t){var r=this.resolveSpring(t),n=this.options,e=n.velocity,o=n.restSpeed,a=n.restDelta,i=n.to,u=Math.abs(e)<=o,s=Math.abs(i-r)<=a;return this.isComplete=u&&s,this.isComplete?i:r},n.prototype.updateOptions=function(t){var r=t.from,n=void 0===r?0:r,e=t.to,o=void 0===e?0:e,a=t.velocity,i=void 0===a?0:a,u=t.stiffness,s=void 0===u?100:u,f=t.damping,p=void 0===f?10:f,c=t.mass,v=void 0===c?1:c,h=t.restSpeed,d=void 0===h?.005:h,l=t.restDelta,m=void 0===l?.5:l;this.options={from:n,to:o,velocity:i,stiffness:s,damping:p,mass:v,restSpeed:d,restDelta:m}},n.prototype.flipTarget=function(){var t=this.options,r=t.from,n=t.to,e=t.velocity;this.options.velocity=-e,this.options.from=n,this.options.to=r,this.createSpring()},n.needsInterpolation=function(t,r){return"string"==typeof t||"string"==typeof r},n.uniqueOptionKeys=new Set(["stiffness","damping","mass","restSpeed","restDelta"]),n);function n(t){this.isComplete=!1,this.updateOptions(t),this.createSpring()}function s(t,r,n){return-n*t+n*r+t}function e(r,n){return function(t){return Math.max(Math.min(t,n),r)}}function c(t){return t%1?Number(t.toFixed(5)):t}function o(t){return void 0!==t.red}function a(t){return void 0!==t.hue}var i,b=function(t,r,n){var e=r-t;return 0==e?1:(n-t)/e},f=/(-)?(\d[\d\.]*)/g,p=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,u=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i,v={test:function(t){return"number"==typeof t},parse:parseFloat,transform:function(t){return t}},h=D(D({},v),{transform:e(0,1)}),d=(D(D({},v),{default:1}),i="%",{test:function(t){return"string"==typeof t&&t.endsWith(i)&&1===t.split(" ").length},parse:parseFloat,transform:function(t){return""+t+i}}),l=(D(D({},d),{parse:function(t){return d.parse(t)/100},transform:function(t){return d.transform(100*t)}}),e(0,255));function m(a){return function(t){if("string"!=typeof t)return t;for(var r,n={},e=(r=t).substring(r.indexOf("(")+1,r.lastIndexOf(")")).replace(/(,|\/)/g," ").split(/ \s*/),o=0;o<4;o++)n[a[o]]=void 0!==e[o]?parseFloat(e[o]):1;return n}}var y=D(D({},v),{transform:function(t){return Math.round(l(t))}});function g(t,r){return t.startsWith(r)&&u.test(t)}function M(t){return"number"==typeof t?0:t}function x(t,r,n){var e=t*t,o=r*r;return Math.sqrt(Math.max(0,n*(o-e)+e))}function O(r){return j.find(function(t){return t.test(r)})}function w(t){return"number"==typeof t}function I(r,n){return function(t){return n(r(t))}}var S={test:function(t){return"string"==typeof t?g(t,"rgb"):o(t)},parse:m(["red","green","blue","alpha"]),transform:function(t){var r,n,e,o,a,i=t.red,u=t.green,s=t.blue,f=t.alpha,p=void 0===f?1:f;return r={red:y.transform(i),green:y.transform(u),blue:y.transform(s),alpha:c(h.transform(p))},n=r.red,e=r.green,o=r.blue,a=r.alpha,"rgba("+n+", "+e+", "+o+", "+(void 0===a?1:a)+")"}},A={test:function(t){return"string"==typeof t?g(t,"hsl"):a(t)},parse:m(["hue","saturation","lightness","alpha"]),transform:function(t){var r,n,e,o,a,i=t.hue,u=t.saturation,s=t.lightness,f=t.alpha,p=void 0===f?1:f;return r={hue:Math.round(i),saturation:d.transform(c(u)),lightness:d.transform(c(s)),alpha:c(h.transform(p))},n=r.hue,e=r.saturation,o=r.lightness,a=r.alpha,"hsla("+n+", "+e+", "+o+", "+(void 0===a?1:a)+")"}},C=D(D({},S),{test:function(t){return"string"==typeof t&&g(t,"#")},parse:function(t){var r="",n="",e="";return 4<t.length?(r=t.substr(1,2),n=t.substr(3,2),e=t.substr(5,2)):(r=t.substr(1,1),n=t.substr(2,1),e=t.substr(3,1),r+=r,n+=n,e+=e),{red:parseInt(r,16),green:parseInt(n,16),blue:parseInt(e,16),alpha:1}}}),P={test:function(t){return"string"==typeof t&&u.test(t)||o(t)||a(t)},parse:function(t){return S.test(t)?S.parse(t):A.test(t)?A.parse(t):C.test(t)?C.parse(t):t},transform:function(t){return o(t)?S.transform(t):a(t)?A.transform(t):t}},T="${c}",q="${n}",F={test:function(t){if("string"!=typeof t||!isNaN(t))return!1;var r=0,n=t.match(f),e=t.match(p);return n&&(r+=n.length),e&&(r+=e.length),0<r},parse:function(t){var r=t,n=[],e=r.match(p);e&&(r=r.replace(p,T),n.push.apply(n,e.map(P.parse)));var o=r.match(f);return o&&n.push.apply(n,o.map(v.parse)),n},createTransformer:function(t){var e=t,o=0,r=t.match(p),a=r?r.length:0;if(r)for(var n=0;n<a;n++)e=e.replace(r[n],T),o++;var i=e.match(f),u=i?i.length:0;if(i)for(n=0;n<u;n++)e=e.replace(i[n],q),o++;return function(t){for(var r=e,n=0;n<o;n++)r=r.replace(n<a?T:q,n<a?P.transform(t[n]):c(t[n]));return r}},getAnimatableNone:function(t){var r=F.parse(t);return F.createTransformer(t)(r.map(M))}},R=function(){},j=[C,S,A],k=function(t,r){var n=O(t),e=O(r);R(n.transform===e.transform);var o=n.parse(t),a=e.parse(r),i=D({},o),u=n===A?s:x;return function(t){for(var r in i)"alpha"!==r&&(i[r]=u(o[r],a[r],t));return i.alpha=s(o.alpha,a.alpha,t),n.transform(i)}},E={x:0,y:0,z:0},U=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.reduce(I)};function z(r,n){return w(r)?function(t){return s(r,n,t)}:(P.test(r)?k:B)(r,n)}var K=function(t,n){var e=function(){for(var t=0,r=0,n=arguments.length;r<n;r++)t+=arguments[r].length;for(var e=Array(t),o=0,r=0;r<n;r++)for(var a=arguments[r],i=0,u=a.length;i<u;i++,o++)e[o]=a[i];return e}(t),o=e.length,a=t.map(function(t,r){return z(t,n[r])});return function(t){for(var r=0;r<o;r++)e[r]=a[r](t);return e}},N=function(t,r){var n=D(D({},t),r),e={};for(var o in n)void 0!==t[o]&&void 0!==r[o]&&(e[o]=z(t[o],r[o]));return function(t){for(var r in e)n[r]=e[r](t);return n}};function W(t){for(var r=F.parse(t),n=r.length,e=0,o=0,a=0,i=0;i<n;i++)e||"number"==typeof r[i]?e++:void 0!==r[i].hue?a++:o++;return{parsed:r,numNumbers:e,numRGB:o,numHSL:a}}var B=function(t,r){var n=F.createTransformer(r),e=W(t),o=W(r);return U(K(e.parsed,o.parsed),n)},$=function(t,r,n){return Math.min(Math.max(n,t),r)},_=function(r,n){return function(t){return s(r,n,t)}};function G(t,r,n){for(var e,o=[],a=n||("number"==typeof(e=t[0])?_:"string"==typeof e?P.test(e)?k:B:Array.isArray(e)?K:"object"==typeof e?N:void 0),i=t.length-1,u=0;u<i;u++){var s,f=a(t[u],t[u+1]);r&&(s=Array.isArray(r)?r[u]:r,f=U(s,f)),o.push(f)}return o}function H(r,t,n){var e=void 0===n?{}:n,o=e.clamp,a=void 0===o||o,i=e.ease,u=e.mixer,s=r.length;R(s===t.length),R(!i||!Array.isArray(i)||i.length===s-1),r[0]>r[s-1]&&(r=[].concat(r),t=[].concat(t),r.reverse(),t.reverse());var f,p,c,v,h,d,l,m,y,g=G(t,i,u),M=2===s?(d=g,l=(h=r)[0],m=h[1],y=d[0],function(t){return y(b(l,m,t))}):(p=g,c=(f=r).length,v=c-1,function(t){var r=0,n=!1;if(t<=f[0]?n=!0:t>=f[v]&&(r=v-1,n=!0),!n){for(var e=1;e<c&&!(f[e]>t||e===v);e++);r=e-1}var o=b(f[r],f[r+1],t);return p[r](o)});return a?function(t){return M($(r[0],r[s-1],t))}:M}function L(r){return function(t){return 1-r(1-t)}}function V(r){return function(t){return t<=.5?r(2*t)/2:(2-r(2*(1-t)))/2}}function J(r){return function(t){return Math.pow(t,r)}}function Q(r){return function(t){return t*t*((r+1)*t-r)}}function X(t){var r=Q(t);return function(t){return(t*=2)<1?.5*r(t):.5*(2-Math.pow(2,-10*(t-1)))}}function Y(t){return t}function Z(t){return 1-Math.sin(Math.acos(t))}function tt(t){if(1===t||0===t)return t;var r=t*t;return t<4/11?7.5625*r:t<8/11?9.075*r-9.9*t+3.4:t<.9?4356/361*r-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72}var rt=J(2),nt=L(rt),et=V(rt),ot=L(Z),at=V(ot),it=Q(1.525),ut=L(it),st=V(it),ft=X(1.525),pt=L(tt);var ct=(vt.prototype.createInterpolator=function(){var t,r,n,e,o,a=this.options,i=a.duration,u=a.ease,s=a.offset,u=Array.isArray(u)?u:(t=this.values,r=u,t.map(function(){return r||et}).splice(0,t.length-1)),s=s||(n=this.values,e=n.length,n.map(function(t,r){return 0!==r?r/(e-1):0})),f=(o=i,s.map(function(t){return t*o}));this.interpolator=H(f,this.values,{ease:u})},vt.prototype.update=function(t){var r=this.options.duration;return this.isComplete=r<=t,this.interpolator(t)},vt.prototype.updateOptions=function(t){var r=t.from,n=void 0===r?0:r,e=t.to,o=void 0===e?1:e,a=t.ease,i=t.offset,u=t.duration,s=void 0===u?300:u;this.options={from:n,to:o,ease:a,offset:i,duration:s}},vt.prototype.flipTarget=function(){this.values.reverse(),this.createInterpolator()},vt.needsInterpolation=function(){return!1},vt.uniqueOptionKeys=new Set(["duration","ease"]),vt);function vt(t){this.isComplete=!1,this.updateOptions(t);var r=this.options,n=r.from,e=r.to;this.values=Array.isArray(e)?e:[n,e],this.createInterpolator()}var ht=(dt.prototype.flipTarget=function(){},dt.prototype.update=function(t){var r=this.options,n=r.timeConstant,e=r.restDelta,o=-this.amplitude*Math.exp(-t/n);return this.isComplete=!(e<o||o<-e),this.isComplete?this.target:this.target+o},dt.prototype.updateOptions=function(t){var r=void 0===t?{}:t,n=r.velocity,e=void 0===n?0:n,o=r.from,a=void 0===o?0:o,i=r.power,u=void 0===i?.8:i,s=r.timeConstant,f=void 0===s?350:s,p=r.restDelta,c=void 0===p?.5:p,v=r.modifyTarget;this.options={velocity:e,from:a,power:u,timeConstant:f,restDelta:c,modifyTarget:v}},dt.needsInterpolation=function(){return!1},dt.uniqueOptionKeys=new Set(["power","timeConstant","modifyTarget"]),dt);function dt(t){this.isComplete=!1,this.updateOptions(t);var r=this.options,n=r.power,e=r.velocity,o=r.modifyTarget,a=r.from,i=n*e,u=a+i,s=void 0===o?u:o(u);s!==u&&(i=s-a),this.target=s,this.amplitude=i}var lt=[ct,r,ht],mt={keyframes:ct,spring:r,decay:ht},yt=lt.length;var gt,Mt,bt=0,xt="undefined"!=typeof window&&void 0!==window.requestAnimationFrame?function(t){return window.requestAnimationFrame(t)}:function(t){var r=Date.now(),n=Math.max(0,16.7-(r-bt));bt=r+n,setTimeout(function(){return t(bt)},n)};(Mt=gt=gt||{}).Read="read",Mt.Update="update",Mt.Render="render",Mt.PostRender="postRender",Mt.FixedUpdate="fixedUpdate";function Ot(t){return At=t}function wt(t){return qt[t].process(Pt)}var It=1/60*1e3,St=!0,At=!1,Ct=!1,Pt={delta:0,timestamp:0},Tt=[gt.Read,gt.Update,gt.Render,gt.PostRender],Dt=Tt.reduce(function(t,r){var e,a,i,u,s,o,f,p,c,v=(e=Ot,a=[],s=!(i=[]),o=u=0,f=new WeakSet,p=new WeakSet,c={cancel:function(t){var r=i.indexOf(t);f.add(t),-1!==r&&i.splice(r,1)},process:function(t){var r,n;if(s=!0,a=(r=[i,a])[0],(i=r[1]).length=0,u=a.length)for(o=0;o<u;o++)(n=a[o])(t),!0!==p.has(n)||f.has(n)||(c.schedule(n),e(!0));s=!1},schedule:function(t,r,n){void 0===r&&(r=!1),void 0===n&&(n=!1);var e=n&&s,o=e?a:i;f.delete(t),r&&p.add(t),-1===o.indexOf(t)&&(o.push(t),e&&(u=a.length))}});return t.sync[r]=function(t,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!1),At||kt(),v.schedule(t,r,n),t},t.cancelSync[r]=function(t){return v.cancel(t)},t.steps[r]=v,t},{steps:{},sync:{},cancelSync:{}}),qt=Dt.steps,Ft=Dt.sync,Rt=Dt.cancelSync,jt=function(t){At=!1,Pt.delta=St?It:Math.max(Math.min(t-Pt.timestamp,40),1),St||(It=Pt.delta),Pt.timestamp=t,Ct=!0,Tt.forEach(wt),Ct=!1,At&&(St=!1,xt(jt))},kt=function(){St=At=!0,Ct||xt(jt)};function Et(t,r,n){return void 0===n&&(n=0),t-r-n}function Ut(n){function t(t){var r=t.delta;return n(r)}return{start:function(){return Ft.update(t,!0,!0)},stop:function(){return Rt.update(t)}}}function zt(t){return 180*t/Math.PI}function Kt(t){return t}function Nt(a){return void 0===a&&(a=Kt),function(t,r,n){var e=r-n,o=-(0-t+1)*(0-a(Math.abs(e)));return e<=0?r+o:r-o}}function Wt(t){return t*Math.PI/180}function Bt(t){return t.hasOwnProperty("x")&&t.hasOwnProperty("y")}function $t(t){return Bt(t)&&t.hasOwnProperty("z")}function _t(t,r){return Math.abs(t-r)}var Gt=Nt(),Ht=Nt(Math.sqrt);function Lt(t,r){return void 0===r&&(r=2),r=Math.pow(10,r),Math.round(t*r)/r}function Vt(t,r,n,e){return void 0===e&&(e=0),Lt(t+n*(r-t)/Math.max(e,n))}function Jt(t,r){return 1-3*r+3*t}function Qt(t,r){return 3*r-6*t}var Xt=function(t,r,n){return((Jt(r,n)*t+Qt(r,n))*t+3*r)*t},Yt=function(t,r,n){return 3*Jt(r,n)*t*t+2*Qt(r,n)*t+3*r},Zt=1e-7,tr=10;var rr=8;t.DecayAnimator=ht,t.KeyframesAnimator=ct,t.SpringAnimator=r,t.angle=function(t,r){return void 0===r&&(r=E),zt(Math.atan2(r.y-t.y,r.x-t.x))},t.animate=function(t){var a,i,r=t.from,n=t.to,e=t.autoplay,o=void 0===e||e,u=t.driver,s=void 0===u?Ut:u,f=t.elapsed,p=void 0===f?0:f,c=t.repeat,v=void 0===c?0:c,h=t.repeatType,d=void 0===h?"loop":h,l=t.repeatDelay,m=void 0===l?0:l,y=t.onPlay,g=t.onComplete,M=t.onRepeat,b=t.onUpdate,x=function(t,r){var n={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.indexOf(e)<0&&(n[e]=t[e]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,e=Object.getOwnPropertySymbols(t);o<e.length;o++)r.indexOf(e[o])<0&&Object.prototype.propertyIsEnumerable.call(t,e[o])&&(n[e[o]]=t[e[o]]);return n}(t,["from","to","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onComplete","onRepeat","onUpdate"]),O=0,w=x.duration,I=!0,S=function(t){if(mt[t.type])return mt[t.type];for(var r in t)for(var n=0;n<yt;n++){var e=lt[n];if(e.uniqueOptionKeys.has(r))return e}}(x);S.needsInterpolation(r,n)&&(i=H([0,100],[r,n],{clamp:!1}),r=0,n=100);var A=new S(D(D({},x),{from:r,to:n}));function C(){var t,r,n,e;O++,"reverse"===d?(t=p,r=w,void 0===(n=m)&&(n=0),void 0===(e=I=O%2==0)&&(e=!0),p=e?Et(r+-t,r,n):r-(t-r)+n):(p=Et(p,w,m),"mirror"===d&&A.flipTarget()),A.isComplete=!1,M&&M()}function P(t){I||(t=-t),p+=t;var r,n,e,o=A.update(Math.max(0,p));i&&(o=i(o)),b(o),(I?A.isComplete:p<=0)&&(0===O&&void 0===w&&(w=p),O<v?(r=p,n=w,e=m,(I?n+e<=r:r<=-e)&&C()):(a.stop(),g&&g()))}function T(){y&&y(),(a=s(P)).start()}return o&&T(),{play:T,pause:function(){},resume:function(){},reverse:function(){},seek:function(){},stop:function(){return a.stop()}}},t.anticipate=ft,t.applyOffset=function(r,n){var e=!0;return void 0===n&&(n=r,e=!1),function(t){return e?t-r+n:(r=t,e=!0,n)}},t.attract=Gt,t.attractExpo=Ht,t.backIn=it,t.backInOut=st,t.backOut=ut,t.bounceIn=pt,t.bounceInOut=function(t){return t<.5?.5*(1-tt(1-2*t)):.5*tt(2*t-1)+.5},t.bounceOut=tt,t.circIn=Z,t.circInOut=at,t.circOut=ot,t.clamp=$,t.createAnticipate=X,t.createAttractor=Nt,t.createBackIn=Q,t.createExpoIn=J,t.cubicBezier=function(a,r,i,n){if(a===r&&i===n)return Y;for(var u=new Float32Array(11),t=0;t<11;++t)u[t]=Xt(.1*t,a,i);function e(t){for(var r=0,n=1;10!==n&&u[n]<=t;++n)r+=.1;var e=r+.1*((t-u[--n])/(u[n+1]-u[n])),o=Yt(e,a,i);return.001<=o?function(t,r,n,e){for(var o=0;o<rr;++o){var a=Yt(r,n,e);if(0===a)return r;r-=(Xt(r,n,e)-t)/a}return r}(t,e,a,i):0===o?e:function(t,r,n,e,o){for(var a,i,u=0;0<(a=Xt(i=r+(n-r)/2,e,o)-t)?n=i:r=i,Math.abs(a)>Zt&&++u<tr;);return i}(t,r,r+.1,a,i)}return function(t){return 0===t||1===t?t:Xt(e(t),r,n)}},t.degreesToRadians=Wt,t.distance=function(t,r){if(w(t)&&w(r))return _t(t,r);if(Bt(t)&&Bt(r)){var n=_t(t.x,r.x),e=_t(t.y,r.y),o=$t(t)&&$t(r)?_t(t.z,r.z):0;return Math.sqrt(Math.pow(n,2)+Math.pow(e,2)+Math.pow(o,2))}},t.easeIn=rt,t.easeInOut=et,t.easeOut=nt,t.interpolate=H,t.isPoint=Bt,t.isPoint3D=$t,t.linear=Y,t.mirrorEasing=V,t.mix=s,t.mixColor=k,t.mixComplex=B,t.pipe=U,t.pointFromVector=function(t,r,n){return r=Wt(r),{x:n*Math.cos(r)+t.x,y:n*Math.sin(r)+t.y}},t.progress=b,t.radiansToDegrees=zt,t.reverseEasing=L,t.smooth=function(o){void 0===o&&(o=50);var a=0,i=0;return function(t){var r=Pt.timestamp,n=r!==i?r-i:0,e=n?Vt(a,t,n,o):a;return i=r,a=e}},t.smoothFrame=Vt,t.snap=function(o){if("number"==typeof o)return function(t){return Math.round(t/o)*o};var a=0,i=o.length;return function(t){var r=Math.abs(o[0]-t);for(a=1;a<i;a++){var n=o[a],e=Math.abs(n-t);if(0===e)return n;if(r<e)return o[a-1];if(a===i-1)return n;r=e}}},t.steps=function(e,o){return void 0===o&&(o="end"),function(t){var r=(t="end"===o?Math.min(t,.999):Math.max(t,.001))*e,n="end"===o?Math.floor(r):Math.ceil(r);return $(0,1,n/e)}},t.toDecimal=Lt,t.velocityPerFrame=function(t,r){return t/(1e3/r)},t.velocityPerSecond=function(t,r){return r?t*(1e3/r):0},t.wrap=function(t,r,n){var e=r-t;return((n-t)%e+e)%e+t},Object.defineProperty(t,"__esModule",{value:!0})});
