import{__assign,__spreadArrays,__rest}from"tslib";import{hex,rgba,hsla,complex,color}from"style-value-types";import{invariant}from"hey-listen";import sync,{cancelSync,getFrameData}from"framesync";var SpringAnimator=function(){function t(t){this.isComplete=!1,this.updateOptions(t),this.createSpring()}return t.prototype.createSpring=function(){var t=this.options,e=t.velocity,n=t.from,r=t.to,i=t.damping,o=t.stiffness,a=t.mass,s=e?-e/1e3:0,u=r-n,c=i/(2*Math.sqrt(o*a)),p=Math.sqrt(o/a)/1e3;if(c<1)this.resolveSpring=function(t){var e=Math.exp(-c*p*t),n=p*Math.sqrt(1-c*c);return r-e*((s+c*p*u)/n*Math.sin(n*t)+u*Math.cos(n*t))},this.resolveVelocity=function(t){var e=Math.exp(-c*p*t),n=p*Math.sqrt(1-c*c);return c*p*e*(Math.sin(n*t)*(s+c*p*u)/n+u*Math.cos(n*t))-e*(Math.cos(n*t)*(s+c*p*u)-n*u*Math.sin(n*t))};else if(1===c)this.resolveSpring=function(t){var e=Math.exp(-p*t);return r-e*(1+p*t)},this.resolveVelocity=function(){return 0};else{var f=p*Math.sqrt(c*c-1);this.resolveSpring=function(t){var e=Math.exp(-c*p*t);return r-e*((s+c*p*u)*Math.sinh(f*t)+f*u*Math.cosh(f*t))/f},this.resolveVelocity=function(){return 0}}},t.prototype.update=function(t){var e=this.options,n=e.restSpeed,r=e.restDelta,i=e.to,o=this.resolveSpring(t),a=1e3*this.resolveVelocity(t),s=Math.abs(a)<=n,u=Math.abs(i-o)<=r;return this.isComplete=s&&u,this.isComplete?i:o},t.prototype.updateOptions=function(t){var e=t.from,n=void 0===e?0:e,r=t.to,i=void 0===r?0:r,o=t.velocity,a=void 0===o?0:o,s=t.stiffness,u=void 0===s?100:s,c=t.damping,p=void 0===c?10:c,f=t.mass,l=void 0===f?1:f,m=t.restSpeed,v=void 0===m?2:m,d=t.restDelta;void 0===d&&(d=Math.abs(i-n)<=1?.01:.4),this.options={from:n,to:i,velocity:a,stiffness:u,damping:p,mass:l,restSpeed:v,restDelta:d}},t.prototype.flipTarget=function(){var t=this.options,e=t.from,n=t.to,r=t.velocity;this.options.velocity=-r,this.options.from=n,this.options.to=e,this.createSpring()},t.needsInterpolation=function(t,e){return"string"==typeof t||"string"==typeof e},t.uniqueOptionKeys=new Set(["velocity","stiffness","damping","mass","restSpeed","restDelta"]),t}(),progress=function(t,e,n){var r=e-t;return 0===r?1:(n-t)/r},mix=function(t,e,n){return-n*t+n*e+t},mixLinearColor=function(t,e,n){var r=t*t,i=e*e;return Math.sqrt(Math.max(0,n*(i-r)+r))},colorTypes=[hex,rgba,hsla],getColorType=function(t){return colorTypes.find(function(e){return e.test(t)})},notAnimatable=function(t){return"'"+t+"' is not an animatable color. Use the equivalent color code instead."},mixColor=function(t,e){var n=getColorType(t),r=getColorType(e);invariant(!!n,notAnimatable(t)),invariant(!!r,notAnimatable(e)),invariant(n.transform===r.transform,"Both colors must be hex/RGBA, OR both must be HSLA.");var i=n.parse(t),o=r.parse(e),a=__assign({},i),s=n===hsla?mix:mixLinearColor;return function(t){for(var e in a)"alpha"!==e&&(a[e]=s(i[e],o[e],t));return a.alpha=mix(i.alpha,o.alpha,t),n.transform(a)}},zeroPoint={x:0,y:0,z:0},isNum=function(t){return"number"==typeof t},combineFunctions=function(t,e){return function(n){return e(t(n))}},pipe=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.reduce(combineFunctions)};function getMixer(t,e){return isNum(t)?function(n){return mix(t,e,n)}:color.test(t)?mixColor(t,e):mixComplex(t,e)}var mixArray=function(t,e){var n=__spreadArrays(t),r=n.length,i=t.map(function(t,n){return getMixer(t,e[n])});return function(t){for(var e=0;e<r;e++)n[e]=i[e](t);return n}},mixObject=function(t,e){var n=__assign(__assign({},t),e),r={};for(var i in n)void 0!==t[i]&&void 0!==e[i]&&(r[i]=getMixer(t[i],e[i]));return function(t){for(var e in r)n[e]=r[e](t);return n}};function analyse(t){for(var e=complex.parse(t),n=e.length,r=0,i=0,o=0,a=0;a<n;a++)r||"number"==typeof e[a]?r++:void 0!==e[a].hue?o++:i++;return{parsed:e,numNumbers:r,numRGB:i,numHSL:o}}var mixComplex=function(t,e){var n=complex.createTransformer(e),r=analyse(t),i=analyse(e);return invariant(r.numHSL===i.numHSL&&r.numRGB===i.numRGB&&r.numNumbers>=i.numNumbers,"Complex values '"+t+"' and '"+e+"' too different to mix. Ensure all colors are of the same type."),pipe(mixArray(r.parsed,i.parsed),n)},clamp=function(t,e,n){return Math.min(Math.max(n,t),e)},mixNumber=function(t,e){return function(n){return mix(t,e,n)}};function detectMixerFactory(t){return"number"==typeof t?mixNumber:"string"==typeof t?color.test(t)?mixColor:mixComplex:Array.isArray(t)?mixArray:"object"==typeof t?mixObject:void 0}function createMixers(t,e,n){for(var r=[],i=n||detectMixerFactory(t[0]),o=t.length-1,a=0;a<o;a++){var s=i(t[a],t[a+1]);if(e){var u=Array.isArray(e)?e[a]:e;s=pipe(u,s)}r.push(s)}return r}function fastInterpolate(t,e){var n=t[0],r=t[1],i=e[0];return function(t){return i(progress(n,r,t))}}function slowInterpolate(t,e){var n=t.length,r=n-1;return function(i){var o=0,a=!1;if(i<=t[0]?a=!0:i>=t[r]&&(o=r-1,a=!0),!a){for(var s=1;s<n&&!(t[s]>i||s===r);s++);o=s-1}var u=progress(t[o],t[o+1],i);return e[o](u)}}function interpolate(t,e,n){var r=void 0===n?{}:n,i=r.clamp,o=void 0===i||i,a=r.ease,s=r.mixer,u=t.length;invariant(u===e.length,"Both input and output ranges must be the same length"),invariant(!a||!Array.isArray(a)||a.length===u-1,"Array of easing functions must be of length `input.length - 1`, as it applies to the transitions **between** the defined values."),t[0]>t[u-1]&&(t=[].concat(t),e=[].concat(e),t.reverse(),e.reverse());var c=createMixers(e,a,s),p=2===u?fastInterpolate(t,c):slowInterpolate(t,c);return o?function(e){return p(clamp(t[0],t[u-1],e))}:p}var reverseEasing=function(t){return function(e){return 1-t(1-e)}},mirrorEasing=function(t){return function(e){return e<=.5?t(2*e)/2:(2-t(2*(1-e)))/2}},createExpoIn=function(t){return function(e){return Math.pow(e,t)}},createBackIn=function(t){return function(e){return e*e*((t+1)*e-t)}},createAnticipate=function(t){var e=createBackIn(t);return function(t){return(t*=2)<1?.5*e(t):.5*(2-Math.pow(2,-10*(t-1)))}},DEFAULT_OVERSHOOT_STRENGTH=1.525,BOUNCE_FIRST_THRESHOLD=4/11,BOUNCE_SECOND_THRESHOLD=8/11,BOUNCE_THIRD_THRESHOLD=.9,linear=function(t){return t},easeIn=createExpoIn(2),easeOut=reverseEasing(easeIn),easeInOut=mirrorEasing(easeIn),circIn=function(t){return 1-Math.sin(Math.acos(t))},circOut=reverseEasing(circIn),circInOut=mirrorEasing(circOut),backIn=createBackIn(DEFAULT_OVERSHOOT_STRENGTH),backOut=reverseEasing(backIn),backInOut=mirrorEasing(backIn),anticipate=createAnticipate(DEFAULT_OVERSHOOT_STRENGTH),ca=4356/361,cb=35442/1805,cc=16061/1805,bounceOut=function(t){if(1===t||0===t)return t;var e=t*t;return t<BOUNCE_FIRST_THRESHOLD?7.5625*e:t<BOUNCE_SECOND_THRESHOLD?9.075*e-9.9*t+3.4:t<BOUNCE_THIRD_THRESHOLD?ca*e-cb*t+cc:10.8*t*t-20.52*t+10.72},bounceIn=reverseEasing(bounceOut),bounceInOut=function(t){return t<.5?.5*(1-bounceOut(1-2*t)):.5*bounceOut(2*t-1)+.5};function defaultEasing(t,e){return t.map(function(){return e||easeInOut}).splice(0,t.length-1)}function defaultOffset(t){var e=t.length;return t.map(function(t,n){return 0!==n?n/(e-1):0})}function convertOffsetToTimes(t,e){return t.map(function(t){return t*e})}var KeyframesAnimator=function(){function t(t){this.isComplete=!1,this.updateOptions(t);var e=this.options,n=e.from,r=e.to;this.values=Array.isArray(r)?r:[n,r],this.createInterpolator()}return t.prototype.createInterpolator=function(){var t=this.options,e=t.duration,n=t.ease,r=t.offset;n=Array.isArray(n)?n:defaultEasing(this.values,n);var i=convertOffsetToTimes(r=r||defaultOffset(this.values),e);this.interpolator=interpolate(i,this.values,{ease:n})},t.prototype.update=function(t){var e=this.options.duration;return this.isComplete=t>=e,this.interpolator(t)},t.prototype.updateOptions=function(t){var e=t.from,n=void 0===e?0:e,r=t.to,i=void 0===r?1:r,o=t.ease,a=t.offset,s=t.duration,u=void 0===s?300:s;this.options={from:n,to:i,ease:o,offset:a,duration:u}},t.prototype.flipTarget=function(){this.values.reverse(),this.createInterpolator()},t.needsInterpolation=function(){return!1},t.uniqueOptionKeys=new Set(["duration","ease"]),t}(),DecayAnimator=function(){function t(t){this.isComplete=!1,this.updateOptions(t);var e=this.options,n=e.power,r=e.velocity,i=e.modifyTarget,o=e.from,a=n*r,s=o+a,u=void 0===i?s:i(s);u!==s&&(a=u-o),this.target=u,this.amplitude=a}return t.prototype.flipTarget=function(){},t.prototype.update=function(t){var e=this.options,n=e.timeConstant,r=e.restDelta,i=-this.amplitude*Math.exp(-t/n);return this.isComplete=!(i>r||i<-r),this.isComplete?this.target:this.target+i},t.prototype.updateOptions=function(t){var e=void 0===t?{}:t,n=e.velocity,r=void 0===n?0:n,i=e.from,o=void 0===i?0:i,a=e.power,s=void 0===a?.8:a,u=e.timeConstant,c=void 0===u?350:u,p=e.restDelta,f=void 0===p?.5:p,l=e.modifyTarget;this.options={velocity:r,from:o,power:s,timeConstant:c,restDelta:f,modifyTarget:l}},t.needsInterpolation=function(){return!1},t.uniqueOptionKeys=new Set(["power","timeConstant","modifyTarget"]),t}(),animators=[KeyframesAnimator,DecayAnimator,SpringAnimator],types={keyframes:KeyframesAnimator,spring:SpringAnimator,decay:DecayAnimator},numAnimators=animators.length;function detectAnimationFromOptions(t){if(Array.isArray(t.to))return KeyframesAnimator;if(types[t.type])return types[t.type];for(var e in t)for(var n=0;n<numAnimators;n++){var r=animators[n];if(r.uniqueOptionKeys.has(e))return r}return KeyframesAnimator}function loopElapsed(t,e,n){return void 0===n&&(n=0),t-e-n}function reverseElapsed(t,e,n,r){return void 0===n&&(n=0),void 0===r&&(r=!0),r?loopElapsed(e+-t,e,n):e-(t-e)+n}function hasRepeatDelayElapsed(t,e,n,r){return r?t>=e+n:t<=-n}var framesync=function(t){var e=function(e){var n=e.delta;return t(n)};return{start:function(){return sync.update(e,!0,!0)},stop:function(){return cancelSync.update(e)}}};function animate(t){var e,n,r,i=t.from,o=t.autoplay,a=void 0===o||o,s=t.driver,u=void 0===s?framesync:s,c=t.elapsed,p=void 0===c?0:c,f=t.repeat,l=void 0===f?0:f,m=t.repeatType,v=void 0===m?"loop":m,d=t.repeatDelay,h=void 0===d?0:d,y=t.onPlay,g=t.onStop,S=t.onComplete,b=t.onRepeat,x=t.onUpdate,O=__rest(t,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),M=O.to,T=0,A=O.duration,I=!1,D=!0,E=detectAnimationFromOptions(O);E.needsInterpolation(i,M)&&(r=interpolate([0,100],[i,M],{clamp:!1}),i=0,M=100);var _=new E(__assign(__assign({},O),{from:i,to:M}));function C(t){D||(t=-t),p+=t,I||(n=_.update(Math.max(0,p)),r&&(n=r(n)),I=D?_.isComplete:p<=0),null==x||x(n),I&&(0===T&&void 0===A&&(A=p),T<l?hasRepeatDelayElapsed(p,A,h,D)&&(T++,"reverse"===v?p=reverseElapsed(p,A,h,D=T%2==0):(p=loopElapsed(p,A,h),"mirror"===v&&_.flipTarget()),I=!1,_.isComplete=!1,b&&b()):(e.stop(),S&&S()))}function w(){null==y||y(),(e=u(C)).start()}return a&&w(),{play:w,pause:function(){},resume:function(){},reverse:function(){},seek:function(){},stop:function(){null==g||g(),e.stop()}}}function velocityPerSecond(t,e){return e?t*(1e3/e):0}function inertia(t){var e,n=t.from,r=void 0===n?0:n,i=t.velocity,o=void 0===i?0:i,a=t.min,s=t.max,u=t.power,c=void 0===u?.8:u,p=t.timeConstant,f=void 0===p?750:p,l=t.bounceStiffness,m=void 0===l?500:l,v=t.bounceDamping,d=void 0===v?10:v,h=t.restDelta,y=void 0===h?1:h,g=t.modifyTarget,S=t.driver,b=t.onUpdate,x=t.onComplete;function O(t){return void 0!==a&&t<a||void 0!==s&&t>s}function M(t){return void 0===a?s:void 0===s?a:Math.abs(a-t)<Math.abs(s-t)?a:s}function T(t){null==e||e.stop(),e=animate(__assign(__assign({},t),{driver:S,onUpdate:function(e){var n;null==b||b(e),null===(n=t.onUpdate)||void 0===n||n.call(t,e)},onComplete:x}))}function A(t){T(__assign({type:"spring",stiffness:m,damping:d,restDelta:y},t))}if(O(r))A({from:r,velocity:o,to:M(r)});else{var I=c*o+r;void 0!==g&&(I=g(I));var D,E=M(I),_=E===a?-1:1;T({type:"decay",from:r,velocity:o,timeConstant:f,power:c,restDelta:y,modifyTarget:g,onUpdate:O(I)?function(t){o=velocityPerSecond(t-D,getFrameData().delta),D=t,E-t*_>0||A({from:D,to:E,velocity:o})}:void 0})}return{stop:function(){return null==e?void 0:e.stop()}}}var radiansToDegrees=function(t){return 180*t/Math.PI},angle=function(t,e){return void 0===e&&(e=zeroPoint),radiansToDegrees(Math.atan2(e.y-t.y,e.x-t.x))},applyOffset=function(t,e){var n=!0;return void 0===e&&(e=t,n=!1),function(r){return n?r-t+e:(t=r,n=!0,e)}},identity=function(t){return t},createAttractor=function(t){return void 0===t&&(t=identity),function(e,n,r){var i=n-r,o=-(0-e+1)*(0-t(Math.abs(i)));return i<=0?n+o:n-o}},attract=createAttractor(),attractExpo=createAttractor(Math.sqrt),degreesToRadians=function(t){return t*Math.PI/180},isPoint=function(t){return t.hasOwnProperty("x")&&t.hasOwnProperty("y")},isPoint3D=function(t){return isPoint(t)&&t.hasOwnProperty("z")},distance1D=function(t,e){return Math.abs(t-e)};function distance(t,e){if(isNum(t)&&isNum(e))return distance1D(t,e);if(isPoint(t)&&isPoint(e)){var n=distance1D(t.x,e.x),r=distance1D(t.y,e.y),i=isPoint3D(t)&&isPoint3D(e)?distance1D(t.z,e.z):0;return Math.sqrt(Math.pow(n,2)+Math.pow(r,2)+Math.pow(i,2))}}var pointFromVector=function(t,e,n){return e=degreesToRadians(e),{x:n*Math.cos(e)+t.x,y:n*Math.sin(e)+t.y}},toDecimal=function(t,e){return void 0===e&&(e=2),e=Math.pow(10,e),Math.round(t*e)/e},smoothFrame=function(t,e,n,r){return void 0===r&&(r=0),toDecimal(t+n*(e-t)/Math.max(r,n))},smooth=function(t){void 0===t&&(t=50);var e=0,n=0;return function(r){var i=getFrameData().timestamp,o=i!==n?i-n:0,a=o?smoothFrame(e,r,o,t):e;return n=i,e=a,a}},snap=function(t){if("number"==typeof t)return function(e){return Math.round(e/t)*t};var e=0,n=t.length;return function(r){var i=Math.abs(t[0]-r);for(e=1;e<n;e++){var o=t[e],a=Math.abs(o-r);if(0===a)return o;if(a>i)return t[e-1];if(e===n-1)return o;i=a}}};function velocityPerFrame(t,e){return t/(1e3/e)}var wrap=function(t,e,n){var r=e-t;return((n-t)%r+r)%r+t},a=function(t,e){return 1-3*e+3*t},b=function(t,e){return 3*e-6*t},c=function(t){return 3*t},calcBezier=function(t,e,n){return((a(e,n)*t+b(e,n))*t+c(e))*t},getSlope=function(t,e,n){return 3*a(e,n)*t*t+2*b(e,n)*t+c(e)},subdivisionPrecision=1e-7,subdivisionMaxIterations=10;function binarySubdivide(t,e,n,r,i){var o,a,s=0;do{(o=calcBezier(a=e+(n-e)/2,r,i)-t)>0?n=a:e=a}while(Math.abs(o)>subdivisionPrecision&&++s<subdivisionMaxIterations);return a}var newtonIterations=8,newtonMinSlope=.001;function newtonRaphsonIterate(t,e,n,r){for(var i=0;i<newtonIterations;++i){var o=getSlope(e,n,r);if(0===o)return e;e-=(calcBezier(e,n,r)-t)/o}return e}var kSplineTableSize=11,kSampleStepSize=1/(kSplineTableSize-1);function cubicBezier(t,e,n,r){if(t===e&&n===r)return linear;for(var i=new Float32Array(kSplineTableSize),o=0;o<kSplineTableSize;++o)i[o]=calcBezier(o*kSampleStepSize,t,n);return function(o){return 0===o||1===o?o:calcBezier(function(e){for(var r=0,o=1,a=kSplineTableSize-1;o!==a&&i[o]<=e;++o)r+=kSampleStepSize;var s=r+(e-i[--o])/(i[o+1]-i[o])*kSampleStepSize,u=getSlope(s,t,n);return u>=newtonMinSlope?newtonRaphsonIterate(e,s,t,n):0===u?s:binarySubdivide(e,r,r+kSampleStepSize,t,n)}(o),e,r)}}var steps=function(t,e){return void 0===e&&(e="end"),function(n){var r=(n="end"===e?Math.min(n,.999):Math.max(n,.001))*t,i="end"===e?Math.floor(r):Math.ceil(r);return clamp(0,1,i/t)}};export{DecayAnimator,KeyframesAnimator,SpringAnimator,angle,animate,anticipate,applyOffset,attract,attractExpo,backIn,backInOut,backOut,bounceIn,bounceInOut,bounceOut,circIn,circInOut,circOut,clamp,createAnticipate,createAttractor,createBackIn,createExpoIn,cubicBezier,degreesToRadians,distance,easeIn,easeInOut,easeOut,inertia,interpolate,isPoint,isPoint3D,linear,mirrorEasing,mix,mixColor,mixComplex,pipe,pointFromVector,progress,radiansToDegrees,reverseEasing,smooth,smoothFrame,snap,steps,toDecimal,velocityPerFrame,velocityPerSecond,wrap};