define(function(e,t,n){function g(e,t){var n,r=e.clientX,o=e.clientY;return null==e?null:(m.support.elementFromPage&&(r+=(n=m.helpers.scrollOffset(t)).left,o+=n.top),t.document.elementFromPoint(Math.round(r),Math.round(o)))}var m=e("./synthetic"),_={focusWindow:null,dragAndDrop:function(e,t,n,r,o){this.currentDataTransferItem=null,this.focusWindow=e,this._mouseOver(t),this._mouseEnter(t),this._mouseMove(t),this._mouseDown(t),this._dragStart(t),this._drag(t),this._dragEnter(t),this._dragOver(t),_.startMove(t,n,r,function(){_._dragLeave(t),_._dragEnd(t),_._mouseOut(t),_._mouseLeave(t),_._drop(n),_._dragEnd(n),_._mouseOver(n),_._mouseEnter(n),_._mouseMove(n),_._mouseOut(n),_._mouseLeave(n),o(),_.cleanup()})},_dragStart:function(e,t){this.createAndDispatchEvent(e,"dragstart",t)},_drag:function(e,t){this.createAndDispatchEvent(e,"drag",t)},_dragEnter:function(e,t){this.createAndDispatchEvent(e,"dragenter",t)},_dragOver:function(e,t){this.createAndDispatchEvent(e,"dragover",t)},_dragLeave:function(e,t){this.createAndDispatchEvent(e,"dragleave",t)},_drop:function(e,t){this.createAndDispatchEvent(e,"drop",t)},_dragEnd:function(e,t){this.createAndDispatchEvent(e,"dragend",t)},_mouseDown:function(e,t){this.createAndDispatchEvent(e,"mousedown",t)},_mouseMove:function(e,t){this.createAndDispatchEvent(e,"mousemove",t)},_mouseEnter:function(e,t){this.createAndDispatchEvent(e,"mouseenter",t)},_mouseOver:function(e,t){this.createAndDispatchEvent(e,"mouseover",t)},_mouseOut:function(e,t){this.createAndDispatchEvent(e,"mouseout",t)},_mouseLeave:function(e,t){this.createAndDispatchEvent(e,"mouseleave",t)},createAndDispatchEvent:function(e,t,n){var r;e&&(r=g(e,this.focusWindow),m.trigger(r,t,n))},getDataTransferObject:function(){return this.currentDataTransferItem?this.currentDataTransferItem:this.currentDataTransferItem=this.createDataTransferObject()},cleanup:function(){this.currentDataTransferItem=null,this.focusWindow=null},createDataTransferObject:function(){return{dropEffect:"none",effectAllowed:"uninitialized",files:[],items:[],types:[],data:[],setData:function(e,t){var n={};n.dataFlavor=e,n.val=t,this.data.push(n)},getData:function(e){for(var t=0;t<this.data.length;t++){var n=this.data[t];if(n.dataFlavor===e)return n.val}}}},startMove:function(o,a,i,s){function c(){var e=new Date,t=m.helpers.scrollOffset(p),n=(0===v?0:e-d)/i,r={clientX:u*n+o.clientX,clientY:l*n+o.clientY};v++,n<1?(m.helpers.extend(f.style,{left:r.clientX+t.left+2+"px",top:r.clientY+t.top+2+"px"}),h=_.mouseMove(r,h),m.schedule(c,15)):(h=_.mouseMove(a,h),p.document.body.removeChild(f),s())}var d=new Date,u=a.clientX-o.clientX,l=a.clientY-o.clientY,p=this.focusWindow,h=o,f=p.document.createElement("div"),v=0;m.helpers.extend(f.style,{height:"5px",width:"5px",backgroundColor:"red",position:"absolute",zIndex:19999,fontSize:"1px"}),p.document.body.appendChild(f),c()},mouseMove:function(e,t){var n=g(e,this.focusWindow),r=g(t,this.focusWindow),o=m.helpers.extend({},e);return n!==r&&(o.relatedTarget=n,this._dragLeave(t,o),o.relatedTarget=r,this._dragEnter(e,o)),this._dragOver(e,o),e}};function r(e,t,n){var r=m.create.mouse.event(e,t,n);return r.dataTransfer=_.getDataTransferObject(),m.dispatch(r,n,e,!1)}m.create.dragstart={event:r},m.create.dragenter={event:r},m.create.dragover={event:r},m.create.dragleave={event:r},m.create.drag={event:r},m.create.drop={event:r},m.create.dragend={event:r},function e(){var t;document.body?(t=document.createElement("div"),document.body.appendChild(t),m.helpers.extend(t.style,{width:"100px",height:"10000px",backgroundColor:"blue",position:"absolute",top:"10px",left:"0px",zIndex:19999}),document.body.scrollTop=11,document.elementFromPoint&&(document.elementFromPoint(3,1)===t?m.support.elementFromClient=!0:m.support.elementFromPage=!0,document.body.removeChild(t),document.body.scrollTop=0)):m.schedule(e,1)}();function D(e,t,n){var r,o=g(e,t);return n!==o&&o&&n&&((r=m.helpers.extend({},e)).relatedTarget=o,m.support.pointerEvents&&m.trigger(n,"pointerout",r),m.trigger(n,"mouseout",r),r.relatedTarget=n,m.support.pointerEvents&&m.trigger(o,"pointerover",r),m.trigger(o,"mouseover",r)),m.support.pointerEvents&&m.trigger(o||t,"pointermove",e),m.support.touchEvents&&m.trigger(o||t,"touchmove",e),m.trigger(o||t,"mousemove",e),o}function i(o,a,i,s,c){function d(){var e=new Date,t=m.helpers.scrollOffset(o),n=(0===v?0:e-u)/s,r={clientX:l*n+a.clientX,clientY:p*n+a.clientY};v++,n<1?(m.helpers.extend(f.style,{left:r.clientX+t.left+2+"px",top:r.clientY+t.top+2+"px"}),h=D(r,o,h),m.schedule(d,15)):(h=D(i,o,h),o.document.body.removeChild(f),c())}var u=new Date,l=i.clientX-a.clientX,p=i.clientY-a.clientY,h=g(a,o),f=o.document.createElement("div"),v=0;m.helpers.extend(f.style,{height:"5px",width:"5px",backgroundColor:"red",position:"absolute",zIndex:19999,fontSize:"1px"}),o.document.body.appendChild(f),d()}function d(e){var t=m.jquery()(e),n=t.offset();return{pageX:n.left+t.outerWidth()/2,pageY:n.top+t.outerHeight()/2}}function s(e,t,n){var r,o,a,i=/(\d+)[x ](\d+)/,s=/(\d+)X(\d+)/,c=/([+-]\d+)[xX ]([+-]\d+)/;return"string"==typeof e&&c.test(e)&&n&&(r=d(n),o=e.match(c),e={pageX:r.pageX+parseInt(o[1]),pageY:r.pageY+parseInt(o[2])}),"string"==typeof e&&i.test(e)&&(o=e.match(i),e={pageX:parseInt(o[1]),pageY:parseInt(o[2])}),"string"==typeof e&&s.test(e)&&(o=e.match(s),e={clientX:parseInt(o[1]),clientY:parseInt(o[2])}),"string"==typeof e&&(e=m.jquery()(e,t.document)[0]),e.nodeName&&(e=d(e)),null!=e.pageX&&(a=m.helpers.scrollOffset(t),e={clientX:e.pageX-a.left,clientY:e.pageY-a.top}),e}function c(e,t,n){var r,o,a;e.clientY<0&&(a=(o=(r=m.helpers.scrollOffset(n)).top+e.clientY-100)-r.top,0<o||(o=0,a=-r.top),e.clientY=e.clientY-a,t.clientY=t.clientY-a,m.helpers.scrollOffset(n,{top:o,left:r.left}))}m.helpers.extend(m.init.prototype,{_move:function(e,t,n){var r=m.helpers.getWindow(e),o=s(t.from||e,r,e),a=s(t.to||t,r,e);!1!==t.adjust&&c(o,a,r),i(r,o,a,t.duration||500,n)},_drag:function(e,t,n){var r=m.helpers.getWindow(e),o=s(t.from||e,r,e),a=s(t.to||t,r,e);!1!==t.adjust&&c(o,a,r),_.dragAndDrop(r,o,a,t.duration||500,n)}})});