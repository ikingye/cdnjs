import{NgModule,Component,ElementRef,OnInit,AfterViewInit,AfterContentInit,AfterViewChecked,OnDestroy,Input,Output,Renderer2,EventEmitter,forwardRef,ViewChild,ChangeDetectorRef,TemplateRef,ContentChildren,QueryList,ContentChild,ChangeDetectionStrategy,ViewEncapsulation}from"@angular/core";import{trigger,style,transition,animate}from"@angular/animations";import{CommonModule}from"@angular/common";import{DomHandler}from"primeng/dom";import{ObjectUtils}from"primeng/utils";import{SharedModule,PrimeTemplate,Footer,Header}from"primeng/api";import{NG_VALUE_ACCESSOR}from"@angular/forms";import{ScrollingModule}from"@angular/cdk/scrolling";import{FilterUtils}from"primeng/utils";import{TooltipModule}from"primeng/tooltip";import{RippleModule}from"primeng/ripple";export const MULTISELECT_VALUE_ACCESSOR={provide:NG_VALUE_ACCESSOR,useExisting:forwardRef(()=>MultiSelect),multi:!0};export class MultiSelectItem{constructor(){this.onClick=new EventEmitter,this.onKeydown=new EventEmitter}onOptionClick(e){this.onClick.emit({originalEvent:e,option:this.option})}onOptionKeydown(e){this.onKeydown.emit({originalEvent:e,option:this.option})}};MultiSelectItem.decorators=[{type:Component,args:[{selector:"p-multiSelectItem",template:'\n        <li class="p-multiselect-item" (click)="onOptionClick($event)" (keydown)="onOptionKeydown($event)" [attr.aria-label]="option.label"\n            [attr.tabindex]="option.disabled ? null : \'0\'" [ngStyle]="{\'height\': itemSize + \'px\'}"\n            [ngClass]="{\'p-highlight\': selected, \'p-disabled\': (option.disabled || (maxSelectionLimitReached && !selected))}">\n            <div class="p-checkbox p-component">\n                <div class="p-checkbox-box" [ngClass]="{\'p-highlight\': selected}">\n                    <span class="p-checkbox-icon" [ngClass]="{\'pi pi-check\': selected}"></span>\n                </div>\n            </div>\n            <span *ngIf="!template">{{option.label}}</span>\n            <ng-container *ngTemplateOutlet="template; context: {$implicit: option}"></ng-container>\n        </li>\n    ',encapsulation:ViewEncapsulation.None}]}],MultiSelectItem.propDecorators={option:[{type:Input}],selected:[{type:Input}],disabled:[{type:Input}],visible:[{type:Input}],itemSize:[{type:Input}],template:[{type:Input}],maxSelectionLimitReached:[{type:Input}],onClick:[{type:Output}],onKeydown:[{type:Output}]};export class MultiSelect{constructor(e,t,i){this.el=e,this.renderer=t,this.cd=i,this.scrollHeight="200px",this.filter=!0,this.displaySelectedLabel=!0,this.maxSelectedLabels=3,this.selectedItemsLabel="{0} items selected",this.showToggleAll=!0,this.emptyFilterMessage="No results found",this.resetFilterOnHide=!1,this.dropdownIcon="pi pi-chevron-down",this.showHeader=!0,this.autoZIndex=!0,this.baseZIndex=0,this.filterBy="label",this.showTransitionOptions=".12s cubic-bezier(0, 0, 0.2, 1)",this.hideTransitionOptions=".1s linear",this.filterMatchMode="contains",this.tooltip="",this.tooltipPosition="right",this.tooltipPositionStyle="absolute",this.autofocusFilter=!0,this.onChange=new EventEmitter,this.onFocus=new EventEmitter,this.onBlur=new EventEmitter,this.onClick=new EventEmitter,this.onPanelShow=new EventEmitter,this.onPanelHide=new EventEmitter,this.onModelChange=(()=>{}),this.onModelTouched=(()=>{}),this.disabledSelectedOptions=[]}set defaultLabel(e){this._defaultLabel=e,this.updateLabel()}get defaultLabel(){return this._defaultLabel}set placeholder(e){this._placeholder=e,this.updateLabel()}get placeholder(){return this._placeholder}get options(){return this._options}set options(e){let t=this.optionLabel?ObjectUtils.generateSelectItems(e,this.optionLabel):e;this.visibleOptions=t,this._options=t,this.updateLabel(),this.filterValue&&this.filterValue.length&&this.activateFilter()}ngOnInit(){this.updateLabel()}ngAfterContentInit(){this.templates.forEach(e=>{switch(e.getType()){case"item":this.itemTemplate=e.template;break;case"selectedItems":this.selectedItemsTemplate=e.template;break;case"header":this.headerTemplate=e.template;break;case"footer":this.footerTemplate=e.template;break;default:this.itemTemplate=e.template}})}ngAfterViewInit(){this.overlayVisible&&this.show()}ngAfterViewChecked(){this.filtered&&(this.alignOverlay(),this.filtered=!1)}writeValue(e){this.value=e,this.updateLabel(),this.updateFilledState(),this.setDisabledSelectedOptions(),this.checkSelectionLimit(),this.cd.markForCheck()}checkSelectionLimit(){this.selectionLimit&&this.value&&this.value.length===this.selectionLimit?this.maxSelectionLimitReached=!0:this.maxSelectionLimitReached=!1}updateFilledState(){this.filled=this.value&&this.value.length>0}registerOnChange(e){this.onModelChange=e}registerOnTouched(e){this.onModelTouched=e}setDisabledState(e){this.disabled=e}onOptionClick(e){let t=e.option;if(t.disabled)return;const i=t.value;let l=this.findSelectionIndex(i);-1!=l?(this.value=this.value.filter((e,t)=>t!=l),this.selectionLimit&&(this.maxSelectionLimitReached=!1)):((!this.selectionLimit||!this.value||this.value.length<this.selectionLimit)&&(this.value=[...this.value||[],i]),this.checkSelectionLimit()),this.onModelChange(this.value),this.onChange.emit({originalEvent:e.originalEvent,value:this.value,itemValue:i}),this.updateLabel(),this.updateFilledState()}isSelected(e){return-1!=this.findSelectionIndex(e)}findSelectionIndex(e){let t=-1;if(this.value)for(let i=0;i<this.value.length;i++)if(ObjectUtils.equals(this.value[i],e,this.dataKey)){t=i;break}return t}toggleAll(e){if(this.isAllChecked())if(this.disabledSelectedOptions&&this.disabledSelectedOptions.length>0){let e=[];e=[...this.disabledSelectedOptions],this.value=e}else this.value=[];else{let e=this.getVisibleOptions();if(e){let t=[];this.disabledSelectedOptions&&this.disabledSelectedOptions.length>0&&(t=[...this.disabledSelectedOptions]);for(let i=0;i<e.length;i++){e[i].disabled||t.push(e[i].value)}this.value=t}}this.onModelChange(this.value),this.onChange.emit({originalEvent:e,value:this.value}),this.updateFilledState(),this.updateLabel()}isAllChecked(){if(this.filterValue&&this.filterValue.trim().length)return this.value&&this.visibleOptions&&this.visibleOptions.length&&this.isAllVisibleOptionsChecked();{let e=this.getEnabledOptionCount(),t=this.disabledSelectedOptions.length;return this.value&&this.options&&this.value.length>0&&this.value.length==e+t}}isAllVisibleOptionsChecked(){if(this.visibleOptions&&0!==this.visibleOptions.length){for(let e of this.visibleOptions)if(!this.isSelected(e.value))return!1;return!0}return!1}getEnabledOptionCount(){if(this.options){let e=0;for(let t of this.options)t.disabled||e++;return e}return 0}setDisabledSelectedOptions(){if(this.options&&(this.disabledSelectedOptions=[],this.value))for(let e of this.options)e.disabled&&this.isSelected(e.value)&&this.disabledSelectedOptions.push(e.value)}show(){this.overlayVisible||(this.overlayVisible=!0)}onOverlayAnimationStart(e){switch(e.toState){case"visible":this.overlay=e.element,this.appendOverlay(),this.autoZIndex&&(this.overlay.style.zIndex=String(this.baseZIndex+ ++DomHandler.zindex)),this.alignOverlay(),this.bindDocumentClickListener(),this.bindDocumentResizeListener(),this.filterInputChild&&this.filterInputChild.nativeElement&&(this.preventModelTouched=!0,this.autofocusFilter&&this.filterInputChild.nativeElement.focus()),this.onPanelShow.emit();break;case"void":this.onOverlayHide()}}appendOverlay(){this.appendTo&&("body"===this.appendTo?document.body.appendChild(this.overlay):DomHandler.appendChild(this.overlay,this.appendTo),this.overlay.style.minWidth||(this.overlay.style.minWidth=DomHandler.getWidth(this.containerViewChild.nativeElement)+"px"))}restoreOverlayAppend(){this.overlay&&this.appendTo&&this.el.nativeElement.appendChild(this.overlay)}alignOverlay(){this.overlay&&(this.appendTo?DomHandler.absolutePosition(this.overlay,this.containerViewChild.nativeElement):DomHandler.relativePosition(this.overlay,this.containerViewChild.nativeElement))}hide(){this.overlayVisible=!1,this.unbindDocumentClickListener(),this.resetFilterOnHide&&(this.filterInputChild.nativeElement.value="",this.onFilter()),this.onPanelHide.emit(),this.cd.markForCheck()}close(e){this.hide(),e.preventDefault(),e.stopPropagation()}onMouseclick(e,t){this.disabled||this.readonly||e.target.isSameNode(this.accessibleViewChild.nativeElement)||(this.onClick.emit(e),this.isOverlayClick(e)||(this.overlayVisible?this.hide():(t.focus(),this.show())))}isOverlayClick(e){return this.overlay&&this.overlay.contains(e.target)}isOutsideClicked(e){return!(this.el.nativeElement.isSameNode(e.target)||this.el.nativeElement.contains(e.target)||this.isOverlayClick(e))}onInputFocus(e){this.focus=!0,this.onFocus.emit({originalEvent:e})}onInputBlur(e){this.focus=!1,this.onBlur.emit({originalEvent:e}),this.preventModelTouched||this.onModelTouched(),this.preventModelTouched=!1}onOptionKeydown(e){if(!this.readonly)switch(e.originalEvent.which){case 40:var t=this.findNextItem(e.originalEvent.target.parentElement);t&&t.focus(),e.originalEvent.preventDefault();break;case 38:var i=this.findPrevItem(e.originalEvent.target.parentElement);i&&i.focus(),e.originalEvent.preventDefault();break;case 13:this.onOptionClick(e),e.originalEvent.preventDefault()}}findNextItem(e){let t=e.nextElementSibling;return t?DomHandler.hasClass(t.children[0],"p-disabled")||DomHandler.isHidden(t.children[0])?this.findNextItem(t):t.children[0]:null}findPrevItem(e){let t=e.previousElementSibling;return t?DomHandler.hasClass(t.children[0],"p-disabled")||DomHandler.isHidden(t.children[0])?this.findPrevItem(t):t.children[0]:null}onKeydown(e){switch(e.which){case 40:!this.overlayVisible&&e.altKey&&(this.show(),e.preventDefault());break;case 32:this.overlayVisible||(this.show(),e.preventDefault());break;case 27:this.hide()}}updateLabel(){if(this.value&&this.options&&this.value.length&&this.displaySelectedLabel){let e="";for(let t=0;t<this.value.length;t++){let i=this.findLabelByValue(this.value[t]);i&&(e.length>0&&(e+=", "),e+=i)}if(this.value.length<=this.maxSelectedLabels)this.valuesAsString=e;else{let e=/{(.*?)}/;e.test(this.selectedItemsLabel)?this.valuesAsString=this.selectedItemsLabel.replace(this.selectedItemsLabel.match(e)[0],this.value.length+""):this.valuesAsString=this.selectedItemsLabel}}else this.valuesAsString=this.placeholder||this.defaultLabel}findLabelByValue(e){let t=null;for(let i=0;i<this.options.length;i++){let l=this.options[i];if(null==e&&null==l.value||ObjectUtils.equals(e,l.value,this.dataKey)){t=l.label;break}}return t}onFilter(){let e=this.filterInputChild.nativeElement.value;e&&e.length?(this.filterValue=e,this.activateFilter()):(this.filterValue=null,this.visibleOptions=this.options,this.filtered=!1)}activateFilter(){if(this.options&&this.options.length){let e=this.filterBy.split(",");this.visibleOptions=FilterUtils.filter(this.options,e,this.filterValue,this.filterMatchMode,this.filterLocale),this.filtered=!0}}isItemVisible(e){if(!this.filterValue||!this.filterValue.trim().length)return!0;for(let t=0;t<this.visibleOptions.length;t++)if(this.visibleOptions[t].value==e.value)return!0}getVisibleOptions(){return this.visibleOptions||this.options}onHeaderCheckboxFocus(){this.headerCheckboxFocus=!0}onHeaderCheckboxBlur(){this.headerCheckboxFocus=!1}bindDocumentClickListener(){this.documentClickListener||(this.documentClickListener=this.renderer.listen("document","click",e=>{this.isOutsideClicked(e)&&this.hide()}))}unbindDocumentClickListener(){this.documentClickListener&&(this.documentClickListener(),this.documentClickListener=null)}bindDocumentResizeListener(){this.documentResizeListener=this.onWindowResize.bind(this),window.addEventListener("resize",this.documentResizeListener)}unbindDocumentResizeListener(){this.documentResizeListener&&(window.removeEventListener("resize",this.documentResizeListener),this.documentResizeListener=null)}onWindowResize(){DomHandler.isAndroid()||this.hide()}onOverlayHide(){this.unbindDocumentClickListener(),this.unbindDocumentResizeListener(),this.overlay=null,this.onModelTouched()}ngOnDestroy(){this.restoreOverlayAppend(),this.onOverlayHide()}};MultiSelect.ctorParameters=(()=>[{type:ElementRef},{type:Renderer2},{type:ChangeDetectorRef}]),MultiSelect.decorators=[{type:Component,args:[{selector:"p-multiSelect",template:'\n        <div #container [ngClass]="{\'p-multiselect p-component\':true,\'p-multiselect-open\':overlayVisible,\'p-focus\':focus,\'p-disabled\': disabled}" [ngStyle]="style" [class]="styleClass"\n            (click)="onMouseclick($event,in)">\n            <div class="p-hidden-accessible">\n                <input #in type="text" readonly="readonly" [attr.id]="inputId" [attr.name]="name" (focus)="onInputFocus($event)" (blur)="onInputBlur($event)"\n                       [disabled]="disabled" [attr.tabindex]="tabindex" (keydown)="onKeydown($event)" aria-haspopup="listbox" [attr.aria-expanded]="overlayVisible"\n                       [attr.aria-labelledby]="ariaLabelledBy" role="listbox">\n            </div>\n            <div class="p-multiselect-label-container" [pTooltip]="tooltip" [tooltipPosition]="tooltipPosition" [positionStyle]="tooltipPositionStyle" [tooltipStyleClass]="tooltipStyleClass">\n                <div class="p-multiselect-label" [ngClass]="{\'p-placeholder\': valuesAsString === (defaultLabel || placeholder), \'p-multiselect-label-empty\': ((valuesAsString == null || valuesAsString.length === 0) && (placeholder == null || placeholder.length === 0))}">\n                    <ng-container *ngIf="!selectedItemsTemplate">{{valuesAsString || \'empty\'}}</ng-container>\n                    <ng-container *ngTemplateOutlet="selectedItemsTemplate; context: {$implicit: value}"></ng-container>\n                </div>\n            </div>\n            <div [ngClass]="{\'p-multiselect-trigger\':true}">\n                <span class="p-multiselect-trigger-icon" [ngClass]="dropdownIcon"></span>\n            </div>\n            <div *ngIf="overlayVisible" [ngClass]="[\'p-multiselect-panel p-component\']" [@overlayAnimation]="{value: \'visible\', params: {showTransitionParams: showTransitionOptions, hideTransitionParams: hideTransitionOptions}}" (@overlayAnimation.start)="onOverlayAnimationStart($event)"\n                [ngStyle]="panelStyle" [class]="panelStyleClass" (keydown)="onKeydown($event)">\n                <div class="p-multiselect-header" *ngIf="showHeader">\n                    <ng-content select="p-header"></ng-content>\n                    <ng-container *ngTemplateOutlet="headerTemplate"></ng-container>\n                    <div class="p-checkbox p-component" *ngIf="showToggleAll && !selectionLimit">\n                        <div class="p-hidden-accessible">\n                            <input type="checkbox" readonly="readonly" [checked]="isAllChecked()" (focus)="onHeaderCheckboxFocus()" (blur)="onHeaderCheckboxBlur()" (keydown.space)="toggleAll($event)">\n                        </div>\n                        <div class="p-checkbox-box" role="checkbox" [attr.aria-checked]="isAllChecked()" [ngClass]="{\'p-highlight\':isAllChecked(), \'p-focus\': headerCheckboxFocus}" (click)="toggleAll($event)">\n                            <span class="p-checkbox-icon" [ngClass]="{\'pi pi-check\':isAllChecked()}"></span>\n                        </div>\n                    </div>\n                    <div class="p-multiselect-filter-container" *ngIf="filter">\n                        <input #filterInput type="text" role="textbox" [value]="filterValue||\'\'" (input)="onFilter()" class="p-multiselect-filter p-inputtext p-component" [attr.placeholder]="filterPlaceHolder" [attr.aria-label]="ariaFilterLabel">\n                        <span class="p-multiselect-filter-icon pi pi-search"></span>\n                    </div>\n                    <button class="p-multiselect-close p-link" type="button" (click)="close($event)" pRipple>\n                        <span class="p-multiselect-close-icon pi pi-times"></span>\n                    </button>\n                </div>\n                <div class="p-multiselect-items-wrapper" [style.max-height]="virtualScroll ? \'auto\' : (scrollHeight||\'auto\')">\n                    <ul class="p-multiselect-items p-component" role="listbox" aria-multiselectable="true">\n                        <ng-container *ngIf="!virtualScroll; else virtualScrollList">\n                            <ng-template ngFor let-option let-i="index" [ngForOf]="options">\n                                <p-multiSelectItem [option]="option" [selected]="isSelected(option.value)" (onClick)="onOptionClick($event)" (onKeydown)="onOptionKeydown($event)"\n                                        [maxSelectionLimitReached]="maxSelectionLimitReached" [visible]="isItemVisible(option)" [template]="itemTemplate"></p-multiSelectItem>\n                            </ng-template>\n                        </ng-container>\n                        <ng-template #virtualScrollList>\n                            <cdk-virtual-scroll-viewport #viewport [ngStyle]="{\'height\': scrollHeight}" [itemSize]="itemSize" *ngIf="virtualScroll && visibleOptions && visibleOptions.length">\n                                <ng-container *cdkVirtualFor="let option of visibleOptions; let i = index; let c = count; let f = first; let l = last; let e = even; let o = odd">\n                                    <p-multiSelectItem [option]="option" [selected]="isSelected(option.value)" (onClick)="onOptionClick($event)" (onKeydown)="onOptionKeydown($event)"\n                                        [maxSelectionLimitReached]="maxSelectionLimitReached" [visible]="isItemVisible(option)" [template]="itemTemplate" [itemSize]="itemSize"></p-multiSelectItem>\n                                </ng-container>\n                            </cdk-virtual-scroll-viewport>\n                        </ng-template>\n                        <li *ngIf="filter && visibleOptions && visibleOptions.length === 0" class="p-multiselect-empty-message">{{emptyFilterMessage}}</li>\n                    </ul>\n                </div>\n                <div class="p-multiselect-footer" *ngIf="footerFacet || footerTemplate">\n                    <ng-content select="p-footer"></ng-content>\n                    <ng-container *ngTemplateOutlet="footerTemplate"></ng-container>\n                </div>\n            </div>\n        </div>\n    ',animations:[trigger("overlayAnimation",[transition(":enter",[style({opacity:0,transform:"scaleY(0.8)"}),animate("{{showTransitionParams}}")]),transition(":leave",[animate("{{hideTransitionParams}}",style({opacity:0}))])])],host:{"[class.p-inputwrapper-filled]":"filled","[class.p-inputwrapper-focus]":"focus"},providers:[MULTISELECT_VALUE_ACCESSOR],changeDetection:ChangeDetectionStrategy.OnPush,encapsulation:ViewEncapsulation.None,styles:[".p-multiselect{display:-ms-inline-flexbox;display:inline-flex;cursor:pointer;position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.p-multiselect-trigger{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;-ms-flex-negative:0;flex-shrink:0}.p-multiselect-label-container{overflow:hidden;-ms-flex:1 1 auto;flex:1 1 auto;cursor:pointer}.p-multiselect-label{display:block;white-space:nowrap;cursor:pointer;overflow:hidden;text-overflow:ellipsis}.p-multiselect-label-empty{overflow:hidden;visibility:hidden}.p-multiselect .p-multiselect-panel{min-width:100%}.p-multiselect-panel{position:absolute}.p-multiselect-items-wrapper{overflow:auto}.p-multiselect-items{margin:0;padding:0;list-style-type:none}.p-multiselect-item{cursor:pointer;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;font-weight:400;white-space:nowrap;position:relative;overflow:hidden}.p-multiselect-header{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:justify;justify-content:space-between}.p-multiselect-filter-container{position:relative;-ms-flex:1 1 auto;flex:1 1 auto}.p-multiselect-filter-icon{position:absolute;top:50%;margin-top:-.5rem}.p-multiselect-filter-container .p-inputtext{width:100%}.p-multiselect-close{display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:center;justify-content:center;-ms-flex-negative:0;flex-shrink:0;overflow:hidden;position:relative}.p-fluid .p-multiselect{display:-ms-flexbox;display:flex}"]}]}],MultiSelect.ctorParameters=(()=>[{type:ElementRef},{type:Renderer2},{type:ChangeDetectorRef}]),MultiSelect.propDecorators={scrollHeight:[{type:Input}],defaultLabel:[{type:Input}],placeholder:[{type:Input}],style:[{type:Input}],styleClass:[{type:Input}],panelStyle:[{type:Input}],panelStyleClass:[{type:Input}],inputId:[{type:Input}],disabled:[{type:Input}],readonly:[{type:Input}],filter:[{type:Input}],filterPlaceHolder:[{type:Input}],filterLocale:[{type:Input}],overlayVisible:[{type:Input}],tabindex:[{type:Input}],appendTo:[{type:Input}],dataKey:[{type:Input}],name:[{type:Input}],ariaLabelledBy:[{type:Input}],displaySelectedLabel:[{type:Input}],maxSelectedLabels:[{type:Input}],selectionLimit:[{type:Input}],selectedItemsLabel:[{type:Input}],showToggleAll:[{type:Input}],emptyFilterMessage:[{type:Input}],resetFilterOnHide:[{type:Input}],dropdownIcon:[{type:Input}],optionLabel:[{type:Input}],showHeader:[{type:Input}],autoZIndex:[{type:Input}],baseZIndex:[{type:Input}],filterBy:[{type:Input}],virtualScroll:[{type:Input}],itemSize:[{type:Input}],showTransitionOptions:[{type:Input}],hideTransitionOptions:[{type:Input}],ariaFilterLabel:[{type:Input}],filterMatchMode:[{type:Input}],tooltip:[{type:Input}],tooltipPosition:[{type:Input}],tooltipPositionStyle:[{type:Input}],tooltipStyleClass:[{type:Input}],autofocusFilter:[{type:Input}],containerViewChild:[{type:ViewChild,args:["container"]}],filterInputChild:[{type:ViewChild,args:["filterInput"]}],accessibleViewChild:[{type:ViewChild,args:["in"]}],footerFacet:[{type:ContentChild,args:[Footer]}],headerFacet:[{type:ContentChild,args:[Header]}],templates:[{type:ContentChildren,args:[PrimeTemplate]}],onChange:[{type:Output}],onFocus:[{type:Output}],onBlur:[{type:Output}],onClick:[{type:Output}],onPanelShow:[{type:Output}],onPanelHide:[{type:Output}],options:[{type:Input}]};export class MultiSelectModule{};MultiSelectModule.decorators=[{type:NgModule,args:[{imports:[CommonModule,SharedModule,ScrollingModule,TooltipModule,RippleModule],exports:[MultiSelect,SharedModule,ScrollingModule],declarations:[MultiSelect,MultiSelectItem]}]}];