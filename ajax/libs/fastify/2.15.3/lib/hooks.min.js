"use strict";const supportedHooks=["onRequest","preParsing","preValidation","preSerialization","preHandler","onResponse","onSend","onError","onRoute","onRegister","onReady","onClose"],{codes:{FST_ERR_HOOK_INVALID_TYPE:FST_ERR_HOOK_INVALID_TYPE,FST_ERR_HOOK_INVALID_HANDLER:FST_ERR_HOOK_INVALID_HANDLER,FST_ERR_SEND_UNDEFINED_ERR:FST_ERR_SEND_UNDEFINED_ERR}}=require("./errors"),{kChildren:kChildren,kHooks:kHooks}=require("./symbols");function Hooks(){this.onRequest=[],this.preParsing=[],this.preValidation=[],this.preSerialization=[],this.preHandler=[],this.onResponse=[],this.onSend=[],this.onError=[],this.onReady=[]}function buildHooks(n){const o=new Hooks;return o.onRequest=n.onRequest.slice(),o.preParsing=n.preParsing.slice(),o.preValidation=n.preValidation.slice(),o.preSerialization=n.preSerialization.slice(),o.preHandler=n.preHandler.slice(),o.onSend=n.onSend.slice(),o.onResponse=n.onResponse.slice(),o.onError=n.onError.slice(),o.onReady=[],o}function hookRunnerApplication(n,o,e,t){const i=e[kHooks][n];var r=0,s=0;function u(n){n?t(n):t()}!function t(l){if(l)return void u(l);if(r===i.length&&s===e[kChildren].length)return void(0===r&&0===s?u():o(function(n,o){u(n),o(n)}));if(r===i.length&&s<e[kChildren].length){const i=e[kChildren][s++];return void hookRunnerApplication(n,o,i,t)}o(function(n,o){return function(e,t){if(e)return void t(e);if(1===n.length){try{n.call(o,t)}catch(n){t(n)}return}const i=n.call(o);i&&"function"==typeof i.then?i.then(t,t):t(e)}}(i[r++],e));t()}()}function hookRunner(n,o,e,t,i){var r=0;function s(R){if(R||r===n.length)return void i(R,e,t);const c=o(n[r++],e,t,s);c&&"function"==typeof c.then&&c.then(u,l)}function u(){s()}function l(n){void 0===n&&(n=new FST_ERR_SEND_UNDEFINED_ERR),i(n,e,t)}s()}function onSendHookRunner(n,o,e,t,i){var r=0;function s(R,c){if(R)return void i(R,o,e,t);if(void 0!==c&&(t=c),r===n.length)return void i(null,o,e,t);const a=n[r++](o,e,t,s);a&&"function"==typeof a.then&&a.then(u,l)}function u(n){s(null,n)}function l(n){i(n,o,e,t)}s()}function hookIterator(n,o,e,t){if(!0!==e.sent)return n(o,e,t)}Hooks.prototype.validate=function(n,o){if("string"!=typeof n)throw new FST_ERR_HOOK_INVALID_TYPE;if("function"!=typeof o)throw new FST_ERR_HOOK_INVALID_HANDLER;if(-1===supportedHooks.indexOf(n))throw new Error(`${n} hook not supported!`)},Hooks.prototype.add=function(n,o){this.validate(n,o),this[n].push(o)},module.exports={Hooks:Hooks,buildHooks:buildHooks,hookRunner:hookRunner,onSendHookRunner:onSendHookRunner,hookIterator:hookIterator,hookRunnerApplication:hookRunnerApplication};