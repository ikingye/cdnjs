import _objectWithoutProperties from"@babel/runtime/helpers/esm/objectWithoutProperties";import _extends from"@babel/runtime/helpers/esm/extends";import*as React from"react";import PropTypes from"prop-types";import{getThemeProps,useTheme}from"@material-ui/styles";import{elementAcceptingRef,HTMLElementType}from"@material-ui/utils";import ownerDocument from"../utils/ownerDocument";import Portal from"../Portal";import createChainedFunction from"../utils/createChainedFunction";import useForkRef from"../utils/useForkRef";import useEventCallback from"../utils/useEventCallback";import zIndex from"../styles/zIndex";import ModalManager,{ariaHidden}from"./ModalManager";import TrapFocus from"../Unstable_TrapFocus";import SimpleBackdrop from"./SimpleBackdrop";function getContainer(e){return"function"==typeof e?e():e}function getHasTransition(e){return!!e.children&&e.children.props.hasOwnProperty("in")}var defaultManager=new ModalManager;export var styles=function(e){return{root:{position:"fixed",zIndex:e.zIndex.modal,right:0,bottom:0,top:0,left:0},hidden:{visibility:"hidden"}}};var Modal=React.forwardRef(function(e,o){var r=useTheme(),n=getThemeProps({name:"MuiModal",props:_extends({},e),theme:r}),t=n.BackdropComponent,a=void 0===t?SimpleBackdrop:t,i=n.BackdropProps,c=n.children,s=n.closeAfterTransition,p=void 0!==s&&s,l=n.container,d=n.disableAutoFocus,u=void 0!==d&&d,f=n.disableBackdropClick,m=void 0!==f&&f,b=n.disableEnforceFocus,y=void 0!==b&&b,k=n.disableEscapeKeyDown,T=void 0!==k&&k,P=n.disablePortal,R=void 0!==P&&P,E=n.disableRestoreFocus,h=void 0!==E&&E,v=n.disableScrollLock,C=void 0!==v&&v,F=n.hideBackdrop,g=void 0!==F&&F,x=n.keepMounted,M=void 0!==x&&x,B=n.manager,w=void 0===B?defaultManager:B,D=n.onBackdropClick,A=n.onClose,I=n.onEscapeKeyDown,_=n.onRendered,K=n.open,S=_objectWithoutProperties(n,["BackdropComponent","BackdropProps","children","closeAfterTransition","container","disableAutoFocus","disableBackdropClick","disableEnforceFocus","disableEscapeKeyDown","disablePortal","disableRestoreFocus","disableScrollLock","hideBackdrop","keepMounted","manager","onBackdropClick","onClose","onEscapeKeyDown","onRendered","open"]),z=React.useState(!0),H=z[0],L=z[1],j=React.useRef({}),N=React.useRef(null),O=React.useRef(null),W=useForkRef(O,o),q=getHasTransition(n),U=function(){return ownerDocument(N.current)},V=function(){return j.current.modalRef=O.current,j.current.mountNode=N.current,j.current},G=function(){w.mount(V(),{disableScrollLock:C}),O.current.scrollTop=0},J=useEventCallback(function(){var e=getContainer(l)||U().body;w.add(V(),e),O.current&&G()}),Q=React.useCallback(function(){return w.isTopModal(V())},[w]),X=useEventCallback(function(e){N.current=e,e&&(_&&_(),K&&Q()?G():ariaHidden(O.current,!0))}),Y=React.useCallback(function(){w.remove(V())},[w]);if(React.useEffect(function(){return function(){Y()}},[Y]),React.useEffect(function(){K?J():q&&p||Y()},[K,Y,q,p,J]),!M&&!K&&(!q||H))return null;var Z=styles(r||{zIndex:zIndex}),$={};return void 0===c.props.tabIndex&&($.tabIndex=c.props.tabIndex||"-1"),q&&($.onEnter=createChainedFunction(function(){L(!1)},c.props.onEnter),$.onExited=createChainedFunction(function(){L(!0),p&&Y()},c.props.onExited)),React.createElement(Portal,{ref:X,container:l,disablePortal:R},React.createElement("div",_extends({ref:W,onKeyDown:function(e){"Escape"===e.key&&Q()&&(I&&I(e),T||(e.stopPropagation(),A&&A(e,"escapeKeyDown")))},role:"presentation"},S,{style:_extends({},Z.root,!K&&H?Z.hidden:{},S.style)}),g?null:React.createElement(a,_extends({open:K,onClick:function(e){e.target===e.currentTarget&&(D&&D(e),!m&&A&&A(e,"backdropClick"))}},i)),React.createElement(TrapFocus,{disableEnforceFocus:y,disableAutoFocus:u,disableRestoreFocus:h,getDoc:U,isEnabled:Q,open:K},React.cloneElement(c,$))))});"production"!==process.env.NODE_ENV&&(Modal.propTypes={BackdropComponent:PropTypes.elementType,BackdropProps:PropTypes.object,children:elementAcceptingRef.isRequired,closeAfterTransition:PropTypes.bool,container:PropTypes.oneOfType([HTMLElementType,PropTypes.func]),disableAutoFocus:PropTypes.bool,disableBackdropClick:PropTypes.bool,disableEnforceFocus:PropTypes.bool,disableEscapeKeyDown:PropTypes.bool,disablePortal:PropTypes.bool,disableRestoreFocus:PropTypes.bool,disableScrollLock:PropTypes.bool,hideBackdrop:PropTypes.bool,keepMounted:PropTypes.bool,onBackdropClick:PropTypes.func,onClose:PropTypes.func,onEscapeKeyDown:PropTypes.func,onRendered:PropTypes.func,open:PropTypes.bool.isRequired});export default Modal;