"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault"),_interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var React=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_utils=require("@material-ui/utils"),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_useForkRef=_interopRequireDefault(require("../utils/useForkRef"));function Unstable_TrapFocus(e){var r=e.children,t=e.disableAutoFocus,n=void 0!==t&&t,u=e.disableEnforceFocus,c=void 0!==u&&u,o=e.disableRestoreFocus,s=void 0!==o&&o,a=e.getDoc,i=e.isEnabled,l=e.open,f=React.useRef(),p=React.useRef(null),d=React.useRef(null),R=React.useRef(),v=React.useRef(null),_=React.useRef(!1),b=React.useRef(null),E=(0,_useForkRef.default)(r.ref,b),m=React.useRef();React.useEffect(function(){m.current=l},[l]),m.current||!l||"undefined"==typeof window||n||(R.current=a().activeElement),React.useEffect(function(){l&&b.current&&(_.current=!n)},[n,l]),React.useEffect(function(){if(l&&b.current){var e=(0,_ownerDocument.default)(b.current);return b.current.contains(e.activeElement)||(b.current.hasAttribute("tabIndex")||("production"!==process.env.NODE_ENV&&console.error(["Material-UI: The modal content node does not accept focus.",'For the benefit of assistive technologies, the tabIndex of the node is being set to "-1".'].join("\n")),b.current.setAttribute("tabIndex",-1)),_.current&&b.current.focus()),function(){s||(R.current&&R.current.focus&&(f.current=!0,R.current.focus()),R.current=null)}}},[l]),React.useEffect(function(){if(l&&b.current){var r=(0,_ownerDocument.default)(b.current),e=function(e){var t=b.current;if(null!==t)if(r.hasFocus()&&!c&&i()&&!f.current)if(t.contains(r.activeElement))_.current=!0;else{if(e&&v.current!==e.target||r.activeElement!==v.current)v.current=null;else if(null!==v.current)return;if(!_.current)return;t.focus()}else f.current=!1},t=function(e){!c&&i()&&9===e.keyCode&&r.activeElement===b.current&&(f.current=!0,e.shiftKey?d.current.focus():p.current.focus())};r.addEventListener("focusin",e),r.addEventListener("keydown",t,!0);var n=setInterval(function(){"BODY"===r.activeElement.tagName&&e()},50);return function(){clearInterval(n),r.removeEventListener("focusin",e),r.removeEventListener("keydown",t,!0)}}},[n,c,s,i,l]);return React.createElement(React.Fragment,null,React.createElement("div",{tabIndex:0,ref:p,"data-test":"sentinelStart"}),React.cloneElement(r,{ref:E,onFocus:function(e){_.current||(R.current=e.relatedTarget),_.current=!0,v.current=e.target;var t=r.props.onFocus;t&&t(e)}}),React.createElement("div",{tabIndex:0,ref:d,"data-test":"sentinelEnd"}))}"production"!==process.env.NODE_ENV&&(Unstable_TrapFocus.propTypes={children:_utils.elementAcceptingRef,disableAutoFocus:_propTypes.default.bool,disableEnforceFocus:_propTypes.default.bool,disableRestoreFocus:_propTypes.default.bool,getDoc:_propTypes.default.func.isRequired,isEnabled:_propTypes.default.func.isRequired,open:_propTypes.default.bool.isRequired}),"production"!==process.env.NODE_ENV&&(Unstable_TrapFocus.propTypes=(0,_utils.exactProp)(Unstable_TrapFocus.propTypes));var _default=Unstable_TrapFocus;exports.default=Unstable_TrapFocus;