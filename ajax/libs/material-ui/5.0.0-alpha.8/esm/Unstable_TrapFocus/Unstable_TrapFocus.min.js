import*as React from"react";import PropTypes from"prop-types";import{exactProp,elementAcceptingRef}from"@material-ui/utils";import ownerDocument from"../utils/ownerDocument";import useForkRef from"../utils/useForkRef";function Unstable_TrapFocus(e){var t=e.children,r=e.disableAutoFocus,n=void 0!==r&&r,c=e.disableEnforceFocus,o=void 0!==c&&c,u=e.disableRestoreFocus,s=void 0!==u&&u,a=e.getDoc,i=e.isEnabled,f=e.open,l=React.useRef(),p=React.useRef(null),d=React.useRef(null),R=React.useRef(),m=React.useRef(null),v=React.useRef(!1),E=React.useRef(null),b=useForkRef(t.ref,E),F=React.useRef();React.useEffect(function(){F.current=f},[f]),F.current||!f||"undefined"==typeof window||n||(R.current=a().activeElement),React.useEffect(function(){f&&E.current&&(v.current=!n)},[n,f]),React.useEffect(function(){if(f&&E.current){var e=ownerDocument(E.current);return E.current.contains(e.activeElement)||(E.current.hasAttribute("tabIndex")||("production"!==process.env.NODE_ENV&&console.error(["Material-UI: The modal content node does not accept focus.",'For the benefit of assistive technologies, the tabIndex of the node is being set to "-1".'].join("\n")),E.current.setAttribute("tabIndex",-1)),v.current&&E.current.focus()),function(){s||(R.current&&R.current.focus&&(l.current=!0,R.current.focus()),R.current=null)}}},[f]),React.useEffect(function(){if(f&&E.current){var e=ownerDocument(E.current),t=function(t){var r=E.current;if(null!==r)if(e.hasFocus()&&!o&&i()&&!l.current)if(r.contains(e.activeElement))v.current=!0;else{if(t&&m.current!==t.target||e.activeElement!==m.current)m.current=null;else if(null!==m.current)return;if(!v.current)return;r.focus()}else l.current=!1},r=function(t){!o&&i()&&9===t.keyCode&&e.activeElement===E.current&&(l.current=!0,t.shiftKey?d.current.focus():p.current.focus())};e.addEventListener("focusin",t),e.addEventListener("keydown",r,!0);var n=setInterval(function(){"BODY"===e.activeElement.tagName&&t()},50);return function(){clearInterval(n),e.removeEventListener("focusin",t),e.removeEventListener("keydown",r,!0)}}},[n,o,s,i,f]);return React.createElement(React.Fragment,null,React.createElement("div",{tabIndex:0,ref:p,"data-test":"sentinelStart"}),React.cloneElement(t,{ref:b,onFocus:function(e){v.current||(R.current=e.relatedTarget),v.current=!0,m.current=e.target;var r=t.props.onFocus;r&&r(e)}}),React.createElement("div",{tabIndex:0,ref:d,"data-test":"sentinelEnd"}))}"production"!==process.env.NODE_ENV&&(Unstable_TrapFocus.propTypes={children:elementAcceptingRef,disableAutoFocus:PropTypes.bool,disableEnforceFocus:PropTypes.bool,disableRestoreFocus:PropTypes.bool,getDoc:PropTypes.func.isRequired,isEnabled:PropTypes.func.isRequired,open:PropTypes.bool.isRequired}),"production"!==process.env.NODE_ENV&&(Unstable_TrapFocus.propTypes=exactProp(Unstable_TrapFocus.propTypes));export default Unstable_TrapFocus;