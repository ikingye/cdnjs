import getScrollbarSize from"../utils/getScrollbarSize";import ownerDocument from"../utils/ownerDocument";import ownerWindow from"../utils/ownerWindow";function isOverflowing(e){const n=ownerDocument(e);return n.body===e?ownerWindow(e).innerWidth>n.documentElement.clientWidth:e.scrollHeight>e.clientHeight}export function ariaHidden(e,n){n?e.setAttribute("aria-hidden","true"):e.removeAttribute("aria-hidden")};function getPaddingRight(e){return parseInt(ownerWindow(e).getComputedStyle(e)["padding-right"],10)||0}function ariaHiddenSiblings(e,n,t,i=[],o){const r=[n,t,...i],d=["TEMPLATE","SCRIPT","STYLE"];[].forEach.call(e.children,e=>{1===e.nodeType&&-1===r.indexOf(e)&&-1===d.indexOf(e.tagName)&&ariaHidden(e,o)})}function findIndexOf(e,n){let t=-1;return e.some((e,i)=>!!n(e)&&(t=i,!0)),t}function handleContainer(e,n){const t=[],i=[],o=e.container;let r;if(!n.disableScrollLock){if(isOverflowing(o)){const e=getScrollbarSize(ownerDocument(o));t.push({value:o.style.paddingRight,key:"padding-right",el:o}),o.style["padding-right"]=`${getPaddingRight(o)+e}px`,r=ownerDocument(o).querySelectorAll(".mui-fixed"),[].forEach.call(r,n=>{i.push(n.style.paddingRight),n.style.paddingRight=`${getPaddingRight(n)+e}px`})}const e=o.parentElement,n=ownerWindow(o),d="HTML"===e.nodeName&&"scroll"===n.getComputedStyle(e)["overflow-y"]?e:o;t.push({value:d.style.overflow,key:"overflow",el:d}),d.style.overflow="hidden"}return()=>{r&&[].forEach.call(r,(e,n)=>{i[n]?e.style.paddingRight=i[n]:e.style.removeProperty("padding-right")}),t.forEach(({value:e,el:n,key:t})=>{e?n.style.setProperty(t,e):n.style.removeProperty(t)})}}function getHiddenSiblings(e){const n=[];return[].forEach.call(e.children,e=>{e.getAttribute&&"true"===e.getAttribute("aria-hidden")&&n.push(e)}),n}export default class ModalManager{constructor(){this.modals=[],this.containers=[]}add(e,n){let t=this.modals.indexOf(e);if(-1!==t)return t;t=this.modals.length,this.modals.push(e),e.modalRef&&ariaHidden(e.modalRef,!1);const i=getHiddenSiblings(n);ariaHiddenSiblings(n,e.mountNode,e.modalRef,i,!0);const o=findIndexOf(this.containers,e=>e.container===n);return-1!==o?(this.containers[o].modals.push(e),t):(this.containers.push({modals:[e],container:n,restore:null,hiddenSiblingNodes:i}),t)}mount(e,n){const t=findIndexOf(this.containers,n=>-1!==n.modals.indexOf(e)),i=this.containers[t];i.restore||(i.restore=handleContainer(i,n))}remove(e){const n=this.modals.indexOf(e);if(-1===n)return n;const t=findIndexOf(this.containers,n=>-1!==n.modals.indexOf(e)),i=this.containers[t];if(i.modals.splice(i.modals.indexOf(e),1),this.modals.splice(n,1),0===i.modals.length)i.restore&&i.restore(),e.modalRef&&ariaHidden(e.modalRef,!0),ariaHiddenSiblings(i.container,e.mountNode,e.modalRef,i.hiddenSiblingNodes,!1),this.containers.splice(t,1);else{const e=i.modals[i.modals.length-1];e.modalRef&&ariaHidden(e.modalRef,!1)}return n}isTopModal(e){return this.modals.length>0&&this.modals[this.modals.length-1]===e}};