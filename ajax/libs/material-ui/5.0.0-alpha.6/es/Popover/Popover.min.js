import _extends from"@babel/runtime/helpers/esm/extends";import _objectWithoutPropertiesLoose from"@babel/runtime/helpers/esm/objectWithoutPropertiesLoose";import*as React from"react";import PropTypes from"prop-types";import{chainPropTypes,elementTypeAcceptingRef,refType,HTMLElementType}from"@material-ui/utils";import clsx from"clsx";import debounce from"../utils/debounce";import ownerDocument from"../utils/ownerDocument";import ownerWindow from"../utils/ownerWindow";import createChainedFunction from"../utils/createChainedFunction";import withStyles from"../styles/withStyles";import Modal from"../Modal";import Grow from"../Grow";import Paper from"../Paper";export function getOffsetTop(e,o){let n=0;return"number"==typeof o?n=o:"center"===o?n=e.height/2:"bottom"===o&&(n=e.height),n};export function getOffsetLeft(e,o){let n=0;return"number"==typeof o?n=o:"center"===o?n=e.width/2:"right"===o&&(n=e.width),n};function getTransformOriginValue(e){return[e.horizontal,e.vertical].map(e=>"number"==typeof e?`${e}px`:e).join(" ")}function getScrollParent(e,o){let n=o,t=0;for(;n&&n!==e;)t+=(n=n.parentElement).scrollTop;return t}function getAnchorEl(e){return"function"==typeof e?e():e}export const styles={root:{},paper:{position:"absolute",overflowY:"auto",overflowX:"hidden",minWidth:16,minHeight:16,maxWidth:"calc(100% - 32px)",maxHeight:"calc(100% - 32px)",outline:0}};const Popover=React.forwardRef(function(e,o){const{action:n,anchorEl:t,anchorOrigin:r={vertical:"top",horizontal:"left"},anchorPosition:i,anchorReference:p="anchorEl",children:s,classes:a,className:c,container:l,elevation:h=8,getContentAnchorEl:u,marginThreshold:f=16,onEnter:m,onEntered:d,onEntering:T,onExit:y,onExited:P,onExiting:g,open:E,PaperProps:v={},transformOrigin:b={vertical:"top",horizontal:"left"},TransitionComponent:O=Grow,transitionDuration:x="auto",TransitionProps:R={}}=e,w=_objectWithoutPropertiesLoose(e,["action","anchorEl","anchorOrigin","anchorPosition","anchorReference","children","classes","className","container","elevation","getContentAnchorEl","marginThreshold","onEnter","onEntered","onEntering","onExit","onExited","onExiting","open","PaperProps","transformOrigin","TransitionComponent","transitionDuration","TransitionProps"]),C=React.useRef(),N=React.useCallback(e=>{if("anchorPosition"===p)return"production"!==process.env.NODE_ENV&&(i||console.error('Material-UI: You need to provide a `anchorPosition` prop when using <Popover anchorReference="anchorPosition" />.')),i;const o=getAnchorEl(t),n=o&&1===o.nodeType?o:ownerDocument(C.current).body,s=n.getBoundingClientRect();if("production"!==process.env.NODE_ENV){const e=n.getBoundingClientRect();"test"!==process.env.NODE_ENV&&0===e.top&&0===e.left&&0===e.right&&0===e.bottom&&console.warn(["Material-UI: The `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}const a=0===e?r.vertical:"center";return{top:s.top+getOffsetTop(s,a),left:s.left+getOffsetLeft(s,r.horizontal)}},[t,r.horizontal,r.vertical,i,p]),M=React.useCallback(e=>{let o=0;if(u&&"anchorEl"===p){const n=u(e);if(n&&e.contains(n)){const t=getScrollParent(e,n);o=n.offsetTop+n.clientHeight/2-t||0}"production"!==process.env.NODE_ENV&&"top"!==r.vertical&&console.error(["Material-UI: You can not change the default `anchorOrigin.vertical` value ","when also providing the `getContentAnchorEl` prop to the popover component.","Only use one of the two props.","Set `getContentAnchorEl` to `null | undefined` or leave `anchorOrigin.vertical` unchanged."].join("\n"))}return o},[r.vertical,p,u]),z=React.useCallback((e,o=0)=>({vertical:getOffsetTop(e,b.vertical)+o,horizontal:getOffsetLeft(e,b.horizontal)}),[b.horizontal,b.vertical]),D=React.useCallback(e=>{const o=M(e),n={width:e.offsetWidth,height:e.offsetHeight},r=z(n,o);if("none"===p)return{top:null,left:null,transformOrigin:getTransformOriginValue(r)};const i=N(o);let s=i.top-r.vertical,a=i.left-r.horizontal;const c=s+n.height,l=a+n.width,h=ownerWindow(getAnchorEl(t)),u=h.innerHeight-f,m=h.innerWidth-f;if(s<f){const e=s-f;s-=e,r.vertical+=e}else if(c>u){const e=c-u;s-=e,r.vertical+=e}if("production"!==process.env.NODE_ENV&&n.height>u&&n.height&&u&&console.error(["Material-UI: The popover component is too tall.",`Some part of it can not be seen on the screen (${n.height-u}px).`,"Please consider adding a `max-height` to improve the user-experience."].join("\n")),a<f){const e=a-f;a-=e,r.horizontal+=e}else if(l>m){const e=l-m;a-=e,r.horizontal+=e}return{top:`${Math.round(s)}px`,left:`${Math.round(a)}px`,transformOrigin:getTransformOriginValue(r)}},[t,p,N,M,z,f]),A=React.useCallback(()=>{const e=C.current;if(!e)return;const o=D(e);null!==o.top&&(e.style.top=o.top),null!==o.left&&(e.style.left=o.left),e.style.transformOrigin=o.transformOrigin},[D]);React.useEffect(()=>{E&&A()}),React.useImperativeHandle(n,()=>E?{updatePosition:()=>{A()}}:null,[E,A]),React.useEffect(()=>{if(!E)return;const e=debounce(()=>{A()}),o=ownerWindow(t);return o.addEventListener("resize",e),()=>{e.clear(),o.removeEventListener("resize",e)}},[t,E,A]);let _=x;"auto"!==x||O.muiSupportAuto||(_=void 0);const j=l||(t?ownerDocument(getAnchorEl(t)).body:void 0);return React.createElement(Modal,_extends({container:j,open:E,ref:o,BackdropProps:{invisible:!0},className:clsx(a.root,c)},w),React.createElement(O,_extends({appear:!0,in:E,onEnter:m,onEntered:d,onExit:y,onExited:P,onExiting:g,timeout:_},R,{onEntering:createChainedFunction((e,o)=>{T&&T(e,o),A()},R.onEntering)}),React.createElement(Paper,_extends({elevation:h,ref:C},v,{className:clsx(a.paper,v.className)}),s)))});"production"!==process.env.NODE_ENV&&(Popover.propTypes={action:refType,anchorEl:chainPropTypes(PropTypes.oneOfType([HTMLElementType,PropTypes.func]),e=>{if(e.open&&(!e.anchorReference||"anchorEl"===e.anchorReference)){const o=getAnchorEl(e.anchorEl);if(!o||1!==o.nodeType)return new Error(["Material-UI: The `anchorEl` prop provided to the component is invalid.",`It should be an Element instance but it's \`${o}\` instead.`].join("\n"));{const e=o.getBoundingClientRect();if("test"!==process.env.NODE_ENV&&0===e.top&&0===e.left&&0===e.right&&0===e.bottom)return new Error(["Material-UI: The `anchorEl` prop provided to the component is invalid.","The anchor element should be part of the document layout.","Make sure the element is present in the document or that it's not display none."].join("\n"))}}return null}),anchorOrigin:PropTypes.shape({horizontal:PropTypes.oneOfType([PropTypes.oneOf(["center","left","right"]),PropTypes.number]).isRequired,vertical:PropTypes.oneOfType([PropTypes.oneOf(["bottom","center","top"]),PropTypes.number]).isRequired}),anchorPosition:PropTypes.shape({left:PropTypes.number.isRequired,top:PropTypes.number.isRequired}),anchorReference:PropTypes.oneOf(["anchorEl","anchorPosition","none"]),children:PropTypes.node,classes:PropTypes.object,className:PropTypes.string,container:PropTypes.oneOfType([HTMLElementType,PropTypes.func]),elevation:PropTypes.number,getContentAnchorEl:PropTypes.func,marginThreshold:PropTypes.number,onClose:PropTypes.func,onEnter:PropTypes.func,onEntered:PropTypes.func,onEntering:PropTypes.func,onExit:PropTypes.func,onExited:PropTypes.func,onExiting:PropTypes.func,open:PropTypes.bool.isRequired,PaperProps:PropTypes.shape({component:elementTypeAcceptingRef}),transformOrigin:PropTypes.shape({horizontal:PropTypes.oneOfType([PropTypes.oneOf(["center","left","right"]),PropTypes.number]).isRequired,vertical:PropTypes.oneOfType([PropTypes.oneOf(["bottom","center","top"]),PropTypes.number]).isRequired}),TransitionComponent:PropTypes.elementType,transitionDuration:PropTypes.oneOfType([PropTypes.oneOf(["auto"]),PropTypes.number,PropTypes.shape({appear:PropTypes.number,enter:PropTypes.number,exit:PropTypes.number})]),TransitionProps:PropTypes.object});export default withStyles(styles,{name:"MuiPopover"})(Popover);