"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard"),_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.reset=reset,exports.default=void 0;var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties")),_extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),React=_interopRequireWildcard(require("react")),_propTypes=_interopRequireDefault(require("prop-types")),_utils=require("@material-ui/utils"),_styles=require("@material-ui/styles"),_Drawer=_interopRequireWildcard(require("../Drawer/Drawer")),_ownerDocument=_interopRequireDefault(require("../utils/ownerDocument")),_ownerWindow=_interopRequireDefault(require("../utils/ownerWindow")),_useEventCallback=_interopRequireDefault(require("../utils/useEventCallback")),_transitions=require("../styles/transitions"),_useTheme=_interopRequireDefault(require("../styles/useTheme")),_utils2=require("../transitions/utils"),_NoSsr=_interopRequireDefault(require("../NoSsr")),_SwipeArea=_interopRequireDefault(require("./SwipeArea")),UNCERTAINTY_THRESHOLD=3,nodeThatClaimedTheSwipe=null;function reset(){nodeThatClaimedTheSwipe=null}function calculateCurrentX(e,t,r){return"right"===e?r.body.offsetWidth-t[0].pageX:t[0].pageX}function calculateCurrentY(e,t,r){return"bottom"===e?r.innerHeight-t[0].clientY:t[0].clientY}function getMaxTranslate(e,t){return e?t.clientWidth:t.clientHeight}function getTranslate(e,t,r,n){return Math.min(Math.max(r?t-e:n+t-e,0),n)}function getDomTreeShapes(e,t){for(var r=[];e&&e!==t;){var n=(0,_ownerWindow.default)(t).getComputedStyle(e);"absolute"===n.getPropertyValue("position")||"hidden"===n.getPropertyValue("overflow-x")?r=[]:(0<e.clientWidth&&e.scrollWidth>e.clientWidth||0<e.clientHeight&&e.scrollHeight>e.clientHeight)&&r.push(e),e=e.parentElement}return r}function findNativeHandler(e){var t=e.domTreeShapes,o=e.start,u=e.current,l=e.anchor,s={x:"scrollLeft",y:"scrollTop"},c={x:"scrollWidth",y:"scrollHeight"},p={x:"clientWidth",y:"clientHeight"};return t.some(function(e){var t=o<=u;"top"!==l&&"left"!==l||(t=!t);var r="left"===l||"right"===l?"x":"y",n=e[s[r]],a=0<n,i=n+e[p[r]]<e[c[r]];return t&&i||!t&&a?e:null})}var iOS="undefined"!=typeof navigator&&/iPad|iPhone|iPod/.test(navigator.userAgent),transitionDurationDefault={enter:_transitions.duration.enteringScreen,exit:_transitions.duration.leavingScreen},useEnhancedEffect="undefined"!=typeof window?React.useLayoutEffect:React.useEffect,SwipeableDrawer=React.forwardRef(function(e,t){var f=(0,_useTheme.default)(),r=(0,_styles.getThemeProps)({name:"MuiSwipeableDrawer",props:(0,_extends2.default)({},e),theme:f}),n=r.anchor,T=void 0===n?"left":n,a=r.disableBackdropTransition,h=void 0!==a&&a,i=r.disableDiscovery,_=void 0!==i&&i,o=r.disableSwipeToOpen,u=void 0===o?iOS:o,m=r.hideBackdrop,l=r.hysteresis,s=void 0===l?.52:l,c=r.minFlingVelocity,p=void 0===c?450:c,d=r.ModalProps,v=(d=void 0===d?{}:d).BackdropProps,w=(0,_objectWithoutProperties2.default)(d,["BackdropProps"]),y=r.onClose,g=r.onOpen,b=r.open,R=r.PaperProps,D=void 0===R?{}:R,S=r.SwipeAreaProps,E=r.swipeAreaWidth,q=void 0===E?20:E,C=r.transitionDuration,P=void 0===C?transitionDurationDefault:C,x=r.variant,H=void 0===x?"temporary":x,W=(0,_objectWithoutProperties2.default)(r,["anchor","disableBackdropTransition","disableDiscovery","disableSwipeToOpen","hideBackdrop","hysteresis","minFlingVelocity","ModalProps","onClose","onOpen","open","PaperProps","SwipeAreaProps","swipeAreaWidth","transitionDuration","variant"]),A=React.useState(!1),Y=A[0],k=A[1],M=React.useRef({isSwiping:null}),O=React.useRef(),N=React.useRef(),X=React.useRef(),L=React.useRef(!1),B=React.useRef();useEnhancedEffect(function(){B.current=null},[b]);var j=React.useCallback(function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=t.mode,n=void 0===r?null:r,a=t.changeTransition,i=void 0===a||a,o=(0,_Drawer.getAnchor)(f,T),u=-1!==["right","bottom"].indexOf(o)?1:-1,l=(0,_Drawer.isHorizontal)(T),s=l?"translate(".concat(u*e,"px, 0)"):"translate(0, ".concat(u*e,"px)"),c=X.current.style;c.webkitTransform=s,c.transform=s;var p,d="";n&&(d=f.transitions.create("all",(0,_utils2.getTransitionProps)({timeout:P},{mode:n}))),i&&(c.webkitTransition=d,c.transition=d),h||m||((p=N.current.style).opacity=1-e/getMaxTranslate(l,X.current),i&&(p.webkitTransition=d,p.transition=d))},[T,h,m,f,P]),V=(0,_useEventCallback.default)(function(e){var t,r,n,a,i,o,u;L.current&&(nodeThatClaimedTheSwipe=null,L.current=!1,k(!1),M.current.isSwiping?(t=(M.current.isSwiping=null,_Drawer.getAnchor)(f,T),n=(r=(0,_Drawer.isHorizontal)(T))?calculateCurrentX(t,e.changedTouches,(0,_ownerDocument.default)(e.currentTarget)):calculateCurrentY(t,e.changedTouches,(0,_ownerWindow.default)(e.currentTarget)),a=r?M.current.startX:M.current.startY,i=getMaxTranslate(r,X.current),u=(o=getTranslate(n,a,b,i))/i,Math.abs(M.current.velocity)>p&&(B.current=1e3*Math.abs((i-o)/M.current.velocity)),b?M.current.velocity>p||s<u?y():j(0,{mode:"exit"}):M.current.velocity<-p||s<1-u?g():j(getMaxTranslate(r,X.current),{mode:"enter"})):M.current.isSwiping=null)}),I=(0,_useEventCallback.default)(function(e){if(X.current&&L.current&&(null==nodeThatClaimedTheSwipe||nodeThatClaimedTheSwipe===M.current)){var t=(0,_Drawer.getAnchor)(f,T),r=(0,_Drawer.isHorizontal)(T),n=calculateCurrentX(t,e.touches,(0,_ownerDocument.default)(e.currentTarget)),a=calculateCurrentY(t,e.touches,(0,_ownerWindow.default)(e.currentTarget));if(b&&X.current.contains(e.target)&&null==nodeThatClaimedTheSwipe){var i=findNativeHandler({domTreeShapes:getDomTreeShapes(e.target,X.current),start:r?M.current.startX:M.current.startY,current:r?n:a,anchor:T});if(i)return void(nodeThatClaimedTheSwipe=i);nodeThatClaimedTheSwipe=M.current}if(null==M.current.isSwiping){var o=Math.abs(n-M.current.startX),u=Math.abs(a-M.current.startY);u<o&&e.cancelable&&e.preventDefault();var l=r?u<o&&UNCERTAINTY_THRESHOLD<o:o<u&&UNCERTAINTY_THRESHOLD<u;if(!0==l||(r?UNCERTAINTY_THRESHOLD<u:UNCERTAINTY_THRESHOLD<o)){if(!(M.current.isSwiping=l))return void V(e);M.current.startX=n,M.current.startY=a,_||b||(r?M.current.startX-=q:M.current.startY-=q)}}if(M.current.isSwiping){var s=getMaxTranslate(r,X.current),c=r?M.current.startX:M.current.startY;b&&!M.current.paperHit&&(c=Math.min(c,s));var p=getTranslate(r?n:a,c,b,s);if(b)if(M.current.paperHit)0===p&&(M.current.startX=n,M.current.startY=a);else{if(!(r?n<s:a<s))return;M.current.paperHit=!0,M.current.startX=n,M.current.startY=a}null===M.current.lastTranslate&&(M.current.lastTranslate=p,M.current.lastTime=performance.now()+1);var d=(p-M.current.lastTranslate)/(performance.now()-M.current.lastTime)*1e3;M.current.velocity=.4*M.current.velocity+.6*d,M.current.lastTranslate=p,M.current.lastTime=performance.now(),e.cancelable&&e.preventDefault(),j(p)}}}),U=(0,_useEventCallback.default)(function(e){if(!e.defaultPrevented&&!e.muiHandled&&(!b||N.current.contains(e.target)||X.current.contains(e.target))){var t=(0,_Drawer.getAnchor)(f,T),r=(0,_Drawer.isHorizontal)(T),n=calculateCurrentX(t,e.touches,(0,_ownerDocument.default)(e.currentTarget)),a=calculateCurrentY(t,e.touches,(0,_ownerWindow.default)(e.currentTarget));if(!b){if(u||e.target!==O.current)return;if(r){if(q<n)return}else if(q<a)return}e.muiHandled=!0,nodeThatClaimedTheSwipe=null,M.current.startX=n,M.current.startY=a,k(!0),!b&&X.current&&j(getMaxTranslate(r,X.current)+(_?20:-q),{changeTransition:!1}),M.current.velocity=0,M.current.lastTime=null,M.current.lastTranslate=null,M.current.paperHit=!1,L.current=!0}});return React.useEffect(function(){if("temporary"===H){var e=(0,_ownerDocument.default)(X.current);return e.addEventListener("touchstart",U),e.addEventListener("touchmove",I,{passive:!1}),e.addEventListener("touchend",V),function(){e.removeEventListener("touchstart",U),e.removeEventListener("touchmove",I,{passive:!1}),e.removeEventListener("touchend",V)}}},[H,U,I,V]),React.useEffect(function(){return function(){nodeThatClaimedTheSwipe===M.current&&(nodeThatClaimedTheSwipe=null)}},[]),React.useEffect(function(){b||k(!1)},[b]),React.createElement(React.Fragment,null,React.createElement(_Drawer.default,(0,_extends2.default)({open:!("temporary"!==H||!Y)||b,variant:H,ModalProps:(0,_extends2.default)({BackdropProps:(0,_extends2.default)({},v,{ref:N})},w),PaperProps:(0,_extends2.default)({},D,{style:(0,_extends2.default)({pointerEvents:"temporary"!==H||b?"":"none"},D.style),ref:X}),anchor:T,transitionDuration:B.current||P,onClose:y,ref:t},W)),!u&&"temporary"===H&&React.createElement(_NoSsr.default,null,React.createElement(_SwipeArea.default,(0,_extends2.default)({anchor:T,ref:O,width:q},S))))});"production"!==process.env.NODE_ENV&&(SwipeableDrawer.propTypes={anchor:_propTypes.default.oneOf(["bottom","left","right","top"]),children:_propTypes.default.node,disableBackdropTransition:_propTypes.default.bool,disableDiscovery:_propTypes.default.bool,disableSwipeToOpen:_propTypes.default.bool,hideBackdrop:_propTypes.default.bool,hysteresis:_propTypes.default.number,minFlingVelocity:_propTypes.default.number,ModalProps:_propTypes.default.shape({BackdropProps:_propTypes.default.shape({component:_utils.elementTypeAcceptingRef})}),onClose:_propTypes.default.func.isRequired,onOpen:_propTypes.default.func.isRequired,open:_propTypes.default.bool.isRequired,PaperProps:_propTypes.default.shape({component:_utils.elementTypeAcceptingRef,style:_propTypes.default.object}),SwipeAreaProps:_propTypes.default.object,swipeAreaWidth:_propTypes.default.number,transitionDuration:_propTypes.default.oneOfType([_propTypes.default.number,_propTypes.default.shape({appear:_propTypes.default.number,enter:_propTypes.default.number,exit:_propTypes.default.number})]),variant:_propTypes.default.oneOf(["permanent","persistent","temporary"])});var _default=SwipeableDrawer;exports.default=SwipeableDrawer;