!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.firestore=t.firebase.firestore||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var i="FirebaseError",r=function(t){function e(n,s){var r=t.call(this,s)||this;return r.code=n,r.name=i,Object.setPrototypeOf(r,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(r,o.prototype.create),r}return function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}(e,t),e}(Error),o=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var s=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(u,function(t,n){var s=e[n];return null!=s?String(s):"<"+n+"?>"})}(o,s):"Error",h=this.serviceName+": "+a+" ("+i+").",c=new r(i,h),l=0,f=Object.keys(s);l<f.length;l++){var d=f[l];"_"!==d.slice(-1)&&(d in c&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),c[d]=s[d])}return c},t}();var a,h,u=/\{\$([^}]+)}/g,c=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}();function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var s=Array(t),i=0;for(e=0;e<n;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,i++)s[i]=r[o];return s}!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(h||(h={}));var f={debug:h.DEBUG,verbose:h.VERBOSE,info:h.INFO,warn:h.WARN,error:h.ERROR,silent:h.SILENT},d=h.INFO,p=((a={})[h.DEBUG]="log",a[h.VERBOSE]="log",a[h.INFO]="info",a[h.WARN]="warn",a[h.ERROR]="error",a),g=function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(!(e<t.logLevel)){var i=(new Date).toISOString(),r=p[e];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[r].apply(console,l(["["+i+"]  "+t.name+":"],n))}},m=function(){function t(t){this.name=t,this._logLevel=d,this._logHandler=g,this._userLogHandler=null}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in h))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?f[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.DEBUG],t)),this._logHandler.apply(this,l([this,h.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.VERBOSE],t)),this._logHandler.apply(this,l([this,h.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.INFO],t)),this._logHandler.apply(this,l([this,h.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.WARN],t)),this._logHandler.apply(this,l([this,h.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.ERROR],t)),this._logHandler.apply(this,l([this,h.ERROR],t))},t}(),y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function w(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var v,b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},E=E||{},I=b||self;function T(){}function _(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function N(t){var e=_(t);return"array"==e||"object"==e&&"number"==typeof t.length}function A(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var x="closure_uid_"+(1e9*Math.random()>>>0),D=0;function S(t,e,n){return t.call.apply(t.bind,arguments)}function k(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function R(t,e,n){return(R=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?S:k).apply(null,arguments)}function O(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var C=Date.now;function L(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,t.prototype.constructor=t}function P(){this.j=this.j,this.i=this.i}P.prototype.j=!1,P.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(t){Object.prototype.hasOwnProperty.call(t,x)&&t[x]||(t[x]=++D)})(this)},P.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var V=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},U=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var s=t.length,i="string"==typeof t?t.split(""):t,r=0;r<s;r++)r in i&&e.call(n,i[r],r,t)};function M(t){return Array.prototype.concat.apply([],arguments)}function q(t){var e=t.length;if(0<e){for(var n=Array(e),s=0;s<e;s++)n[s]=t[s];return n}return[]}function F(t){return/^[\s\xa0]*$/.test(t)}var j,$=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function B(t,e){return-1!=t.indexOf(e)}function G(t,e){return t<e?-1:t>e?1:0}t:{var z=I.navigator;if(z){var W=z.userAgent;if(W){j=W;break t}}j=""}function H(t,e,n){for(var s in t)e.call(n,t[s],s,t)}function K(t){var e={};for(var n in t)e[n]=t[n];return e}var Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function X(t,e){for(var n,s,i=1;i<arguments.length;i++){for(n in s=arguments[i])t[n]=s[n];for(var r=0;r<Q.length;r++)n=Q[r],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function Y(t){return Y[" "](t),t}Y[" "]=T;var J,Z,tt=B(j,"Opera"),et=B(j,"Trident")||B(j,"MSIE"),nt=B(j,"Edge"),st=nt||et,it=B(j,"Gecko")&&!(B(j.toLowerCase(),"webkit")&&!B(j,"Edge"))&&!(B(j,"Trident")||B(j,"MSIE"))&&!B(j,"Edge"),rt=B(j.toLowerCase(),"webkit")&&!B(j,"Edge");function ot(){var t=I.document;return t?t.documentMode:void 0}t:{var at="",ht=(Z=j,it?/rv:([^\);]+)(\)|;)/.exec(Z):nt?/Edge\/([\d\.]+)/.exec(Z):et?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Z):rt?/WebKit\/(\S+)/.exec(Z):tt?/(?:Version)[ \/]?(\S+)/.exec(Z):void 0);if(ht&&(at=ht?ht[1]:""),et){var ut=ot();if(null!=ut&&ut>parseFloat(at)){J=String(ut);break t}}J=at}var ct,lt={};function ft(t){return function(t,e){var n=lt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=$(String(J)).split("."),s=$(String(t)).split("."),i=Math.max(n.length,s.length),r=0;0==e&&r<i;r++){var o=n[r]||"",a=s[r]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;e=G(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||G(0==o[2].length,0==a[2].length)||G(o[2],a[2]),o=o[3],a=a[3]}while(0==e)}return 0<=e})}if(I.document&&et){var dt=ot();ct=dt||(parseInt(J,10)||void 0)}else ct=void 0;var pt=ct,gt=!et||9<=Number(pt),mt=et&&!ft("9"),yt=function(){if(!I.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{I.addEventListener("test",T,e),I.removeEventListener("test",T,e)}catch(t){}return t}();function wt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function vt(t,e){if(wt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(it){t:{try{Y(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:bt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}wt.prototype.b=function(){this.defaultPrevented=!0},L(vt,wt);var bt={2:"touch",3:"pen",4:"mouse"};vt.prototype.b=function(){vt.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,mt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var Et="closure_listenable_"+(1e6*Math.random()|0),It=0;function Tt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function _t(t){this.src=t,this.a={},this.b=0}function Nt(t,e){var n=e.type;if(n in t.a){var s,i=t.a[n],r=V(i,e);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(Tt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function At(t,e,n,s){for(var i=0;i<t.length;++i){var r=t[i];if(!r.Y&&r.listener==e&&r.capture==!!n&&r.ca==s)return i}return-1}_t.prototype.add=function(t,e,n,s,i){var r=t.toString();(t=this.a[r])||(t=this.a[r]=[],this.b++);var o=At(t,e,s,i);return-1<o?(e=t[o],n||(e.Z=!1)):((e=new function(t,e,n,s,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.ca=i,this.key=++It,this.Y=this.Z=!1}(e,this.src,r,!!s,i)).Z=n,t.push(e)),e};var xt="closure_lm_"+(1e6*Math.random()|0),Dt={};function St(t,e,n,s,i){if(s&&s.once)return function t(e,n,s,i,r){if(Array.isArray(n)){for(var o=0;o<n.length;o++)t(e,n[o],s,i,r);return null}s=Ut(s);return e&&e[Et]?e.wa(n,s,A(i)?!!i.capture:!!i,r):kt(e,n,s,!0,i,r)}(t,e,n,s,i);if(Array.isArray(e)){for(var r=0;r<e.length;r++)St(t,e[r],n,s,i);return null}return n=Ut(n),t&&t[Et]?t.va(e,n,A(s)?!!s.capture:!!s,i):kt(t,e,n,!1,s,i)}function kt(t,e,n,s,i,r){if(!e)throw Error("Invalid event type");var o=A(i)?!!i.capture:!!i;if(o&&!gt)return null;var a=Pt(t);if(a||(t[xt]=a=new _t(t)),(n=a.add(e,n,s,o,r)).proxy)return n;if(s=function(){var t=Lt,e=gt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)yt||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),s,i);else if(t.attachEvent)t.attachEvent(Ot(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function Rt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[Et])Nt(e.c,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(Ot(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=Pt(e))?(Nt(n,t),0==n.b&&(n.src=null,e[xt]=null)):Tt(t)}}}function Ot(t){return t in Dt?Dt[t]:Dt[t]="on"+t}function Ct(t,e){var n=t.listener,s=t.ca||t.src;return t.Z&&Rt(t),n.call(s,e)}function Lt(t,e){if(t.Y)return!0;if(!gt){if(!e)t:{e=["window","event"];for(var n=I,s=0;s<e.length;s++)if(null==(n=n[e[s]])){e=null;break t}e=n}return Ct(t,e=new vt(e,this))}return Ct(t,new vt(e,this))}function Pt(t){return(t=t[xt])instanceof _t?t:null}var Vt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ut(t){return"function"==_(t)?t:(t[Vt]||(t[Vt]=function(e){return t.handleEvent(e)}),t[Vt])}function Mt(){P.call(this),this.c=new _t(this),this.J=this,this.C=null}function qt(t,e,n,s){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.Y&&o.capture==n){var a=o.listener,h=o.ca||o.src;o.Z&&Nt(t.c,o),i=!1!==a.call(h,s)&&i}}return i&&!s.defaultPrevented}L(Mt,P),Mt.prototype[Et]=!0,(v=Mt.prototype).addEventListener=function(t,e,n,s){St(this,t,e,n,s)},v.removeEventListener=function(t,e,n,s){!function t(e,n,s,i,r){if(Array.isArray(n))for(var o=0;o<n.length;o++)t(e,n[o],s,i,r);else i=A(i)?!!i.capture:!!i,s=Ut(s),e&&e[Et]?(e=e.c,(n=String(n).toString())in e.a&&-1<(s=At(o=e.a[n],s,i,r))&&(Tt(o[s]),Array.prototype.splice.call(o,s,1),0==o.length&&(delete e.a[n],e.b--))):e&&(e=Pt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=At(n,s,i,r)),(s=-1<e?n[e]:null)&&Rt(s))}(this,t,e,n,s)},v.dispatchEvent=function(t){var e,n=this.C;if(n)for(e=[];n;n=n.C)e.push(n);n=this.J;var s=t.type||t;if("string"==typeof t)t=new wt(t,n);else if(t instanceof wt)t.target=t.target||n;else{var i=t;X(t=new wt(s,n),i)}if(i=!0,e)for(var r=e.length-1;0<=r;r--){var o=t.a=e[r];i=qt(o,s,!0,t)&&i}if(i=qt(o=t.a=n,s,!0,t)&&i,i=qt(o,s,!1,t)&&i,e)for(r=0;r<e.length;r++)i=qt(o=t.a=e[r],s,!1,t)&&i;return i},v.G=function(){if(Mt.S.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],s=0;s<n.length;s++)Tt(n[s]);delete e.a[t],e.b--}}this.C=null},v.va=function(t,e,n,s){return this.c.add(String(t),e,!1,n,s)},v.wa=function(t,e,n,s){return this.c.add(String(t),e,!0,n,s)};var Ft=I.JSON.stringify;function jt(){this.b=this.a=null}var $t,Bt=new(function(){function t(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())(function(){return new zt},function(t){t.reset()},100);function Gt(){var t=Qt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function zt(){this.next=this.b=this.a=null}function Wt(t){I.setTimeout(function(){throw t},0)}function Ht(t,e){$t||function(){var t=I.Promise.resolve(void 0);$t=function(){t.then(Xt)}}(),Kt||($t(),Kt=!0),Qt.add(t,e)}jt.prototype.add=function(t,e){var n=Bt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},zt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},zt.prototype.reset=function(){this.next=this.b=this.a=null};var Kt=!1,Qt=new jt;function Xt(){for(var t;t=Gt();){try{t.a.call(t.b)}catch(t){Wt(t)}var e=Bt;e.g(t),e.b<e.f&&(e.b++,t.next=e.a,e.a=t)}Kt=!1}function Yt(t,e){Mt.call(this),this.b=t||1,this.a=e||I,this.f=R(this.Ya,this),this.g=C()}function Jt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Zt(t,e,n){if("function"==_(t))n&&(t=R(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=R(t.handleEvent,t)}return 2147483647<Number(e)?-1:I.setTimeout(t,e||0)}L(Yt,Mt),(v=Yt.prototype).aa=!1,v.M=null,v.Ya=function(){if(this.aa){var t=C()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(Jt(this),this.start()))}},v.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=C())},v.G=function(){Yt.S.G.call(this),Jt(this),delete this.a};var te=function(t){function e(e,n,s){var i=t.call(this)||this;return i.g=null!=s?e.bind(s):e,i.h=n,i.b=null,i.c=!1,i.a=null,i}return function(t,e){function n(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Zt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(I.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(P);function ee(t){P.call(this),this.b=t,this.a={}}L(ee,P);var ne=[];function se(t,e,n,s){Array.isArray(n)||(n&&(ne[0]=n.toString()),n=ne);for(var i=0;i<n.length;i++){var r=St(e,n[i],s||t.handleEvent,!1,t.b||t);if(!r)break;t.a[r.key]=r}}function ie(t){H(t.a,function(t,e){this.a.hasOwnProperty(e)&&Rt(t)},t),t.a={}}function re(){this.a=!0}function oe(t,e,n,s){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var i=s[1];if(Array.isArray(i)&&!(1>i.length)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return Ft(n)}catch(t){return e}}(t,n)+(s?" "+s:"")})}ee.prototype.G=function(){ee.S.G.call(this),ie(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},re.prototype.info=function(){};var ae=null;function he(){return ae=ae||new Mt}function ue(t){wt.call(this,"serverreachability",t)}function ce(t){var e=he();e.dispatchEvent(new ue(e,t))}function le(t){wt.call(this,"statevent",t)}function fe(t){var e=he();e.dispatchEvent(new le(e,t))}function de(t){wt.call(this,"timingevent",t)}function pe(t,e){if("function"!=_(t))throw Error("Fn must not be null and must be a function");return I.setTimeout(function(){t()},e)}L(ue,wt),L(le,wt),L(de,wt);var ge={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},me={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function ye(){}function we(t){var e;return(e=t.a)||(e=t.a={}),e}function ve(){}ye.prototype.a=null;var be,Ee={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function Ie(){wt.call(this,"d")}function Te(){wt.call(this,"c")}function _e(){}function Ne(t,e,n,s){this.g=t,this.c=e,this.f=n,this.T=s||1,this.J=new ee(this),this.P=Ae,t=st?125:void 0,this.R=new Yt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}L(Ie,wt),L(Te,wt),L(_e,ye),be=new _e;var Ae=45e3,xe={},De={};function Se(t,e,n){t.H=1,t.i=Ye(ze(e)),t.j=n,t.I=!0,ke(t,null)}function ke(t,e){t.u=C(),Ce(t),t.l=ze(t.i);var n=t.l,s=t.T;Array.isArray(s)||(s=[String(s)]),ln(n.b,"t",s),t.D=0,t.a=ss(t.g,t.g.C?e:null),0<t.O&&(t.F=new te(R(t.Ca,t,t.a),t.O)),se(t.J,t.a,"readystatechange",t.Wa),e=t.B?K(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ce(1),function(t,e,n,s,i,r){t.info(function(){if(t.a)if(r)for(var o="",a=r.split("&"),h=0;h<a.length;h++){var u=a[h].split("=");if(1<u.length){var c=u[0];u=u[1];var l=c.split("_");o=2<=l.length&&"type"==l[1]?o+(c+"=")+u+"&":o+(c+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+s+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o})}(t.c,t.m,t.l,t.f,t.T,t.j)}function Re(t,e,n){for(var s=!0;!t.A&&t.D<n.length;){var i=Oe(t,n);if(i==De){4==e&&(t.h=4,fe(14),s=!1),oe(t.c,t.f,null,"[Incomplete Response]");break}if(i==xe){t.h=4,fe(15),oe(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}oe(t.c,t.f,i,null),Me(t,i)}4==e&&0==n.length&&(t.h=1,fe(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.W&&(t.W=!0,(e=t.g).a==t&&e.V&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Qn(e),e.F=!0)):(oe(t.c,t.f,n,"[Invalid Chunked Response]"),Ue(t),Ve(t))}function Oe(t,e){var n=t.D,s=e.indexOf("\n",n);return-1==s?De:(n=Number(e.substring(n,s)),isNaN(n)?xe:(s+=1)+n>e.length?De:(e=e.substr(s,n),t.D=s+n,e))}function Ce(t){t.U=C()+t.P,Le(t,t.P)}function Le(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=pe(R(t.Ua,t),e)}function Pe(t){t.o&&(I.clearTimeout(t.o),t.o=null)}function Ve(t){0==t.g.v||t.A||Jn(t.g,t)}function Ue(t){Pe(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Jt(t.R),ie(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Me(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||yn(n.b,t)))if(n.I=t.N,!t.C&&yn(n.b,t)&&3==n.v){try{var s=n.ka.a.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var i=s;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Yn(n),Fn(n)}Kn(n),fe(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=pe(R(n.Ra,n),6e3));if(1>=mn(n.b)&&n.ea){try{n.ea()}catch(t){}n.ea=void 0}}else ts(n,11)}else if((t.C||n.a==t)&&Yn(n),!F(e))for(e=s=n.ka.a.parse(e),s=0;s<e.length;s++)if(i=e[s],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var r=i[3];null!=r&&(n.ha=r,n.c.info("VER="+n.ha));var o=i[4];null!=o&&(n.pa=o,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var h=1.5*a;n.D=h,n.c.info("backChannelRequestTimeoutMs_="+h)}h=n;var u=t.a;if(u){var c=u.a?u.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(c){var l=h.b;!l.a&&(B(c,"spdy")||B(c,"quic")||B(c,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(wn(l,l.b),l.b=null))}if(h.A){var f=u.a?u.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(h.na=f,Xe(h.B,h.A,f))}}n.v=3,n.f&&n.f.ta(),n.V&&(n.N=C()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((h=n).la=ns(h,h.C?h.ga:null,h.fa),d.C){vn(h.b,d);var p=d,g=h.D;g&&p.setTimeout(g),p.o&&(Pe(p),Ce(p)),h.a=d}else Hn(h);0<n.g.length&&Bn(n)}else"stop"!=i[0]&&"close"!=i[0]||ts(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?ts(n,7):qn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);ce(4)}catch(t){}}function qe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(N(t)||"string"==typeof t)U(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(N(t)||"string"==typeof t){n=[];for(var s=t.length,i=0;i<s;i++)n.push(i)}else for(i in n=[],s=0,t)n[s++]=i;i=(s=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(N(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}for(s in e=[],n=0,t)e[n++]=t[s];return e}(t)).length;for(var r=0;r<i;r++)e.call(void 0,s[r],n&&n[r],t)}}function Fe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var s=0;s<n;s+=2)this.set(arguments[s],arguments[s+1])}else if(t)if(t instanceof Fe)for(n=t.L(),s=0;s<n.length;s++)this.set(n[s],t.get(n[s]));else for(s in t)this.set(s,t[s])}function je(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var s=t.a[e];$e(t.b,s)&&(t.a[n++]=s),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)$e(i,s=t.a[e])||(t.a[n++]=s,i[s]=1),e++;t.a.length=n}}function $e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(v=Ne.prototype).setTimeout=function(t){this.P=t},v.Wa=function(t){t=t.target;var e=this.F;e&&3==Pn(t)?e.f():this.Ca(t)},v.Ca=function(t){try{if(t==this.a)t:{var e=Pn(this.a),n=this.a.ua(),s=this.a.X();if(!(3>e||3==e&&!st&&!this.a.$())){this.A||4!=e||7==n||ce(8==n||0>=s?3:2),Pe(this);var i=this.a.X();this.N=i;var r=this.a.$();if(this.b=200==i,function(t,e,n,s,i,r,o){t.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+r+" "+o})}(this.c,this.m,this.l,this.f,this.T,e,i),this.b){if(this.V&&!this.C){e:{if(this.a){var o,a=this.a;if((o=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(o)){var h=o;break e}}h=null}if(!h){this.b=!1,this.h=3,fe(12),Ue(this),Ve(this);break t}oe(this.c,this.f,h,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Me(this,h)}this.I?(Re(this,e,r),st&&this.b&&3==e&&(se(this.J,this.R,"tick",this.Va),this.R.start())):(oe(this.c,this.f,r,null),Me(this,r)),4==e&&Ue(this),this.b&&!this.A&&(4==e?Jn(this.g,this):(this.b=!1,Ce(this)))}else 400==i&&0<r.indexOf("Unknown SID")?(this.h=3,fe(12)):(this.h=0,fe(13)),Ue(this),Ve(this)}}}catch(t){}},v.Va=function(){if(this.a){var t=Pn(this.a),e=this.a.$();this.D<e.length&&(Pe(this),Re(this,t,e),this.b&&4!=t&&Ce(this))}},v.cancel=function(){this.A=!0,Ue(this)},v.Ua=function(){this.o=null;var t=C();0<=t-this.U?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.H&&(ce(3),fe(17)),Ue(this),this.h=2,Ve(this)):Le(this,this.U-t)},(v=Fe.prototype).K=function(){je(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},v.L=function(){return je(this),this.a.concat()},v.get=function(t,e){return $e(this.b,t)?this.b[t]:e},v.set=function(t,e){$e(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},v.forEach=function(t,e){for(var n=this.L(),s=0;s<n.length;s++){var i=n[s],r=this.get(i);t.call(e,r,i,this)}};var Be=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ge(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ge){this.a=void 0!==e?e:t.a,We(this,t.f),this.j=t.j,He(this,t.c),Ke(this,t.h),this.g=t.g,e=t.b;var n=new an;n.c=e.c,e.a&&(n.a=new Fe(e.a),n.b=e.b),Qe(this,n),this.i=t.i}else t&&(n=String(t).match(Be))?(this.a=!!e,We(this,n[1]||"",!0),this.j=Je(n[2]||""),He(this,n[3]||"",!0),Ke(this,n[4]),this.g=Je(n[5]||"",!0),Qe(this,n[6]||"",!0),this.i=Je(n[7]||"")):(this.a=!!e,this.b=new an(null,this.a))}function ze(t){return new Ge(t)}function We(t,e,n){t.f=n?Je(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function He(t,e,n){t.c=n?Je(e,!0):e}function Ke(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Qe(t,e,n){e instanceof an?(t.b=e,function(t,e){e&&!t.f&&(hn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(un(this,e),ln(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=Ze(e,rn)),t.b=new an(e,t.a))}function Xe(t,e,n){t.b.set(e,n)}function Ye(t){return Xe(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^C()).toString(36)),t}function Je(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ze(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,tn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function tn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ge.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ze(e,en,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Ze(e,en,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ze(n,"/"==n.charAt(0)?sn:nn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Ze(n,on)),t.join("")};var en=/[#\/\?@]/g,nn=/[#\?:]/g,sn=/[#\?]/g,rn=/[#\?@]/g,on=/#/g;function an(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function hn(t){t.a||(t.a=new Fe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),i=null;if(0<=s){var r=t[n].substring(0,s);i=t[n].substring(s+1)}else r=t[n];e(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function un(t,e){hn(t),e=fn(t,e),$e(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,$e((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&je(t)))}function cn(t,e){return hn(t),e=fn(t,e),$e(t.a.b,e)}function ln(t,e,n){un(t,e),0<n.length&&(t.c=null,t.a.set(fn(t,e),q(n)),t.b+=n.length)}function fn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function dn(t){this.g=t||pn,I.PerformanceNavigationTiming?t=0<(t=I.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(I.ia&&I.ia.ya&&I.ia.ya()&&I.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(v=an.prototype).add=function(t,e){hn(this),this.c=null,t=fn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},v.forEach=function(t,e){hn(this),this.a.forEach(function(n,s){U(n,function(n){t.call(e,n,s,this)},this)},this)},v.L=function(){hn(this);for(var t=this.a.K(),e=this.a.L(),n=[],s=0;s<e.length;s++)for(var i=t[s],r=0;r<i.length;r++)n.push(e[s]);return n},v.K=function(t){hn(this);var e=[];if("string"==typeof t)cn(this,t)&&(e=M(e,this.a.get(fn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=M(e,t[n])}return e},v.set=function(t,e){return hn(this),this.c=null,cn(this,t=fn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},v.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},v.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var s=e[n],i=encodeURIComponent(String(s));s=this.K(s);for(var r=0;r<s.length;r++){var o=i;""!==s[r]&&(o+="="+encodeURIComponent(String(s[r]))),t.push(o)}}return this.c=t.join("&")};var pn=10;function gn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function mn(t){return t.b?1:t.a?t.a.size:0}function yn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function wn(t,e){t.a?t.a.add(e):t.b=e}function vn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function bn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var s=t.c;try{for(var i=w(t.a.values()),r=i.next();!r.done;r=i.next()){var o=r.value;s=s.concat(o.s)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return s}return q(t.c)}function En(){}function In(t,e,n){var s=n||"";try{qe(t,function(t,n){var i=t;A(t)&&(i=Ft(t)),e.push(s+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}function Tn(t,e,n,s,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(s)}catch(t){}}dn.prototype.cancel=function(){var t,e;if(this.c=bn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=w(this.a.values()),s=n.next();!s.done;s=n.next()){s.value.cancel()}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},En.prototype.stringify=function(t){return I.JSON.stringify(t,void 0)},En.prototype.parse=function(t){return I.JSON.parse(t,void 0)};var _n=I.JSON.parse;function Nn(t){Mt.call(this),this.headers=new Fe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=An,this.D=this.F=!1}L(Nn,Mt);var An="",xn=/^https?$/i,Dn=["POST","PUT"];function Sn(t){return"content-type"==t.toLowerCase()}function kn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Rn(t),Cn(t)}function Rn(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function On(t){if(t.b&&void 0!==E&&(!t.s[1]||4!=Pn(t)||2!=t.X()))if(t.l&&4==Pn(t))Zt(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==Pn(t)){t.b=!1;try{var e,n=t.X();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if(!(e=s)){var i;if(i=0===n){var r=String(t.B).match(Be)[1]||null;if(!r&&I.self&&I.self.location){var o=I.self.location.protocol;r=o.substr(0,o.length-1)}i=!xn.test(r?r.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var a=2<Pn(t)?t.a.statusText:""}catch(t){a=""}t.f=a+" ["+t.X()+"]",Rn(t)}}finally{Cn(t)}}}function Cn(t,e){if(t.a){Ln(t);var n=t.a,s=t.s[0]?T:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=s}catch(t){}}}function Ln(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(I.clearTimeout(t.m),t.m=null)}function Pn(t){return t.a?t.a.readyState:0}function Vn(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=function(t){var e="";return H(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Xe(t,e,n))}function Un(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Mn(t){this.pa=0,this.g=[],this.c=new re,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=Un("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=Un("baseRetryDelayMs",5e3,t),this.Ma=Un("retryDelaySeedMs",1e4,t),this.Ja=Un("forwardChannelMaxRetries",2,t),this.ma=Un("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new dn(t&&t.concurrentRequestLimit),this.ka=new function(){this.a=new En},this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function qn(t){if(jn(t),3==t.v){var e=t.R++,n=ze(t.B);Xe(n,"SID",t.J),Xe(n,"RID",e),Xe(n,"TYPE","terminate"),zn(t,n),(e=new Ne(t,t.c,e,void 0)).H=2,e.i=Ye(ze(n)),n=!1,I.navigator&&I.navigator.sendBeacon&&(n=I.navigator.sendBeacon(e.i.toString(),"")),!n&&I.Image&&((new Image).src=e.i,n=!0),n||(e.a=ss(e.g,null),e.a.ba(e.i)),e.u=C(),Ce(e)}es(t)}function Fn(t){t.a&&(Qn(t),t.a.cancel(),t.a=null)}function jn(t){Fn(t),t.j&&(I.clearTimeout(t.j),t.j=null),Yn(t),t.b.cancel(),t.h&&("number"==typeof t.h&&I.clearTimeout(t.h),t.h=null)}function $n(t,e){t.g.push(new function(t,e){this.b=t,this.a=e}(t.La++,e)),3==t.v&&Bn(t)}function Bn(t){gn(t.b)||t.h||(t.h=!0,Ht(t.Ba,t),t.u=0)}function Gn(t,e){var n;n=e?e.f:t.R++;var s=ze(t.B);Xe(s,"SID",t.J),Xe(s,"RID",n),Xe(s,"AID",t.P),zn(t,s),t.i&&t.l&&Vn(s,t.i,t.l),n=new Ne(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Wn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),wn(t.b,n),Se(n,s,e)}function zn(t,e){t.f&&qe({},function(t,n){Xe(e,n,t)})}function Wn(t,e,n){n=Math.min(t.g.length,n);var s=t.f?R(t.f.Ha,t.f,t):null;t:for(var i=t.g,r=-1;;){var o=["count="+n];-1==r?0<n?(r=i[0].b,o.push("ofs="+r)):r=0:o.push("ofs="+r);for(var a=!0,h=0;h<n;h++){var u=i[h].b,c=i[h].a;if(0>(u-=r))r=Math.max(0,i[h].b-100),a=!1;else try{In(c,o,"req"+u+"_")}catch(t){s&&s(c)}}if(a){s=o.join("&");break t}}return t=t.g.splice(0,n),e.s=t,s}function Hn(t){t.a||t.j||(t.U=1,Ht(t.Aa,t),t.o=0)}function Kn(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=pe(R(t.Aa,t),Zn(t,t.o)),t.o++,!0)}function Qn(t){null!=t.s&&(I.clearTimeout(t.s),t.s=null)}function Xn(t){t.a=new Ne(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=ze(t.la);Xe(e,"RID","rpc"),Xe(e,"SID",t.J),Xe(e,"CI",t.H?"0":"1"),Xe(e,"AID",t.P),zn(t,e),Xe(e,"TYPE","xmlhttp"),t.i&&t.l&&Vn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Ye(ze(e)),n.j=null,n.I=!0,ke(n,t)}function Yn(t){null!=t.m&&(I.clearTimeout(t.m),t.m=null)}function Jn(t,e){var n=null;if(t.a==e){Yn(t),Qn(t),t.a=null;var s=2}else{if(!yn(t.b,e))return;n=e.s,vn(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==s){n=e.j?e.j.length:0,e=C()-e.u;var i=t.u;(s=he()).dispatchEvent(new de(s,n,e,i)),Bn(t)}else Hn(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==s&&function(t,e){return!(mn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja)||(t.h=pe(R(t.Ba,t,e),Zn(t,t.u)),t.u++,0)))}(t,e)||2==s&&Kn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:ts(t,5);break;case 4:ts(t,10);break;case 3:ts(t,6);break;default:ts(t,2)}}function Zn(t,e){var n=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(n*=2),n*e}function ts(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var s=R(t.Xa,t);n||(n=new Ge("//www.google.com/images/cleardot.gif"),I.location&&"http"==I.location.protocol||We(n,"https"),Ye(n)),function(t,e){var n=new re;if(I.Image){var s=new Image;s.onload=O(Tn,n,s,"TestLoadImage: loaded",!0,e),s.onerror=O(Tn,n,s,"TestLoadImage: error",!1,e),s.onabort=O(Tn,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=O(Tn,n,s,"TestLoadImage: timeout",!1,e),I.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=t}else e(!1)}(n.toString(),s)}else fe(2);t.v=0,t.f&&t.f.ra(e),es(t),jn(t)}function es(t){t.v=0,t.I=-1,t.f&&(0==bn(t.b).length&&0==t.g.length||(t.b.c.length=0,q(t.g),t.g.length=0),t.f.qa())}function ns(t,e,n){var s=function(t){return t instanceof Ge?ze(t):new Ge(t,void 0)}(n);if(""!=s.c)e&&He(s,e+"."+s.c),Ke(s,s.h);else{var i=I.location;s=function(t,e,n,s){var i=new Ge(null,void 0);return t&&We(i,t),e&&He(i,e),n&&Ke(i,n),s&&(i.g=s),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.W&&H(t.W,function(t,e){Xe(s,e,t)}),e=t.A,n=t.na,e&&n&&Xe(s,e,n),Xe(s,"VER",t.ha),zn(t,s),s}function ss(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Nn(t.Ka)).F=t.C,e}function is(){}function rs(){if(et&&!(10<=Number(pt)))throw Error("Environmental error: no available transport.")}function os(t,e){Mt.call(this),this.a=new Mn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!F(t)&&(this.a.i=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!F(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new us(this)}function as(t){Ie.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function hs(){Te.call(this),this.status=1}function us(t){this.a=t}(v=Nn.prototype).ba=function(t,e,n,s){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?we(this.H):we(be),this.a.onreadystatechange=R(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void kn(this,t)}t=n||"";var i=new Fe(this.headers);s&&qe(s,function(t,e){i.set(e,t)}),s=function(t){t:{for(var e=Sn,n=t.length,s="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in s&&e.call(void 0,s[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=I.FormData&&t instanceof I.FormData,!(0<=V(Dn,e))||s||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Ln(this),0<this.o&&((this.D=function(t){return et&&ft(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=R(this.xa,this)):this.m=Zt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){kn(this,t)}},v.xa=function(){void 0!==E&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},v.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Cn(this))},v.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Cn(this,!0)),Nn.S.G.call(this)},v.za=function(){this.j||(this.A||this.l||this.g?On(this):this.Ta())},v.Ta=function(){On(this)},v.X=function(){try{return 2<Pn(this)?this.a.status:-1}catch(t){return-1}},v.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},v.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),_n(e)}},v.ua=function(){return this.h},v.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(v=Mn.prototype).ha=8,v.v=1,v.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ne(this,this.c,t,void 0),s=this.l;if(this.O&&(s?X(s=K(s),this.O):s=this.O),null===this.i&&(n.B=s),this.da)t:{for(var i=e=0;i<this.g.length;i++){var r=this.g[i];if(void 0===(r="__data__"in r.a&&"string"==typeof(r=r.a.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Wn(this,n,e),Xe(i=ze(this.B),"RID",t),Xe(i,"CVER",22),this.A&&Xe(i,"X-HTTP-Session-Id",this.A),zn(this,i),this.i&&s&&Vn(i,this.i,s),wn(this.b,n),this.Ga&&Xe(i,"TYPE","init"),this.da?(Xe(i,"$req",e),Xe(i,"SID","null"),n.V=!0,Se(n,i,null)):Se(n,i,e),this.v=2}}else 3==this.v&&(t?Gn(this,t):0==this.g.length||gn(this.b)||Gn(this))},v.Aa=function(){if(this.j=null,Xn(this),this.V&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=pe(R(this.Sa,this),t)}},v.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Fn(this),Xn(this))},v.Ra=function(){null!=this.m&&(this.m=null,Fn(this),Kn(this),fe(19))},v.Xa=function(t){t?(this.c.info("Successfully pinged google.com"),fe(2)):(this.c.info("Failed to ping google.com"),fe(1))},(v=is.prototype).ta=function(){},v.sa=function(){},v.ra=function(){},v.qa=function(){},v.Ha=function(){},rs.prototype.a=function(t,e){return new os(t,e)},L(os,Mt),(v=os.prototype).addEventListener=function(t,e,n,s){os.S.addEventListener.call(this,t,e,n,s)},v.removeEventListener=function(t,e,n,s){os.S.removeEventListener.call(this,t,e,n,s)},v.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,e=this.l,n=this.b||void 0;fe(0),t.fa=e,t.W=n||{},t.H=t.T,t.B=ns(t,null,t.fa),Bn(t)},v.close=function(){qn(this.a)},v.Pa=function(t){if("string"==typeof t){var e={};e.__data__=t,$n(this.a,e)}else this.g?((e={}).__data__=Ft(t),$n(this.a,e)):$n(this.a,t)},v.G=function(){this.a.f=null,delete this.f,qn(this.a),delete this.a,os.S.G.call(this)},L(as,Ie),L(hs,Te),L(us,is),us.prototype.ta=function(){this.a.dispatchEvent("a")},us.prototype.sa=function(t){this.a.dispatchEvent(new as(t))},us.prototype.ra=function(t){this.a.dispatchEvent(new hs(t))},us.prototype.qa=function(){this.a.dispatchEvent("b")},rs.prototype.createWebChannel=rs.prototype.a,os.prototype.send=os.prototype.Pa,os.prototype.open=os.prototype.Oa,os.prototype.close=os.prototype.close,ge.NO_ERROR=0,ge.TIMEOUT=8,ge.HTTP_ERROR=6,me.COMPLETE="complete",ve.EventType=Ee,Ee.OPEN="a",Ee.CLOSE="b",Ee.ERROR="c",Ee.MESSAGE="d",Mt.prototype.listen=Mt.prototype.va,Nn.prototype.listenOnce=Nn.prototype.wa,Nn.prototype.getLastError=Nn.prototype.Qa,Nn.prototype.getLastErrorCode=Nn.prototype.ua,Nn.prototype.getStatus=Nn.prototype.X,Nn.prototype.getResponseJson=Nn.prototype.Na,Nn.prototype.getResponseText=Nn.prototype.$,Nn.prototype.send=Nn.prototype.ba;var cs={createWebChannelTransport:function(){return new rs},ErrorCode:ge,EventType:me,WebChannel:ve,XhrIo:Nn},ls=cs.createWebChannelTransport,fs=cs.ErrorCode,ds=cs.EventType,ps=cs.WebChannel,gs=cs.XhrIo;class ms{constructor(t){this.uid=t}t(){return null!=this.uid}s(){return this.t()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}ms.UNAUTHENTICATED=new ms(null),ms.i=new ms("google-credentials-uid"),ms.o=new ms("first-party-uid");const ys=new m("@firebase/firestore");function ws(){return ys.logLevel}function vs(t,...e){if(ys.logLevel<=h.DEBUG){const n=e.map(Is);ys.debug("Firestore (7.17.1): "+t,...n)}}function bs(t,...e){if(ys.logLevel<=h.ERROR){const n=e.map(Is);ys.error("Firestore (7.17.1): "+t,...n)}}function Es(t,...e){if(ys.logLevel<=h.WARN){const n=e.map(Is);ys.warn("Firestore (7.17.1): "+t,...n)}}function Is(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Ts(t="Unexpected state"){const e="FIRESTORE (7.17.1) INTERNAL ASSERTION FAILED: "+t;throw bs(e),new Error(e)}function _s(t,e){t||Ts()}function Ns(t,e){return t}const As={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class xs extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=(()=>`${this.name}: [code=${this.code}]: ${this.message}`)}}class Ds{constructor(t,e){this.user=e,this.type="OAuth",this.h={},this.h.Authorization="Bearer "+t}}class Ss{constructor(t){this.u=null,this.currentUser=ms.UNAUTHENTICATED,this.l=!1,this._=0,this.T=null,this.forceRefresh=!1,this.u=(()=>{this._++,this.currentUser=this.I(),this.l=!0,this.T&&this.T(this.currentUser)}),this._=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.u):(this.u(null),t.get().then(t=>{this.auth=t,this.u&&this.auth.addAuthTokenListener(this.u)},()=>{}))}getToken(){const t=this._,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this._!==t?(vs("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(_s("string"==typeof e.accessToken),new Ds(e.accessToken,this.currentUser)):null):Promise.resolve(null)}A(){this.forceRefresh=!0}R(t){this.T=t,this.l&&t(this.currentUser)}m(){this.auth&&this.auth.removeAuthTokenListener(this.u),this.u=null,this.T=null}I(){const t=this.auth&&this.auth.getUid();return _s(null===t||"string"==typeof t),new ms(t)}}function ks(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Rs{static P(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=ks(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%t.length))}return n}}function Os(t,e){return t<e?-1:t>e?1:0}function Cs(t,e,n){return t.length===e.length&&t.every((t,s)=>n(t,e[s]))}function Ls(t){return t+"\0"}class Ps{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new xs(As.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new xs(As.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new xs(As.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new xs(As.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Ps.fromMillis(Date.now())}static fromDate(t){return Ps.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3);return new Ps(e,1e6*(t-1e3*e))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}V(t){return this.seconds===t.seconds?Os(this.nanoseconds,t.nanoseconds):Os(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Vs{constructor(t){this.timestamp=t}static g(t){return new Vs(t)}static min(){return new Vs(new Ps(0,0))}p(t){return this.timestamp.V(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}v(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}S(){return this.timestamp}}class Us{constructor(t,e,n){void 0===e?e=0:e>t.length&&Ts(),void 0===n?n=t.length-e:n>t.length-e&&Ts(),this.segments=t,this.offset=e,this.C=n}get length(){return this.C}isEqual(t){return 0===Us.D(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Us?t.forEach(t=>{e.push(t)}):e.push(t),this.N(e)}limit(){return this.offset+this.length}k(t){return t=void 0===t?1:t,this.N(this.segments,this.offset+t,this.length-t)}O(){return this.N(this.segments,this.offset,this.length-1)}F(){return this.segments[this.offset]}M(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}$(){return 0===this.length}L(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}q(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}B(){return this.segments.slice(this.offset,this.limit())}static D(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Ms extends Us{N(t,e,n){return new Ms(t,e,n)}U(){return this.B().join("/")}toString(){return this.U()}static W(t){if(t.indexOf("//")>=0)throw new xs(As.INVALID_ARGUMENT,`Invalid path (${t}). Paths must not contain // in them.`);const e=t.split("/").filter(t=>t.length>0);return new Ms(e)}static K(){return new Ms([])}}const qs=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Fs extends Us{N(t,e,n){return new Fs(t,e,n)}static j(t){return qs.test(t)}U(){return this.B().map(t=>(t=t.replace("\\","\\\\").replace("`","\\`"),Fs.j(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.U()}G(){return 1===this.length&&"__name__"===this.get(0)}static H(){return new Fs(["__name__"])}static J(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new xs(As.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new xs(As.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new xs(As.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new xs(As.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Fs(e)}static K(){return new Fs([])}}class js{constructor(t){this.path=t}static Y(t){return new js(Ms.W(t).k(5))}X(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===Ms.D(this.path,t.path)}toString(){return this.path.toString()}static D(t,e){return Ms.D(t.path,e.path)}static Z(t){return t.length%2==0}static tt(t){return new js(new Ms(t.slice()))}}class $s{constructor(t,e,n,s,i){this.et=t,this.persistenceKey=e,this.host=n,this.ssl=s,this.forceLongPolling=i}}class Bs{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get nt(){return"(default)"===this.database}isEqual(t){return t instanceof Bs&&t.projectId===this.projectId&&t.database===this.database}p(t){return Os(this.projectId,t.projectId)||Os(this.database,t.database)}}function Gs(t){return null==t}function zs(t){return-0===t&&1/t==-1/0}function Ws(t){return"number"==typeof t&&Number.isInteger(t)&&!zs(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class Hs{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.st=null}}function Ks(t,e=null,n=[],s=[],i=null,r=null,o=null){return new Hs(t,e,n,s,i,r,o)}function Qs(t){const e=Ns(t);if(null===e.st){let t=e.path.U();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>(function(t){return t.field.U()+t.op.toString()+Bi(t.value)})(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>(function(t){return t.field.U()+t.dir})(t)).join(","),Gs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Lo(e.startAt)),e.endAt&&(t+="|ub:",t+=Lo(e.endAt)),e.st=t}return e.st}function Xs(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!qo(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],s=e.filters[i],n.op!==s.op||!n.field.isEqual(s.field)||!qi(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Vo(t.startAt,e.startAt)&&Vo(t.endAt,e.endAt)}function Ys(t){return js.Z(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Js{constructor(t){this.it=t}static fromBase64String(t){const e=atob(t);return new Js(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Js(e)}toBase64(){return t=this.it,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.it)}rt(){return 2*this.it.length}p(t){return Os(this.it,t.it)}isEqual(t){return this.it===t.it}}Js.ot=new Js("");class Zs{constructor(t,e,n,s,i=Vs.min(),r=Vs.min(),o=Js.ot){this.target=t,this.targetId=e,this.ht=n,this.sequenceNumber=s,this.at=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}ut(t){return new Zs(this.target,this.targetId,this.ht,t,this.at,this.lastLimboFreeSnapshotVersion,this.resumeToken)}ct(t,e){return new Zs(this.target,this.targetId,this.ht,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}lt(t){return new Zs(this.target,this.targetId,this.ht,this.sequenceNumber,this.at,t,this.resumeToken)}}class ti{constructor(t){this.count=t}}var ei,ni;function si(t){switch(t){case As.OK:return Ts();case As.CANCELLED:case As.UNKNOWN:case As.DEADLINE_EXCEEDED:case As.RESOURCE_EXHAUSTED:case As.INTERNAL:case As.UNAVAILABLE:case As.UNAUTHENTICATED:return!1;case As.INVALID_ARGUMENT:case As.NOT_FOUND:case As.ALREADY_EXISTS:case As.PERMISSION_DENIED:case As.FAILED_PRECONDITION:case As.ABORTED:case As.OUT_OF_RANGE:case As.UNIMPLEMENTED:case As.DATA_LOSS:return!0;default:return Ts()}}function ii(t){if(void 0===t)return bs("GRPC error has no .code"),As.UNKNOWN;switch(t){case ei.OK:return As.OK;case ei.CANCELLED:return As.CANCELLED;case ei.UNKNOWN:return As.UNKNOWN;case ei.DEADLINE_EXCEEDED:return As.DEADLINE_EXCEEDED;case ei.RESOURCE_EXHAUSTED:return As.RESOURCE_EXHAUSTED;case ei.INTERNAL:return As.INTERNAL;case ei.UNAVAILABLE:return As.UNAVAILABLE;case ei.UNAUTHENTICATED:return As.UNAUTHENTICATED;case ei.INVALID_ARGUMENT:return As.INVALID_ARGUMENT;case ei.NOT_FOUND:return As.NOT_FOUND;case ei.ALREADY_EXISTS:return As.ALREADY_EXISTS;case ei.PERMISSION_DENIED:return As.PERMISSION_DENIED;case ei.FAILED_PRECONDITION:return As.FAILED_PRECONDITION;case ei.ABORTED:return As.ABORTED;case ei.OUT_OF_RANGE:return As.OUT_OF_RANGE;case ei.UNIMPLEMENTED:return As.UNIMPLEMENTED;case ei.DATA_LOSS:return As.DATA_LOSS;default:return Ts()}}(ni=ei||(ei={}))[ni.OK=0]="OK",ni[ni.CANCELLED=1]="CANCELLED",ni[ni.UNKNOWN=2]="UNKNOWN",ni[ni.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ni[ni.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ni[ni.NOT_FOUND=5]="NOT_FOUND",ni[ni.ALREADY_EXISTS=6]="ALREADY_EXISTS",ni[ni.PERMISSION_DENIED=7]="PERMISSION_DENIED",ni[ni.UNAUTHENTICATED=16]="UNAUTHENTICATED",ni[ni.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ni[ni.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ni[ni.ABORTED=10]="ABORTED",ni[ni.OUT_OF_RANGE=11]="OUT_OF_RANGE",ni[ni.UNIMPLEMENTED=12]="UNIMPLEMENTED",ni[ni.INTERNAL=13]="INTERNAL",ni[ni.UNAVAILABLE=14]="UNAVAILABLE",ni[ni.DATA_LOSS=15]="DATA_LOSS";class ri{constructor(t,e){this.D=t,this.root=e||ai.EMPTY}_t(t,e){return new ri(this.D,this.root._t(t,e,this.D).copy(null,null,ai.ft,null,null))}remove(t){return new ri(this.D,this.root.remove(t,this.D).copy(null,null,ai.ft,null,null))}get(t){let e=this.root;for(;!e.$();){const n=this.D(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.$();){const s=this.D(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}$(){return this.root.$()}get size(){return this.root.size}dt(){return this.root.dt()}wt(){return this.root.wt()}Tt(t){return this.root.Tt(t)}forEach(t){this.Tt((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.Tt((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}Et(t){return this.root.Et(t)}It(){return new oi(this.root,null,this.D,!1)}At(t){return new oi(this.root,t,this.D,!1)}Rt(){return new oi(this.root,null,this.D,!0)}Pt(t){return new oi(this.root,t,this.D,!0)}}class oi{constructor(t,e,n,s){this.Vt=s,this.gt=[];let i=1;for(;!t.$();)if(i=e?n(t.key,e):1,s&&(i*=-1),i<0)t=this.Vt?t.left:t.right;else{if(0===i){this.gt.push(t);break}this.gt.push(t),t=this.Vt?t.right:t.left}}yt(){let t=this.gt.pop();const e={key:t.key,value:t.value};if(this.Vt)for(t=t.left;!t.$();)this.gt.push(t),t=t.right;else for(t=t.right;!t.$();)this.gt.push(t),t=t.left;return e}pt(){return this.gt.length>0}bt(){if(0===this.gt.length)return null;const t=this.gt[this.gt.length-1];return{key:t.key,value:t.value}}}class ai{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:ai.RED,this.left=null!=s?s:ai.EMPTY,this.right=null!=i?i:ai.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new ai(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}$(){return!1}Tt(t){return this.left.Tt(t)||t(this.key,this.value)||this.right.Tt(t)}Et(t){return this.right.Et(t)||t(this.key,this.value)||this.left.Et(t)}min(){return this.left.$()?this:this.left.min()}dt(){return this.min().key}wt(){return this.right.$()?this.key:this.right.wt()}_t(t,e,n){let s=this;const i=n(t,s.key);return(s=i<0?s.copy(null,null,null,s.left._t(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right._t(t,e,n))).vt()}St(){if(this.left.$())return ai.EMPTY;let t=this;return t.left.Ct()||t.left.left.Ct()||(t=t.Dt()),(t=t.copy(null,null,null,t.left.St(),null)).vt()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.$()||s.left.Ct()||s.left.left.Ct()||(s=s.Dt()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.Ct()&&(s=s.Nt()),s.right.$()||s.right.Ct()||s.right.left.Ct()||(s=s.xt()),0===e(t,s.key)){if(s.right.$())return ai.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.St())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.vt()}Ct(){return this.color}vt(){let t=this;return t.right.Ct()&&!t.left.Ct()&&(t=t.kt()),t.left.Ct()&&t.left.left.Ct()&&(t=t.Nt()),t.left.Ct()&&t.right.Ct()&&(t=t.Ot()),t}Dt(){let t=this.Ot();return t.right.left.Ct()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Nt())).kt()).Ot()),t}xt(){let t=this.Ot();return t.left.left.Ct()&&(t=(t=t.Nt()).Ot()),t}kt(){const t=this.copy(null,null,ai.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}Nt(){const t=this.copy(null,null,ai.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}Ot(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}Ft(){const t=this.Mt();return Math.pow(2,t)<=this.size+1}Mt(){if(this.Ct()&&this.left.Ct())throw Ts();if(this.right.Ct())throw Ts();const t=this.left.Mt();if(t!==this.right.Mt())throw Ts();return t+(this.Ct()?0:1)}}ai.EMPTY=null,ai.RED=!0,ai.ft=!1,ai.EMPTY=new class{constructor(){this.size=0}get key(){throw Ts()}get value(){throw Ts()}get color(){throw Ts()}get left(){throw Ts()}get right(){throw Ts()}copy(t,e,n,s,i){return this}_t(t,e,n){return new ai(t,e)}remove(t,e){return this}$(){return!0}Tt(t){return!1}Et(t){return!1}dt(){return null}wt(){return null}Ct(){return!1}Ft(){return!0}Mt(){return 0}};class hi{constructor(t){this.D=t,this.data=new ri(this.D)}has(t){return null!==this.data.get(t)}first(){return this.data.dt()}last(){return this.data.wt()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.Tt((e,n)=>(t(e),!1))}$t(t,e){const n=this.data.At(t[0]);for(;n.pt();){const s=n.yt();if(this.D(s.key,t[1])>=0)return;e(s.key)}}Lt(t,e){let n;for(n=void 0!==e?this.data.At(e):this.data.It();n.pt();)if(!t(n.yt().key))return}qt(t){const e=this.data.At(t);return e.pt()?e.yt().key:null}It(){return new ui(this.data.It())}At(t){return new ui(this.data.At(t))}add(t){return this.copy(this.data.remove(t)._t(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}$(){return this.data.$()}Bt(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof hi))return!1;if(this.size!==t.size)return!1;const e=this.data.It(),n=t.data.It();for(;e.pt();){const t=e.yt().key,s=n.yt().key;if(0!==this.D(t,s))return!1}return!0}B(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new hi(this.D);return e.data=t,e}}class ui{constructor(t){this.Ut=t}yt(){return this.Ut.yt().key}pt(){return this.Ut.pt()}}const ci=new ri(js.D);function li(){return ci}function fi(){return li()}const di=new ri(js.D);function pi(){return di}const gi=new ri(js.D),mi=new hi(js.D);function yi(...t){let e=mi;for(const n of t)e=e.add(n);return e}const wi=new hi(Os);function vi(){return wi}class bi{constructor(t){this.D=t?(e,n)=>t(e,n)||js.D(e.key,n.key):(t,e)=>js.D(t.key,e.key),this.Wt=pi(),this.Kt=new ri(this.D)}static jt(t){return new bi(t.D)}has(t){return null!=this.Wt.get(t)}get(t){return this.Wt.get(t)}first(){return this.Kt.dt()}last(){return this.Kt.wt()}$(){return this.Kt.$()}indexOf(t){const e=this.Wt.get(t);return e?this.Kt.indexOf(e):-1}get size(){return this.Kt.size}forEach(t){this.Kt.Tt((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.Wt._t(t.key,t),e.Kt._t(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.Wt.remove(t),this.Kt.remove(e)):this}isEqual(t){if(!(t instanceof bi))return!1;if(this.size!==t.size)return!1;const e=this.Kt.It(),n=t.Kt.It();for(;e.pt();){const t=e.yt().key,s=n.yt().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new bi;return n.D=this.D,n.Wt=t,n.Kt=e,n}}class Ei{constructor(){this.Qt=new ri(js.D)}track(t){const e=t.doc.key,n=this.Qt.get(e);n?0!==t.type&&3===n.type?this.Qt=this.Qt._t(e,t):3===t.type&&1!==n.type?this.Qt=this.Qt._t(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qt=this.Qt._t(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qt=this.Qt._t(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qt=this.Qt.remove(e):1===t.type&&2===n.type?this.Qt=this.Qt._t(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qt=this.Qt._t(e,{type:2,doc:t.doc}):Ts():this.Qt=this.Qt._t(e,t)}Gt(){const t=[];return this.Qt.Tt((e,n)=>{t.push(n)}),t}}class Ii{constructor(t,e,n,s,i,r,o,a){this.query=t,this.docs=e,this.zt=n,this.docChanges=s,this.Ht=i,this.fromCache=r,this.Jt=o,this.Yt=a}static Xt(t,e,n,s){const i=[];return e.forEach(t=>{i.push({type:0,doc:t})}),new Ii(t,e,bi.jt(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.Ht.$()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.Jt===t.Jt&&this.Ht.isEqual(t.Ht)&&vo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.zt.isEqual(t.zt)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Ti{constructor(t,e,n,s,i){this.at=t,this.Zt=e,this.te=n,this.ee=s,this.ne=i}static se(t,e){const n=new Map;return n.set(t,_i.ie(t,e)),new Ti(Vs.min(),n,vi(),li(),yi())}}class _i{constructor(t,e,n,s,i){this.resumeToken=t,this.re=e,this.oe=n,this.he=s,this.ae=i}static ie(t,e){return new _i(Js.ot,e,yi(),yi(),yi())}}class Ni{constructor(t,e,n,s){this.ue=t,this.removedTargetIds=e,this.key=n,this.ce=s}}class Ai{constructor(t,e){this.targetId=t,this.le=e}}class xi{constructor(t,e,n=Js.ot,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class Di{constructor(){this._e=0,this.fe=Ri(),this.de=Js.ot,this.we=!1,this.Te=!0}get re(){return this.we}get resumeToken(){return this.de}get Ee(){return 0!==this._e}get Ie(){return this.Te}Ae(t){t.rt()>0&&(this.Te=!0,this.de=t)}Re(){let t=yi(),e=yi(),n=yi();return this.fe.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:Ts()}}),new _i(this.de,this.we,t,e,n)}me(){this.Te=!1,this.fe=Ri()}Pe(t,e){this.Te=!0,this.fe=this.fe._t(t,e)}Ve(t){this.Te=!0,this.fe=this.fe.remove(t)}ge(){this._e+=1}ye(){this._e-=1}pe(){this.Te=!0,this.we=!0}}class Si{constructor(t){this.be=t,this.ve=new Map,this.Se=li(),this.Ce=ki(),this.De=new hi(Os)}Ne(t){for(const e of t.ue)t.ce instanceof ho?this.xe(e,t.ce):t.ce instanceof uo&&this.ke(e,t.key,t.ce);for(const e of t.removedTargetIds)this.ke(e,t.key,t.ce)}Oe(t){this.Fe(t,e=>{const n=this.Me(e);switch(t.state){case 0:this.$e(e)&&n.Ae(t.resumeToken);break;case 1:n.ye(),n.Ee||n.me(),n.Ae(t.resumeToken);break;case 2:n.ye(),n.Ee||this.removeTarget(e);break;case 3:this.$e(e)&&(n.pe(),n.Ae(t.resumeToken));break;case 4:this.$e(e)&&(this.Le(e),n.Ae(t.resumeToken));break;default:Ts()}})}Fe(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ve.forEach((t,n)=>{this.$e(n)&&e(n)})}qe(t){const e=t.targetId,n=t.le.count,s=this.Be(e);if(s){const t=s.target;if(Ys(t))if(0===n){const n=new js(t.path);this.ke(e,n,new uo(n,Vs.min()))}else _s(1===n);else this.Ue(e)!==n&&(this.Le(e),this.De=this.De.add(e))}}We(t){const e=new Map;this.ve.forEach((n,s)=>{const i=this.Be(s);if(i){if(n.re&&Ys(i.target)){const e=new js(i.target.path);null!==this.Se.get(e)||this.Ke(s,e)||this.ke(s,e,new uo(e,t))}n.Ie&&(e.set(s,n.Re()),n.me())}});let n=yi();this.Ce.forEach((t,e)=>{let s=!0;e.Lt(t=>{const e=this.Be(t);return!e||2===e.ht||(s=!1,!1)}),s&&(n=n.add(t))});const s=new Ti(t,e,this.De,this.Se,n);return this.Se=li(),this.Ce=ki(),this.De=new hi(Os),s}xe(t,e){if(!this.$e(t))return;const n=this.Ke(t,e.key)?2:0;this.Me(t).Pe(e.key,n),this.Se=this.Se._t(e.key,e),this.Ce=this.Ce._t(e.key,this.je(e.key).add(t))}ke(t,e,n){if(!this.$e(t))return;const s=this.Me(t);this.Ke(t,e)?s.Pe(e,1):s.Ve(e),this.Ce=this.Ce._t(e,this.je(e).delete(t)),n&&(this.Se=this.Se._t(e,n))}removeTarget(t){this.ve.delete(t)}Ue(t){const e=this.Me(t).Re();return this.be.Qe(t).size+e.oe.size-e.ae.size}ge(t){this.Me(t).ge()}Me(t){let e=this.ve.get(t);return e||(e=new Di,this.ve.set(t,e)),e}je(t){let e=this.Ce.get(t);return e||(e=new hi(Os),this.Ce=this.Ce._t(t,e)),e}$e(t){const e=null!==this.Be(t);return e||vs("WatchChangeAggregator","Detected inactive target",t),e}Be(t){const e=this.ve.get(t);return e&&e.Ee?null:this.be.Ge(t)}Le(t){this.ve.set(t,new Di),this.be.Qe(t).forEach(e=>{this.ke(t,e,null)})}Ke(t,e){return this.be.Qe(t).has(e)}}function ki(){return new ri(js.D)}function Ri(){return new ri(js.D)}function Oi(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ci(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Li(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Pi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Vi(t){const e=Gi(t.mapValue.fields.__local_write_time__.timestampValue);return new Ps(e.seconds,e.nanos)}const Ui=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Pi(t)?4:10:Ts()}function qi(t,e){const n=Mi(t);if(n!==Mi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Vi(t).isEqual(Vi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Gi(t.timestampValue),s=Gi(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Wi(t.bytesValue).isEqual(Wi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return zi(t.geoPointValue.latitude)===zi(e.geoPointValue.latitude)&&zi(t.geoPointValue.longitude)===zi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return zi(t.integerValue)===zi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=zi(t.doubleValue),s=zi(e.doubleValue);return n===s?zs(n)===zs(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return Cs(t.arrayValue.values||[],e.arrayValue.values||[],qi);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(Oi(n)!==Oi(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!qi(n[t],s[t])))return!1;return!0}(t,e);default:return Ts()}}function Fi(t,e){return void 0!==(t.values||[]).find(t=>qi(t,e))}function ji(t,e){const n=Mi(t),s=Mi(e);if(n!==s)return Os(n,s);switch(n){case 0:return 0;case 1:return Os(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=zi(t.integerValue||t.doubleValue),s=zi(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return $i(t.timestampValue,e.timestampValue);case 4:return $i(Vi(t),Vi(e));case 5:return Os(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Wi(t),s=Wi(e);return n.p(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=Os(n[t],s[t]);if(0!==e)return e}return Os(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Os(zi(t.latitude),zi(e.latitude));return 0!==n?n:Os(zi(t.longitude),zi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=ji(n[t],s[t]);if(e)return e}return Os(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=Os(s[t],r[t]);if(0!==e)return e;const o=ji(n[s[t]],i[r[t]]);if(0!==o)return o}return Os(s.length,r.length)}(t.mapValue,e.mapValue);default:throw Ts()}}function $i(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Os(t,e);const n=Gi(t),s=Gi(e),i=Os(n.seconds,s.seconds);return 0!==i?i:Os(n.nanos,s.nanos)}function Bi(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){const e=Gi(t);return`time(${e.seconds},${e.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Wi(e.bytesValue).toBase64():"referenceValue"in e?(s=e.referenceValue,js.Y(s).toString()):"geoPointValue"in e?`geo(${(n=e.geoPointValue).latitude},${n.longitude})`:"arrayValue"in e?function(e){let n="[",s=!0;for(const i of e.values||[])s?s=!1:n+=",",n+=t(i);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){const n=Object.keys(e.fields||{}).sort();let s="{",i=!0;for(const r of n)i?i=!1:s+=",",s+=`${r}:${t(e.fields[r])}`;return s+"}"}(e.mapValue):Ts();var n,s}(t)}function Gi(t){if(_s(!!t),"string"==typeof t){let e=0;const n=Ui.exec(t);if(_s(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:zi(t.seconds),nanos:zi(t.nanos)}}function zi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Wi(t){return"string"==typeof t?Js.fromBase64String(t):Js.fromUint8Array(t)}function Hi(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.U()}`}}function Ki(t){return!!t&&"integerValue"in t}function Qi(t){return!!t&&"arrayValue"in t}function Xi(t){return!!t&&"nullValue"in t}function Yi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ji(t){return!!t&&"mapValue"in t}const Zi={asc:"ASCENDING",desc:"DESCENDING"},tr={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class er{constructor(t,e){this.et=t,this.ze=e}}function nr(t){return{integerValue:""+t}}function sr(t,e){if(t.ze){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zs(e)?"-0":e}}function ir(t,e){return Ws(e)?nr(e):sr(t,e)}function rr(t,e){return t.ze?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function or(t,e){return t.ze?e.toBase64():e.toUint8Array()}function ar(t){return _s(!!t),Vs.g(function(t){const e=Gi(t);return new Ps(e.seconds,e.nanos)}(t))}function hr(t,e){return function(t){return new Ms(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).U()}function ur(t){const e=Ms.W(t);return _s(Ar(e)),e}function cr(t,e){return hr(t.et,e.path)}function lr(t,e){const n=ur(e);return _s(n.get(1)===t.et.projectId),_s(!n.get(3)&&!t.et.database||n.get(3)===t.et.database),new js(gr(n))}function fr(t,e){return hr(t.et,e)}function dr(t){const e=ur(t);return 4===e.length?Ms.K():gr(e)}function pr(t){return new Ms(["projects",t.et.projectId,"databases",t.et.database]).U()}function gr(t){return _s(t.length>4&&"documents"===t.get(4)),t.k(5)}function mr(t,e,n){return{name:cr(t,e),fields:n.proto.mapValue.fields}}function yr(t,e){let n;if(e instanceof Xr)n={update:mr(t,e.key,e.value)};else if(e instanceof no)n={delete:cr(t,e.key)};else if(e instanceof Yr)n={update:mr(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.U())),{fieldPaths:e}}(e.He)};else if(e instanceof Zr)n={transform:{document:cr(t,e.key),fieldTransforms:e.fieldTransforms.map(t=>(function(t,e){const n=e.transform;if(n instanceof Rr)return{fieldPath:e.field.U(),setToServerValue:"REQUEST_TIME"};if(n instanceof Or)return{fieldPath:e.field.U(),appendMissingElements:{values:n.elements}};if(n instanceof Lr)return{fieldPath:e.field.U(),removeAllFromArray:{values:n.elements}};if(n instanceof Vr)return{fieldPath:e.field.U(),increment:n.Je};throw Ts()})(0,t))}};else{if(!(e instanceof so))return Ts();n={verify:cr(t,e.key)}}return e.Xe.Ye||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:function(t,e){return rr(t,e.S())}(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Ts()}(t,e.Xe)),n}function wr(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?$r.updateTime(ar(t.updateTime)):void 0!==t.exists?$r.exists(t.exists):$r.Ze()}(e.currentDocument):$r.Ze();if(e.update){e.update.name;const s=lr(t,e.update.name),i=new io({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new qr(e.map(t=>Fs.J(t)))}(e.updateMask);return new Yr(s,i,t,n)}return new Xr(s,i,n)}if(e.delete){const s=lr(t,e.delete);return new no(s,n)}if(e.transform){const s=lr(t,e.transform.document),i=e.transform.fieldTransforms.map(e=>(function(t,e){let n=null;if("setToServerValue"in e)_s("REQUEST_TIME"===e.setToServerValue),n=new Rr;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Or(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Lr(t)}else"increment"in e?n=new Vr(t,e.increment):Ts();const s=Fs.J(e.fieldPath);return new Fr(s,n)})(t,e));return _s(!0===n.exists),new Zr(s,i)}if(e.verify){const s=lr(t,e.verify);return new so(s,n)}return Ts()}function vr(t,e){return{documents:[fr(t,e.path)]}}function br(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=fr(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=fr(t,s.O()),n.structuredQuery.from=[{collectionId:s.M()}]);const i=function(t){if(0===t.length)return;const e=t.map(t=>(function(t){if("=="===t.op){if(Yi(t.value))return{unaryFilter:{field:_r(t.field),op:"IS_NAN"}};if(Xi(t.value))return{unaryFilter:{field:_r(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Yi(t.value))return{unaryFilter:{field:_r(t.field),op:"IS_NOT_NAN"}};if(Xi(t.value))return{unaryFilter:{field:_r(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:_r(t.field),op:(e=t.op,tr[e]),value:t.value}};var e})(t));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0!==t.length)return t.map(t=>(function(t){return{field:_r(t.field),direction:(e=t.dir,Zi[e])};var e})(t))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.ze||Gs(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=Ir(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ir(e.endAt)),n}function Er(t){let e=dr(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){_s(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Nr(t.unaryFilter.field);return _o.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Nr(t.unaryFilter.field);return _o.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Nr(t.unaryFilter.field);return _o.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Nr(t.unaryFilter.field);return _o.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Ts()}}(e)]:void 0!==e.fieldFilter?[function(t){return _o.create(Nr(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Ts()}}(t.fieldFilter.op),t.fieldFilter.value)}(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((t,e)=>t.concat(e)):Ts():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(t=>(function(t){return new Uo(Nr(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))})(t)));let a=null;n.limit&&(a=function(t){let e;return Gs(e="object"==typeof t?t.value:t)?null:e}(n.limit));let h=null;n.startAt&&(h=Tr(n.startAt));let u=null;return n.endAt&&(u=Tr(n.endAt)),wo(po(e,i,o,r,a,"F",h,u))}function Ir(t){return{before:t.before,values:t.position}}function Tr(t){const e=!!t.before,n=t.values||[];return new Co(n,e)}function _r(t){return{fieldPath:t.U()}}function Nr(t){return Fs.J(t.fieldPath)}function Ar(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class xr{constructor(){this.tn=void 0}}function Dr(t,e,n){return t instanceof Rr?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Or?Cr(t,e):t instanceof Lr?Pr(t,e):function(t,e){const n=kr(t,e),s=Ur(n)+Ur(t.Je);return Ki(n)&&Ki(t.Je)?nr(s):sr(t.serializer,s)}(t,e)}function Sr(t,e,n){return t instanceof Or?Cr(t,e):t instanceof Lr?Pr(t,e):n}function kr(t,e){return t instanceof Vr?Ki(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}class Rr extends xr{}class Or extends xr{constructor(t){super(),this.elements=t}}function Cr(t,e){const n=Mr(e);for(const e of t.elements)n.some(t=>qi(t,e))||n.push(e);return{arrayValue:{values:n}}}class Lr extends xr{constructor(t){super(),this.elements=t}}function Pr(t,e){let n=Mr(e);for(const e of t.elements)n=n.filter(t=>!qi(t,e));return{arrayValue:{values:n}}}class Vr extends xr{constructor(t,e){super(),this.serializer=t,this.Je=e}}function Ur(t){return zi(t.integerValue||t.doubleValue)}function Mr(t){return Qi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class qr{constructor(t){this.fields=t,t.sort(Fs.D)}en(t){for(const e of this.fields)if(e.L(t))return!0;return!1}isEqual(t){return Cs(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class Fr{constructor(t,e){this.field=t,this.transform=e}}class jr{constructor(t,e){this.version=t,this.transformResults=e}}class $r{constructor(t,e){this.updateTime=t,this.exists=e}static Ze(){return new $r}static exists(t){return new $r(void 0,t)}static updateTime(t){return new $r(t)}get Ye(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Br(t,e){return void 0!==t.updateTime?e instanceof ho&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof ho}class Gr{}function zr(t,e,n){return t instanceof Xr?function(t,e,n){return new ho(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof Yr?function(t,e,n){if(!Br(t.Xe,e))return new co(t.key,n.version);const s=Jr(t,e);return new ho(t.key,n.version,s,{hasCommittedMutations:!0})}(t,e,n):t instanceof Zr?function(t,e,n){if(_s(null!=n.transformResults),!Br(t.Xe,e))return new co(t.key,n.version);const s=to(t,e),i=function(t,e,n){const s=[];_s(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform;let a=null;e instanceof ho&&(a=e.field(r.field)),s.push(Sr(o,a,n[i]))}return s}(t.fieldTransforms,e,n.transformResults),r=n.version,o=eo(t,s.data(),i);return new ho(t.key,r,o,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new uo(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function Wr(t,e,n,s){return t instanceof Xr?function(t,e){if(!Br(t.Xe,e))return e;const n=Qr(e);return new ho(t.key,n,t.value,{nn:!0})}(t,e):t instanceof Yr?function(t,e){if(!Br(t.Xe,e))return e;const n=Qr(e),s=Jr(t,e);return new ho(t.key,n,s,{nn:!0})}(t,e):t instanceof Zr?function(t,e,n,s){if(!Br(t.Xe,e))return e;const i=to(t,e),r=function(t,e,n,s){const i=[];for(const r of t){const t=r.transform;let o=null;n instanceof ho&&(o=n.field(r.field)),null===o&&s instanceof ho&&(o=s.field(r.field)),i.push(Dr(t,o,e))}return i}(t.fieldTransforms,n,e,s),o=eo(t,i.data(),r);return new ho(t.key,i.version,o,{nn:!0})}(t,e,s,n):function(t,e){return Br(t.Xe,e)?new uo(t.key,Vs.min()):e}(t,e)}function Hr(t,e){return t instanceof Zr?function(t,e){let n=null;for(const s of t.fieldTransforms){const t=e instanceof ho?e.field(s.field):void 0,i=kr(s.transform,t||null);null!=i&&(n=null==n?(new ro).set(s.field,i):n.set(s.field,i))}return n?n.sn():null}(t,e):null}function Kr(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Xe.isEqual(e.Xe)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.He.isEqual(e.He):2!==t.type||Cs(t.fieldTransforms,t.fieldTransforms,(t,e)=>(function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Or&&e instanceof Or||t instanceof Lr&&e instanceof Lr?Cs(t.elements,e.elements,qi):t instanceof Vr&&e instanceof Vr?qi(t.Je,e.Je):t instanceof Rr&&e instanceof Rr}(t.transform,e.transform)})(t,e)))}function Qr(t){return t instanceof ho?t.version:Vs.min()}class Xr extends Gr{constructor(t,e,n){super(),this.key=t,this.value=e,this.Xe=n,this.type=0}}class Yr extends Gr{constructor(t,e,n,s){super(),this.key=t,this.data=e,this.He=n,this.Xe=s,this.type=1}}function Jr(t,e){let n;return function(t,e){const n=new ro(e);return t.He.fields.forEach(e=>{if(!e.$()){const s=t.data.field(e);null!==s?n.set(e,s):n.delete(e)}}),n.sn()}(t,n=e instanceof ho?e.data():io.empty())}class Zr extends Gr{constructor(t,e){super(),this.key=t,this.fieldTransforms=e,this.type=2,this.Xe=$r.exists(!0)}}function to(t,e){return e}function eo(t,e,n){const s=new ro(e);for(let e=0;e<t.fieldTransforms.length;e++){const i=t.fieldTransforms[e];s.set(i.field,n[e])}return s.sn()}class no extends Gr{constructor(t,e){super(),this.key=t,this.Xe=e,this.type=3}}class so extends Gr{constructor(t,e){super(),this.key=t,this.Xe=e,this.type=4}}class io{constructor(t){this.proto=t}static empty(){return new io({mapValue:{}})}field(t){if(t.$())return this.proto;{let e=this.proto;for(let n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Ji(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.M()])||null}}isEqual(t){return qi(this.proto,t.proto)}}class ro{constructor(t=io.empty()){this.rn=t,this.on=new Map}set(t,e){return this.hn(t,e),this}delete(t){return this.hn(t,null),this}hn(t,e){let n=this.on;for(let e=0;e<t.length-1;++e){const s=t.get(e);let i=n.get(s);i instanceof Map?n=i:i&&10===Mi(i)?(i=new Map(Object.entries(i.mapValue.fields||{})),n.set(s,i),n=i):(i=new Map,n.set(s,i),n=i)}n.set(t.M(),e)}sn(){const t=this.an(Fs.K(),this.on);return null!=t?new io(t):this.rn}an(t,e){let n=!1;const s=this.rn.field(t),i=Ji(s)?Object.assign({},s.mapValue.fields):{};return e.forEach((e,s)=>{if(e instanceof Map){const r=this.an(t.child(s),e);null!=r&&(i[s]=r,n=!0)}else null!==e?(i[s]=e,n=!0):i.hasOwnProperty(s)&&(delete i[s],n=!0)}),n?{mapValue:{fields:i}}:null}}function oo(t){const e=[];return Ci(t.fields||{},(t,n)=>{const s=new Fs([t]);if(Ji(n)){const t=oo(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)}),new qr(e)}class ao{constructor(t,e){this.key=t,this.version=e}}class ho extends ao{constructor(t,e,n,s){super(t,e),this.un=n,this.nn=!!s.nn,this.hasCommittedMutations=!!s.hasCommittedMutations}field(t){return this.un.field(t)}data(){return this.un}cn(){return this.un.proto}isEqual(t){return t instanceof ho&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.nn===t.nn&&this.hasCommittedMutations===t.hasCommittedMutations&&this.un.isEqual(t.un)}toString(){return`Document(${this.key}, ${this.version}, ${this.un.toString()}, {hasLocalMutations: ${this.nn}}), {hasCommittedMutations: ${this.hasCommittedMutations}})`}get hasPendingWrites(){return this.nn||this.hasCommittedMutations}}class uo extends ao{constructor(t,e,n){super(t,e),this.hasCommittedMutations=!(!n||!n.hasCommittedMutations)}toString(){return`NoDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return this.hasCommittedMutations}isEqual(t){return t instanceof uo&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class co extends ao{toString(){return`UnknownDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return!0}isEqual(t){return t instanceof co&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}function lo(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new xs(As.INVALID_ARGUMENT,`Type does not match the expected instance. Did you pass '${e.name}' from a different Firestore SDK?`):new xs(As.INVALID_ARGUMENT,`Expected type '${e.name}', but was '${t.constructor.name}'`);return t}class fo{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.ln=n,this.filters=s,this.limit=i,this._n=r,this.startAt=o,this.endAt=a,this.fn=null,this.dn=null,this.startAt,this.endAt}wn(t){return new fo(t,null,this.ln.slice(),this.filters.slice(),this.limit,this._n,this.startAt,this.endAt)}Tn(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.ln.length||1===this.ln.length&&this.ln[0].field.G())}En(){return!Gs(this.limit)&&"F"===this._n}In(){return!Gs(this.limit)&&"L"===this._n}An(){return this.ln.length>0?this.ln[0].field:null}Rn(){for(const t of this.filters)if(t.mn())return t.field;return null}Pn(t){for(const e of this.filters)if(t.indexOf(e.op)>=0)return e.op;return null}}function po(t,e,n,s,i,r,o,a){return new fo(t,e,n,s,i,r,o,a)}function go(t){return new fo(t)}function mo(t){return null!==t.collectionGroup}function yo(t){const e=lo(t,fo);if(null===e.fn){e.fn=[];const t=e.Rn(),n=e.An();if(null!==t&&null===n)t.G()||e.fn.push(new Uo(t)),e.fn.push(new Uo(Fs.H(),"asc"));else{let t=!1;for(const n of e.ln)e.fn.push(n),n.field.G()&&(t=!0);if(!t){const t=e.ln.length>0?e.ln[e.ln.length-1].dir:"asc";e.fn.push(new Uo(Fs.H(),t))}}}return e.fn}function wo(t){const e=lo(t,fo);if(!e.dn)if("F"===e._n)e.dn=Ks(e.path,e.collectionGroup,yo(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of yo(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Uo(n.field,e))}const n=e.endAt?new Co(e.endAt.position,!e.endAt.before):null,s=e.startAt?new Co(e.startAt.position,!e.startAt.before):null;e.dn=Ks(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.dn}function vo(t,e){return Xs(wo(t),wo(e))&&t._n===e._n}function bo(t){return`${Qs(wo(t))}|lt:${t._n}`}function Eo(t){return`Query(target=${function(t){let e=t.path.U();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>{return`${(e=t).field.U()} ${e.op} ${Bi(e.value)}`;var e}).join(", ")}]`),Gs(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>(function(t){return`${t.field.U()} (${t.dir})`})(t)).join(", ")}]`),t.startAt&&(e+=", startAt: "+Lo(t.startAt)),t.endAt&&(e+=", endAt: "+Lo(t.endAt)),`Target(${e})`}(wo(t))}; limitType=${t._n})`}function Io(t,e){return function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.X(t.collectionGroup)&&t.path.L(n):js.Z(t.path)?t.path.isEqual(n):t.path.q(n)}(t,e)&&function(t,e){for(const n of t.ln)if(!n.field.G()&&null===e.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Po(t.startAt,yo(t),e))&&(!t.endAt||!Po(t.endAt,yo(t),e))}(t,e)}function To(t){return(e,n)=>{let s=!1;for(const i of yo(t)){const t=Mo(i,e,n);if(0!==t)return t;s=s||i.field.G()}return 0}}class _o extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){if(t.G())return"in"===e||"not-in"===e?this.Vn(t,e,n):new No(t,e,n);if(Xi(n)){if("=="!==e&&"!="!==e)throw new xs(As.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new _o(t,e,n)}if(Yi(n)){if("=="!==e&&"!="!==e)throw new xs(As.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new _o(t,e,n)}return"array-contains"===e?new So(t,n):"in"===e?new ko(t,n):"not-in"===e?new Ro(t,n):"array-contains-any"===e?new Oo(t,n):new _o(t,e,n)}static Vn(t,e,n){return"in"===e?new Ao(t,n):new xo(t,n)}matches(t){const e=t.field(this.field);return"!="===this.op?null!==e&&this.gn(ji(e,this.value)):null!==e&&Mi(this.value)===Mi(e)&&this.gn(ji(e,this.value))}gn(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Ts()}}mn(){return["<","<=",">",">=","!="].indexOf(this.op)>=0}}class No extends _o{constructor(t,e,n){super(t,e,n),this.key=js.Y(n.referenceValue)}matches(t){const e=js.D(t.key,this.key);return this.gn(e)}}class Ao extends _o{constructor(t,e){super(t,"in",e),this.keys=Do("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class xo extends _o{constructor(t,e){super(t,"not-in",e),this.keys=Do("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Do(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>js.Y(t.referenceValue))}class So extends _o{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.field(this.field);return Qi(e)&&Fi(e.arrayValue,this.value)}}class ko extends _o{constructor(t,e){super(t,"in",e)}matches(t){const e=t.field(this.field);return null!==e&&Fi(this.value.arrayValue,e)}}class Ro extends _o{constructor(t,e){super(t,"not-in",e)}matches(t){const e=t.field(this.field);return null!==e&&!Fi(this.value.arrayValue,e)}}class Oo extends _o{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.field(this.field);return!(!Qi(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>Fi(this.value.arrayValue,t))}}class Co{constructor(t,e){this.position=t,this.before=e}}function Lo(t){return`${t.before?"b":"a"}:${t.position.map(t=>Bi(t)).join(",")}`}function Po(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.G()?js.D(js.Y(o.referenceValue),n.key):ji(o,n.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return t.before?s<=0:s<0}function Vo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!qi(t.position[n],e.position[n]))return!1;return!0}class Uo{constructor(t,e="asc"){this.field=t,this.dir=e}}function Mo(t,e,n){const s=t.field.G()?js.D(e.key,n.key):function(t,e,n){const s=e.field(t),i=n.field(t);return null!==s&&null!==i?ji(s,i):Ts()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return Ts()}}function qo(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Fo{constructor(t,e,n,s){this.batchId=t,this.yn=e,this.baseMutations=n,this.mutations=s}pn(t,e,n){const s=n.bn;for(let n=0;n<this.mutations.length;n++){const i=this.mutations[n];i.key.isEqual(t)&&(e=zr(i,e,s[n]))}return e}vn(t,e){for(const n of this.baseMutations)n.key.isEqual(t)&&(e=Wr(n,e,e,this.yn));const n=e;for(const s of this.mutations)s.key.isEqual(t)&&(e=Wr(s,e,n,this.yn));return e}Sn(t){let e=t;return this.mutations.forEach(n=>{const s=this.vn(n.key,t.get(n.key));s&&(e=e._t(n.key,s))}),e}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),yi())}isEqual(t){return this.batchId===t.batchId&&Cs(this.mutations,t.mutations,(t,e)=>Kr(t,e))&&Cs(this.baseMutations,t.baseMutations,(t,e)=>Kr(t,e))}}class jo{constructor(t,e,n,s){this.batch=t,this.Cn=e,this.bn=n,this.Dn=s}static from(t,e,n){_s(t.mutations.length===n.length);let s=gi;const i=t.mutations;for(let t=0;t<i.length;t++)s=s._t(i[t].key,n[t].version);return new jo(t,e,n,s)}}class $o{constructor(t,e){this.Nn=t,this.xn=e,this.kn={}}get(t){const e=this.Nn(t),n=this.kn[e];if(void 0!==n)for(const[e,s]of n)if(this.xn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.Nn(t),s=this.kn[n];if(void 0!==s){for(let n=0;n<s.length;n++)if(this.xn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e])}else this.kn[n]=[[t,e]]}delete(t){const e=this.Nn(t),n=this.kn[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.xn(n[s][0],t))return 1===n.length?delete this.kn[e]:n.splice(s,1),!0;return!1}forEach(t){Ci(this.kn,(e,n)=>{for(const[e,s]of n)t(e,s)})}$(){return Li(this.kn)}}class Bo{constructor(t){this.On=null,this.Fn=null,this.result=void 0,this.error=void 0,this.Mn=!1,this.$n=!1,t(t=>{this.Mn=!0,this.result=t,this.On&&this.On(t)},t=>{this.Mn=!0,this.error=t,this.Fn&&this.Fn(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.$n&&Ts(),this.$n=!0,this.Mn?this.error?this.Ln(e,this.error):this.qn(t,this.result):new Bo((n,s)=>{this.On=(e=>{this.qn(t,e).next(n,s)}),this.Fn=(t=>{this.Ln(e,t).next(n,s)})})}Bn(){return new Promise((t,e)=>{this.next(t,e)})}Un(t){try{const e=t();return e instanceof Bo?e:Bo.resolve(e)}catch(t){return Bo.reject(t)}}qn(t,e){return t?this.Un(()=>t(e)):Bo.resolve(e)}Ln(t,e){return t?this.Un(()=>t(e)):Bo.reject(e)}static resolve(t){return new Bo((e,n)=>{e(t)})}static reject(t){return new Bo((e,n)=>{n(t)})}static Wn(t){return new Bo((e,n)=>{let s=0,i=0,r=!1;t.forEach(t=>{++s,t.next(()=>{++i,r&&i===s&&e()},t=>n(t))}),r=!0,i===s&&e()})}static Kn(t){let e=Bo.resolve(!1);for(const n of t)e=e.next(t=>t?Bo.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,s)=>{n.push(e.call(this,t,s))}),this.Wn(n)}}class Go{constructor(){this.jn=new $o(t=>t.toString(),(t,e)=>t.isEqual(e)),this.Qn=!1}set readTime(t){this.Gn=t}get readTime(){return this.Gn}zn(t,e){this.Hn(),this.readTime=e,this.jn.set(t.key,t)}Jn(t,e){this.Hn(),e&&(this.readTime=e),this.jn.set(t,null)}Yn(t,e){this.Hn();const n=this.jn.get(e);return void 0!==n?Bo.resolve(n):this.Xn(t,e)}getEntries(t,e){return this.Zn(t,e)}apply(t){return this.Hn(),this.Qn=!0,this.ts(t)}Hn(){}}const zo="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Wo{constructor(){this.es=[]}ns(t){this.es.push(t)}ss(){this.es.forEach(t=>t())}}class Ho{constructor(t,e,n){this.rs=t,this.os=e,this.hs=n}as(t,e){return this.os.us(t,e).next(n=>this.cs(t,e,n))}cs(t,e,n){return this.rs.Yn(t,e).next(t=>{for(const s of n)t=s.vn(e,t);return t})}ls(t,e,n){let s=fi();return e.forEach((t,e)=>{for(const s of n)e=s.vn(t,e);s=s._t(t,e)}),s}_s(t,e){return this.rs.getEntries(t,e).next(e=>this.fs(t,e))}fs(t,e){return this.os.ds(t,e).next(n=>{const s=this.ls(t,e,n);let i=li();return s.forEach((t,e)=>{e||(e=new uo(t,Vs.min())),i=i._t(t,e)}),i})}ws(t,e,n){return function(t){return js.Z(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Ts(t,e.path):mo(e)?this.Es(t,e,n):this.Is(t,e,n)}Ts(t,e){return this.as(t,new js(e)).next(t=>{let e=pi();return t instanceof ho&&(e=e._t(t.key,t)),e})}Es(t,e,n){const s=e.collectionGroup;let i=pi();return this.hs.As(t,s).next(r=>Bo.forEach(r,r=>{const o=e.wn(r.child(s));return this.Is(t,o,n).next(t=>{t.forEach((t,e)=>{i=i._t(t,e)})})}).next(()=>i))}Is(t,e,n){let s,i;return this.rs.ws(t,e,n).next(n=>(s=n,this.os.Rs(t,e))).next(e=>(i=e,this.ms(t,i,s).next(t=>{s=t;for(const t of i)for(const e of t.mutations){const n=e.key,i=s.get(n),r=Wr(e,i,i,t.yn);s=r instanceof ho?s._t(n,r):s.remove(n)}}))).next(()=>(s.forEach((t,n)=>{Io(e,n)||(s=s.remove(t))}),s))}ms(t,e,n){let s=yi();for(const t of e)for(const e of t.mutations)e instanceof Yr&&null===n.get(e.key)&&(s=s.add(e.key));let i=n;return this.rs.getEntries(t,s).next(t=>(t.forEach((t,e)=>{null!==e&&e instanceof ho&&(i=i._t(t,e))}),i))}}class Ko{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Ps=n,this.Vs=s}static gs(t,e){let n=yi(),s=yi();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new Ko(t,e.fromCache,n,s)}}class Qo{constructor(t,e){this.previousValue=t,e&&(e.ys=(t=>this.ps(t)),this.bs=(t=>e.vs(t)))}ps(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.bs&&this.bs(t),t}}Qo.Ss=-1;class Xo{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class Yo{constructor(t,e,n=1e3,s=1.5,i=6e4){this.Cs=t,this.Ds=e,this.Ns=n,this.xs=s,this.ks=i,this.Os=0,this.Fs=null,this.Ms=Date.now(),this.reset()}reset(){this.Os=0}$s(){this.Os=this.ks}Ls(t){this.cancel();const e=Math.floor(this.Os+this.qs()),n=Math.max(0,Date.now()-this.Ms),s=Math.max(0,e-n);s>0&&vs("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Os} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Fs=this.Cs.Bs(this.Ds,s,()=>(this.Ms=Date.now(),t())),this.Os*=this.xs,this.Os<this.Ns&&(this.Os=this.Ns),this.Os>this.ks&&(this.Os=this.ks)}Us(){null!==this.Fs&&(this.Fs.Ws(),this.Fs=null)}cancel(){null!==this.Fs&&(this.Fs.cancel(),this.Fs=null)}qs(){return(Math.random()-.5)*this.Os}}class Jo{constructor(t,e,n){this.name=t,this.version=e,this.Ks=n,12.2===Jo.js(s())&&bs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return vs("SimpleDb","Removing database:",t),ia(window.indexedDB.deleteDatabase(t)).Bn()}static Qs(){if("undefined"==typeof indexedDB)return!1;if(Jo.Gs())return!0;const t=s(),e=Jo.js(t),n=0<e&&e<10,i=Jo.zs(t),r=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||r)}static Gs(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Hs)}static Js(t,e){return t.store(e)}static js(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static zs(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Ys(){return this.db||(vs("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,e)=>{const n=indexedDB.open(this.name,this.version);n.onsuccess=(e=>{const n=e.target.result;t(n)}),n.onblocked=(()=>{e(new ta("Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))}),n.onerror=(t=>{const n=t.target.error;"VersionError"===n.name?e(new xs(As.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):e(new ta(n))}),n.onupgradeneeded=(t=>{vs("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.Ks.createOrUpgrade(e,n.transaction,t.oldVersion,this.version).next(()=>{vs("SimpleDb","Database upgrade to version "+this.version+" complete")})})})),this.Xs&&(this.db.onversionchange=(t=>this.Xs(t))),this.db}Zs(t){this.Xs=t,this.db&&(this.db.onversionchange=(e=>t(e)))}async runTransaction(t,e,n){const s="readonly"===t;for(;;){0;try{this.db=await this.Ys();const i=na.open(this.db,s?"readonly":"readwrite",e),r=n(i).catch(t=>(i.abort(t),Bo.reject(t))).Bn();return r.catch(()=>{}),await i.ti,r}catch(t){const e="FirebaseError"!==t.name&&r<3;if(vs("SimpleDb","Transaction failed with error: %s. Retrying: %s.",t.message,e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Zo{constructor(t){this.ei=t,this.ni=!1,this.si=null}get Mn(){return this.ni}get ii(){return this.si}set cursor(t){this.ei=t}done(){this.ni=!0}ri(t){this.si=t}delete(){return ia(this.ei.delete())}}class ta extends xs{constructor(t){super(As.UNAVAILABLE,"IndexedDB transaction failed: "+t),this.name="IndexedDbTransactionError"}}function ea(t){return"IndexedDbTransactionError"===t.name}class na{constructor(t){this.transaction=t,this.aborted=!1,this.oi=new Xo,this.transaction.oncomplete=(()=>{this.oi.resolve()}),this.transaction.onabort=(()=>{t.error?this.oi.reject(new ta(t.error)):this.oi.resolve()}),this.transaction.onerror=(t=>{const e=oa(t.target.error);this.oi.reject(new ta(e))})}static open(t,e,n){try{return new na(t.transaction(n,e))}catch(t){throw new ta(t)}}get ti(){return this.oi.promise}abort(t){t&&this.oi.reject(t),this.aborted||(vs("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new sa(e)}}class sa{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(vs("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(vs("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ia(n)}add(t){return vs("SimpleDb","ADD",this.store.name,t,t),ia(this.store.add(t))}get(t){return ia(this.store.get(t)).next(e=>(void 0===e&&(e=null),vs("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return vs("SimpleDb","DELETE",this.store.name,t),ia(this.store.delete(t))}count(){return vs("SimpleDb","COUNT",this.store.name),ia(this.store.count())}hi(t,e){const n=this.cursor(this.options(t,e)),s=[];return this.ai(n,(t,e)=>{s.push(e)}).next(()=>s)}ui(t,e){vs("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.ci=!1;const s=this.cursor(n);return this.ai(s,(t,e,n)=>n.delete())}li(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.ai(s,e)}_i(t){const e=this.cursor({});return new Bo((n,s)=>{e.onerror=(t=>{const e=oa(t.target.error);s(e)}),e.onsuccess=(e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next(t=>{t?s.continue():n()}):n()})})}ai(t,e){const n=[];return new Bo((s,i)=>{t.onerror=(t=>{i(t.target.error)}),t.onsuccess=(t=>{const i=t.target.result;if(!i)return void s();const r=new Zo(i),o=e(i.primaryKey,i.value,r);if(o instanceof Bo){const t=o.catch(t=>(r.done(),Bo.reject(t)));n.push(t)}r.Mn?s():null===r.ii?i.continue():i.continue(r.ii)})}).next(()=>Bo.Wn(n))}options(t,e){let n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.ci?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function ia(t){return new Bo((e,n)=>{t.onsuccess=(t=>{const n=t.target.result;e(n)}),t.onerror=(t=>{const e=oa(t.target.error);n(e)})})}let ra=!1;function oa(t){const e=Jo.js(s());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new xs("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ra||(ra=!0,setTimeout(()=>{throw t},0)),t}}return t}function aa(){return"undefined"!=typeof window?window:null}class ha{constructor(t,e,n,s,i){this.fi=t,this.Ds=e,this.di=n,this.op=s,this.wi=i,this.Ti=new Xo,this.then=this.Ti.promise.then.bind(this.Ti.promise),this.Ti.promise.catch(t=>{})}static Ei(t,e,n,s,i){const r=Date.now()+n,o=new ha(t,e,r,s,i);return o.start(n),o}start(t){this.Ii=setTimeout(()=>this.Ai(),t)}Ws(){return this.Ai()}cancel(t){null!==this.Ii&&(this.clearTimeout(),this.Ti.reject(new xs(As.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}Ai(){this.fi.Ri(()=>null!==this.Ii?(this.clearTimeout(),this.op().then(t=>this.Ti.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.Ii&&(this.wi(this),clearTimeout(this.Ii),this.Ii=null)}}class ua{constructor(){this.mi=Promise.resolve(),this.Pi=[],this.Vi=!1,this.gi=[],this.yi=null,this.pi=!1,this.bi=[],this.vi=new Yo(this,"async_queue_retry"),this.Si=(()=>this.vi.Us());const t=aa();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Si)}get Ci(){return this.Vi}Ri(t){this.enqueue(t)}Di(t){this.Ni(),this.xi(t)}ki(t){return this.Ni(),this.xi(t)}async Oi(t){if(this.Ni(),!this.Vi){this.Vi=!0;const e=aa();e&&e.removeEventListener("visibilitychange",this.Si),await this.ki(t)}}enqueue(t){return this.Ni(),this.Vi?new Promise(t=>{}):this.xi(t)}Fi(t){this.Pi.push(t),this.Ri(()=>this.Mi())}async Mi(){if(0!==this.Pi.length){try{await this.Pi[0](),this.Pi.shift(),this.vi.reset()}catch(t){if(!ea(t))throw t;vs("AsyncQueue","Operation failed with retryable error: "+t)}this.Pi.length>0&&this.vi.Ls(()=>this.Mi())}}xi(t){const e=this.mi.then(()=>(this.pi=!0,t().catch(t=>{throw this.yi=t,this.pi=!1,bs("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.pi=!1,t))));return this.mi=e,e}Bs(t,e,n){this.Ni(),this.bi.indexOf(t)>-1&&(e=0);const s=ha.Ei(this,t,e,n,t=>this.$i(t));return this.gi.push(s),s}Ni(){this.yi&&Ts()}Li(){}async qi(){let t;do{t=this.mi,await t}while(t!==this.mi)}Bi(t){for(const e of this.gi)if(e.Ds===t)return!0;return!1}Ui(t){return this.qi().then(()=>{this.gi.sort((t,e)=>t.di-e.di);for(const e of this.gi)if(e.Ws(),"all"!==t&&e.Ds===t)break;return this.qi()})}Wi(t){this.bi.push(t)}$i(t){const e=this.gi.indexOf(t);this.gi.splice(e,1)}}function ca(t,e){if(bs("AsyncQueue",`${e}: ${t}`),ea(t))return new xs(As.UNAVAILABLE,`${e}: ${t}`);throw t}function la([t,e],[n,s]){const i=Os(t,n);return 0===i?Os(e,s):i}class fa{constructor(t){this.Ki=t,this.buffer=new hi(la),this.ji=0}Qi(){return++this.ji}Gi(t){const e=[t,this.Qi()];if(this.buffer.size<this.Ki)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();la(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}const da={zi:!1,Hi:0,Ji:0,Yi:0};class pa{constructor(t,e,n){this.Xi=t,this.Zi=e,this.tr=n}static er(t){return new pa(t,pa.nr,pa.sr)}}pa.ir=-1,pa.rr=1048576,pa.or=41943040,pa.nr=10,pa.sr=1e3,pa.hr=new pa(pa.or,pa.nr,pa.sr),pa.ar=new pa(pa.ir,0,0);class ga{constructor(t,e){this.ur=t,this.fi=e,this.cr=!1,this.lr=null}start(t){this.ur.params.Xi!==pa.ir&&this._r(t)}stop(){this.lr&&(this.lr.cancel(),this.lr=null)}get dr(){return null!==this.lr}_r(t){const e=this.cr?3e5:6e4;vs("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.lr=this.fi.Bs("lru_garbage_collection",e,async()=>{this.lr=null,this.cr=!0;try{await t.wr(this.ur)}catch(t){ea(t)?vs("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Nh(t)}await this._r(t)})}}class ma{constructor(t,e){this.Tr=t,this.params=e}Er(t,e){return this.Tr.Ir(t).next(t=>Math.floor(e/100*t))}Ar(t,e){if(0===e)return Bo.resolve(Qo.Ss);const n=new fa(e);return this.Tr.Fe(t,t=>n.Gi(t.sequenceNumber)).next(()=>this.Tr.Rr(t,t=>n.Gi(t))).next(()=>n.maxValue)}mr(t,e,n){return this.Tr.mr(t,e,n)}Pr(t,e){return this.Tr.Pr(t,e)}Vr(t,e){return this.params.Xi===pa.ir?(vs("LruGarbageCollector","Garbage collection skipped; disabled"),Bo.resolve(da)):this.gr(t).next(n=>n<this.params.Xi?(vs("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold `+this.params.Xi),da):this.yr(t,e))}gr(t){return this.Tr.gr(t)}yr(t,e){let n,s,i,r,o,a,u;const c=Date.now();return this.Er(t,this.params.Zi).next(e=>(e>this.params.tr?(vs("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.tr} from `+e),s=this.params.tr):s=e,r=Date.now(),this.Ar(t,s))).next(s=>(n=s,o=Date.now(),this.mr(t,n,e))).next(e=>(i=e,a=Date.now(),this.Pr(t,n))).next(t=>(u=Date.now(),ws()<=h.DEBUG&&vs("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-c}ms\n\tDetermined least recently used ${s} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(u-a)+"ms\n"+`Total Duration: ${u-c}ms`),Bo.resolve({zi:!0,Hi:s,Ji:i,Yi:t})))}}function ya(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=va(e)),e=wa(t.get(n),e);return va(e)}function wa(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function va(t){return t+""}function ba(t){const e=t.length;if(_s(e>=2),2===e)return _s(""===t.charAt(0)&&""===t.charAt(1)),Ms.K();const n=e-2,s=[];let i="";for(let n=0;n<e;){const e=t.indexOf("",n);switch((e<0||e>r)&&Ts(),t.charAt(e+1)){case"":const r=t.substring(n,e);let o;0===i.length?o=r:(o=i+=r,i=""),s.push(o);break;case"":i+=t.substring(n,e),i+="\0";break;case"":i+=t.substring(n,e+1);break;default:Ts()}n=e+2}return new Ms(s)}class Ea{constructor(t){this.pr=t}}function Ia(t,e){if(e.document)return function(t,e,n){const s=lr(t,e.name),i=ar(e.updateTime),r=new io({mapValue:{fields:e.fields}});return new ho(s,i,r,{hasCommittedMutations:!!n})}(t.pr,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=js.tt(e.noDocument.path),n=xa(e.noDocument.readTime);return new uo(t,n,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){const t=js.tt(e.unknownDocument.path),n=xa(e.unknownDocument.version);return new co(t,n)}return Ts()}function Ta(t,e,n){const s=_a(n),i=e.key.path.O().B();if(e instanceof ho){const n=function(t,e){return{name:cr(t,e.key),fields:e.cn().mapValue.fields,updateTime:rr(t,e.version.S())}}(t.pr,e),r=e.hasCommittedMutations;return new Ja(null,null,n,r,s,i)}if(e instanceof uo){const t=e.key.path.B(),n=Aa(e.version),r=e.hasCommittedMutations;return new Ja(null,new Xa(t,n),null,r,s,i)}if(e instanceof co){const t=e.key.path.B(),n=Aa(e.version);return new Ja(new Ya(t,n),null,null,!0,s,i)}return Ts()}function _a(t){const e=t.S();return[e.seconds,e.nanoseconds]}function Na(t){const e=new Ps(t[0],t[1]);return Vs.g(e)}function Aa(t){const e=t.S();return new za(e.seconds,e.nanoseconds)}function xa(t){const e=new Ps(t.seconds,t.nanoseconds);return Vs.g(e)}function Da(t,e){const n=(e.baseMutations||[]).map(e=>wr(t.pr,e)),s=e.mutations.map(e=>wr(t.pr,e)),i=Ps.fromMillis(e.localWriteTimeMs);return new Fo(e.batchId,i,n,s)}function Sa(t){const e=xa(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?xa(t.lastLimboFreeSnapshotVersion):Vs.min();let s;var i;return void 0!==t.query.documents?(_s(1===(i=t.query).documents.length),s=wo(go(dr(i.documents[0])))):s=Er(t.query),new Zs(s,t.targetId,0,t.lastListenSequenceNumber,e,n,Js.fromBase64String(t.resumeToken))}function ka(t,e){const n=Aa(e.at),s=Aa(e.lastLimboFreeSnapshotVersion);let i;i=Ys(e.target)?vr(t.pr,e.target):br(t.pr,e.target);const r=e.resumeToken.toBase64();return new th(e.targetId,Qs(e.target),n,r,e.sequenceNumber,s,i)}class Ra{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.hs=n,this.br=s,this.vr={}}static Sr(t,e,n,s){_s(""!==t.uid);const i=t.t()?t.uid:"";return new Ra(i,e,n,s)}Cr(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return La(t).li({index:Ka.userMutationsIndex,range:n},(t,n,s)=>{e=!1,s.done()}).next(()=>e)}Dr(t,e,n,s){const i=Pa(t),r=La(t);return r.add({}).next(o=>{_s("number"==typeof o);const a=new Fo(o,e,n,s),h=function(t,e,n){const s=n.baseMutations.map(e=>yr(t.pr,e)),i=n.mutations.map(e=>yr(t.pr,e));return new Ka(e,n.batchId,n.yn.toMillis(),s,i)}(this.serializer,this.userId,a),u=[];let c=new hi((t,e)=>Os(t.U(),e.U()));for(const t of s){const e=Qa.key(this.userId,t.key.path,o);c=c.add(t.key.path.O()),u.push(r.put(h)),u.push(i.put(e,Qa.PLACEHOLDER))}return c.forEach(e=>{u.push(this.hs.Nr(t,e))}),t.ns(()=>{this.vr[o]=a.keys()}),Bo.Wn(u).next(()=>a)})}xr(t,e){return La(t).get(e).next(t=>t?(_s(t.userId===this.userId),Da(this.serializer,t)):null)}kr(t,e){return this.vr[e]?Bo.resolve(this.vr[e]):this.xr(t,e).next(t=>{if(t){const n=t.keys();return this.vr[e]=n,n}return null})}Or(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return La(t).li({index:Ka.userMutationsIndex,range:s},(t,e,s)=>{e.userId===this.userId&&(_s(e.batchId>=n),i=Da(this.serializer,e)),s.done()}).next(()=>i)}Fr(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return La(t).li({index:Ka.userMutationsIndex,range:e,reverse:!0},(t,e,s)=>{n=e.batchId,s.done()}).next(()=>n)}Mr(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return La(t).hi(Ka.userMutationsIndex,e).next(t=>t.map(t=>Da(this.serializer,t)))}us(t,e){const n=Qa.prefixForPath(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return Pa(t).li({range:s},(n,s,r)=>{const[o,a,h]=n,u=ba(a);if(o===this.userId&&e.path.isEqual(u))return La(t).get(h).next(t=>{if(!t)throw Ts();_s(t.userId===this.userId),i.push(Da(this.serializer,t))});r.done()}).next(()=>i)}ds(t,e){let n=new hi(Os);const s=[];return e.forEach(e=>{const i=Qa.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(i),o=Pa(t).li({range:r},(t,s,i)=>{const[r,o,a]=t,h=ba(o);r===this.userId&&e.path.isEqual(h)?n=n.add(a):i.done()});s.push(o)}),Bo.Wn(s).next(()=>this.$r(t,n))}Rs(t,e){const n=e.path,s=n.length+1,i=Qa.prefixForPath(this.userId,n),r=IDBKeyRange.lowerBound(i);let o=new hi(Os);return Pa(t).li({range:r},(t,e,i)=>{const[r,a,h]=t,u=ba(a);r===this.userId&&n.L(u)?u.length===s&&(o=o.add(h)):i.done()}).next(()=>this.$r(t,o))}$r(t,e){const n=[],s=[];return e.forEach(e=>{s.push(La(t).get(e).next(t=>{if(null===t)throw Ts();_s(t.userId===this.userId),n.push(Da(this.serializer,t))}))}),Bo.Wn(s).next(()=>n)}Lr(t,e){return Ca(t.qr,this.userId,e).next(n=>(t.ns(()=>{this.Br(e.batchId)}),Bo.forEach(n,e=>this.br.Ur(t,e))))}Br(t){delete this.vr[t]}Wr(t){return this.Cr(t).next(e=>{if(!e)return Bo.resolve();const n=IDBKeyRange.lowerBound(Qa.prefixForUser(this.userId)),s=[];return Pa(t).li({range:n},(t,e,n)=>{if(t[0]===this.userId){const e=ba(t[1]);s.push(e)}else n.done()}).next(()=>{_s(0===s.length)})})}Kr(t,e){return Oa(t,this.userId,e)}jr(t){return Va(t).get(this.userId).next(t=>t||new Ha(this.userId,-1,""))}}function Oa(t,e,n){const s=Qa.prefixForPath(e,n.path),i=s[1],r=IDBKeyRange.lowerBound(s);let o=!1;return Pa(t).li({range:r,ci:!0},(t,n,s)=>{const[r,a,h]=t;r===e&&a===i&&(o=!0),s.done()}).next(()=>o)}function Ca(t,e,n){const s=t.store(Ka.store),i=t.store(Qa.store),r=[],o=IDBKeyRange.only(n.batchId);let a=0;const h=s.li({range:o},(t,e,n)=>(a++,n.delete()));r.push(h.next(()=>{_s(1===a)}));const u=[];for(const t of n.mutations){const s=Qa.key(e,t.key.path,n.batchId);r.push(i.delete(s)),u.push(t.key)}return Bo.Wn(r).next(()=>u)}function La(t){return mh.Js(t,Ka.store)}function Pa(t){return mh.Js(t,Qa.store)}function Va(t){return mh.Js(t,Ha.store)}class Ua{constructor(t,e){this.serializer=t,this.hs=e}zn(t,e,n){return qa(t).put(Fa(e),n)}Jn(t,e){const n=qa(t),s=Fa(e);return n.delete(s)}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.Qr(t,n)))}Yn(t,e){return qa(t).get(Fa(e)).next(t=>this.Gr(t))}zr(t,e){return qa(t).get(Fa(e)).next(t=>{const e=this.Gr(t);return e?{Hr:e,size:ja(t)}:null})}getEntries(t,e){let n=fi();return this.Jr(t,e,(t,e)=>{const s=this.Gr(e);n=n._t(t,s)}).next(()=>n)}Yr(t,e){let n=fi(),s=new ri(js.D);return this.Jr(t,e,(t,e)=>{const i=this.Gr(e);i?(n=n._t(t,i),s=s._t(t,ja(e))):(n=n._t(t,null),s=s._t(t,0))}).next(()=>({Xr:n,Zr:s}))}Jr(t,e,n){if(e.$())return Bo.resolve();const s=IDBKeyRange.bound(e.first().path.B(),e.last().path.B()),i=e.It();let r=i.yt();return qa(t).li({range:s},(t,e,s)=>{const o=js.tt(t);for(;r&&js.D(r,o)<0;)n(r,null),r=i.yt();r&&r.isEqual(o)&&(n(r,e),r=i.pt()?i.yt():null),r?s.ri(r.path.B()):s.done()}).next(()=>{for(;r;)n(r,null),r=i.pt()?i.yt():null})}ws(t,e,n){let s=pi();const i=e.path.length+1,r={};if(n.isEqual(Vs.min())){const t=e.path.B();r.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.B(),s=_a(n);r.range=IDBKeyRange.lowerBound([t,s],!0),r.index=Ja.collectionReadTimeIndex}return qa(t).li(r,(t,n,r)=>{if(t.length!==i)return;const o=Ia(this.serializer,n);e.path.L(o.key.path)?o instanceof ho&&Io(e,o)&&(s=s._t(o.key,o)):r.done()}).next(()=>s)}to(t,e){let n=li(),s=_a(e);const i=qa(t),r=IDBKeyRange.lowerBound(s,!0);return i.li({index:Ja.readTimeIndex,range:r},(t,e)=>{const i=Ia(this.serializer,e);n=n._t(i.key,i),s=e.readTime}).next(()=>({eo:n,readTime:Na(s)}))}no(t){const e=qa(t);let n=Vs.min();return e.li({index:Ja.readTimeIndex,reverse:!0},(t,e,s)=>{e.readTime&&(n=Na(e.readTime)),s.done()}).next(()=>n)}so(t){return new Ua.io(this,!!t&&t.ro)}oo(t){return this.getMetadata(t).next(t=>t.byteSize)}getMetadata(t){return Ma(t).get(Za.key).next(t=>(_s(!!t),t))}Qr(t,e){return Ma(t).put(Za.key,e)}Gr(t){if(t){const e=Ia(this.serializer,t);return e instanceof uo&&e.version.isEqual(Vs.min())?null:e}return null}}function Ma(t){return mh.Js(t,Za.store)}function qa(t){return mh.Js(t,Ja.store)}function Fa(t){return t.path.B()}function ja(t){let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Ts();e=t.noDocument}return JSON.stringify(e).length}Ua.io=class extends Go{constructor(t,e){super(),this.ho=t,this.ro=e,this.ao=new $o(t=>t.toString(),(t,e)=>t.isEqual(e))}ts(t){const e=[];let n=0,s=new hi((t,e)=>Os(t.U(),e.U()));return this.jn.forEach((i,r)=>{const o=this.ao.get(i);if(r){const a=Ta(this.ho.serializer,r,this.readTime);s=s.add(i.path.O());const h=ja(a);n+=h-o,e.push(this.ho.zn(t,i,a))}else if(n-=o,this.ro){const n=Ta(this.ho.serializer,new uo(i,Vs.min()),this.readTime);e.push(this.ho.zn(t,i,n))}else e.push(this.ho.Jn(t,i))}),s.forEach(n=>{e.push(this.ho.hs.Nr(t,n))}),e.push(this.ho.updateMetadata(t,n)),Bo.Wn(e)}Xn(t,e){return this.ho.zr(t,e).next(t=>null===t?(this.ao.set(e,0),null):(this.ao.set(e,t.size),t.Hr))}Zn(t,e){return this.ho.Yr(t,e).next(({Xr:t,Zr:e})=>(e.forEach((t,e)=>{this.ao.set(t,e)}),t))}};class $a{constructor(){this.uo=new Ba}Nr(t,e){return this.uo.add(e),Bo.resolve()}As(t,e){return Bo.resolve(this.uo.getEntries(e))}}class Ba{constructor(){this.index={}}add(t){const e=t.M(),n=t.O(),s=this.index[e]||new hi(Ms.D),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.M(),n=t.O(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new hi(Ms.D)).B()}}class Ga{constructor(t){this.serializer=t}createOrUpgrade(t,e,n,s){_s(n<s&&n>=0&&s<=10);const i=new na(e);n<1&&s>=1&&(function(t){t.createObjectStore(Wa.store)}(t),function(t){t.createObjectStore(Ha.store,{keyPath:Ha.keyPath}),t.createObjectStore(Ka.store,{keyPath:Ka.keyPath,autoIncrement:!0}).createIndex(Ka.userMutationsIndex,Ka.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Qa.store)}(t),ih(t),function(t){t.createObjectStore(Ja.store)}(t));let r=Bo.resolve();return n<3&&s>=3&&(0!==n&&(function(t){t.deleteObjectStore(eh.store),t.deleteObjectStore(th.store),t.deleteObjectStore(nh.store)}(t),ih(t)),r=r.next(()=>(function(t){const e=i.store(nh.store),n=new nh(0,0,Vs.min().S(),0);return e.put(nh.key,n)})())),n<4&&s>=4&&(0!==n&&(r=r.next(()=>(function(t,e){return e.store(Ka.store).hi().next(n=>{t.deleteObjectStore(Ka.store),t.createObjectStore(Ka.store,{keyPath:Ka.keyPath,autoIncrement:!0}).createIndex(Ka.userMutationsIndex,Ka.userMutationsKeyPath,{unique:!0});const s=e.store(Ka.store),i=n.map(t=>s.put(t));return Bo.Wn(i)})})(t,i))),r=r.next(()=>{!function(t){t.createObjectStore(rh.store,{keyPath:rh.keyPath})}(t)})),n<5&&s>=5&&(r=r.next(()=>this.removeAcknowledgedMutations(i))),n<6&&s>=6&&(r=r.next(()=>((function(t){t.createObjectStore(Za.store)})(t),this.addDocumentGlobal(i)))),n<7&&s>=7&&(r=r.next(()=>this.ensureSequenceNumbers(i))),n<8&&s>=8&&(r=r.next(()=>this.createCollectionParentIndex(t,i))),n<9&&s>=9&&(r=r.next(()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(Ja.store);e.createIndex(Ja.readTimeIndex,Ja.readTimeIndexPath,{unique:!1}),e.createIndex(Ja.collectionReadTimeIndex,Ja.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&s>=10&&(r=r.next(()=>this.rewriteCanonicalIds(i))),r}addDocumentGlobal(t){let e=0;return t.store(Ja.store).li((t,n)=>{e+=ja(n)}).next(()=>{const n=new Za(e);return t.store(Za.store).put(Za.key,n)})}removeAcknowledgedMutations(t){const e=t.store(Ha.store),n=t.store(Ka.store);return e.hi().next(e=>Bo.forEach(e,e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.hi(Ka.userMutationsIndex,s).next(n=>Bo.forEach(n,n=>{_s(n.userId===e.userId);const s=Da(this.serializer,n);return Ca(t,e.userId,s).next(()=>{})}))}))}ensureSequenceNumbers(t){const e=t.store(eh.store),n=t.store(Ja.store);return t.store(nh.store).get(nh.key).next(t=>{const s=[];return n.li((n,i)=>{const r=new Ms(n),o=function(t){return[0,ya(r)]}();s.push(e.get(o).next(n=>n?Bo.resolve():(n=>e.put(new eh(0,ya(n),t.highestListenSequenceNumber)))(r)))}).next(()=>Bo.Wn(s))})}createCollectionParentIndex(t,e){t.createObjectStore(sh.store,{keyPath:sh.keyPath});const n=e.store(sh.store),s=new Ba,i=t=>{if(s.add(t)){const e=t.M(),s=t.O();return n.put({collectionId:e,parent:ya(s)})}};return e.store(Ja.store).li({ci:!0},(t,e)=>{const n=new Ms(t);return i(n.O())}).next(()=>e.store(Qa.store).li({ci:!0},([t,e,n],s)=>{const r=ba(e);return i(r.O())}))}rewriteCanonicalIds(t){const e=t.store(th.store);return e.li((t,n)=>{const s=Sa(n),i=ka(this.serializer,s);return e.put(i)})}}class za{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class Wa{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}Wa.store="owner",Wa.key="owner";class Ha{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}Ha.store="mutationQueues",Ha.keyPath="userId";class Ka{constructor(t,e,n,s,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=s,this.mutations=i}}Ka.store="mutations",Ka.keyPath="batchId",Ka.userMutationsIndex="userMutationsIndex",Ka.userMutationsKeyPath=["userId","batchId"];class Qa{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,ya(e)]}static key(t,e,n){return[t,ya(e),n]}}Qa.store="documentMutations",Qa.PLACEHOLDER=new Qa;class Xa{constructor(t,e){this.path=t,this.readTime=e}}class Ya{constructor(t,e){this.path=t,this.version=e}}class Ja{constructor(t,e,n,s,i,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=r}}Ja.store="remoteDocuments",Ja.readTimeIndex="readTimeIndex",Ja.readTimeIndexPath="readTime",Ja.collectionReadTimeIndex="collectionReadTimeIndex",Ja.collectionReadTimeIndexPath=["parentPath","readTime"];class Za{constructor(t){this.byteSize=t}}Za.store="remoteDocumentGlobal",Za.key="remoteDocumentGlobalKey";class th{constructor(t,e,n,s,i,r,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=r,this.query=o}}th.store="targets",th.keyPath="targetId",th.queryTargetsIndexName="queryTargetsIndex",th.queryTargetsKeyPath=["canonicalId","targetId"];class eh{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}eh.store="targetDocuments",eh.keyPath=["targetId","path"],eh.documentTargetsIndex="documentTargetsIndex",eh.documentTargetsKeyPath=["path","targetId"];class nh{constructor(t,e,n,s){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=s}}nh.key="targetGlobalKey",nh.store="targetGlobal";class sh{constructor(t,e){this.collectionId=t,this.parent=e}}function ih(t){t.createObjectStore(eh.store,{keyPath:eh.keyPath}).createIndex(eh.documentTargetsIndex,eh.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(th.store,{keyPath:th.keyPath}).createIndex(th.queryTargetsIndexName,th.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(nh.store)}sh.store="collectionParents",sh.keyPath=["collectionId","parent"];class rh{constructor(t,e,n,s){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=s}}rh.store="clientMetadata",rh.keyPath="clientId";const oh=[...[...[...[Ha.store,Ka.store,Qa.store,Ja.store,th.store,Wa.store,nh.store,eh.store],rh.store],Za.store],sh.store];class ah{constructor(){this.co=new Ba}Nr(t,e){if(!this.co.has(e)){const n=e.M(),s=e.O();t.ns(()=>{this.co.add(e)});const i={collectionId:n,parent:ya(s)};return hh(t).put(i)}return Bo.resolve()}As(t,e){const n=[],s=IDBKeyRange.bound([e,""],[Ls(e),""],!1,!0);return hh(t).hi(s).next(t=>{for(const s of t){if(s.collectionId!==e)break;n.push(ba(s.parent))}return n})}}function hh(t){return mh.Js(t,sh.store)}class uh{constructor(t){this.lo=t}next(){return this.lo+=2,this.lo}static _o(){return new uh(0)}static fo(){return new uh(-1)}}class ch{constructor(t,e){this.br=t,this.serializer=e}do(t){return this.wo(t).next(e=>{const n=new uh(e.highestTargetId);return e.highestTargetId=n.next(),this.To(t,e).next(()=>e.highestTargetId)})}Eo(t){return this.wo(t).next(t=>Vs.g(new Ps(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}Io(t){return this.wo(t).next(t=>t.highestListenSequenceNumber)}Ao(t,e,n){return this.wo(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.S()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.To(t,s)))}Ro(t,e){return this.mo(t,e).next(()=>this.wo(t).next(n=>(n.targetCount+=1,this.Po(e,n),this.To(t,n))))}Vo(t,e){return this.mo(t,e)}yo(t,e){return this.po(t,e.targetId).next(()=>lh(t).delete(e.targetId)).next(()=>this.wo(t)).next(e=>(_s(e.targetCount>0),e.targetCount-=1,this.To(t,e)))}mr(t,e,n){let s=0;const i=[];return lh(t).li((r,o)=>{const a=Sa(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(s++,i.push(this.yo(t,a)))}).next(()=>Bo.Wn(i)).next(()=>s)}Fe(t,e){return lh(t).li((t,n)=>{const s=Sa(n);e(s)})}wo(t){return fh(t).get(nh.key).next(t=>(_s(null!==t),t))}To(t,e){return fh(t).put(nh.key,e)}mo(t,e){return lh(t).put(ka(this.serializer,e))}Po(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}bo(t){return this.wo(t).next(t=>t.targetCount)}vo(t,e){const n=Qs(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return lh(t).li({range:s,index:th.queryTargetsIndexName},(t,n,s)=>{const r=Sa(n);Xs(e,r.target)&&(i=r,s.done())}).next(()=>i)}So(t,e,n){const s=[],i=dh(t);return e.forEach(e=>{const r=ya(e.path);s.push(i.put(new eh(n,r))),s.push(this.br.Co(t,n,e))}),Bo.Wn(s)}Do(t,e,n){const s=dh(t);return Bo.forEach(e,e=>{const i=ya(e.path);return Bo.Wn([s.delete([n,i]),this.br.No(t,n,e)])})}po(t,e){const n=dh(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}xo(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=dh(t);let i=yi();return s.li({range:n,ci:!0},(t,e,n)=>{const s=ba(t[1]),r=new js(s);i=i.add(r)}).next(()=>i)}Kr(t,e){const n=ya(e.path),s=IDBKeyRange.bound([n],[Ls(n)],!1,!0);let i=0;return dh(t).li({index:eh.documentTargetsIndex,ci:!0,range:s},([t,e],n,s)=>{0!==t&&(i++,s.done())}).next(()=>i>0)}Ge(t,e){return lh(t).get(e).next(t=>t?Sa(t):null)}}function lh(t){return mh.Js(t,th.store)}function fh(t){return mh.Js(t,nh.store)}function dh(t){return mh.Js(t,eh.store)}const ph="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class gh extends Wo{constructor(t,e){super(),this.qr=t,this.ko=e}}class mh{constructor(t,e,n,s,i,r,o,a,h,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Cs=i,this.window=r,this.document=o,this.Oo=h,this.Fo=u,this.Mo=null,this.$o=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Lo=null,this.inForeground=!1,this.qo=null,this.Bo=null,this.Uo=Number.NEGATIVE_INFINITY,this.Wo=(t=>Promise.resolve()),!mh.Qs())throw new xs(As.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.br=new vh(this,s),this.Ko=e+"main",this.serializer=new Ea(a),this.jo=new Jo(this.Ko,10,new Ga(this.serializer)),this.Qo=new ch(this.br,this.serializer),this.hs=new ah,this.rs=new Ua(this.serializer,this.hs),this.window&&this.window.localStorage?this.Go=this.window.localStorage:(this.Go=null,!1===u&&bs("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}static Js(t,e){if(t instanceof gh)return Jo.Js(t.qr,e);throw Ts()}start(){return this.zo().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new xs(As.FAILED_PRECONDITION,ph);return this.Ho(),this.Jo(),this.Yo(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Qo.Io(t))}).then(t=>{this.Mo=new Qo(t,this.Oo)}).then(()=>{this.$o=!0}).catch(t=>(this.jo&&this.jo.close(),Promise.reject(t)))}Xo(t){return this.Wo=(async e=>{if(this.dr)return t(e)}),t(this.isPrimary)}Zo(t){this.jo.Zs(async e=>{null===e.newVersion&&await t()})}th(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Cs.Ri(async()=>{this.dr&&await this.zo()}))}zo(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>wh(t).put(new rh(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.eh(t).next(t=>{t||(this.isPrimary=!1,this.Cs.Fi(()=>this.Wo(!1)))})}).next(()=>this.nh(t)).next(e=>this.isPrimary&&!e?this.sh(t).next(()=>!1):!!e&&this.ih(t).next(()=>!0))).catch(t=>{if(ea(t))return vs("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return vs("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Cs.Fi(()=>this.Wo(t)),this.isPrimary=t})}eh(t){return yh(t).get(Wa.key).next(t=>Bo.resolve(this.rh(t)))}oh(t){return wh(t).delete(this.clientId)}async hh(){if(this.isPrimary&&!this.ah(this.Uo,18e5)){this.Uo=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const e=mh.Js(t,rh.store);return e.hi().next(t=>{const n=this.uh(t,18e5),s=t.filter(t=>-1===n.indexOf(t));return Bo.forEach(s,t=>e.delete(t.clientId)).next(()=>s)})}).catch(()=>[]);if(this.Go)for(const e of t)this.Go.removeItem(this.lh(e.clientId))}}Yo(){this.Bo=this.Cs.Bs("client_metadata_refresh",4e3,()=>this.zo().then(()=>this.hh()).then(()=>this.Yo()))}rh(t){return!!t&&t.ownerId===this.clientId}nh(t){return this.Fo?Bo.resolve(!0):yh(t).get(Wa.key).next(e=>{if(null!==e&&this.ah(e.leaseTimestampMs,5e3)&&!this._h(e.ownerId)){if(this.rh(e)&&this.networkEnabled)return!0;if(!this.rh(e)){if(!e.allowTabSynchronization)throw new xs(As.FAILED_PRECONDITION,ph);return!1}}return!(!this.networkEnabled||!this.inForeground)||wh(t).hi().next(t=>void 0===this.uh(t,5e3).find(t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&vs("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async fh(){this.$o=!1,this.dh(),this.Bo&&(this.Bo.cancel(),this.Bo=null),this.wh(),this.Th(),await this.runTransaction("shutdown","readwrite",t=>this.sh(t).next(()=>this.oh(t))).catch(t=>{vs("IndexedDbPersistence","Proceeding with shutdown despite failure: ",t)}),this.jo.close(),this.Eh()}uh(t,e){return t.filter(t=>this.ah(t.updateTimeMs,e)&&!this._h(t.clientId))}Ih(){return this.runTransaction("getActiveClients","readonly",t=>wh(t).hi().next(t=>this.uh(t,18e5).map(t=>t.clientId)))}get dr(){return this.$o}Ah(t){return Ra.Sr(t,this.serializer,this.hs,this.br)}Rh(){return this.Qo}mh(){return this.rs}Ph(){return this.hs}runTransaction(t,e,n){vs("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite";let i;return this.jo.runTransaction(s,oh,s=>(i=new gh(s,this.Mo?this.Mo.next():Qo.Ss),"readwrite-primary"===e?this.eh(i).next(t=>!!t||this.nh(i)).next(e=>{if(!e)throw bs(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Cs.Fi(()=>this.Wo(!1)),new xs(As.FAILED_PRECONDITION,zo);return n(i)}).next(t=>this.ih(i).next(()=>t)):this.Vh(i).next(()=>n(i)))).then(t=>(i.ss(),t))}Vh(t){return yh(t).get(Wa.key).next(t=>{if(null!==t&&this.ah(t.leaseTimestampMs,5e3)&&!this._h(t.ownerId)&&!this.rh(t)&&!(this.Fo||this.allowTabSynchronization&&t.allowTabSynchronization))throw new xs(As.FAILED_PRECONDITION,ph)})}ih(t){const e=new Wa(this.clientId,this.allowTabSynchronization,Date.now());return yh(t).put(Wa.key,e)}static Qs(){return Jo.Qs()}sh(t){const e=yh(t);return e.get(Wa.key).next(t=>this.rh(t)?(vs("IndexedDbPersistence","Releasing primary lease."),e.delete(Wa.key)):Bo.resolve())}ah(t,e){const n=Date.now();return!(t<n-e||t>n&&(bs(`Detected an update time that is in the future: ${t} > ${n}`),1))}Ho(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qo=(()=>{this.Cs.Ri(()=>(this.inForeground="visible"===this.document.visibilityState,this.zo()))}),this.document.addEventListener("visibilitychange",this.qo),this.inForeground="visible"===this.document.visibilityState)}wh(){this.qo&&(this.document.removeEventListener("visibilitychange",this.qo),this.qo=null)}Jo(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Lo=(()=>{this.dh(),this.Cs.Ri(()=>this.fh())}),this.window.addEventListener("unload",this.Lo))}Th(){this.Lo&&(this.window.removeEventListener("unload",this.Lo),this.Lo=null)}_h(t){var e;try{const n=null!==(null===(e=this.Go)||void 0===e?void 0:e.getItem(this.lh(t)));return vs("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return bs("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}dh(){if(this.Go)try{this.Go.setItem(this.lh(this.clientId),String(Date.now()))}catch(t){bs("Failed to set zombie client id.",t)}}Eh(){if(this.Go)try{this.Go.removeItem(this.lh(this.clientId))}catch(t){}}lh(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function yh(t){return mh.Js(t,Wa.store)}function wh(t){return mh.Js(t,rh.store)}class vh{constructor(t,e){this.db=t,this.ur=new ma(this,e)}Ir(t){const e=this.gh(t);return this.db.Rh().bo(t).next(t=>e.next(e=>t+e))}gh(t){let e=0;return this.Rr(t,t=>{e++}).next(()=>e)}Fe(t,e){return this.db.Rh().Fe(t,e)}Rr(t,e){return this.yh(t,(t,n)=>e(n))}Co(t,e,n){return bh(t,n)}No(t,e,n){return bh(t,n)}mr(t,e,n){return this.db.Rh().mr(t,e,n)}Ur(t,e){return bh(t,e)}ph(t,e){return function(t,e){let n=!1;return Va(t)._i(s=>Oa(t,s,e).next(t=>(t&&(n=!0),Bo.resolve(!t)))).next(()=>n)}(t,e)}Pr(t,e){const n=this.db.mh().so(),s=[];let i=0;return this.yh(t,(r,o)=>{if(o<=e){const e=this.ph(t,r).next(e=>{if(!e)return i++,n.Yn(t,r).next(()=>(n.Jn(r),dh(t).delete([0,ya(r.path)])))});s.push(e)}}).next(()=>Bo.Wn(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){const n=e.ut(t.ko);return this.db.Rh().Vo(t,n)}bh(t,e){return bh(t,e)}yh(t,e){const n=dh(t);let s,i=Qo.Ss;return n.li({index:eh.documentTargetsIndex},([t,n],{path:r,sequenceNumber:o})=>{0===t?(i!==Qo.Ss&&e(new js(ba(s)),i),i=o,s=r):i=Qo.Ss}).next(()=>{i!==Qo.Ss&&e(new js(ba(s)),i)})}gr(t){return this.db.mh().oo(t)}}function bh(t,e){return dh(t).put(function(t,e){return new eh(0,ya(t.path),e)}(e,t.ko))}function Eh(t,e){let n=t.projectId;return t.nt||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}async function Ih(t){if(!Jo.Qs())return Promise.resolve();const e=t+"main";await Jo.delete(e)}class Th{constructor(t,e,n){this.persistence=t,this.vh=e,this.Sh=new ri(Os),this.Ch=new $o(t=>Qs(t),Xs),this.Dh=Vs.min(),this.os=t.Ah(n),this.Nh=t.mh(),this.Qo=t.Rh(),this.xh=new Ho(this.Nh,this.os,this.persistence.Ph()),this.vh.kh(this.xh)}async Oh(t){let e=this.os,n=this.xh;const s=await this.persistence.runTransaction("Handle user change","readonly",s=>{let i;return this.os.Mr(s).next(r=>(i=r,e=this.persistence.Ah(t),n=new Ho(this.Nh,e,this.persistence.Ph()),e.Mr(s))).next(t=>{const e=[],r=[];let o=yi();for(const t of i){e.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n._s(s,o).next(t=>({Fh:t,Mh:e,$h:r}))})});return this.os=e,this.xh=n,this.vh.kh(this.xh),s}Lh(t){const e=Ps.now(),n=t.reduce((t,e)=>t.add(e.key),yi());let s;return this.persistence.runTransaction("Locally write mutations","readwrite",i=>this.xh._s(i,n).next(n=>{s=n;const r=[];for(const e of t){const t=Hr(e,s.get(e.key));null!=t&&r.push(new Yr(e.key,t,oo(t.proto.mapValue),$r.exists(!0)))}return this.os.Dr(i,e,r,t)})).then(t=>{const e=t.Sn(s);return{batchId:t.batchId,jn:e}})}qh(t){return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const n=t.batch.keys(),s=this.Nh.so({ro:!0});return this.Bh(e,t,s).next(()=>s.apply(e)).next(()=>this.os.Wr(e)).next(()=>this.xh._s(e,n))})}Uh(t){return this.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return this.os.xr(e,t).next(t=>(_s(null!==t),n=t.keys(),this.os.Lr(e,t))).next(()=>this.os.Wr(e)).next(()=>this.xh._s(e,n))})}Fr(){return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>this.os.Fr(t))}Eo(){return this.persistence.runTransaction("Get last remote snapshot version","readonly",t=>this.Qo.Eo(t))}Wh(t){const e=t.at;let n=this.Sh;return this.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const i=this.Nh.so({ro:!0});n=this.Sh;const r=[];t.Zt.forEach((t,i)=>{const o=n.get(i);if(!o)return;r.push(this.Qo.Do(s,t.ae,i).next(()=>this.Qo.So(s,t.oe,i)));const a=t.resumeToken;if(a.rt()>0){const h=o.ct(a,e).ut(s.ko);n=n._t(i,h),Th.Kh(o,h,t)&&r.push(this.Qo.Vo(s,h))}});let o=li(),a=yi();if(t.ee.forEach((t,e)=>{a=a.add(t)}),r.push(i.getEntries(s,a).next(n=>{t.ee.forEach((a,h)=>{const u=n.get(a);h instanceof uo&&h.version.isEqual(Vs.min())?(i.Jn(a,e),o=o._t(a,h)):null==u||h.version.p(u.version)>0||0===h.version.p(u.version)&&u.hasPendingWrites?(i.zn(h,e),o=o._t(a,h)):vs("LocalStore","Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",h.version),t.ne.has(a)&&r.push(this.persistence.br.bh(s,a))})})),!e.isEqual(Vs.min())){const t=this.Qo.Eo(s).next(t=>this.Qo.Ao(s,s.ko,e));r.push(t)}return Bo.Wn(r).next(()=>i.apply(s)).next(()=>this.xh.fs(s,o))}).then(t=>(this.Sh=n,t))}static Kh(t,e,n){return _s(e.resumeToken.rt()>0),0===t.resumeToken.rt()||(e.at.v()-t.at.v()>=this.jh||n.oe.size+n.he.size+n.ae.size>0)}async Qh(t){try{await this.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Bo.forEach(t,t=>Bo.forEach(t.Ps,n=>this.persistence.br.Co(e,t.targetId,n)).next(()=>Bo.forEach(t.Vs,n=>this.persistence.br.No(e,t.targetId,n)))))}catch(t){if(!ea(t))throw t;vs("LocalStore","Failed to update sequence numbers: "+t)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=this.Sh.get(t),n=e.at,s=e.lt(n);this.Sh=this.Sh._t(t,s)}}}Gh(t){return this.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),this.os.Or(e,t)))}zh(t){return this.persistence.runTransaction("read document","readonly",e=>this.xh.as(e,t))}Hh(t){return this.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return this.Qo.vo(e,t).next(s=>s?(n=s,Bo.resolve(n)):this.Qo.do(e).next(s=>(n=new Zs(t,s,0,e.ko),this.Qo.Ro(e,n).next(()=>n))))}).then(e=>{const n=this.Sh.get(e.targetId);return(null===n||e.at.p(n.at)>0)&&(this.Sh=this.Sh._t(e.targetId,e),this.Ch.set(t,e.targetId)),e})}vo(t,e){const n=this.Ch.get(e);return void 0!==n?Bo.resolve(this.Sh.get(n)):this.Qo.vo(t,e)}async Jh(t,e){const n=this.Sh.get(t),s=e?"readwrite":"readwrite-primary";try{e||await this.persistence.runTransaction("Release target",s,t=>this.persistence.br.removeTarget(t,n))}catch(e){if(!ea(e))throw e;vs("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}this.Sh=this.Sh.remove(t),this.Ch.delete(n.target)}Yh(t,e){let n=Vs.min(),s=yi();return this.persistence.runTransaction("Execute query","readonly",i=>this.vo(i,wo(t)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,this.Qo.xo(i,t.targetId).next(t=>{s=t})}).next(()=>this.vh.ws(i,t,e?n:Vs.min(),e?s:yi())).next(t=>({documents:t,Xh:s})))}Bh(t,e,n){const s=e.batch,i=s.keys();let r=Bo.resolve();return i.forEach(i=>{r=r.next(()=>n.Yn(t,i)).next(t=>{let r=t;const o=e.Dn.get(i);_s(null!==o),(!r||r.version.p(o)<0)&&((r=s.pn(i,r,e))&&n.zn(r,e.Cn))})}),r.next(()=>this.os.Lr(t,s))}wr(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.Vr(e,this.Sh))}}function _h(t,e){const n=Ns(t),s=Ns(n.Qo),i=n.Sh.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",t=>s.Ge(t,e).next(t=>t?t.target:null))}async function Nh(t){if(t.code!==As.FAILED_PRECONDITION||t.message!==zo)throw t;vs("LocalStore","Unexpectedly lost primary lease")}Th.jh=3e8;class Ah{constructor(t,e,n,s,i,r){this.Cs=t,this.Zh=n,this.ta=s,this.ea=i,this.listener=r,this.state=0,this.na=0,this.sa=null,this.stream=null,this.vi=new Yo(t,e)}ia(){return 1===this.state||2===this.state||4===this.state}ra(){return 2===this.state}start(){3!==this.state?this.auth():this.oa()}async stop(){this.ia()&&await this.close(0)}ha(){this.state=0,this.vi.reset()}aa(){this.ra()&&null===this.sa&&(this.sa=this.Cs.Bs(this.Zh,6e4,()=>this.ua()))}ca(t){this.la(),this.stream.send(t)}async ua(){if(this.ra())return this.close(0)}la(){this.sa&&(this.sa.cancel(),this.sa=null)}async close(t,e){this.la(),this.vi.cancel(),this.na++,3!==t?this.vi.reset():e&&e.code===As.RESOURCE_EXHAUSTED?(bs(e.toString()),bs("Using maximum backoff delay to prevent overloading the backend."),this.vi.$s()):e&&e.code===As.UNAUTHENTICATED&&this.ea.A(),null!==this.stream&&(this._a(),this.stream.close(),this.stream=null),this.state=t,await this.listener.fa(e)}_a(){}auth(){this.state=1;const t=this.da(this.na),e=this.na;this.ea.getToken().then(t=>{this.na===e&&this.wa(t)},e=>{t(()=>{const t=new xs(As.UNKNOWN,"Fetching auth token failed: "+e.message);return this.Ta(t)})})}wa(t){const e=this.da(this.na);this.stream=this.Ea(t),this.stream.Ia(()=>{e(()=>(this.state=2,this.listener.Ia()))}),this.stream.fa(t=>{e(()=>this.Ta(t))}),this.stream.onMessage(t=>{e(()=>this.onMessage(t))})}oa(){this.state=4,this.vi.Ls(async()=>{this.state=0,this.start()})}Ta(t){return vs("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)}da(t){return e=>{this.Cs.Ri(()=>this.na===t?e():(vs("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class xh extends Ah{constructor(t,e,n,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i),this.serializer=s}Ea(t){return this.ta.Aa("Listen",t)}onMessage(t){this.vi.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Ts()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.ze?(_s(void 0===e||"string"==typeof e),Js.fromBase64String(e||"")):(_s(void 0===e||e instanceof Uint8Array),Js.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?As.UNKNOWN:ii(t.code);return new xs(e,t.message||"")}(o);n=new xi(s,i,r,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=lr(t,s.document.name),r=ar(s.document.updateTime),o=new io({mapValue:{fields:s.document.fields}}),a=new ho(i,r,o,{}),h=s.targetIds||[],u=s.removedTargetIds||[];n=new Ni(h,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=lr(t,s.document),r=s.readTime?ar(s.readTime):Vs.min(),o=new uo(i,r),a=s.removedTargetIds||[];n=new Ni([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=lr(t,s.document),r=s.removedTargetIds||[];n=new Ni([],r,i,null)}else{if(!("filter"in e))return Ts();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,i=new ti(s),r=t.targetId;n=new Ai(r,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Vs.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Vs.min():e.readTime?ar(e.readTime):Vs.min()}(t);return this.listener.Ra(e,n)}ma(t){const e={};e.database=pr(this.serializer),e.addTarget=function(t,e){let n;const s=e.target;return(n=Ys(s)?{documents:vr(t,s)}:{query:br(t,s)}).targetId=e.targetId,e.resumeToken.rt()>0&&(n.resumeToken=or(t,e.resumeToken)),n}(this.serializer,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ts()}}(0,e.ht);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.ca(e)}Pa(t){const e={};e.database=pr(this.serializer),e.removeTarget=t,this.ca(e)}}class Dh extends Ah{constructor(t,e,n,s,i){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,i),this.serializer=s,this.Va=!1}get ga(){return this.Va}start(){this.Va=!1,this.lastStreamToken=void 0,super.start()}_a(){this.Va&&this.ya([])}Ea(t){return this.ta.Aa("Write",t)}onMessage(t){if(_s(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Va){this.vi.reset();const e=function(t,e){return t&&t.length>0?(_s(void 0!==e),t.map(t=>(function(t,e){let n=t.updateTime?ar(t.updateTime):ar(e);n.isEqual(Vs.min())&&(n=ar(e));let s=null;return t.transformResults&&t.transformResults.length>0&&(s=t.transformResults),new jr(n,s)})(t,e))):[]}(t.writeResults,t.commitTime),n=ar(t.commitTime);return this.listener.pa(n,e)}return _s(!t.writeResults||0===t.writeResults.length),this.Va=!0,this.listener.ba()}va(){const t={};t.database=pr(this.serializer),this.ca(t)}ya(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>yr(this.serializer,t))};this.ca(e)}}class Sh extends class{}{constructor(t,e){super(),this.credentials=t,this.serializer=e,this.Sa=!1}Ca(){if(this.Sa)throw new xs(As.FAILED_PRECONDITION,"The client has already been terminated.")}start(t){this.ta=t}Da(t,e,n){return this.Ca(),this.credentials.getToken().then(s=>this.ta.Da(t,e,n,s)).catch(t=>{throw t.code===As.UNAUTHENTICATED&&this.credentials.A(),t})}Na(t,e,n){return this.Ca(),this.credentials.getToken().then(s=>this.ta.Na(t,e,n,s)).catch(t=>{throw t.code===As.UNAUTHENTICATED&&this.credentials.A(),t})}async xa(){this.Sa=!1}}function kh(t,e){return new Sh(t,e)}class Rh{constructor(t,e){this.fi=t,this.ka=e,this.state="Unknown",this.Oa=0,this.Fa=null,this.Ma=!0}$a(){0===this.Oa&&(this.La("Unknown"),this.Fa=this.fi.Bs("online_state_timeout",1e4,()=>(this.Fa=null,this.qa("Backend didn't respond within 10 seconds."),this.La("Offline"),Promise.resolve())))}Ba(t){"Online"===this.state?this.La("Unknown"):(this.Oa++,this.Oa>=1&&(this.Ua(),this.qa("Connection failed 1 times. Most recent error: "+t.toString()),this.La("Offline")))}set(t){this.Ua(),this.Oa=0,"Online"===t&&(this.Ma=!1),this.La(t)}La(t){t!==this.state&&(this.state=t,this.ka(t))}qa(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Ma?(bs(e),this.Ma=!1):vs("OnlineStateTracker",e)}Ua(){null!==this.Fa&&(this.Fa.cancel(),this.Fa=null)}}class Oh{constructor(t,e,n,s,i){this.Wa=t,this.Ka=e,this.fi=n,this.ja=[],this.Qa=new Map,this.Ga=null,this.za=new Set,this.Ha=i,this.Ha.Ja(t=>{n.Ri(async()=>{this.Ya()&&(vs("RemoteStore","Restarting streams for network reachability change."),await this.Xa())})}),this.Za=new Rh(n,s),this.tu=function(t,e,n){const s=Ns(t);return s.Ca(),new xh(e,s.ta,s.credentials,s.serializer,n)}(this.Ka,n,{Ia:this.eu.bind(this),fa:this.nu.bind(this),Ra:this.su.bind(this)}),this.iu=function(t,e,n){const s=Ns(t);return s.Ca(),new Dh(e,s.ta,s.credentials,s.serializer,n)}(this.Ka,n,{Ia:this.ru.bind(this),fa:this.ou.bind(this),ba:this.hu.bind(this),pa:this.pa.bind(this)})}start(){return this.enableNetwork()}enableNetwork(){return this.za.delete(0),this.au()}async au(){this.Ya()&&(this.uu()?this.cu():this.Za.set("Unknown"),await this.lu())}async disableNetwork(){this.za.add(0),await this._u(),this.Za.set("Offline")}async _u(){await this.iu.stop(),await this.tu.stop(),this.ja.length>0&&(vs("RemoteStore",`Stopping write stream with ${this.ja.length} pending writes`),this.ja=[]),this.fu()}async fh(){vs("RemoteStore","RemoteStore shutting down."),this.za.add(5),await this._u(),this.Ha.fh(),this.Za.set("Unknown")}listen(t){this.Qa.has(t.targetId)||(this.Qa.set(t.targetId,t),this.uu()?this.cu():this.tu.ra()&&this.du(t))}wu(t){this.Qa.delete(t),this.tu.ra()&&this.Tu(t),0===this.Qa.size&&(this.tu.ra()?this.tu.aa():this.Ya()&&this.Za.set("Unknown"))}Ge(t){return this.Qa.get(t)||null}Qe(t){return this.Eu.Qe(t)}du(t){this.Ga.ge(t.targetId),this.tu.ma(t)}Tu(t){this.Ga.ge(t),this.tu.Pa(t)}cu(){this.Ga=new Si(this),this.tu.start(),this.Za.$a()}uu(){return this.Ya()&&!this.tu.ia()&&this.Qa.size>0}Ya(){return 0===this.za.size}fu(){this.Ga=null}async eu(){this.Qa.forEach((t,e)=>{this.du(t)})}async nu(t){this.fu(),this.uu()?(this.Za.Ba(t),this.cu()):this.Za.set("Unknown")}async su(t,e){if(this.Za.set("Online"),t instanceof xi&&2===t.state&&t.cause)try{await this.Iu(t)}catch(e){vs("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),e),await this.Au(e)}else if(t instanceof Ni?this.Ga.Ne(t):t instanceof Ai?this.Ga.qe(t):this.Ga.Oe(t),!e.isEqual(Vs.min()))try{const n=await this.Wa.Eo();e.p(n)>=0&&await this.Ru(e)}catch(t){vs("RemoteStore","Failed to raise snapshot:",t),await this.Au(t)}}async Au(t,e){if(!ea(t))throw t;this.za.add(1),await this._u(),this.Za.set("Offline"),e||(e=(()=>this.Wa.Eo())),this.fi.Fi(async()=>{vs("RemoteStore","Retrying IndexedDB access"),await e(),this.za.delete(1),await this.au()})}mu(t){return t().catch(e=>this.Au(e,t))}Ru(t){const e=this.Ga.We(t);return e.Zt.forEach((e,n)=>{if(e.resumeToken.rt()>0){const s=this.Qa.get(n);s&&this.Qa.set(n,s.ct(e.resumeToken,t))}}),e.te.forEach(t=>{const e=this.Qa.get(t);if(!e)return;this.Qa.set(t,e.ct(Js.ot,e.at)),this.Tu(t);const n=new Zs(e.target,t,1,e.sequenceNumber);this.du(n)}),this.Eu.Wh(e)}async Iu(t){const e=t.cause;for(const n of t.targetIds)this.Qa.has(n)&&(await this.Eu.Pu(n,e),this.Qa.delete(n),this.Ga.removeTarget(n))}async lu(){let t=this.ja.length>0?this.ja[this.ja.length-1].batchId:-1;for(;this.Vu();)try{const e=await this.Wa.Gh(t);if(null===e){0===this.ja.length&&this.iu.aa();break}t=e.batchId,this.gu(e)}catch(t){await this.Au(t)}this.yu()&&this.pu()}Vu(){return this.Ya()&&this.ja.length<10}bu(){return this.ja.length}gu(t){this.ja.push(t),this.iu.ra()&&this.iu.ga&&this.iu.ya(t.mutations)}yu(){return this.Ya()&&!this.iu.ia()&&this.ja.length>0}pu(){this.iu.start()}async ru(){this.iu.va()}async hu(){for(const t of this.ja)this.iu.ya(t.mutations)}async pa(t,e){const n=this.ja.shift(),s=jo.from(n,t,e);await this.mu(()=>this.Eu.vu(s)),await this.lu()}async ou(t){t&&this.iu.ga&&await this.Su(t),this.yu()&&this.pu()}async Su(t){if(si(e=t.code)&&e!==As.ABORTED){const e=this.ja.shift();this.iu.ha(),await this.mu(()=>this.Eu.Cu(e.batchId,t)),await this.lu()}var e}async Xa(){this.za.add(4),await this._u(),this.Za.set("Unknown"),this.iu.ha(),this.tu.ha(),this.za.delete(4),await this.au()}async Du(t){this.fi.Li(),vs("RemoteStore","RemoteStore received new credentials"),this.za.add(3),await this._u(),this.Za.set("Unknown"),await this.Eu.Du(t),this.za.delete(3),await this.au()}async Nu(t){t?(this.za.delete(2),await this.au()):t||(this.za.add(2),await this._u(),this.Za.set("Unknown"))}}class Ch{constructor(){this.xu=new hi(Lh.ku),this.Ou=new hi(Lh.Fu)}$(){return this.xu.$()}Co(t,e){const n=new Lh(t,e);this.xu=this.xu.add(n),this.Ou=this.Ou.add(n)}Mu(t,e){t.forEach(t=>this.Co(t,e))}No(t,e){this.$u(new Lh(t,e))}Lu(t,e){t.forEach(t=>this.No(t,e))}qu(t){const e=new js(new Ms([])),n=new Lh(e,t),s=new Lh(e,t+1),i=[];return this.Ou.$t([n,s],t=>{this.$u(t),i.push(t.key)}),i}Bu(){this.xu.forEach(t=>this.$u(t))}$u(t){this.xu=this.xu.delete(t),this.Ou=this.Ou.delete(t)}Uu(t){const e=new js(new Ms([])),n=new Lh(e,t),s=new Lh(e,t+1);let i=yi();return this.Ou.$t([n,s],t=>{i=i.add(t.key)}),i}Kr(t){const e=new Lh(t,0),n=this.xu.qt(e);return null!==n&&t.isEqual(n.key)}}class Lh{constructor(t,e){this.key=t,this.Wu=e}static ku(t,e){return js.D(t.key,e.key)||Os(t.Wu,e.Wu)}static Fu(t,e){return Os(t.Wu,e.Wu)||js.D(t.key,e.key)}}function Ph(t,e){return`firestore_clients_${t}_${e}`}function Vh(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.t()&&(s+="_"+e.uid),s}function Uh(t,e){return`firestore_targets_${t}_${e}`}class Mh{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static Ku(t,e,n){const s=JSON.parse(n);let i="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error),r=void 0;return i&&s.error&&((i="string"==typeof s.error.message&&"string"==typeof s.error.code)&&(r=new xs(s.error.code,s.error.message))),i?new Mh(t,e,s.state,r):(bs("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}ju(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class qh{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Ku(t,e){const n=JSON.parse(e);let s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return s&&n.error&&((s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new xs(n.error.code,n.error.message))),s?new qh(t,n.state,i):(bs("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}ju(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Fh{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ku(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=vi();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=Ws(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return s?new Fh(t,i):(bs("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class jh{constructor(t,e){this.clientId=t,this.onlineState=e}static Ku(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new jh(e.clientId,e.onlineState):(bs("SharedClientState","Failed to parse online state: "+t),null)}}class $h{constructor(){this.activeTargetIds=vi()}Qu(t){this.activeTargetIds=this.activeTargetIds.add(t)}Gu(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ju(){const t={activeTargetIds:this.activeTargetIds.B(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Bh{constructor(t,e,n,s,i){this.window=t,this.Cs=e,this.persistenceKey=n,this.zu=s,this.Eu=null,this.ka=null,this.ys=null,this.Hu=this.Ju.bind(this),this.Yu=new ri(Os),this.dr=!1,this.Xu=[];const r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Zu=Ph(this.persistenceKey,this.zu),this.tc=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Yu=this.Yu._t(this.zu,new $h),this.ec=new RegExp(`^firestore_clients_${r}_([^_]*)$`),this.nc=new RegExp(`^firestore_mutations_${r}_(\\d+)(?:_(.*))?$`),this.sc=new RegExp(`^firestore_targets_${r}_(\\d+)$`),this.ic=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.Hu)}static Qs(t){return!(!t||!t.localStorage)}async start(){const t=await this.Eu.Ih();for(const e of t){if(e===this.zu)continue;const t=this.getItem(Ph(this.persistenceKey,e));if(t){const n=Fh.Ku(e,t);n&&(this.Yu=this.Yu._t(n.clientId,n))}}this.rc();const e=this.storage.getItem(this.ic);if(e){const t=this.oc(e);t&&this.hc(t)}for(const t of this.Xu)this.Ju(t);this.Xu=[],this.window.addEventListener("unload",()=>this.fh()),this.dr=!0}vs(t){this.setItem(this.tc,JSON.stringify(t))}ac(){return this.uc(this.Yu)}cc(t){let e=!1;return this.Yu.forEach((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)}),e}lc(t){this._c(t,"pending")}fc(t,e,n){this._c(t,e,n),this.dc(t)}wc(t){let e="not-current";if(this.cc(t)){const n=this.storage.getItem(Uh(this.persistenceKey,t));if(n){const s=qh.Ku(t,n);s&&(e=s.state)}}return this.Tc.Qu(t),this.rc(),e}Ec(t){this.Tc.Gu(t),this.rc()}Ic(t){return this.Tc.activeTargetIds.has(t)}Ac(t){this.removeItem(Uh(this.persistenceKey,t))}Rc(t,e,n){this.mc(t,e,n)}Oh(t,e,n){e.forEach(t=>{this.dc(t)}),this.currentUser=t,n.forEach(t=>{this.lc(t)})}Pc(t){this.Vc(t)}fh(){this.dr&&(this.window.removeEventListener("storage",this.Hu),this.removeItem(this.Zu),this.dr=!1)}getItem(t){const e=this.storage.getItem(t);return vs("SharedClientState","READ",t,e),e}setItem(t,e){vs("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){vs("SharedClientState","REMOVE",t),this.storage.removeItem(t)}Ju(t){const e=t;if(e.storageArea===this.storage){if(vs("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Zu)return void bs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Cs.Fi(async()=>{if(this.dr){if(null!==e.key)if(this.ec.test(e.key)){if(null==e.newValue){const t=this.gc(e.key);return this.yc(t,null)}{const t=this.pc(e.key,e.newValue);if(t)return this.yc(t.clientId,t)}}else if(this.nc.test(e.key)){if(null!==e.newValue){const t=this.bc(e.key,e.newValue);if(t)return this.vc(t)}}else if(this.sc.test(e.key)){if(null!==e.newValue){const t=this.Sc(e.key,e.newValue);if(t)return this.Cc(t)}}else if(e.key===this.ic){if(null!==e.newValue){const t=this.oc(e.newValue);if(t)return this.hc(t)}}else if(e.key===this.tc){const t=function(t){let e=Qo.Ss;if(null!=t)try{const n=JSON.parse(t);_s("number"==typeof n),e=n}catch(t){bs("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==Qo.Ss&&this.ys(t)}}else this.Xu.push(e)})}}get Tc(){return this.Yu.get(this.zu)}rc(){this.setItem(this.Zu,this.Tc.ju())}_c(t,e,n){const s=new Mh(this.currentUser,t,e,n),i=Vh(this.persistenceKey,this.currentUser,t);this.setItem(i,s.ju())}dc(t){const e=Vh(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Vc(t){const e={clientId:this.zu,onlineState:t};this.storage.setItem(this.ic,JSON.stringify(e))}mc(t,e,n){const s=Uh(this.persistenceKey,t),i=new qh(t,e,n);this.setItem(s,i.ju())}gc(t){const e=this.ec.exec(t);return e?e[1]:null}pc(t,e){const n=this.gc(t);return Fh.Ku(n,e)}bc(t,e){const n=this.nc.exec(t),s=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Mh.Ku(new ms(i),s,e)}Sc(t,e){const n=this.sc.exec(t),s=Number(n[1]);return qh.Ku(s,e)}oc(t){return jh.Ku(t)}async vc(t){if(t.user.uid===this.currentUser.uid)return this.Eu.Dc(t.batchId,t.state,t.error);vs("SharedClientState","Ignoring mutation for non-active user "+t.user.uid)}Cc(t){return this.Eu.Nc(t.targetId,t.state,t.error)}yc(t,e){const n=e?this.Yu._t(t,e):this.Yu.remove(t),s=this.uc(this.Yu),i=this.uc(n),r=[],o=[];return i.forEach(t=>{s.has(t)||r.push(t)}),s.forEach(t=>{i.has(t)||o.push(t)}),this.Eu.xc(r,o).then(()=>{this.Yu=n})}hc(t){this.Yu.get(t.clientId)&&this.ka(t.onlineState)}uc(t){let e=vi();return t.forEach((t,n)=>{e=e.Bt(n.activeTargetIds)}),e}}class Gh{constructor(){this.kc=new $h,this.Oc={},this.ka=null,this.ys=null}lc(t){}fc(t,e,n){}wc(t){return this.kc.Qu(t),this.Oc[t]||"not-current"}Rc(t,e,n){this.Oc[t]=e}Ec(t){this.kc.Gu(t)}Ic(t){return this.kc.activeTargetIds.has(t)}Ac(t){delete this.Oc[t]}ac(){return this.kc.activeTargetIds}cc(t){return this.kc.activeTargetIds.has(t)}start(){return this.kc=new $h,Promise.resolve()}Oh(t,e,n){}Pc(t){}fh(){}vs(t){}}class zh{constructor(t){this.key=t}}class Wh{constructor(t){this.key=t}}class Hh{constructor(t,e){this.query=t,this.Fc=e,this.Mc=null,this.re=!1,this.$c=yi(),this.Ht=yi(),this.Lc=To(t),this.qc=new bi(this.Lc)}get Bc(){return this.Fc}Uc(t,e){const n=e?e.Wc:new Ei,s=e?e.qc:this.qc;let i=e?e.Ht:this.Ht,r=s,o=!1;const a=this.query.En()&&s.size===this.query.limit?s.last():null,h=this.query.In()&&s.size===this.query.limit?s.first():null;if(t.Tt((t,e)=>{const u=s.get(t);let c=e instanceof ho?e:null;c&&(c=Io(this.query,c)?c:null);const l=!!u&&this.Ht.has(u.key),f=!!c&&(c.nn||this.Ht.has(c.key)&&c.hasCommittedMutations);let d=!1;u&&c?u.data().isEqual(c.data())?l!==f&&(n.track({type:3,doc:c}),d=!0):this.Kc(u,c)||(n.track({type:2,doc:c}),d=!0,(a&&this.Lc(c,a)>0||h&&this.Lc(c,h)<0)&&(o=!0)):!u&&c?(n.track({type:0,doc:c}),d=!0):u&&!c&&(n.track({type:1,doc:u}),d=!0,(a||h)&&(o=!0)),d&&(c?(r=r.add(c),i=f?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))}),this.query.En()||this.query.In())for(;r.size>this.query.limit;){const t=this.query.En()?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{qc:r,Wc:n,jc:o,Ht:i}}Kc(t,e){return t.nn&&e.hasCommittedMutations&&!e.nn}ts(t,e,n){const s=this.qc;this.qc=t.qc,this.Ht=t.Ht;const i=t.Wc.Gt();i.sort((t,e)=>(function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ts()}};return n(t)-n(e)})(t.type,e.type)||this.Lc(t.doc,e.doc)),this.Qc(n);const r=e?this.Gc():[],o=0===this.$c.size&&this.re?1:0,a=o!==this.Mc;return this.Mc=o,0!==i.length||a?{snapshot:new Ii(this.query,t.qc,s,i,t.Ht,0===o,a,!1),zc:r}:{zc:r}}Hc(t){return this.re&&"Offline"===t?(this.re=!1,this.ts({qc:this.qc,Wc:new Ei,Ht:this.Ht,jc:!1},!1)):{zc:[]}}Jc(t){return!this.Fc.has(t)&&!!this.qc.has(t)&&!this.qc.get(t).nn}Qc(t){t&&(t.oe.forEach(t=>this.Fc=this.Fc.add(t)),t.he.forEach(t=>{}),t.ae.forEach(t=>this.Fc=this.Fc.delete(t)),this.re=t.re)}Gc(){if(!this.re)return[];const t=this.$c;this.$c=yi(),this.qc.forEach(t=>{this.Jc(t.key)&&(this.$c=this.$c.add(t.key))});const e=[];return t.forEach(t=>{this.$c.has(t)||e.push(new Wh(t))}),this.$c.forEach(n=>{t.has(n)||e.push(new zh(n))}),e}Yc(t){this.Fc=t.Xh,this.$c=yi();const e=this.Uc(t.documents);return this.ts(e,!0)}Xc(){return Ii.Xt(this.query,this.qc,this.Ht,0===this.Mc)}}class Kh{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Qh{constructor(t){this.key=t,this.Zc=!1}}class Xh{constructor(t,e,n,s,i,r){this.Wa=t,this.tl=e,this.Ka=n,this.el=s,this.currentUser=i,this.nl=r,this.sl=null,this.il=new $o(t=>bo(t),vo),this.rl=new Map,this.ol=[],this.hl=new ri(js.D),this.al=new Map,this.ul=new Ch,this.cl={},this.ll=new Map,this._l=uh.fo(),this.onlineState="Unknown",this.fl=void 0}get dl(){return!0===this.fl}subscribe(t){this.sl=t}async listen(t){let e,n;this.wl("listen()");const s=this.il.get(t);if(s)e=s.targetId,this.el.wc(e),n=s.view.Xc();else{const s=await this.Wa.Hh(wo(t)),i=this.el.wc(s.targetId);e=s.targetId,n=await this.Tl(t,e,"current"===i),this.dl&&this.tl.listen(s)}return n}async Tl(t,e,n){const s=await this.Wa.Yh(t,!0),i=new Hh(t,s.Xh),r=i.Uc(s.documents),o=_i.ie(e,n&&"Offline"!==this.onlineState),a=i.ts(r,this.dl,o);this.El(e,a.zc);const h=new Kh(t,e,i);return this.il.set(t,h),this.rl.has(e)?this.rl.get(e).push(t):this.rl.set(e,[t]),a.snapshot}async wu(t){this.wl("unlisten()");const e=this.il.get(t),n=this.rl.get(e.targetId);if(n.length>1)return this.rl.set(e.targetId,n.filter(e=>!vo(e,t))),void this.il.delete(t);this.dl?(this.el.Ec(e.targetId),this.el.cc(e.targetId)||await this.Wa.Jh(e.targetId,!1).then(()=>{this.el.Ac(e.targetId),this.tl.wu(e.targetId),this.Il(e.targetId)}).catch(Nh)):(this.Il(e.targetId),await this.Wa.Jh(e.targetId,!0))}async write(t,e){this.wl("write()");try{const n=await this.Wa.Lh(t);this.el.lc(n.batchId),this.Al(n.batchId,e),await this.Rl(n.jn),await this.tl.lu()}catch(t){const n=ca(t,"Failed to persist write");e.reject(n)}}async Wh(t){this.wl("applyRemoteEvent()");try{const e=await this.Wa.Wh(t);t.Zt.forEach((t,e)=>{const n=this.al.get(e);n&&(_s(t.oe.size+t.he.size+t.ae.size<=1),t.oe.size>0?n.Zc=!0:t.he.size>0?_s(n.Zc):t.ae.size>0&&(_s(n.Zc),n.Zc=!1))}),await this.Rl(e,t)}catch(t){await Nh(t)}}Hc(t,e){if(this.dl&&0===e||!this.dl&&1===e){this.wl("applyOnlineStateChange()");const e=[];this.il.forEach((n,s)=>{const i=s.view.Hc(t);i.snapshot&&e.push(i.snapshot)}),this.sl.ml(t),this.sl.Ra(e),this.onlineState=t,this.dl&&this.el.Pc(t)}}async Pu(t,e){this.wl("rejectListens()"),this.el.Rc(t,"rejected",e);const n=this.al.get(t),s=n&&n.key;if(s){let e=new ri(js.D);e=e._t(s,new uo(s,Vs.min()));const n=yi().add(s),i=new Ti(Vs.min(),new Map,new hi(Os),e,n);await this.Wh(i),this.hl=this.hl.remove(s),this.al.delete(t),this.Pl()}else await this.Wa.Jh(t,!1).then(()=>this.Il(t,e)).catch(Nh)}async vu(t){this.wl("applySuccessfulWrite()");const e=t.batch.batchId;try{const n=await this.Wa.qh(t);this.Vl(e,null),this.gl(e),this.el.fc(e,"acknowledged"),await this.Rl(n)}catch(t){await Nh(t)}}async Cu(t,e){this.wl("rejectFailedWrite()");try{const n=await this.Wa.Uh(t);this.Vl(t,e),this.gl(t),this.el.fc(t,"rejected",e),await this.Rl(n)}catch(e){await Nh(e)}}async yl(t){this.tl.Ya()||vs("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await this.Wa.Fr();if(-1===e)return void t.resolve();const n=this.ll.get(e)||[];n.push(t),this.ll.set(e,n)}catch(e){const n=ca(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}gl(t){(this.ll.get(t)||[]).forEach(t=>{t.resolve()}),this.ll.delete(t)}pl(t){this.ll.forEach(e=>{e.forEach(e=>{e.reject(new xs(As.CANCELLED,t))})}),this.ll.clear()}Al(t,e){let n=this.cl[this.currentUser.s()];n||(n=new ri(Os)),n=n._t(t,e),this.cl[this.currentUser.s()]=n}Vl(t,e){let n=this.cl[this.currentUser.s()];if(n){const s=n.get(t);s&&(e?s.reject(e):s.resolve(),n=n.remove(t)),this.cl[this.currentUser.s()]=n}}Il(t,e=null){this.el.Ec(t);for(const n of this.rl.get(t))this.il.delete(n),e&&this.sl.bl(n,e);this.rl.delete(t),this.dl&&this.ul.qu(t).forEach(t=>{this.ul.Kr(t)||this.vl(t)})}vl(t){const e=this.hl.get(t);null!==e&&(this.tl.wu(e),this.hl=this.hl.remove(t),this.al.delete(e),this.Pl())}El(t,e){for(const n of e)n instanceof zh?(this.ul.Co(n.key,t),this.Sl(n)):n instanceof Wh?(vs("SyncEngine","Document no longer in limbo: "+n.key),this.ul.No(n.key,t),this.ul.Kr(n.key)||this.vl(n.key)):Ts()}Sl(t){const e=t.key;this.hl.get(e)||(vs("SyncEngine","New document in limbo: "+e),this.ol.push(e),this.Pl())}Pl(){for(;this.ol.length>0&&this.hl.size<this.nl;){const t=this.ol.shift(),e=this._l.next();this.al.set(e,new Qh(t)),this.hl=this.hl._t(t,e),this.tl.listen(new Zs(wo(go(t.path)),e,2,Qo.Ss))}}Cl(){return this.hl}Dl(){return this.ol}async Rl(t,e){const n=[],s=[],i=[];this.il.forEach((r,o)=>{i.push(Promise.resolve().then(()=>{const e=o.view.Uc(t);return e.jc?this.Wa.Yh(o.query,!1).then(({documents:t})=>o.view.Uc(t,e)):e}).then(t=>{const i=e&&e.Zt.get(o.targetId),r=o.view.ts(t,this.dl,i);if(this.El(o.targetId,r.zc),r.snapshot){this.dl&&this.el.Rc(o.targetId,r.snapshot.fromCache?"not-current":"current"),n.push(r.snapshot);const t=Ko.gs(o.targetId,r.snapshot);s.push(t)}}))}),await Promise.all(i),this.sl.Ra(n),await this.Wa.Qh(s)}wl(t){}async Du(t){if(!this.currentUser.isEqual(t)){vs("SyncEngine","User change. New user:",t.s());const e=await this.Wa.Oh(t);this.currentUser=t,this.pl("'waitForPendingWrites' promise is rejected due to a user change."),this.el.Oh(t,e.Mh,e.$h),await this.Rl(e.Fh)}}Qe(t){const e=this.al.get(t);if(e&&e.Zc)return yi().add(e.key);{let e=yi();const n=this.rl.get(t);if(!n)return e;for(const t of n){const n=this.il.get(t);e=e.Bt(n.view.Bc)}return e}}}async function Yh(t,e){const n=Ns(t),s=await n.Wa.Yh(e.query,!0),i=e.view.Yc(s);return n.dl&&n.El(e.targetId,i.zc),i}async function Jh(t,e,n){const s=Ns(t),i=[],r=[];for(const t of e){let e;const n=s.rl.get(t);if(n&&0!==n.length){e=await s.Wa.Hh(wo(n[0]));for(const t of n){const e=s.il.get(t),n=await Yh(s,e);n.snapshot&&r.push(n.snapshot)}}else{const n=await _h(s.Wa,t);e=await s.Wa.Hh(n),await s.Tl(Zh(n),t,!1)}i.push(e)}return s.sl.Ra(r),i}function Zh(t){return po(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}class tu{constructor(){this.Nl=void 0,this.listeners=[]}}class eu{constructor(t){this.Eu=t,this.xl=new $o(t=>bo(t),vo),this.onlineState="Unknown",this.kl=new Set,this.Eu.subscribe(this)}async listen(t){const e=t.query;let n=!1,s=this.xl.get(e);if(s||(n=!0,s=new tu),n)try{s.Nl=await this.Eu.listen(e)}catch(e){const n=ca(e,`Initialization of query '${Eo(t.query)}' failed`);return void t.onError(n)}this.xl.set(e,s),s.listeners.push(t),t.Hc(this.onlineState),s.Nl&&t.Ol(s.Nl)&&this.Fl()}async wu(t){const e=t.query;let n=!1;const s=this.xl.get(e);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),n=0===s.listeners.length)}if(n)return this.xl.delete(e),this.Eu.wu(e)}Ra(t){let e=!1;for(const n of t){const t=n.query,s=this.xl.get(t);if(s){for(const t of s.listeners)t.Ol(n)&&(e=!0);s.Nl=n}}e&&this.Fl()}bl(t,e){const n=this.xl.get(t);if(n)for(const t of n.listeners)t.onError(e);this.xl.delete(t)}ml(t){this.onlineState=t;let e=!1;this.xl.forEach((n,s)=>{for(const n of s.listeners)n.Hc(t)&&(e=!0)}),e&&this.Fl()}Ml(t){this.kl.add(t),t.next()}$l(t){this.kl.delete(t)}Fl(){this.kl.forEach(t=>{t.next()})}}class nu{constructor(t,e,n){this.query=t,this.Ll=e,this.ql=!1,this.Bl=null,this.onlineState="Unknown",this.options=n||{}}Ol(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Ii(t.query,t.docs,t.zt,e,t.Ht,t.fromCache,t.Jt,!0)}let e=!1;return this.ql?this.Ul(t)&&(this.Ll.next(t),e=!0):this.Wl(t,this.onlineState)&&(this.Kl(t),e=!0),this.Bl=t,e}onError(t){this.Ll.error(t)}Hc(t){this.onlineState=t;let e=!1;return this.Bl&&!this.ql&&this.Wl(this.Bl,t)&&(this.Kl(this.Bl),e=!0),e}Wl(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.jl&&n||t.docs.$()&&"Offline"!==e)}Ul(t){if(t.docChanges.length>0)return!0;const e=this.Bl&&this.Bl.hasPendingWrites!==t.hasPendingWrites;return!(!t.Jt&&!e)&&!0===this.options.includeMetadataChanges}Kl(t){t=Ii.Xt(t.query,t.docs,t.Ht,t.fromCache),this.ql=!0,this.Ll.next(t)}}class su{kh(t){this.Ql=t}ws(t,e,n,s){return e.Tn()||n.isEqual(Vs.min())?this.Gl(t,e):this.Ql._s(t,s).next(i=>{const r=this.zl(e,i);return(e.En()||e.In())&&this.jc(e._n,r,s,n)?this.Gl(t,e):(ws()<=h.DEBUG&&vs("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Eo(e)),this.Ql.ws(t,e,n).next(t=>(r.forEach(e=>{t=t._t(e.key,e)}),t)))})}zl(t,e){let n=new hi(To(t));return e.forEach((e,s)=>{s instanceof ho&&Io(t,s)&&(n=n.add(s))}),n}jc(t,e,n,s){if(n.size!==e.size)return!0;const i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.p(s)>0)}Gl(t,e){return ws()<=h.DEBUG&&vs("IndexFreeQueryEngine","Using full collection scan to execute query:",Eo(e)),this.Ql.ws(t,e,Vs.min())}}class iu{constructor(t,e){this.hs=t,this.br=e,this.os=[],this.Hl=1,this.Jl=new hi(Lh.ku)}Cr(t){return Bo.resolve(0===this.os.length)}Dr(t,e,n,s){const i=this.Hl;this.Hl++,this.os.length>0&&this.os[this.os.length-1];const r=new Fo(i,e,n,s);this.os.push(r);for(const e of s)this.Jl=this.Jl.add(new Lh(e.key,i)),this.hs.Nr(t,e.key.path.O());return Bo.resolve(r)}xr(t,e){return Bo.resolve(this.Yl(e))}Or(t,e){const n=e+1,s=this.Xl(n),i=s<0?0:s;return Bo.resolve(this.os.length>i?this.os[i]:null)}Fr(){return Bo.resolve(0===this.os.length?-1:this.Hl-1)}Mr(t){return Bo.resolve(this.os.slice())}us(t,e){const n=new Lh(e,0),s=new Lh(e,Number.POSITIVE_INFINITY),i=[];return this.Jl.$t([n,s],t=>{const e=this.Yl(t.Wu);i.push(e)}),Bo.resolve(i)}ds(t,e){let n=new hi(Os);return e.forEach(t=>{const e=new Lh(t,0),s=new Lh(t,Number.POSITIVE_INFINITY);this.Jl.$t([e,s],t=>{n=n.add(t.Wu)})}),Bo.resolve(this.Zl(n))}Rs(t,e){const n=e.path,s=n.length+1;let i=n;js.Z(i)||(i=i.child(""));const r=new Lh(new js(i),0);let o=new hi(Os);return this.Jl.Lt(t=>{const e=t.key.path;return!!n.L(e)&&(e.length===s&&(o=o.add(t.Wu)),!0)},r),Bo.resolve(this.Zl(o))}Zl(t){const e=[];return t.forEach(t=>{const n=this.Yl(t);null!==n&&e.push(n)}),e}Lr(t,e){_s(0===this.t_(e.batchId,"removed")),this.os.shift();let n=this.Jl;return Bo.forEach(e.mutations,s=>{const i=new Lh(s.key,e.batchId);return n=n.delete(i),this.br.Ur(t,s.key)}).next(()=>{this.Jl=n})}Br(t){}Kr(t,e){const n=new Lh(e,0),s=this.Jl.qt(n);return Bo.resolve(e.isEqual(s&&s.key))}Wr(t){return this.os.length,Bo.resolve()}t_(t,e){return this.Xl(t)}Xl(t){return 0===this.os.length?0:t-this.os[0].batchId}Yl(t){const e=this.Xl(t);return e<0||e>=this.os.length?null:this.os[e]}}class ru{constructor(t,e){this.hs=t,this.e_=e,this.docs=new ri(js.D),this.size=0}zn(t,e,n){const s=e.key,i=this.docs.get(s),r=i?i.size:0,o=this.e_(e);return this.docs=this.docs._t(s,{Hr:e,size:o,readTime:n}),this.size+=o-r,this.hs.Nr(t,s.path.O())}Jn(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}Yn(t,e){const n=this.docs.get(e);return Bo.resolve(n?n.Hr:null)}getEntries(t,e){let n=fi();return e.forEach(t=>{const e=this.docs.get(t);n=n._t(t,e?e.Hr:null)}),Bo.resolve(n)}ws(t,e,n){let s=pi();const i=new js(e.path.child("")),r=this.docs.At(i);for(;r.pt();){const{key:t,value:{Hr:i,readTime:o}}=r.yt();if(!e.path.L(t.path))break;o.p(n)<=0||i instanceof ho&&Io(e,i)&&(s=s._t(i.key,i))}return Bo.resolve(s)}n_(t,e){return Bo.forEach(this.docs,t=>e(t))}so(t){return new ru.io(this)}oo(t){return Bo.resolve(this.size)}}ru.io=class extends Go{constructor(t){super(),this.ho=t}ts(t){const e=[];return this.jn.forEach((n,s)=>{s?e.push(this.ho.zn(t,s,this.readTime)):this.ho.Jn(n)}),Bo.Wn(e)}Xn(t,e){return this.ho.Yn(t,e)}Zn(t,e){return this.ho.getEntries(t,e)}};class ou{constructor(t){this.persistence=t,this.s_=new $o(t=>Qs(t),Xs),this.lastRemoteSnapshotVersion=Vs.min(),this.highestTargetId=0,this.i_=0,this.r_=new Ch,this.targetCount=0,this.o_=uh._o()}Fe(t,e){return this.s_.forEach((t,n)=>e(n)),Bo.resolve()}Eo(t){return Bo.resolve(this.lastRemoteSnapshotVersion)}Io(t){return Bo.resolve(this.i_)}do(t){return this.highestTargetId=this.o_.next(),Bo.resolve(this.highestTargetId)}Ao(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.i_&&(this.i_=e),Bo.resolve()}mo(t){this.s_.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.o_=new uh(e),this.highestTargetId=e),t.sequenceNumber>this.i_&&(this.i_=t.sequenceNumber)}Ro(t,e){return this.mo(e),this.targetCount+=1,Bo.resolve()}Vo(t,e){return this.mo(e),Bo.resolve()}yo(t,e){return this.s_.delete(e.target),this.r_.qu(e.targetId),this.targetCount-=1,Bo.resolve()}mr(t,e,n){let s=0;const i=[];return this.s_.forEach((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.s_.delete(r),i.push(this.po(t,o.targetId)),s++)}),Bo.Wn(i).next(()=>s)}bo(t){return Bo.resolve(this.targetCount)}vo(t,e){const n=this.s_.get(e)||null;return Bo.resolve(n)}So(t,e,n){return this.r_.Mu(e,n),Bo.resolve()}Do(t,e,n){this.r_.Lu(e,n);const s=this.persistence.br,i=[];return s&&e.forEach(e=>{i.push(s.Ur(t,e))}),Bo.Wn(i)}po(t,e){return this.r_.qu(e),Bo.resolve()}xo(t,e){const n=this.r_.Uu(e);return Bo.resolve(n)}Kr(t,e){return Bo.resolve(this.r_.Kr(e))}}class au{constructor(t){this.h_={},this.Mo=new Qo(0),this.$o=!1,this.$o=!0,this.br=t(this),this.Qo=new ou(this),this.hs=new $a,this.rs=new ru(this.hs,t=>this.br.a_(t))}start(){return Promise.resolve()}fh(){return this.$o=!1,Promise.resolve()}get dr(){return this.$o}Zo(){}th(){}Ph(){return this.hs}Ah(t){let e=this.h_[t.s()];return e||(e=new iu(this.hs,this.br),this.h_[t.s()]=e),e}Rh(){return this.Qo}mh(){return this.rs}runTransaction(t,e,n){vs("MemoryPersistence","Starting transaction:",t);const s=new hu(this.Mo.next());return this.br.u_(),n(s).next(t=>this.br.c_(s).next(()=>t)).Bn().then(t=>(s.ss(),t))}l_(t,e){return Bo.Kn(Object.values(this.h_).map(n=>()=>n.Kr(t,e)))}}class hu extends Wo{constructor(t){super(),this.ko=t}}class uu{constructor(t){this.persistence=t,this.__=new Ch,this.f_=null}static d_(t){return new uu(t)}get w_(){if(this.f_)return this.f_;throw Ts()}Co(t,e,n){return this.__.Co(n,e),this.w_.delete(n),Bo.resolve()}No(t,e,n){return this.__.No(n,e),this.w_.add(n),Bo.resolve()}Ur(t,e){return this.w_.add(e),Bo.resolve()}removeTarget(t,e){this.__.qu(e.targetId).forEach(t=>this.w_.add(t));const n=this.persistence.Rh();return n.xo(t,e.targetId).next(t=>{t.forEach(t=>this.w_.add(t))}).next(()=>n.yo(t,e))}u_(){this.f_=new Set}c_(t){const e=this.persistence.mh().so();return Bo.forEach(this.w_,n=>this.T_(t,n).next(t=>{t||e.Jn(n)})).next(()=>(this.f_=null,e.apply(t)))}bh(t,e){return this.T_(t,e).next(t=>{t?this.w_.delete(e):this.w_.add(e)})}a_(t){return 0}T_(t,e){return Bo.Kn([()=>Bo.resolve(this.__.Kr(e)),()=>this.persistence.Rh().Kr(t,e),()=>this.persistence.l_(t,e)])}}class cu{constructor(t){this.E_=t.E_,this.I_=t.I_}Ia(t){this.A_=t}fa(t){this.R_=t}onMessage(t){this.m_=t}close(){this.I_()}send(t){this.E_(t)}P_(){this.A_()}V_(t){this.R_(t)}g_(t){this.m_(t)}}const lu={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class fu extends class{constructor(t){this.y_=t,this.et=t.et;const e=t.ssl?"https":"http";this.p_=e+"://"+t.host,this.b_="projects/"+this.et.projectId+"/databases/"+this.et.database+"/documents"}Da(t,e,n,s){const i=this.v_(t,e);vs("RestConnection","Sending: ",i,n);const r={};return this.S_(r,s),this.C_(t,i,r,n).then(t=>(vs("RestConnection","Received: ",t),t),e=>{throw Es("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})}Na(t,e,n,s){return this.Da(t,e,n,s)}S_(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.17.1",t["Content-Type"]="text/plain",e)for(const n in e.h)e.h.hasOwnProperty(n)&&(t[n]=e.h[n])}v_(t,e){const n=lu[t];return`${this.p_}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling}C_(t,e,n,s){return new Promise((i,r)=>{const o=new gs;o.listenOnce(ds.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case fs.NO_ERROR:const e=o.getResponseJson();vs("Connection","XHR received:",JSON.stringify(e)),i(e);break;case fs.TIMEOUT:vs("Connection",'RPC "'+t+'" timed out'),r(new xs(As.DEADLINE_EXCEEDED,"Request time out"));break;case fs.HTTP_ERROR:const n=o.getStatus();if(vs("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace("_","-");return Object.values(As).indexOf(e)>=0?e:As.UNKNOWN}(t.status);r(new xs(e,t.message))}else r(new xs(As.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new xs(As.UNAVAILABLE,"Connection failed."));break;default:Ts()}}finally{vs("Connection",'RPC "'+t+'" completed.')}});const a=JSON.stringify(s);o.send(e,"POST",a,n,15)})}Aa(t,e){const n=[this.p_,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=ls(),r={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.et.projectId}/databases/${this.et.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};var o,a;this.S_(r.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(s())||"object"==typeof navigator&&"ReactNative"===navigator.product||s().indexOf("Electron/")>=0||((a=s()).indexOf("MSIE ")>=0||a.indexOf("Trident/")>=0)||s().indexOf("MSAppHost/")>=0||"object"==typeof(o="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==o.id||(r.httpHeadersOverwriteParam="$httpHeaders");const h=n.join("");vs("Connection","Creating WebChannel: "+h,r);const u=i.createWebChannel(h,r);let c=!1,l=!1;const f=new cu({E_:t=>{l?vs("Connection","Not sending because WebChannel is closed:",t):(c||(vs("Connection","Opening WebChannel transport."),u.open(),c=!0),vs("Connection","WebChannel sending:",t),u.send(t))},I_:()=>u.close()}),d=(t,e)=>{u.listen(t,t=>{try{e(t)}catch(t){setTimeout(()=>{throw t},0)}})};return d(ps.EventType.OPEN,()=>{l||vs("Connection","WebChannel transport opened.")}),d(ps.EventType.CLOSE,()=>{l||(l=!0,vs("Connection","WebChannel transport closed"),f.V_())}),d(ps.EventType.ERROR,t=>{l||(l=!0,Es("Connection","WebChannel transport errored:",t),f.V_(new xs(As.UNAVAILABLE,"The operation could not be completed")))}),d(ps.EventType.MESSAGE,t=>{var e;if(!l){const n=t.data[0];_s(!!n);const s=n,i=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(i){vs("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=ei[t];if(void 0!==e)return ii(e)}(t),n=i.message;void 0===e&&(e=As.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),l=!0,f.V_(new xs(e,n)),u.close()}else vs("Connection","WebChannel received:",n),f.g_(n)}}),setTimeout(()=>{f.P_()},0),f}}class du{constructor(){this.D_=(()=>this.N_()),this.x_=(()=>this.k_()),this.O_=[],this.F_()}Ja(t){this.O_.push(t)}fh(){window.removeEventListener("online",this.D_),window.removeEventListener("offline",this.x_)}F_(){window.addEventListener("online",this.D_),window.addEventListener("offline",this.x_)}N_(){vs("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.O_)t(0)}k_(){vs("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.O_)t(1)}static Qs(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}class pu{Ja(t){}fh(){}}function gu(t){return Promise.resolve(new fu(t))}function mu(t){return new er(t,!0)}const yu="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.";class wu{async initialize(t){this.el=this.M_(t),this.persistence=this.L_(t),await this.persistence.start(),this.q_=this.B_(t),this.Wa=this.U_(t)}B_(t){return null}U_(t){return e=this.persistence,n=new su,s=t.W_,new Th(e,n,s);var e,n,s}L_(t){if(t.j_.K_)throw new xs(As.FAILED_PRECONDITION,yu);return new au(uu.d_)}M_(t){return new Gh}async terminate(){this.q_&&this.q_.stop(),await this.el.fh(),await this.persistence.fh()}clearPersistence(t,e){throw new xs(As.FAILED_PRECONDITION,yu)}}class vu extends wu{async initialize(t){await super.initialize(t),await async function(t){const e=Ns(t),n=Ns(e.Nh);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>n.no(t)).then(t=>{e.Dh=t})}(this.Wa)}B_(t){const e=this.persistence.br.ur;return new ga(e,t.fi)}L_(t){const e=Eh(t.y_.et,t.y_.persistenceKey),n=mu(t.y_.et);return new mh(t.j_.synchronizeTabs,e,t.clientId,pa.er(t.j_.cacheSizeBytes),t.fi,aa(),"undefined"!=typeof document?document:null,n,this.el,t.j_.Fo)}M_(t){return new Gh}clearPersistence(t,e){return Ih(Eh(t,e))}}class bu extends vu{constructor(t){super(),this.Q_=t}async initialize(t){await super.initialize(t),await this.Q_.initialize(this,t);const e=this.Q_.Eu;this.el instanceof Bh&&(this.el.Eu={Dc:async function(t,e,n,s){const i=Ns(t);i.wl("applyBatchState()");const r=await function(t,e){const n=Ns(t),s=Ns(n.os);return n.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.kr(t,e).next(e=>e?n.xh._s(t,e):Bo.resolve(null)))}(i.Wa,e);null!==r?("pending"===n?await i.tl.lu():"acknowledged"===n||"rejected"===n?(i.Vl(e,s||null),function(t,e){Ns(Ns(t).os).Br(e)}(i.Wa,e)):Ts(),await i.Rl(r)):vs("SyncEngine","Cannot apply mutation batch with id: "+e)}.bind(null,e),Nc:async function(t,e,n,s){const i=Ns(t);if(i.fl)vs("SyncEngine","Ignoring unexpected query state notification.");else if(i.rl.has(e))switch(n){case"current":case"not-current":{const t=await function(t){const e=Ns(i.Wa),n=Ns(e.Nh);return e.persistence.runTransaction("Get new document changes","readonly",t=>n.to(t,e.Dh)).then(({eo:t,readTime:n})=>(e.Dh=n,t))}(),s=Ti.se(e,"current"===n);await i.Rl(t,s);break}case"rejected":await i.Wa.Jh(e,!0),i.Il(e,s);break;default:Ts()}}.bind(null,e),xc:async function(t,e,n){const s=Ns(t);if(s.fl){for(const t of e){if(s.rl.has(t)){vs("SyncEngine","Adding an already active target "+t);continue}const e=await _h(s.Wa,t),n=await s.Wa.Hh(e);await s.Tl(Zh(e),n.targetId,!1),s.tl.listen(n)}for(const t of n)s.rl.has(t)&&await s.Wa.Jh(t,!1).then(()=>{s.tl.wu(t),s.Il(t)}).catch(Nh)}}.bind(null,e),Ih:function(t){return Ns(Ns(Ns(t).Wa).persistence).Ih()}.bind(null,e)},await this.el.start()),await this.persistence.Xo(async t=>{await async function(t,e){const n=Ns(t);if(!0===e&&!0!==n.fl){const t=n.el.ac(),e=await Jh(n,t.B());n.fl=!0,await n.tl.Nu(!0);for(const t of e)n.tl.listen(t)}else if(!1===e&&!1!==n.fl){const t=[];let e=Promise.resolve();n.rl.forEach((s,i)=>{n.el.Ic(i)?t.push(i):e=e.then(()=>(n.Il(i),n.Wa.Jh(i,!0))),n.tl.wu(i)}),await e,await Jh(n,t),function(t){const e=Ns(n);e.al.forEach((t,n)=>{e.tl.wu(n)}),e.ul.Bu(),e.al=new Map,e.hl=new ri(js.D)}(),n.fl=!1,await n.tl.Nu(!1)}}(this.Q_.Eu,t),this.q_&&(t&&!this.q_.dr?this.q_.start(this.Wa):t||this.q_.stop())})}M_(t){if(t.j_.K_&&t.j_.synchronizeTabs){const e=aa();if(!Bh.Qs(e))throw new xs(As.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Eh(t.y_.et,t.y_.persistenceKey);return new Bh(e,t.fi,n,t.clientId,t.W_)}return new Gh}}class Eu{async initialize(t,e){if(this.Wa)return;this.Wa=t.Wa,this.el=t.el,this.Ka=this.G_(e);const n=await this.z_(e);this.Ka.start(n),this.tl=this.H_(e),this.Eu=this.J_(e),this.Y_=this.X_(e),this.el.ka=(t=>this.Eu.Hc(t,1)),this.tl.Eu=this.Eu,await this.tl.start(),await this.tl.Nu(this.Eu.dl)}z_(t){return gu(t.y_)}X_(t){return new eu(this.Eu)}G_(t){const e=mu(t.y_.et);return kh(t.credentials,e)}H_(t){return new Oh(this.Wa,this.Ka,t.fi,t=>this.Eu.Hc(t,0),du.Qs()?new du:new pu)}J_(t){return function(t,e,n,s,i,r,o){const a=new Xh(t,e,n,s,i,r);return o&&(a.fl=!0),a}(this.Wa,this.tl,this.Ka,this.el,t.W_,t.nl,!t.j_.K_||!t.j_.synchronizeTabs)}terminate(){return this.tl.fh()}}function Iu(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class Tu{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Z_(this.observer.next,t)}error(t){this.observer.error?this.Z_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}tf(){this.muted=!0}Z_(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}function _u(t,e,n){if(e.length!==n)throw new xs(As.INVALID_ARGUMENT,`Function ${t}() requires `+Lu(n,"argument")+", but was called with "+Lu(e.length,"argument")+".")}function Nu(t,e,n){if(e.length<n)throw new xs(As.INVALID_ARGUMENT,`Function ${t}() requires at least `+Lu(n,"argument")+", but was called with "+Lu(e.length,"argument")+".")}function Au(t,e,n,s){!function(t,e,n,s){let i=!1;if(!(i="object"===e?Su(s):"non-empty string"===e?"string"==typeof s&&""!==s:typeof s===e)){const i=ku(s);throw new xs(As.INVALID_ARGUMENT,`Function ${t}() requires its ${n} to be of type ${e}, but it was: ${i}`)}}(t,e,Cu(n)+" argument",s)}function xu(t){if(!js.Z(t))throw new xs(As.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Du(t){if(js.Z(t))throw new xs(As.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Su(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function ku(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Ts()}function Ru(t,e,n,s){const i=ku(s);return new xs(As.INVALID_ARGUMENT,`Function ${t}() requires its ${Cu(n)} argument to be a ${e}, but it was: ${i}`)}function Ou(t,e,n){if(n<=0)throw new xs(As.INVALID_ARGUMENT,`Function ${t}() requires its ${Cu(e)} argument to be a positive number, but it was: ${n}.`)}function Cu(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Lu(t,e){return`${t} ${e}`+(1===t?"":"s")}function Pu(){if("undefined"==typeof Uint8Array)throw new xs(As.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Vu(){if("undefined"==typeof atob)throw new xs(As.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}class Uu{constructor(t){Vu(),this.ef=t}static fromBase64String(t){_u("Blob.fromBase64String",arguments,1),Au("Blob.fromBase64String","string",1,t),Vu();try{return new Uu(Js.fromBase64String(t))}catch(t){throw new xs(As.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}}static fromUint8Array(t){if(_u("Blob.fromUint8Array",arguments,1),Pu(),!(t instanceof Uint8Array))throw Ru("Blob.fromUint8Array","Uint8Array",1,t);return new Uu(Js.fromUint8Array(t))}toBase64(){return _u("Blob.toBase64",arguments,0),Vu(),this.ef.toBase64()}toUint8Array(){return _u("Blob.toUint8Array",arguments,0),Pu(),this.ef.toUint8Array()}toString(){return"Blob(base64: "+this.toBase64()+")"}isEqual(t){return this.ef.isEqual(t.ef)}}class Mu{constructor(t){!function(t,e,n,s){if(!(e instanceof Array)||e.length<1)throw new xs(As.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Lu(1,"element")+".")}(0,t);for(let e=0;e<t.length;++e)if(Au("FieldPath","string",e,t[e]),0===t[e].length)throw new xs(As.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.nf=new Fs(t)}}class qu extends Mu{constructor(...t){super(t)}static documentId(){return new qu(Fs.H().U())}isEqual(t){if(!(t instanceof qu))throw Ru("isEqual","FieldPath",1,t);return this.nf.isEqual(t.nf)}}const Fu=new RegExp("[~\\*/\\[\\]]");class ju{constructor(){this.sf=this}}class $u extends ju{constructor(t){super(),this.if=t}rf(t){if(2!==t.hf)throw 1===t.hf?t.af(this.if+"() can only appear at the top level of your update data"):t.af(this.if+"() cannot be used with set() unless you pass {merge:true}");return t.He.push(t.path),null}isEqual(t){return t instanceof $u}}function Bu(t,e,n){return new tc({hf:3,uf:e.settings.uf,methodName:t.if,cf:n},e.et,e.serializer,e.ignoreUndefinedProperties)}class Gu extends ju{constructor(t){super(),this.if=t}rf(t){return new Fr(t.path,new Rr)}isEqual(t){return t instanceof Gu}}class zu extends ju{constructor(t,e){super(),this.if=t,this.lf=e}rf(t){const e=Bu(this,t,!0),n=this.lf.map(t=>oc(t,e)),s=new Or(n);return new Fr(t.path,s)}isEqual(t){return this===t}}class Wu extends ju{constructor(t,e){super(),this.if=t,this.lf=e}rf(t){const e=Bu(this,t,!0),n=this.lf.map(t=>oc(t,e)),s=new Lr(n);return new Fr(t.path,s)}isEqual(t){return this===t}}class Hu extends ju{constructor(t,e){super(),this.if=t,this._f=e}rf(t){const e=new Vr(t.serializer,ir(t.serializer,this._f));return new Fr(t.path,e)}isEqual(t){return this===t}}class Ku{constructor(t,e){if(_u("GeoPoint",arguments,2),Au("GeoPoint","number",1,t),Au("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new xs(As.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new xs(As.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.ff=t,this.df=e}get latitude(){return this.ff}get longitude(){return this.df}isEqual(t){return this.ff===t.ff&&this.df===t.df}V(t){return Os(this.ff,t.ff)||Os(this.df,t.df)}}const Qu=/^__.*__$/;class Xu{constructor(t,e,n){this.wf=t,this.Tf=e,this.Ef=n}}class Yu{constructor(t,e,n){this.data=t,this.He=e,this.fieldTransforms=n}If(t,e){const n=[];return null!==this.He?n.push(new Yr(t,this.data,this.He,e)):n.push(new Xr(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Zr(t,this.fieldTransforms)),n}}class Ju{constructor(t,e,n){this.data=t,this.He=e,this.fieldTransforms=n}If(t,e){const n=[new Yr(t,this.data,this.He,e)];return this.fieldTransforms.length>0&&n.push(new Zr(t,this.fieldTransforms)),n}}function Zu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ts()}}class tc{constructor(t,e,n,s,i,r){this.settings=t,this.et=e,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.Af(),this.fieldTransforms=i||[],this.He=r||[]}get path(){return this.settings.path}get hf(){return this.settings.hf}Rf(t){return new tc(Object.assign(Object.assign({},this.settings),t),this.et,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.He)}mf(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Rf({path:n,cf:!1});return s.Pf(t),s}Vf(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Rf({path:n,cf:!1});return s.Af(),s}gf(t){return this.Rf({path:void 0,cf:!0})}af(t){return fc(t,this.settings.methodName,this.settings.yf||!1,this.path,this.settings.uf)}contains(t){return void 0!==this.He.find(e=>t.L(e))||void 0!==this.fieldTransforms.find(e=>t.L(e.field))}Af(){if(this.path)for(let t=0;t<this.path.length;t++)this.Pf(this.path.get(t))}Pf(t){if(0===t.length)throw this.af("Document fields must not be empty");if(Zu(this.hf)&&Qu.test(t))throw this.af('Document fields cannot begin and end with "__"')}}class ec{constructor(t,e,n){this.et=t,this.ignoreUndefinedProperties=e,this.serializer=n||mu(t)}pf(t,e,n,s=!1){return new tc({hf:t,methodName:e,uf:n,path:Fs.K(),cf:!1,yf:s},this.et,this.serializer,this.ignoreUndefinedProperties)}}function nc(t,e,n,s,i,r={}){const o=t.pf(r.merge||r.mergeFields?2:0,e,n,i);uc("Data must be an object, but it was:",o,s);const a=ac(s,o);let h,u;if(r.merge)h=new qr(o.He),u=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){let i;if(s instanceof Mu)i=s.nf;else{if("string"!=typeof s)throw Ts();i=lc(e,s,n)}if(!o.contains(i))throw new xs(As.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);dc(t,i)||t.push(i)}h=new qr(t),u=o.fieldTransforms.filter(t=>h.en(t.field))}else h=null,u=o.fieldTransforms;return new Yu(new io(a),h,u)}function sc(t,e,n,s){const i=t.pf(1,e,n);uc("Data must be an object, but it was:",i,s);const r=[],o=new ro;Ci(s,(t,s)=>{const a=lc(e,t,n),h=i.Vf(a);if(s instanceof ju&&s.sf instanceof $u)r.push(a);else{const t=oc(s,h);null!=t&&(r.push(a),o.set(a,t))}});const a=new qr(r);return new Ju(o.sn(),a,i.fieldTransforms)}function ic(t,e,n,s,i,r){const o=t.pf(1,e,n),a=[cc(e,s,n)],h=[i];if(r.length%2!=0)throw new xs(As.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)a.push(cc(e,r[t])),h.push(r[t+1]);const u=[],c=new ro;for(let t=a.length-1;t>=0;--t)if(!dc(u,a[t])){const e=a[t],n=h[t],s=o.Vf(e);if(n instanceof ju&&n.sf instanceof $u)u.push(e);else{const t=oc(n,s);null!=t&&(u.push(e),c.set(e,t))}}const l=new qr(u);return new Ju(c.sn(),l,o.fieldTransforms)}function rc(t,e,n,s=!1){return oc(n,t.pf(s?4:3,e))}function oc(t,e){if(hc(t))return uc("Unsupported field value:",e,t),ac(t,e);if(t instanceof ju)return function(t,e){if(!Zu(e.hf))throw e.af(t.if+"() can only be used with update() and set()");if(!e.path)throw e.af(t.if+"() is not currently supported inside arrays");const n=t.rf(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.He.push(e.path),t instanceof Array){if(e.settings.cf&&4!==e.hf)throw e.af("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=oc(i,e.gf(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ir(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Ps.fromDate(t);return{timestampValue:rr(e.serializer,n)}}if(t instanceof Ps){const n=new Ps(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:rr(e.serializer,n)}}if(t instanceof Ku)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Uu)return{bytesValue:or(e.serializer,t)};if(t instanceof Xu){const n=e.et,s=t.wf;if(!s.isEqual(n))throw e.af(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:hr(t.wf||e.et,t.Tf.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.af("Unsupported field value: "+ku(t))}(t,e)}function ac(t,e){const n={};return Li(t)?e.path&&e.path.length>0&&e.He.push(e.path):Ci(t,(t,s)=>{const i=oc(s,e.mf(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function hc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ps||t instanceof Ku||t instanceof Uu||t instanceof Xu||t instanceof ju)}function uc(t,e,n){if(!hc(n)||!Su(n)){const s=ku(n);throw"an object"===s?e.af(t+" a custom object"):e.af(t+" "+s)}}function cc(t,e,n){if(e instanceof Mu)return e.nf;if("string"==typeof e)return lc(t,e);throw fc("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function lc(t,e,n){try{return function(t){if(t.search(Fu)>=0)throw new xs(As.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`);try{return new qu(...t.split("."))}catch(e){throw new xs(As.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`)}}(e).nf}catch(e){throw fc((s=e)instanceof Error?s.message:s.toString(),t,!1,void 0,n)}var s}function fc(t,e,n,s,i){const r=s&&!s.$(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let h="";return(r||o)&&(h+=" (found",r&&(h+=" in field "+s),o&&(h+=" in document "+i),h+=")"),new xs(As.INVALID_ARGUMENT,a+t+h)}function dc(t,e){return t.some(t=>t.isEqual(e))}class pc{constructor(t){this.Ka=t,this.bf=new Map,this.mutations=[],this.vf=!1,this.Sf=null,this.Cf=new Set}async Df(t){if(this.Nf(),this.mutations.length>0)throw new xs(As.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=Ns(t),s=pr(n.serializer)+"/documents",i={documents:e.map(t=>cr(n.serializer,t))},r=await n.Na("BatchGetDocuments",s,i),o=new Map;r.forEach(t=>{const e=function(t,e){return"found"in e?function(t,e){_s(!!e.found),e.found.name,e.found.updateTime;const n=lr(t,e.found.name),s=ar(e.found.updateTime),i=new io({mapValue:{fields:e.found.fields}});return new ho(n,s,i,{})}(t,e):"missing"in e?function(t,e){_s(!!e.missing),_s(!!e.readTime);const n=lr(t,e.missing),s=ar(e.readTime);return new uo(n,s)}(t,e):Ts()}(n.serializer,t);o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{const e=o.get(t.toString());_s(!!e),a.push(e)}),a}(this.Ka,t);return e.forEach(t=>{t instanceof uo||t instanceof ho?this.xf(t):Ts()}),e}set(t,e){this.write(e.If(t,this.Xe(t))),this.Cf.add(t)}update(t,e){try{this.write(e.If(t,this.kf(t)))}catch(t){this.Sf=t}this.Cf.add(t)}delete(t){this.write([new no(t,this.Xe(t))]),this.Cf.add(t)}async commit(){if(this.Nf(),this.Sf)throw this.Sf;const t=this.bf;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,e)=>{const n=new js(Ms.W(e));this.mutations.push(new so(n,this.Xe(n)))}),await async function(t,e){const n=Ns(t),s=pr(n.serializer)+"/documents",i={writes:e.map(t=>yr(n.serializer,t))};await n.Da("Commit",s,i)}(this.Ka,this.mutations),this.vf=!0}xf(t){let e;if(t instanceof ho)e=t.version;else{if(!(t instanceof uo))throw Ts();e=Vs.min()}const n=this.bf.get(t.key.toString());if(n){if(!e.isEqual(n))throw new xs(As.ABORTED,"Document version changed between two reads.")}else this.bf.set(t.key.toString(),e)}Xe(t){const e=this.bf.get(t.toString());return!this.Cf.has(t)&&e?$r.updateTime(e):$r.Ze()}kf(t){const e=this.bf.get(t.toString());if(!this.Cf.has(t)&&e){if(e.isEqual(Vs.min()))throw new xs(As.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return $r.updateTime(e)}return $r.exists(!0)}write(t){this.Nf(),this.mutations=this.mutations.concat(t)}Nf(){}}class gc{constructor(t,e,n,s){this.fi=t,this.Ka=e,this.updateFunction=n,this.Ti=s,this.Of=5,this.vi=new Yo(this.fi,"transaction_retry")}run(){this.Ff()}Ff(){this.vi.Ls(async()=>{const t=new pc(this.Ka),e=this.Mf(t);e&&e.then(e=>{this.fi.Ri(()=>t.commit().then(()=>{this.Ti.resolve(e)}).catch(t=>{this.$f(t)}))}).catch(t=>{this.$f(t)})})}Mf(t){try{const e=this.updateFunction(t);return!Gs(e)&&e.catch&&e.then?e:(this.Ti.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Ti.reject(t),null}}$f(t){this.Of>0&&this.Lf(t)?(this.Of-=1,this.fi.Ri(()=>(this.Ff(),Promise.resolve()))):this.Ti.reject(t)}Lf(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!si(e)}return!1}}function mc(t,e,n){const s=new Xo;return t.Ri(()=>e.write(n,s)),s.promise}function yc(t,e,n,s){return t.enqueue(()=>(n.th(s),s?e.enableNetwork():e.disableNetwork()))}function wc(t,e,n,s,i){const r=new Tu(i),o=new nu(n,r,s);return t.Ri(()=>e.listen(o)),()=>{r.tf(),t.Ri(()=>e.wu(o))}}function vc(t,e,n,s){const i=new Xo,r=wc(t,e,go(n.path),{includeMetadataChanges:!0,jl:!0},{next:t=>{r();const e=t.docs.has(n);!e&&t.fromCache?i.reject(new xs(As.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&s&&"server"===s.source?i.reject(new xs(As.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(t)},error:t=>i.reject(t)});return i.promise}function bc(t,e,n,s){const i=new Xo,r=wc(t,e,n,{includeMetadataChanges:!0,jl:!0},{next:t=>{r(),t.fromCache&&s&&"server"===s.source?i.reject(new xs(As.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:t=>i.reject(t)});return i.promise}const Ec=new Map;class Ic{constructor(t,e){this.app=t,this.qf="(lite)",this.Bf=!1,this.INTERNAL={delete:()=>this.delete()},this.wf=Ic.Uf(t),this.Wf=new Ss(e)}get Kf(){return this.Bf}get jf(){return void 0!==this.Qf}Gf(t){if(this.Bf)throw new xs(As.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. initializeFirestore() cannot be called after calling getFirestore().");this.zf=t}Hf(){return this.zf||(this.zf={}),this.Bf=!0,this.zf}static Uf(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new xs(As.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Bs(t.options.projectId)}delete(){return this.Qf||(this.Qf=this.Jf()),this.Qf}Jf(){return async function(t){const e=await Ec.get(t);if(e)return vs("ComponentProvider","Removing Datastore"),Ec.delete(t),(await e).xa()}(this)}}class Tc{constructor(t,e,n,s){this.et=t,this.timestampsInSnapshots=e,this.Yf=n,this.Xf=s}Zf(t){switch(Mi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return zi(t.integerValue||t.doubleValue);case 3:return this.td(t.timestampValue);case 4:return this.ed(t);case 5:return t.stringValue;case 6:return new Uu(Wi(t.bytesValue));case 7:return this.nd(t.referenceValue);case 8:return this.sd(t.geoPointValue);case 9:return this.rd(t.arrayValue);case 10:return this.od(t.mapValue);default:throw Ts()}}od(t){const e={};return Ci(t.fields||{},(t,n)=>{e[t]=this.Zf(n)}),e}sd(t){return new Ku(zi(t.latitude),zi(t.longitude))}rd(t){return(t.values||[]).map(t=>this.Zf(t))}ed(t){switch(this.Yf){case"previous":const e=function t(e){const n=e.mapValue.fields.__previous_value__;return Pi(n)?t(n):n}(t);return null==e?null:this.Zf(e);case"estimate":return this.td(Vi(t));default:return null}}td(t){const e=Gi(t),n=new Ps(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()}nd(t){const e=Ms.W(t);_s(Ar(e));const n=new Bs(e.get(1),e.get(3)),s=new js(e.k(5));return n.isEqual(this.et)||bs(`Document ${s} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${this.et.projectId}/${this.et.database}) instead.`),this.Xf(s)}}const _c=pa.ir;class Nc{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}function Ac(t,e,n){if("string"==typeof n){if(""===n)throw new xs(As.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!mo(e)&&-1!==n.indexOf("/"))throw new xs(As.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(Ms.W(n));if(!js.Z(s))throw new xs(As.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Hi(t,new js(s))}if(n instanceof Xu)return Hi(t,n.Tf);throw new xs(As.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+ku(n)+".")}function xc(t,e){if(!Array.isArray(t)||0===t.length)throw new xs(As.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new xs(As.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`);if("in"===e||"array-contains-any"===e){if(t.indexOf(null)>=0)throw new xs(As.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters cannot contain 'null' in the value array.`);if(t.filter(t=>Number.isNaN(t)).length>0)throw new xs(As.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters cannot contain 'NaN' in the value array.`)}}function Dc(t,e,n){if(!n.isEqual(e))throw new xs(As.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function Sc(t){if(t.In()&&0===t.ln.length)throw new xs(As.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function kc(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}const Rc=new Map,Oc=new Map;async function Cc(t,e,n){const s=new Xo;Rc.set(t,s.promise);const i=await t.hd();i.j_=e,vs("ComponentProvider","Initializing OfflineComponentProvider"),await n.initialize(i),t.ad(e=>t.ud.Ri(()=>n.Wa.Oh(e))),n.persistence.Zo(()=>t.delete()),s.resolve(n)}async function Lc(t,e){const n=new Xo;Oc.set(t,n.promise);const s=await t.hd(),i=await Pc(t);vs("ComponentProvider","Initializing OnlineComponentProvider"),await e.initialize(i,s),t.ad(n=>t.ud.Ri(()=>e.tl.Du(n))),n.resolve(e)}function Pc(t){return Uc(t),Rc.has(t)||(vs("ComponentProvider","Using default OfflineComponentProvider"),Cc(t,{K_:!1},new wu)),Rc.get(t)}function Vc(t){return Uc(t),Oc.has(t)||(vs("ComponentProvider","Using default OnlineComponentProvider"),Lc(t,new Eu)),Oc.get(t)}function Uc(t){if(t.jf)throw new xs(As.FAILED_PRECONDITION,"The client has already been terminated.")}function Mc(t){return Vc(t).then(t=>t.Eu)}function qc(t){return Vc(t).then(t=>t.tl)}function Fc(t){return Vc(t).then(t=>t.Y_)}function jc(t){return Pc(t).then(t=>t.persistence)}function $c(t){return Pc(t).then(t=>t.Wa)}class Bc extends Ic{constructor(t,e){super(t,e),this.ud=new ua,this.ld=Rs.P(),this._d=new Xo,this.fd=ms.UNAUTHENTICATED,this.dd=(()=>{}),this.qf=t.name,this.Wf.R(t=>{this.fd=t,this._d.resolve()})}ad(t){vs("Firestore","Registering credential change listener"),this.dd=t,this._d.promise.then(()=>this.dd(this.fd))}async hd(){var t,e;const n=this.Hf();await this._d.promise;const s=new $s(this.wf,this.qf,null!==(t=n.host)&&void 0!==t?t:"firestore.googleapis.com",null===(e=n.ssl)||void 0===e||e,!1);return{fi:this.ud,y_:s,clientId:this.ld,credentials:this.Wf,W_:this.fd,nl:100,j_:{K_:!1}}}Hf(){return super.Hf()}Jf(){return this.ud.Oi(async()=>{await super.Jf(),await async function(t){const e=Oc.get(t);e&&(vs("ComponentProvider","Removing OnlineComponentProvider"),Oc.delete(t),await(await e).terminate());const n=Rc.get(t);n&&(vs("ComponentProvider","Removing OfflineComponentProvider"),Rc.delete(t),await(await n).terminate())}(this),this.Wf.m()})}}function Gc(t){if(t.Kf)throw new xs(As.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class zc extends Mu{constructor(...t){super(t)}isEqual(t){const e=lo(t,zc);return this.nf.isEqual(e.nf)}}class Wc extends Xu{constructor(t,e,n){super(t.wf,new js(n),e),this.firestore=t,this.converter=e,this.wd=n,this.type="document"}get id(){return this.wd.M()}get path(){return this.wd.U()}withConverter(t){return new Wc(this.firestore,t,this.wd)}}class Hc{constructor(t,e,n){this.firestore=t,this.converter=e,this.Td=n,this.type="query"}withConverter(t){return new Hc(this.firestore,t,this.Td)}}class Kc{}class Qc extends Kc{constructor(t,e,n){super(),this.Ed=t,this.Id=e,this.Ad=n,this.type="where"}apply(t){const e=il(t.firestore),n=function(t,e,n,s,i,r,o){let a;if(i.G()){if("array-contains"===r||"array-contains-any"===r)throw new xs(As.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on FieldPath.documentId().`);if("in"===r||"not-in"===r){xc(o,r);const e=[];for(const n of o)e.push(Ac(s,t,n));a={arrayValue:{values:e}}}else a=Ac(s,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||xc(o,r),a=rc(n,e,o,"in"===r||"not-in"===r);const h=_o.create(i,r,a);return function(t,e){if(e.mn()){const n=t.Rn();if(null!==n&&!n.isEqual(e.field))throw new xs(As.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=t.An();null!==s&&Dc(0,e.field,s)}const n=t.Pn(function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==n)throw n===e.op?new xs(As.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new xs(As.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,h),h}(t.Td,"where",e,t.firestore.wf,this.Ed,this.Id,this.Ad);return new Hc(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new fo(t.path,t.collectionGroup,t.ln.slice(),n,t.limit,t._n,t.startAt,t.endAt)}(t.Td,n))}}class Xc extends Kc{constructor(t,e){super(),this.Ed=t,this.Rd=e,this.type="orderBy"}apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new xs(As.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new xs(As.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new Uo(e,n);return function(t,e){if(null===t.An()){const n=t.Rn();null!==n&&Dc(0,n,e.field)}}(t,s),s}(t.Td,this.Ed,this.Rd);return new Hc(t.firestore,t.converter,function(t,e){const n=t.ln.concat([e]);return new fo(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t._n,t.startAt,t.endAt)}(t.Td,e))}}class Yc extends Kc{constructor(t,e,n){super(),this.type=t,this.md=e,this.Pd=n}apply(t){return new Hc(t.firestore,t.converter,function(t,e,n){return new fo(t.path,t.collectionGroup,t.ln.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}(t.Td,this.md,this.Pd))}}class Jc extends Kc{constructor(t,e,n){super(),this.type=t,this.Vd=e,this.gd=n}apply(t){const e=tl(t,this.type,this.Vd,this.gd);return new Hc(t.firestore,t.converter,function(t,e){return new fo(t.path,t.collectionGroup,t.ln.slice(),t.filters.slice(),t.limit,t._n,e,t.endAt)}(t.Td,e))}}class Zc extends Kc{constructor(t,e,n){super(),this.type=t,this.Vd=e,this.gd=n}apply(t){const e=tl(t,this.type,this.Vd,this.gd);return new Hc(t.firestore,t.converter,function(t,e){return new fo(t.path,t.collectionGroup,t.ln.slice(),t.filters.slice(),t.limit,t._n,t.startAt,e)}(t.Td,e))}}function tl(t,e,n,s){if(n[0]instanceof rl)return _u(e,n,1),function(t,e,n,s,i){if(!s)throw new xs(As.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");const r=[];for(const n of yo(t))if(n.field.G())r.push(Hi(e,s.key));else{const t=s.field(n.field);if(Pi(t))throw new xs(As.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.U();throw new xs(As.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}r.push(t)}return new Co(r,i)}(t.Td,t.firestore.wf,e,n[0].yd,s);{const i=il(t.firestore);return function(t,e,n,s,i,r){const o=t.ln;if(i.length>o.length)throw new xs(As.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let r=0;r<i.length;r++){const h=i[r];if(o[r].field.G()){if("string"!=typeof h)throw new xs(As.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof h}`);if(!mo(t)&&-1!==h.indexOf("/"))throw new xs(As.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${s}() must be a plain document ID, but '${h}' contains a slash.`);const n=t.path.child(Ms.W(h));if(!js.Z(n))throw new xs(As.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new js(n);a.push(Hi(e,i))}else{const t=rc(n,s,h);a.push(t)}}return new Co(a,r)}(t.Td,t.firestore.wf,i,e,n,s)}}class el extends Hc{constructor(t,e,n){super(t,n,go(e)),this.firestore=t,this.wd=e,this.type="collection"}get id(){return this.Td.path.M()}get path(){return this.Td.path.U()}withConverter(t){return new el(this.firestore,this.wd,t)}}function nl(t,e){if(1===arguments.length&&(e=Rs.P()),Au("doc","non-empty string",2,e),t instanceof Ic){const n=Ms.W(e);return xu(n),new Wc(t,null,n)}{if(!(t instanceof Wc||t instanceof el))throw new xs(As.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t.wd.child(Ms.W(e));return xu(n),new Wc(t.firestore,t instanceof el?t.converter:null,n)}}function sl(t,e){return t instanceof Hc&&e instanceof Hc&&t.firestore===e.firestore&&vo(t.Td,e.Td)&&t.converter===e.converter}function il(t){const e=t.Hf(),n=mu(t.wf);return new ec(t.wf,!!e.ignoreUndefinedProperties,n)}class rl{constructor(t,e,n,s){this.pd=t,this.Tf=e,this.yd=n,this.Ef=s}get id(){return this.Tf.path.M()}get ref(){return new Wc(this.pd,this.Ef,this.Tf.path)}exists(){return null!==this.yd}data(){if(this.yd){if(this.Ef){const t=new ol(this.pd,this.Tf,this.yd,null);return this.Ef.fromFirestore(t)}return new Tc(this.pd.wf,!0,"none",t=>new Wc(this.pd,null,t.path)).Zf(this.yd.cn())}}get(t){if(this.yd){const e=this.yd.data().field(al("DocumentSnapshot.get",t));if(null!==e)return new Tc(this.pd.wf,!0,"none",t=>new Wc(this.pd,this.Ef,t.path)).Zf(e)}}}class ol extends rl{data(){return super.data()}}function al(t,e){return"string"==typeof e?lc(t,e):lo(e,zc).nf}class hl extends rl{constructor(t,e,n,s,i){super(t,e,n,i),this.pd=t,this.metadata=s,this.bd=lo(t,Bc)}exists(){return super.exists()}data(t){if(this.yd){if(this.Ef){const e=new ul(this.pd,this.Tf,this.yd,this.metadata,null);return this.Ef.fromFirestore(e,t)}return new Tc(this.bd.wf,!0,(null==t?void 0:t.serverTimestamps)||"none",t=>new Wc(this.pd,null,t.path)).Zf(this.yd.cn())}}get(t,e={}){if(this.yd){const n=this.yd.data().field(al("DocumentSnapshot.get",t));if(null!==n)return new Tc(this.bd.wf,!0,e.serverTimestamps||"none",t=>new Wc(this.pd,this.Ef,t.path)).Zf(n)}}}class ul extends hl{data(t={}){return super.data(t)}}class cl{constructor(t,e,n){this.pd=t,this.query=e,this.vd=n,this.metadata=new Nc(n.hasPendingWrites,n.fromCache)}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this.vd.docs.size}get empty(){return 0===this.size}forEach(t,e){this.vd.docs.forEach(n=>{t.call(e,this.Sd(n,this.vd.fromCache,this.vd.Ht.has(n.key)))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this.vd.Yt)throw new xs(As.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Cd&&this.Dd===e||(this.Cd=function(t,e,n){if(t.zt.$()){let e,s=0;return t.docChanges.map(i=>{const r=n(i.doc,t.fromCache,t.Ht.has(i.doc.key));return e=i.doc,{type:"added",doc:r,oldIndex:-1,newIndex:s++}})}{let s=t.zt;return t.docChanges.filter(t=>e||3!==t.type).map(e=>{const i=n(e.doc,t.fromCache,t.Ht.has(e.doc.key));let r=-1,o=-1;return 0!==e.type&&(r=s.indexOf(e.doc.key),s=s.delete(e.doc.key)),1!==e.type&&(o=(s=s.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ts()}}(e.type),doc:i,oldIndex:r,newIndex:o}})}}(this.vd,e,this.Sd.bind(this)),this.Dd=e),this.Cd}Sd(t,e,n){return new ul(this.pd,t.key,t,new Nc(n,e),this.query.converter)}}class ll{constructor(t,e){this.pd=t,this.Nd=e,this.xd=[],this.kd=!1,this.Od=il(t)}set(t,e,n){this.Fd();const s=fl(t,this.pd),i=kc(s.Ef,e,n),r=nc(this.Od,"WriteBatch.set",s.Tf,i,null!==s.Ef,n);return this.xd=this.xd.concat(r.If(s.Tf,$r.Ze())),this}update(t,e,n,...s){this.Fd();const i=fl(t,this.pd);let r;return r="string"==typeof e||e instanceof zc?ic(this.Od,"WriteBatch.update",i.Tf,e,n,s):sc(this.Od,"WriteBatch.update",i.Tf,e),this.xd=this.xd.concat(r.If(i.Tf,$r.exists(!0))),this}delete(t){this.Fd();const e=fl(t,this.pd);return this.xd=this.xd.concat(new no(e.Tf,$r.Ze())),this}commit(){return this.Fd(),this.kd=!0,this.xd.length>0?this.Nd(this.xd):Promise.resolve()}Fd(){if(this.kd)throw new xs(As.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function fl(t,e){if(t.firestore!==e)throw new xs(As.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return lo(t,Wc)}class dl extends class{constructor(t,e){this.pd=t,this.Md=e,this.Od=il(t)}get(t){const e=fl(t,this.pd);return this.Md.Df([e.Tf]).then(t=>{if(!t||1!==t.length)return Ts();const n=t[0];if(n instanceof uo)return new rl(this.pd,e.Tf,null,e.Ef);if(n instanceof ho)return new rl(this.pd,n.key,n,e.Ef);throw Ts()})}set(t,e,n){const s=fl(t,this.pd),i=kc(s.Ef,e,n),r=nc(this.Od,"Transaction.set",s.Tf,i,null!==s.Ef,n);return this.Md.set(s.Tf,r),this}update(t,e,n,...s){const i=fl(t,this.pd);let r;return r="string"==typeof e||e instanceof zc?ic(this.Od,"Transaction.update",i.Tf,e,n,s):sc(this.Od,"Transaction.update",i.Tf,e),this.Md.update(i.Tf,r),this}delete(t){const e=fl(t,this.pd);return this.Md.delete(e.Tf),this}}{constructor(t,e){super(t,e),this.pd=t}get(t){const e=fl(t,this.pd);return super.get(t).then(t=>new hl(this.pd,e.Tf,t.yd,new Nc(!1,!1),e.Ef))}}function pl(t,e,n){const s=n.docs.get(e.Tf);return new hl(t,e.Tf,s,new Nc(n.hasPendingWrites,n.fromCache),e.Ef)}class gl extends ju{}class ml extends gl{constructor(t){super(),this.sf=t,this.if=t.if}rf(t){return this.sf.rf(t)}isEqual(t){return t instanceof ml&&this.sf.isEqual(t.sf)}}e._registerComponent(new c("firestore-exp",t=>((t,e)=>new Bc(t,e))(t.getProvider("app-exp").getImmediate(),t.getProvider("auth-internal")),"PUBLIC")),e.registerVersion("firestore-exp","0.0.800","node"),t.Blob=Uu,t.CollectionReference=el,t.DocumentReference=Wc,t.DocumentSnapshot=hl,t.FieldPath=zc,t.FieldValue=gl,t.FirebaseFirestore=Bc,t.GeoPoint=Ku,t.Query=Hc,t.QueryConstraint=Kc,t.QueryDocumentSnapshot=ul,t.QuerySnapshot=cl,t.SnapshotMetadata=Nc,t.Timestamp=Ps,t.Transaction=dl,t.WriteBatch=ll,t.addDoc=function(t,e){const n=lo(t,el),s=lo(n.firestore,Bc),i=nl(n),r=kc(n.converter,e),o=nc(il(n.firestore),"addDoc",i.Tf,r,null!==n.converter,{});return Mc(s).then(t=>mc(s.ud,t,o.If(i.Tf,$r.exists(!1)))).then(()=>i)},t.arrayRemove=function(...t){return Nu("arrayRemove()",arguments,1),new ml(new Wu("arrayRemove",t))},t.arrayUnion=function(...t){return Nu("arrayUnion()",arguments,1),new ml(new zu("arrayUnion",t))},t.clearIndexedDbPersistence=function(t){const e=lo(t,Bc);if(e.Kf&&!e.jf)throw new xs(As.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const n=new Xo;return e.ud.Di(async()=>{try{await Ih(Eh(e.wf,e.qf)),n.resolve()}catch(t){n.reject(t)}}),n.promise},t.collection=function(t,e){if(Au("collection","non-empty string",2,e),t instanceof Ic){const n=Ms.W(e);return Du(n),new el(t,n,null)}{if(!(t instanceof Wc||t instanceof el))throw new xs(As.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=Ms.W(t.path).child(Ms.W(e));return Du(n),new el(t.firestore,n,null)}},t.collectionGroup=function(t,e){const n=lo(t,Ic);if(Au("collectionGroup","non-empty string",1,e),e.indexOf("/")>=0)throw new xs(As.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Hc(n,null,function(t){return new fo(Ms.K(),t)}(e))},t.deleteDoc=function(t){const e=lo(t,Wc),n=lo(e.firestore,Bc);return Mc(n).then(t=>mc(n.ud,t,[new no(e.Tf,$r.Ze())]))},t.deleteField=function(){return new ml(new $u("deleteField"))},t.disableNetwork=function(t){const e=lo(t,Bc);return Promise.all([qc(e),jc(e)]).then(([t,n])=>yc(e.ud,t,n,!1))},t.doc=nl,t.documentId=function(){return new zc("__name__")},t.enableIndexedDbPersistence=function(t){const e=lo(t,Bc);return Gc(e),Cc(e,{K_:!0,synchronizeTabs:!1,cacheSizeBytes:e.Hf().cacheSizeBytes||pa.or,Fo:!1},new vu)},t.enableMultiTabIndexedDbPersistence=function(t){const e=lo(t,Bc);Gc(e);const n=e.Hf(),s=new Eu,i=new bu(s);return Cc(e,{K_:!0,synchronizeTabs:!0,cacheSizeBytes:n.cacheSizeBytes||pa.or,Fo:!1},i).then(()=>Lc(e,s))},t.enableNetwork=function(t){const e=lo(t,Bc);return Promise.all([qc(e),jc(e)]).then(([t,n])=>yc(e.ud,t,n,!0))},t.endAt=function(...t){return new Zc("endAt",t,!1)},t.endBefore=function(...t){return new Zc("endBefore",t,!0)},t.getDoc=function(t){const e=lo(t,Wc),n=lo(e.firestore,Bc);return Fc(n).then(t=>vc(n.ud,t,e.Tf).then(t=>pl(n,e,t)))},t.getDocFromCache=function(t){const e=lo(t,Wc),n=lo(e.firestore,Bc);return $c(n).then(t=>(async function(t,e,n){const s=new Xo;return await t.enqueue(async()=>{try{const t=await e.zh(n);t instanceof ho?s.resolve(t):t instanceof uo?s.resolve(null):s.reject(new xs(As.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const e=ca(t,`Failed to get document '${n} from cache`);s.reject(e)}}),s.promise})(n.ud,t,e.Tf).then(t=>new hl(n,e.Tf,t,new Nc(t instanceof ho&&t.nn,!0),e.Ef)))},t.getDocFromServer=function(t){const e=lo(t,Wc),n=lo(e.firestore,Bc);return Fc(n).then(t=>vc(n.ud,t,e.Tf,{source:"server"}).then(t=>pl(n,e,t)))},t.getDocs=function(t){const e=lo(t,Hc),n=lo(t.firestore,Bc);return Sc(e.Td),Fc(n).then(t=>bc(n.ud,t,e.Td).then(t=>new cl(n,e,t)))},t.getDocsFromCache=function(t){const e=lo(t,Hc),n=lo(t.firestore,Bc);return $c(n).then(t=>(async function(t,e,n){const s=new Xo;return await t.enqueue(async()=>{try{const t=await e.Yh(n,!0),i=new Hh(n,t.Xh),r=i.Uc(t.documents),o=i.ts(r,!1);s.resolve(o.snapshot)}catch(t){const e=ca(t,`Failed to execute query '${n} against cache`);s.reject(e)}}),s.promise})(n.ud,t,e.Td).then(t=>new cl(n,e,t)))},t.getDocsFromServer=function(t){const e=lo(t,Hc),n=lo(t.firestore,Bc);return Fc(n).then(t=>bc(n.ud,t,e.Td,{source:"server"}).then(t=>new cl(n,e,t)))},t.getFirestore=function(t){return e._getProvider(t,"firestore-exp").getImmediate()},t.increment=function(t){return new ml(new Hu("increment",t))},t.initializeFirestore=function(t,n){const s=e._getProvider(t,"firestore-exp").getImmediate();if(void 0!==n.cacheSizeBytes&&n.cacheSizeBytes!==_c&&n.cacheSizeBytes<pa.rr)throw new xs(As.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+pa.rr);return s.Gf(n),s},t.limit=function(t){return Ou("limit",1,t),new Yc("limit",t,"F")},t.limitToLast=function(t){return Ou("limitToLast",1,t),new Yc("limitToLast",t,"L")},t.onSnapshot=function(t,...e){var n,s,i;let r={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Iu(e[o])||(r=e[o],o++);const a={includeMetadataChanges:r.includeMetadataChanges};if(Iu(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let h;if(t instanceof Wc){const n=lo(t.firestore,Bc),s={next:s=>{e[o]&&e[o](pl(n,t,s))},error:e[o+1],complete:e[o+2]};h=Fc(n).then(e=>wc(n.ud,e,go(t.Tf.path),a,s))}else{const n=lo(t,Hc),s=lo(n.firestore,Bc),i={next:t=>{e[o]&&e[o](new cl(s,n,t))},error:e[o+1],complete:e[o+2]};Sc(n.Td),h=Fc(s).then(t=>wc(s.ud,t,n.Td,a,i))}return()=>{h.then(t=>t())}},t.onSnapshotsInSync=function(t,e){const n=lo(t,Bc),s=Iu(e)?e:{next:e},i=Fc(n).then(t=>(function(t,e,n){const s=new Tu(n);return t.Ri(async()=>e.Ml(s)),()=>{s.tf(),t.Ri(async()=>e.$l(s))}})(n.ud,t,s));return()=>{i.then(t=>t())}},t.orderBy=function(t,e="asc"){const n=e,s=al("orderBy",t);return new Xc(s,n)},t.parent=function(t){if(t instanceof el){const e=t.wd.O();return e.$()?null:new Wc(t.firestore,null,e)}{const e=lo(t,Wc);return new el(e.firestore,e.Tf.path.O(),e.Ef)}},t.query=function(t,...e){let n=lo(t,Hc);for(const t of e)n=t.apply(n);return n},t.queryEqual=sl,t.refEqual=function(t,e){return(t instanceof Wc||t instanceof el)&&(e instanceof Wc||e instanceof el)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter},t.runTransaction=function(t,e){const n=lo(t,Bc);return function(t){var e,n;if(t.jf)throw new xs(As.FAILED_PRECONDITION,"The client has already been terminated.");if(!Ec.has(t)){vs("ComponentProvider","Initializing Datastore");const s=t.Hf(),i=new $s(t.wf,t.qf,null!==(e=s.host)&&void 0!==e?e:"firestore.googleapis.com",null===(n=s.ssl)||void 0===n||n,!1),r=gu(i).then(e=>{const n=mu(i.et),s=kh(t.Wf,n);return s.start(e),s});Ec.set(t,r)}return Ec.get(t)}(n).then(async t=>{const s=new Xo;return new gc(new ua,t,t=>e(new dl(n,t)),s).run(),s.promise})},t.serverTimestamp=function(){return new ml(new Gu("serverTimestamp"))},t.setDoc=function(t,e,n){const s=lo(t,Wc),i=lo(s.firestore,Bc),r=kc(s.Ef,e,n),o=nc(il(i),"setDoc",s.Tf,r,null!==s.Ef,n);return Mc(i).then(t=>mc(i.ud,t,o.If(s.Tf,$r.Ze())))},t.setLogLevel=function(t){ys.setLogLevel(t)},t.snapshotEqual=function(t,e){return t instanceof hl&&e instanceof hl?t.pd===e.pd&&t.Tf.isEqual(e.Tf)&&(null===t.yd?null===e.yd:t.yd.isEqual(e.yd))&&t.Ef===e.Ef:t instanceof cl&&e instanceof cl&&t.pd===e.pd&&sl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.vd.isEqual(e.vd)},t.startAfter=function(...t){return new Jc("startAfter",t,!1)},t.startAt=function(...t){return new Jc("startAt",t,!0)},t.terminate=function(t){return e._removeServiceInstance(t.app,"firestore-exp"),lo(t,Bc).delete()},t.updateDoc=function(t,e,n,...s){const i=lo(t,Wc),r=lo(i.firestore,Bc),o=il(r);let a;return a="string"==typeof e||e instanceof zc?ic(o,"updateDoc",i.Tf,e,n,s):sc(o,"updateDoc",i.Tf,e),Mc(r).then(t=>mc(r.ud,t,a.If(i.Tf,$r.exists(!0))))},t.waitForPendingWrites=function(t){const e=lo(t,Bc);return Mc(e).then(t=>(function(t,e){const n=new Xo;return t.Ri(()=>e.yl(n)),n.promise})(e.ud,t))},t.where=function(t,e,n){const s=e,i=al("where",t);return new Qc(i,s,n)},t.writeBatch=function(t){const e=lo(t,Bc);return new ll(e,t=>Mc(e).then(n=>mc(e.ud,n,t)))},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});