!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.app={}))}(this,function(t){"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,n)},n=function(){return(n=Object.assign||function(t){for(var e,n=1,s=arguments.length;n<s;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function s(t,e,n,s){return new(n=n||Promise)(function(r,i){function o(t){try{u(s.next(t))}catch(t){i(t)}}function a(t){try{u(s.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?r(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}u((s=s.apply(t,e||[])).next())})}function r(t,e){var n,s,r,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]},o={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,s&&(r=2&o[0]?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,s=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(r=0<(r=i.trys).length&&r[r.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){i.label=o[1];break}if(6===o[0]&&i.label<r[1]){i.label=r[1],r=o;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(o);break}r[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],s=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function i(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var o=(a.prototype.wrapCallback=function(t){var e=this;return function(n,s){n?e.reject(n):e.resolve(s),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(n):t(n,s))}},a);function a(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}var u,h,c,l="FirebaseError",f=(u=Error,e(h=p,c=u),h.prototype=null===c?Object.create(c):(d.prototype=c.prototype,new d),p);function d(){this.constructor=h}function p(t,e){var n=u.call(this,e)||this;return n.code=t,n.name=l,Object.setPrototypeOf(n,p.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,g.prototype.create),n}var g=(m.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var s,r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?(s=r,o.replace(y,function(t,e){var n=s[e];return null!=n?String(n):"<"+e+"?>"})):"Error",u=this.serviceName+": "+a+" ("+i+").",h=new f(i,u),c=0,l=Object.keys(r);c<l.length;c++){var d=l[c];"_"!==d.slice(-1)&&(d in h&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),h[d]=r[d])}return h},m);function m(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var y=/\{\$([^}]+)}/g,w=(v.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},v.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},v.prototype.setServiceProps=function(t){return this.serviceProps=t,this},v);function v(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var b="[DEFAULT]",E=(I.prototype.get=function(t){void 0===t&&(t=b);var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new o;this.instancesDeferred.set(e,n);try{var s=this.getOrInitializeService(e);s&&n.resolve(s)}catch(t){}}return this.instancesDeferred.get(e).promise},I.prototype.getImmediate=function(t){var e=n({identifier:b,optional:!1},t),s=e.identifier,r=e.optional,i=this.normalizeInstanceIdentifier(s);try{var o=this.getOrInitializeService(i);if(o)return o;if(r)return null;throw Error("Service "+this.name+" is not available")}catch(t){if(r)return null;throw t}},I.prototype.getComponent=function(){return this.component},I.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if("EAGER"===(this.component=t).instantiationMode)try{this.getOrInitializeService(b)}catch(t){}try{for(var s=i(this.instancesDeferred.entries()),r=s.next();!r.done;r=s.next()){var o=function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var s,r,i=n.call(t),o=[];try{for(;(void 0===e||0<e--)&&!(s=i.next()).done;)o.push(s.value)}catch(t){r={error:t}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return o}(r.value,2),a=o[0],u=o[1],h=this.normalizeInstanceIdentifier(a);try{var c=this.getOrInitializeService(h);u.resolve(c)}catch(t){}}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}},I.prototype.clearInstance=function(t){void 0===t&&(t=b),this.instancesDeferred.delete(t),this.instances.delete(t)},I.prototype.delete=function(){return s(this,void 0,void 0,function(){var t;return r(this,function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(t.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))];case 1:return e.sent(),[2]}})})},I.prototype.isComponentSet=function(){return null!=this.component},I.prototype.getOrInitializeService=function(t){var e,n=this.instances.get(t);return!n&&this.component&&(n=this.component.instanceFactory(this.container,(e=t)===b?void 0:e),this.instances.set(t,n)),n||null},I.prototype.normalizeInstanceIdentifier=function(t){return!this.component||this.component.multipleInstances?t:b},I);function I(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}var T,_=(N.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},N.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},N.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new E(t,this);return this.providers.set(t,e),e},N.prototype.getProviders=function(){return Array.from(this.providers.values())},N);function N(t){this.name=t,this.providers=new Map}function A(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var s=Array(t),r=0;for(e=0;e<n;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,r++)s[r]=i[o];return s}var S,D=[];function x(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(!(e<t.logLevel)){var r=(new Date).toISOString(),i=R[e];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[i].apply(console,A(["["+r+"]  "+t.name+":"],n))}}(S=t.LogLevel||(t.LogLevel={}))[S.DEBUG=0]="DEBUG",S[S.VERBOSE=1]="VERBOSE",S[S.INFO=2]="INFO",S[S.WARN=3]="WARN",S[S.ERROR=4]="ERROR",S[S.SILENT=5]="SILENT";var O={debug:t.LogLevel.DEBUG,verbose:t.LogLevel.VERBOSE,info:t.LogLevel.INFO,warn:t.LogLevel.WARN,error:t.LogLevel.ERROR,silent:t.LogLevel.SILENT},L=t.LogLevel.INFO,R=((T={})[t.LogLevel.DEBUG]="log",T[t.LogLevel.VERBOSE]="log",T[t.LogLevel.INFO]="info",T[t.LogLevel.WARN]="warn",T[t.LogLevel.ERROR]="error",T),k=(Object.defineProperty(C.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in t.LogLevel))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),C.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?O[t]:t},Object.defineProperty(C.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(C.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),C.prototype.debug=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,A([this,t.LogLevel.DEBUG],e)),this._logHandler.apply(this,A([this,t.LogLevel.DEBUG],e))},C.prototype.log=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,A([this,t.LogLevel.VERBOSE],e)),this._logHandler.apply(this,A([this,t.LogLevel.VERBOSE],e))},C.prototype.info=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,A([this,t.LogLevel.INFO],e)),this._logHandler.apply(this,A([this,t.LogLevel.INFO],e))},C.prototype.warn=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,A([this,t.LogLevel.WARN],e)),this._logHandler.apply(this,A([this,t.LogLevel.WARN],e))},C.prototype.error=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,A([this,t.LogLevel.ERROR],e)),this._logHandler.apply(this,A([this,t.LogLevel.ERROR],e))},C);function C(t){this.name=t,this._logLevel=L,this._logHandler=x,this._userLogHandler=null,D.push(this)}var P=(V.prototype.getPlatformInfoString=function(){return this.container.getProviders().map(function(t){if("VERSION"!==(null==(e=t.getComponent())?void 0:e.type))return null;var e,n=t.getImmediate();return n.library+"/"+n.version}).filter(function(t){return t}).join(" ")},V);function V(t){this.container=t}var U,M,F="@firebase/app",q=new k("@firebase/app"),j="[DEFAULT]",$=((U={})[F]="fire-core",U["@firebase/analytics"]="fire-analytics",U["@firebase/auth"]="fire-auth",U["@firebase/database"]="fire-rtdb",U["@firebase/functions"]="fire-fn",U["@firebase/installations"]="fire-iid",U["@firebase/messaging"]="fire-fcm",U["@firebase/performance"]="fire-perf",U["@firebase/remote-config"]="fire-rc",U["@firebase/storage"]="fire-gcs",U["@firebase/firestore"]="fire-fst",U["fire-js"]="fire-js",U.firebase="fire-js-all",U),B=new Map,G=new Map;function z(t,e){try{t.container.addComponent(e)}catch(n){q.debug("Component "+e.name+" failed to register with FirebaseApp "+t.name,n)}}function H(t){var e,n,s=t.name;if(G.has(s))return q.debug("There were multiple attempts to register component "+s+"."),!1;G.set(s,t);try{for(var r=i(B.values()),o=r.next();!o.done;o=r.next())z(o.value,t)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return!0}function W(t,e){return t.container.getProvider(e)}var K=((M={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",M["bad-app-name"]="Illegal App name: '{$appName}",M["duplicate-app"]="Firebase App named '{$appName}' already exists",M["app-deleted"]="Firebase App named '{$appName}' already deleted",M["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",M["invalid-log-argument"]="First argument to `onLog` must be null or a function.",M),Q=new g("app","Firebase",K),X=(Object.defineProperty(Y.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"name",{get:function(){return this.checkDestroyed(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(Y.prototype,"options",{get:function(){return this.checkDestroyed(),this.options_},enumerable:!1,configurable:!0}),Y.prototype.checkDestroyed=function(){if(this.isDeleted)throw Q.create("app-deleted",{appName:this.name_})},Y);function Y(t,e,s){var r=this;this.isDeleted=!1,this.options_=n({},t),this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled,this.container=s,this.container.addComponent(new w("app-exp",function(){return r},"PUBLIC"))}function J(t,e,n){var s,r=null!==(s=$[t])&&void 0!==s?s:t;n&&(r+="-"+n);var i=r.match(/\s|\//),o=e.match(/\s|\//);if(i||o){var a=['Unable to register library "'+r+'" with version "'+e+'":'];return i&&a.push('library name "'+r+'" contains illegal characters (whitespace or "/")'),i&&o&&a.push("and"),o&&a.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void q.warn(a.join(" "))}H(new w(r+"-version",function(){return{library:r,version:e}},"VERSION"))}H(new w("platform-logger",function(t){return new P(t)},"PRIVATE")),J(F,"0.0.800-exp.f1299756c",void 0),J("fire-js",""),J("firebase","0.800.4","app"),t.SDK_VERSION="7.17.1",t._addComponent=z,t._addOrOverwriteComponent=function(t,e){t.container.addOrOverwriteComponent(e)},t._apps=B,t._clearComponents=function(){G.clear()},t._components=G,t._getProvider=W,t._registerComponent=H,t._removeServiceInstance=function(t,e,n){void 0===n&&(n=j),W(t,e).clearInstance(n)},t.deleteApp=function(t){return s(this,void 0,void 0,function(){var e;return r(this,function(n){switch(n.label){case 0:return e=t.name,B.has(e)?(B.delete(e),[4,Promise.all(t.container.getProviders().map(function(t){return t.delete()}))]):[3,2];case 1:n.sent(),t.isDeleted=!0,n.label=2;case 2:return[2]}})})},t.getApp=function(t){void 0===t&&(t=j);var e=B.get(t);if(!e)throw Q.create("no-app",{appName:t});return e},t.getApps=function(){return Array.from(B.values())},t.initializeApp=function(t,e){var s,r;void 0===e&&(e={}),"object"!=typeof e&&(e={name:e});var o=n({name:j,automaticDataCollectionEnabled:!1},e),a=o.name;if("string"!=typeof a||!a)throw Q.create("bad-app-name",{appName:String(a)});if(B.has(a))throw Q.create("duplicate-app",{appName:a});var u=new _(a);try{for(var h=i(G.values()),c=h.next();!c.done;c=h.next()){var l=c.value;u.addComponent(l)}}catch(t){s={error:t}}finally{try{c&&!c.done&&(r=h.return)&&r.call(h)}finally{if(s)throw s.error}}var f=new X(t,o,u);return B.set(a,f),f},t.onLog=function(e,n){if(null!==e&&"function"!=typeof e)throw Q.create("invalid-log-argument",{appName:name});!function(e,n){for(var s=0,r=D;s<r.length;s++)!function(s){var r=null;n&&n.level&&(r=O[n.level]),s.userLogHandler=null===e?null:function(n,s){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var a=i.map(function(t){if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}}).filter(function(t){return t}).join(" ");s>=(null!=r?r:n.logLevel)&&e({level:t.LogLevel[s].toLowerCase(),message:a,args:i,type:n.name})}}(r[s])}(e,n)},t.registerVersion=J,t.setLogLevel=function(t){var e;e=t,D.forEach(function(t){t.setLogLevel(e)})},Object.defineProperty(t,"__esModule",{value:!0})}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.functions=t.firebase.functions||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}function r(t,e,n,s){return new(n||(n=Promise))(function(r,i){function o(t){try{u(s.next(t))}catch(t){i(t)}}function a(t){try{u(s.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}u((s=s.apply(t,e||[])).next())})}function i(t,e){var n,s,r,i,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,s&&(r=2&i[0]?s.return:i[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,i[1])).done)return r;switch(s=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,s=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){o.label=i[1];break}if(6===i[0]&&o.label<r[1]){o.label=r[1],r=i;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(i);break}r[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],s=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var o="FirebaseError",a=function(t){function e(n,s){var r=t.call(this,s)||this;return r.code=n,r.name=o,Object.setPrototypeOf(r,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(r,u.prototype.create),r}return s(e,t),e}(Error),u=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var s=e[0]||{},r=this.service+"/"+t,i=this.errors[t],o=i?function(t,e){return t.replace(h,function(t,n){var s=e[n];return null!=s?String(s):"<"+n+"?>"})}(i,s):"Error",u=this.serviceName+": "+o+" ("+r+").",c=new a(r,u),l=0,f=Object.keys(s);l<f.length;l++){var d=f[l];"_"!==d.slice(-1)&&(d in c&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),c[d]=s[d])}return c},t}();var h=/\{\$([^}]+)}/g,c=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),l="type.googleapis.com/google.protobuf.Int64Value",f="type.googleapis.com/google.protobuf.UInt64Value";function d(t,e){var n={};for(var s in t)t.hasOwnProperty(s)&&(n[s]=e(t[s]));return n}function p(t){if(null==t)return t;if(t["@type"])switch(t["@type"]){case l:case f:var e=Number(t.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+t);return e;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return p(t)}):"function"==typeof t||"object"==typeof t?d(t,function(t){return p(t)}):t}var g="functions",m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},y=function(t){function e(e,n,s){var r=t.call(this,g+"/"+e,n||"")||this;return r.details=s,r}return s(e,t),e}(a);var w=function(){function t(t,e){var n=this;this.auth=null,this.messaging=null,this.auth=t.getImmediate({optional:!0}),this.messaging=e.getImmediate({optional:!0}),this.auth||t.get().then(function(t){return n.auth=t},function(){}),this.messaging||e.get().then(function(t){return n.messaging=t},function(){})}return t.prototype.getAuthToken=function(){return r(this,void 0,void 0,function(){var t;return i(this,function(e){switch(e.label){case 0:if(!this.auth)return[2,void 0];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.auth.getToken()];case 2:return[2,null==(t=e.sent())?void 0:t.accessToken];case 3:return e.sent(),[2,void 0];case 4:return[2]}})})},t.prototype.getMessagingToken=function(){return r(this,void 0,void 0,function(){return i(this,function(t){if(!(this.messaging&&"Notification"in self&&"granted"===Notification.permission))return[2,void 0];try{return[2,this.messaging.getToken()]}catch(t){return[2,void 0]}return[2]})})},t.prototype.getContext=function(){return r(this,void 0,void 0,function(){var t,e;return i(this,function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return t=n.sent(),[4,this.getMessagingToken()];case 2:return e=n.sent(),[2,{authToken:t,messagingToken:e}]}})})},t}(),v="us-central1";var b=function(){function t(t,e,n,s){var r=this;void 0===s&&(s=v),this.app=t,this.region=s,this.emulatorOrigin=null,this.contextProvider=new w(e,n),this.cancelAllRequests=new Promise(function(t){r.deleteService=function(){return t()}})}return t.prototype.delete=function(){return this.deleteService()},t.prototype._url=function(t){var e=this.app.options.projectId,n=this.region;return null!==this.emulatorOrigin?this.emulatorOrigin+"/"+e+"/"+n+"/"+t:"https://"+n+"-"+e+".cloudfunctions.net/"+t},t}();function E(t,e,n){return function(s){return function(t,e,n,s){return r(this,void 0,void 0,function(){var o,a,u,h,c,l,f,g;return i(this,function(w){switch(w.label){case 0:return o=t._url(e),n=function t(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(Array.isArray(e))return e.map(function(e){return t(e)});if("function"==typeof e||"object"==typeof e)return d(e,function(e){return t(e)});throw new Error("Data cannot be encoded in JSON: "+e)}(n),a={data:n},u=new Headers,[4,t.contextProvider.getContext()];case 1:return(h=w.sent()).authToken&&u.append("Authorization","Bearer "+h.authToken),h.messagingToken&&u.append("Firebase-Instance-ID-Token",h.messagingToken),c=s.timeout||7e4,[4,Promise.race([function(t,e,n){return r(this,void 0,void 0,function(){var s,r;return i(this,function(i){switch(i.label){case 0:n.append("Content-Type","application/json"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,fetch(t,{method:"POST",body:JSON.stringify(e),headers:n})];case 2:return s=i.sent(),[3,4];case 3:return i.sent(),[2,{status:0,json:null}];case 4:r=null,i.label=5;case 5:return i.trys.push([5,7,,8]),[4,s.json()];case 6:return r=i.sent(),[3,8];case 7:return i.sent(),[3,8];case 8:return[2,{status:s.status,json:r}]}})})}(o,a,u),(v=c,new Promise(function(t,e){setTimeout(function(){e(new y("deadline-exceeded","deadline-exceeded"))},v)})),t.cancelAllRequests])];case 2:if(!(l=w.sent()))throw new y("cancelled","Firebase Functions instance was deleted.");if(f=function(t,e){var n=function(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),s=n,r=void 0;try{var i=e&&e.error;if(i){var o=i.status;if("string"==typeof o){if(!m[o])return new y("internal","internal");n=m[o],s=o}var a=i.message;"string"==typeof a&&(s=a),void 0!==(r=i.details)&&(r=p(r))}}catch(t){}return"ok"===n?null:new y(n,s,r)}(l.status,l.json))throw f;if(!l.json)throw new y("internal","Response is not valid JSON object.");if(void 0===(g=l.json.data)&&(g=l.json.result),void 0===g)throw new y("internal","Response is missing data field.");return[2,{data:p(g)}]}var v})})}(t,e,s,n||{})}}var I=function(t,e){var n=t.getProvider("app-exp").getImmediate(),s=t.getProvider("auth-internal"),r=t.getProvider("messaging");return new b(n,s,r,e)};var T;T={Functions:b},e._registerComponent(new c(g,I,"PUBLIC").setServiceProps(T).setMultipleInstances(!0)),e.registerVersion("@firebase/functions-exp","0.0.800"),t.getFunctions=function(t,n){return void 0===n&&(n=v),e._getProvider(t,g).getImmediate({identifier:n})},t.httpsCallable=function(t,e,n){return E(t,e,n)},t.useFunctionsEmulator=function(t,e){!function(t,e){t.emulatorOrigin=e}(t,e)},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-functions.js - be sure to load firebase-app.js first.")}}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.firestore=t.firebase.firestore||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var r="FirebaseError",i=function(t){function e(n,s){var i=t.call(this,s)||this;return i.code=n,i.name=r,Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,o.prototype.create),i}return function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}(e,t),e}(Error),o=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var s=e[0]||{},r=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(h,function(t,n){var s=e[n];return null!=s?String(s):"<"+n+"?>"})}(o,s):"Error",u=this.serviceName+": "+a+" ("+r+").",c=new i(r,u),l=0,f=Object.keys(s);l<f.length;l++){var d=f[l];"_"!==d.slice(-1)&&(d in c&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),c[d]=s[d])}return c},t}();var a,u,h=/\{\$([^}]+)}/g,c=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}();function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var s=Array(t),r=0;for(e=0;e<n;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,r++)s[r]=i[o];return s}!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(u||(u={}));var f={debug:u.DEBUG,verbose:u.VERBOSE,info:u.INFO,warn:u.WARN,error:u.ERROR,silent:u.SILENT},d=u.INFO,p=((a={})[u.DEBUG]="log",a[u.VERBOSE]="log",a[u.INFO]="info",a[u.WARN]="warn",a[u.ERROR]="error",a),g=function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(!(e<t.logLevel)){var r=(new Date).toISOString(),i=p[e];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[i].apply(console,l(["["+r+"]  "+t.name+":"],n))}},m=function(){function t(t){this.name=t,this._logLevel=d,this._logHandler=g,this._userLogHandler=null}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in u))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?f[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,u.DEBUG],t)),this._logHandler.apply(this,l([this,u.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,u.VERBOSE],t)),this._logHandler.apply(this,l([this,u.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,u.INFO],t)),this._logHandler.apply(this,l([this,u.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,u.WARN],t)),this._logHandler.apply(this,l([this,u.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,u.ERROR],t)),this._logHandler.apply(this,l([this,u.ERROR],t))},t}(),y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function w(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var v,b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},E=E||{},I=b||self;function T(){}function _(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function N(t){var e=_(t);return"array"==e||"object"==e&&"number"==typeof t.length}function A(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var S="closure_uid_"+(1e9*Math.random()>>>0),D=0;function x(t,e,n){return t.call.apply(t.bind,arguments)}function O(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function L(t,e,n){return(L=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?x:O).apply(null,arguments)}function R(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var k=Date.now;function C(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,t.prototype.constructor=t}function P(){this.j=this.j,this.i=this.i}P.prototype.j=!1,P.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(t){Object.prototype.hasOwnProperty.call(t,S)&&t[S]||(t[S]=++D)})(this)},P.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var V=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},U=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var s=t.length,r="string"==typeof t?t.split(""):t,i=0;i<s;i++)i in r&&e.call(n,r[i],i,t)};function M(t){return Array.prototype.concat.apply([],arguments)}function F(t){var e=t.length;if(0<e){for(var n=Array(e),s=0;s<e;s++)n[s]=t[s];return n}return[]}function q(t){return/^[\s\xa0]*$/.test(t)}var j,$=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function B(t,e){return-1!=t.indexOf(e)}function G(t,e){return t<e?-1:t>e?1:0}t:{var z=I.navigator;if(z){var H=z.userAgent;if(H){j=H;break t}}j=""}function W(t,e,n){for(var s in t)e.call(n,t[s],s,t)}function K(t){var e={};for(var n in t)e[n]=t[n];return e}var Q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function X(t,e){for(var n,s,r=1;r<arguments.length;r++){for(n in s=arguments[r])t[n]=s[n];for(var i=0;i<Q.length;i++)n=Q[i],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function Y(t){return Y[" "](t),t}Y[" "]=T;var J,Z,tt=B(j,"Opera"),et=B(j,"Trident")||B(j,"MSIE"),nt=B(j,"Edge"),st=nt||et,rt=B(j,"Gecko")&&!(B(j.toLowerCase(),"webkit")&&!B(j,"Edge"))&&!(B(j,"Trident")||B(j,"MSIE"))&&!B(j,"Edge"),it=B(j.toLowerCase(),"webkit")&&!B(j,"Edge");function ot(){var t=I.document;return t?t.documentMode:void 0}t:{var at="",ut=(Z=j,rt?/rv:([^\);]+)(\)|;)/.exec(Z):nt?/Edge\/([\d\.]+)/.exec(Z):et?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Z):it?/WebKit\/(\S+)/.exec(Z):tt?/(?:Version)[ \/]?(\S+)/.exec(Z):void 0);if(ut&&(at=ut?ut[1]:""),et){var ht=ot();if(null!=ht&&ht>parseFloat(at)){J=String(ht);break t}}J=at}var ct,lt={};function ft(t){return function(t,e){var n=lt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=$(String(J)).split("."),s=$(String(t)).split("."),r=Math.max(n.length,s.length),i=0;0==e&&i<r;i++){var o=n[i]||"",a=s[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;e=G(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||G(0==o[2].length,0==a[2].length)||G(o[2],a[2]),o=o[3],a=a[3]}while(0==e)}return 0<=e})}if(I.document&&et){var dt=ot();ct=dt||(parseInt(J,10)||void 0)}else ct=void 0;var pt=ct,gt=!et||9<=Number(pt),mt=et&&!ft("9"),yt=function(){if(!I.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{I.addEventListener("test",T,e),I.removeEventListener("test",T,e)}catch(t){}return t}();function wt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function vt(t,e){if(wt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(rt){t:{try{Y(e.nodeName);var r=!0;break t}catch(t){}r=!1}r||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:bt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}wt.prototype.b=function(){this.defaultPrevented=!0},C(vt,wt);var bt={2:"touch",3:"pen",4:"mouse"};vt.prototype.b=function(){vt.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,mt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var Et="closure_listenable_"+(1e6*Math.random()|0),It=0;function Tt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function _t(t){this.src=t,this.a={},this.b=0}function Nt(t,e){var n=e.type;if(n in t.a){var s,r=t.a[n],i=V(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Tt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function At(t,e,n,s){for(var r=0;r<t.length;++r){var i=t[r];if(!i.Y&&i.listener==e&&i.capture==!!n&&i.ca==s)return r}return-1}_t.prototype.add=function(t,e,n,s,r){var i=t.toString();(t=this.a[i])||(t=this.a[i]=[],this.b++);var o=At(t,e,s,r);return-1<o?(e=t[o],n||(e.Z=!1)):((e=new function(t,e,n,s,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.ca=r,this.key=++It,this.Y=this.Z=!1}(e,this.src,i,!!s,r)).Z=n,t.push(e)),e};var St="closure_lm_"+(1e6*Math.random()|0),Dt={};function xt(t,e,n,s,r){if(s&&s.once)return function t(e,n,s,r,i){if(Array.isArray(n)){for(var o=0;o<n.length;o++)t(e,n[o],s,r,i);return null}s=Ut(s);return e&&e[Et]?e.wa(n,s,A(r)?!!r.capture:!!r,i):Ot(e,n,s,!0,r,i)}(t,e,n,s,r);if(Array.isArray(e)){for(var i=0;i<e.length;i++)xt(t,e[i],n,s,r);return null}return n=Ut(n),t&&t[Et]?t.va(e,n,A(s)?!!s.capture:!!s,r):Ot(t,e,n,!1,s,r)}function Ot(t,e,n,s,r,i){if(!e)throw Error("Invalid event type");var o=A(r)?!!r.capture:!!r;if(o&&!gt)return null;var a=Pt(t);if(a||(t[St]=a=new _t(t)),(n=a.add(e,n,s,o,i)).proxy)return n;if(s=function(){var t=Ct,e=gt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)yt||(r=o),void 0===r&&(r=!1),t.addEventListener(e.toString(),s,r);else if(t.attachEvent)t.attachEvent(Rt(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function Lt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[Et])Nt(e.c,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(Rt(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=Pt(e))?(Nt(n,t),0==n.b&&(n.src=null,e[St]=null)):Tt(t)}}}function Rt(t){return t in Dt?Dt[t]:Dt[t]="on"+t}function kt(t,e){var n=t.listener,s=t.ca||t.src;return t.Z&&Lt(t),n.call(s,e)}function Ct(t,e){if(t.Y)return!0;if(!gt){if(!e)t:{e=["window","event"];for(var n=I,s=0;s<e.length;s++)if(null==(n=n[e[s]])){e=null;break t}e=n}return kt(t,e=new vt(e,this))}return kt(t,new vt(e,this))}function Pt(t){return(t=t[St])instanceof _t?t:null}var Vt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ut(t){return"function"==_(t)?t:(t[Vt]||(t[Vt]=function(e){return t.handleEvent(e)}),t[Vt])}function Mt(){P.call(this),this.c=new _t(this),this.J=this,this.C=null}function Ft(t,e,n,s){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var r=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.Y&&o.capture==n){var a=o.listener,u=o.ca||o.src;o.Z&&Nt(t.c,o),r=!1!==a.call(u,s)&&r}}return r&&!s.defaultPrevented}C(Mt,P),Mt.prototype[Et]=!0,(v=Mt.prototype).addEventListener=function(t,e,n,s){xt(this,t,e,n,s)},v.removeEventListener=function(t,e,n,s){!function t(e,n,s,r,i){if(Array.isArray(n))for(var o=0;o<n.length;o++)t(e,n[o],s,r,i);else r=A(r)?!!r.capture:!!r,s=Ut(s),e&&e[Et]?(e=e.c,(n=String(n).toString())in e.a&&-1<(s=At(o=e.a[n],s,r,i))&&(Tt(o[s]),Array.prototype.splice.call(o,s,1),0==o.length&&(delete e.a[n],e.b--))):e&&(e=Pt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=At(n,s,r,i)),(s=-1<e?n[e]:null)&&Lt(s))}(this,t,e,n,s)},v.dispatchEvent=function(t){var e,n=this.C;if(n)for(e=[];n;n=n.C)e.push(n);n=this.J;var s=t.type||t;if("string"==typeof t)t=new wt(t,n);else if(t instanceof wt)t.target=t.target||n;else{var r=t;X(t=new wt(s,n),r)}if(r=!0,e)for(var i=e.length-1;0<=i;i--){var o=t.a=e[i];r=Ft(o,s,!0,t)&&r}if(r=Ft(o=t.a=n,s,!0,t)&&r,r=Ft(o,s,!1,t)&&r,e)for(i=0;i<e.length;i++)r=Ft(o=t.a=e[i],s,!1,t)&&r;return r},v.G=function(){if(Mt.S.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],s=0;s<n.length;s++)Tt(n[s]);delete e.a[t],e.b--}}this.C=null},v.va=function(t,e,n,s){return this.c.add(String(t),e,!1,n,s)},v.wa=function(t,e,n,s){return this.c.add(String(t),e,!0,n,s)};var qt=I.JSON.stringify;function jt(){this.b=this.a=null}var $t,Bt=new(function(){function t(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())(function(){return new zt},function(t){t.reset()},100);function Gt(){var t=Qt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function zt(){this.next=this.b=this.a=null}function Ht(t){I.setTimeout(function(){throw t},0)}function Wt(t,e){$t||function(){var t=I.Promise.resolve(void 0);$t=function(){t.then(Xt)}}(),Kt||($t(),Kt=!0),Qt.add(t,e)}jt.prototype.add=function(t,e){var n=Bt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},zt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},zt.prototype.reset=function(){this.next=this.b=this.a=null};var Kt=!1,Qt=new jt;function Xt(){for(var t;t=Gt();){try{t.a.call(t.b)}catch(t){Ht(t)}var e=Bt;e.g(t),e.b<e.f&&(e.b++,t.next=e.a,e.a=t)}Kt=!1}function Yt(t,e){Mt.call(this),this.b=t||1,this.a=e||I,this.f=L(this.Ya,this),this.g=k()}function Jt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Zt(t,e,n){if("function"==_(t))n&&(t=L(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=L(t.handleEvent,t)}return 2147483647<Number(e)?-1:I.setTimeout(t,e||0)}C(Yt,Mt),(v=Yt.prototype).aa=!1,v.M=null,v.Ya=function(){if(this.aa){var t=k()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(Jt(this),this.start()))}},v.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=k())},v.G=function(){Yt.S.G.call(this),Jt(this),delete this.a};var te=function(t){function e(e,n,s){var r=t.call(this)||this;return r.g=null!=s?e.bind(s):e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Zt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(I.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(P);function ee(t){P.call(this),this.b=t,this.a={}}C(ee,P);var ne=[];function se(t,e,n,s){Array.isArray(n)||(n&&(ne[0]=n.toString()),n=ne);for(var r=0;r<n.length;r++){var i=xt(e,n[r],s||t.handleEvent,!1,t.b||t);if(!i)break;t.a[i.key]=i}}function re(t){W(t.a,function(t,e){this.a.hasOwnProperty(e)&&Lt(t)},t),t.a={}}function ie(){this.a=!0}function oe(t,e,n,s){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var r=s[1];if(Array.isArray(r)&&!(1>r.length)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<r.length;o++)r[o]=""}}}return qt(n)}catch(t){return e}}(t,n)+(s?" "+s:"")})}ee.prototype.G=function(){ee.S.G.call(this),re(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ie.prototype.info=function(){};var ae=null;function ue(){return ae=ae||new Mt}function he(t){wt.call(this,"serverreachability",t)}function ce(t){var e=ue();e.dispatchEvent(new he(e,t))}function le(t){wt.call(this,"statevent",t)}function fe(t){var e=ue();e.dispatchEvent(new le(e,t))}function de(t){wt.call(this,"timingevent",t)}function pe(t,e){if("function"!=_(t))throw Error("Fn must not be null and must be a function");return I.setTimeout(function(){t()},e)}C(he,wt),C(le,wt),C(de,wt);var ge={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},me={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function ye(){}function we(t){var e;return(e=t.a)||(e=t.a={}),e}function ve(){}ye.prototype.a=null;var be,Ee={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function Ie(){wt.call(this,"d")}function Te(){wt.call(this,"c")}function _e(){}function Ne(t,e,n,s){this.g=t,this.c=e,this.f=n,this.T=s||1,this.J=new ee(this),this.P=Ae,t=st?125:void 0,this.R=new Yt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}C(Ie,wt),C(Te,wt),C(_e,ye),be=new _e;var Ae=45e3,Se={},De={};function xe(t,e,n){t.H=1,t.i=Ye(ze(e)),t.j=n,t.I=!0,Oe(t,null)}function Oe(t,e){t.u=k(),ke(t),t.l=ze(t.i);var n=t.l,s=t.T;Array.isArray(s)||(s=[String(s)]),ln(n.b,"t",s),t.D=0,t.a=ss(t.g,t.g.C?e:null),0<t.O&&(t.F=new te(L(t.Ca,t,t.a),t.O)),se(t.J,t.a,"readystatechange",t.Wa),e=t.B?K(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ce(1),function(t,e,n,s,r,i){t.info(function(){if(t.a)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var h=a[u].split("=");if(1<h.length){var c=h[0];h=h[1];var l=c.split("_");o=2<=l.length&&"type"==l[1]?o+(c+"=")+h+"&":o+(c+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+s+") [attempt "+r+"]: "+e+"\n"+n+"\n"+o})}(t.c,t.m,t.l,t.f,t.T,t.j)}function Le(t,e,n){for(var s=!0;!t.A&&t.D<n.length;){var r=Re(t,n);if(r==De){4==e&&(t.h=4,fe(14),s=!1),oe(t.c,t.f,null,"[Incomplete Response]");break}if(r==Se){t.h=4,fe(15),oe(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}oe(t.c,t.f,r,null),Me(t,r)}4==e&&0==n.length&&(t.h=1,fe(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.W&&(t.W=!0,(e=t.g).a==t&&e.V&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Qn(e),e.F=!0)):(oe(t.c,t.f,n,"[Invalid Chunked Response]"),Ue(t),Ve(t))}function Re(t,e){var n=t.D,s=e.indexOf("\n",n);return-1==s?De:(n=Number(e.substring(n,s)),isNaN(n)?Se:(s+=1)+n>e.length?De:(e=e.substr(s,n),t.D=s+n,e))}function ke(t){t.U=k()+t.P,Ce(t,t.P)}function Ce(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=pe(L(t.Ua,t),e)}function Pe(t){t.o&&(I.clearTimeout(t.o),t.o=null)}function Ve(t){0==t.g.v||t.A||Jn(t.g,t)}function Ue(t){Pe(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Jt(t.R),re(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Me(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||yn(n.b,t)))if(n.I=t.N,!t.C&&yn(n.b,t)&&3==n.v){try{var s=n.ka.a.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var r=s;if(0==r[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Yn(n),qn(n)}Kn(n),fe(18)}}else n.oa=r[1],0<n.oa-n.P&&37500>r[2]&&n.H&&0==n.o&&!n.m&&(n.m=pe(L(n.Ra,n),6e3));if(1>=mn(n.b)&&n.ea){try{n.ea()}catch(t){}n.ea=void 0}}else ts(n,11)}else if((t.C||n.a==t)&&Yn(n),!q(e))for(e=s=n.ka.a.parse(e),s=0;s<e.length;s++)if(r=e[s],n.P=r[0],r=r[1],2==n.v)if("c"==r[0]){n.J=r[1],n.ga=r[2];var i=r[3];null!=i&&(n.ha=i,n.c.info("VER="+n.ha));var o=r[4];null!=o&&(n.pa=o,n.c.info("SVER="+n.pa));var a=r[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var h=t.a;if(h){var c=h.a?h.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(c){var l=u.b;!l.a&&(B(c,"spdy")||B(c,"quic")||B(c,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(wn(l,l.b),l.b=null))}if(u.A){var f=h.a?h.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,Xe(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.V&&(n.N=k()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).la=ns(u,u.C?u.ga:null,u.fa),d.C){vn(u.b,d);var p=d,g=u.D;g&&p.setTimeout(g),p.o&&(Pe(p),ke(p)),u.a=d}else Wn(u);0<n.g.length&&Bn(n)}else"stop"!=r[0]&&"close"!=r[0]||ts(n,7);else 3==n.v&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?ts(n,7):Fn(n):"noop"!=r[0]&&n.f&&n.f.sa(r),n.o=0);ce(4)}catch(t){}}function Fe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(N(t)||"string"==typeof t)U(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(N(t)||"string"==typeof t){n=[];for(var s=t.length,r=0;r<s;r++)n.push(r)}else for(r in n=[],s=0,t)n[s++]=r;r=(s=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(N(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}for(s in e=[],n=0,t)e[n++]=t[s];return e}(t)).length;for(var i=0;i<r;i++)e.call(void 0,s[i],n&&n[i],t)}}function qe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var s=0;s<n;s+=2)this.set(arguments[s],arguments[s+1])}else if(t)if(t instanceof qe)for(n=t.L(),s=0;s<n.length;s++)this.set(n[s],t.get(n[s]));else for(s in t)this.set(s,t[s])}function je(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var s=t.a[e];$e(t.b,s)&&(t.a[n++]=s),e++}t.a.length=n}if(t.c!=t.a.length){var r={};for(n=e=0;e<t.a.length;)$e(r,s=t.a[e])||(t.a[n++]=s,r[s]=1),e++;t.a.length=n}}function $e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(v=Ne.prototype).setTimeout=function(t){this.P=t},v.Wa=function(t){t=t.target;var e=this.F;e&&3==Pn(t)?e.f():this.Ca(t)},v.Ca=function(t){try{if(t==this.a)t:{var e=Pn(this.a),n=this.a.ua(),s=this.a.X();if(!(3>e||3==e&&!st&&!this.a.$())){this.A||4!=e||7==n||ce(8==n||0>=s?3:2),Pe(this);var r=this.a.X();this.N=r;var i=this.a.$();if(this.b=200==r,function(t,e,n,s,r,i,o){t.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+r+"]: "+e+"\n"+n+"\n"+i+" "+o})}(this.c,this.m,this.l,this.f,this.T,e,r),this.b){if(this.V&&!this.C){e:{if(this.a){var o,a=this.a;if((o=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(o)){var u=o;break e}}u=null}if(!u){this.b=!1,this.h=3,fe(12),Ue(this),Ve(this);break t}oe(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Me(this,u)}this.I?(Le(this,e,i),st&&this.b&&3==e&&(se(this.J,this.R,"tick",this.Va),this.R.start())):(oe(this.c,this.f,i,null),Me(this,i)),4==e&&Ue(this),this.b&&!this.A&&(4==e?Jn(this.g,this):(this.b=!1,ke(this)))}else 400==r&&0<i.indexOf("Unknown SID")?(this.h=3,fe(12)):(this.h=0,fe(13)),Ue(this),Ve(this)}}}catch(t){}},v.Va=function(){if(this.a){var t=Pn(this.a),e=this.a.$();this.D<e.length&&(Pe(this),Le(this,t,e),this.b&&4!=t&&ke(this))}},v.cancel=function(){this.A=!0,Ue(this)},v.Ua=function(){this.o=null;var t=k();0<=t-this.U?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.H&&(ce(3),fe(17)),Ue(this),this.h=2,Ve(this)):Ce(this,this.U-t)},(v=qe.prototype).K=function(){je(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},v.L=function(){return je(this),this.a.concat()},v.get=function(t,e){return $e(this.b,t)?this.b[t]:e},v.set=function(t,e){$e(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},v.forEach=function(t,e){for(var n=this.L(),s=0;s<n.length;s++){var r=n[s],i=this.get(r);t.call(e,i,r,this)}};var Be=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ge(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ge){this.a=void 0!==e?e:t.a,He(this,t.f),this.j=t.j,We(this,t.c),Ke(this,t.h),this.g=t.g,e=t.b;var n=new an;n.c=e.c,e.a&&(n.a=new qe(e.a),n.b=e.b),Qe(this,n),this.i=t.i}else t&&(n=String(t).match(Be))?(this.a=!!e,He(this,n[1]||"",!0),this.j=Je(n[2]||""),We(this,n[3]||"",!0),Ke(this,n[4]),this.g=Je(n[5]||"",!0),Qe(this,n[6]||"",!0),this.i=Je(n[7]||"")):(this.a=!!e,this.b=new an(null,this.a))}function ze(t){return new Ge(t)}function He(t,e,n){t.f=n?Je(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function We(t,e,n){t.c=n?Je(e,!0):e}function Ke(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Qe(t,e,n){e instanceof an?(t.b=e,function(t,e){e&&!t.f&&(un(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(hn(this,e),ln(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=Ze(e,rn)),t.b=new an(e,t.a))}function Xe(t,e,n){t.b.set(e,n)}function Ye(t){return Xe(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^k()).toString(36)),t}function Je(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ze(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,tn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function tn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ge.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ze(e,en,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Ze(e,en,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ze(n,"/"==n.charAt(0)?sn:nn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Ze(n,on)),t.join("")};var en=/[#\/\?@]/g,nn=/[#\?:]/g,sn=/[#\?]/g,rn=/[#\?@]/g,on=/#/g;function an(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function un(t){t.a||(t.a=new qe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),r=null;if(0<=s){var i=t[n].substring(0,s);r=t[n].substring(s+1)}else i=t[n];e(i,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function hn(t,e){un(t),e=fn(t,e),$e(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,$e((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&je(t)))}function cn(t,e){return un(t),e=fn(t,e),$e(t.a.b,e)}function ln(t,e,n){hn(t,e),0<n.length&&(t.c=null,t.a.set(fn(t,e),F(n)),t.b+=n.length)}function fn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function dn(t){this.g=t||pn,I.PerformanceNavigationTiming?t=0<(t=I.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(I.ia&&I.ia.ya&&I.ia.ya()&&I.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(v=an.prototype).add=function(t,e){un(this),this.c=null,t=fn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},v.forEach=function(t,e){un(this),this.a.forEach(function(n,s){U(n,function(n){t.call(e,n,s,this)},this)},this)},v.L=function(){un(this);for(var t=this.a.K(),e=this.a.L(),n=[],s=0;s<e.length;s++)for(var r=t[s],i=0;i<r.length;i++)n.push(e[s]);return n},v.K=function(t){un(this);var e=[];if("string"==typeof t)cn(this,t)&&(e=M(e,this.a.get(fn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=M(e,t[n])}return e},v.set=function(t,e){return un(this),this.c=null,cn(this,t=fn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},v.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},v.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var s=e[n],r=encodeURIComponent(String(s));s=this.K(s);for(var i=0;i<s.length;i++){var o=r;""!==s[i]&&(o+="="+encodeURIComponent(String(s[i]))),t.push(o)}}return this.c=t.join("&")};var pn=10;function gn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function mn(t){return t.b?1:t.a?t.a.size:0}function yn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function wn(t,e){t.a?t.a.add(e):t.b=e}function vn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function bn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var s=t.c;try{for(var r=w(t.a.values()),i=r.next();!i.done;i=r.next()){var o=i.value;s=s.concat(o.s)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return s}return F(t.c)}function En(){}function In(t,e,n){var s=n||"";try{Fe(t,function(t,n){var r=t;A(t)&&(r=qt(t)),e.push(s+n+"="+encodeURIComponent(r))})}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}function Tn(t,e,n,s,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(s)}catch(t){}}dn.prototype.cancel=function(){var t,e;if(this.c=bn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=w(this.a.values()),s=n.next();!s.done;s=n.next()){s.value.cancel()}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},En.prototype.stringify=function(t){return I.JSON.stringify(t,void 0)},En.prototype.parse=function(t){return I.JSON.parse(t,void 0)};var _n=I.JSON.parse;function Nn(t){Mt.call(this),this.headers=new qe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=An,this.D=this.F=!1}C(Nn,Mt);var An="",Sn=/^https?$/i,Dn=["POST","PUT"];function xn(t){return"content-type"==t.toLowerCase()}function On(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Ln(t),kn(t)}function Ln(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Rn(t){if(t.b&&void 0!==E&&(!t.s[1]||4!=Pn(t)||2!=t.X()))if(t.l&&4==Pn(t))Zt(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==Pn(t)){t.b=!1;try{var e,n=t.X();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if(!(e=s)){var r;if(r=0===n){var i=String(t.B).match(Be)[1]||null;if(!i&&I.self&&I.self.location){var o=I.self.location.protocol;i=o.substr(0,o.length-1)}r=!Sn.test(i?i.toLowerCase():"")}e=r}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var a=2<Pn(t)?t.a.statusText:""}catch(t){a=""}t.f=a+" ["+t.X()+"]",Ln(t)}}finally{kn(t)}}}function kn(t,e){if(t.a){Cn(t);var n=t.a,s=t.s[0]?T:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=s}catch(t){}}}function Cn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(I.clearTimeout(t.m),t.m=null)}function Pn(t){return t.a?t.a.readyState:0}function Vn(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=function(t){var e="";return W(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Xe(t,e,n))}function Un(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Mn(t){this.pa=0,this.g=[],this.c=new ie,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=Un("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=Un("baseRetryDelayMs",5e3,t),this.Ma=Un("retryDelaySeedMs",1e4,t),this.Ja=Un("forwardChannelMaxRetries",2,t),this.ma=Un("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new dn(t&&t.concurrentRequestLimit),this.ka=new function(){this.a=new En},this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function Fn(t){if(jn(t),3==t.v){var e=t.R++,n=ze(t.B);Xe(n,"SID",t.J),Xe(n,"RID",e),Xe(n,"TYPE","terminate"),zn(t,n),(e=new Ne(t,t.c,e,void 0)).H=2,e.i=Ye(ze(n)),n=!1,I.navigator&&I.navigator.sendBeacon&&(n=I.navigator.sendBeacon(e.i.toString(),"")),!n&&I.Image&&((new Image).src=e.i,n=!0),n||(e.a=ss(e.g,null),e.a.ba(e.i)),e.u=k(),ke(e)}es(t)}function qn(t){t.a&&(Qn(t),t.a.cancel(),t.a=null)}function jn(t){qn(t),t.j&&(I.clearTimeout(t.j),t.j=null),Yn(t),t.b.cancel(),t.h&&("number"==typeof t.h&&I.clearTimeout(t.h),t.h=null)}function $n(t,e){t.g.push(new function(t,e){this.b=t,this.a=e}(t.La++,e)),3==t.v&&Bn(t)}function Bn(t){gn(t.b)||t.h||(t.h=!0,Wt(t.Ba,t),t.u=0)}function Gn(t,e){var n;n=e?e.f:t.R++;var s=ze(t.B);Xe(s,"SID",t.J),Xe(s,"RID",n),Xe(s,"AID",t.P),zn(t,s),t.i&&t.l&&Vn(s,t.i,t.l),n=new Ne(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Hn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),wn(t.b,n),xe(n,s,e)}function zn(t,e){t.f&&Fe({},function(t,n){Xe(e,n,t)})}function Hn(t,e,n){n=Math.min(t.g.length,n);var s=t.f?L(t.f.Ha,t.f,t):null;t:for(var r=t.g,i=-1;;){var o=["count="+n];-1==i?0<n?(i=r[0].b,o.push("ofs="+i)):i=0:o.push("ofs="+i);for(var a=!0,u=0;u<n;u++){var h=r[u].b,c=r[u].a;if(0>(h-=i))i=Math.max(0,r[u].b-100),a=!1;else try{In(c,o,"req"+h+"_")}catch(t){s&&s(c)}}if(a){s=o.join("&");break t}}return t=t.g.splice(0,n),e.s=t,s}function Wn(t){t.a||t.j||(t.U=1,Wt(t.Aa,t),t.o=0)}function Kn(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=pe(L(t.Aa,t),Zn(t,t.o)),t.o++,!0)}function Qn(t){null!=t.s&&(I.clearTimeout(t.s),t.s=null)}function Xn(t){t.a=new Ne(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=ze(t.la);Xe(e,"RID","rpc"),Xe(e,"SID",t.J),Xe(e,"CI",t.H?"0":"1"),Xe(e,"AID",t.P),zn(t,e),Xe(e,"TYPE","xmlhttp"),t.i&&t.l&&Vn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Ye(ze(e)),n.j=null,n.I=!0,Oe(n,t)}function Yn(t){null!=t.m&&(I.clearTimeout(t.m),t.m=null)}function Jn(t,e){var n=null;if(t.a==e){Yn(t),Qn(t),t.a=null;var s=2}else{if(!yn(t.b,e))return;n=e.s,vn(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==s){n=e.j?e.j.length:0,e=k()-e.u;var r=t.u;(s=ue()).dispatchEvent(new de(s,n,e,r)),Bn(t)}else Wn(t);else if(3==(r=e.h)||0==r&&0<t.I||!(1==s&&function(t,e){return!(mn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja)||(t.h=pe(L(t.Ba,t,e),Zn(t,t.u)),t.u++,0)))}(t,e)||2==s&&Kn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),r){case 1:ts(t,5);break;case 4:ts(t,10);break;case 3:ts(t,6);break;default:ts(t,2)}}function Zn(t,e){var n=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(n*=2),n*e}function ts(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var s=L(t.Xa,t);n||(n=new Ge("//www.google.com/images/cleardot.gif"),I.location&&"http"==I.location.protocol||He(n,"https"),Ye(n)),function(t,e){var n=new ie;if(I.Image){var s=new Image;s.onload=R(Tn,n,s,"TestLoadImage: loaded",!0,e),s.onerror=R(Tn,n,s,"TestLoadImage: error",!1,e),s.onabort=R(Tn,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=R(Tn,n,s,"TestLoadImage: timeout",!1,e),I.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=t}else e(!1)}(n.toString(),s)}else fe(2);t.v=0,t.f&&t.f.ra(e),es(t),jn(t)}function es(t){t.v=0,t.I=-1,t.f&&(0==bn(t.b).length&&0==t.g.length||(t.b.c.length=0,F(t.g),t.g.length=0),t.f.qa())}function ns(t,e,n){var s=function(t){return t instanceof Ge?ze(t):new Ge(t,void 0)}(n);if(""!=s.c)e&&We(s,e+"."+s.c),Ke(s,s.h);else{var r=I.location;s=function(t,e,n,s){var r=new Ge(null,void 0);return t&&He(r,t),e&&We(r,e),n&&Ke(r,n),s&&(r.g=s),r}(r.protocol,e?e+"."+r.hostname:r.hostname,+r.port,n)}return t.W&&W(t.W,function(t,e){Xe(s,e,t)}),e=t.A,n=t.na,e&&n&&Xe(s,e,n),Xe(s,"VER",t.ha),zn(t,s),s}function ss(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Nn(t.Ka)).F=t.C,e}function rs(){}function is(){if(et&&!(10<=Number(pt)))throw Error("Environmental error: no available transport.")}function os(t,e){Mt.call(this),this.a=new Mn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!q(t)&&(this.a.i=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!q(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new hs(this)}function as(t){Ie.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function us(){Te.call(this),this.status=1}function hs(t){this.a=t}(v=Nn.prototype).ba=function(t,e,n,s){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?we(this.H):we(be),this.a.onreadystatechange=L(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void On(this,t)}t=n||"";var r=new qe(this.headers);s&&Fe(s,function(t,e){r.set(e,t)}),s=function(t){t:{for(var e=xn,n=t.length,s="string"==typeof t?t.split(""):t,r=0;r<n;r++)if(r in s&&e.call(void 0,s[r],r,t)){e=r;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(r.L()),n=I.FormData&&t instanceof I.FormData,!(0<=V(Dn,e))||s||n||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Cn(this),0<this.o&&((this.D=function(t){return et&&ft(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=L(this.xa,this)):this.m=Zt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){On(this,t)}},v.xa=function(){void 0!==E&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},v.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),kn(this))},v.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),kn(this,!0)),Nn.S.G.call(this)},v.za=function(){this.j||(this.A||this.l||this.g?Rn(this):this.Ta())},v.Ta=function(){Rn(this)},v.X=function(){try{return 2<Pn(this)?this.a.status:-1}catch(t){return-1}},v.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},v.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),_n(e)}},v.ua=function(){return this.h},v.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(v=Mn.prototype).ha=8,v.v=1,v.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ne(this,this.c,t,void 0),s=this.l;if(this.O&&(s?X(s=K(s),this.O):s=this.O),null===this.i&&(n.B=s),this.da)t:{for(var r=e=0;r<this.g.length;r++){var i=this.g[r];if(void 0===(i="__data__"in i.a&&"string"==typeof(i=i.a.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=r;break t}if(4096===e||r===this.g.length-1){e=r+1;break t}}e=1e3}else e=1e3;e=Hn(this,n,e),Xe(r=ze(this.B),"RID",t),Xe(r,"CVER",22),this.A&&Xe(r,"X-HTTP-Session-Id",this.A),zn(this,r),this.i&&s&&Vn(r,this.i,s),wn(this.b,n),this.Ga&&Xe(r,"TYPE","init"),this.da?(Xe(r,"$req",e),Xe(r,"SID","null"),n.V=!0,xe(n,r,null)):xe(n,r,e),this.v=2}}else 3==this.v&&(t?Gn(this,t):0==this.g.length||gn(this.b)||Gn(this))},v.Aa=function(){if(this.j=null,Xn(this),this.V&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=pe(L(this.Sa,this),t)}},v.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,qn(this),Xn(this))},v.Ra=function(){null!=this.m&&(this.m=null,qn(this),Kn(this),fe(19))},v.Xa=function(t){t?(this.c.info("Successfully pinged google.com"),fe(2)):(this.c.info("Failed to ping google.com"),fe(1))},(v=rs.prototype).ta=function(){},v.sa=function(){},v.ra=function(){},v.qa=function(){},v.Ha=function(){},is.prototype.a=function(t,e){return new os(t,e)},C(os,Mt),(v=os.prototype).addEventListener=function(t,e,n,s){os.S.addEventListener.call(this,t,e,n,s)},v.removeEventListener=function(t,e,n,s){os.S.removeEventListener.call(this,t,e,n,s)},v.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,e=this.l,n=this.b||void 0;fe(0),t.fa=e,t.W=n||{},t.H=t.T,t.B=ns(t,null,t.fa),Bn(t)},v.close=function(){Fn(this.a)},v.Pa=function(t){if("string"==typeof t){var e={};e.__data__=t,$n(this.a,e)}else this.g?((e={}).__data__=qt(t),$n(this.a,e)):$n(this.a,t)},v.G=function(){this.a.f=null,delete this.f,Fn(this.a),delete this.a,os.S.G.call(this)},C(as,Ie),C(us,Te),C(hs,rs),hs.prototype.ta=function(){this.a.dispatchEvent("a")},hs.prototype.sa=function(t){this.a.dispatchEvent(new as(t))},hs.prototype.ra=function(t){this.a.dispatchEvent(new us(t))},hs.prototype.qa=function(){this.a.dispatchEvent("b")},is.prototype.createWebChannel=is.prototype.a,os.prototype.send=os.prototype.Pa,os.prototype.open=os.prototype.Oa,os.prototype.close=os.prototype.close,ge.NO_ERROR=0,ge.TIMEOUT=8,ge.HTTP_ERROR=6,me.COMPLETE="complete",ve.EventType=Ee,Ee.OPEN="a",Ee.CLOSE="b",Ee.ERROR="c",Ee.MESSAGE="d",Mt.prototype.listen=Mt.prototype.va,Nn.prototype.listenOnce=Nn.prototype.wa,Nn.prototype.getLastError=Nn.prototype.Qa,Nn.prototype.getLastErrorCode=Nn.prototype.ua,Nn.prototype.getStatus=Nn.prototype.X,Nn.prototype.getResponseJson=Nn.prototype.Na,Nn.prototype.getResponseText=Nn.prototype.$,Nn.prototype.send=Nn.prototype.ba;var cs={createWebChannelTransport:function(){return new is},ErrorCode:ge,EventType:me,WebChannel:ve,XhrIo:Nn},ls=cs.createWebChannelTransport,fs=cs.ErrorCode,ds=cs.EventType,ps=cs.WebChannel,gs=cs.XhrIo;class ms{constructor(t){this.uid=t}t(){return null!=this.uid}s(){return this.t()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}ms.UNAUTHENTICATED=new ms(null),ms.i=new ms("google-credentials-uid"),ms.o=new ms("first-party-uid");const ys=new m("@firebase/firestore");function ws(){return ys.logLevel}function vs(t,...e){if(ys.logLevel<=u.DEBUG){const n=e.map(Is);ys.debug("Firestore (7.17.1): "+t,...n)}}function bs(t,...e){if(ys.logLevel<=u.ERROR){const n=e.map(Is);ys.error("Firestore (7.17.1): "+t,...n)}}function Es(t,...e){if(ys.logLevel<=u.WARN){const n=e.map(Is);ys.warn("Firestore (7.17.1): "+t,...n)}}function Is(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Ts(t="Unexpected state"){const e="FIRESTORE (7.17.1) INTERNAL ASSERTION FAILED: "+t;throw bs(e),new Error(e)}function _s(t,e){t||Ts()}function Ns(t,e){return t}const As={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ss extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=(()=>`${this.name}: [code=${this.code}]: ${this.message}`)}}class Ds{constructor(t,e){this.user=e,this.type="OAuth",this.h={},this.h.Authorization="Bearer "+t}}class xs{constructor(t){this.u=null,this.currentUser=ms.UNAUTHENTICATED,this.l=!1,this._=0,this.T=null,this.forceRefresh=!1,this.u=(()=>{this._++,this.currentUser=this.I(),this.l=!0,this.T&&this.T(this.currentUser)}),this._=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.u):(this.u(null),t.get().then(t=>{this.auth=t,this.u&&this.auth.addAuthTokenListener(this.u)},()=>{}))}getToken(){const t=this._,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this._!==t?(vs("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(_s("string"==typeof e.accessToken),new Ds(e.accessToken,this.currentUser)):null):Promise.resolve(null)}A(){this.forceRefresh=!0}R(t){this.T=t,this.l&&t(this.currentUser)}m(){this.auth&&this.auth.removeAuthTokenListener(this.u),this.u=null,this.T=null}I(){const t=this.auth&&this.auth.getUid();return _s(null===t||"string"==typeof t),new ms(t)}}function Os(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Ls{static P(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=Os(40);for(let r=0;r<s.length;++r)n.length<20&&s[r]<e&&(n+=t.charAt(s[r]%t.length))}return n}}function Rs(t,e){return t<e?-1:t>e?1:0}function ks(t,e,n){return t.length===e.length&&t.every((t,s)=>n(t,e[s]))}function Cs(t){return t+"\0"}class Ps{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Ss(As.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Ss(As.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Ss(As.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ss(As.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Ps.fromMillis(Date.now())}static fromDate(t){return Ps.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3);return new Ps(e,1e6*(t-1e3*e))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}V(t){return this.seconds===t.seconds?Rs(this.nanoseconds,t.nanoseconds):Rs(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Vs{constructor(t){this.timestamp=t}static g(t){return new Vs(t)}static min(){return new Vs(new Ps(0,0))}p(t){return this.timestamp.V(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}v(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}S(){return this.timestamp}}class Us{constructor(t,e,n){void 0===e?e=0:e>t.length&&Ts(),void 0===n?n=t.length-e:n>t.length-e&&Ts(),this.segments=t,this.offset=e,this.C=n}get length(){return this.C}isEqual(t){return 0===Us.D(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Us?t.forEach(t=>{e.push(t)}):e.push(t),this.N(e)}limit(){return this.offset+this.length}k(t){return t=void 0===t?1:t,this.N(this.segments,this.offset+t,this.length-t)}O(){return this.N(this.segments,this.offset,this.length-1)}F(){return this.segments[this.offset]}M(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}$(){return 0===this.length}L(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}q(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}B(){return this.segments.slice(this.offset,this.limit())}static D(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),r=e.get(s);if(n<r)return-1;if(n>r)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Ms extends Us{N(t,e,n){return new Ms(t,e,n)}U(){return this.B().join("/")}toString(){return this.U()}static W(t){if(t.indexOf("//")>=0)throw new Ss(As.INVALID_ARGUMENT,`Invalid path (${t}). Paths must not contain // in them.`);const e=t.split("/").filter(t=>t.length>0);return new Ms(e)}static K(){return new Ms([])}}const Fs=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class qs extends Us{N(t,e,n){return new qs(t,e,n)}static j(t){return Fs.test(t)}U(){return this.B().map(t=>(t=t.replace("\\","\\\\").replace("`","\\`"),qs.j(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.U()}G(){return 1===this.length&&"__name__"===this.get(0)}static H(){return new qs(["__name__"])}static J(t){const e=[];let n="",s=0;const r=()=>{if(0===n.length)throw new Ss(As.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new Ss(As.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Ss(As.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(i=!i,s++):"."!==e||i?(n+=e,s++):(r(),s++)}if(r(),i)throw new Ss(As.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new qs(e)}static K(){return new qs([])}}class js{constructor(t){this.path=t}static Y(t){return new js(Ms.W(t).k(5))}X(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===Ms.D(this.path,t.path)}toString(){return this.path.toString()}static D(t,e){return Ms.D(t.path,e.path)}static Z(t){return t.length%2==0}static tt(t){return new js(new Ms(t.slice()))}}class $s{constructor(t,e,n,s,r){this.et=t,this.persistenceKey=e,this.host=n,this.ssl=s,this.forceLongPolling=r}}class Bs{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get nt(){return"(default)"===this.database}isEqual(t){return t instanceof Bs&&t.projectId===this.projectId&&t.database===this.database}p(t){return Rs(this.projectId,t.projectId)||Rs(this.database,t.database)}}function Gs(t){return null==t}function zs(t){return-0===t&&1/t==-1/0}function Hs(t){return"number"==typeof t&&Number.isInteger(t)&&!zs(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class Ws{constructor(t,e=null,n=[],s=[],r=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=i,this.endAt=o,this.st=null}}function Ks(t,e=null,n=[],s=[],r=null,i=null,o=null){return new Ws(t,e,n,s,r,i,o)}function Qs(t){const e=Ns(t);if(null===e.st){let t=e.path.U();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>(function(t){return t.field.U()+t.op.toString()+Br(t.value)})(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>(function(t){return t.field.U()+t.dir})(t)).join(","),Gs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Co(e.startAt)),e.endAt&&(t+="|ub:",t+=Co(e.endAt)),e.st=t}return e.st}function Xs(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Fo(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let r=0;r<t.filters.length;r++)if(n=t.filters[r],s=e.filters[r],n.op!==s.op||!n.field.isEqual(s.field)||!Fr(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Vo(t.startAt,e.startAt)&&Vo(t.endAt,e.endAt)}function Ys(t){return js.Z(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Js{constructor(t){this.it=t}static fromBase64String(t){const e=atob(t);return new Js(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Js(e)}toBase64(){return t=this.it,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.it)}rt(){return 2*this.it.length}p(t){return Rs(this.it,t.it)}isEqual(t){return this.it===t.it}}Js.ot=new Js("");class Zs{constructor(t,e,n,s,r=Vs.min(),i=Vs.min(),o=Js.ot){this.target=t,this.targetId=e,this.ht=n,this.sequenceNumber=s,this.at=r,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o}ut(t){return new Zs(this.target,this.targetId,this.ht,t,this.at,this.lastLimboFreeSnapshotVersion,this.resumeToken)}ct(t,e){return new Zs(this.target,this.targetId,this.ht,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}lt(t){return new Zs(this.target,this.targetId,this.ht,this.sequenceNumber,this.at,t,this.resumeToken)}}class tr{constructor(t){this.count=t}}var er,nr;function sr(t){switch(t){case As.OK:return Ts();case As.CANCELLED:case As.UNKNOWN:case As.DEADLINE_EXCEEDED:case As.RESOURCE_EXHAUSTED:case As.INTERNAL:case As.UNAVAILABLE:case As.UNAUTHENTICATED:return!1;case As.INVALID_ARGUMENT:case As.NOT_FOUND:case As.ALREADY_EXISTS:case As.PERMISSION_DENIED:case As.FAILED_PRECONDITION:case As.ABORTED:case As.OUT_OF_RANGE:case As.UNIMPLEMENTED:case As.DATA_LOSS:return!0;default:return Ts()}}function rr(t){if(void 0===t)return bs("GRPC error has no .code"),As.UNKNOWN;switch(t){case er.OK:return As.OK;case er.CANCELLED:return As.CANCELLED;case er.UNKNOWN:return As.UNKNOWN;case er.DEADLINE_EXCEEDED:return As.DEADLINE_EXCEEDED;case er.RESOURCE_EXHAUSTED:return As.RESOURCE_EXHAUSTED;case er.INTERNAL:return As.INTERNAL;case er.UNAVAILABLE:return As.UNAVAILABLE;case er.UNAUTHENTICATED:return As.UNAUTHENTICATED;case er.INVALID_ARGUMENT:return As.INVALID_ARGUMENT;case er.NOT_FOUND:return As.NOT_FOUND;case er.ALREADY_EXISTS:return As.ALREADY_EXISTS;case er.PERMISSION_DENIED:return As.PERMISSION_DENIED;case er.FAILED_PRECONDITION:return As.FAILED_PRECONDITION;case er.ABORTED:return As.ABORTED;case er.OUT_OF_RANGE:return As.OUT_OF_RANGE;case er.UNIMPLEMENTED:return As.UNIMPLEMENTED;case er.DATA_LOSS:return As.DATA_LOSS;default:return Ts()}}(nr=er||(er={}))[nr.OK=0]="OK",nr[nr.CANCELLED=1]="CANCELLED",nr[nr.UNKNOWN=2]="UNKNOWN",nr[nr.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",nr[nr.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",nr[nr.NOT_FOUND=5]="NOT_FOUND",nr[nr.ALREADY_EXISTS=6]="ALREADY_EXISTS",nr[nr.PERMISSION_DENIED=7]="PERMISSION_DENIED",nr[nr.UNAUTHENTICATED=16]="UNAUTHENTICATED",nr[nr.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",nr[nr.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",nr[nr.ABORTED=10]="ABORTED",nr[nr.OUT_OF_RANGE=11]="OUT_OF_RANGE",nr[nr.UNIMPLEMENTED=12]="UNIMPLEMENTED",nr[nr.INTERNAL=13]="INTERNAL",nr[nr.UNAVAILABLE=14]="UNAVAILABLE",nr[nr.DATA_LOSS=15]="DATA_LOSS";class ir{constructor(t,e){this.D=t,this.root=e||ar.EMPTY}_t(t,e){return new ir(this.D,this.root._t(t,e,this.D).copy(null,null,ar.ft,null,null))}remove(t){return new ir(this.D,this.root.remove(t,this.D).copy(null,null,ar.ft,null,null))}get(t){let e=this.root;for(;!e.$();){const n=this.D(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.$();){const s=this.D(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}$(){return this.root.$()}get size(){return this.root.size}dt(){return this.root.dt()}wt(){return this.root.wt()}Tt(t){return this.root.Tt(t)}forEach(t){this.Tt((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.Tt((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}Et(t){return this.root.Et(t)}It(){return new or(this.root,null,this.D,!1)}At(t){return new or(this.root,t,this.D,!1)}Rt(){return new or(this.root,null,this.D,!0)}Pt(t){return new or(this.root,t,this.D,!0)}}class or{constructor(t,e,n,s){this.Vt=s,this.gt=[];let r=1;for(;!t.$();)if(r=e?n(t.key,e):1,s&&(r*=-1),r<0)t=this.Vt?t.left:t.right;else{if(0===r){this.gt.push(t);break}this.gt.push(t),t=this.Vt?t.right:t.left}}yt(){let t=this.gt.pop();const e={key:t.key,value:t.value};if(this.Vt)for(t=t.left;!t.$();)this.gt.push(t),t=t.right;else for(t=t.right;!t.$();)this.gt.push(t),t=t.left;return e}pt(){return this.gt.length>0}bt(){if(0===this.gt.length)return null;const t=this.gt[this.gt.length-1];return{key:t.key,value:t.value}}}class ar{constructor(t,e,n,s,r){this.key=t,this.value=e,this.color=null!=n?n:ar.RED,this.left=null!=s?s:ar.EMPTY,this.right=null!=r?r:ar.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,r){return new ar(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=r?r:this.right)}$(){return!1}Tt(t){return this.left.Tt(t)||t(this.key,this.value)||this.right.Tt(t)}Et(t){return this.right.Et(t)||t(this.key,this.value)||this.left.Et(t)}min(){return this.left.$()?this:this.left.min()}dt(){return this.min().key}wt(){return this.right.$()?this.key:this.right.wt()}_t(t,e,n){let s=this;const r=n(t,s.key);return(s=r<0?s.copy(null,null,null,s.left._t(t,e,n),null):0===r?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right._t(t,e,n))).vt()}St(){if(this.left.$())return ar.EMPTY;let t=this;return t.left.Ct()||t.left.left.Ct()||(t=t.Dt()),(t=t.copy(null,null,null,t.left.St(),null)).vt()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.$()||s.left.Ct()||s.left.left.Ct()||(s=s.Dt()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.Ct()&&(s=s.Nt()),s.right.$()||s.right.Ct()||s.right.left.Ct()||(s=s.xt()),0===e(t,s.key)){if(s.right.$())return ar.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.St())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.vt()}Ct(){return this.color}vt(){let t=this;return t.right.Ct()&&!t.left.Ct()&&(t=t.kt()),t.left.Ct()&&t.left.left.Ct()&&(t=t.Nt()),t.left.Ct()&&t.right.Ct()&&(t=t.Ot()),t}Dt(){let t=this.Ot();return t.right.left.Ct()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Nt())).kt()).Ot()),t}xt(){let t=this.Ot();return t.left.left.Ct()&&(t=(t=t.Nt()).Ot()),t}kt(){const t=this.copy(null,null,ar.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}Nt(){const t=this.copy(null,null,ar.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}Ot(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}Ft(){const t=this.Mt();return Math.pow(2,t)<=this.size+1}Mt(){if(this.Ct()&&this.left.Ct())throw Ts();if(this.right.Ct())throw Ts();const t=this.left.Mt();if(t!==this.right.Mt())throw Ts();return t+(this.Ct()?0:1)}}ar.EMPTY=null,ar.RED=!0,ar.ft=!1,ar.EMPTY=new class{constructor(){this.size=0}get key(){throw Ts()}get value(){throw Ts()}get color(){throw Ts()}get left(){throw Ts()}get right(){throw Ts()}copy(t,e,n,s,r){return this}_t(t,e,n){return new ar(t,e)}remove(t,e){return this}$(){return!0}Tt(t){return!1}Et(t){return!1}dt(){return null}wt(){return null}Ct(){return!1}Ft(){return!0}Mt(){return 0}};class ur{constructor(t){this.D=t,this.data=new ir(this.D)}has(t){return null!==this.data.get(t)}first(){return this.data.dt()}last(){return this.data.wt()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.Tt((e,n)=>(t(e),!1))}$t(t,e){const n=this.data.At(t[0]);for(;n.pt();){const s=n.yt();if(this.D(s.key,t[1])>=0)return;e(s.key)}}Lt(t,e){let n;for(n=void 0!==e?this.data.At(e):this.data.It();n.pt();)if(!t(n.yt().key))return}qt(t){const e=this.data.At(t);return e.pt()?e.yt().key:null}It(){return new hr(this.data.It())}At(t){return new hr(this.data.At(t))}add(t){return this.copy(this.data.remove(t)._t(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}$(){return this.data.$()}Bt(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof ur))return!1;if(this.size!==t.size)return!1;const e=this.data.It(),n=t.data.It();for(;e.pt();){const t=e.yt().key,s=n.yt().key;if(0!==this.D(t,s))return!1}return!0}B(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new ur(this.D);return e.data=t,e}}class hr{constructor(t){this.Ut=t}yt(){return this.Ut.yt().key}pt(){return this.Ut.pt()}}const cr=new ir(js.D);function lr(){return cr}function fr(){return lr()}const dr=new ir(js.D);function pr(){return dr}const gr=new ir(js.D),mr=new ur(js.D);function yr(...t){let e=mr;for(const n of t)e=e.add(n);return e}const wr=new ur(Rs);function vr(){return wr}class br{constructor(t){this.D=t?(e,n)=>t(e,n)||js.D(e.key,n.key):(t,e)=>js.D(t.key,e.key),this.Wt=pr(),this.Kt=new ir(this.D)}static jt(t){return new br(t.D)}has(t){return null!=this.Wt.get(t)}get(t){return this.Wt.get(t)}first(){return this.Kt.dt()}last(){return this.Kt.wt()}$(){return this.Kt.$()}indexOf(t){const e=this.Wt.get(t);return e?this.Kt.indexOf(e):-1}get size(){return this.Kt.size}forEach(t){this.Kt.Tt((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.Wt._t(t.key,t),e.Kt._t(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.Wt.remove(t),this.Kt.remove(e)):this}isEqual(t){if(!(t instanceof br))return!1;if(this.size!==t.size)return!1;const e=this.Kt.It(),n=t.Kt.It();for(;e.pt();){const t=e.yt().key,s=n.yt().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new br;return n.D=this.D,n.Wt=t,n.Kt=e,n}}class Er{constructor(){this.Qt=new ir(js.D)}track(t){const e=t.doc.key,n=this.Qt.get(e);n?0!==t.type&&3===n.type?this.Qt=this.Qt._t(e,t):3===t.type&&1!==n.type?this.Qt=this.Qt._t(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qt=this.Qt._t(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qt=this.Qt._t(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qt=this.Qt.remove(e):1===t.type&&2===n.type?this.Qt=this.Qt._t(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qt=this.Qt._t(e,{type:2,doc:t.doc}):Ts():this.Qt=this.Qt._t(e,t)}Gt(){const t=[];return this.Qt.Tt((e,n)=>{t.push(n)}),t}}class Ir{constructor(t,e,n,s,r,i,o,a){this.query=t,this.docs=e,this.zt=n,this.docChanges=s,this.Ht=r,this.fromCache=i,this.Jt=o,this.Yt=a}static Xt(t,e,n,s){const r=[];return e.forEach(t=>{r.push({type:0,doc:t})}),new Ir(t,e,br.jt(e),r,n,s,!0,!1)}get hasPendingWrites(){return!this.Ht.$()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.Jt===t.Jt&&this.Ht.isEqual(t.Ht)&&vo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.zt.isEqual(t.zt)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Tr{constructor(t,e,n,s,r){this.at=t,this.Zt=e,this.te=n,this.ee=s,this.ne=r}static se(t,e){const n=new Map;return n.set(t,_r.ie(t,e)),new Tr(Vs.min(),n,vr(),lr(),yr())}}class _r{constructor(t,e,n,s,r){this.resumeToken=t,this.re=e,this.oe=n,this.he=s,this.ae=r}static ie(t,e){return new _r(Js.ot,e,yr(),yr(),yr())}}class Nr{constructor(t,e,n,s){this.ue=t,this.removedTargetIds=e,this.key=n,this.ce=s}}class Ar{constructor(t,e){this.targetId=t,this.le=e}}class Sr{constructor(t,e,n=Js.ot,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class Dr{constructor(){this._e=0,this.fe=Lr(),this.de=Js.ot,this.we=!1,this.Te=!0}get re(){return this.we}get resumeToken(){return this.de}get Ee(){return 0!==this._e}get Ie(){return this.Te}Ae(t){t.rt()>0&&(this.Te=!0,this.de=t)}Re(){let t=yr(),e=yr(),n=yr();return this.fe.forEach((s,r)=>{switch(r){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:Ts()}}),new _r(this.de,this.we,t,e,n)}me(){this.Te=!1,this.fe=Lr()}Pe(t,e){this.Te=!0,this.fe=this.fe._t(t,e)}Ve(t){this.Te=!0,this.fe=this.fe.remove(t)}ge(){this._e+=1}ye(){this._e-=1}pe(){this.Te=!0,this.we=!0}}class xr{constructor(t){this.be=t,this.ve=new Map,this.Se=lr(),this.Ce=Or(),this.De=new ur(Rs)}Ne(t){for(const e of t.ue)t.ce instanceof uo?this.xe(e,t.ce):t.ce instanceof ho&&this.ke(e,t.key,t.ce);for(const e of t.removedTargetIds)this.ke(e,t.key,t.ce)}Oe(t){this.Fe(t,e=>{const n=this.Me(e);switch(t.state){case 0:this.$e(e)&&n.Ae(t.resumeToken);break;case 1:n.ye(),n.Ee||n.me(),n.Ae(t.resumeToken);break;case 2:n.ye(),n.Ee||this.removeTarget(e);break;case 3:this.$e(e)&&(n.pe(),n.Ae(t.resumeToken));break;case 4:this.$e(e)&&(this.Le(e),n.Ae(t.resumeToken));break;default:Ts()}})}Fe(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ve.forEach((t,n)=>{this.$e(n)&&e(n)})}qe(t){const e=t.targetId,n=t.le.count,s=this.Be(e);if(s){const t=s.target;if(Ys(t))if(0===n){const n=new js(t.path);this.ke(e,n,new ho(n,Vs.min()))}else _s(1===n);else this.Ue(e)!==n&&(this.Le(e),this.De=this.De.add(e))}}We(t){const e=new Map;this.ve.forEach((n,s)=>{const r=this.Be(s);if(r){if(n.re&&Ys(r.target)){const e=new js(r.target.path);null!==this.Se.get(e)||this.Ke(s,e)||this.ke(s,e,new ho(e,t))}n.Ie&&(e.set(s,n.Re()),n.me())}});let n=yr();this.Ce.forEach((t,e)=>{let s=!0;e.Lt(t=>{const e=this.Be(t);return!e||2===e.ht||(s=!1,!1)}),s&&(n=n.add(t))});const s=new Tr(t,e,this.De,this.Se,n);return this.Se=lr(),this.Ce=Or(),this.De=new ur(Rs),s}xe(t,e){if(!this.$e(t))return;const n=this.Ke(t,e.key)?2:0;this.Me(t).Pe(e.key,n),this.Se=this.Se._t(e.key,e),this.Ce=this.Ce._t(e.key,this.je(e.key).add(t))}ke(t,e,n){if(!this.$e(t))return;const s=this.Me(t);this.Ke(t,e)?s.Pe(e,1):s.Ve(e),this.Ce=this.Ce._t(e,this.je(e).delete(t)),n&&(this.Se=this.Se._t(e,n))}removeTarget(t){this.ve.delete(t)}Ue(t){const e=this.Me(t).Re();return this.be.Qe(t).size+e.oe.size-e.ae.size}ge(t){this.Me(t).ge()}Me(t){let e=this.ve.get(t);return e||(e=new Dr,this.ve.set(t,e)),e}je(t){let e=this.Ce.get(t);return e||(e=new ur(Rs),this.Ce=this.Ce._t(t,e)),e}$e(t){const e=null!==this.Be(t);return e||vs("WatchChangeAggregator","Detected inactive target",t),e}Be(t){const e=this.ve.get(t);return e&&e.Ee?null:this.be.Ge(t)}Le(t){this.ve.set(t,new Dr),this.be.Qe(t).forEach(e=>{this.ke(t,e,null)})}Ke(t,e){return this.be.Qe(t).has(e)}}function Or(){return new ir(js.D)}function Lr(){return new ir(js.D)}function Rr(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function kr(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Cr(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Pr(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Vr(t){const e=Gr(t.mapValue.fields.__local_write_time__.timestampValue);return new Ps(e.seconds,e.nanos)}const Ur=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mr(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Pr(t)?4:10:Ts()}function Fr(t,e){const n=Mr(t);if(n!==Mr(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Vr(t).isEqual(Vr(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Gr(t.timestampValue),s=Gr(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Hr(t.bytesValue).isEqual(Hr(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return zr(t.geoPointValue.latitude)===zr(e.geoPointValue.latitude)&&zr(t.geoPointValue.longitude)===zr(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return zr(t.integerValue)===zr(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=zr(t.doubleValue),s=zr(e.doubleValue);return n===s?zs(n)===zs(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return ks(t.arrayValue.values||[],e.arrayValue.values||[],Fr);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(Rr(n)!==Rr(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!Fr(n[t],s[t])))return!1;return!0}(t,e);default:return Ts()}}function qr(t,e){return void 0!==(t.values||[]).find(t=>Fr(t,e))}function jr(t,e){const n=Mr(t),s=Mr(e);if(n!==s)return Rs(n,s);switch(n){case 0:return 0;case 1:return Rs(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=zr(t.integerValue||t.doubleValue),s=zr(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return $r(t.timestampValue,e.timestampValue);case 4:return $r(Vr(t),Vr(e));case 5:return Rs(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Hr(t),s=Hr(e);return n.p(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=Rs(n[t],s[t]);if(0!==e)return e}return Rs(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Rs(zr(t.latitude),zr(e.latitude));return 0!==n?n:Rs(zr(t.longitude),zr(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=jr(n[t],s[t]);if(e)return e}return Rs(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=Object.keys(n),r=e.fields||{},i=Object.keys(r);s.sort(),i.sort();for(let t=0;t<s.length&&t<i.length;++t){const e=Rs(s[t],i[t]);if(0!==e)return e;const o=jr(n[s[t]],r[i[t]]);if(0!==o)return o}return Rs(s.length,i.length)}(t.mapValue,e.mapValue);default:throw Ts()}}function $r(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Rs(t,e);const n=Gr(t),s=Gr(e),r=Rs(n.seconds,s.seconds);return 0!==r?r:Rs(n.nanos,s.nanos)}function Br(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){const e=Gr(t);return`time(${e.seconds},${e.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Hr(e.bytesValue).toBase64():"referenceValue"in e?(s=e.referenceValue,js.Y(s).toString()):"geoPointValue"in e?`geo(${(n=e.geoPointValue).latitude},${n.longitude})`:"arrayValue"in e?function(e){let n="[",s=!0;for(const r of e.values||[])s?s=!1:n+=",",n+=t(r);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){const n=Object.keys(e.fields||{}).sort();let s="{",r=!0;for(const i of n)r?r=!1:s+=",",s+=`${i}:${t(e.fields[i])}`;return s+"}"}(e.mapValue):Ts();var n,s}(t)}function Gr(t){if(_s(!!t),"string"==typeof t){let e=0;const n=Ur.exec(t);if(_s(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:zr(t.seconds),nanos:zr(t.nanos)}}function zr(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Hr(t){return"string"==typeof t?Js.fromBase64String(t):Js.fromUint8Array(t)}function Wr(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.U()}`}}function Kr(t){return!!t&&"integerValue"in t}function Qr(t){return!!t&&"arrayValue"in t}function Xr(t){return!!t&&"nullValue"in t}function Yr(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Jr(t){return!!t&&"mapValue"in t}const Zr={asc:"ASCENDING",desc:"DESCENDING"},ti={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class ei{constructor(t,e){this.et=t,this.ze=e}}function ni(t){return{integerValue:""+t}}function si(t,e){if(t.ze){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zs(e)?"-0":e}}function ri(t,e){return Hs(e)?ni(e):si(t,e)}function ii(t,e){return t.ze?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function oi(t,e){return t.ze?e.toBase64():e.toUint8Array()}function ai(t){return _s(!!t),Vs.g(function(t){const e=Gr(t);return new Ps(e.seconds,e.nanos)}(t))}function ui(t,e){return function(t){return new Ms(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).U()}function hi(t){const e=Ms.W(t);return _s(Ai(e)),e}function ci(t,e){return ui(t.et,e.path)}function li(t,e){const n=hi(e);return _s(n.get(1)===t.et.projectId),_s(!n.get(3)&&!t.et.database||n.get(3)===t.et.database),new js(gi(n))}function fi(t,e){return ui(t.et,e)}function di(t){const e=hi(t);return 4===e.length?Ms.K():gi(e)}function pi(t){return new Ms(["projects",t.et.projectId,"databases",t.et.database]).U()}function gi(t){return _s(t.length>4&&"documents"===t.get(4)),t.k(5)}function mi(t,e,n){return{name:ci(t,e),fields:n.proto.mapValue.fields}}function yi(t,e){let n;if(e instanceof Xi)n={update:mi(t,e.key,e.value)};else if(e instanceof no)n={delete:ci(t,e.key)};else if(e instanceof Yi)n={update:mi(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.U())),{fieldPaths:e}}(e.He)};else if(e instanceof Zi)n={transform:{document:ci(t,e.key),fieldTransforms:e.fieldTransforms.map(t=>(function(t,e){const n=e.transform;if(n instanceof Li)return{fieldPath:e.field.U(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ri)return{fieldPath:e.field.U(),appendMissingElements:{values:n.elements}};if(n instanceof Ci)return{fieldPath:e.field.U(),removeAllFromArray:{values:n.elements}};if(n instanceof Vi)return{fieldPath:e.field.U(),increment:n.Je};throw Ts()})(0,t))}};else{if(!(e instanceof so))return Ts();n={verify:ci(t,e.key)}}return e.Xe.Ye||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:function(t,e){return ii(t,e.S())}(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Ts()}(t,e.Xe)),n}function wi(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?$i.updateTime(ai(t.updateTime)):void 0!==t.exists?$i.exists(t.exists):$i.Ze()}(e.currentDocument):$i.Ze();if(e.update){e.update.name;const s=li(t,e.update.name),r=new ro({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new Fi(e.map(t=>qs.J(t)))}(e.updateMask);return new Yi(s,r,t,n)}return new Xi(s,r,n)}if(e.delete){const s=li(t,e.delete);return new no(s,n)}if(e.transform){const s=li(t,e.transform.document),r=e.transform.fieldTransforms.map(e=>(function(t,e){let n=null;if("setToServerValue"in e)_s("REQUEST_TIME"===e.setToServerValue),n=new Li;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Ri(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Ci(t)}else"increment"in e?n=new Vi(t,e.increment):Ts();const s=qs.J(e.fieldPath);return new qi(s,n)})(t,e));return _s(!0===n.exists),new Zi(s,r)}if(e.verify){const s=li(t,e.verify);return new so(s,n)}return Ts()}function vi(t,e){return{documents:[fi(t,e.path)]}}function bi(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=fi(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=fi(t,s.O()),n.structuredQuery.from=[{collectionId:s.M()}]);const r=function(t){if(0===t.length)return;const e=t.map(t=>(function(t){if("=="===t.op){if(Yr(t.value))return{unaryFilter:{field:_i(t.field),op:"IS_NAN"}};if(Xr(t.value))return{unaryFilter:{field:_i(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Yr(t.value))return{unaryFilter:{field:_i(t.field),op:"IS_NOT_NAN"}};if(Xr(t.value))return{unaryFilter:{field:_i(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:_i(t.field),op:(e=t.op,ti[e]),value:t.value}};var e})(t));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);r&&(n.structuredQuery.where=r);const i=function(t){if(0!==t.length)return t.map(t=>(function(t){return{field:_i(t.field),direction:(e=t.dir,Zr[e])};var e})(t))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=function(t,e){return t.ze||Gs(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=Ii(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ii(e.endAt)),n}function Ei(t){let e=di(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let r=null;if(s>0){_s(1===s);const t=n.from[0];t.allDescendants?r=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Ni(t.unaryFilter.field);return _o.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Ni(t.unaryFilter.field);return _o.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Ni(t.unaryFilter.field);return _o.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=Ni(t.unaryFilter.field);return _o.create(r,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Ts()}}(e)]:void 0!==e.fieldFilter?[function(t){return _o.create(Ni(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Ts()}}(t.fieldFilter.op),t.fieldFilter.value)}(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((t,e)=>t.concat(e)):Ts():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(t=>(function(t){return new Uo(Ni(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))})(t)));let a=null;n.limit&&(a=function(t){let e;return Gs(e="object"==typeof t?t.value:t)?null:e}(n.limit));let u=null;n.startAt&&(u=Ti(n.startAt));let h=null;return n.endAt&&(h=Ti(n.endAt)),wo(po(e,r,o,i,a,"F",u,h))}function Ii(t){return{before:t.before,values:t.position}}function Ti(t){const e=!!t.before,n=t.values||[];return new ko(n,e)}function _i(t){return{fieldPath:t.U()}}function Ni(t){return qs.J(t.fieldPath)}function Ai(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Si{constructor(){this.tn=void 0}}function Di(t,e,n){return t instanceof Li?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ri?ki(t,e):t instanceof Ci?Pi(t,e):function(t,e){const n=Oi(t,e),s=Ui(n)+Ui(t.Je);return Kr(n)&&Kr(t.Je)?ni(s):si(t.serializer,s)}(t,e)}function xi(t,e,n){return t instanceof Ri?ki(t,e):t instanceof Ci?Pi(t,e):n}function Oi(t,e){return t instanceof Vi?Kr(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}class Li extends Si{}class Ri extends Si{constructor(t){super(),this.elements=t}}function ki(t,e){const n=Mi(e);for(const e of t.elements)n.some(t=>Fr(t,e))||n.push(e);return{arrayValue:{values:n}}}class Ci extends Si{constructor(t){super(),this.elements=t}}function Pi(t,e){let n=Mi(e);for(const e of t.elements)n=n.filter(t=>!Fr(t,e));return{arrayValue:{values:n}}}class Vi extends Si{constructor(t,e){super(),this.serializer=t,this.Je=e}}function Ui(t){return zr(t.integerValue||t.doubleValue)}function Mi(t){return Qr(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Fi{constructor(t){this.fields=t,t.sort(qs.D)}en(t){for(const e of this.fields)if(e.L(t))return!0;return!1}isEqual(t){return ks(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class qi{constructor(t,e){this.field=t,this.transform=e}}class ji{constructor(t,e){this.version=t,this.transformResults=e}}class $i{constructor(t,e){this.updateTime=t,this.exists=e}static Ze(){return new $i}static exists(t){return new $i(void 0,t)}static updateTime(t){return new $i(t)}get Ye(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Bi(t,e){return void 0!==t.updateTime?e instanceof uo&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof uo}class Gi{}function zi(t,e,n){return t instanceof Xi?function(t,e,n){return new uo(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof Yi?function(t,e,n){if(!Bi(t.Xe,e))return new co(t.key,n.version);const s=Ji(t,e);return new uo(t.key,n.version,s,{hasCommittedMutations:!0})}(t,e,n):t instanceof Zi?function(t,e,n){if(_s(null!=n.transformResults),!Bi(t.Xe,e))return new co(t.key,n.version);const s=to(t,e),r=function(t,e,n){const s=[];_s(t.length===n.length);for(let r=0;r<n.length;r++){const i=t[r],o=i.transform;let a=null;e instanceof uo&&(a=e.field(i.field)),s.push(xi(o,a,n[r]))}return s}(t.fieldTransforms,e,n.transformResults),i=n.version,o=eo(t,s.data(),r);return new uo(t.key,i,o,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new ho(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function Hi(t,e,n,s){return t instanceof Xi?function(t,e){if(!Bi(t.Xe,e))return e;const n=Qi(e);return new uo(t.key,n,t.value,{nn:!0})}(t,e):t instanceof Yi?function(t,e){if(!Bi(t.Xe,e))return e;const n=Qi(e),s=Ji(t,e);return new uo(t.key,n,s,{nn:!0})}(t,e):t instanceof Zi?function(t,e,n,s){if(!Bi(t.Xe,e))return e;const r=to(t,e),i=function(t,e,n,s){const r=[];for(const i of t){const t=i.transform;let o=null;n instanceof uo&&(o=n.field(i.field)),null===o&&s instanceof uo&&(o=s.field(i.field)),r.push(Di(t,o,e))}return r}(t.fieldTransforms,n,e,s),o=eo(t,r.data(),i);return new uo(t.key,r.version,o,{nn:!0})}(t,e,s,n):function(t,e){return Bi(t.Xe,e)?new ho(t.key,Vs.min()):e}(t,e)}function Wi(t,e){return t instanceof Zi?function(t,e){let n=null;for(const s of t.fieldTransforms){const t=e instanceof uo?e.field(s.field):void 0,r=Oi(s.transform,t||null);null!=r&&(n=null==n?(new io).set(s.field,r):n.set(s.field,r))}return n?n.sn():null}(t,e):null}function Ki(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Xe.isEqual(e.Xe)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.He.isEqual(e.He):2!==t.type||ks(t.fieldTransforms,t.fieldTransforms,(t,e)=>(function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ri&&e instanceof Ri||t instanceof Ci&&e instanceof Ci?ks(t.elements,e.elements,Fr):t instanceof Vi&&e instanceof Vi?Fr(t.Je,e.Je):t instanceof Li&&e instanceof Li}(t.transform,e.transform)})(t,e)))}function Qi(t){return t instanceof uo?t.version:Vs.min()}class Xi extends Gi{constructor(t,e,n){super(),this.key=t,this.value=e,this.Xe=n,this.type=0}}class Yi extends Gi{constructor(t,e,n,s){super(),this.key=t,this.data=e,this.He=n,this.Xe=s,this.type=1}}function Ji(t,e){let n;return function(t,e){const n=new io(e);return t.He.fields.forEach(e=>{if(!e.$()){const s=t.data.field(e);null!==s?n.set(e,s):n.delete(e)}}),n.sn()}(t,n=e instanceof uo?e.data():ro.empty())}class Zi extends Gi{constructor(t,e){super(),this.key=t,this.fieldTransforms=e,this.type=2,this.Xe=$i.exists(!0)}}function to(t,e){return e}function eo(t,e,n){const s=new io(e);for(let e=0;e<t.fieldTransforms.length;e++){const r=t.fieldTransforms[e];s.set(r.field,n[e])}return s.sn()}class no extends Gi{constructor(t,e){super(),this.key=t,this.Xe=e,this.type=3}}class so extends Gi{constructor(t,e){super(),this.key=t,this.Xe=e,this.type=4}}class ro{constructor(t){this.proto=t}static empty(){return new ro({mapValue:{}})}field(t){if(t.$())return this.proto;{let e=this.proto;for(let n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Jr(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.M()])||null}}isEqual(t){return Fr(this.proto,t.proto)}}class io{constructor(t=ro.empty()){this.rn=t,this.on=new Map}set(t,e){return this.hn(t,e),this}delete(t){return this.hn(t,null),this}hn(t,e){let n=this.on;for(let e=0;e<t.length-1;++e){const s=t.get(e);let r=n.get(s);r instanceof Map?n=r:r&&10===Mr(r)?(r=new Map(Object.entries(r.mapValue.fields||{})),n.set(s,r),n=r):(r=new Map,n.set(s,r),n=r)}n.set(t.M(),e)}sn(){const t=this.an(qs.K(),this.on);return null!=t?new ro(t):this.rn}an(t,e){let n=!1;const s=this.rn.field(t),r=Jr(s)?Object.assign({},s.mapValue.fields):{};return e.forEach((e,s)=>{if(e instanceof Map){const i=this.an(t.child(s),e);null!=i&&(r[s]=i,n=!0)}else null!==e?(r[s]=e,n=!0):r.hasOwnProperty(s)&&(delete r[s],n=!0)}),n?{mapValue:{fields:r}}:null}}function oo(t){const e=[];return kr(t.fields||{},(t,n)=>{const s=new qs([t]);if(Jr(n)){const t=oo(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)}),new Fi(e)}class ao{constructor(t,e){this.key=t,this.version=e}}class uo extends ao{constructor(t,e,n,s){super(t,e),this.un=n,this.nn=!!s.nn,this.hasCommittedMutations=!!s.hasCommittedMutations}field(t){return this.un.field(t)}data(){return this.un}cn(){return this.un.proto}isEqual(t){return t instanceof uo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.nn===t.nn&&this.hasCommittedMutations===t.hasCommittedMutations&&this.un.isEqual(t.un)}toString(){return`Document(${this.key}, ${this.version}, ${this.un.toString()}, {hasLocalMutations: ${this.nn}}), {hasCommittedMutations: ${this.hasCommittedMutations}})`}get hasPendingWrites(){return this.nn||this.hasCommittedMutations}}class ho extends ao{constructor(t,e,n){super(t,e),this.hasCommittedMutations=!(!n||!n.hasCommittedMutations)}toString(){return`NoDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return this.hasCommittedMutations}isEqual(t){return t instanceof ho&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class co extends ao{toString(){return`UnknownDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return!0}isEqual(t){return t instanceof co&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}function lo(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new Ss(As.INVALID_ARGUMENT,`Type does not match the expected instance. Did you pass '${e.name}' from a different Firestore SDK?`):new Ss(As.INVALID_ARGUMENT,`Expected type '${e.name}', but was '${t.constructor.name}'`);return t}class fo{constructor(t,e=null,n=[],s=[],r=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.ln=n,this.filters=s,this.limit=r,this._n=i,this.startAt=o,this.endAt=a,this.fn=null,this.dn=null,this.startAt,this.endAt}wn(t){return new fo(t,null,this.ln.slice(),this.filters.slice(),this.limit,this._n,this.startAt,this.endAt)}Tn(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.ln.length||1===this.ln.length&&this.ln[0].field.G())}En(){return!Gs(this.limit)&&"F"===this._n}In(){return!Gs(this.limit)&&"L"===this._n}An(){return this.ln.length>0?this.ln[0].field:null}Rn(){for(const t of this.filters)if(t.mn())return t.field;return null}Pn(t){for(const e of this.filters)if(t.indexOf(e.op)>=0)return e.op;return null}}function po(t,e,n,s,r,i,o,a){return new fo(t,e,n,s,r,i,o,a)}function go(t){return new fo(t)}function mo(t){return null!==t.collectionGroup}function yo(t){const e=lo(t,fo);if(null===e.fn){e.fn=[];const t=e.Rn(),n=e.An();if(null!==t&&null===n)t.G()||e.fn.push(new Uo(t)),e.fn.push(new Uo(qs.H(),"asc"));else{let t=!1;for(const n of e.ln)e.fn.push(n),n.field.G()&&(t=!0);if(!t){const t=e.ln.length>0?e.ln[e.ln.length-1].dir:"asc";e.fn.push(new Uo(qs.H(),t))}}}return e.fn}function wo(t){const e=lo(t,fo);if(!e.dn)if("F"===e._n)e.dn=Ks(e.path,e.collectionGroup,yo(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of yo(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Uo(n.field,e))}const n=e.endAt?new ko(e.endAt.position,!e.endAt.before):null,s=e.startAt?new ko(e.startAt.position,!e.startAt.before):null;e.dn=Ks(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.dn}function vo(t,e){return Xs(wo(t),wo(e))&&t._n===e._n}function bo(t){return`${Qs(wo(t))}|lt:${t._n}`}function Eo(t){return`Query(target=${function(t){let e=t.path.U();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>{return`${(e=t).field.U()} ${e.op} ${Br(e.value)}`;var e}).join(", ")}]`),Gs(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>(function(t){return`${t.field.U()} (${t.dir})`})(t)).join(", ")}]`),t.startAt&&(e+=", startAt: "+Co(t.startAt)),t.endAt&&(e+=", endAt: "+Co(t.endAt)),`Target(${e})`}(wo(t))}; limitType=${t._n})`}function Io(t,e){return function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.X(t.collectionGroup)&&t.path.L(n):js.Z(t.path)?t.path.isEqual(n):t.path.q(n)}(t,e)&&function(t,e){for(const n of t.ln)if(!n.field.G()&&null===e.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!Po(t.startAt,yo(t),e))&&(!t.endAt||!Po(t.endAt,yo(t),e))}(t,e)}function To(t){return(e,n)=>{let s=!1;for(const r of yo(t)){const t=Mo(r,e,n);if(0!==t)return t;s=s||r.field.G()}return 0}}class _o extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){if(t.G())return"in"===e||"not-in"===e?this.Vn(t,e,n):new No(t,e,n);if(Xr(n)){if("=="!==e&&"!="!==e)throw new Ss(As.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new _o(t,e,n)}if(Yr(n)){if("=="!==e&&"!="!==e)throw new Ss(As.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new _o(t,e,n)}return"array-contains"===e?new xo(t,n):"in"===e?new Oo(t,n):"not-in"===e?new Lo(t,n):"array-contains-any"===e?new Ro(t,n):new _o(t,e,n)}static Vn(t,e,n){return"in"===e?new Ao(t,n):new So(t,n)}matches(t){const e=t.field(this.field);return"!="===this.op?null!==e&&this.gn(jr(e,this.value)):null!==e&&Mr(this.value)===Mr(e)&&this.gn(jr(e,this.value))}gn(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Ts()}}mn(){return["<","<=",">",">=","!="].indexOf(this.op)>=0}}class No extends _o{constructor(t,e,n){super(t,e,n),this.key=js.Y(n.referenceValue)}matches(t){const e=js.D(t.key,this.key);return this.gn(e)}}class Ao extends _o{constructor(t,e){super(t,"in",e),this.keys=Do("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class So extends _o{constructor(t,e){super(t,"not-in",e),this.keys=Do("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Do(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>js.Y(t.referenceValue))}class xo extends _o{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.field(this.field);return Qr(e)&&qr(e.arrayValue,this.value)}}class Oo extends _o{constructor(t,e){super(t,"in",e)}matches(t){const e=t.field(this.field);return null!==e&&qr(this.value.arrayValue,e)}}class Lo extends _o{constructor(t,e){super(t,"not-in",e)}matches(t){const e=t.field(this.field);return null!==e&&!qr(this.value.arrayValue,e)}}class Ro extends _o{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.field(this.field);return!(!Qr(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>qr(this.value.arrayValue,t))}}class ko{constructor(t,e){this.position=t,this.before=e}}function Co(t){return`${t.before?"b":"a"}:${t.position.map(t=>Br(t)).join(",")}`}function Po(t,e,n){let s=0;for(let r=0;r<t.position.length;r++){const i=e[r],o=t.position[r];if(s=i.field.G()?js.D(js.Y(o.referenceValue),n.key):jr(o,n.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return t.before?s<=0:s<0}function Vo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Fr(t.position[n],e.position[n]))return!1;return!0}class Uo{constructor(t,e="asc"){this.field=t,this.dir=e}}function Mo(t,e,n){const s=t.field.G()?js.D(e.key,n.key):function(t,e,n){const s=e.field(t),r=n.field(t);return null!==s&&null!==r?jr(s,r):Ts()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return Ts()}}function Fo(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class qo{constructor(t,e,n,s){this.batchId=t,this.yn=e,this.baseMutations=n,this.mutations=s}pn(t,e,n){const s=n.bn;for(let n=0;n<this.mutations.length;n++){const r=this.mutations[n];r.key.isEqual(t)&&(e=zi(r,e,s[n]))}return e}vn(t,e){for(const n of this.baseMutations)n.key.isEqual(t)&&(e=Hi(n,e,e,this.yn));const n=e;for(const s of this.mutations)s.key.isEqual(t)&&(e=Hi(s,e,n,this.yn));return e}Sn(t){let e=t;return this.mutations.forEach(n=>{const s=this.vn(n.key,t.get(n.key));s&&(e=e._t(n.key,s))}),e}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),yr())}isEqual(t){return this.batchId===t.batchId&&ks(this.mutations,t.mutations,(t,e)=>Ki(t,e))&&ks(this.baseMutations,t.baseMutations,(t,e)=>Ki(t,e))}}class jo{constructor(t,e,n,s){this.batch=t,this.Cn=e,this.bn=n,this.Dn=s}static from(t,e,n){_s(t.mutations.length===n.length);let s=gr;const r=t.mutations;for(let t=0;t<r.length;t++)s=s._t(r[t].key,n[t].version);return new jo(t,e,n,s)}}class $o{constructor(t,e){this.Nn=t,this.xn=e,this.kn={}}get(t){const e=this.Nn(t),n=this.kn[e];if(void 0!==n)for(const[e,s]of n)if(this.xn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.Nn(t),s=this.kn[n];if(void 0!==s){for(let n=0;n<s.length;n++)if(this.xn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e])}else this.kn[n]=[[t,e]]}delete(t){const e=this.Nn(t),n=this.kn[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.xn(n[s][0],t))return 1===n.length?delete this.kn[e]:n.splice(s,1),!0;return!1}forEach(t){kr(this.kn,(e,n)=>{for(const[e,s]of n)t(e,s)})}$(){return Cr(this.kn)}}class Bo{constructor(t){this.On=null,this.Fn=null,this.result=void 0,this.error=void 0,this.Mn=!1,this.$n=!1,t(t=>{this.Mn=!0,this.result=t,this.On&&this.On(t)},t=>{this.Mn=!0,this.error=t,this.Fn&&this.Fn(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.$n&&Ts(),this.$n=!0,this.Mn?this.error?this.Ln(e,this.error):this.qn(t,this.result):new Bo((n,s)=>{this.On=(e=>{this.qn(t,e).next(n,s)}),this.Fn=(t=>{this.Ln(e,t).next(n,s)})})}Bn(){return new Promise((t,e)=>{this.next(t,e)})}Un(t){try{const e=t();return e instanceof Bo?e:Bo.resolve(e)}catch(t){return Bo.reject(t)}}qn(t,e){return t?this.Un(()=>t(e)):Bo.resolve(e)}Ln(t,e){return t?this.Un(()=>t(e)):Bo.reject(e)}static resolve(t){return new Bo((e,n)=>{e(t)})}static reject(t){return new Bo((e,n)=>{n(t)})}static Wn(t){return new Bo((e,n)=>{let s=0,r=0,i=!1;t.forEach(t=>{++s,t.next(()=>{++r,i&&r===s&&e()},t=>n(t))}),i=!0,r===s&&e()})}static Kn(t){let e=Bo.resolve(!1);for(const n of t)e=e.next(t=>t?Bo.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,s)=>{n.push(e.call(this,t,s))}),this.Wn(n)}}class Go{constructor(){this.jn=new $o(t=>t.toString(),(t,e)=>t.isEqual(e)),this.Qn=!1}set readTime(t){this.Gn=t}get readTime(){return this.Gn}zn(t,e){this.Hn(),this.readTime=e,this.jn.set(t.key,t)}Jn(t,e){this.Hn(),e&&(this.readTime=e),this.jn.set(t,null)}Yn(t,e){this.Hn();const n=this.jn.get(e);return void 0!==n?Bo.resolve(n):this.Xn(t,e)}getEntries(t,e){return this.Zn(t,e)}apply(t){return this.Hn(),this.Qn=!0,this.ts(t)}Hn(){}}const zo="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ho{constructor(){this.es=[]}ns(t){this.es.push(t)}ss(){this.es.forEach(t=>t())}}class Wo{constructor(t,e,n){this.rs=t,this.os=e,this.hs=n}as(t,e){return this.os.us(t,e).next(n=>this.cs(t,e,n))}cs(t,e,n){return this.rs.Yn(t,e).next(t=>{for(const s of n)t=s.vn(e,t);return t})}ls(t,e,n){let s=fr();return e.forEach((t,e)=>{for(const s of n)e=s.vn(t,e);s=s._t(t,e)}),s}_s(t,e){return this.rs.getEntries(t,e).next(e=>this.fs(t,e))}fs(t,e){return this.os.ds(t,e).next(n=>{const s=this.ls(t,e,n);let r=lr();return s.forEach((t,e)=>{e||(e=new ho(t,Vs.min())),r=r._t(t,e)}),r})}ws(t,e,n){return function(t){return js.Z(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Ts(t,e.path):mo(e)?this.Es(t,e,n):this.Is(t,e,n)}Ts(t,e){return this.as(t,new js(e)).next(t=>{let e=pr();return t instanceof uo&&(e=e._t(t.key,t)),e})}Es(t,e,n){const s=e.collectionGroup;let r=pr();return this.hs.As(t,s).next(i=>Bo.forEach(i,i=>{const o=e.wn(i.child(s));return this.Is(t,o,n).next(t=>{t.forEach((t,e)=>{r=r._t(t,e)})})}).next(()=>r))}Is(t,e,n){let s,r;return this.rs.ws(t,e,n).next(n=>(s=n,this.os.Rs(t,e))).next(e=>(r=e,this.ms(t,r,s).next(t=>{s=t;for(const t of r)for(const e of t.mutations){const n=e.key,r=s.get(n),i=Hi(e,r,r,t.yn);s=i instanceof uo?s._t(n,i):s.remove(n)}}))).next(()=>(s.forEach((t,n)=>{Io(e,n)||(s=s.remove(t))}),s))}ms(t,e,n){let s=yr();for(const t of e)for(const e of t.mutations)e instanceof Yi&&null===n.get(e.key)&&(s=s.add(e.key));let r=n;return this.rs.getEntries(t,s).next(t=>(t.forEach((t,e)=>{null!==e&&e instanceof uo&&(r=r._t(t,e))}),r))}}class Ko{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Ps=n,this.Vs=s}static gs(t,e){let n=yr(),s=yr();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new Ko(t,e.fromCache,n,s)}}class Qo{constructor(t,e){this.previousValue=t,e&&(e.ys=(t=>this.ps(t)),this.bs=(t=>e.vs(t)))}ps(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.bs&&this.bs(t),t}}Qo.Ss=-1;class Xo{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class Yo{constructor(t,e,n=1e3,s=1.5,r=6e4){this.Cs=t,this.Ds=e,this.Ns=n,this.xs=s,this.ks=r,this.Os=0,this.Fs=null,this.Ms=Date.now(),this.reset()}reset(){this.Os=0}$s(){this.Os=this.ks}Ls(t){this.cancel();const e=Math.floor(this.Os+this.qs()),n=Math.max(0,Date.now()-this.Ms),s=Math.max(0,e-n);s>0&&vs("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Os} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Fs=this.Cs.Bs(this.Ds,s,()=>(this.Ms=Date.now(),t())),this.Os*=this.xs,this.Os<this.Ns&&(this.Os=this.Ns),this.Os>this.ks&&(this.Os=this.ks)}Us(){null!==this.Fs&&(this.Fs.Ws(),this.Fs=null)}cancel(){null!==this.Fs&&(this.Fs.cancel(),this.Fs=null)}qs(){return(Math.random()-.5)*this.Os}}class Jo{constructor(t,e,n){this.name=t,this.version=e,this.Ks=n,12.2===Jo.js(s())&&bs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return vs("SimpleDb","Removing database:",t),ra(window.indexedDB.deleteDatabase(t)).Bn()}static Qs(){if("undefined"==typeof indexedDB)return!1;if(Jo.Gs())return!0;const t=s(),e=Jo.js(t),n=0<e&&e<10,r=Jo.zs(t),i=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static Gs(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Hs)}static Js(t,e){return t.store(e)}static js(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static zs(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Ys(){return this.db||(vs("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,e)=>{const n=indexedDB.open(this.name,this.version);n.onsuccess=(e=>{const n=e.target.result;t(n)}),n.onblocked=(()=>{e(new ta("Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))}),n.onerror=(t=>{const n=t.target.error;"VersionError"===n.name?e(new Ss(As.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):e(new ta(n))}),n.onupgradeneeded=(t=>{vs("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.Ks.createOrUpgrade(e,n.transaction,t.oldVersion,this.version).next(()=>{vs("SimpleDb","Database upgrade to version "+this.version+" complete")})})})),this.Xs&&(this.db.onversionchange=(t=>this.Xs(t))),this.db}Zs(t){this.Xs=t,this.db&&(this.db.onversionchange=(e=>t(e)))}async runTransaction(t,e,n){const s="readonly"===t;for(;;){0;try{this.db=await this.Ys();const r=na.open(this.db,s?"readonly":"readwrite",e),i=n(r).catch(t=>(r.abort(t),Bo.reject(t))).Bn();return i.catch(()=>{}),await r.ti,i}catch(t){const e="FirebaseError"!==t.name&&i<3;if(vs("SimpleDb","Transaction failed with error: %s. Retrying: %s.",t.message,e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Zo{constructor(t){this.ei=t,this.ni=!1,this.si=null}get Mn(){return this.ni}get ii(){return this.si}set cursor(t){this.ei=t}done(){this.ni=!0}ri(t){this.si=t}delete(){return ra(this.ei.delete())}}class ta extends Ss{constructor(t){super(As.UNAVAILABLE,"IndexedDB transaction failed: "+t),this.name="IndexedDbTransactionError"}}function ea(t){return"IndexedDbTransactionError"===t.name}class na{constructor(t){this.transaction=t,this.aborted=!1,this.oi=new Xo,this.transaction.oncomplete=(()=>{this.oi.resolve()}),this.transaction.onabort=(()=>{t.error?this.oi.reject(new ta(t.error)):this.oi.resolve()}),this.transaction.onerror=(t=>{const e=oa(t.target.error);this.oi.reject(new ta(e))})}static open(t,e,n){try{return new na(t.transaction(n,e))}catch(t){throw new ta(t)}}get ti(){return this.oi.promise}abort(t){t&&this.oi.reject(t),this.aborted||(vs("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new sa(e)}}class sa{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(vs("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(vs("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ra(n)}add(t){return vs("SimpleDb","ADD",this.store.name,t,t),ra(this.store.add(t))}get(t){return ra(this.store.get(t)).next(e=>(void 0===e&&(e=null),vs("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return vs("SimpleDb","DELETE",this.store.name,t),ra(this.store.delete(t))}count(){return vs("SimpleDb","COUNT",this.store.name),ra(this.store.count())}hi(t,e){const n=this.cursor(this.options(t,e)),s=[];return this.ai(n,(t,e)=>{s.push(e)}).next(()=>s)}ui(t,e){vs("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.ci=!1;const s=this.cursor(n);return this.ai(s,(t,e,n)=>n.delete())}li(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.ai(s,e)}_i(t){const e=this.cursor({});return new Bo((n,s)=>{e.onerror=(t=>{const e=oa(t.target.error);s(e)}),e.onsuccess=(e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next(t=>{t?s.continue():n()}):n()})})}ai(t,e){const n=[];return new Bo((s,r)=>{t.onerror=(t=>{r(t.target.error)}),t.onsuccess=(t=>{const r=t.target.result;if(!r)return void s();const i=new Zo(r),o=e(r.primaryKey,r.value,i);if(o instanceof Bo){const t=o.catch(t=>(i.done(),Bo.reject(t)));n.push(t)}i.Mn?s():null===i.ii?r.continue():r.continue(i.ii)})}).next(()=>Bo.Wn(n))}options(t,e){let n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.ci?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function ra(t){return new Bo((e,n)=>{t.onsuccess=(t=>{const n=t.target.result;e(n)}),t.onerror=(t=>{const e=oa(t.target.error);n(e)})})}let ia=!1;function oa(t){const e=Jo.js(s());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Ss("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ia||(ia=!0,setTimeout(()=>{throw t},0)),t}}return t}function aa(){return"undefined"!=typeof window?window:null}class ua{constructor(t,e,n,s,r){this.fi=t,this.Ds=e,this.di=n,this.op=s,this.wi=r,this.Ti=new Xo,this.then=this.Ti.promise.then.bind(this.Ti.promise),this.Ti.promise.catch(t=>{})}static Ei(t,e,n,s,r){const i=Date.now()+n,o=new ua(t,e,i,s,r);return o.start(n),o}start(t){this.Ii=setTimeout(()=>this.Ai(),t)}Ws(){return this.Ai()}cancel(t){null!==this.Ii&&(this.clearTimeout(),this.Ti.reject(new Ss(As.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}Ai(){this.fi.Ri(()=>null!==this.Ii?(this.clearTimeout(),this.op().then(t=>this.Ti.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.Ii&&(this.wi(this),clearTimeout(this.Ii),this.Ii=null)}}class ha{constructor(){this.mi=Promise.resolve(),this.Pi=[],this.Vi=!1,this.gi=[],this.yi=null,this.pi=!1,this.bi=[],this.vi=new Yo(this,"async_queue_retry"),this.Si=(()=>this.vi.Us());const t=aa();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Si)}get Ci(){return this.Vi}Ri(t){this.enqueue(t)}Di(t){this.Ni(),this.xi(t)}ki(t){return this.Ni(),this.xi(t)}async Oi(t){if(this.Ni(),!this.Vi){this.Vi=!0;const e=aa();e&&e.removeEventListener("visibilitychange",this.Si),await this.ki(t)}}enqueue(t){return this.Ni(),this.Vi?new Promise(t=>{}):this.xi(t)}Fi(t){this.Pi.push(t),this.Ri(()=>this.Mi())}async Mi(){if(0!==this.Pi.length){try{await this.Pi[0](),this.Pi.shift(),this.vi.reset()}catch(t){if(!ea(t))throw t;vs("AsyncQueue","Operation failed with retryable error: "+t)}this.Pi.length>0&&this.vi.Ls(()=>this.Mi())}}xi(t){const e=this.mi.then(()=>(this.pi=!0,t().catch(t=>{throw this.yi=t,this.pi=!1,bs("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.pi=!1,t))));return this.mi=e,e}Bs(t,e,n){this.Ni(),this.bi.indexOf(t)>-1&&(e=0);const s=ua.Ei(this,t,e,n,t=>this.$i(t));return this.gi.push(s),s}Ni(){this.yi&&Ts()}Li(){}async qi(){let t;do{t=this.mi,await t}while(t!==this.mi)}Bi(t){for(const e of this.gi)if(e.Ds===t)return!0;return!1}Ui(t){return this.qi().then(()=>{this.gi.sort((t,e)=>t.di-e.di);for(const e of this.gi)if(e.Ws(),"all"!==t&&e.Ds===t)break;return this.qi()})}Wi(t){this.bi.push(t)}$i(t){const e=this.gi.indexOf(t);this.gi.splice(e,1)}}function ca(t,e){if(bs("AsyncQueue",`${e}: ${t}`),ea(t))return new Ss(As.UNAVAILABLE,`${e}: ${t}`);throw t}function la([t,e],[n,s]){const r=Rs(t,n);return 0===r?Rs(e,s):r}class fa{constructor(t){this.Ki=t,this.buffer=new ur(la),this.ji=0}Qi(){return++this.ji}Gi(t){const e=[t,this.Qi()];if(this.buffer.size<this.Ki)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();la(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}const da={zi:!1,Hi:0,Ji:0,Yi:0};class pa{constructor(t,e,n){this.Xi=t,this.Zi=e,this.tr=n}static er(t){return new pa(t,pa.nr,pa.sr)}}pa.ir=-1,pa.rr=1048576,pa.or=41943040,pa.nr=10,pa.sr=1e3,pa.hr=new pa(pa.or,pa.nr,pa.sr),pa.ar=new pa(pa.ir,0,0);class ga{constructor(t,e){this.ur=t,this.fi=e,this.cr=!1,this.lr=null}start(t){this.ur.params.Xi!==pa.ir&&this._r(t)}stop(){this.lr&&(this.lr.cancel(),this.lr=null)}get dr(){return null!==this.lr}_r(t){const e=this.cr?3e5:6e4;vs("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.lr=this.fi.Bs("lru_garbage_collection",e,async()=>{this.lr=null,this.cr=!0;try{await t.wr(this.ur)}catch(t){ea(t)?vs("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Nu(t)}await this._r(t)})}}class ma{constructor(t,e){this.Tr=t,this.params=e}Er(t,e){return this.Tr.Ir(t).next(t=>Math.floor(e/100*t))}Ar(t,e){if(0===e)return Bo.resolve(Qo.Ss);const n=new fa(e);return this.Tr.Fe(t,t=>n.Gi(t.sequenceNumber)).next(()=>this.Tr.Rr(t,t=>n.Gi(t))).next(()=>n.maxValue)}mr(t,e,n){return this.Tr.mr(t,e,n)}Pr(t,e){return this.Tr.Pr(t,e)}Vr(t,e){return this.params.Xi===pa.ir?(vs("LruGarbageCollector","Garbage collection skipped; disabled"),Bo.resolve(da)):this.gr(t).next(n=>n<this.params.Xi?(vs("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold `+this.params.Xi),da):this.yr(t,e))}gr(t){return this.Tr.gr(t)}yr(t,e){let n,s,r,i,o,a,h;const c=Date.now();return this.Er(t,this.params.Zi).next(e=>(e>this.params.tr?(vs("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.tr} from `+e),s=this.params.tr):s=e,i=Date.now(),this.Ar(t,s))).next(s=>(n=s,o=Date.now(),this.mr(t,n,e))).next(e=>(r=e,a=Date.now(),this.Pr(t,n))).next(t=>(h=Date.now(),ws()<=u.DEBUG&&vs("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-c}ms\n\tDetermined least recently used ${s} in `+(o-i)+"ms\n"+`\tRemoved ${r} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(h-a)+"ms\n"+`Total Duration: ${h-c}ms`),Bo.resolve({zi:!0,Hi:s,Ji:r,Yi:t})))}}function ya(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=va(e)),e=wa(t.get(n),e);return va(e)}function wa(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function va(t){return t+""}function ba(t){const e=t.length;if(_s(e>=2),2===e)return _s(""===t.charAt(0)&&""===t.charAt(1)),Ms.K();const n=e-2,s=[];let r="";for(let n=0;n<e;){const e=t.indexOf("",n);switch((e<0||e>i)&&Ts(),t.charAt(e+1)){case"":const i=t.substring(n,e);let o;0===r.length?o=i:(o=r+=i,r=""),s.push(o);break;case"":r+=t.substring(n,e),r+="\0";break;case"":r+=t.substring(n,e+1);break;default:Ts()}n=e+2}return new Ms(s)}class Ea{constructor(t){this.pr=t}}function Ia(t,e){if(e.document)return function(t,e,n){const s=li(t,e.name),r=ai(e.updateTime),i=new ro({mapValue:{fields:e.fields}});return new uo(s,r,i,{hasCommittedMutations:!!n})}(t.pr,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=js.tt(e.noDocument.path),n=Sa(e.noDocument.readTime);return new ho(t,n,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){const t=js.tt(e.unknownDocument.path),n=Sa(e.unknownDocument.version);return new co(t,n)}return Ts()}function Ta(t,e,n){const s=_a(n),r=e.key.path.O().B();if(e instanceof uo){const n=function(t,e){return{name:ci(t,e.key),fields:e.cn().mapValue.fields,updateTime:ii(t,e.version.S())}}(t.pr,e),i=e.hasCommittedMutations;return new Ja(null,null,n,i,s,r)}if(e instanceof ho){const t=e.key.path.B(),n=Aa(e.version),i=e.hasCommittedMutations;return new Ja(null,new Xa(t,n),null,i,s,r)}if(e instanceof co){const t=e.key.path.B(),n=Aa(e.version);return new Ja(new Ya(t,n),null,null,!0,s,r)}return Ts()}function _a(t){const e=t.S();return[e.seconds,e.nanoseconds]}function Na(t){const e=new Ps(t[0],t[1]);return Vs.g(e)}function Aa(t){const e=t.S();return new za(e.seconds,e.nanoseconds)}function Sa(t){const e=new Ps(t.seconds,t.nanoseconds);return Vs.g(e)}function Da(t,e){const n=(e.baseMutations||[]).map(e=>wi(t.pr,e)),s=e.mutations.map(e=>wi(t.pr,e)),r=Ps.fromMillis(e.localWriteTimeMs);return new qo(e.batchId,r,n,s)}function xa(t){const e=Sa(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Sa(t.lastLimboFreeSnapshotVersion):Vs.min();let s;var r;return void 0!==t.query.documents?(_s(1===(r=t.query).documents.length),s=wo(go(di(r.documents[0])))):s=Ei(t.query),new Zs(s,t.targetId,0,t.lastListenSequenceNumber,e,n,Js.fromBase64String(t.resumeToken))}function Oa(t,e){const n=Aa(e.at),s=Aa(e.lastLimboFreeSnapshotVersion);let r;r=Ys(e.target)?vi(t.pr,e.target):bi(t.pr,e.target);const i=e.resumeToken.toBase64();return new tu(e.targetId,Qs(e.target),n,i,e.sequenceNumber,s,r)}class La{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.hs=n,this.br=s,this.vr={}}static Sr(t,e,n,s){_s(""!==t.uid);const r=t.t()?t.uid:"";return new La(r,e,n,s)}Cr(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ca(t).li({index:Ka.userMutationsIndex,range:n},(t,n,s)=>{e=!1,s.done()}).next(()=>e)}Dr(t,e,n,s){const r=Pa(t),i=Ca(t);return i.add({}).next(o=>{_s("number"==typeof o);const a=new qo(o,e,n,s),u=function(t,e,n){const s=n.baseMutations.map(e=>yi(t.pr,e)),r=n.mutations.map(e=>yi(t.pr,e));return new Ka(e,n.batchId,n.yn.toMillis(),s,r)}(this.serializer,this.userId,a),h=[];let c=new ur((t,e)=>Rs(t.U(),e.U()));for(const t of s){const e=Qa.key(this.userId,t.key.path,o);c=c.add(t.key.path.O()),h.push(i.put(u)),h.push(r.put(e,Qa.PLACEHOLDER))}return c.forEach(e=>{h.push(this.hs.Nr(t,e))}),t.ns(()=>{this.vr[o]=a.keys()}),Bo.Wn(h).next(()=>a)})}xr(t,e){return Ca(t).get(e).next(t=>t?(_s(t.userId===this.userId),Da(this.serializer,t)):null)}kr(t,e){return this.vr[e]?Bo.resolve(this.vr[e]):this.xr(t,e).next(t=>{if(t){const n=t.keys();return this.vr[e]=n,n}return null})}Or(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let r=null;return Ca(t).li({index:Ka.userMutationsIndex,range:s},(t,e,s)=>{e.userId===this.userId&&(_s(e.batchId>=n),r=Da(this.serializer,e)),s.done()}).next(()=>r)}Fr(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return Ca(t).li({index:Ka.userMutationsIndex,range:e,reverse:!0},(t,e,s)=>{n=e.batchId,s.done()}).next(()=>n)}Mr(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ca(t).hi(Ka.userMutationsIndex,e).next(t=>t.map(t=>Da(this.serializer,t)))}us(t,e){const n=Qa.prefixForPath(this.userId,e.path),s=IDBKeyRange.lowerBound(n),r=[];return Pa(t).li({range:s},(n,s,i)=>{const[o,a,u]=n,h=ba(a);if(o===this.userId&&e.path.isEqual(h))return Ca(t).get(u).next(t=>{if(!t)throw Ts();_s(t.userId===this.userId),r.push(Da(this.serializer,t))});i.done()}).next(()=>r)}ds(t,e){let n=new ur(Rs);const s=[];return e.forEach(e=>{const r=Qa.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=Pa(t).li({range:i},(t,s,r)=>{const[i,o,a]=t,u=ba(o);i===this.userId&&e.path.isEqual(u)?n=n.add(a):r.done()});s.push(o)}),Bo.Wn(s).next(()=>this.$r(t,n))}Rs(t,e){const n=e.path,s=n.length+1,r=Qa.prefixForPath(this.userId,n),i=IDBKeyRange.lowerBound(r);let o=new ur(Rs);return Pa(t).li({range:i},(t,e,r)=>{const[i,a,u]=t,h=ba(a);i===this.userId&&n.L(h)?h.length===s&&(o=o.add(u)):r.done()}).next(()=>this.$r(t,o))}$r(t,e){const n=[],s=[];return e.forEach(e=>{s.push(Ca(t).get(e).next(t=>{if(null===t)throw Ts();_s(t.userId===this.userId),n.push(Da(this.serializer,t))}))}),Bo.Wn(s).next(()=>n)}Lr(t,e){return ka(t.qr,this.userId,e).next(n=>(t.ns(()=>{this.Br(e.batchId)}),Bo.forEach(n,e=>this.br.Ur(t,e))))}Br(t){delete this.vr[t]}Wr(t){return this.Cr(t).next(e=>{if(!e)return Bo.resolve();const n=IDBKeyRange.lowerBound(Qa.prefixForUser(this.userId)),s=[];return Pa(t).li({range:n},(t,e,n)=>{if(t[0]===this.userId){const e=ba(t[1]);s.push(e)}else n.done()}).next(()=>{_s(0===s.length)})})}Kr(t,e){return Ra(t,this.userId,e)}jr(t){return Va(t).get(this.userId).next(t=>t||new Wa(this.userId,-1,""))}}function Ra(t,e,n){const s=Qa.prefixForPath(e,n.path),r=s[1],i=IDBKeyRange.lowerBound(s);let o=!1;return Pa(t).li({range:i,ci:!0},(t,n,s)=>{const[i,a,u]=t;i===e&&a===r&&(o=!0),s.done()}).next(()=>o)}function ka(t,e,n){const s=t.store(Ka.store),r=t.store(Qa.store),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const u=s.li({range:o},(t,e,n)=>(a++,n.delete()));i.push(u.next(()=>{_s(1===a)}));const h=[];for(const t of n.mutations){const s=Qa.key(e,t.key.path,n.batchId);i.push(r.delete(s)),h.push(t.key)}return Bo.Wn(i).next(()=>h)}function Ca(t){return mu.Js(t,Ka.store)}function Pa(t){return mu.Js(t,Qa.store)}function Va(t){return mu.Js(t,Wa.store)}class Ua{constructor(t,e){this.serializer=t,this.hs=e}zn(t,e,n){return Fa(t).put(qa(e),n)}Jn(t,e){const n=Fa(t),s=qa(e);return n.delete(s)}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.Qr(t,n)))}Yn(t,e){return Fa(t).get(qa(e)).next(t=>this.Gr(t))}zr(t,e){return Fa(t).get(qa(e)).next(t=>{const e=this.Gr(t);return e?{Hr:e,size:ja(t)}:null})}getEntries(t,e){let n=fr();return this.Jr(t,e,(t,e)=>{const s=this.Gr(e);n=n._t(t,s)}).next(()=>n)}Yr(t,e){let n=fr(),s=new ir(js.D);return this.Jr(t,e,(t,e)=>{const r=this.Gr(e);r?(n=n._t(t,r),s=s._t(t,ja(e))):(n=n._t(t,null),s=s._t(t,0))}).next(()=>({Xr:n,Zr:s}))}Jr(t,e,n){if(e.$())return Bo.resolve();const s=IDBKeyRange.bound(e.first().path.B(),e.last().path.B()),r=e.It();let i=r.yt();return Fa(t).li({range:s},(t,e,s)=>{const o=js.tt(t);for(;i&&js.D(i,o)<0;)n(i,null),i=r.yt();i&&i.isEqual(o)&&(n(i,e),i=r.pt()?r.yt():null),i?s.ri(i.path.B()):s.done()}).next(()=>{for(;i;)n(i,null),i=r.pt()?r.yt():null})}ws(t,e,n){let s=pr();const r=e.path.length+1,i={};if(n.isEqual(Vs.min())){const t=e.path.B();i.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.B(),s=_a(n);i.range=IDBKeyRange.lowerBound([t,s],!0),i.index=Ja.collectionReadTimeIndex}return Fa(t).li(i,(t,n,i)=>{if(t.length!==r)return;const o=Ia(this.serializer,n);e.path.L(o.key.path)?o instanceof uo&&Io(e,o)&&(s=s._t(o.key,o)):i.done()}).next(()=>s)}to(t,e){let n=lr(),s=_a(e);const r=Fa(t),i=IDBKeyRange.lowerBound(s,!0);return r.li({index:Ja.readTimeIndex,range:i},(t,e)=>{const r=Ia(this.serializer,e);n=n._t(r.key,r),s=e.readTime}).next(()=>({eo:n,readTime:Na(s)}))}no(t){const e=Fa(t);let n=Vs.min();return e.li({index:Ja.readTimeIndex,reverse:!0},(t,e,s)=>{e.readTime&&(n=Na(e.readTime)),s.done()}).next(()=>n)}so(t){return new Ua.io(this,!!t&&t.ro)}oo(t){return this.getMetadata(t).next(t=>t.byteSize)}getMetadata(t){return Ma(t).get(Za.key).next(t=>(_s(!!t),t))}Qr(t,e){return Ma(t).put(Za.key,e)}Gr(t){if(t){const e=Ia(this.serializer,t);return e instanceof ho&&e.version.isEqual(Vs.min())?null:e}return null}}function Ma(t){return mu.Js(t,Za.store)}function Fa(t){return mu.Js(t,Ja.store)}function qa(t){return t.path.B()}function ja(t){let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Ts();e=t.noDocument}return JSON.stringify(e).length}Ua.io=class extends Go{constructor(t,e){super(),this.ho=t,this.ro=e,this.ao=new $o(t=>t.toString(),(t,e)=>t.isEqual(e))}ts(t){const e=[];let n=0,s=new ur((t,e)=>Rs(t.U(),e.U()));return this.jn.forEach((r,i)=>{const o=this.ao.get(r);if(i){const a=Ta(this.ho.serializer,i,this.readTime);s=s.add(r.path.O());const u=ja(a);n+=u-o,e.push(this.ho.zn(t,r,a))}else if(n-=o,this.ro){const n=Ta(this.ho.serializer,new ho(r,Vs.min()),this.readTime);e.push(this.ho.zn(t,r,n))}else e.push(this.ho.Jn(t,r))}),s.forEach(n=>{e.push(this.ho.hs.Nr(t,n))}),e.push(this.ho.updateMetadata(t,n)),Bo.Wn(e)}Xn(t,e){return this.ho.zr(t,e).next(t=>null===t?(this.ao.set(e,0),null):(this.ao.set(e,t.size),t.Hr))}Zn(t,e){return this.ho.Yr(t,e).next(({Xr:t,Zr:e})=>(e.forEach((t,e)=>{this.ao.set(t,e)}),t))}};class $a{constructor(){this.uo=new Ba}Nr(t,e){return this.uo.add(e),Bo.resolve()}As(t,e){return Bo.resolve(this.uo.getEntries(e))}}class Ba{constructor(){this.index={}}add(t){const e=t.M(),n=t.O(),s=this.index[e]||new ur(Ms.D),r=!s.has(n);return this.index[e]=s.add(n),r}has(t){const e=t.M(),n=t.O(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new ur(Ms.D)).B()}}class Ga{constructor(t){this.serializer=t}createOrUpgrade(t,e,n,s){_s(n<s&&n>=0&&s<=10);const r=new na(e);n<1&&s>=1&&(function(t){t.createObjectStore(Ha.store)}(t),function(t){t.createObjectStore(Wa.store,{keyPath:Wa.keyPath}),t.createObjectStore(Ka.store,{keyPath:Ka.keyPath,autoIncrement:!0}).createIndex(Ka.userMutationsIndex,Ka.userMutationsKeyPath,{unique:!0}),t.createObjectStore(Qa.store)}(t),ru(t),function(t){t.createObjectStore(Ja.store)}(t));let i=Bo.resolve();return n<3&&s>=3&&(0!==n&&(function(t){t.deleteObjectStore(eu.store),t.deleteObjectStore(tu.store),t.deleteObjectStore(nu.store)}(t),ru(t)),i=i.next(()=>(function(t){const e=r.store(nu.store),n=new nu(0,0,Vs.min().S(),0);return e.put(nu.key,n)})())),n<4&&s>=4&&(0!==n&&(i=i.next(()=>(function(t,e){return e.store(Ka.store).hi().next(n=>{t.deleteObjectStore(Ka.store),t.createObjectStore(Ka.store,{keyPath:Ka.keyPath,autoIncrement:!0}).createIndex(Ka.userMutationsIndex,Ka.userMutationsKeyPath,{unique:!0});const s=e.store(Ka.store),r=n.map(t=>s.put(t));return Bo.Wn(r)})})(t,r))),i=i.next(()=>{!function(t){t.createObjectStore(iu.store,{keyPath:iu.keyPath})}(t)})),n<5&&s>=5&&(i=i.next(()=>this.removeAcknowledgedMutations(r))),n<6&&s>=6&&(i=i.next(()=>((function(t){t.createObjectStore(Za.store)})(t),this.addDocumentGlobal(r)))),n<7&&s>=7&&(i=i.next(()=>this.ensureSequenceNumbers(r))),n<8&&s>=8&&(i=i.next(()=>this.createCollectionParentIndex(t,r))),n<9&&s>=9&&(i=i.next(()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(Ja.store);e.createIndex(Ja.readTimeIndex,Ja.readTimeIndexPath,{unique:!1}),e.createIndex(Ja.collectionReadTimeIndex,Ja.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&s>=10&&(i=i.next(()=>this.rewriteCanonicalIds(r))),i}addDocumentGlobal(t){let e=0;return t.store(Ja.store).li((t,n)=>{e+=ja(n)}).next(()=>{const n=new Za(e);return t.store(Za.store).put(Za.key,n)})}removeAcknowledgedMutations(t){const e=t.store(Wa.store),n=t.store(Ka.store);return e.hi().next(e=>Bo.forEach(e,e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.hi(Ka.userMutationsIndex,s).next(n=>Bo.forEach(n,n=>{_s(n.userId===e.userId);const s=Da(this.serializer,n);return ka(t,e.userId,s).next(()=>{})}))}))}ensureSequenceNumbers(t){const e=t.store(eu.store),n=t.store(Ja.store);return t.store(nu.store).get(nu.key).next(t=>{const s=[];return n.li((n,r)=>{const i=new Ms(n),o=function(t){return[0,ya(i)]}();s.push(e.get(o).next(n=>n?Bo.resolve():(n=>e.put(new eu(0,ya(n),t.highestListenSequenceNumber)))(i)))}).next(()=>Bo.Wn(s))})}createCollectionParentIndex(t,e){t.createObjectStore(su.store,{keyPath:su.keyPath});const n=e.store(su.store),s=new Ba,r=t=>{if(s.add(t)){const e=t.M(),s=t.O();return n.put({collectionId:e,parent:ya(s)})}};return e.store(Ja.store).li({ci:!0},(t,e)=>{const n=new Ms(t);return r(n.O())}).next(()=>e.store(Qa.store).li({ci:!0},([t,e,n],s)=>{const i=ba(e);return r(i.O())}))}rewriteCanonicalIds(t){const e=t.store(tu.store);return e.li((t,n)=>{const s=xa(n),r=Oa(this.serializer,s);return e.put(r)})}}class za{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class Ha{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}Ha.store="owner",Ha.key="owner";class Wa{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}Wa.store="mutationQueues",Wa.keyPath="userId";class Ka{constructor(t,e,n,s,r){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=s,this.mutations=r}}Ka.store="mutations",Ka.keyPath="batchId",Ka.userMutationsIndex="userMutationsIndex",Ka.userMutationsKeyPath=["userId","batchId"];class Qa{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,ya(e)]}static key(t,e,n){return[t,ya(e),n]}}Qa.store="documentMutations",Qa.PLACEHOLDER=new Qa;class Xa{constructor(t,e){this.path=t,this.readTime=e}}class Ya{constructor(t,e){this.path=t,this.version=e}}class Ja{constructor(t,e,n,s,r,i){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=s,this.readTime=r,this.parentPath=i}}Ja.store="remoteDocuments",Ja.readTimeIndex="readTimeIndex",Ja.readTimeIndexPath="readTime",Ja.collectionReadTimeIndex="collectionReadTimeIndex",Ja.collectionReadTimeIndexPath=["parentPath","readTime"];class Za{constructor(t){this.byteSize=t}}Za.store="remoteDocumentGlobal",Za.key="remoteDocumentGlobalKey";class tu{constructor(t,e,n,s,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=s,this.lastListenSequenceNumber=r,this.lastLimboFreeSnapshotVersion=i,this.query=o}}tu.store="targets",tu.keyPath="targetId",tu.queryTargetsIndexName="queryTargetsIndex",tu.queryTargetsKeyPath=["canonicalId","targetId"];class eu{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}eu.store="targetDocuments",eu.keyPath=["targetId","path"],eu.documentTargetsIndex="documentTargetsIndex",eu.documentTargetsKeyPath=["path","targetId"];class nu{constructor(t,e,n,s){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=s}}nu.key="targetGlobalKey",nu.store="targetGlobal";class su{constructor(t,e){this.collectionId=t,this.parent=e}}function ru(t){t.createObjectStore(eu.store,{keyPath:eu.keyPath}).createIndex(eu.documentTargetsIndex,eu.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(tu.store,{keyPath:tu.keyPath}).createIndex(tu.queryTargetsIndexName,tu.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(nu.store)}su.store="collectionParents",su.keyPath=["collectionId","parent"];class iu{constructor(t,e,n,s){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=s}}iu.store="clientMetadata",iu.keyPath="clientId";const ou=[...[...[...[Wa.store,Ka.store,Qa.store,Ja.store,tu.store,Ha.store,nu.store,eu.store],iu.store],Za.store],su.store];class au{constructor(){this.co=new Ba}Nr(t,e){if(!this.co.has(e)){const n=e.M(),s=e.O();t.ns(()=>{this.co.add(e)});const r={collectionId:n,parent:ya(s)};return uu(t).put(r)}return Bo.resolve()}As(t,e){const n=[],s=IDBKeyRange.bound([e,""],[Cs(e),""],!1,!0);return uu(t).hi(s).next(t=>{for(const s of t){if(s.collectionId!==e)break;n.push(ba(s.parent))}return n})}}function uu(t){return mu.Js(t,su.store)}class hu{constructor(t){this.lo=t}next(){return this.lo+=2,this.lo}static _o(){return new hu(0)}static fo(){return new hu(-1)}}class cu{constructor(t,e){this.br=t,this.serializer=e}do(t){return this.wo(t).next(e=>{const n=new hu(e.highestTargetId);return e.highestTargetId=n.next(),this.To(t,e).next(()=>e.highestTargetId)})}Eo(t){return this.wo(t).next(t=>Vs.g(new Ps(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}Io(t){return this.wo(t).next(t=>t.highestListenSequenceNumber)}Ao(t,e,n){return this.wo(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.S()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.To(t,s)))}Ro(t,e){return this.mo(t,e).next(()=>this.wo(t).next(n=>(n.targetCount+=1,this.Po(e,n),this.To(t,n))))}Vo(t,e){return this.mo(t,e)}yo(t,e){return this.po(t,e.targetId).next(()=>lu(t).delete(e.targetId)).next(()=>this.wo(t)).next(e=>(_s(e.targetCount>0),e.targetCount-=1,this.To(t,e)))}mr(t,e,n){let s=0;const r=[];return lu(t).li((i,o)=>{const a=xa(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(s++,r.push(this.yo(t,a)))}).next(()=>Bo.Wn(r)).next(()=>s)}Fe(t,e){return lu(t).li((t,n)=>{const s=xa(n);e(s)})}wo(t){return fu(t).get(nu.key).next(t=>(_s(null!==t),t))}To(t,e){return fu(t).put(nu.key,e)}mo(t,e){return lu(t).put(Oa(this.serializer,e))}Po(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}bo(t){return this.wo(t).next(t=>t.targetCount)}vo(t,e){const n=Qs(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let r=null;return lu(t).li({range:s,index:tu.queryTargetsIndexName},(t,n,s)=>{const i=xa(n);Xs(e,i.target)&&(r=i,s.done())}).next(()=>r)}So(t,e,n){const s=[],r=du(t);return e.forEach(e=>{const i=ya(e.path);s.push(r.put(new eu(n,i))),s.push(this.br.Co(t,n,e))}),Bo.Wn(s)}Do(t,e,n){const s=du(t);return Bo.forEach(e,e=>{const r=ya(e.path);return Bo.Wn([s.delete([n,r]),this.br.No(t,n,e)])})}po(t,e){const n=du(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}xo(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=du(t);let r=yr();return s.li({range:n,ci:!0},(t,e,n)=>{const s=ba(t[1]),i=new js(s);r=r.add(i)}).next(()=>r)}Kr(t,e){const n=ya(e.path),s=IDBKeyRange.bound([n],[Cs(n)],!1,!0);let r=0;return du(t).li({index:eu.documentTargetsIndex,ci:!0,range:s},([t,e],n,s)=>{0!==t&&(r++,s.done())}).next(()=>r>0)}Ge(t,e){return lu(t).get(e).next(t=>t?xa(t):null)}}function lu(t){return mu.Js(t,tu.store)}function fu(t){return mu.Js(t,nu.store)}function du(t){return mu.Js(t,eu.store)}const pu="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class gu extends Ho{constructor(t,e){super(),this.qr=t,this.ko=e}}class mu{constructor(t,e,n,s,r,i,o,a,u,h){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Cs=r,this.window=i,this.document=o,this.Oo=u,this.Fo=h,this.Mo=null,this.$o=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Lo=null,this.inForeground=!1,this.qo=null,this.Bo=null,this.Uo=Number.NEGATIVE_INFINITY,this.Wo=(t=>Promise.resolve()),!mu.Qs())throw new Ss(As.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.br=new vu(this,s),this.Ko=e+"main",this.serializer=new Ea(a),this.jo=new Jo(this.Ko,10,new Ga(this.serializer)),this.Qo=new cu(this.br,this.serializer),this.hs=new au,this.rs=new Ua(this.serializer,this.hs),this.window&&this.window.localStorage?this.Go=this.window.localStorage:(this.Go=null,!1===h&&bs("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}static Js(t,e){if(t instanceof gu)return Jo.Js(t.qr,e);throw Ts()}start(){return this.zo().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Ss(As.FAILED_PRECONDITION,pu);return this.Ho(),this.Jo(),this.Yo(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Qo.Io(t))}).then(t=>{this.Mo=new Qo(t,this.Oo)}).then(()=>{this.$o=!0}).catch(t=>(this.jo&&this.jo.close(),Promise.reject(t)))}Xo(t){return this.Wo=(async e=>{if(this.dr)return t(e)}),t(this.isPrimary)}Zo(t){this.jo.Zs(async e=>{null===e.newVersion&&await t()})}th(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Cs.Ri(async()=>{this.dr&&await this.zo()}))}zo(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>wu(t).put(new iu(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.eh(t).next(t=>{t||(this.isPrimary=!1,this.Cs.Fi(()=>this.Wo(!1)))})}).next(()=>this.nh(t)).next(e=>this.isPrimary&&!e?this.sh(t).next(()=>!1):!!e&&this.ih(t).next(()=>!0))).catch(t=>{if(ea(t))return vs("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return vs("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.Cs.Fi(()=>this.Wo(t)),this.isPrimary=t})}eh(t){return yu(t).get(Ha.key).next(t=>Bo.resolve(this.rh(t)))}oh(t){return wu(t).delete(this.clientId)}async hh(){if(this.isPrimary&&!this.ah(this.Uo,18e5)){this.Uo=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const e=mu.Js(t,iu.store);return e.hi().next(t=>{const n=this.uh(t,18e5),s=t.filter(t=>-1===n.indexOf(t));return Bo.forEach(s,t=>e.delete(t.clientId)).next(()=>s)})}).catch(()=>[]);if(this.Go)for(const e of t)this.Go.removeItem(this.lh(e.clientId))}}Yo(){this.Bo=this.Cs.Bs("client_metadata_refresh",4e3,()=>this.zo().then(()=>this.hh()).then(()=>this.Yo()))}rh(t){return!!t&&t.ownerId===this.clientId}nh(t){return this.Fo?Bo.resolve(!0):yu(t).get(Ha.key).next(e=>{if(null!==e&&this.ah(e.leaseTimestampMs,5e3)&&!this._h(e.ownerId)){if(this.rh(e)&&this.networkEnabled)return!0;if(!this.rh(e)){if(!e.allowTabSynchronization)throw new Ss(As.FAILED_PRECONDITION,pu);return!1}}return!(!this.networkEnabled||!this.inForeground)||wu(t).hi().next(t=>void 0===this.uh(t,5e3).find(t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&vs("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async fh(){this.$o=!1,this.dh(),this.Bo&&(this.Bo.cancel(),this.Bo=null),this.wh(),this.Th(),await this.runTransaction("shutdown","readwrite",t=>this.sh(t).next(()=>this.oh(t))).catch(t=>{vs("IndexedDbPersistence","Proceeding with shutdown despite failure: ",t)}),this.jo.close(),this.Eh()}uh(t,e){return t.filter(t=>this.ah(t.updateTimeMs,e)&&!this._h(t.clientId))}Ih(){return this.runTransaction("getActiveClients","readonly",t=>wu(t).hi().next(t=>this.uh(t,18e5).map(t=>t.clientId)))}get dr(){return this.$o}Ah(t){return La.Sr(t,this.serializer,this.hs,this.br)}Rh(){return this.Qo}mh(){return this.rs}Ph(){return this.hs}runTransaction(t,e,n){vs("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite";let r;return this.jo.runTransaction(s,ou,s=>(r=new gu(s,this.Mo?this.Mo.next():Qo.Ss),"readwrite-primary"===e?this.eh(r).next(t=>!!t||this.nh(r)).next(e=>{if(!e)throw bs(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Cs.Fi(()=>this.Wo(!1)),new Ss(As.FAILED_PRECONDITION,zo);return n(r)}).next(t=>this.ih(r).next(()=>t)):this.Vh(r).next(()=>n(r)))).then(t=>(r.ss(),t))}Vh(t){return yu(t).get(Ha.key).next(t=>{if(null!==t&&this.ah(t.leaseTimestampMs,5e3)&&!this._h(t.ownerId)&&!this.rh(t)&&!(this.Fo||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Ss(As.FAILED_PRECONDITION,pu)})}ih(t){const e=new Ha(this.clientId,this.allowTabSynchronization,Date.now());return yu(t).put(Ha.key,e)}static Qs(){return Jo.Qs()}sh(t){const e=yu(t);return e.get(Ha.key).next(t=>this.rh(t)?(vs("IndexedDbPersistence","Releasing primary lease."),e.delete(Ha.key)):Bo.resolve())}ah(t,e){const n=Date.now();return!(t<n-e||t>n&&(bs(`Detected an update time that is in the future: ${t} > ${n}`),1))}Ho(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qo=(()=>{this.Cs.Ri(()=>(this.inForeground="visible"===this.document.visibilityState,this.zo()))}),this.document.addEventListener("visibilitychange",this.qo),this.inForeground="visible"===this.document.visibilityState)}wh(){this.qo&&(this.document.removeEventListener("visibilitychange",this.qo),this.qo=null)}Jo(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Lo=(()=>{this.dh(),this.Cs.Ri(()=>this.fh())}),this.window.addEventListener("unload",this.Lo))}Th(){this.Lo&&(this.window.removeEventListener("unload",this.Lo),this.Lo=null)}_h(t){var e;try{const n=null!==(null===(e=this.Go)||void 0===e?void 0:e.getItem(this.lh(t)));return vs("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return bs("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}dh(){if(this.Go)try{this.Go.setItem(this.lh(this.clientId),String(Date.now()))}catch(t){bs("Failed to set zombie client id.",t)}}Eh(){if(this.Go)try{this.Go.removeItem(this.lh(this.clientId))}catch(t){}}lh(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function yu(t){return mu.Js(t,Ha.store)}function wu(t){return mu.Js(t,iu.store)}class vu{constructor(t,e){this.db=t,this.ur=new ma(this,e)}Ir(t){const e=this.gh(t);return this.db.Rh().bo(t).next(t=>e.next(e=>t+e))}gh(t){let e=0;return this.Rr(t,t=>{e++}).next(()=>e)}Fe(t,e){return this.db.Rh().Fe(t,e)}Rr(t,e){return this.yh(t,(t,n)=>e(n))}Co(t,e,n){return bu(t,n)}No(t,e,n){return bu(t,n)}mr(t,e,n){return this.db.Rh().mr(t,e,n)}Ur(t,e){return bu(t,e)}ph(t,e){return function(t,e){let n=!1;return Va(t)._i(s=>Ra(t,s,e).next(t=>(t&&(n=!0),Bo.resolve(!t)))).next(()=>n)}(t,e)}Pr(t,e){const n=this.db.mh().so(),s=[];let r=0;return this.yh(t,(i,o)=>{if(o<=e){const e=this.ph(t,i).next(e=>{if(!e)return r++,n.Yn(t,i).next(()=>(n.Jn(i),du(t).delete([0,ya(i.path)])))});s.push(e)}}).next(()=>Bo.Wn(s)).next(()=>n.apply(t)).next(()=>r)}removeTarget(t,e){const n=e.ut(t.ko);return this.db.Rh().Vo(t,n)}bh(t,e){return bu(t,e)}yh(t,e){const n=du(t);let s,r=Qo.Ss;return n.li({index:eu.documentTargetsIndex},([t,n],{path:i,sequenceNumber:o})=>{0===t?(r!==Qo.Ss&&e(new js(ba(s)),r),r=o,s=i):r=Qo.Ss}).next(()=>{r!==Qo.Ss&&e(new js(ba(s)),r)})}gr(t){return this.db.mh().oo(t)}}function bu(t,e){return du(t).put(function(t,e){return new eu(0,ya(t.path),e)}(e,t.ko))}function Eu(t,e){let n=t.projectId;return t.nt||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}async function Iu(t){if(!Jo.Qs())return Promise.resolve();const e=t+"main";await Jo.delete(e)}class Tu{constructor(t,e,n){this.persistence=t,this.vh=e,this.Sh=new ir(Rs),this.Ch=new $o(t=>Qs(t),Xs),this.Dh=Vs.min(),this.os=t.Ah(n),this.Nh=t.mh(),this.Qo=t.Rh(),this.xh=new Wo(this.Nh,this.os,this.persistence.Ph()),this.vh.kh(this.xh)}async Oh(t){let e=this.os,n=this.xh;const s=await this.persistence.runTransaction("Handle user change","readonly",s=>{let r;return this.os.Mr(s).next(i=>(r=i,e=this.persistence.Ah(t),n=new Wo(this.Nh,e,this.persistence.Ph()),e.Mr(s))).next(t=>{const e=[],i=[];let o=yr();for(const t of r){e.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const e of t){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n._s(s,o).next(t=>({Fh:t,Mh:e,$h:i}))})});return this.os=e,this.xh=n,this.vh.kh(this.xh),s}Lh(t){const e=Ps.now(),n=t.reduce((t,e)=>t.add(e.key),yr());let s;return this.persistence.runTransaction("Locally write mutations","readwrite",r=>this.xh._s(r,n).next(n=>{s=n;const i=[];for(const e of t){const t=Wi(e,s.get(e.key));null!=t&&i.push(new Yi(e.key,t,oo(t.proto.mapValue),$i.exists(!0)))}return this.os.Dr(r,e,i,t)})).then(t=>{const e=t.Sn(s);return{batchId:t.batchId,jn:e}})}qh(t){return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const n=t.batch.keys(),s=this.Nh.so({ro:!0});return this.Bh(e,t,s).next(()=>s.apply(e)).next(()=>this.os.Wr(e)).next(()=>this.xh._s(e,n))})}Uh(t){return this.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return this.os.xr(e,t).next(t=>(_s(null!==t),n=t.keys(),this.os.Lr(e,t))).next(()=>this.os.Wr(e)).next(()=>this.xh._s(e,n))})}Fr(){return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>this.os.Fr(t))}Eo(){return this.persistence.runTransaction("Get last remote snapshot version","readonly",t=>this.Qo.Eo(t))}Wh(t){const e=t.at;let n=this.Sh;return this.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const r=this.Nh.so({ro:!0});n=this.Sh;const i=[];t.Zt.forEach((t,r)=>{const o=n.get(r);if(!o)return;i.push(this.Qo.Do(s,t.ae,r).next(()=>this.Qo.So(s,t.oe,r)));const a=t.resumeToken;if(a.rt()>0){const u=o.ct(a,e).ut(s.ko);n=n._t(r,u),Tu.Kh(o,u,t)&&i.push(this.Qo.Vo(s,u))}});let o=lr(),a=yr();if(t.ee.forEach((t,e)=>{a=a.add(t)}),i.push(r.getEntries(s,a).next(n=>{t.ee.forEach((a,u)=>{const h=n.get(a);u instanceof ho&&u.version.isEqual(Vs.min())?(r.Jn(a,e),o=o._t(a,u)):null==h||u.version.p(h.version)>0||0===u.version.p(h.version)&&h.hasPendingWrites?(r.zn(u,e),o=o._t(a,u)):vs("LocalStore","Ignoring outdated watch update for ",a,". Current version:",h.version," Watch version:",u.version),t.ne.has(a)&&i.push(this.persistence.br.bh(s,a))})})),!e.isEqual(Vs.min())){const t=this.Qo.Eo(s).next(t=>this.Qo.Ao(s,s.ko,e));i.push(t)}return Bo.Wn(i).next(()=>r.apply(s)).next(()=>this.xh.fs(s,o))}).then(t=>(this.Sh=n,t))}static Kh(t,e,n){return _s(e.resumeToken.rt()>0),0===t.resumeToken.rt()||(e.at.v()-t.at.v()>=this.jh||n.oe.size+n.he.size+n.ae.size>0)}async Qh(t){try{await this.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>Bo.forEach(t,t=>Bo.forEach(t.Ps,n=>this.persistence.br.Co(e,t.targetId,n)).next(()=>Bo.forEach(t.Vs,n=>this.persistence.br.No(e,t.targetId,n)))))}catch(t){if(!ea(t))throw t;vs("LocalStore","Failed to update sequence numbers: "+t)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=this.Sh.get(t),n=e.at,s=e.lt(n);this.Sh=this.Sh._t(t,s)}}}Gh(t){return this.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=-1),this.os.Or(e,t)))}zh(t){return this.persistence.runTransaction("read document","readonly",e=>this.xh.as(e,t))}Hh(t){return this.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return this.Qo.vo(e,t).next(s=>s?(n=s,Bo.resolve(n)):this.Qo.do(e).next(s=>(n=new Zs(t,s,0,e.ko),this.Qo.Ro(e,n).next(()=>n))))}).then(e=>{const n=this.Sh.get(e.targetId);return(null===n||e.at.p(n.at)>0)&&(this.Sh=this.Sh._t(e.targetId,e),this.Ch.set(t,e.targetId)),e})}vo(t,e){const n=this.Ch.get(e);return void 0!==n?Bo.resolve(this.Sh.get(n)):this.Qo.vo(t,e)}async Jh(t,e){const n=this.Sh.get(t),s=e?"readwrite":"readwrite-primary";try{e||await this.persistence.runTransaction("Release target",s,t=>this.persistence.br.removeTarget(t,n))}catch(e){if(!ea(e))throw e;vs("LocalStore",`Failed to update sequence numbers for target ${t}: ${e}`)}this.Sh=this.Sh.remove(t),this.Ch.delete(n.target)}Yh(t,e){let n=Vs.min(),s=yr();return this.persistence.runTransaction("Execute query","readonly",r=>this.vo(r,wo(t)).next(t=>{if(t)return n=t.lastLimboFreeSnapshotVersion,this.Qo.xo(r,t.targetId).next(t=>{s=t})}).next(()=>this.vh.ws(r,t,e?n:Vs.min(),e?s:yr())).next(t=>({documents:t,Xh:s})))}Bh(t,e,n){const s=e.batch,r=s.keys();let i=Bo.resolve();return r.forEach(r=>{i=i.next(()=>n.Yn(t,r)).next(t=>{let i=t;const o=e.Dn.get(r);_s(null!==o),(!i||i.version.p(o)<0)&&((i=s.pn(r,i,e))&&n.zn(i,e.Cn))})}),i.next(()=>this.os.Lr(t,s))}wr(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.Vr(e,this.Sh))}}function _u(t,e){const n=Ns(t),s=Ns(n.Qo),r=n.Sh.get(e);return r?Promise.resolve(r.target):n.persistence.runTransaction("Get target data","readonly",t=>s.Ge(t,e).next(t=>t?t.target:null))}async function Nu(t){if(t.code!==As.FAILED_PRECONDITION||t.message!==zo)throw t;vs("LocalStore","Unexpectedly lost primary lease")}Tu.jh=3e8;class Au{constructor(t,e,n,s,r,i){this.Cs=t,this.Zh=n,this.ta=s,this.ea=r,this.listener=i,this.state=0,this.na=0,this.sa=null,this.stream=null,this.vi=new Yo(t,e)}ia(){return 1===this.state||2===this.state||4===this.state}ra(){return 2===this.state}start(){3!==this.state?this.auth():this.oa()}async stop(){this.ia()&&await this.close(0)}ha(){this.state=0,this.vi.reset()}aa(){this.ra()&&null===this.sa&&(this.sa=this.Cs.Bs(this.Zh,6e4,()=>this.ua()))}ca(t){this.la(),this.stream.send(t)}async ua(){if(this.ra())return this.close(0)}la(){this.sa&&(this.sa.cancel(),this.sa=null)}async close(t,e){this.la(),this.vi.cancel(),this.na++,3!==t?this.vi.reset():e&&e.code===As.RESOURCE_EXHAUSTED?(bs(e.toString()),bs("Using maximum backoff delay to prevent overloading the backend."),this.vi.$s()):e&&e.code===As.UNAUTHENTICATED&&this.ea.A(),null!==this.stream&&(this._a(),this.stream.close(),this.stream=null),this.state=t,await this.listener.fa(e)}_a(){}auth(){this.state=1;const t=this.da(this.na),e=this.na;this.ea.getToken().then(t=>{this.na===e&&this.wa(t)},e=>{t(()=>{const t=new Ss(As.UNKNOWN,"Fetching auth token failed: "+e.message);return this.Ta(t)})})}wa(t){const e=this.da(this.na);this.stream=this.Ea(t),this.stream.Ia(()=>{e(()=>(this.state=2,this.listener.Ia()))}),this.stream.fa(t=>{e(()=>this.Ta(t))}),this.stream.onMessage(t=>{e(()=>this.onMessage(t))})}oa(){this.state=4,this.vi.Ls(async()=>{this.state=0,this.start()})}Ta(t){return vs("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)}da(t){return e=>{this.Cs.Ri(()=>this.na===t?e():(vs("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Su extends Au{constructor(t,e,n,s,r){super(t,"listen_stream_connection_backoff","listen_stream_idle",e,n,r),this.serializer=s}Ea(t){return this.ta.Aa("Listen",t)}onMessage(t){this.vi.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Ts()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=function(t,e){return t.ze?(_s(void 0===e||"string"==typeof e),Js.fromBase64String(e||"")):(_s(void 0===e||e instanceof Uint8Array),Js.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?As.UNKNOWN:rr(t.code);return new Ss(e,t.message||"")}(o);n=new Sr(s,r,i,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=li(t,s.document.name),i=ai(s.document.updateTime),o=new ro({mapValue:{fields:s.document.fields}}),a=new uo(r,i,o,{}),u=s.targetIds||[],h=s.removedTargetIds||[];n=new Nr(u,h,a.key,a)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=li(t,s.document),i=s.readTime?ai(s.readTime):Vs.min(),o=new ho(r,i),a=s.removedTargetIds||[];n=new Nr([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=li(t,s.document),i=s.removedTargetIds||[];n=new Nr([],i,r,null)}else{if(!("filter"in e))return Ts();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,r=new tr(s),i=t.targetId;n=new Ar(i,r)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Vs.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Vs.min():e.readTime?ai(e.readTime):Vs.min()}(t);return this.listener.Ra(e,n)}ma(t){const e={};e.database=pi(this.serializer),e.addTarget=function(t,e){let n;const s=e.target;return(n=Ys(s)?{documents:vi(t,s)}:{query:bi(t,s)}).targetId=e.targetId,e.resumeToken.rt()>0&&(n.resumeToken=oi(t,e.resumeToken)),n}(this.serializer,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ts()}}(0,e.ht);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.ca(e)}Pa(t){const e={};e.database=pi(this.serializer),e.removeTarget=t,this.ca(e)}}class Du extends Au{constructor(t,e,n,s,r){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,r),this.serializer=s,this.Va=!1}get ga(){return this.Va}start(){this.Va=!1,this.lastStreamToken=void 0,super.start()}_a(){this.Va&&this.ya([])}Ea(t){return this.ta.Aa("Write",t)}onMessage(t){if(_s(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Va){this.vi.reset();const e=function(t,e){return t&&t.length>0?(_s(void 0!==e),t.map(t=>(function(t,e){let n=t.updateTime?ai(t.updateTime):ai(e);n.isEqual(Vs.min())&&(n=ai(e));let s=null;return t.transformResults&&t.transformResults.length>0&&(s=t.transformResults),new ji(n,s)})(t,e))):[]}(t.writeResults,t.commitTime),n=ai(t.commitTime);return this.listener.pa(n,e)}return _s(!t.writeResults||0===t.writeResults.length),this.Va=!0,this.listener.ba()}va(){const t={};t.database=pi(this.serializer),this.ca(t)}ya(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>yi(this.serializer,t))};this.ca(e)}}class xu extends class{}{constructor(t,e){super(),this.credentials=t,this.serializer=e,this.Sa=!1}Ca(){if(this.Sa)throw new Ss(As.FAILED_PRECONDITION,"The client has already been terminated.")}start(t){this.ta=t}Da(t,e,n){return this.Ca(),this.credentials.getToken().then(s=>this.ta.Da(t,e,n,s)).catch(t=>{throw t.code===As.UNAUTHENTICATED&&this.credentials.A(),t})}Na(t,e,n){return this.Ca(),this.credentials.getToken().then(s=>this.ta.Na(t,e,n,s)).catch(t=>{throw t.code===As.UNAUTHENTICATED&&this.credentials.A(),t})}async xa(){this.Sa=!1}}function Ou(t,e){return new xu(t,e)}class Lu{constructor(t,e){this.fi=t,this.ka=e,this.state="Unknown",this.Oa=0,this.Fa=null,this.Ma=!0}$a(){0===this.Oa&&(this.La("Unknown"),this.Fa=this.fi.Bs("online_state_timeout",1e4,()=>(this.Fa=null,this.qa("Backend didn't respond within 10 seconds."),this.La("Offline"),Promise.resolve())))}Ba(t){"Online"===this.state?this.La("Unknown"):(this.Oa++,this.Oa>=1&&(this.Ua(),this.qa("Connection failed 1 times. Most recent error: "+t.toString()),this.La("Offline")))}set(t){this.Ua(),this.Oa=0,"Online"===t&&(this.Ma=!1),this.La(t)}La(t){t!==this.state&&(this.state=t,this.ka(t))}qa(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Ma?(bs(e),this.Ma=!1):vs("OnlineStateTracker",e)}Ua(){null!==this.Fa&&(this.Fa.cancel(),this.Fa=null)}}class Ru{constructor(t,e,n,s,r){this.Wa=t,this.Ka=e,this.fi=n,this.ja=[],this.Qa=new Map,this.Ga=null,this.za=new Set,this.Ha=r,this.Ha.Ja(t=>{n.Ri(async()=>{this.Ya()&&(vs("RemoteStore","Restarting streams for network reachability change."),await this.Xa())})}),this.Za=new Lu(n,s),this.tu=function(t,e,n){const s=Ns(t);return s.Ca(),new Su(e,s.ta,s.credentials,s.serializer,n)}(this.Ka,n,{Ia:this.eu.bind(this),fa:this.nu.bind(this),Ra:this.su.bind(this)}),this.iu=function(t,e,n){const s=Ns(t);return s.Ca(),new Du(e,s.ta,s.credentials,s.serializer,n)}(this.Ka,n,{Ia:this.ru.bind(this),fa:this.ou.bind(this),ba:this.hu.bind(this),pa:this.pa.bind(this)})}start(){return this.enableNetwork()}enableNetwork(){return this.za.delete(0),this.au()}async au(){this.Ya()&&(this.uu()?this.cu():this.Za.set("Unknown"),await this.lu())}async disableNetwork(){this.za.add(0),await this._u(),this.Za.set("Offline")}async _u(){await this.iu.stop(),await this.tu.stop(),this.ja.length>0&&(vs("RemoteStore",`Stopping write stream with ${this.ja.length} pending writes`),this.ja=[]),this.fu()}async fh(){vs("RemoteStore","RemoteStore shutting down."),this.za.add(5),await this._u(),this.Ha.fh(),this.Za.set("Unknown")}listen(t){this.Qa.has(t.targetId)||(this.Qa.set(t.targetId,t),this.uu()?this.cu():this.tu.ra()&&this.du(t))}wu(t){this.Qa.delete(t),this.tu.ra()&&this.Tu(t),0===this.Qa.size&&(this.tu.ra()?this.tu.aa():this.Ya()&&this.Za.set("Unknown"))}Ge(t){return this.Qa.get(t)||null}Qe(t){return this.Eu.Qe(t)}du(t){this.Ga.ge(t.targetId),this.tu.ma(t)}Tu(t){this.Ga.ge(t),this.tu.Pa(t)}cu(){this.Ga=new xr(this),this.tu.start(),this.Za.$a()}uu(){return this.Ya()&&!this.tu.ia()&&this.Qa.size>0}Ya(){return 0===this.za.size}fu(){this.Ga=null}async eu(){this.Qa.forEach((t,e)=>{this.du(t)})}async nu(t){this.fu(),this.uu()?(this.Za.Ba(t),this.cu()):this.Za.set("Unknown")}async su(t,e){if(this.Za.set("Online"),t instanceof Sr&&2===t.state&&t.cause)try{await this.Iu(t)}catch(e){vs("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),e),await this.Au(e)}else if(t instanceof Nr?this.Ga.Ne(t):t instanceof Ar?this.Ga.qe(t):this.Ga.Oe(t),!e.isEqual(Vs.min()))try{const n=await this.Wa.Eo();e.p(n)>=0&&await this.Ru(e)}catch(t){vs("RemoteStore","Failed to raise snapshot:",t),await this.Au(t)}}async Au(t,e){if(!ea(t))throw t;this.za.add(1),await this._u(),this.Za.set("Offline"),e||(e=(()=>this.Wa.Eo())),this.fi.Fi(async()=>{vs("RemoteStore","Retrying IndexedDB access"),await e(),this.za.delete(1),await this.au()})}mu(t){return t().catch(e=>this.Au(e,t))}Ru(t){const e=this.Ga.We(t);return e.Zt.forEach((e,n)=>{if(e.resumeToken.rt()>0){const s=this.Qa.get(n);s&&this.Qa.set(n,s.ct(e.resumeToken,t))}}),e.te.forEach(t=>{const e=this.Qa.get(t);if(!e)return;this.Qa.set(t,e.ct(Js.ot,e.at)),this.Tu(t);const n=new Zs(e.target,t,1,e.sequenceNumber);this.du(n)}),this.Eu.Wh(e)}async Iu(t){const e=t.cause;for(const n of t.targetIds)this.Qa.has(n)&&(await this.Eu.Pu(n,e),this.Qa.delete(n),this.Ga.removeTarget(n))}async lu(){let t=this.ja.length>0?this.ja[this.ja.length-1].batchId:-1;for(;this.Vu();)try{const e=await this.Wa.Gh(t);if(null===e){0===this.ja.length&&this.iu.aa();break}t=e.batchId,this.gu(e)}catch(t){await this.Au(t)}this.yu()&&this.pu()}Vu(){return this.Ya()&&this.ja.length<10}bu(){return this.ja.length}gu(t){this.ja.push(t),this.iu.ra()&&this.iu.ga&&this.iu.ya(t.mutations)}yu(){return this.Ya()&&!this.iu.ia()&&this.ja.length>0}pu(){this.iu.start()}async ru(){this.iu.va()}async hu(){for(const t of this.ja)this.iu.ya(t.mutations)}async pa(t,e){const n=this.ja.shift(),s=jo.from(n,t,e);await this.mu(()=>this.Eu.vu(s)),await this.lu()}async ou(t){t&&this.iu.ga&&await this.Su(t),this.yu()&&this.pu()}async Su(t){if(sr(e=t.code)&&e!==As.ABORTED){const e=this.ja.shift();this.iu.ha(),await this.mu(()=>this.Eu.Cu(e.batchId,t)),await this.lu()}var e}async Xa(){this.za.add(4),await this._u(),this.Za.set("Unknown"),this.iu.ha(),this.tu.ha(),this.za.delete(4),await this.au()}async Du(t){this.fi.Li(),vs("RemoteStore","RemoteStore received new credentials"),this.za.add(3),await this._u(),this.Za.set("Unknown"),await this.Eu.Du(t),this.za.delete(3),await this.au()}async Nu(t){t?(this.za.delete(2),await this.au()):t||(this.za.add(2),await this._u(),this.Za.set("Unknown"))}}class ku{constructor(){this.xu=new ur(Cu.ku),this.Ou=new ur(Cu.Fu)}$(){return this.xu.$()}Co(t,e){const n=new Cu(t,e);this.xu=this.xu.add(n),this.Ou=this.Ou.add(n)}Mu(t,e){t.forEach(t=>this.Co(t,e))}No(t,e){this.$u(new Cu(t,e))}Lu(t,e){t.forEach(t=>this.No(t,e))}qu(t){const e=new js(new Ms([])),n=new Cu(e,t),s=new Cu(e,t+1),r=[];return this.Ou.$t([n,s],t=>{this.$u(t),r.push(t.key)}),r}Bu(){this.xu.forEach(t=>this.$u(t))}$u(t){this.xu=this.xu.delete(t),this.Ou=this.Ou.delete(t)}Uu(t){const e=new js(new Ms([])),n=new Cu(e,t),s=new Cu(e,t+1);let r=yr();return this.Ou.$t([n,s],t=>{r=r.add(t.key)}),r}Kr(t){const e=new Cu(t,0),n=this.xu.qt(e);return null!==n&&t.isEqual(n.key)}}class Cu{constructor(t,e){this.key=t,this.Wu=e}static ku(t,e){return js.D(t.key,e.key)||Rs(t.Wu,e.Wu)}static Fu(t,e){return Rs(t.Wu,e.Wu)||js.D(t.key,e.key)}}function Pu(t,e){return`firestore_clients_${t}_${e}`}function Vu(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.t()&&(s+="_"+e.uid),s}function Uu(t,e){return`firestore_targets_${t}_${e}`}class Mu{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static Ku(t,e,n){const s=JSON.parse(n);let r="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error),i=void 0;return r&&s.error&&((r="string"==typeof s.error.message&&"string"==typeof s.error.code)&&(i=new Ss(s.error.code,s.error.message))),r?new Mu(t,e,s.state,i):(bs("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}ju(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Fu{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Ku(t,e){const n=JSON.parse(e);let s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),r=void 0;return s&&n.error&&((s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(r=new Ss(n.error.code,n.error.message))),s?new Fu(t,n.state,r):(bs("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}ju(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class qu{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ku(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,r=vr();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=Hs(n.activeTargetIds[t]),r=r.add(n.activeTargetIds[t]);return s?new qu(t,r):(bs("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class ju{constructor(t,e){this.clientId=t,this.onlineState=e}static Ku(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new ju(e.clientId,e.onlineState):(bs("SharedClientState","Failed to parse online state: "+t),null)}}class $u{constructor(){this.activeTargetIds=vr()}Qu(t){this.activeTargetIds=this.activeTargetIds.add(t)}Gu(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ju(){const t={activeTargetIds:this.activeTargetIds.B(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Bu{constructor(t,e,n,s,r){this.window=t,this.Cs=e,this.persistenceKey=n,this.zu=s,this.Eu=null,this.ka=null,this.ys=null,this.Hu=this.Ju.bind(this),this.Yu=new ir(Rs),this.dr=!1,this.Xu=[];const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=r,this.Zu=Pu(this.persistenceKey,this.zu),this.tc=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Yu=this.Yu._t(this.zu,new $u),this.ec=new RegExp(`^firestore_clients_${i}_([^_]*)$`),this.nc=new RegExp(`^firestore_mutations_${i}_(\\d+)(?:_(.*))?$`),this.sc=new RegExp(`^firestore_targets_${i}_(\\d+)$`),this.ic=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.Hu)}static Qs(t){return!(!t||!t.localStorage)}async start(){const t=await this.Eu.Ih();for(const e of t){if(e===this.zu)continue;const t=this.getItem(Pu(this.persistenceKey,e));if(t){const n=qu.Ku(e,t);n&&(this.Yu=this.Yu._t(n.clientId,n))}}this.rc();const e=this.storage.getItem(this.ic);if(e){const t=this.oc(e);t&&this.hc(t)}for(const t of this.Xu)this.Ju(t);this.Xu=[],this.window.addEventListener("unload",()=>this.fh()),this.dr=!0}vs(t){this.setItem(this.tc,JSON.stringify(t))}ac(){return this.uc(this.Yu)}cc(t){let e=!1;return this.Yu.forEach((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)}),e}lc(t){this._c(t,"pending")}fc(t,e,n){this._c(t,e,n),this.dc(t)}wc(t){let e="not-current";if(this.cc(t)){const n=this.storage.getItem(Uu(this.persistenceKey,t));if(n){const s=Fu.Ku(t,n);s&&(e=s.state)}}return this.Tc.Qu(t),this.rc(),e}Ec(t){this.Tc.Gu(t),this.rc()}Ic(t){return this.Tc.activeTargetIds.has(t)}Ac(t){this.removeItem(Uu(this.persistenceKey,t))}Rc(t,e,n){this.mc(t,e,n)}Oh(t,e,n){e.forEach(t=>{this.dc(t)}),this.currentUser=t,n.forEach(t=>{this.lc(t)})}Pc(t){this.Vc(t)}fh(){this.dr&&(this.window.removeEventListener("storage",this.Hu),this.removeItem(this.Zu),this.dr=!1)}getItem(t){const e=this.storage.getItem(t);return vs("SharedClientState","READ",t,e),e}setItem(t,e){vs("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){vs("SharedClientState","REMOVE",t),this.storage.removeItem(t)}Ju(t){const e=t;if(e.storageArea===this.storage){if(vs("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Zu)return void bs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Cs.Fi(async()=>{if(this.dr){if(null!==e.key)if(this.ec.test(e.key)){if(null==e.newValue){const t=this.gc(e.key);return this.yc(t,null)}{const t=this.pc(e.key,e.newValue);if(t)return this.yc(t.clientId,t)}}else if(this.nc.test(e.key)){if(null!==e.newValue){const t=this.bc(e.key,e.newValue);if(t)return this.vc(t)}}else if(this.sc.test(e.key)){if(null!==e.newValue){const t=this.Sc(e.key,e.newValue);if(t)return this.Cc(t)}}else if(e.key===this.ic){if(null!==e.newValue){const t=this.oc(e.newValue);if(t)return this.hc(t)}}else if(e.key===this.tc){const t=function(t){let e=Qo.Ss;if(null!=t)try{const n=JSON.parse(t);_s("number"==typeof n),e=n}catch(t){bs("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==Qo.Ss&&this.ys(t)}}else this.Xu.push(e)})}}get Tc(){return this.Yu.get(this.zu)}rc(){this.setItem(this.Zu,this.Tc.ju())}_c(t,e,n){const s=new Mu(this.currentUser,t,e,n),r=Vu(this.persistenceKey,this.currentUser,t);this.setItem(r,s.ju())}dc(t){const e=Vu(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Vc(t){const e={clientId:this.zu,onlineState:t};this.storage.setItem(this.ic,JSON.stringify(e))}mc(t,e,n){const s=Uu(this.persistenceKey,t),r=new Fu(t,e,n);this.setItem(s,r.ju())}gc(t){const e=this.ec.exec(t);return e?e[1]:null}pc(t,e){const n=this.gc(t);return qu.Ku(n,e)}bc(t,e){const n=this.nc.exec(t),s=Number(n[1]),r=void 0!==n[2]?n[2]:null;return Mu.Ku(new ms(r),s,e)}Sc(t,e){const n=this.sc.exec(t),s=Number(n[1]);return Fu.Ku(s,e)}oc(t){return ju.Ku(t)}async vc(t){if(t.user.uid===this.currentUser.uid)return this.Eu.Dc(t.batchId,t.state,t.error);vs("SharedClientState","Ignoring mutation for non-active user "+t.user.uid)}Cc(t){return this.Eu.Nc(t.targetId,t.state,t.error)}yc(t,e){const n=e?this.Yu._t(t,e):this.Yu.remove(t),s=this.uc(this.Yu),r=this.uc(n),i=[],o=[];return r.forEach(t=>{s.has(t)||i.push(t)}),s.forEach(t=>{r.has(t)||o.push(t)}),this.Eu.xc(i,o).then(()=>{this.Yu=n})}hc(t){this.Yu.get(t.clientId)&&this.ka(t.onlineState)}uc(t){let e=vr();return t.forEach((t,n)=>{e=e.Bt(n.activeTargetIds)}),e}}class Gu{constructor(){this.kc=new $u,this.Oc={},this.ka=null,this.ys=null}lc(t){}fc(t,e,n){}wc(t){return this.kc.Qu(t),this.Oc[t]||"not-current"}Rc(t,e,n){this.Oc[t]=e}Ec(t){this.kc.Gu(t)}Ic(t){return this.kc.activeTargetIds.has(t)}Ac(t){delete this.Oc[t]}ac(){return this.kc.activeTargetIds}cc(t){return this.kc.activeTargetIds.has(t)}start(){return this.kc=new $u,Promise.resolve()}Oh(t,e,n){}Pc(t){}fh(){}vs(t){}}class zu{constructor(t){this.key=t}}class Hu{constructor(t){this.key=t}}class Wu{constructor(t,e){this.query=t,this.Fc=e,this.Mc=null,this.re=!1,this.$c=yr(),this.Ht=yr(),this.Lc=To(t),this.qc=new br(this.Lc)}get Bc(){return this.Fc}Uc(t,e){const n=e?e.Wc:new Er,s=e?e.qc:this.qc;let r=e?e.Ht:this.Ht,i=s,o=!1;const a=this.query.En()&&s.size===this.query.limit?s.last():null,u=this.query.In()&&s.size===this.query.limit?s.first():null;if(t.Tt((t,e)=>{const h=s.get(t);let c=e instanceof uo?e:null;c&&(c=Io(this.query,c)?c:null);const l=!!h&&this.Ht.has(h.key),f=!!c&&(c.nn||this.Ht.has(c.key)&&c.hasCommittedMutations);let d=!1;h&&c?h.data().isEqual(c.data())?l!==f&&(n.track({type:3,doc:c}),d=!0):this.Kc(h,c)||(n.track({type:2,doc:c}),d=!0,(a&&this.Lc(c,a)>0||u&&this.Lc(c,u)<0)&&(o=!0)):!h&&c?(n.track({type:0,doc:c}),d=!0):h&&!c&&(n.track({type:1,doc:h}),d=!0,(a||u)&&(o=!0)),d&&(c?(i=i.add(c),r=f?r.add(t):r.delete(t)):(i=i.delete(t),r=r.delete(t)))}),this.query.En()||this.query.In())for(;i.size>this.query.limit;){const t=this.query.En()?i.last():i.first();i=i.delete(t.key),r=r.delete(t.key),n.track({type:1,doc:t})}return{qc:i,Wc:n,jc:o,Ht:r}}Kc(t,e){return t.nn&&e.hasCommittedMutations&&!e.nn}ts(t,e,n){const s=this.qc;this.qc=t.qc,this.Ht=t.Ht;const r=t.Wc.Gt();r.sort((t,e)=>(function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ts()}};return n(t)-n(e)})(t.type,e.type)||this.Lc(t.doc,e.doc)),this.Qc(n);const i=e?this.Gc():[],o=0===this.$c.size&&this.re?1:0,a=o!==this.Mc;return this.Mc=o,0!==r.length||a?{snapshot:new Ir(this.query,t.qc,s,r,t.Ht,0===o,a,!1),zc:i}:{zc:i}}Hc(t){return this.re&&"Offline"===t?(this.re=!1,this.ts({qc:this.qc,Wc:new Er,Ht:this.Ht,jc:!1},!1)):{zc:[]}}Jc(t){return!this.Fc.has(t)&&!!this.qc.has(t)&&!this.qc.get(t).nn}Qc(t){t&&(t.oe.forEach(t=>this.Fc=this.Fc.add(t)),t.he.forEach(t=>{}),t.ae.forEach(t=>this.Fc=this.Fc.delete(t)),this.re=t.re)}Gc(){if(!this.re)return[];const t=this.$c;this.$c=yr(),this.qc.forEach(t=>{this.Jc(t.key)&&(this.$c=this.$c.add(t.key))});const e=[];return t.forEach(t=>{this.$c.has(t)||e.push(new Hu(t))}),this.$c.forEach(n=>{t.has(n)||e.push(new zu(n))}),e}Yc(t){this.Fc=t.Xh,this.$c=yr();const e=this.Uc(t.documents);return this.ts(e,!0)}Xc(){return Ir.Xt(this.query,this.qc,this.Ht,0===this.Mc)}}class Ku{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Qu{constructor(t){this.key=t,this.Zc=!1}}class Xu{constructor(t,e,n,s,r,i){this.Wa=t,this.tl=e,this.Ka=n,this.el=s,this.currentUser=r,this.nl=i,this.sl=null,this.il=new $o(t=>bo(t),vo),this.rl=new Map,this.ol=[],this.hl=new ir(js.D),this.al=new Map,this.ul=new ku,this.cl={},this.ll=new Map,this._l=hu.fo(),this.onlineState="Unknown",this.fl=void 0}get dl(){return!0===this.fl}subscribe(t){this.sl=t}async listen(t){let e,n;this.wl("listen()");const s=this.il.get(t);if(s)e=s.targetId,this.el.wc(e),n=s.view.Xc();else{const s=await this.Wa.Hh(wo(t)),r=this.el.wc(s.targetId);e=s.targetId,n=await this.Tl(t,e,"current"===r),this.dl&&this.tl.listen(s)}return n}async Tl(t,e,n){const s=await this.Wa.Yh(t,!0),r=new Wu(t,s.Xh),i=r.Uc(s.documents),o=_r.ie(e,n&&"Offline"!==this.onlineState),a=r.ts(i,this.dl,o);this.El(e,a.zc);const u=new Ku(t,e,r);return this.il.set(t,u),this.rl.has(e)?this.rl.get(e).push(t):this.rl.set(e,[t]),a.snapshot}async wu(t){this.wl("unlisten()");const e=this.il.get(t),n=this.rl.get(e.targetId);if(n.length>1)return this.rl.set(e.targetId,n.filter(e=>!vo(e,t))),void this.il.delete(t);this.dl?(this.el.Ec(e.targetId),this.el.cc(e.targetId)||await this.Wa.Jh(e.targetId,!1).then(()=>{this.el.Ac(e.targetId),this.tl.wu(e.targetId),this.Il(e.targetId)}).catch(Nu)):(this.Il(e.targetId),await this.Wa.Jh(e.targetId,!0))}async write(t,e){this.wl("write()");try{const n=await this.Wa.Lh(t);this.el.lc(n.batchId),this.Al(n.batchId,e),await this.Rl(n.jn),await this.tl.lu()}catch(t){const n=ca(t,"Failed to persist write");e.reject(n)}}async Wh(t){this.wl("applyRemoteEvent()");try{const e=await this.Wa.Wh(t);t.Zt.forEach((t,e)=>{const n=this.al.get(e);n&&(_s(t.oe.size+t.he.size+t.ae.size<=1),t.oe.size>0?n.Zc=!0:t.he.size>0?_s(n.Zc):t.ae.size>0&&(_s(n.Zc),n.Zc=!1))}),await this.Rl(e,t)}catch(t){await Nu(t)}}Hc(t,e){if(this.dl&&0===e||!this.dl&&1===e){this.wl("applyOnlineStateChange()");const e=[];this.il.forEach((n,s)=>{const r=s.view.Hc(t);r.snapshot&&e.push(r.snapshot)}),this.sl.ml(t),this.sl.Ra(e),this.onlineState=t,this.dl&&this.el.Pc(t)}}async Pu(t,e){this.wl("rejectListens()"),this.el.Rc(t,"rejected",e);const n=this.al.get(t),s=n&&n.key;if(s){let e=new ir(js.D);e=e._t(s,new ho(s,Vs.min()));const n=yr().add(s),r=new Tr(Vs.min(),new Map,new ur(Rs),e,n);await this.Wh(r),this.hl=this.hl.remove(s),this.al.delete(t),this.Pl()}else await this.Wa.Jh(t,!1).then(()=>this.Il(t,e)).catch(Nu)}async vu(t){this.wl("applySuccessfulWrite()");const e=t.batch.batchId;try{const n=await this.Wa.qh(t);this.Vl(e,null),this.gl(e),this.el.fc(e,"acknowledged"),await this.Rl(n)}catch(t){await Nu(t)}}async Cu(t,e){this.wl("rejectFailedWrite()");try{const n=await this.Wa.Uh(t);this.Vl(t,e),this.gl(t),this.el.fc(t,"rejected",e),await this.Rl(n)}catch(e){await Nu(e)}}async yl(t){this.tl.Ya()||vs("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const e=await this.Wa.Fr();if(-1===e)return void t.resolve();const n=this.ll.get(e)||[];n.push(t),this.ll.set(e,n)}catch(e){const n=ca(e,"Initialization of waitForPendingWrites() operation failed");t.reject(n)}}gl(t){(this.ll.get(t)||[]).forEach(t=>{t.resolve()}),this.ll.delete(t)}pl(t){this.ll.forEach(e=>{e.forEach(e=>{e.reject(new Ss(As.CANCELLED,t))})}),this.ll.clear()}Al(t,e){let n=this.cl[this.currentUser.s()];n||(n=new ir(Rs)),n=n._t(t,e),this.cl[this.currentUser.s()]=n}Vl(t,e){let n=this.cl[this.currentUser.s()];if(n){const s=n.get(t);s&&(e?s.reject(e):s.resolve(),n=n.remove(t)),this.cl[this.currentUser.s()]=n}}Il(t,e=null){this.el.Ec(t);for(const n of this.rl.get(t))this.il.delete(n),e&&this.sl.bl(n,e);this.rl.delete(t),this.dl&&this.ul.qu(t).forEach(t=>{this.ul.Kr(t)||this.vl(t)})}vl(t){const e=this.hl.get(t);null!==e&&(this.tl.wu(e),this.hl=this.hl.remove(t),this.al.delete(e),this.Pl())}El(t,e){for(const n of e)n instanceof zu?(this.ul.Co(n.key,t),this.Sl(n)):n instanceof Hu?(vs("SyncEngine","Document no longer in limbo: "+n.key),this.ul.No(n.key,t),this.ul.Kr(n.key)||this.vl(n.key)):Ts()}Sl(t){const e=t.key;this.hl.get(e)||(vs("SyncEngine","New document in limbo: "+e),this.ol.push(e),this.Pl())}Pl(){for(;this.ol.length>0&&this.hl.size<this.nl;){const t=this.ol.shift(),e=this._l.next();this.al.set(e,new Qu(t)),this.hl=this.hl._t(t,e),this.tl.listen(new Zs(wo(go(t.path)),e,2,Qo.Ss))}}Cl(){return this.hl}Dl(){return this.ol}async Rl(t,e){const n=[],s=[],r=[];this.il.forEach((i,o)=>{r.push(Promise.resolve().then(()=>{const e=o.view.Uc(t);return e.jc?this.Wa.Yh(o.query,!1).then(({documents:t})=>o.view.Uc(t,e)):e}).then(t=>{const r=e&&e.Zt.get(o.targetId),i=o.view.ts(t,this.dl,r);if(this.El(o.targetId,i.zc),i.snapshot){this.dl&&this.el.Rc(o.targetId,i.snapshot.fromCache?"not-current":"current"),n.push(i.snapshot);const t=Ko.gs(o.targetId,i.snapshot);s.push(t)}}))}),await Promise.all(r),this.sl.Ra(n),await this.Wa.Qh(s)}wl(t){}async Du(t){if(!this.currentUser.isEqual(t)){vs("SyncEngine","User change. New user:",t.s());const e=await this.Wa.Oh(t);this.currentUser=t,this.pl("'waitForPendingWrites' promise is rejected due to a user change."),this.el.Oh(t,e.Mh,e.$h),await this.Rl(e.Fh)}}Qe(t){const e=this.al.get(t);if(e&&e.Zc)return yr().add(e.key);{let e=yr();const n=this.rl.get(t);if(!n)return e;for(const t of n){const n=this.il.get(t);e=e.Bt(n.view.Bc)}return e}}}async function Yu(t,e){const n=Ns(t),s=await n.Wa.Yh(e.query,!0),r=e.view.Yc(s);return n.dl&&n.El(e.targetId,r.zc),r}async function Ju(t,e,n){const s=Ns(t),r=[],i=[];for(const t of e){let e;const n=s.rl.get(t);if(n&&0!==n.length){e=await s.Wa.Hh(wo(n[0]));for(const t of n){const e=s.il.get(t),n=await Yu(s,e);n.snapshot&&i.push(n.snapshot)}}else{const n=await _u(s.Wa,t);e=await s.Wa.Hh(n),await s.Tl(Zu(n),t,!1)}r.push(e)}return s.sl.Ra(i),r}function Zu(t){return po(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}class th{constructor(){this.Nl=void 0,this.listeners=[]}}class eh{constructor(t){this.Eu=t,this.xl=new $o(t=>bo(t),vo),this.onlineState="Unknown",this.kl=new Set,this.Eu.subscribe(this)}async listen(t){const e=t.query;let n=!1,s=this.xl.get(e);if(s||(n=!0,s=new th),n)try{s.Nl=await this.Eu.listen(e)}catch(e){const n=ca(e,`Initialization of query '${Eo(t.query)}' failed`);return void t.onError(n)}this.xl.set(e,s),s.listeners.push(t),t.Hc(this.onlineState),s.Nl&&t.Ol(s.Nl)&&this.Fl()}async wu(t){const e=t.query;let n=!1;const s=this.xl.get(e);if(s){const e=s.listeners.indexOf(t);e>=0&&(s.listeners.splice(e,1),n=0===s.listeners.length)}if(n)return this.xl.delete(e),this.Eu.wu(e)}Ra(t){let e=!1;for(const n of t){const t=n.query,s=this.xl.get(t);if(s){for(const t of s.listeners)t.Ol(n)&&(e=!0);s.Nl=n}}e&&this.Fl()}bl(t,e){const n=this.xl.get(t);if(n)for(const t of n.listeners)t.onError(e);this.xl.delete(t)}ml(t){this.onlineState=t;let e=!1;this.xl.forEach((n,s)=>{for(const n of s.listeners)n.Hc(t)&&(e=!0)}),e&&this.Fl()}Ml(t){this.kl.add(t),t.next()}$l(t){this.kl.delete(t)}Fl(){this.kl.forEach(t=>{t.next()})}}class nh{constructor(t,e,n){this.query=t,this.Ll=e,this.ql=!1,this.Bl=null,this.onlineState="Unknown",this.options=n||{}}Ol(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Ir(t.query,t.docs,t.zt,e,t.Ht,t.fromCache,t.Jt,!0)}let e=!1;return this.ql?this.Ul(t)&&(this.Ll.next(t),e=!0):this.Wl(t,this.onlineState)&&(this.Kl(t),e=!0),this.Bl=t,e}onError(t){this.Ll.error(t)}Hc(t){this.onlineState=t;let e=!1;return this.Bl&&!this.ql&&this.Wl(this.Bl,t)&&(this.Kl(this.Bl),e=!0),e}Wl(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.jl&&n||t.docs.$()&&"Offline"!==e)}Ul(t){if(t.docChanges.length>0)return!0;const e=this.Bl&&this.Bl.hasPendingWrites!==t.hasPendingWrites;return!(!t.Jt&&!e)&&!0===this.options.includeMetadataChanges}Kl(t){t=Ir.Xt(t.query,t.docs,t.Ht,t.fromCache),this.ql=!0,this.Ll.next(t)}}class sh{kh(t){this.Ql=t}ws(t,e,n,s){return e.Tn()||n.isEqual(Vs.min())?this.Gl(t,e):this.Ql._s(t,s).next(r=>{const i=this.zl(e,r);return(e.En()||e.In())&&this.jc(e._n,i,s,n)?this.Gl(t,e):(ws()<=u.DEBUG&&vs("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Eo(e)),this.Ql.ws(t,e,n).next(t=>(i.forEach(e=>{t=t._t(e.key,e)}),t)))})}zl(t,e){let n=new ur(To(t));return e.forEach((e,s)=>{s instanceof uo&&Io(t,s)&&(n=n.add(s))}),n}jc(t,e,n,s){if(n.size!==e.size)return!0;const r="F"===t?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.p(s)>0)}Gl(t,e){return ws()<=u.DEBUG&&vs("IndexFreeQueryEngine","Using full collection scan to execute query:",Eo(e)),this.Ql.ws(t,e,Vs.min())}}class rh{constructor(t,e){this.hs=t,this.br=e,this.os=[],this.Hl=1,this.Jl=new ur(Cu.ku)}Cr(t){return Bo.resolve(0===this.os.length)}Dr(t,e,n,s){const r=this.Hl;this.Hl++,this.os.length>0&&this.os[this.os.length-1];const i=new qo(r,e,n,s);this.os.push(i);for(const e of s)this.Jl=this.Jl.add(new Cu(e.key,r)),this.hs.Nr(t,e.key.path.O());return Bo.resolve(i)}xr(t,e){return Bo.resolve(this.Yl(e))}Or(t,e){const n=e+1,s=this.Xl(n),r=s<0?0:s;return Bo.resolve(this.os.length>r?this.os[r]:null)}Fr(){return Bo.resolve(0===this.os.length?-1:this.Hl-1)}Mr(t){return Bo.resolve(this.os.slice())}us(t,e){const n=new Cu(e,0),s=new Cu(e,Number.POSITIVE_INFINITY),r=[];return this.Jl.$t([n,s],t=>{const e=this.Yl(t.Wu);r.push(e)}),Bo.resolve(r)}ds(t,e){let n=new ur(Rs);return e.forEach(t=>{const e=new Cu(t,0),s=new Cu(t,Number.POSITIVE_INFINITY);this.Jl.$t([e,s],t=>{n=n.add(t.Wu)})}),Bo.resolve(this.Zl(n))}Rs(t,e){const n=e.path,s=n.length+1;let r=n;js.Z(r)||(r=r.child(""));const i=new Cu(new js(r),0);let o=new ur(Rs);return this.Jl.Lt(t=>{const e=t.key.path;return!!n.L(e)&&(e.length===s&&(o=o.add(t.Wu)),!0)},i),Bo.resolve(this.Zl(o))}Zl(t){const e=[];return t.forEach(t=>{const n=this.Yl(t);null!==n&&e.push(n)}),e}Lr(t,e){_s(0===this.t_(e.batchId,"removed")),this.os.shift();let n=this.Jl;return Bo.forEach(e.mutations,s=>{const r=new Cu(s.key,e.batchId);return n=n.delete(r),this.br.Ur(t,s.key)}).next(()=>{this.Jl=n})}Br(t){}Kr(t,e){const n=new Cu(e,0),s=this.Jl.qt(n);return Bo.resolve(e.isEqual(s&&s.key))}Wr(t){return this.os.length,Bo.resolve()}t_(t,e){return this.Xl(t)}Xl(t){return 0===this.os.length?0:t-this.os[0].batchId}Yl(t){const e=this.Xl(t);return e<0||e>=this.os.length?null:this.os[e]}}class ih{constructor(t,e){this.hs=t,this.e_=e,this.docs=new ir(js.D),this.size=0}zn(t,e,n){const s=e.key,r=this.docs.get(s),i=r?r.size:0,o=this.e_(e);return this.docs=this.docs._t(s,{Hr:e,size:o,readTime:n}),this.size+=o-i,this.hs.Nr(t,s.path.O())}Jn(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}Yn(t,e){const n=this.docs.get(e);return Bo.resolve(n?n.Hr:null)}getEntries(t,e){let n=fr();return e.forEach(t=>{const e=this.docs.get(t);n=n._t(t,e?e.Hr:null)}),Bo.resolve(n)}ws(t,e,n){let s=pr();const r=new js(e.path.child("")),i=this.docs.At(r);for(;i.pt();){const{key:t,value:{Hr:r,readTime:o}}=i.yt();if(!e.path.L(t.path))break;o.p(n)<=0||r instanceof uo&&Io(e,r)&&(s=s._t(r.key,r))}return Bo.resolve(s)}n_(t,e){return Bo.forEach(this.docs,t=>e(t))}so(t){return new ih.io(this)}oo(t){return Bo.resolve(this.size)}}ih.io=class extends Go{constructor(t){super(),this.ho=t}ts(t){const e=[];return this.jn.forEach((n,s)=>{s?e.push(this.ho.zn(t,s,this.readTime)):this.ho.Jn(n)}),Bo.Wn(e)}Xn(t,e){return this.ho.Yn(t,e)}Zn(t,e){return this.ho.getEntries(t,e)}};class oh{constructor(t){this.persistence=t,this.s_=new $o(t=>Qs(t),Xs),this.lastRemoteSnapshotVersion=Vs.min(),this.highestTargetId=0,this.i_=0,this.r_=new ku,this.targetCount=0,this.o_=hu._o()}Fe(t,e){return this.s_.forEach((t,n)=>e(n)),Bo.resolve()}Eo(t){return Bo.resolve(this.lastRemoteSnapshotVersion)}Io(t){return Bo.resolve(this.i_)}do(t){return this.highestTargetId=this.o_.next(),Bo.resolve(this.highestTargetId)}Ao(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.i_&&(this.i_=e),Bo.resolve()}mo(t){this.s_.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.o_=new hu(e),this.highestTargetId=e),t.sequenceNumber>this.i_&&(this.i_=t.sequenceNumber)}Ro(t,e){return this.mo(e),this.targetCount+=1,Bo.resolve()}Vo(t,e){return this.mo(e),Bo.resolve()}yo(t,e){return this.s_.delete(e.target),this.r_.qu(e.targetId),this.targetCount-=1,Bo.resolve()}mr(t,e,n){let s=0;const r=[];return this.s_.forEach((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.s_.delete(i),r.push(this.po(t,o.targetId)),s++)}),Bo.Wn(r).next(()=>s)}bo(t){return Bo.resolve(this.targetCount)}vo(t,e){const n=this.s_.get(e)||null;return Bo.resolve(n)}So(t,e,n){return this.r_.Mu(e,n),Bo.resolve()}Do(t,e,n){this.r_.Lu(e,n);const s=this.persistence.br,r=[];return s&&e.forEach(e=>{r.push(s.Ur(t,e))}),Bo.Wn(r)}po(t,e){return this.r_.qu(e),Bo.resolve()}xo(t,e){const n=this.r_.Uu(e);return Bo.resolve(n)}Kr(t,e){return Bo.resolve(this.r_.Kr(e))}}class ah{constructor(t){this.h_={},this.Mo=new Qo(0),this.$o=!1,this.$o=!0,this.br=t(this),this.Qo=new oh(this),this.hs=new $a,this.rs=new ih(this.hs,t=>this.br.a_(t))}start(){return Promise.resolve()}fh(){return this.$o=!1,Promise.resolve()}get dr(){return this.$o}Zo(){}th(){}Ph(){return this.hs}Ah(t){let e=this.h_[t.s()];return e||(e=new rh(this.hs,this.br),this.h_[t.s()]=e),e}Rh(){return this.Qo}mh(){return this.rs}runTransaction(t,e,n){vs("MemoryPersistence","Starting transaction:",t);const s=new uh(this.Mo.next());return this.br.u_(),n(s).next(t=>this.br.c_(s).next(()=>t)).Bn().then(t=>(s.ss(),t))}l_(t,e){return Bo.Kn(Object.values(this.h_).map(n=>()=>n.Kr(t,e)))}}class uh extends Ho{constructor(t){super(),this.ko=t}}class hh{constructor(t){this.persistence=t,this.__=new ku,this.f_=null}static d_(t){return new hh(t)}get w_(){if(this.f_)return this.f_;throw Ts()}Co(t,e,n){return this.__.Co(n,e),this.w_.delete(n),Bo.resolve()}No(t,e,n){return this.__.No(n,e),this.w_.add(n),Bo.resolve()}Ur(t,e){return this.w_.add(e),Bo.resolve()}removeTarget(t,e){this.__.qu(e.targetId).forEach(t=>this.w_.add(t));const n=this.persistence.Rh();return n.xo(t,e.targetId).next(t=>{t.forEach(t=>this.w_.add(t))}).next(()=>n.yo(t,e))}u_(){this.f_=new Set}c_(t){const e=this.persistence.mh().so();return Bo.forEach(this.w_,n=>this.T_(t,n).next(t=>{t||e.Jn(n)})).next(()=>(this.f_=null,e.apply(t)))}bh(t,e){return this.T_(t,e).next(t=>{t?this.w_.delete(e):this.w_.add(e)})}a_(t){return 0}T_(t,e){return Bo.Kn([()=>Bo.resolve(this.__.Kr(e)),()=>this.persistence.Rh().Kr(t,e),()=>this.persistence.l_(t,e)])}}class ch{constructor(t){this.E_=t.E_,this.I_=t.I_}Ia(t){this.A_=t}fa(t){this.R_=t}onMessage(t){this.m_=t}close(){this.I_()}send(t){this.E_(t)}P_(){this.A_()}V_(t){this.R_(t)}g_(t){this.m_(t)}}const lh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class fh extends class{constructor(t){this.y_=t,this.et=t.et;const e=t.ssl?"https":"http";this.p_=e+"://"+t.host,this.b_="projects/"+this.et.projectId+"/databases/"+this.et.database+"/documents"}Da(t,e,n,s){const r=this.v_(t,e);vs("RestConnection","Sending: ",r,n);const i={};return this.S_(i,s),this.C_(t,r,i,n).then(t=>(vs("RestConnection","Received: ",t),t),e=>{throw Es("RestConnection",t+" failed with error: ",e,"url: ",r,"request:",n),e})}Na(t,e,n,s){return this.Da(t,e,n,s)}S_(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.17.1",t["Content-Type"]="text/plain",e)for(const n in e.h)e.h.hasOwnProperty(n)&&(t[n]=e.h[n])}v_(t,e){const n=lh[t];return`${this.p_}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling}C_(t,e,n,s){return new Promise((r,i)=>{const o=new gs;o.listenOnce(ds.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case fs.NO_ERROR:const e=o.getResponseJson();vs("Connection","XHR received:",JSON.stringify(e)),r(e);break;case fs.TIMEOUT:vs("Connection",'RPC "'+t+'" timed out'),i(new Ss(As.DEADLINE_EXCEEDED,"Request time out"));break;case fs.HTTP_ERROR:const n=o.getStatus();if(vs("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace("_","-");return Object.values(As).indexOf(e)>=0?e:As.UNKNOWN}(t.status);i(new Ss(e,t.message))}else i(new Ss(As.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new Ss(As.UNAVAILABLE,"Connection failed."));break;default:Ts()}}finally{vs("Connection",'RPC "'+t+'" completed.')}});const a=JSON.stringify(s);o.send(e,"POST",a,n,15)})}Aa(t,e){const n=[this.p_,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=ls(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.et.projectId}/databases/${this.et.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};var o,a;this.S_(i.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(s())||"object"==typeof navigator&&"ReactNative"===navigator.product||s().indexOf("Electron/")>=0||((a=s()).indexOf("MSIE ")>=0||a.indexOf("Trident/")>=0)||s().indexOf("MSAppHost/")>=0||"object"==typeof(o="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==o.id||(i.httpHeadersOverwriteParam="$httpHeaders");const u=n.join("");vs("Connection","Creating WebChannel: "+u,i);const h=r.createWebChannel(u,i);let c=!1,l=!1;const f=new ch({E_:t=>{l?vs("Connection","Not sending because WebChannel is closed:",t):(c||(vs("Connection","Opening WebChannel transport."),h.open(),c=!0),vs("Connection","WebChannel sending:",t),h.send(t))},I_:()=>h.close()}),d=(t,e)=>{h.listen(t,t=>{try{e(t)}catch(t){setTimeout(()=>{throw t},0)}})};return d(ps.EventType.OPEN,()=>{l||vs("Connection","WebChannel transport opened.")}),d(ps.EventType.CLOSE,()=>{l||(l=!0,vs("Connection","WebChannel transport closed"),f.V_())}),d(ps.EventType.ERROR,t=>{l||(l=!0,Es("Connection","WebChannel transport errored:",t),f.V_(new Ss(As.UNAVAILABLE,"The operation could not be completed")))}),d(ps.EventType.MESSAGE,t=>{var e;if(!l){const n=t.data[0];_s(!!n);const s=n,r=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(r){vs("Connection","WebChannel received error:",r);const t=r.status;let e=function(t){const e=er[t];if(void 0!==e)return rr(e)}(t),n=r.message;void 0===e&&(e=As.INTERNAL,n="Unknown error status: "+t+" with message "+r.message),l=!0,f.V_(new Ss(e,n)),h.close()}else vs("Connection","WebChannel received:",n),f.g_(n)}}),setTimeout(()=>{f.P_()},0),f}}class dh{constructor(){this.D_=(()=>this.N_()),this.x_=(()=>this.k_()),this.O_=[],this.F_()}Ja(t){this.O_.push(t)}fh(){window.removeEventListener("online",this.D_),window.removeEventListener("offline",this.x_)}F_(){window.addEventListener("online",this.D_),window.addEventListener("offline",this.x_)}N_(){vs("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.O_)t(0)}k_(){vs("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.O_)t(1)}static Qs(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}class ph{Ja(t){}fh(){}}function gh(t){return Promise.resolve(new fh(t))}function mh(t){return new ei(t,!0)}const yh="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.";class wh{async initialize(t){this.el=this.M_(t),this.persistence=this.L_(t),await this.persistence.start(),this.q_=this.B_(t),this.Wa=this.U_(t)}B_(t){return null}U_(t){return e=this.persistence,n=new sh,s=t.W_,new Tu(e,n,s);var e,n,s}L_(t){if(t.j_.K_)throw new Ss(As.FAILED_PRECONDITION,yh);return new ah(hh.d_)}M_(t){return new Gu}async terminate(){this.q_&&this.q_.stop(),await this.el.fh(),await this.persistence.fh()}clearPersistence(t,e){throw new Ss(As.FAILED_PRECONDITION,yh)}}class vh extends wh{async initialize(t){await super.initialize(t),await async function(t){const e=Ns(t),n=Ns(e.Nh);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>n.no(t)).then(t=>{e.Dh=t})}(this.Wa)}B_(t){const e=this.persistence.br.ur;return new ga(e,t.fi)}L_(t){const e=Eu(t.y_.et,t.y_.persistenceKey),n=mh(t.y_.et);return new mu(t.j_.synchronizeTabs,e,t.clientId,pa.er(t.j_.cacheSizeBytes),t.fi,aa(),"undefined"!=typeof document?document:null,n,this.el,t.j_.Fo)}M_(t){return new Gu}clearPersistence(t,e){return Iu(Eu(t,e))}}class bh extends vh{constructor(t){super(),this.Q_=t}async initialize(t){await super.initialize(t),await this.Q_.initialize(this,t);const e=this.Q_.Eu;this.el instanceof Bu&&(this.el.Eu={Dc:async function(t,e,n,s){const r=Ns(t);r.wl("applyBatchState()");const i=await function(t,e){const n=Ns(t),s=Ns(n.os);return n.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.kr(t,e).next(e=>e?n.xh._s(t,e):Bo.resolve(null)))}(r.Wa,e);null!==i?("pending"===n?await r.tl.lu():"acknowledged"===n||"rejected"===n?(r.Vl(e,s||null),function(t,e){Ns(Ns(t).os).Br(e)}(r.Wa,e)):Ts(),await r.Rl(i)):vs("SyncEngine","Cannot apply mutation batch with id: "+e)}.bind(null,e),Nc:async function(t,e,n,s){const r=Ns(t);if(r.fl)vs("SyncEngine","Ignoring unexpected query state notification.");else if(r.rl.has(e))switch(n){case"current":case"not-current":{const t=await function(t){const e=Ns(r.Wa),n=Ns(e.Nh);return e.persistence.runTransaction("Get new document changes","readonly",t=>n.to(t,e.Dh)).then(({eo:t,readTime:n})=>(e.Dh=n,t))}(),s=Tr.se(e,"current"===n);await r.Rl(t,s);break}case"rejected":await r.Wa.Jh(e,!0),r.Il(e,s);break;default:Ts()}}.bind(null,e),xc:async function(t,e,n){const s=Ns(t);if(s.fl){for(const t of e){if(s.rl.has(t)){vs("SyncEngine","Adding an already active target "+t);continue}const e=await _u(s.Wa,t),n=await s.Wa.Hh(e);await s.Tl(Zu(e),n.targetId,!1),s.tl.listen(n)}for(const t of n)s.rl.has(t)&&await s.Wa.Jh(t,!1).then(()=>{s.tl.wu(t),s.Il(t)}).catch(Nu)}}.bind(null,e),Ih:function(t){return Ns(Ns(Ns(t).Wa).persistence).Ih()}.bind(null,e)},await this.el.start()),await this.persistence.Xo(async t=>{await async function(t,e){const n=Ns(t);if(!0===e&&!0!==n.fl){const t=n.el.ac(),e=await Ju(n,t.B());n.fl=!0,await n.tl.Nu(!0);for(const t of e)n.tl.listen(t)}else if(!1===e&&!1!==n.fl){const t=[];let e=Promise.resolve();n.rl.forEach((s,r)=>{n.el.Ic(r)?t.push(r):e=e.then(()=>(n.Il(r),n.Wa.Jh(r,!0))),n.tl.wu(r)}),await e,await Ju(n,t),function(t){const e=Ns(n);e.al.forEach((t,n)=>{e.tl.wu(n)}),e.ul.Bu(),e.al=new Map,e.hl=new ir(js.D)}(),n.fl=!1,await n.tl.Nu(!1)}}(this.Q_.Eu,t),this.q_&&(t&&!this.q_.dr?this.q_.start(this.Wa):t||this.q_.stop())})}M_(t){if(t.j_.K_&&t.j_.synchronizeTabs){const e=aa();if(!Bu.Qs(e))throw new Ss(As.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Eu(t.y_.et,t.y_.persistenceKey);return new Bu(e,t.fi,n,t.clientId,t.W_)}return new Gu}}class Eh{async initialize(t,e){if(this.Wa)return;this.Wa=t.Wa,this.el=t.el,this.Ka=this.G_(e);const n=await this.z_(e);this.Ka.start(n),this.tl=this.H_(e),this.Eu=this.J_(e),this.Y_=this.X_(e),this.el.ka=(t=>this.Eu.Hc(t,1)),this.tl.Eu=this.Eu,await this.tl.start(),await this.tl.Nu(this.Eu.dl)}z_(t){return gh(t.y_)}X_(t){return new eh(this.Eu)}G_(t){const e=mh(t.y_.et);return Ou(t.credentials,e)}H_(t){return new Ru(this.Wa,this.Ka,t.fi,t=>this.Eu.Hc(t,0),dh.Qs()?new dh:new ph)}J_(t){return function(t,e,n,s,r,i,o){const a=new Xu(t,e,n,s,r,i);return o&&(a.fl=!0),a}(this.Wa,this.tl,this.Ka,this.el,t.W_,t.nl,!t.j_.K_||!t.j_.synchronizeTabs)}terminate(){return this.tl.fh()}}function Ih(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class Th{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Z_(this.observer.next,t)}error(t){this.observer.error?this.Z_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}tf(){this.muted=!0}Z_(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}function _h(t,e,n){if(e.length!==n)throw new Ss(As.INVALID_ARGUMENT,`Function ${t}() requires `+Ch(n,"argument")+", but was called with "+Ch(e.length,"argument")+".")}function Nh(t,e,n){if(e.length<n)throw new Ss(As.INVALID_ARGUMENT,`Function ${t}() requires at least `+Ch(n,"argument")+", but was called with "+Ch(e.length,"argument")+".")}function Ah(t,e,n,s){!function(t,e,n,s){let r=!1;if(!(r="object"===e?xh(s):"non-empty string"===e?"string"==typeof s&&""!==s:typeof s===e)){const r=Oh(s);throw new Ss(As.INVALID_ARGUMENT,`Function ${t}() requires its ${n} to be of type ${e}, but it was: ${r}`)}}(t,e,kh(n)+" argument",s)}function Sh(t){if(!js.Z(t))throw new Ss(As.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Dh(t){if(js.Z(t))throw new Ss(As.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function xh(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Oh(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Ts()}function Lh(t,e,n,s){const r=Oh(s);return new Ss(As.INVALID_ARGUMENT,`Function ${t}() requires its ${kh(n)} argument to be a ${e}, but it was: ${r}`)}function Rh(t,e,n){if(n<=0)throw new Ss(As.INVALID_ARGUMENT,`Function ${t}() requires its ${kh(e)} argument to be a positive number, but it was: ${n}.`)}function kh(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Ch(t,e){return`${t} ${e}`+(1===t?"":"s")}function Ph(){if("undefined"==typeof Uint8Array)throw new Ss(As.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Vh(){if("undefined"==typeof atob)throw new Ss(As.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}class Uh{constructor(t){Vh(),this.ef=t}static fromBase64String(t){_h("Blob.fromBase64String",arguments,1),Ah("Blob.fromBase64String","string",1,t),Vh();try{return new Uh(Js.fromBase64String(t))}catch(t){throw new Ss(As.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}}static fromUint8Array(t){if(_h("Blob.fromUint8Array",arguments,1),Ph(),!(t instanceof Uint8Array))throw Lh("Blob.fromUint8Array","Uint8Array",1,t);return new Uh(Js.fromUint8Array(t))}toBase64(){return _h("Blob.toBase64",arguments,0),Vh(),this.ef.toBase64()}toUint8Array(){return _h("Blob.toUint8Array",arguments,0),Ph(),this.ef.toUint8Array()}toString(){return"Blob(base64: "+this.toBase64()+")"}isEqual(t){return this.ef.isEqual(t.ef)}}class Mh{constructor(t){!function(t,e,n,s){if(!(e instanceof Array)||e.length<1)throw new Ss(As.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Ch(1,"element")+".")}(0,t);for(let e=0;e<t.length;++e)if(Ah("FieldPath","string",e,t[e]),0===t[e].length)throw new Ss(As.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.nf=new qs(t)}}class Fh extends Mh{constructor(...t){super(t)}static documentId(){return new Fh(qs.H().U())}isEqual(t){if(!(t instanceof Fh))throw Lh("isEqual","FieldPath",1,t);return this.nf.isEqual(t.nf)}}const qh=new RegExp("[~\\*/\\[\\]]");class jh{constructor(){this.sf=this}}class $h extends jh{constructor(t){super(),this.if=t}rf(t){if(2!==t.hf)throw 1===t.hf?t.af(this.if+"() can only appear at the top level of your update data"):t.af(this.if+"() cannot be used with set() unless you pass {merge:true}");return t.He.push(t.path),null}isEqual(t){return t instanceof $h}}function Bh(t,e,n){return new tc({hf:3,uf:e.settings.uf,methodName:t.if,cf:n},e.et,e.serializer,e.ignoreUndefinedProperties)}class Gh extends jh{constructor(t){super(),this.if=t}rf(t){return new qi(t.path,new Li)}isEqual(t){return t instanceof Gh}}class zh extends jh{constructor(t,e){super(),this.if=t,this.lf=e}rf(t){const e=Bh(this,t,!0),n=this.lf.map(t=>oc(t,e)),s=new Ri(n);return new qi(t.path,s)}isEqual(t){return this===t}}class Hh extends jh{constructor(t,e){super(),this.if=t,this.lf=e}rf(t){const e=Bh(this,t,!0),n=this.lf.map(t=>oc(t,e)),s=new Ci(n);return new qi(t.path,s)}isEqual(t){return this===t}}class Wh extends jh{constructor(t,e){super(),this.if=t,this._f=e}rf(t){const e=new Vi(t.serializer,ri(t.serializer,this._f));return new qi(t.path,e)}isEqual(t){return this===t}}class Kh{constructor(t,e){if(_h("GeoPoint",arguments,2),Ah("GeoPoint","number",1,t),Ah("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new Ss(As.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Ss(As.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.ff=t,this.df=e}get latitude(){return this.ff}get longitude(){return this.df}isEqual(t){return this.ff===t.ff&&this.df===t.df}V(t){return Rs(this.ff,t.ff)||Rs(this.df,t.df)}}const Qh=/^__.*__$/;class Xh{constructor(t,e,n){this.wf=t,this.Tf=e,this.Ef=n}}class Yh{constructor(t,e,n){this.data=t,this.He=e,this.fieldTransforms=n}If(t,e){const n=[];return null!==this.He?n.push(new Yi(t,this.data,this.He,e)):n.push(new Xi(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Zi(t,this.fieldTransforms)),n}}class Jh{constructor(t,e,n){this.data=t,this.He=e,this.fieldTransforms=n}If(t,e){const n=[new Yi(t,this.data,this.He,e)];return this.fieldTransforms.length>0&&n.push(new Zi(t,this.fieldTransforms)),n}}function Zh(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ts()}}class tc{constructor(t,e,n,s,r,i){this.settings=t,this.et=e,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===r&&this.Af(),this.fieldTransforms=r||[],this.He=i||[]}get path(){return this.settings.path}get hf(){return this.settings.hf}Rf(t){return new tc(Object.assign(Object.assign({},this.settings),t),this.et,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.He)}mf(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Rf({path:n,cf:!1});return s.Pf(t),s}Vf(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Rf({path:n,cf:!1});return s.Af(),s}gf(t){return this.Rf({path:void 0,cf:!0})}af(t){return fc(t,this.settings.methodName,this.settings.yf||!1,this.path,this.settings.uf)}contains(t){return void 0!==this.He.find(e=>t.L(e))||void 0!==this.fieldTransforms.find(e=>t.L(e.field))}Af(){if(this.path)for(let t=0;t<this.path.length;t++)this.Pf(this.path.get(t))}Pf(t){if(0===t.length)throw this.af("Document fields must not be empty");if(Zh(this.hf)&&Qh.test(t))throw this.af('Document fields cannot begin and end with "__"')}}class ec{constructor(t,e,n){this.et=t,this.ignoreUndefinedProperties=e,this.serializer=n||mh(t)}pf(t,e,n,s=!1){return new tc({hf:t,methodName:e,uf:n,path:qs.K(),cf:!1,yf:s},this.et,this.serializer,this.ignoreUndefinedProperties)}}function nc(t,e,n,s,r,i={}){const o=t.pf(i.merge||i.mergeFields?2:0,e,n,r);hc("Data must be an object, but it was:",o,s);const a=ac(s,o);let u,h;if(i.merge)u=new Fi(o.He),h=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const s of i.mergeFields){let r;if(s instanceof Mh)r=s.nf;else{if("string"!=typeof s)throw Ts();r=lc(e,s,n)}if(!o.contains(r))throw new Ss(As.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);dc(t,r)||t.push(r)}u=new Fi(t),h=o.fieldTransforms.filter(t=>u.en(t.field))}else u=null,h=o.fieldTransforms;return new Yh(new ro(a),u,h)}function sc(t,e,n,s){const r=t.pf(1,e,n);hc("Data must be an object, but it was:",r,s);const i=[],o=new io;kr(s,(t,s)=>{const a=lc(e,t,n),u=r.Vf(a);if(s instanceof jh&&s.sf instanceof $h)i.push(a);else{const t=oc(s,u);null!=t&&(i.push(a),o.set(a,t))}});const a=new Fi(i);return new Jh(o.sn(),a,r.fieldTransforms)}function rc(t,e,n,s,r,i){const o=t.pf(1,e,n),a=[cc(e,s,n)],u=[r];if(i.length%2!=0)throw new Ss(As.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<i.length;t+=2)a.push(cc(e,i[t])),u.push(i[t+1]);const h=[],c=new io;for(let t=a.length-1;t>=0;--t)if(!dc(h,a[t])){const e=a[t],n=u[t],s=o.Vf(e);if(n instanceof jh&&n.sf instanceof $h)h.push(e);else{const t=oc(n,s);null!=t&&(h.push(e),c.set(e,t))}}const l=new Fi(h);return new Jh(c.sn(),l,o.fieldTransforms)}function ic(t,e,n,s=!1){return oc(n,t.pf(s?4:3,e))}function oc(t,e){if(uc(t))return hc("Unsupported field value:",e,t),ac(t,e);if(t instanceof jh)return function(t,e){if(!Zh(e.hf))throw e.af(t.if+"() can only be used with update() and set()");if(!e.path)throw e.af(t.if+"() is not currently supported inside arrays");const n=t.rf(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.He.push(e.path),t instanceof Array){if(e.settings.cf&&4!==e.hf)throw e.af("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const r of t){let t=oc(r,e.gf(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ri(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Ps.fromDate(t);return{timestampValue:ii(e.serializer,n)}}if(t instanceof Ps){const n=new Ps(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ii(e.serializer,n)}}if(t instanceof Kh)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Uh)return{bytesValue:oi(e.serializer,t)};if(t instanceof Xh){const n=e.et,s=t.wf;if(!s.isEqual(n))throw e.af(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ui(t.wf||e.et,t.Tf.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.af("Unsupported field value: "+Oh(t))}(t,e)}function ac(t,e){const n={};return Cr(t)?e.path&&e.path.length>0&&e.He.push(e.path):kr(t,(t,s)=>{const r=oc(s,e.mf(t));null!=r&&(n[t]=r)}),{mapValue:{fields:n}}}function uc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ps||t instanceof Kh||t instanceof Uh||t instanceof Xh||t instanceof jh)}function hc(t,e,n){if(!uc(n)||!xh(n)){const s=Oh(n);throw"an object"===s?e.af(t+" a custom object"):e.af(t+" "+s)}}function cc(t,e,n){if(e instanceof Mh)return e.nf;if("string"==typeof e)return lc(t,e);throw fc("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function lc(t,e,n){try{return function(t){if(t.search(qh)>=0)throw new Ss(As.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`);try{return new Fh(...t.split("."))}catch(e){throw new Ss(As.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`)}}(e).nf}catch(e){throw fc((s=e)instanceof Error?s.message:s.toString(),t,!1,void 0,n)}var s}function fc(t,e,n,s,r){const i=s&&!s.$(),o=void 0!==r;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=" in field "+s),o&&(u+=" in document "+r),u+=")"),new Ss(As.INVALID_ARGUMENT,a+t+u)}function dc(t,e){return t.some(t=>t.isEqual(e))}class pc{constructor(t){this.Ka=t,this.bf=new Map,this.mutations=[],this.vf=!1,this.Sf=null,this.Cf=new Set}async Df(t){if(this.Nf(),this.mutations.length>0)throw new Ss(As.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=Ns(t),s=pi(n.serializer)+"/documents",r={documents:e.map(t=>ci(n.serializer,t))},i=await n.Na("BatchGetDocuments",s,r),o=new Map;i.forEach(t=>{const e=function(t,e){return"found"in e?function(t,e){_s(!!e.found),e.found.name,e.found.updateTime;const n=li(t,e.found.name),s=ai(e.found.updateTime),r=new ro({mapValue:{fields:e.found.fields}});return new uo(n,s,r,{})}(t,e):"missing"in e?function(t,e){_s(!!e.missing),_s(!!e.readTime);const n=li(t,e.missing),s=ai(e.readTime);return new ho(n,s)}(t,e):Ts()}(n.serializer,t);o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{const e=o.get(t.toString());_s(!!e),a.push(e)}),a}(this.Ka,t);return e.forEach(t=>{t instanceof ho||t instanceof uo?this.xf(t):Ts()}),e}set(t,e){this.write(e.If(t,this.Xe(t))),this.Cf.add(t)}update(t,e){try{this.write(e.If(t,this.kf(t)))}catch(t){this.Sf=t}this.Cf.add(t)}delete(t){this.write([new no(t,this.Xe(t))]),this.Cf.add(t)}async commit(){if(this.Nf(),this.Sf)throw this.Sf;const t=this.bf;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,e)=>{const n=new js(Ms.W(e));this.mutations.push(new so(n,this.Xe(n)))}),await async function(t,e){const n=Ns(t),s=pi(n.serializer)+"/documents",r={writes:e.map(t=>yi(n.serializer,t))};await n.Da("Commit",s,r)}(this.Ka,this.mutations),this.vf=!0}xf(t){let e;if(t instanceof uo)e=t.version;else{if(!(t instanceof ho))throw Ts();e=Vs.min()}const n=this.bf.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Ss(As.ABORTED,"Document version changed between two reads.")}else this.bf.set(t.key.toString(),e)}Xe(t){const e=this.bf.get(t.toString());return!this.Cf.has(t)&&e?$i.updateTime(e):$i.Ze()}kf(t){const e=this.bf.get(t.toString());if(!this.Cf.has(t)&&e){if(e.isEqual(Vs.min()))throw new Ss(As.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return $i.updateTime(e)}return $i.exists(!0)}write(t){this.Nf(),this.mutations=this.mutations.concat(t)}Nf(){}}class gc{constructor(t,e,n,s){this.fi=t,this.Ka=e,this.updateFunction=n,this.Ti=s,this.Of=5,this.vi=new Yo(this.fi,"transaction_retry")}run(){this.Ff()}Ff(){this.vi.Ls(async()=>{const t=new pc(this.Ka),e=this.Mf(t);e&&e.then(e=>{this.fi.Ri(()=>t.commit().then(()=>{this.Ti.resolve(e)}).catch(t=>{this.$f(t)}))}).catch(t=>{this.$f(t)})})}Mf(t){try{const e=this.updateFunction(t);return!Gs(e)&&e.catch&&e.then?e:(this.Ti.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Ti.reject(t),null}}$f(t){this.Of>0&&this.Lf(t)?(this.Of-=1,this.fi.Ri(()=>(this.Ff(),Promise.resolve()))):this.Ti.reject(t)}Lf(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!sr(e)}return!1}}function mc(t,e,n){const s=new Xo;return t.Ri(()=>e.write(n,s)),s.promise}function yc(t,e,n,s){return t.enqueue(()=>(n.th(s),s?e.enableNetwork():e.disableNetwork()))}function wc(t,e,n,s,r){const i=new Th(r),o=new nh(n,i,s);return t.Ri(()=>e.listen(o)),()=>{i.tf(),t.Ri(()=>e.wu(o))}}function vc(t,e,n,s){const r=new Xo,i=wc(t,e,go(n.path),{includeMetadataChanges:!0,jl:!0},{next:t=>{i();const e=t.docs.has(n);!e&&t.fromCache?r.reject(new Ss(As.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&s&&"server"===s.source?r.reject(new Ss(As.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(t)},error:t=>r.reject(t)});return r.promise}function bc(t,e,n,s){const r=new Xo,i=wc(t,e,n,{includeMetadataChanges:!0,jl:!0},{next:t=>{i(),t.fromCache&&s&&"server"===s.source?r.reject(new Ss(As.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(t)},error:t=>r.reject(t)});return r.promise}const Ec=new Map;class Ic{constructor(t,e){this.app=t,this.qf="(lite)",this.Bf=!1,this.INTERNAL={delete:()=>this.delete()},this.wf=Ic.Uf(t),this.Wf=new xs(e)}get Kf(){return this.Bf}get jf(){return void 0!==this.Qf}Gf(t){if(this.Bf)throw new Ss(As.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. initializeFirestore() cannot be called after calling getFirestore().");this.zf=t}Hf(){return this.zf||(this.zf={}),this.Bf=!0,this.zf}static Uf(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Ss(As.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Bs(t.options.projectId)}delete(){return this.Qf||(this.Qf=this.Jf()),this.Qf}Jf(){return async function(t){const e=await Ec.get(t);if(e)return vs("ComponentProvider","Removing Datastore"),Ec.delete(t),(await e).xa()}(this)}}class Tc{constructor(t,e,n,s){this.et=t,this.timestampsInSnapshots=e,this.Yf=n,this.Xf=s}Zf(t){switch(Mr(t)){case 0:return null;case 1:return t.booleanValue;case 2:return zr(t.integerValue||t.doubleValue);case 3:return this.td(t.timestampValue);case 4:return this.ed(t);case 5:return t.stringValue;case 6:return new Uh(Hr(t.bytesValue));case 7:return this.nd(t.referenceValue);case 8:return this.sd(t.geoPointValue);case 9:return this.rd(t.arrayValue);case 10:return this.od(t.mapValue);default:throw Ts()}}od(t){const e={};return kr(t.fields||{},(t,n)=>{e[t]=this.Zf(n)}),e}sd(t){return new Kh(zr(t.latitude),zr(t.longitude))}rd(t){return(t.values||[]).map(t=>this.Zf(t))}ed(t){switch(this.Yf){case"previous":const e=function t(e){const n=e.mapValue.fields.__previous_value__;return Pr(n)?t(n):n}(t);return null==e?null:this.Zf(e);case"estimate":return this.td(Vr(t));default:return null}}td(t){const e=Gr(t),n=new Ps(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()}nd(t){const e=Ms.W(t);_s(Ai(e));const n=new Bs(e.get(1),e.get(3)),s=new js(e.k(5));return n.isEqual(this.et)||bs(`Document ${s} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${this.et.projectId}/${this.et.database}) instead.`),this.Xf(s)}}const _c=pa.ir;class Nc{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}function Ac(t,e,n){if("string"==typeof n){if(""===n)throw new Ss(As.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!mo(e)&&-1!==n.indexOf("/"))throw new Ss(As.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(Ms.W(n));if(!js.Z(s))throw new Ss(As.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Wr(t,new js(s))}if(n instanceof Xh)return Wr(t,n.Tf);throw new Ss(As.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Oh(n)+".")}function Sc(t,e){if(!Array.isArray(t)||0===t.length)throw new Ss(As.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new Ss(As.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`);if("in"===e||"array-contains-any"===e){if(t.indexOf(null)>=0)throw new Ss(As.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters cannot contain 'null' in the value array.`);if(t.filter(t=>Number.isNaN(t)).length>0)throw new Ss(As.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters cannot contain 'NaN' in the value array.`)}}function Dc(t,e,n){if(!n.isEqual(e))throw new Ss(As.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function xc(t){if(t.In()&&0===t.ln.length)throw new Ss(As.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function Oc(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}const Lc=new Map,Rc=new Map;async function kc(t,e,n){const s=new Xo;Lc.set(t,s.promise);const r=await t.hd();r.j_=e,vs("ComponentProvider","Initializing OfflineComponentProvider"),await n.initialize(r),t.ad(e=>t.ud.Ri(()=>n.Wa.Oh(e))),n.persistence.Zo(()=>t.delete()),s.resolve(n)}async function Cc(t,e){const n=new Xo;Rc.set(t,n.promise);const s=await t.hd(),r=await Pc(t);vs("ComponentProvider","Initializing OnlineComponentProvider"),await e.initialize(r,s),t.ad(n=>t.ud.Ri(()=>e.tl.Du(n))),n.resolve(e)}function Pc(t){return Uc(t),Lc.has(t)||(vs("ComponentProvider","Using default OfflineComponentProvider"),kc(t,{K_:!1},new wh)),Lc.get(t)}function Vc(t){return Uc(t),Rc.has(t)||(vs("ComponentProvider","Using default OnlineComponentProvider"),Cc(t,new Eh)),Rc.get(t)}function Uc(t){if(t.jf)throw new Ss(As.FAILED_PRECONDITION,"The client has already been terminated.")}function Mc(t){return Vc(t).then(t=>t.Eu)}function Fc(t){return Vc(t).then(t=>t.tl)}function qc(t){return Vc(t).then(t=>t.Y_)}function jc(t){return Pc(t).then(t=>t.persistence)}function $c(t){return Pc(t).then(t=>t.Wa)}class Bc extends Ic{constructor(t,e){super(t,e),this.ud=new ha,this.ld=Ls.P(),this._d=new Xo,this.fd=ms.UNAUTHENTICATED,this.dd=(()=>{}),this.qf=t.name,this.Wf.R(t=>{this.fd=t,this._d.resolve()})}ad(t){vs("Firestore","Registering credential change listener"),this.dd=t,this._d.promise.then(()=>this.dd(this.fd))}async hd(){var t,e;const n=this.Hf();await this._d.promise;const s=new $s(this.wf,this.qf,null!==(t=n.host)&&void 0!==t?t:"firestore.googleapis.com",null===(e=n.ssl)||void 0===e||e,!1);return{fi:this.ud,y_:s,clientId:this.ld,credentials:this.Wf,W_:this.fd,nl:100,j_:{K_:!1}}}Hf(){return super.Hf()}Jf(){return this.ud.Oi(async()=>{await super.Jf(),await async function(t){const e=Rc.get(t);e&&(vs("ComponentProvider","Removing OnlineComponentProvider"),Rc.delete(t),await(await e).terminate());const n=Lc.get(t);n&&(vs("ComponentProvider","Removing OfflineComponentProvider"),Lc.delete(t),await(await n).terminate())}(this),this.Wf.m()})}}function Gc(t){if(t.Kf)throw new Ss(As.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class zc extends Mh{constructor(...t){super(t)}isEqual(t){const e=lo(t,zc);return this.nf.isEqual(e.nf)}}class Hc extends Xh{constructor(t,e,n){super(t.wf,new js(n),e),this.firestore=t,this.converter=e,this.wd=n,this.type="document"}get id(){return this.wd.M()}get path(){return this.wd.U()}withConverter(t){return new Hc(this.firestore,t,this.wd)}}class Wc{constructor(t,e,n){this.firestore=t,this.converter=e,this.Td=n,this.type="query"}withConverter(t){return new Wc(this.firestore,t,this.Td)}}class Kc{}class Qc extends Kc{constructor(t,e,n){super(),this.Ed=t,this.Id=e,this.Ad=n,this.type="where"}apply(t){const e=rl(t.firestore),n=function(t,e,n,s,r,i,o){let a;if(r.G()){if("array-contains"===i||"array-contains-any"===i)throw new Ss(As.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on FieldPath.documentId().`);if("in"===i||"not-in"===i){Sc(o,i);const e=[];for(const n of o)e.push(Ac(s,t,n));a={arrayValue:{values:e}}}else a=Ac(s,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Sc(o,i),a=ic(n,e,o,"in"===i||"not-in"===i);const u=_o.create(r,i,a);return function(t,e){if(e.mn()){const n=t.Rn();if(null!==n&&!n.isEqual(e.field))throw new Ss(As.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=t.An();null!==s&&Dc(0,e.field,s)}const n=t.Pn(function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==n)throw n===e.op?new Ss(As.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Ss(As.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,u),u}(t.Td,"where",e,t.firestore.wf,this.Ed,this.Id,this.Ad);return new Wc(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new fo(t.path,t.collectionGroup,t.ln.slice(),n,t.limit,t._n,t.startAt,t.endAt)}(t.Td,n))}}class Xc extends Kc{constructor(t,e){super(),this.Ed=t,this.Rd=e,this.type="orderBy"}apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new Ss(As.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Ss(As.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new Uo(e,n);return function(t,e){if(null===t.An()){const n=t.Rn();null!==n&&Dc(0,n,e.field)}}(t,s),s}(t.Td,this.Ed,this.Rd);return new Wc(t.firestore,t.converter,function(t,e){const n=t.ln.concat([e]);return new fo(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t._n,t.startAt,t.endAt)}(t.Td,e))}}class Yc extends Kc{constructor(t,e,n){super(),this.type=t,this.md=e,this.Pd=n}apply(t){return new Wc(t.firestore,t.converter,function(t,e,n){return new fo(t.path,t.collectionGroup,t.ln.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}(t.Td,this.md,this.Pd))}}class Jc extends Kc{constructor(t,e,n){super(),this.type=t,this.Vd=e,this.gd=n}apply(t){const e=tl(t,this.type,this.Vd,this.gd);return new Wc(t.firestore,t.converter,function(t,e){return new fo(t.path,t.collectionGroup,t.ln.slice(),t.filters.slice(),t.limit,t._n,e,t.endAt)}(t.Td,e))}}class Zc extends Kc{constructor(t,e,n){super(),this.type=t,this.Vd=e,this.gd=n}apply(t){const e=tl(t,this.type,this.Vd,this.gd);return new Wc(t.firestore,t.converter,function(t,e){return new fo(t.path,t.collectionGroup,t.ln.slice(),t.filters.slice(),t.limit,t._n,t.startAt,e)}(t.Td,e))}}function tl(t,e,n,s){if(n[0]instanceof il)return _h(e,n,1),function(t,e,n,s,r){if(!s)throw new Ss(As.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");const i=[];for(const n of yo(t))if(n.field.G())i.push(Wr(e,s.key));else{const t=s.field(n.field);if(Pr(t))throw new Ss(As.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.U();throw new Ss(As.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}i.push(t)}return new ko(i,r)}(t.Td,t.firestore.wf,e,n[0].yd,s);{const r=rl(t.firestore);return function(t,e,n,s,r,i){const o=t.ln;if(r.length>o.length)throw new Ss(As.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<r.length;i++){const u=r[i];if(o[i].field.G()){if("string"!=typeof u)throw new Ss(As.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof u}`);if(!mo(t)&&-1!==u.indexOf("/"))throw new Ss(As.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${s}() must be a plain document ID, but '${u}' contains a slash.`);const n=t.path.child(Ms.W(u));if(!js.Z(n))throw new Ss(As.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const r=new js(n);a.push(Wr(e,r))}else{const t=ic(n,s,u);a.push(t)}}return new ko(a,i)}(t.Td,t.firestore.wf,r,e,n,s)}}class el extends Wc{constructor(t,e,n){super(t,n,go(e)),this.firestore=t,this.wd=e,this.type="collection"}get id(){return this.Td.path.M()}get path(){return this.Td.path.U()}withConverter(t){return new el(this.firestore,this.wd,t)}}function nl(t,e){if(1===arguments.length&&(e=Ls.P()),Ah("doc","non-empty string",2,e),t instanceof Ic){const n=Ms.W(e);return Sh(n),new Hc(t,null,n)}{if(!(t instanceof Hc||t instanceof el))throw new Ss(As.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t.wd.child(Ms.W(e));return Sh(n),new Hc(t.firestore,t instanceof el?t.converter:null,n)}}function sl(t,e){return t instanceof Wc&&e instanceof Wc&&t.firestore===e.firestore&&vo(t.Td,e.Td)&&t.converter===e.converter}function rl(t){const e=t.Hf(),n=mh(t.wf);return new ec(t.wf,!!e.ignoreUndefinedProperties,n)}class il{constructor(t,e,n,s){this.pd=t,this.Tf=e,this.yd=n,this.Ef=s}get id(){return this.Tf.path.M()}get ref(){return new Hc(this.pd,this.Ef,this.Tf.path)}exists(){return null!==this.yd}data(){if(this.yd){if(this.Ef){const t=new ol(this.pd,this.Tf,this.yd,null);return this.Ef.fromFirestore(t)}return new Tc(this.pd.wf,!0,"none",t=>new Hc(this.pd,null,t.path)).Zf(this.yd.cn())}}get(t){if(this.yd){const e=this.yd.data().field(al("DocumentSnapshot.get",t));if(null!==e)return new Tc(this.pd.wf,!0,"none",t=>new Hc(this.pd,this.Ef,t.path)).Zf(e)}}}class ol extends il{data(){return super.data()}}function al(t,e){return"string"==typeof e?lc(t,e):lo(e,zc).nf}class ul extends il{constructor(t,e,n,s,r){super(t,e,n,r),this.pd=t,this.metadata=s,this.bd=lo(t,Bc)}exists(){return super.exists()}data(t){if(this.yd){if(this.Ef){const e=new hl(this.pd,this.Tf,this.yd,this.metadata,null);return this.Ef.fromFirestore(e,t)}return new Tc(this.bd.wf,!0,(null==t?void 0:t.serverTimestamps)||"none",t=>new Hc(this.pd,null,t.path)).Zf(this.yd.cn())}}get(t,e={}){if(this.yd){const n=this.yd.data().field(al("DocumentSnapshot.get",t));if(null!==n)return new Tc(this.bd.wf,!0,e.serverTimestamps||"none",t=>new Hc(this.pd,this.Ef,t.path)).Zf(n)}}}class hl extends ul{data(t={}){return super.data(t)}}class cl{constructor(t,e,n){this.pd=t,this.query=e,this.vd=n,this.metadata=new Nc(n.hasPendingWrites,n.fromCache)}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this.vd.docs.size}get empty(){return 0===this.size}forEach(t,e){this.vd.docs.forEach(n=>{t.call(e,this.Sd(n,this.vd.fromCache,this.vd.Ht.has(n.key)))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this.vd.Yt)throw new Ss(As.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Cd&&this.Dd===e||(this.Cd=function(t,e,n){if(t.zt.$()){let e,s=0;return t.docChanges.map(r=>{const i=n(r.doc,t.fromCache,t.Ht.has(r.doc.key));return e=r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:s++}})}{let s=t.zt;return t.docChanges.filter(t=>e||3!==t.type).map(e=>{const r=n(e.doc,t.fromCache,t.Ht.has(e.doc.key));let i=-1,o=-1;return 0!==e.type&&(i=s.indexOf(e.doc.key),s=s.delete(e.doc.key)),1!==e.type&&(o=(s=s.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ts()}}(e.type),doc:r,oldIndex:i,newIndex:o}})}}(this.vd,e,this.Sd.bind(this)),this.Dd=e),this.Cd}Sd(t,e,n){return new hl(this.pd,t.key,t,new Nc(n,e),this.query.converter)}}class ll{constructor(t,e){this.pd=t,this.Nd=e,this.xd=[],this.kd=!1,this.Od=rl(t)}set(t,e,n){this.Fd();const s=fl(t,this.pd),r=Oc(s.Ef,e,n),i=nc(this.Od,"WriteBatch.set",s.Tf,r,null!==s.Ef,n);return this.xd=this.xd.concat(i.If(s.Tf,$i.Ze())),this}update(t,e,n,...s){this.Fd();const r=fl(t,this.pd);let i;return i="string"==typeof e||e instanceof zc?rc(this.Od,"WriteBatch.update",r.Tf,e,n,s):sc(this.Od,"WriteBatch.update",r.Tf,e),this.xd=this.xd.concat(i.If(r.Tf,$i.exists(!0))),this}delete(t){this.Fd();const e=fl(t,this.pd);return this.xd=this.xd.concat(new no(e.Tf,$i.Ze())),this}commit(){return this.Fd(),this.kd=!0,this.xd.length>0?this.Nd(this.xd):Promise.resolve()}Fd(){if(this.kd)throw new Ss(As.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function fl(t,e){if(t.firestore!==e)throw new Ss(As.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return lo(t,Hc)}class dl extends class{constructor(t,e){this.pd=t,this.Md=e,this.Od=rl(t)}get(t){const e=fl(t,this.pd);return this.Md.Df([e.Tf]).then(t=>{if(!t||1!==t.length)return Ts();const n=t[0];if(n instanceof ho)return new il(this.pd,e.Tf,null,e.Ef);if(n instanceof uo)return new il(this.pd,n.key,n,e.Ef);throw Ts()})}set(t,e,n){const s=fl(t,this.pd),r=Oc(s.Ef,e,n),i=nc(this.Od,"Transaction.set",s.Tf,r,null!==s.Ef,n);return this.Md.set(s.Tf,i),this}update(t,e,n,...s){const r=fl(t,this.pd);let i;return i="string"==typeof e||e instanceof zc?rc(this.Od,"Transaction.update",r.Tf,e,n,s):sc(this.Od,"Transaction.update",r.Tf,e),this.Md.update(r.Tf,i),this}delete(t){const e=fl(t,this.pd);return this.Md.delete(e.Tf),this}}{constructor(t,e){super(t,e),this.pd=t}get(t){const e=fl(t,this.pd);return super.get(t).then(t=>new ul(this.pd,e.Tf,t.yd,new Nc(!1,!1),e.Ef))}}function pl(t,e,n){const s=n.docs.get(e.Tf);return new ul(t,e.Tf,s,new Nc(n.hasPendingWrites,n.fromCache),e.Ef)}class gl extends jh{}class ml extends gl{constructor(t){super(),this.sf=t,this.if=t.if}rf(t){return this.sf.rf(t)}isEqual(t){return t instanceof ml&&this.sf.isEqual(t.sf)}}e._registerComponent(new c("firestore-exp",t=>((t,e)=>new Bc(t,e))(t.getProvider("app-exp").getImmediate(),t.getProvider("auth-internal")),"PUBLIC")),e.registerVersion("firestore-exp","0.0.800","node"),t.Blob=Uh,t.CollectionReference=el,t.DocumentReference=Hc,t.DocumentSnapshot=ul,t.FieldPath=zc,t.FieldValue=gl,t.FirebaseFirestore=Bc,t.GeoPoint=Kh,t.Query=Wc,t.QueryConstraint=Kc,t.QueryDocumentSnapshot=hl,t.QuerySnapshot=cl,t.SnapshotMetadata=Nc,t.Timestamp=Ps,t.Transaction=dl,t.WriteBatch=ll,t.addDoc=function(t,e){const n=lo(t,el),s=lo(n.firestore,Bc),r=nl(n),i=Oc(n.converter,e),o=nc(rl(n.firestore),"addDoc",r.Tf,i,null!==n.converter,{});return Mc(s).then(t=>mc(s.ud,t,o.If(r.Tf,$i.exists(!1)))).then(()=>r)},t.arrayRemove=function(...t){return Nh("arrayRemove()",arguments,1),new ml(new Hh("arrayRemove",t))},t.arrayUnion=function(...t){return Nh("arrayUnion()",arguments,1),new ml(new zh("arrayUnion",t))},t.clearIndexedDbPersistence=function(t){const e=lo(t,Bc);if(e.Kf&&!e.jf)throw new Ss(As.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const n=new Xo;return e.ud.Di(async()=>{try{await Iu(Eu(e.wf,e.qf)),n.resolve()}catch(t){n.reject(t)}}),n.promise},t.collection=function(t,e){if(Ah("collection","non-empty string",2,e),t instanceof Ic){const n=Ms.W(e);return Dh(n),new el(t,n,null)}{if(!(t instanceof Hc||t instanceof el))throw new Ss(As.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=Ms.W(t.path).child(Ms.W(e));return Dh(n),new el(t.firestore,n,null)}},t.collectionGroup=function(t,e){const n=lo(t,Ic);if(Ah("collectionGroup","non-empty string",1,e),e.indexOf("/")>=0)throw new Ss(As.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Wc(n,null,function(t){return new fo(Ms.K(),t)}(e))},t.deleteDoc=function(t){const e=lo(t,Hc),n=lo(e.firestore,Bc);return Mc(n).then(t=>mc(n.ud,t,[new no(e.Tf,$i.Ze())]))},t.deleteField=function(){return new ml(new $h("deleteField"))},t.disableNetwork=function(t){const e=lo(t,Bc);return Promise.all([Fc(e),jc(e)]).then(([t,n])=>yc(e.ud,t,n,!1))},t.doc=nl,t.documentId=function(){return new zc("__name__")},t.enableIndexedDbPersistence=function(t){const e=lo(t,Bc);return Gc(e),kc(e,{K_:!0,synchronizeTabs:!1,cacheSizeBytes:e.Hf().cacheSizeBytes||pa.or,Fo:!1},new vh)},t.enableMultiTabIndexedDbPersistence=function(t){const e=lo(t,Bc);Gc(e);const n=e.Hf(),s=new Eh,r=new bh(s);return kc(e,{K_:!0,synchronizeTabs:!0,cacheSizeBytes:n.cacheSizeBytes||pa.or,Fo:!1},r).then(()=>Cc(e,s))},t.enableNetwork=function(t){const e=lo(t,Bc);return Promise.all([Fc(e),jc(e)]).then(([t,n])=>yc(e.ud,t,n,!0))},t.endAt=function(...t){return new Zc("endAt",t,!1)},t.endBefore=function(...t){return new Zc("endBefore",t,!0)},t.getDoc=function(t){const e=lo(t,Hc),n=lo(e.firestore,Bc);return qc(n).then(t=>vc(n.ud,t,e.Tf).then(t=>pl(n,e,t)))},t.getDocFromCache=function(t){const e=lo(t,Hc),n=lo(e.firestore,Bc);return $c(n).then(t=>(async function(t,e,n){const s=new Xo;return await t.enqueue(async()=>{try{const t=await e.zh(n);t instanceof uo?s.resolve(t):t instanceof ho?s.resolve(null):s.reject(new Ss(As.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const e=ca(t,`Failed to get document '${n} from cache`);s.reject(e)}}),s.promise})(n.ud,t,e.Tf).then(t=>new ul(n,e.Tf,t,new Nc(t instanceof uo&&t.nn,!0),e.Ef)))},t.getDocFromServer=function(t){const e=lo(t,Hc),n=lo(e.firestore,Bc);return qc(n).then(t=>vc(n.ud,t,e.Tf,{source:"server"}).then(t=>pl(n,e,t)))},t.getDocs=function(t){const e=lo(t,Wc),n=lo(t.firestore,Bc);return xc(e.Td),qc(n).then(t=>bc(n.ud,t,e.Td).then(t=>new cl(n,e,t)))},t.getDocsFromCache=function(t){const e=lo(t,Wc),n=lo(t.firestore,Bc);return $c(n).then(t=>(async function(t,e,n){const s=new Xo;return await t.enqueue(async()=>{try{const t=await e.Yh(n,!0),r=new Wu(n,t.Xh),i=r.Uc(t.documents),o=r.ts(i,!1);s.resolve(o.snapshot)}catch(t){const e=ca(t,`Failed to execute query '${n} against cache`);s.reject(e)}}),s.promise})(n.ud,t,e.Td).then(t=>new cl(n,e,t)))},t.getDocsFromServer=function(t){const e=lo(t,Wc),n=lo(t.firestore,Bc);return qc(n).then(t=>bc(n.ud,t,e.Td,{source:"server"}).then(t=>new cl(n,e,t)))},t.getFirestore=function(t){return e._getProvider(t,"firestore-exp").getImmediate()},t.increment=function(t){return new ml(new Wh("increment",t))},t.initializeFirestore=function(t,n){const s=e._getProvider(t,"firestore-exp").getImmediate();if(void 0!==n.cacheSizeBytes&&n.cacheSizeBytes!==_c&&n.cacheSizeBytes<pa.rr)throw new Ss(As.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+pa.rr);return s.Gf(n),s},t.limit=function(t){return Rh("limit",1,t),new Yc("limit",t,"F")},t.limitToLast=function(t){return Rh("limitToLast",1,t),new Yc("limitToLast",t,"L")},t.onSnapshot=function(t,...e){var n,s,r;let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Ih(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(Ih(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(r=t.complete)||void 0===r?void 0:r.bind(t)}let u;if(t instanceof Hc){const n=lo(t.firestore,Bc),s={next:s=>{e[o]&&e[o](pl(n,t,s))},error:e[o+1],complete:e[o+2]};u=qc(n).then(e=>wc(n.ud,e,go(t.Tf.path),a,s))}else{const n=lo(t,Wc),s=lo(n.firestore,Bc),r={next:t=>{e[o]&&e[o](new cl(s,n,t))},error:e[o+1],complete:e[o+2]};xc(n.Td),u=qc(s).then(t=>wc(s.ud,t,n.Td,a,r))}return()=>{u.then(t=>t())}},t.onSnapshotsInSync=function(t,e){const n=lo(t,Bc),s=Ih(e)?e:{next:e},r=qc(n).then(t=>(function(t,e,n){const s=new Th(n);return t.Ri(async()=>e.Ml(s)),()=>{s.tf(),t.Ri(async()=>e.$l(s))}})(n.ud,t,s));return()=>{r.then(t=>t())}},t.orderBy=function(t,e="asc"){const n=e,s=al("orderBy",t);return new Xc(s,n)},t.parent=function(t){if(t instanceof el){const e=t.wd.O();return e.$()?null:new Hc(t.firestore,null,e)}{const e=lo(t,Hc);return new el(e.firestore,e.Tf.path.O(),e.Ef)}},t.query=function(t,...e){let n=lo(t,Wc);for(const t of e)n=t.apply(n);return n},t.queryEqual=sl,t.refEqual=function(t,e){return(t instanceof Hc||t instanceof el)&&(e instanceof Hc||e instanceof el)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter},t.runTransaction=function(t,e){const n=lo(t,Bc);return function(t){var e,n;if(t.jf)throw new Ss(As.FAILED_PRECONDITION,"The client has already been terminated.");if(!Ec.has(t)){vs("ComponentProvider","Initializing Datastore");const s=t.Hf(),r=new $s(t.wf,t.qf,null!==(e=s.host)&&void 0!==e?e:"firestore.googleapis.com",null===(n=s.ssl)||void 0===n||n,!1),i=gh(r).then(e=>{const n=mh(r.et),s=Ou(t.Wf,n);return s.start(e),s});Ec.set(t,i)}return Ec.get(t)}(n).then(async t=>{const s=new Xo;return new gc(new ha,t,t=>e(new dl(n,t)),s).run(),s.promise})},t.serverTimestamp=function(){return new ml(new Gh("serverTimestamp"))},t.setDoc=function(t,e,n){const s=lo(t,Hc),r=lo(s.firestore,Bc),i=Oc(s.Ef,e,n),o=nc(rl(r),"setDoc",s.Tf,i,null!==s.Ef,n);return Mc(r).then(t=>mc(r.ud,t,o.If(s.Tf,$i.Ze())))},t.setLogLevel=function(t){ys.setLogLevel(t)},t.snapshotEqual=function(t,e){return t instanceof ul&&e instanceof ul?t.pd===e.pd&&t.Tf.isEqual(e.Tf)&&(null===t.yd?null===e.yd:t.yd.isEqual(e.yd))&&t.Ef===e.Ef:t instanceof cl&&e instanceof cl&&t.pd===e.pd&&sl(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.vd.isEqual(e.vd)},t.startAfter=function(...t){return new Jc("startAfter",t,!1)},t.startAt=function(...t){return new Jc("startAt",t,!0)},t.terminate=function(t){return e._removeServiceInstance(t.app,"firestore-exp"),lo(t,Bc).delete()},t.updateDoc=function(t,e,n,...s){const r=lo(t,Hc),i=lo(r.firestore,Bc),o=rl(i);let a;return a="string"==typeof e||e instanceof zc?rc(o,"updateDoc",r.Tf,e,n,s):sc(o,"updateDoc",r.Tf,e),Mc(i).then(t=>mc(i.ud,t,a.If(r.Tf,$i.exists(!0))))},t.waitForPendingWrites=function(t){const e=lo(t,Bc);return Mc(e).then(t=>(function(t,e){const n=new Xo;return t.Ri(()=>e.yl(n)),n.promise})(e.ud,t))},t.where=function(t,e,n){const s=e,r=al("where",t);return new Qc(r,s,n)},t.writeBatch=function(t){const e=lo(t,Bc);return new ll(e,t=>Mc(e).then(n=>mc(e.ud,n,t)))},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase["firestore-lite"]=t.firebase["firestore-lite"]||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var s="FirebaseError",r=function(t){function e(n,r){var o=t.call(this,r)||this;return o.code=n,o.name=s,Object.setPrototypeOf(o,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,i.prototype.create),o}return function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}(e,t),e}(Error),i=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var s=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(u,function(t,n){var s=e[n];return null!=s?String(s):"<"+n+"?>"})}(o,s):"Error",h=this.serviceName+": "+a+" ("+i+").",c=new r(i,h),l=0,f=Object.keys(s);l<f.length;l++){var d=f[l];"_"!==d.slice(-1)&&(d in c&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),c[d]=s[d])}return c},t}();var o,a,u=/\{\$([^}]+)}/g,h=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}();function c(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var s=Array(t),r=0;for(e=0;e<n;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,r++)s[r]=i[o];return s}!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(a||(a={}));var l={debug:a.DEBUG,verbose:a.VERBOSE,info:a.INFO,warn:a.WARN,error:a.ERROR,silent:a.SILENT},f=a.INFO,d=((o={})[a.DEBUG]="log",o[a.VERBOSE]="log",o[a.INFO]="info",o[a.WARN]="warn",o[a.ERROR]="error",o),p=function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(!(e<t.logLevel)){var r=(new Date).toISOString(),i=d[e];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[i].apply(console,c(["["+r+"]  "+t.name+":"],n))}},g=function(){function t(t){this.name=t,this._logLevel=f,this._logHandler=p,this._userLogHandler=null}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in a))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?l[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,c([this,a.DEBUG],t)),this._logHandler.apply(this,c([this,a.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,c([this,a.VERBOSE],t)),this._logHandler.apply(this,c([this,a.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,c([this,a.INFO],t)),this._logHandler.apply(this,c([this,a.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,c([this,a.WARN],t)),this._logHandler.apply(this,c([this,a.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,c([this,a.ERROR],t)),this._logHandler.apply(this,c([this,a.ERROR],t))},t}();const m="ok",y="cancelled",w="unknown",v="invalid-argument",b="deadline-exceeded",E="not-found",I="already-exists",T="permission-denied",_="unauthenticated",N="resource-exhausted",A="failed-precondition",S="aborted",D="out-of-range",x="unimplemented",O="internal",L="unavailable",R="data-loss";class k extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=(()=>`${this.name}: [code=${this.code}]: ${this.message}`)}}const C=new g("@firebase/firestore");function P(t,...e){if(C.logLevel<=a.DEBUG){const n=e.map(U);C.debug("Firestore (7.17.1): "+t,...n)}}function V(t,...e){if(C.logLevel<=a.ERROR){const n=e.map(U);C.error("Firestore (7.17.1): "+t,...n)}}function U(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function M(t="Unexpected state"){const e="FIRESTORE (7.17.1) INTERNAL ASSERTION FAILED: "+t;throw V(e),new Error(e)}function F(t,e){t||M()}function q(t,e){return t}function j(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class ${static t(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=j(40);for(let r=0;r<s.length;++r)n.length<20&&s[r]<e&&(n+=t.charAt(s[r]%t.length))}return n}}function B(t,e){return t<e?-1:t>e?1:0}function G(t,e,n){return t.length===e.length&&t.every((t,s)=>n(t,e[s]))}class z{constructor(t,e,n,s,r){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=s,this.forceLongPolling=r}}class H{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get i(){return"(default)"===this.database}isEqual(t){return t instanceof H&&t.projectId===this.projectId&&t.database===this.database}o(t){return B(this.projectId,t.projectId)||B(this.database,t.database)}}class W{constructor(t){this.uid=t}u(){return null!=this.uid}h(){return this.u()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}W.UNAUTHENTICATED=new W(null),W.l=new W("google-credentials-uid"),W._=new W("first-party-uid");class K{constructor(t,e){this.user=e,this.type="OAuth",this.m={},this.m.Authorization="Bearer "+t}}class Q{constructor(t){this.p=null,this.currentUser=W.UNAUTHENTICATED,this.I=!1,this.A=0,this.T=null,this.forceRefresh=!1,this.p=(()=>{this.A++,this.currentUser=this.P(),this.I=!0,this.T&&this.T(this.currentUser)}),this.A=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.p):(this.p(null),t.get().then(t=>{this.auth=t,this.p&&this.auth.addAuthTokenListener(this.p)},()=>{}))}getToken(){const t=this.A,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.A!==t?(P("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(F("string"==typeof e.accessToken),new K(e.accessToken,this.currentUser)):null):Promise.resolve(null)}R(){this.forceRefresh=!0}V(t){this.T=t,this.I&&t(this.currentUser)}g(){this.auth&&this.auth.removeAuthTokenListener(this.p),this.p=null,this.T=null}P(){const t=this.auth&&this.auth.getUid();return F(null===t||"string"==typeof t),new W(t)}}function X(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new k(v,`Type does not match the expected instance. Did you pass '${e.name}' from a different Firestore SDK?`):new k(v,`Expected type '${e.name}', but was '${t.constructor.name}'`);return t}class Y{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new k(v,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new k(v,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new k(v,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new k(v,"Timestamp seconds out of range: "+t)}static now(){return Y.fromMillis(Date.now())}static fromDate(t){return Y.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3);return new Y(e,1e6*(t-1e3*e))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}v(t){return this.seconds===t.seconds?B(this.nanoseconds,t.nanoseconds):B(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class J{constructor(t){this.timestamp=t}static N(t){return new J(t)}static min(){return new J(new Y(0,0))}o(t){return this.timestamp.v(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}F(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}$(){return this.timestamp}}class Z{constructor(t,e,n){void 0===e?e=0:e>t.length&&M(),void 0===n?n=t.length-e:n>t.length-e&&M(),this.segments=t,this.offset=e,this.q=n}get length(){return this.q}isEqual(t){return 0===Z.D(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Z?t.forEach(t=>{e.push(t)}):e.push(t),this.S(e)}limit(){return this.offset+this.length}O(t){return t=void 0===t?1:t,this.S(this.segments,this.offset+t,this.length-t)}C(){return this.S(this.segments,this.offset,this.length-1)}U(){return this.segments[this.offset]}L(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}B(){return 0===this.length}M(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}j(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}k(){return this.segments.slice(this.offset,this.limit())}static D(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),r=e.get(s);if(n<r)return-1;if(n>r)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class tt extends Z{S(t,e,n){return new tt(t,e,n)}G(){return this.k().join("/")}toString(){return this.G()}static W(t){if(t.indexOf("//")>=0)throw new k(v,`Invalid path (${t}). Paths must not contain // in them.`);const e=t.split("/").filter(t=>t.length>0);return new tt(e)}static Y(){return new tt([])}}const et=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class nt extends Z{S(t,e,n){return new nt(t,e,n)}static H(t){return et.test(t)}G(){return this.k().map(t=>(t=t.replace("\\","\\\\").replace("`","\\`"),nt.H(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.G()}K(){return 1===this.length&&"__name__"===this.get(0)}static Z(){return new nt(["__name__"])}static J(t){const e=[];let n="",s=0;const r=()=>{if(0===n.length)throw new k(v,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new k(v,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new k(v,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(i=!i,s++):"."!==e||i?(n+=e,s++):(r(),s++)}if(r(),i)throw new k(v,"Unterminated ` in path: "+t);return new nt(e)}static Y(){return new nt([])}}class st{constructor(t){this.path=t}static X(t){return new st(tt.W(t).O(5))}tt(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===tt.D(this.path,t.path)}toString(){return this.path.toString()}static D(t,e){return tt.D(t.path,e.path)}static nt(t){return t.length%2==0}static et(t){return new st(new tt(t.slice()))}}function rt(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function it(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}class ot{constructor(t){this.rt=t}static fromBase64String(t){const e=atob(t);return new ot(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new ot(e)}toBase64(){return t=this.rt,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.rt)}st(){return 2*this.rt.length}o(t){return B(this.rt,t.rt)}isEqual(t){return this.rt===t.rt}}function at(t){return null==t}function ut(t){return-0===t&&1/t==-1/0}function ht(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ct(t){const e=yt(t.mapValue.fields.__local_write_time__.timestampValue);return new Y(e.seconds,e.nanos)}ot.it=new ot("");const lt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ft(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ht(t)?4:10:M()}function dt(t,e){const n=ft(t);if(n!==ft(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ct(t).isEqual(ct(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=yt(t.timestampValue),s=yt(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return vt(t.bytesValue).isEqual(vt(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return wt(t.geoPointValue.latitude)===wt(e.geoPointValue.latitude)&&wt(t.geoPointValue.longitude)===wt(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return wt(t.integerValue)===wt(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=wt(t.doubleValue),s=wt(e.doubleValue);return n===s?ut(n)===ut(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return G(t.arrayValue.values||[],e.arrayValue.values||[],dt);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(rt(n)!==rt(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!dt(n[t],s[t])))return!1;return!0}(t,e);default:return M()}}function pt(t,e){return void 0!==(t.values||[]).find(t=>dt(t,e))}function gt(t,e){const n=ft(t),s=ft(e);if(n!==s)return B(n,s);switch(n){case 0:return 0;case 1:return B(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=wt(t.integerValue||t.doubleValue),s=wt(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return mt(t.timestampValue,e.timestampValue);case 4:return mt(ct(t),ct(e));case 5:return B(t.stringValue,e.stringValue);case 6:return function(t,e){const n=vt(t),s=vt(e);return n.o(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=B(n[t],s[t]);if(0!==e)return e}return B(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=B(wt(t.latitude),wt(e.latitude));return 0!==n?n:B(wt(t.longitude),wt(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=gt(n[t],s[t]);if(e)return e}return B(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=Object.keys(n),r=e.fields||{},i=Object.keys(r);s.sort(),i.sort();for(let t=0;t<s.length&&t<i.length;++t){const e=B(s[t],i[t]);if(0!==e)return e;const o=gt(n[s[t]],r[i[t]]);if(0!==o)return o}return B(s.length,i.length)}(t.mapValue,e.mapValue);default:throw M()}}function mt(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return B(t,e);const n=yt(t),s=yt(e),r=B(n.seconds,s.seconds);return 0!==r?r:B(n.nanos,s.nanos)}function yt(t){if(F(!!t),"string"==typeof t){let e=0;const n=lt.exec(t);if(F(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:wt(t.seconds),nanos:wt(t.nanos)}}function wt(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function vt(t){return"string"==typeof t?ot.fromBase64String(t):ot.fromUint8Array(t)}function bt(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.G()}`}}function Et(t){return!!t&&"arrayValue"in t}function It(t){return!!t&&"nullValue"in t}function Tt(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function _t(t){return!!t&&"mapValue"in t}class Nt{constructor(t,e=null,n=[],s=[],r=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=i,this.endAt=o,this.ot=null}}function At(t,e=null,n=[],s=[],r=null,i=null,o=null){return new Nt(t,e,n,s,r,i,o)}class St{constructor(t,e=null,n=[],s=[],r=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.ut=n,this.filters=s,this.limit=r,this.at=i,this.startAt=o,this.endAt=a,this.ct=null,this.ht=null,this.startAt,this.endAt}lt(t){return new St(t,null,this.ut.slice(),this.filters.slice(),this.limit,this.at,this.startAt,this.endAt)}ft(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.ut.length||1===this.ut.length&&this.ut[0].field.K())}dt(){return!at(this.limit)&&"F"===this.at}_t(){return!at(this.limit)&&"L"===this.at}wt(){return this.ut.length>0?this.ut[0].field:null}pt(){for(const t of this.filters)if(t.yt())return t.field;return null}Et(t){for(const e of this.filters)if(t.indexOf(e.op)>=0)return e.op;return null}}function Dt(t){return null!==t.collectionGroup}function xt(t){const e=X(t,St);if(null===e.ct){e.ct=[];const t=e.pt(),n=e.wt();if(null!==t&&null===n)t.K()||e.ct.push(new $t(t)),e.ct.push(new $t(nt.Z(),"asc"));else{let t=!1;for(const n of e.ut)e.ct.push(n),n.field.K()&&(t=!0);if(!t){const t=e.ut.length>0?e.ut[e.ut.length-1].dir:"asc";e.ct.push(new $t(nt.Z(),t))}}}return e.ct}function Ot(t){const e=X(t,St);if(!e.ht)if("F"===e.at)e.ht=At(e.path,e.collectionGroup,xt(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of xt(e)){const e="desc"===n.dir?"asc":"desc";t.push(new $t(n.field,e))}const n=e.endAt?new qt(e.endAt.position,!e.endAt.before):null,s=e.startAt?new qt(e.startAt.position,!e.startAt.before):null;e.ht=At(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.ht}class Lt extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){if(t.K())return"in"===e||"not-in"===e?this.It(t,e,n):new Rt(t,e,n);if(It(n)){if("=="!==e&&"!="!==e)throw new k(v,"Invalid query. Null supports only equality comparisons.");return new Lt(t,e,n)}if(Tt(n)){if("=="!==e&&"!="!==e)throw new k(v,"Invalid query. NaN supports only equality comparisons.");return new Lt(t,e,n)}return"array-contains"===e?new Vt(t,n):"in"===e?new Ut(t,n):"not-in"===e?new Mt(t,n):"array-contains-any"===e?new Ft(t,n):new Lt(t,e,n)}static It(t,e,n){return"in"===e?new kt(t,n):new Ct(t,n)}matches(t){const e=t.field(this.field);return"!="===this.op?null!==e&&this.At(gt(e,this.value)):null!==e&&ft(this.value)===ft(e)&&this.At(gt(e,this.value))}At(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return M()}}yt(){return["<","<=",">",">=","!="].indexOf(this.op)>=0}}class Rt extends Lt{constructor(t,e,n){super(t,e,n),this.key=st.X(n.referenceValue)}matches(t){const e=st.D(t.key,this.key);return this.At(e)}}class kt extends Lt{constructor(t,e){super(t,"in",e),this.keys=Pt("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Ct extends Lt{constructor(t,e){super(t,"not-in",e),this.keys=Pt("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Pt(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>st.X(t.referenceValue))}class Vt extends Lt{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.field(this.field);return Et(e)&&pt(e.arrayValue,this.value)}}class Ut extends Lt{constructor(t,e){super(t,"in",e)}matches(t){const e=t.field(this.field);return null!==e&&pt(this.value.arrayValue,e)}}class Mt extends Lt{constructor(t,e){super(t,"not-in",e)}matches(t){const e=t.field(this.field);return null!==e&&!pt(this.value.arrayValue,e)}}class Ft extends Lt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.field(this.field);return!(!Et(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>pt(this.value.arrayValue,t))}}class qt{constructor(t,e){this.position=t,this.before=e}}function jt(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!dt(t.position[n],e.position[n]))return!1;return!0}class $t{constructor(t,e="asc"){this.field=t,this.dir=e}}function Bt(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var Gt,zt;function Ht(t){if(void 0===t)return V("RPC_ERROR","HTTP error has no status"),w;switch(t){case 200:return m;case 400:return A;case 401:return _;case 403:return T;case 404:return E;case 409:return S;case 416:return D;case 429:return N;case 499:return y;case 500:return w;case 501:return x;case 503:return L;case 504:return b;default:return t>=200&&t<300?m:t>=400&&t<500?A:t>=500&&t<600?O:w}}(zt=Gt||(Gt={}))[zt.OK=0]="OK",zt[zt.CANCELLED=1]="CANCELLED",zt[zt.UNKNOWN=2]="UNKNOWN",zt[zt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",zt[zt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",zt[zt.NOT_FOUND=5]="NOT_FOUND",zt[zt.ALREADY_EXISTS=6]="ALREADY_EXISTS",zt[zt.PERMISSION_DENIED=7]="PERMISSION_DENIED",zt[zt.UNAUTHENTICATED=16]="UNAUTHENTICATED",zt[zt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",zt[zt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",zt[zt.ABORTED=10]="ABORTED",zt[zt.OUT_OF_RANGE=11]="OUT_OF_RANGE",zt[zt.UNIMPLEMENTED=12]="UNIMPLEMENTED",zt[zt.INTERNAL=13]="INTERNAL",zt[zt.UNAVAILABLE=14]="UNAVAILABLE",zt[zt.DATA_LOSS=15]="DATA_LOSS";const Wt={asc:"ASCENDING",desc:"DESCENDING"},Kt={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Qt{constructor(t,e){this.s=t,this.Tt=e}}function Xt(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!ut(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?{integerValue:""+e}:function(t,e){if(t.Tt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ut(e)?"-0":e}}(t,e)}function Yt(t,e){return t.Tt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Jt(t){return F(!!t),J.N(function(t){const e=yt(t);return new Y(e.seconds,e.nanos)}(t))}function Zt(t,e){return function(t){return new tt(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).G()}function te(t,e){return Zt(t.s,e.path)}function ee(t,e){const n=function(t){const e=tt.W(t);return F(ue(e)),e}(e);return F(n.get(1)===t.s.projectId),F(!n.get(3)&&!t.s.database||n.get(3)===t.s.database),new st((F((s=n).length>4&&"documents"===s.get(4)),s.O(5)));var s}function ne(t,e){return Zt(t.s,e)}function se(t){return new tt(["projects",t.s.projectId,"databases",t.s.database]).G()}function re(t,e,n){return{name:te(t,e),fields:n.proto.mapValue.fields}}function ie(t,e){let n;if(e instanceof we)n={update:re(t,e.key,e.value)};else if(e instanceof Ee)n={delete:te(t,e.key)};else if(e instanceof ve)n={update:re(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.G())),{fieldPaths:e}}(e.Pt)};else if(e instanceof be)n={transform:{document:te(t,e.key),fieldTransforms:e.fieldTransforms.map(t=>(function(t,e){const n=e.transform;if(n instanceof ce)return{fieldPath:e.field.G(),setToServerValue:"REQUEST_TIME"};if(n instanceof le)return{fieldPath:e.field.G(),appendMissingElements:{values:n.elements}};if(n instanceof fe)return{fieldPath:e.field.G(),removeAllFromArray:{values:n.elements}};if(n instanceof de)return{fieldPath:e.field.G(),increment:n.Rt};throw M()})(0,t))}};else{if(!(e instanceof Ie))return M();n={verify:te(t,e.key)}}return e.bt.Vt||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:function(t,e){return Yt(t,e.$())}(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:M()}(t,e.bt)),n}function oe(t){return{before:t.before,values:t.position}}function ae(t){return{fieldPath:t.G()}}function ue(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class he{constructor(){this.gt=void 0}}class ce extends he{}class le extends he{constructor(t){super(),this.elements=t}}class fe extends he{constructor(t){super(),this.elements=t}}class de extends he{constructor(t,e){super(),this.serializer=t,this.Rt=e}}class pe{constructor(t){this.fields=t,t.sort(nt.D)}vt(t){for(const e of this.fields)if(e.M(t))return!0;return!1}isEqual(t){return G(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class ge{constructor(t,e){this.field=t,this.transform=e}}class me{constructor(t,e){this.updateTime=t,this.exists=e}static Nt(){return new me}static exists(t){return new me(void 0,t)}static updateTime(t){return new me(t)}get Vt(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}class ye{}class we extends ye{constructor(t,e,n){super(),this.key=t,this.value=e,this.bt=n,this.type=0}}class ve extends ye{constructor(t,e,n,s){super(),this.key=t,this.data=e,this.Pt=n,this.bt=s,this.type=1}}class be extends ye{constructor(t,e){super(),this.key=t,this.fieldTransforms=e,this.type=2,this.bt=me.exists(!0)}}class Ee extends ye{constructor(t,e){super(),this.key=t,this.bt=e,this.type=3}}class Ie extends ye{constructor(t,e){super(),this.key=t,this.bt=e,this.type=4}}class Te{constructor(t){this.proto=t}static empty(){return new Te({mapValue:{}})}field(t){if(t.B())return this.proto;{let e=this.proto;for(let n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!_t(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.L()])||null}}isEqual(t){return dt(this.proto,t.proto)}}class _e{constructor(t=Te.empty()){this.Ft=t,this.$t=new Map}set(t,e){return this.qt(t,e),this}delete(t){return this.qt(t,null),this}qt(t,e){let n=this.$t;for(let e=0;e<t.length-1;++e){const s=t.get(e);let r=n.get(s);r instanceof Map?n=r:r&&10===ft(r)?(r=new Map(Object.entries(r.mapValue.fields||{})),n.set(s,r),n=r):(r=new Map,n.set(s,r),n=r)}n.set(t.L(),e)}Dt(){const t=this.xt(nt.Y(),this.$t);return null!=t?new Te(t):this.Ft}xt(t,e){let n=!1;const s=this.Ft.field(t),r=_t(s)?Object.assign({},s.mapValue.fields):{};return e.forEach((e,s)=>{if(e instanceof Map){const i=this.xt(t.child(s),e);null!=i&&(r[s]=i,n=!0)}else null!==e?(r[s]=e,n=!0):r.hasOwnProperty(s)&&(delete r[s],n=!0)}),n?{mapValue:{fields:r}}:null}}class Ne{constructor(t,e){this.key=t,this.version=e}}class Ae extends Ne{constructor(t,e,n,s){super(t,e),this.St=n,this.Ot=!!s.Ot,this.hasCommittedMutations=!!s.hasCommittedMutations}field(t){return this.St.field(t)}data(){return this.St}Ct(){return this.St.proto}isEqual(t){return t instanceof Ae&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ot===t.Ot&&this.hasCommittedMutations===t.hasCommittedMutations&&this.St.isEqual(t.St)}toString(){return`Document(${this.key}, ${this.version}, ${this.St.toString()}, {hasLocalMutations: ${this.Ot}}), {hasCommittedMutations: ${this.hasCommittedMutations}})`}get hasPendingWrites(){return this.Ot||this.hasCommittedMutations}}class Se extends Ne{constructor(t,e,n){super(t,e),this.hasCommittedMutations=!(!n||!n.hasCommittedMutations)}toString(){return`NoDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return this.hasCommittedMutations}isEqual(t){return t instanceof Se&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class De{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class xe{constructor(t,e,n=1e3,s=1.5,r=6e4){this.Ut=t,this.Lt=e,this.Bt=n,this.Mt=s,this.jt=r,this.kt=0,this.Qt=null,this.Gt=Date.now(),this.reset()}reset(){this.kt=0}Wt(){this.kt=this.jt}Yt(t){this.cancel();const e=Math.floor(this.kt+this.zt()),n=Math.max(0,Date.now()-this.Gt),s=Math.max(0,e-n);s>0&&P("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.kt} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Qt=this.Ut.Ht(this.Lt,s,()=>(this.Gt=Date.now(),t())),this.kt*=this.Mt,this.kt<this.Bt&&(this.kt=this.Bt),this.kt>this.jt&&(this.kt=this.jt)}Kt(){null!==this.Qt&&(this.Qt.Zt(),this.Qt=null)}cancel(){null!==this.Qt&&(this.Qt.cancel(),this.Qt=null)}zt(){return(Math.random()-.5)*this.kt}}function Oe(){return"undefined"!=typeof window?window:null}class Le{constructor(t,e,n,s,r){this.Jt=t,this.Lt=e,this.Xt=n,this.op=s,this.tn=r,this.nn=new De,this.then=this.nn.promise.then.bind(this.nn.promise),this.nn.promise.catch(t=>{})}static en(t,e,n,s,r){const i=Date.now()+n,o=new Le(t,e,i,s,r);return o.start(n),o}start(t){this.rn=setTimeout(()=>this.sn(),t)}Zt(){return this.sn()}cancel(t){null!==this.rn&&(this.clearTimeout(),this.nn.reject(new k(y,"Operation cancelled"+(t?": "+t:""))))}sn(){this.Jt.on(()=>null!==this.rn?(this.clearTimeout(),this.op().then(t=>this.nn.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.rn&&(this.tn(this),clearTimeout(this.rn),this.rn=null)}}class Re{constructor(){this.un=Promise.resolve(),this.an=[],this.cn=!1,this.hn=[],this.ln=null,this.fn=!1,this.dn=[],this._n=new xe(this,"async_queue_retry"),this.wn=(()=>this._n.Kt());const t=Oe();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.wn)}get mn(){return this.cn}on(t){this.enqueue(t)}pn(t){this.yn(),this.En(t)}In(t){return this.yn(),this.En(t)}async An(t){if(this.yn(),!this.cn){this.cn=!0;const e=Oe();e&&e.removeEventListener("visibilitychange",this.wn),await this.In(t)}}enqueue(t){return this.yn(),this.cn?new Promise(t=>{}):this.En(t)}Tn(t){this.an.push(t),this.on(()=>this.Pn())}async Pn(){if(0!==this.an.length){try{await this.an[0](),this.an.shift(),this._n.reset()}catch(t){if(!function(t){return"IndexedDbTransactionError"===t.name}(t))throw t;P("AsyncQueue","Operation failed with retryable error: "+t)}this.an.length>0&&this._n.Yt(()=>this.Pn())}}En(t){const e=this.un.then(()=>(this.fn=!0,t().catch(t=>{throw this.ln=t,this.fn=!1,V("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.fn=!1,t))));return this.un=e,e}Ht(t,e,n){this.yn(),this.dn.indexOf(t)>-1&&(e=0);const s=Le.en(this,t,e,n,t=>this.Rn(t));return this.hn.push(s),s}yn(){this.ln&&M()}Vn(){}async bn(){let t;do{t=this.un,await t}while(t!==this.un)}gn(t){for(const e of this.hn)if(e.Lt===t)return!0;return!1}vn(t){return this.bn().then(()=>{this.hn.sort((t,e)=>t.Xt-e.Xt);for(const e of this.hn)if(e.Zt(),"all"!==t&&e.Lt===t)break;return this.bn()})}Nn(t){this.dn.push(t)}Rn(t){const e=this.hn.indexOf(t);this.hn.splice(e,1)}}class ke extends class{}{constructor(t,e){super(),this.credentials=t,this.serializer=e,this.Fn=!1}$n(){if(this.Fn)throw new k(A,"The client has already been terminated.")}start(t){this.qn=t}Dn(t,e,n){return this.$n(),this.credentials.getToken().then(s=>this.qn.Dn(t,e,n,s)).catch(t=>{throw t.code===_&&this.credentials.R(),t})}xn(t,e,n){return this.$n(),this.credentials.getToken().then(s=>this.qn.xn(t,e,n,s)).catch(t=>{throw t.code===_&&this.credentials.R(),t})}async Sn(){this.Fn=!1}}async function Ce(t,e){const n=q(t),s=se(n.serializer)+"/documents",r={writes:e.map(t=>ie(n.serializer,t))};await n.Dn("Commit",s,r)}async function Pe(t,e){const n=q(t),s=se(n.serializer)+"/documents",r={documents:e.map(t=>te(n.serializer,t))},i=await n.xn("BatchGetDocuments",s,r),o=new Map;i.forEach(t=>{const e=function(t,e){return"found"in e?function(t,e){F(!!e.found),e.found.name,e.found.updateTime;const n=ee(t,e.found.name),s=Jt(e.found.updateTime),r=new Te({mapValue:{fields:e.found.fields}});return new Ae(n,s,r,{})}(t,e):"missing"in e?function(t,e){F(!!e.missing),F(!!e.readTime);const n=ee(t,e.missing),s=Jt(e.readTime);return new Se(n,s)}(t,e):M()}(n.serializer,t);o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{const e=o.get(t.toString());F(!!e),a.push(e)}),a}async function Ve(t,e){const n=q(t),s=function(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=ne(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ne(t,s.C()),n.structuredQuery.from=[{collectionId:s.L()}]);const r=function(t){if(0===t.length)return;const e=t.map(t=>(function(t){if("=="===t.op){if(Tt(t.value))return{unaryFilter:{field:ae(t.field),op:"IS_NAN"}};if(It(t.value))return{unaryFilter:{field:ae(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Tt(t.value))return{unaryFilter:{field:ae(t.field),op:"IS_NOT_NAN"}};if(It(t.value))return{unaryFilter:{field:ae(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ae(t.field),op:(e=t.op,Kt[e]),value:t.value}};var e})(t));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);r&&(n.structuredQuery.where=r);const i=function(t){if(0!==t.length)return t.map(t=>(function(t){return{field:ae(t.field),direction:(e=t.dir,Wt[e])};var e})(t))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=function(t,e){return t.Tt||at(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=oe(e.startAt)),e.endAt&&(n.structuredQuery.endAt=oe(e.endAt)),n}(n.serializer,Ot(e));return(await n.xn("RunQuery",s.parent,{structuredQuery:s.structuredQuery})).filter(t=>!!t.document).map(t=>(function(t,e,n){const s=ee(t,e.name),r=Jt(e.updateTime),i=new Te({mapValue:{fields:e.fields}});return new Ae(s,r,i,{hasCommittedMutations:!1})})(n.serializer,t.document))}const Ue={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Me extends class{constructor(t){this.On=t,this.s=t.s;const e=t.ssl?"https":"http";this.Cn=e+"://"+t.host,this.Un="projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents"}Dn(t,e,n,s){const r=this.Ln(t,e);P("RestConnection","Sending: ",r,n);const i={};return this.Bn(i,s),this.Mn(t,r,i,n).then(t=>(P("RestConnection","Received: ",t),t),e=>{throw function(t,...e){if(C.logLevel<=a.WARN){const t=e.map(U);C.warn("Firestore (7.17.1): RestConnection",...t)}}(0,t+" failed with error: ",e,"url: ",r,"request:",n),e})}xn(t,e,n,s){return this.Dn(t,e,n,s)}Bn(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.17.1",t["Content-Type"]="text/plain",e)for(const n in e.m)e.m.hasOwnProperty(n)&&(t[n]=e.m[n])}Ln(t,e){const n=Ue[t];return`${this.Cn}/v1/${e}:${n}`}}{constructor(t,e){super(t),this.jn=e}kn(t,e){throw new Error("Not supported by FetchConnection")}async Mn(t,e,n,s){const r=JSON.stringify(s);let i;try{i=await this.jn(e,{method:"POST",headers:n,body:r})}catch(t){throw new k(Ht(t.status),"Request failed with error: "+t.statusText)}if(!i.ok)throw new k(Ht(i.status),"Request failed with error: "+i.statusText);return i.json()}}function Fe(t){return new Qt(t,!0)}const qe=new Map;function je(t){var e,n;if(t.Qn)throw new k(A,"The client has already been terminated.");if(!qe.has(t)){P("ComponentProvider","Initializing Datastore");const s=t.Gn(),r=new z(t.Wn,t.Yn,null!==(e=s.host)&&void 0!==e?e:"firestore.googleapis.com",null===(n=s.ssl)||void 0===n||n,!1),i=function(t){return Promise.resolve(new Me(t,fetch.bind(null)))}(r).then(e=>{const n=Fe(r.s),s=function(t,e){return new ke(t,n)}(t.zn);return s.start(e),s});qe.set(t,i)}return qe.get(t)}class $e{constructor(t,e){this.app=t,this.Yn="(lite)",this.Hn=!1,this.INTERNAL={delete:()=>this.delete()},this.Wn=$e.Kn(t),this.zn=new Q(e)}get Zn(){return this.Hn}get Qn(){return void 0!==this.Jn}Xn(t){if(this.Hn)throw new k(A,"Firestore has already been started and its settings can no longer be changed. initializeFirestore() cannot be called after calling getFirestore().");this.te=t}Gn(){return this.te||(this.te={}),this.Hn=!0,this.te}static Kn(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new k(v,'"projectId" not provided in firebase.initializeApp.');return new H(t.options.projectId)}delete(){return this.Jn||(this.Jn=this.ne()),this.Jn}ne(){return async function(t){const e=await qe.get(t);if(e)return P("ComponentProvider","Removing Datastore"),qe.delete(t),(await e).Sn()}(this)}}function Be(t,e,n){if(e.length!==n)throw new k(v,`Function ${t}() requires `+Ze(n,"argument")+", but was called with "+Ze(e.length,"argument")+".")}function Ge(t,e,n){if(e.length<n)throw new k(v,`Function ${t}() requires at least `+Ze(n,"argument")+", but was called with "+Ze(e.length,"argument")+".")}function ze(t,e,n,s){!function(t,e,n,s){let r=!1;if(!(r="object"===e?Ke(s):"non-empty string"===e?"string"==typeof s&&""!==s:typeof s===e)){const r=Qe(s);throw new k(v,`Function ${t}() requires its ${n} to be of type ${e}, but it was: ${r}`)}}(t,e,Je(n)+" argument",s)}function He(t){if(!st.nt(t))throw new k(v,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function We(t){if(st.nt(t))throw new k(v,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Ke(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Qe(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":M()}function Xe(t,e,n,s){const r=Qe(s);return new k(v,`Function ${t}() requires its ${Je(n)} argument to be a ${e}, but it was: ${r}`)}function Ye(t,e,n){if(n<=0)throw new k(v,`Function ${t}() requires its ${Je(e)} argument to be a positive number, but it was: ${n}.`)}function Je(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Ze(t,e){return`${t} ${e}`+(1===t?"":"s")}function tn(){if("undefined"==typeof Uint8Array)throw new k(x,"Uint8Arrays are not available in this environment.")}function en(){if("undefined"==typeof atob)throw new k(x,"Blobs are unavailable in Firestore in this environment.")}class nn{constructor(t){en(),this.ee=t}static fromBase64String(t){Be("Blob.fromBase64String",arguments,1),ze("Blob.fromBase64String","string",1,t),en();try{return new nn(ot.fromBase64String(t))}catch(t){throw new k(v,"Failed to construct Blob from Base64 string: "+t)}}static fromUint8Array(t){if(Be("Blob.fromUint8Array",arguments,1),tn(),!(t instanceof Uint8Array))throw Xe("Blob.fromUint8Array","Uint8Array",1,t);return new nn(ot.fromUint8Array(t))}toBase64(){return Be("Blob.toBase64",arguments,0),en(),this.ee.toBase64()}toUint8Array(){return Be("Blob.toUint8Array",arguments,0),tn(),this.ee.toUint8Array()}toString(){return"Blob(base64: "+this.toBase64()+")"}isEqual(t){return this.ee.isEqual(t.ee)}}class sn{constructor(t){!function(t,e,n,s){if(!(e instanceof Array)||e.length<1)throw new k(v,"Function FieldPath() requires its fieldNames argument to be an array with at least "+Ze(1,"element")+".")}(0,t);for(let e=0;e<t.length;++e)if(ze("FieldPath","string",e,t[e]),0===t[e].length)throw new k(v,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.re=new nt(t)}}class rn extends sn{constructor(...t){super(t)}static documentId(){return new rn(nt.Z().G())}isEqual(t){if(!(t instanceof rn))throw Xe("isEqual","FieldPath",1,t);return this.re.isEqual(t.re)}}const on=new RegExp("[~\\*/\\[\\]]");class an{constructor(){this.se=this}}class un extends an{constructor(t){super(),this.ie=t}oe(t){if(2!==t.ue)throw 1===t.ue?t.ae(this.ie+"() can only appear at the top level of your update data"):t.ae(this.ie+"() cannot be used with set() unless you pass {merge:true}");return t.Pt.push(t.path),null}isEqual(t){return t instanceof un}}function hn(t,e,n){return new bn({ue:3,ce:e.settings.ce,methodName:t.ie,he:n},e.s,e.serializer,e.ignoreUndefinedProperties)}class cn extends an{constructor(t){super(),this.ie=t}oe(t){return new ge(t.path,new ce)}isEqual(t){return t instanceof cn}}class ln extends an{constructor(t,e){super(),this.ie=t,this.le=e}oe(t){const e=hn(this,t,!0),n=this.le.map(t=>An(t,e)),s=new le(n);return new ge(t.path,s)}isEqual(t){return this===t}}class fn extends an{constructor(t,e){super(),this.ie=t,this.le=e}oe(t){const e=hn(this,t,!0),n=this.le.map(t=>An(t,e)),s=new fe(n);return new ge(t.path,s)}isEqual(t){return this===t}}class dn extends an{constructor(t,e){super(),this.ie=t,this.fe=e}oe(t){const e=new de(t.serializer,Xt(t.serializer,this.fe));return new ge(t.path,e)}isEqual(t){return this===t}}class pn{constructor(t,e){if(Be("GeoPoint",arguments,2),ze("GeoPoint","number",1,t),ze("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new k(v,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new k(v,"Longitude must be a number between -180 and 180, but was: "+e);this.de=t,this._e=e}get latitude(){return this.de}get longitude(){return this._e}isEqual(t){return this.de===t.de&&this._e===t._e}v(t){return B(this.de,t.de)||B(this._e,t._e)}}const gn=/^__.*__$/;class mn{constructor(t,e,n){this.Wn=t,this.we=e,this.me=n}}class yn{constructor(t,e,n){this.data=t,this.Pt=e,this.fieldTransforms=n}pe(t,e){const n=[];return null!==this.Pt?n.push(new ve(t,this.data,this.Pt,e)):n.push(new we(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new be(t,this.fieldTransforms)),n}}class wn{constructor(t,e,n){this.data=t,this.Pt=e,this.fieldTransforms=n}pe(t,e){const n=[new ve(t,this.data,this.Pt,e)];return this.fieldTransforms.length>0&&n.push(new be(t,this.fieldTransforms)),n}}function vn(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M()}}class bn{constructor(t,e,n,s,r,i){this.settings=t,this.s=e,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===r&&this.ye(),this.fieldTransforms=r||[],this.Pt=i||[]}get path(){return this.settings.path}get ue(){return this.settings.ue}Ee(t){return new bn(Object.assign(Object.assign({},this.settings),t),this.s,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Pt)}Ie(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Ee({path:n,he:!1});return s.Ae(t),s}Te(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Ee({path:n,he:!1});return s.ye(),s}Pe(t){return this.Ee({path:void 0,he:!0})}ae(t){return Rn(t,this.settings.methodName,this.settings.Re||!1,this.path,this.settings.ce)}contains(t){return void 0!==this.Pt.find(e=>t.M(e))||void 0!==this.fieldTransforms.find(e=>t.M(e.field))}ye(){if(this.path)for(let t=0;t<this.path.length;t++)this.Ae(this.path.get(t))}Ae(t){if(0===t.length)throw this.ae("Document fields must not be empty");if(vn(this.ue)&&gn.test(t))throw this.ae('Document fields cannot begin and end with "__"')}}class En{constructor(t,e,n){this.s=t,this.ignoreUndefinedProperties=e,this.serializer=n||Fe(t)}Ve(t,e,n,s=!1){return new bn({ue:t,methodName:e,ce:n,path:nt.Y(),he:!1,Re:s},this.s,this.serializer,this.ignoreUndefinedProperties)}}function In(t,e,n,s,r,i={}){const o=t.Ve(i.merge||i.mergeFields?2:0,e,n,r);xn("Data must be an object, but it was:",o,s);const a=Sn(s,o);let u,h;if(i.merge)u=new pe(o.Pt),h=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const s of i.mergeFields){let r;if(s instanceof sn)r=s.re;else{if("string"!=typeof s)throw M();r=Ln(e,s,n)}if(!o.contains(r))throw new k(v,`Field '${r}' is specified in your field mask but missing from your input data.`);kn(t,r)||t.push(r)}u=new pe(t),h=o.fieldTransforms.filter(t=>u.vt(t.field))}else u=null,h=o.fieldTransforms;return new yn(new Te(a),u,h)}function Tn(t,e,n,s){const r=t.Ve(1,e,n);xn("Data must be an object, but it was:",r,s);const i=[],o=new _e;it(s,(t,s)=>{const a=Ln(e,t,n),u=r.Te(a);if(s instanceof an&&s.se instanceof un)i.push(a);else{const t=An(s,u);null!=t&&(i.push(a),o.set(a,t))}});const a=new pe(i);return new wn(o.Dt(),a,r.fieldTransforms)}function _n(t,e,n,s,r,i){const o=t.Ve(1,e,n),a=[On(e,s,n)],u=[r];if(i.length%2!=0)throw new k(v,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<i.length;t+=2)a.push(On(e,i[t])),u.push(i[t+1]);const h=[],c=new _e;for(let t=a.length-1;t>=0;--t)if(!kn(h,a[t])){const e=a[t],n=u[t],s=o.Te(e);if(n instanceof an&&n.se instanceof un)h.push(e);else{const t=An(n,s);null!=t&&(h.push(e),c.set(e,t))}}const l=new pe(h);return new wn(c.Dt(),l,o.fieldTransforms)}function Nn(t,e,n,s=!1){return An(n,t.Ve(s?4:3,e))}function An(t,e){if(Dn(t))return xn("Unsupported field value:",e,t),Sn(t,e);if(t instanceof an)return function(t,e){if(!vn(e.ue))throw e.ae(t.ie+"() can only be used with update() and set()");if(!e.path)throw e.ae(t.ie+"() is not currently supported inside arrays");const n=t.oe(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Pt.push(e.path),t instanceof Array){if(e.settings.he&&4!==e.ue)throw e.ae("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const r of t){let t=An(r,e.Pe(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Xt(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Y.fromDate(t);return{timestampValue:Yt(e.serializer,n)}}if(t instanceof Y){const n=new Y(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Yt(e.serializer,n)}}if(t instanceof pn)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof nn)return{bytesValue:(n=e.serializer,s=t,n.Tt?s.toBase64():s.toUint8Array())};if(t instanceof mn){const n=e.s,s=t.Wn;if(!s.isEqual(n))throw e.ae(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Zt(t.Wn||e.s,t.we.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.ae("Unsupported field value: "+Qe(t));var n,s}(t,e)}function Sn(t,e){const n={};return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(t)?e.path&&e.path.length>0&&e.Pt.push(e.path):it(t,(t,s)=>{const r=An(s,e.Ie(t));null!=r&&(n[t]=r)}),{mapValue:{fields:n}}}function Dn(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Y||t instanceof pn||t instanceof nn||t instanceof mn||t instanceof an)}function xn(t,e,n){if(!Dn(n)||!Ke(n)){const s=Qe(n);throw"an object"===s?e.ae(t+" a custom object"):e.ae(t+" "+s)}}function On(t,e,n){if(e instanceof sn)return e.re;if("string"==typeof e)return Ln(t,e);throw Rn("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Ln(t,e,n){try{return function(t){if(t.search(on)>=0)throw new k(v,`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`);try{return new rn(...t.split("."))}catch(e){throw new k(v,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`)}}(e).re}catch(e){throw Rn((s=e)instanceof Error?s.message:s.toString(),t,!1,void 0,n)}var s}function Rn(t,e,n,s,r){const i=s&&!s.B(),o=void 0!==r;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)");let u="";return(i||o)&&(u+=" (found",i&&(u+=" in field "+s),o&&(u+=" in document "+r),u+=")"),new k(v,(a+=". ")+t+u)}function kn(t,e){return t.some(t=>t.isEqual(e))}class Cn extends sn{constructor(...t){super(t)}isEqual(t){const e=X(t,Cn);return this.re.isEqual(e.re)}}class Pn{constructor(t,e,n,s){this.s=t,this.timestampsInSnapshots=e,this.be=n,this.ge=s}ve(t){switch(ft(t)){case 0:return null;case 1:return t.booleanValue;case 2:return wt(t.integerValue||t.doubleValue);case 3:return this.Ne(t.timestampValue);case 4:return this.Fe(t);case 5:return t.stringValue;case 6:return new nn(vt(t.bytesValue));case 7:return this.$e(t.referenceValue);case 8:return this.qe(t.geoPointValue);case 9:return this.De(t.arrayValue);case 10:return this.xe(t.mapValue);default:throw M()}}xe(t){const e={};return it(t.fields||{},(t,n)=>{e[t]=this.ve(n)}),e}qe(t){return new pn(wt(t.latitude),wt(t.longitude))}De(t){return(t.values||[]).map(t=>this.ve(t))}Fe(t){switch(this.be){case"previous":const e=function t(e){const n=e.mapValue.fields.__previous_value__;return ht(n)?t(n):n}(t);return null==e?null:this.ve(e);case"estimate":return this.Ne(ct(t));default:return null}}Ne(t){const e=yt(t),n=new Y(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()}$e(t){const e=tt.W(t);F(ue(e));const n=new H(e.get(1),e.get(3)),s=new st(e.O(5));return n.isEqual(this.s)||V(`Document ${s} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${this.s.projectId}/${this.s.database}) instead.`),this.ge(s)}}class Vn{constructor(t,e,n,s){this.Se=t,this.we=e,this.Oe=n,this.me=s}get id(){return this.we.path.L()}get ref(){return new Hn(this.Se,this.me,this.we.path)}exists(){return null!==this.Oe}data(){if(this.Oe){if(this.me){const t=new Un(this.Se,this.we,this.Oe,null);return this.me.fromFirestore(t)}return new Pn(this.Se.Wn,!0,"none",t=>new Hn(this.Se,null,t.path)).ve(this.Oe.Ct())}}get(t){if(this.Oe){const e=this.Oe.data().field(Fn("DocumentSnapshot.get",t));if(null!==e)return new Pn(this.Se.Wn,!0,"none",t=>new Hn(this.Se,this.me,t.path)).ve(e)}}}class Un extends Vn{data(){return super.data()}}class Mn{constructor(t,e){this.query=t,this.Ce=e}get docs(){return[...this.Ce]}get size(){return this.docs.length}get empty(){return 0===this.docs.length}forEach(t,e){this.Ce.forEach(t,e)}}function Fn(t,e){return"string"==typeof e?Ln(t,e):X(e,Cn).re}class qn{constructor(t){this.Ue=t,this.Le=new Map,this.mutations=[],this.Be=!1,this.Me=null,this.je=new Set}async ke(t){if(this.Qe(),this.mutations.length>0)throw new k(v,"Firestore transactions require all reads to be executed before all writes.");const e=await Pe(this.Ue,t);return e.forEach(t=>{t instanceof Se||t instanceof Ae?this.Ge(t):M()}),e}set(t,e){this.write(e.pe(t,this.bt(t))),this.je.add(t)}update(t,e){try{this.write(e.pe(t,this.We(t)))}catch(t){this.Me=t}this.je.add(t)}delete(t){this.write([new Ee(t,this.bt(t))]),this.je.add(t)}async commit(){if(this.Qe(),this.Me)throw this.Me;const t=this.Le;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,e)=>{const n=new st(tt.W(e));this.mutations.push(new Ie(n,this.bt(n)))}),await Ce(this.Ue,this.mutations),this.Be=!0}Ge(t){let e;if(t instanceof Ae)e=t.version;else{if(!(t instanceof Se))throw M();e=J.min()}const n=this.Le.get(t.key.toString());if(n){if(!e.isEqual(n))throw new k(S,"Document version changed between two reads.")}else this.Le.set(t.key.toString(),e)}bt(t){const e=this.Le.get(t.toString());return!this.je.has(t)&&e?me.updateTime(e):me.Nt()}We(t){const e=this.Le.get(t.toString());if(!this.je.has(t)&&e){if(e.isEqual(J.min()))throw new k(v,"Can't update a document that doesn't exist.");return me.updateTime(e)}return me.exists(!0)}write(t){this.Qe(),this.mutations=this.mutations.concat(t)}Qe(){}}class jn{constructor(t,e,n,s){this.Jt=t,this.Ue=e,this.updateFunction=n,this.nn=s,this.Ye=5,this._n=new xe(this.Jt,"transaction_retry")}run(){this.ze()}ze(){this._n.Yt(async()=>{const t=new qn(this.Ue),e=this.He(t);e&&e.then(e=>{this.Jt.on(()=>t.commit().then(()=>{this.nn.resolve(e)}).catch(t=>{this.Ke(t)}))}).catch(t=>{this.Ke(t)})})}He(t){try{const e=this.updateFunction(t);return!at(e)&&e.catch&&e.then?e:(this.nn.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.nn.reject(t),null}}Ke(t){this.Ye>0&&this.Ze(t)?(this.Ye-=1,this.Jt.on(()=>(this.ze(),Promise.resolve()))):this.nn.reject(t)}Ze(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!function(t){switch(e){case m:return M();case y:case w:case b:case N:case O:case L:case _:return!1;case v:case E:case I:case T:case A:case S:case D:case x:case R:return!0;default:return M()}}()}return!1}}function $n(t,e,n){if("string"==typeof n){if(""===n)throw new k(v,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Dt(e)&&-1!==n.indexOf("/"))throw new k(v,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(tt.W(n));if(!st.nt(s))throw new k(v,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return bt(t,new st(s))}if(n instanceof mn)return bt(t,n.we);throw new k(v,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Qe(n)+".")}function Bn(t,e){if(!Array.isArray(t)||0===t.length)throw new k(v,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new k(v,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`);if("in"===e||"array-contains-any"===e){if(t.indexOf(null)>=0)throw new k(v,`Invalid Query. '${e.toString()}' filters cannot contain 'null' in the value array.`);if(t.filter(t=>Number.isNaN(t)).length>0)throw new k(v,`Invalid Query. '${e.toString()}' filters cannot contain 'NaN' in the value array.`)}}function Gn(t,e,n){if(!n.isEqual(e))throw new k(v,`Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function zn(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}class Hn extends mn{constructor(t,e,n){super(t.Wn,new st(n),e),this.firestore=t,this.converter=e,this.Je=n,this.type="document"}get id(){return this.Je.L()}get path(){return this.Je.G()}withConverter(t){return new Hn(this.firestore,t,this.Je)}}class Wn{constructor(t,e,n){this.firestore=t,this.converter=e,this.Xe=n,this.type="query"}withConverter(t){return new Wn(this.firestore,t,this.Xe)}}class Kn{}class Qn extends Kn{constructor(t,e,n){super(),this.tr=t,this.nr=e,this.er=n,this.type="where"}apply(t){const e=rs(t.firestore),n=function(t,e,n,s,r,i,o){let a;if(r.K()){if("array-contains"===i||"array-contains-any"===i)throw new k(v,`Invalid Query. You can't perform '${i}' queries on FieldPath.documentId().`);if("in"===i||"not-in"===i){Bn(o,i);const e=[];for(const n of o)e.push($n(s,t,n));a={arrayValue:{values:e}}}else a=$n(s,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Bn(o,i),a=Nn(n,e,o,"in"===i||"not-in"===i);const u=Lt.create(r,i,a);return function(t,e){if(e.yt()){const n=t.pt();if(null!==n&&!n.isEqual(e.field))throw new k(v,`Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=t.wt();null!==s&&Gn(0,e.field,s)}const n=t.Et(function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==n)throw n===e.op?new k(v,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new k(v,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,u),u}(t.Xe,"where",e,t.firestore.Wn,this.tr,this.nr,this.er);return new Wn(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new St(t.path,t.collectionGroup,t.ut.slice(),n,t.limit,t.at,t.startAt,t.endAt)}(t.Xe,n))}}class Xn extends Kn{constructor(t,e){super(),this.tr=t,this.rr=e,this.type="orderBy"}apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new k(v,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new k(v,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new $t(e,n);return function(t,e){if(null===t.wt()){const n=t.pt();null!==n&&Gn(0,n,e.field)}}(t,s),s}(t.Xe,this.tr,this.rr);return new Wn(t.firestore,t.converter,function(t,e){const n=t.ut.concat([e]);return new St(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.at,t.startAt,t.endAt)}(t.Xe,e))}}class Yn extends Kn{constructor(t,e,n){super(),this.type=t,this.sr=e,this.ir=n}apply(t){return new Wn(t.firestore,t.converter,function(t,e,n){return new St(t.path,t.collectionGroup,t.ut.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}(t.Xe,this.sr,this.ir))}}class Jn extends Kn{constructor(t,e,n){super(),this.type=t,this.or=e,this.ur=n}apply(t){const e=ts(t,this.type,this.or,this.ur);return new Wn(t.firestore,t.converter,function(t,e){return new St(t.path,t.collectionGroup,t.ut.slice(),t.filters.slice(),t.limit,t.at,e,t.endAt)}(t.Xe,e))}}class Zn extends Kn{constructor(t,e,n){super(),this.type=t,this.or=e,this.ur=n}apply(t){const e=ts(t,this.type,this.or,this.ur);return new Wn(t.firestore,t.converter,function(t,e){return new St(t.path,t.collectionGroup,t.ut.slice(),t.filters.slice(),t.limit,t.at,t.startAt,e)}(t.Xe,e))}}function ts(t,e,n,s){if(n[0]instanceof Vn)return Be(e,n,1),function(t,e,n,s,r){if(!s)throw new k(E,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");const i=[];for(const n of xt(t))if(n.field.K())i.push(bt(e,s.key));else{const t=s.field(n.field);if(ht(t))throw new k(v,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.G();throw new k(v,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}i.push(t)}return new qt(i,r)}(t.Xe,t.firestore.Wn,e,n[0].Oe,s);{const r=rs(t.firestore);return function(t,e,n,s,r,i){const o=t.ut;if(r.length>o.length)throw new k(v,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<r.length;i++){const u=r[i];if(o[i].field.K()){if("string"!=typeof u)throw new k(v,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof u}`);if(!Dt(t)&&-1!==u.indexOf("/"))throw new k(v,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${s}() must be a plain document ID, but '${u}' contains a slash.`);const n=t.path.child(tt.W(u));if(!st.nt(n))throw new k(v,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const r=new st(n);a.push(bt(e,r))}else{const t=Nn(n,s,u);a.push(t)}}return new qt(a,i)}(t.Xe,t.firestore.Wn,r,e,n,s)}}class es extends Wn{constructor(t,e,n){super(t,n,new St(e)),this.firestore=t,this.Je=e,this.type="collection"}get id(){return this.Xe.path.L()}get path(){return this.Xe.path.G()}withConverter(t){return new es(this.firestore,this.Je,t)}}function ns(t,e){if(1===arguments.length&&(e=$.t()),ze("doc","non-empty string",2,e),t instanceof $e){const n=tt.W(e);return He(n),new Hn(t,null,n)}{if(!(t instanceof Hn||t instanceof es))throw new k(v,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t.Je.child(tt.W(e));return He(n),new Hn(t.firestore,t instanceof es?t.converter:null,n)}}function ss(t,e){return t instanceof Wn&&e instanceof Wn&&t.firestore===e.firestore&&function(t,e){return function(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Bt(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let r=0;r<t.filters.length;r++)if(n=t.filters[r],s=e.filters[r],n.op!==s.op||!n.field.isEqual(s.field)||!dt(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!jt(t.startAt,e.startAt)&&jt(t.endAt,e.endAt)}(Ot(t),Ot(e))&&t.at===e.at}(t.Xe,e.Xe)&&t.converter===e.converter}function rs(t){const e=t.Gn(),n=Fe(t.Wn);return new En(t.Wn,!!e.ignoreUndefinedProperties,n)}class is extends an{}class os extends is{constructor(t){super(),this.se=t,this.ie=t.ie}oe(t){return this.se.oe(t)}isEqual(t){return t instanceof os&&this.se.isEqual(t.se)}}class as{constructor(t,e){this.Se=t,this.ar=e,this.cr=[],this.hr=!1,this.lr=rs(t)}set(t,e,n){this.dr();const s=us(t,this.Se),r=zn(s.me,e,n),i=In(this.lr,"WriteBatch.set",s.we,r,null!==s.me,n);return this.cr=this.cr.concat(i.pe(s.we,me.Nt())),this}update(t,e,n,...s){this.dr();const r=us(t,this.Se);let i;return i="string"==typeof e||e instanceof Cn?_n(this.lr,"WriteBatch.update",r.we,e,n,s):Tn(this.lr,"WriteBatch.update",r.we,e),this.cr=this.cr.concat(i.pe(r.we,me.exists(!0))),this}delete(t){this.dr();const e=us(t,this.Se);return this.cr=this.cr.concat(new Ee(e.we,me.Nt())),this}commit(){return this.dr(),this.hr=!0,this.cr.length>0?this.ar(this.cr):Promise.resolve()}dr(){if(this.hr)throw new k(A,"A write batch can no longer be used after commit() has been called.")}}function us(t,e){if(t.firestore!==e)throw new k(v,"Provided document reference is from a different Firestore instance.");return X(t,Hn)}class hs{constructor(t,e){this.Se=t,this._r=e,this.lr=rs(t)}get(t){const e=us(t,this.Se);return this._r.ke([e.we]).then(t=>{if(!t||1!==t.length)return M();const n=t[0];if(n instanceof Se)return new Vn(this.Se,e.we,null,e.me);if(n instanceof Ae)return new Vn(this.Se,n.key,n,e.me);throw M()})}set(t,e,n){const s=us(t,this.Se),r=zn(s.me,e,n),i=In(this.lr,"Transaction.set",s.we,r,null!==s.me,n);return this._r.set(s.we,i),this}update(t,e,n,...s){const r=us(t,this.Se);let i;return i="string"==typeof e||e instanceof Cn?_n(this.lr,"Transaction.update",r.we,e,n,s):Tn(this.lr,"Transaction.update",r.we,e),this._r.update(r.we,i),this}delete(t){const e=us(t,this.Se);return this._r.delete(e.we),this}}e._registerComponent(new h("firestore/lite",t=>((t,e)=>new $e(t,e))(t.getProvider("app-exp").getImmediate(),t.getProvider("auth-internal")),"PUBLIC")),e.registerVersion("firestore-lite","0.0.800","node"),t.Blob=nn,t.CollectionReference=es,t.DocumentReference=Hn,t.DocumentSnapshot=Vn,t.FieldPath=Cn,t.FieldValue=is,t.FirebaseFirestore=$e,t.GeoPoint=pn,t.Query=Wn,t.QueryConstraint=Kn,t.QueryDocumentSnapshot=Un,t.QuerySnapshot=Mn,t.Timestamp=Y,t.Transaction=hs,t.WriteBatch=as,t.addDoc=function(t,e){const n=X(t,es),s=ns(n),r=zn(n.converter,e),i=In(rs(n.firestore),"addDoc",s.we,r,null!==s.me,{});return je(n.firestore).then(t=>Ce(t,i.pe(s.we,me.exists(!1)))).then(()=>s)},t.arrayRemove=function(...t){return Ge("arrayRemove()",arguments,1),new os(new fn("arrayRemove",t))},t.arrayUnion=function(...t){return Ge("arrayUnion()",arguments,1),new os(new ln("arrayUnion",t))},t.collection=function(t,e){if(ze("collection","non-empty string",2,e),t instanceof $e){const n=tt.W(e);return We(n),new es(t,n,null)}{if(!(t instanceof Hn||t instanceof es))throw new k(v,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=tt.W(t.path).child(tt.W(e));return We(n),new es(t.firestore,n,null)}},t.collectionGroup=function(t,e){const n=X(t,$e);if(ze("collectionGroup","non-empty string",1,e),e.indexOf("/")>=0)throw new k(v,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Wn(n,null,function(t){return new St(tt.Y(),t)}(e))},t.deleteDoc=function(t){const e=X(t,Hn);return je(e.firestore).then(t=>Ce(t,[new Ee(e.we,me.Nt())]))},t.deleteField=function(){return new os(new un("deleteField"))},t.doc=ns,t.documentId=function(){return new Cn("__name__")},t.endAt=function(...t){return new Zn("endAt",t,!1)},t.endBefore=function(...t){return new Zn("endBefore",t,!0)},t.getDoc=function(t){const e=X(t,Hn);return je(e.firestore).then(async t=>{const n=await Pe(t,[e.we]);F(1===n.length);const s=n[0];return new Vn(e.firestore,e.we,s instanceof Ae?s:null,e.me)})},t.getDocs=function(t){const e=X(t,Wn);return function(t){if(t._t()&&0===t.ut.length)throw new k(x,"limitToLast() queries require specifying at least one orderBy() clause")}(e.Xe),je(e.firestore).then(async n=>{const s=(await Ve(n,e.Xe)).map(t=>new Un(e.firestore,t.key,t,e.converter));return e.Xe._t()&&s.reverse(),new Mn(t,s)})},t.getFirestore=function(t){return e._getProvider(t,"firestore/lite").getImmediate()},t.increment=function(t){return new os(new dn("increment",t))},t.initializeFirestore=function(t,n){const s=e._getProvider(t,"firestore/lite").getImmediate();return s.Xn(n),s},t.limit=function(t){return Ye("limit",1,t),new Yn("limit",t,"F")},t.limitToLast=function(t){return Ye("limitToLast",1,t),new Yn("limitToLast",t,"L")},t.orderBy=function(t,e="asc"){const n=e,s=Fn("orderBy",t);return new Xn(s,n)},t.parent=function(t){if(t instanceof es){const e=t.Je.C();return e.B()?null:new Hn(t.firestore,null,e)}{const e=X(t,Hn);return new es(e.firestore,e.we.path.C(),e.me)}},t.query=function(t,...e){let n=X(t,Wn);for(const t of e)n=t.apply(n);return n},t.queryEqual=ss,t.refEqual=function(t,e){return(t instanceof Hn||t instanceof es)&&(e instanceof Hn||e instanceof es)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter},t.runTransaction=function(t,e){const n=X(t,$e);return je(n).then(async t=>{const s=new De;return new jn(new Re,t,t=>e(new hs(n,t)),s).run(),s.promise})},t.serverTimestamp=function(){return new os(new cn("serverTimestamp"))},t.setDoc=function(t,e,n){const s=X(t,Hn),r=zn(s.me,e,n),i=In(rs(s.firestore),"setDoc",s.we,r,null!==s.me,n);return je(s.firestore).then(t=>Ce(t,i.pe(s.we,me.Nt())))},t.setLogLevel=function(t){C.setLogLevel(t)},t.snapshotEqual=function t(e,n){return e instanceof Vn&&n instanceof Vn?e.Se===n.Se&&e.we.isEqual(n.we)&&(null===e.Oe?null===n.Oe:e.Oe.isEqual(n.Oe))&&e.me===n.me:e instanceof Mn&&n instanceof Mn&&ss(e.query,n.query)&&G(e.docs,n.docs,t)},t.startAfter=function(...t){return new Jn("startAfter",t,!1)},t.startAt=function(...t){return new Jn("startAt",t,!0)},t.terminate=function(t){return e._removeServiceInstance(t.app,"firestore/lite"),X(t,$e).delete()},t.updateDoc=function(t,e,n,...s){const r=X(t,Hn),i=rs(r.firestore);let o;return o="string"==typeof e||e instanceof Cn?_n(i,"updateDoc",r.we,e,n,s):Tn(i,"updateDoc",r.we,e),je(r.firestore).then(t=>Ce(t,o.pe(r.we,me.exists(!0))))},t.where=function(t,e,n){const s=e,r=Fn("where",t);return new Qn(r,s,n)},t.writeBatch=function(t){const e=X(t,$e);return new as(e,t=>je(e).then(e=>Ce(e,t)))},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore-lite.js - be sure to load firebase-app.js first.")}});