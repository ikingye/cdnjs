!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.firestore=t.firebase.firestore||{}),t.firebase.app)}(this,function(Jd,$d){"use strict";try{(function(){function t(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e,l,n,r=t($d),i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function o(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function g(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function w(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function u(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}(n=l=l||{})[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT";function a(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=f[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,u(["["+i+"]  "+t.name+":"],n))}}var c={debug:l.DEBUG,verbose:l.VERBOSE,info:l.INFO,warn:l.WARN,error:l.ERROR,silent:l.SILENT},h=l.INFO,f=((e={})[l.DEBUG]="log",e[l.VERBOSE]="log",e[l.INFO]="info",e[l.WARN]="warn",e[l.ERROR]="error",e),p=(Object.defineProperty(d.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in l))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),d.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?c[t]:t},Object.defineProperty(d.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(d.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),d.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.DEBUG],t)),this._logHandler.apply(this,u([this,l.DEBUG],t))},d.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.VERBOSE],t)),this._logHandler.apply(this,u([this,l.VERBOSE],t))},d.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.INFO],t)),this._logHandler.apply(this,u([this,l.INFO],t))},d.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.WARN],t)),this._logHandler.apply(this,u([this,l.WARN],t))},d.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,u([this,l.ERROR],t)),this._logHandler.apply(this,u([this,l.ERROR],t))},d);function d(t){this.name=t,this._logLevel=h,this._logHandler=a,this._userLogHandler=null}function y(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var v,m=(o(b,v=Error),b);function b(t,e){var n=v.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,E.prototype.create),n}var E=(I.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(T,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",c=new m(o,a),h=0,f=Object.keys(i);h<f.length;h++){var l=f[h];"_"!==l.slice(-1)&&(l in c&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),c[l]=i[l])}return c},I);function I(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var T=/\{\$([^}]+)}/g,_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function N(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var A,S="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},D=D||{},k=S||self;function R(){}function L(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function x(t){var e=L(t);return"array"==e||"object"==e&&"number"==typeof t.length}function O(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var P="closure_uid_"+(1e9*Math.random()>>>0),C=0;function V(t,e,n){return t.call.apply(t.bind,arguments)}function U(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function M(t,e,n){return(M=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?V:U).apply(null,arguments)}function F(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var q=Date.now;function j(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,t.prototype.constructor=t}function G(){this.j=this.j,this.i=this.i}G.prototype.j=!1,G.prototype.ja=function(){var t;!this.j&&(this.j=!0,this.G(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,P)&&t[P]||(t[P]=++C))},G.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},z=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function H(t){return Array.prototype.concat.apply([],arguments)}function W(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function K(t){return/^[\s\xa0]*$/.test(t)}var Y,X=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Q(t,e){return-1!=t.indexOf(e)}function Z(t,e){return t<e?-1:e<t?1:0}t:{var J=k.navigator;if(J){var $=J.userAgent;if($){Y=$;break t}}Y=""}function tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function et(t){var e={};for(var n in t)e[n]=t[n];return e}var nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<nt.length;o++)n=nt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function it(t){return it[" "](t),t}it[" "]=R;var ot,st,ut=Q(Y,"Opera"),at=Q(Y,"Trident")||Q(Y,"MSIE"),ct=Q(Y,"Edge"),ht=ct||at,ft=Q(Y,"Gecko")&&!(Q(Y.toLowerCase(),"webkit")&&!Q(Y,"Edge"))&&!(Q(Y,"Trident")||Q(Y,"MSIE"))&&!Q(Y,"Edge"),lt=Q(Y.toLowerCase(),"webkit")&&!Q(Y,"Edge");function pt(){var t=k.document;return t?t.documentMode:void 0}t:{var dt="",yt=(st=Y,ft?/rv:([^\);]+)(\)|;)/.exec(st):ct?/Edge\/([\d\.]+)/.exec(st):at?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):lt?/WebKit\/(\S+)/.exec(st):ut?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);if(yt&&(dt=yt?yt[1]:""),at){var vt=pt();if(null!=vt&&vt>parseFloat(dt)){ot=String(vt);break t}}ot=dt}var gt={};function mt(u){return t=u,e=function(){for(var t=0,e=X(String(ot)).split("."),n=X(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=Z(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||Z(0==o[2].length,0==s[2].length)||Z(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=gt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t);var t,e,n}var wt=k.document&&at?pt()||(parseInt(ot,10)||void 0):void 0,bt=!at||9<=Number(wt),Et=at&&!mt("9"),It=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{k.addEventListener("test",R,e),k.removeEventListener("test",R,e)}catch(t){}return t}();function Tt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function _t(t,e){if(Tt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ft){t:{try{it(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Nt[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}Tt.prototype.b=function(){this.defaultPrevented=!0},j(_t,Tt);var Nt={2:"touch",3:"pen",4:"mouse"};_t.prototype.b=function(){_t.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Et)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var At="closure_listenable_"+(1e6*Math.random()|0),St=0;function Dt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=i,this.key=++St,this.Y=this.Z=!1}function kt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Rt(t){this.src=t,this.a={},this.b=0}function Lt(t,e){var n,r,i,o=e.type;o in t.a&&(n=t.a[o],(i=0<=(r=B(n,e)))&&Array.prototype.splice.call(n,r,1),i&&(kt(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function xt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.ca==r)return i}return-1}Rt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=xt(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Dt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var Ot="closure_lm_"+(1e6*Math.random()|0),Pt={};function Ct(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}r=Bt(r);return e&&e[At]?e.wa(n,r,O(i)?!!i.capture:!!i,o):Vt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ct(t,e[o],n,r,i);return null}return n=Bt(n),t&&t[At]?t.va(e,n,O(r)?!!r.capture:!!r,i):Vt(t,e,n,!1,r,i)}function Vt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=O(i)?!!i.capture:!!i;if(s&&!bt)return null;var u,a,c=jt(t);if(c||(t[Ot]=c=new Rt(t)),(n=c.add(e,n,r,s,o)).proxy)return n;if(u=qt,r=a=bt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)It||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Mt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ut(t){var e,n,r;"number"!=typeof t&&t&&!t.Y&&((e=t.src)&&e[At]?Lt(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Mt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=jt(e))?(Lt(n,t),0==n.b&&(n.src=null,e[Ot]=null)):kt(t)))}function Mt(t){return t in Pt?Pt[t]:Pt[t]="on"+t}function Ft(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Ut(t),n.call(r,e)}function qt(t,e){if(t.Y)return!0;if(bt)return Ft(t,new _t(e,this));if(!e)t:{e=["window","event"];for(var n=k,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Ft(t,e=new _t(e,this))}function jt(t){return(t=t[Ot])instanceof Rt?t:null}var Gt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Bt(e){return"function"==L(e)?e:(e[Gt]||(e[Gt]=function(t){return e.handleEvent(t)}),e[Gt])}function zt(){G.call(this),this.c=new Rt(this),(this.J=this).C=null}function Ht(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.Y&&a.capture==n&&(s=a.listener,u=a.ca||a.src,a.Z&&Lt(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}j(zt,G),zt.prototype[At]=!0,(A=zt.prototype).addEventListener=function(t,e,n,r){Ct(this,t,e,n,r)},A.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=O(i)?!!i.capture:!!i,r=Bt(r),e&&e[At]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=xt(s=e.a[n],r,i,o))&&(kt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&jt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=xt(n,r,i,o)),(r=-1<e?n[e]:null)&&Ut(r))}(this,t,e,n,r)},A.dispatchEvent=function(t){var e,n=this.C;if(n)for(e=[];n;n=n.C)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t?t=new Tt(t,n):t instanceof Tt?t.target=t.target||n:(s=t,rt(t=new Tt(r,n),s)),s=!0,e)for(var i=e.length-1;0<=i;i--)var o=t.a=e[i],s=Ht(o,r,!0,t)&&s;if(s=Ht(o=t.a=n,r,!0,t)&&s,s=Ht(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)s=Ht(o=t.a=e[i],r,!1,t)&&s;return s},A.G=function(){if(zt.S.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)kt(n[r]);delete e.a[t],e.b--}}this.C=null},A.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},A.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Wt=k.JSON.stringify;function Kt(){this.b=this.a=null}var Yt,Xt=(Qt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Qt(function(){return new Zt},function(t){t.reset()},100));function Qt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Zt(){this.next=this.b=this.a=null}function Jt(t){k.setTimeout(function(){throw t},0)}function $t(t,e){var n;Yt||(n=k.Promise.resolve(void 0),Yt=function(){n.then(ne)}),te||(Yt(),te=!0),ee.add(t,e)}Kt.prototype.add=function(t,e){var n=Xt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Zt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var te=!(Zt.prototype.reset=function(){this.next=this.b=this.a=null}),ee=new Kt;function ne(){for(var t,e,n;n=e=void 0,n=null,(e=ee).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Jt(t)}var r=Xt;r.g(t),r.b<r.f&&(r.b++,t.next=r.a,r.a=t)}te=!1}function re(t,e){zt.call(this),this.b=t||1,this.a=e||k,this.f=M(this.Ya,this),this.g=q()}function ie(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function oe(t,e,n){if("function"==L(t))n&&(t=M(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=M(t.handleEvent,t)}return 2147483647<Number(e)?-1:k.setTimeout(t,e||0)}j(re,zt),(A=re.prototype).aa=!1,A.M=null,A.Ya=function(){var t;this.aa&&(0<(t=q()-this.g)&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(ie(this),this.start())))},A.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=q())},A.G=function(){re.S.G.call(this),ie(this),delete this.a};var se,ue,ae,ce=(_(ue=fe,ae=se=G),ue.prototype=null===ae?Object.create(ae):(he.prototype=ae.prototype,new he),fe.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=oe(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},fe.prototype.G=function(){se.prototype.G.call(this),this.a&&(k.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},fe);function he(){this.constructor=ue}function fe(t,e,n){var r=se.call(this)||this;return r.g=null!=n?t.bind(n):t,r.h=e,r.b=null,r.c=!1,r.a=null,r}function le(t){G.call(this),this.b=t,this.a={}}j(le,G);var pe=[];function de(t,e,n,r){Array.isArray(n)||(n&&(pe[0]=n.toString()),n=pe);for(var i=0;i<n.length;i++){var o=Ct(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ye(t){tt(t.a,function(t,e){this.a.hasOwnProperty(e)&&Ut(t)},t),t.a={}}function ve(){this.a=!0}function ge(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(r.length<2)){var i=r[1];if(Array.isArray(i)&&!(i.length<1)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Wt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}le.prototype.G=function(){le.S.G.call(this),ye(this)},le.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ve.prototype.info=function(){};var me=null;function we(){return me=me||new zt}function be(t){Tt.call(this,"serverreachability",t)}function Ee(t){var e=we();e.dispatchEvent(new be(e))}function Ie(t){Tt.call(this,"statevent",t)}function Te(t){var e=we();e.dispatchEvent(new Ie(e))}function _e(t){Tt.call(this,"timingevent",t)}function Ne(t,e){if("function"!=L(t))throw Error("Fn must not be null and must be a function");return k.setTimeout(function(){t()},e)}j(be,Tt),j(Ie,Tt),j(_e,Tt);var Ae={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},Se={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function De(){}function ke(t){var e;return(e=t.a)||(e=t.a={}),e}function Re(){}De.prototype.a=null;var Le,xe={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function Oe(){Tt.call(this,"d")}function Pe(){Tt.call(this,"c")}function Ce(){}function Ve(t,e,n,r){this.g=t,this.c=e,this.f=n,this.T=r||1,this.J=new le(this),this.P=Ue,t=ht?125:void 0,this.R=new re(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}j(Oe,Tt),j(Pe,Tt),j(Ce,De),Le=new Ce;var Ue=45e3,Me={},Fe={};function qe(t,e,n){t.H=1,t.i=cn(nn(e)),t.j=n,t.I=!0,je(t,null)}function je(t,e){t.u=q(),ze(t),t.l=nn(t.i);var s,u,a,c,h,f,n=t.l,r=t.T;Array.isArray(r)||(r=[String(r)]),In(n.b,"t",r),t.D=0,t.a=vr(t.g,t.g.C?e:null),0<t.O&&(t.F=new ce(M(t.Ca,t,t.a),t.O)),de(t.J,t.a,"readystatechange",t.Wa),e=t.B?et(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),Ee(1),s=t.c,u=t.m,a=t.l,c=t.f,h=t.T,f=t.j,s.info(function(){if(s.a)if(f)for(var t="",e=f.split("&"),n=0;n<e.length;n++){var r,i,o=e[n].split("=");1<o.length&&(r=o[0],o=o[1],t=2<=(i=r.split("_")).length&&"type"==i[1]?t+(r+"=")+o+"&":t+(r+"=redacted&"))}else t=null;else t=f;return"XMLHTTP REQ ("+c+") [attempt "+h+"]: "+u+"\n"+a+"\n"+t})}function Ge(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Be(t,n);if(i==Fe){4==e&&(t.h=4,Te(14),r=!1),ge(t.c,t.f,null,"[Incomplete Response]");break}if(i==Me){t.h=4,Te(15),ge(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}ge(t.c,t.f,i,null),Xe(t,i)}4==e&&0==n.length&&(t.h=1,Te(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.W&&(t.W=!0,(e=t.g).a==t&&e.V&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),ar(e),e.F=!0)):(ge(t.c,t.f,n,"[Invalid Chunked Response]"),Ye(t),Ke(t))}function Be(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?Fe:(n=Number(e.substring(n,r)),isNaN(n)?Me:(r+=1)+n>e.length?Fe:(e=e.substr(r,n),t.D=r+n,e))}function ze(t){t.U=q()+t.P,He(t,t.P)}function He(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=Ne(M(t.Ua,t),e)}function We(t){t.o&&(k.clearTimeout(t.o),t.o=null)}function Ke(t){0==t.g.v||t.A||fr(t.g,t)}function Ye(t){We(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,ie(t.R),ye(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Xe(t,e){try{var n,r,i,o,s,u,a,c,h,f,l,p=t.g;if(0!=p.v&&(p.a==t||kn(p.b,t)))if(p.I=t.N,!t.C&&kn(p.b,t)&&3==p.v){try{var d=p.ka.a.parse(e)}catch(t){d=null}if(Array.isArray(d)&&3==d.length){var y=d;if(0==y[0]){t:if(!p.j){if(p.a){if(!(p.a.u+3e3<t.u))break t;hr(p),$n(p)}ur(p),Te(18)}}else p.oa=y[1],0<p.oa-p.P&&y[2]<37500&&p.H&&0==p.o&&!p.m&&(p.m=Ne(M(p.Ra,p),6e3));if(Dn(p.b)<=1&&p.ea){try{p.ea()}catch(t){}p.ea=void 0}}else pr(p,11)}else if(!t.C&&p.a!=t||hr(p),!K(e))for(e=d=p.ka.a.parse(e),d=0;d<e.length;d++){y=e[d],p.P=y[0],y=y[1],2==p.v?"c"==y[0]?(p.J=y[1],p.ga=y[2],null!=(n=y[3])&&(p.ha=n,p.c.info("VER="+p.ha)),null!=(r=y[4])&&(p.pa=r,p.c.info("SVER="+p.pa)),null!=(i=y[5])&&"number"==typeof i&&0<i&&(o=1.5*i,p.D=o,p.c.info("backChannelRequestTimeoutMs_="+o)),o=p,(s=t.a)&&(!(u=s.a?s.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(a=o.b).a&&(Q(u,"spdy")||Q(u,"quic")||Q(u,"h2"))&&(a.f=a.g,a.a=new Set,a.b&&(Rn(a,a.b),a.b=null)),!o.A||(c=s.a?s.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(o.na=c,an(o.B,o.A,c))),p.v=3,p.f&&p.f.ta(),p.V&&(p.N=q()-t.u,p.c.info("Handshake RTT: "+p.N+"ms")),h=t,(o=p).la=yr(o,o.C?o.ga:null,o.fa),h.C?(Ln(o.b,h),f=h,(l=o.D)&&f.setTimeout(l),f.o&&(We(f),ze(f)),o.a=h):sr(o),0<p.g.length&&nr(p)):"stop"!=y[0]&&"close"!=y[0]||pr(p,7):3==p.v&&("stop"==y[0]||"close"==y[0]?"stop"==y[0]?pr(p,7):Jn(p):"noop"!=y[0]&&p.f&&p.f.sa(y),p.o=0)}Ee(4)}catch(t){}}function Qe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(x(t)||"string"==typeof t)z(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(x(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(x(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ze(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ze)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Je(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];$e(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)$e(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function $e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(A=Ve.prototype).setTimeout=function(t){this.P=t},A.Wa=function(t){t=t.target;var e=this.F;e&&3==Yn(t)?e.f():this.Ca(t)},A.Ca=function(t){try{if(t==this.a)t:{var e=Yn(this.a),n=this.a.ua(),r=this.a.X();if(!(e<3||3==e&&!ht&&!this.a.$())){this.A||4!=e||7==n||Ee(8==n||r<=0?3:2),We(this);var i=this.a.X();this.N=i;var o=this.a.$();if(this.b=200==i,c=this.c,h=this.m,f=this.l,l=this.f,p=this.T,d=e,y=i,c.info(function(){return"XMLHTTP RESP ("+l+") [ attempt "+p+"]: "+h+"\n"+f+"\n"+d+" "+y}),this.b){if(this.V&&!this.C){e:{if(this.a){var s,u=this.a;if((s=u.a?u.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!K(s)){var a=s;break e}}a=null}if(!a){this.b=!1,this.h=3,Te(12),Ye(this),Ke(this);break t}ge(this.c,this.f,a,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Xe(this,a)}this.I?(Ge(this,e,o),ht&&this.b&&3==e&&(de(this.J,this.R,"tick",this.Va),this.R.start())):(ge(this.c,this.f,o,null),Xe(this,o)),4==e&&Ye(this),this.b&&!this.A&&(4==e?fr(this.g,this):(this.b=!1,ze(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,Te(12)):(this.h=0,Te(13)),Ye(this),Ke(this)}}}catch(t){}var c,h,f,l,p,d,y},A.Va=function(){var t,e;this.a&&(t=Yn(this.a),e=this.a.$(),this.D<e.length&&(We(this),Ge(this,t,e),this.b&&4!=t&&ze(this)))},A.cancel=function(){this.A=!0,Ye(this)},A.Ua=function(){this.o=null;var t,e,n=q();0<=n-this.U?(t=this.c,e=this.l,t.info(function(){return"TIMEOUT: "+e}),2!=this.H&&(Ee(3),Te(17)),Ye(this),this.h=2,Ke(this)):He(this,this.U-n)},(A=Ze.prototype).K=function(){Je(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},A.L=function(){return Je(this),this.a.concat()},A.get=function(t,e){return $e(this.b,t)?this.b[t]:e},A.set=function(t,e){$e(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},A.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var tn=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function en(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof en?(this.a=void 0!==e?e:t.a,rn(this,t.f),this.j=t.j,on(this,t.c),sn(this,t.h),this.g=t.g,e=t.b,(n=new mn).c=e.c,e.a&&(n.a=new Ze(e.a),n.b=e.b),un(this,n),this.i=t.i):t&&(n=String(t).match(tn))?(this.a=!!e,rn(this,n[1]||"",!0),this.j=hn(n[2]||""),on(this,n[3]||"",!0),sn(this,n[4]),this.g=hn(n[5]||"",!0),un(this,n[6]||"",!0),this.i=hn(n[7]||"")):(this.a=!!e,this.b=new mn(null,this.a))}function nn(t){return new en(t)}function rn(t,e,n){t.f=n?hn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function on(t,e,n){t.c=n?hn(e,!0):e}function sn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function un(t,e,n){var r,i;e instanceof mn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(wn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(bn(this,e),In(this,n,t))},r)),r.f=i):(n||(e=fn(e,vn)),t.b=new mn(e,t.a))}function an(t,e,n){t.b.set(e,n)}function cn(t){return an(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)),t}function hn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function fn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,ln),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function ln(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}en.prototype.toString=function(){var t=[],e=this.f;e&&t.push(fn(e,pn,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(fn(e,pn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(fn(n,"/"==n.charAt(0)?yn:dn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",fn(n,gn)),t.join("")};var pn=/[#\/\?@]/g,dn=/[#\?:]/g,yn=/[#\?]/g,vn=/[#\?@]/g,gn=/#/g;function mn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function wn(n){n.a||(n.a=new Ze,n.b=0,n.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r,i=t[n].indexOf("="),o=null;0<=i?(r=t[n].substring(0,i),o=t[n].substring(i+1)):r=t[n],e(r,o?decodeURIComponent(o.replace(/\+/g," ")):"")}}}(n.c,function(t,e){n.add(decodeURIComponent(t.replace(/\+/g," ")),e)}))}function bn(t,e){wn(t),e=Tn(t,e),$e(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,$e((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Je(t)))}function En(t,e){return wn(t),e=Tn(t,e),$e(t.a.b,e)}function In(t,e,n){bn(t,e),0<n.length&&(t.c=null,t.a.set(Tn(t,e),W(n)),t.b+=n.length)}function Tn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function _n(t,e){this.b=t,this.a=e}function Nn(t){this.g=t||An,t=k.PerformanceNavigationTiming?0<(t=k.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(k.ia&&k.ia.ya&&k.ia.ya()&&k.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(A=mn.prototype).add=function(t,e){wn(this),this.c=null,t=Tn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},A.forEach=function(n,r){wn(this),this.a.forEach(function(t,e){z(t,function(t){n.call(r,t,e,this)},this)},this)},A.L=function(){wn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},A.K=function(t){wn(this);var e=[];if("string"==typeof t)En(this,t)&&(e=H(e,this.a.get(Tn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=H(e,t[n])}return e},A.set=function(t,e){return wn(this),this.c=null,En(this,t=Tn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},A.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},A.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.K(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var An=10;function Sn(t){return t.b||t.a&&t.a.size>=t.f}function Dn(t){return t.b?1:t.a?t.a.size:0}function kn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function Rn(t,e){t.a?t.a.add(e):t.b=e}function Ln(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function xn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null==t.a||0===t.a.size)return W(t.c);var r=t.c;try{for(var i=N(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.s)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function On(){}function Pn(){this.a=new On}function Cn(t,r,e){var i=e||"";try{Qe(t,function(t,e){var n=t;O(t)&&(n=Wt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function Vn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}Nn.prototype.cancel=function(){var e,t;if(this.c=xn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=N(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this.a.clear()}},On.prototype.stringify=function(t){return k.JSON.stringify(t,void 0)},On.prototype.parse=function(t){return k.JSON.parse(t,void 0)};var Un=k.JSON.parse;function Mn(t){zt.call(this),this.headers=new Ze,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=Fn,this.D=this.F=!1}j(Mn,zt);var Fn="",qn=/^https?$/i,jn=["POST","PUT"];function Gn(t){return"content-type"==t.toLowerCase()}function Bn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,zn(t),Wn(t)}function zn(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Hn(t){if(t.b&&void 0!==D&&(!t.s[1]||4!=Yn(t)||2!=t.X()))if(t.l&&4==Yn(t))oe(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==Yn(t)){t.b=!1;try{var e,n,r,i,o=t.X();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.B).match(tn)[1]||null)&&k.self&&k.self.location&&(i=(r=k.self.location.protocol).substr(0,r.length-1)),n=!qn.test(i?i.toLowerCase():"")),e=n),e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Yn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.X()+"]",zn(t)}}finally{Wn(t)}}}function Wn(t,e){if(t.a){Kn(t);var n=t.a,r=t.s[0]?R:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Kn(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(k.clearTimeout(t.m),t.m=null)}function Yn(t){return t.a?t.a.readyState:0}function Xn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",tt(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):an(t,e,n))}function Qn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Zn(t){this.pa=0,this.g=[],this.c=new ve,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=Qn("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=Qn("baseRetryDelayMs",5e3,t),this.Ma=Qn("retryDelaySeedMs",1e4,t),this.Ja=Qn("forwardChannelMaxRetries",2,t),this.ma=Qn("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new Nn(t&&t.concurrentRequestLimit),this.ka=new Pn,this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function Jn(t){var e,n;tr(t),3==t.v&&(e=t.R++,an(n=nn(t.B),"SID",t.J),an(n,"RID",e),an(n,"TYPE","terminate"),ir(t,n),(e=new Ve(t,t.c,e,void 0)).H=2,e.i=cn(nn(n)),n=!1,k.navigator&&k.navigator.sendBeacon&&(n=k.navigator.sendBeacon(e.i.toString(),"")),!n&&k.Image&&((new Image).src=e.i,n=!0),n||(e.a=vr(e.g,null),e.a.ba(e.i)),e.u=q(),ze(e)),dr(t)}function $n(t){t.a&&(ar(t),t.a.cancel(),t.a=null)}function tr(t){$n(t),t.j&&(k.clearTimeout(t.j),t.j=null),hr(t),t.b.cancel(),t.h&&("number"==typeof t.h&&k.clearTimeout(t.h),t.h=null)}function er(t,e){t.g.push(new _n(t.La++,e)),3==t.v&&nr(t)}function nr(t){Sn(t.b)||t.h||(t.h=!0,$t(t.Ba,t),t.u=0)}function rr(t,e){var n=e?e.f:t.R++,r=nn(t.B);an(r,"SID",t.J),an(r,"RID",n),an(r,"AID",t.P),ir(t,r),t.i&&t.l&&Xn(r,t.i,t.l),n=new Ve(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=or(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),Rn(t.b,n),qe(n,r,e)}function ir(t,n){t.f&&Qe({},function(t,e){an(n,e,t)})}function or(t,e,n){n=Math.min(t.g.length,n);var r=t.f?M(t.f.Ha,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var c=i[a].b,h=i[a].a;if((c-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{Cn(h,s,"req"+c+"_")}catch(t){r&&r(h)}}if(u){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function sr(t){t.a||t.j||(t.U=1,$t(t.Aa,t),t.o=0)}function ur(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=Ne(M(t.Aa,t),lr(t,t.o)),t.o++,1)}function ar(t){null!=t.s&&(k.clearTimeout(t.s),t.s=null)}function cr(t){t.a=new Ve(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=nn(t.la);an(e,"RID","rpc"),an(e,"SID",t.J),an(e,"CI",t.H?"0":"1"),an(e,"AID",t.P),ir(t,e),an(e,"TYPE","xmlhttp"),t.i&&t.l&&Xn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=cn(nn(e)),n.j=null,n.I=!0,je(n,t)}function hr(t){null!=t.m&&(k.clearTimeout(t.m),t.m=null)}function fr(t,e){var n,r=null;if(t.a==e){hr(t),ar(t),t.a=null;var i=2}else{if(!kn(t.b,e))return;r=e.s,Ln(t.b,e),i=1}if(t.I=e.N,0!=t.v)if(e.b){1==i?(r=e.j?e.j.length:0,e=q()-e.u,n=t.u,(i=we()).dispatchEvent(new _e(i)),nr(t)):sr(t)}else if(3==(n=e.h)||0==n&&0<t.I||!(1==i&&function(t,e){if(!(Dn(t.b)>=t.b.f-(t.h?1:0))){if(t.h)return t.g=e.s.concat(t.g),1;if(!(1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja)))return t.h=Ne(M(t.Ba,t,e),lr(t,t.u)),t.u++,1}}(t,e)||2==i&&ur(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:pr(t,5);break;case 4:pr(t,10);break;case 3:pr(t,6);break;default:pr(t,2)}}function lr(t,e){var n=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(n*=2),n*e}function pr(t,e){var n,r,i,o,s,u;t.c.info("Error code "+e),2==e?(n=null,t.f&&(n=null),r=M(t.Xa,t),n||(n=new en("//www.google.com/images/cleardot.gif"),k.location&&"http"==k.location.protocol||rn(n,"https"),cn(n)),i=n.toString(),o=r,u=new ve,k.Image?((s=new Image).onload=F(Vn,u,s,"TestLoadImage: loaded",!0,o),s.onerror=F(Vn,u,s,"TestLoadImage: error",!1,o),s.onabort=F(Vn,u,s,"TestLoadImage: abort",!1,o),s.ontimeout=F(Vn,u,s,"TestLoadImage: timeout",!1,o),k.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=i):o(!1)):Te(2),t.v=0,t.f&&t.f.ra(e),dr(t),tr(t)}function dr(t){t.v=0,t.I=-1,t.f&&(0==xn(t.b).length&&0==t.g.length||(t.b.c.length=0,W(t.g),t.g.length=0),t.f.qa())}function yr(t,e,n){var r,i,o,s,u,a,c,h=(r=n)instanceof en?nn(r):new en(r,void 0);return""!=h.c?(e&&on(h,e+"."+h.c),sn(h,h.h)):(i=k.location,o=i.protocol,s=e?e+"."+i.hostname:i.hostname,u=+i.port,a=n,c=new en(null,void 0),o&&rn(c,o),s&&on(c,s),u&&sn(c,u),a&&(c.g=a),h=c),t.W&&tt(t.W,function(t,e){an(h,e,t)}),e=t.A,n=t.na,e&&n&&an(h,e,n),an(h,"VER",t.ha),ir(t,h),h}function vr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Mn(t.Ka)).F=t.C,e}function gr(){}function mr(){if(at&&!(10<=Number(wt)))throw Error("Environmental error: no available transport.")}function wr(t,e){zt.call(this),this.a=new Zn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!K(t)&&(this.a.i=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!K(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new Ir(this)}function br(t){Oe.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function Er(){Pe.call(this),this.status=1}function Ir(t){this.a=t}(A=Mn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?ke(this.H):ke(Le),this.a.onreadystatechange=M(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Bn(this,t)}t=n||"";var i,o=new Ze(this.headers);r&&Qe(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=Gn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.L()),n=k.FormData&&t instanceof k.FormData,0<=B(jn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Kn(this),0<this.o&&((this.D=(i=this.a,at&&mt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=M(this.xa,this)):this.m=oe(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Bn(this,t)}},A.xa=function(){void 0!==D&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},A.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Wn(this))},A.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Wn(this,!0)),Mn.S.G.call(this)},A.za=function(){this.j||(this.A||this.l||this.g?Hn(this):this.Ta())},A.Ta=function(){Hn(this)},A.X=function(){try{return 2<Yn(this)?this.a.status:-1}catch(t){return-1}},A.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},A.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Un(e)}},A.ua=function(){return this.h},A.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(A=Zn.prototype).ha=8,A.v=1,A.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ve(this,this.c,t,void 0),r=this.l;if(this.O&&(r?rt(r=et(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if("__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o=o.length:o=void 0,void 0===o)break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=or(this,n,e),an(i=nn(this.B),"RID",t),an(i,"CVER",22),this.A&&an(i,"X-HTTP-Session-Id",this.A),ir(this,i),this.i&&r&&Xn(i,this.i,r),Rn(this.b,n),this.Ga&&an(i,"TYPE","init"),this.da?(an(i,"$req",e),an(i,"SID","null"),n.V=!0,qe(n,i,null)):qe(n,i,e),this.v=2}}else 3==this.v&&(t?rr(this,t):0==this.g.length||Sn(this.b)||rr(this))},A.Aa=function(){var t;this.j=null,cr(this),this.V&&!(this.F||null==this.a||this.N<=0)&&(t=2*this.N,this.c.info("BP detection timer enabled: "+t),this.s=Ne(M(this.Sa,this),t))},A.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,$n(this),cr(this))},A.Ra=function(){null!=this.m&&(this.m=null,$n(this),ur(this),Te(19))},A.Xa=function(t){t?(this.c.info("Successfully pinged google.com"),Te(2)):(this.c.info("Failed to ping google.com"),Te(1))},(A=gr.prototype).ta=function(){},A.sa=function(){},A.ra=function(){},A.qa=function(){},A.Ha=function(){},mr.prototype.a=function(t,e){return new wr(t,e)},j(wr,zt),(A=wr.prototype).addEventListener=function(t,e,n,r){wr.S.addEventListener.call(this,t,e,n,r)},A.removeEventListener=function(t,e,n,r){wr.S.removeEventListener.call(this,t,e,n,r)},A.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,e=this.l,n=this.b||void 0;Te(0),t.fa=e,t.W=n||{},t.H=t.T,t.B=yr(t,null,t.fa),nr(t)},A.close=function(){Jn(this.a)},A.Pa=function(t){var e;"string"==typeof t?((e={}).__data__=t,er(this.a,e)):this.g?((e={}).__data__=Wt(t),er(this.a,e)):er(this.a,t)},A.G=function(){this.a.f=null,delete this.f,Jn(this.a),delete this.a,wr.S.G.call(this)},j(br,Oe),j(Er,Pe),j(Ir,gr),Ir.prototype.ta=function(){this.a.dispatchEvent("a")},Ir.prototype.sa=function(t){this.a.dispatchEvent(new br(t))},Ir.prototype.ra=function(t){this.a.dispatchEvent(new Er)},Ir.prototype.qa=function(){this.a.dispatchEvent("b")},mr.prototype.createWebChannel=mr.prototype.a,wr.prototype.send=wr.prototype.Pa,wr.prototype.open=wr.prototype.Oa,wr.prototype.close=wr.prototype.close,Ae.NO_ERROR=0,Ae.TIMEOUT=8,Ae.HTTP_ERROR=6,Se.COMPLETE="complete",(Re.EventType=xe).OPEN="a",xe.CLOSE="b",xe.ERROR="c",xe.MESSAGE="d",zt.prototype.listen=zt.prototype.va,Mn.prototype.listenOnce=Mn.prototype.wa,Mn.prototype.getLastError=Mn.prototype.Qa,Mn.prototype.getLastErrorCode=Mn.prototype.ua,Mn.prototype.getStatus=Mn.prototype.X,Mn.prototype.getResponseJson=Mn.prototype.Na,Mn.prototype.getResponseText=Mn.prototype.$,Mn.prototype.send=Mn.prototype.ba;var Tr={createWebChannelTransport:function(){return new mr},ErrorCode:Ae,EventType:Se,WebChannel:Re,XhrIo:Mn},_r=Tr.createWebChannelTransport,Nr=Tr.ErrorCode,Ar=Tr.EventType,Sr=Tr.WebChannel,Dr=Tr.XhrIo,kr=(Rr.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},Rr.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},Rr.prototype.setServiceProps=function(t){return this.serviceProps=t,this},Rr);function Rr(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var Lr=new p("@firebase/firestore");function xr(){return Lr.logLevel}function Or(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Lr.logLevel<=l.DEBUG&&(e=n.map(Vr),Lr.debug.apply(Lr,s(["Firestore (7.19.1): "+t],e)))}function Pr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Lr.logLevel<=l.ERROR&&(e=n.map(Vr),Lr.error.apply(Lr,s(["Firestore (7.19.1): "+t],e)))}function Cr(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];Lr.logLevel<=l.WARN&&(e=n.map(Vr),Lr.warn.apply(Lr,s(["Firestore (7.19.1): "+t],e)))}function Vr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Ur(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (7.19.1) INTERNAL ASSERTION FAILED: "+t;throw Pr(e),new Error(e)}function Mr(t){t||Ur()}function Fr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var qr=(jr.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Fr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},jr);function jr(){}function Gr(t,e){return t<e?-1:e<t?1:0}function Br(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function zr(t){return t+"\0"}function Hr(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var Wr=(Object.defineProperty(Kr.prototype,"i",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),Kr.prototype.isEqual=function(t){return t instanceof Kr&&t.projectId===this.projectId&&t.database===this.database},Kr.prototype.o=function(t){return Gr(this.projectId,t.projectId)||Gr(this.database,t.database)},Kr);function Kr(t,e){this.projectId=t,this.database=e||"(default)"}function Yr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Xr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Qr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Zr,Jr,$r,ti=(gi.prototype.get=function(t){var e=this.h(t),n=this.l[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.u(s,t))return u}},gi.prototype.has=function(t){return void 0!==this.get(t)},gi.prototype.set=function(t,e){var n=this.h(t),r=this.l[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.u(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.l[n]=[[t,e]]},gi.prototype.delete=function(t){var e=this.h(t),n=this.l[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.u(n[r][0],t))return 1===n.length?delete this.l[e]:n.splice(r,1),!0;return!1},gi.prototype.forEach=function(u){Xr(this.l,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},gi.prototype._=function(){return Qr(this.l)},gi),ei={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},ni=(o(vi,$r=Error),vi),ri=(yi.now=function(){return yi.fromMillis(Date.now())},yi.fromDate=function(t){return yi.fromMillis(t.getTime())},yi.fromMillis=function(t){var e=Math.floor(t/1e3);return new yi(e,1e6*(t-1e3*e))},yi.prototype.toDate=function(){return new Date(this.toMillis())},yi.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},yi.prototype.T=function(t){return this.seconds===t.seconds?Gr(this.nanoseconds,t.nanoseconds):Gr(this.seconds,t.seconds)},yi.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},yi.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},yi.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},yi.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},yi),ii=(di.I=function(t){return new di(t)},di.min=function(){return new di(new ri(0,0))},di.prototype.o=function(t){return this.timestamp.T(t.timestamp)},di.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},di.prototype.m=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},di.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},di.prototype.A=function(){return this.timestamp},di),oi=(Object.defineProperty(pi.prototype,"length",{get:function(){return this.R},enumerable:!1,configurable:!0}),pi.prototype.isEqual=function(t){return 0===pi.P(this,t)},pi.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof pi?t.forEach(function(t){e.push(t)}):e.push(t),this.g(e)},pi.prototype.limit=function(){return this.offset+this.length},pi.prototype.V=function(t){return t=void 0===t?1:t,this.g(this.segments,this.offset+t,this.length-t)},pi.prototype.p=function(){return this.g(this.segments,this.offset,this.length-1)},pi.prototype.v=function(){return this.segments[this.offset]},pi.prototype.S=function(){return this.get(this.length-1)},pi.prototype.get=function(t){return this.segments[this.offset+t]},pi.prototype._=function(){return 0===this.length},pi.prototype.D=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},pi.prototype.C=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},pi.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},pi.prototype.N=function(){return this.segments.slice(this.offset,this.limit())},pi.P=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},pi),si=(o(li,Jr=oi),li.prototype.g=function(t,e,n){return new li(t,e,n)},li.prototype.F=function(){return this.N().join("/")},li.prototype.toString=function(){return this.F()},li.k=function(t){if(0<=t.indexOf("//"))throw new ni(ei.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new li(t.split("/").filter(function(t){return 0<t.length}))},li.$=function(){return new li([])},li),ui=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ai=(o(fi,Zr=oi),fi.prototype.g=function(t,e,n){return new fi(t,e,n)},fi.O=function(t){return ui.test(t)},fi.prototype.F=function(){return this.N().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),fi.O(t)||(t="`"+t+"`"),t}).join(".")},fi.prototype.toString=function(){return this.F()},fi.prototype.M=function(){return 1===this.length&&"__name__"===this.get(0)},fi.L=function(){return new fi(["__name__"])},fi.q=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new ni(ei.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new ni(ei.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new ni(ei.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new ni(ei.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new fi(e)},fi.$=function(){return new fi([])},fi),ci=(hi.B=function(t){return new hi(si.k(t))},hi.U=function(t){return new hi(si.k(t).V(5))},hi.prototype.W=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},hi.prototype.isEqual=function(t){return null!==t&&0===si.P(this.path,t.path)},hi.prototype.toString=function(){return this.path.toString()},hi.P=function(t,e){return si.P(t.path,e.path)},hi.j=function(t){return t.length%2==0},hi.K=function(t){return new hi(new si(t.slice()))},hi);function hi(t){this.path=t}function fi(){return null!==Zr&&Zr.apply(this,arguments)||this}function li(){return null!==Jr&&Jr.apply(this,arguments)||this}function pi(t,e,n){void 0===e?e=0:e>t.length&&Ur(),void 0===n?n=t.length-e:n>t.length-e&&Ur(),this.segments=t,this.offset=e,this.R=n}function di(t){this.timestamp=t}function yi(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new ni(ei.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new ni(ei.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new ni(ei.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new ni(ei.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function vi(t,e){var n=this;return(n=$r.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function gi(t,e){this.h=t,this.u=e,this.l={}}function mi(t){return null==t}function wi(t){return-0===t&&1/t==-1/0}function bi(t){return"number"==typeof t&&Number.isInteger(t)&&!wi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Ei=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.G=null};function Ii(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Ei(t,e,n,r,i,o,s)}function Ti(t){var e,n=t;return null===n.G&&(e=n.path.F(),null!==n.collectionGroup&&(e+="|cg:"+n.collectionGroup),e+="|f:",e+=n.filters.map(function(t){return(e=t).field.F()+e.op.toString()+Ao(e.value);var e}).join(","),e+="|ob:",e+=n.orderBy.map(function(t){return(e=t).field.F()+e.dir;var e}).join(","),mi(n.limit)||(e+="|l:",e+=n.limit),n.startAt&&(e+="|lb:",e+=oa(n.startAt)),n.endAt&&(e+="|ub:",e+=oa(n.endAt)),n.G=e),n.G}function _i(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i=0;i<t.orderBy.length;i++)if(n=t.orderBy[i],r=e.orderBy[i],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var o,s,u=0;u<t.filters.length;u++)if(o=t.filters[u],s=e.filters[u],o.op!==s.op||!o.field.isEqual(s.field)||!Io(o.value,s.value))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ua(t.startAt,e.startAt)&&ua(t.endAt,e.endAt)}function Ni(t){return ci.j(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Ai=(Si.fromBase64String=function(t){return new Si(atob(t))},Si.fromUint8Array=function(t){return new Si(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},Si.prototype.toBase64=function(){return t=this.H,btoa(t);var t},Si.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.H)},Si.prototype.Y=function(){return 2*this.H.length},Si.prototype.o=function(t){return Gr(this.H,t.H)},Si.prototype.isEqual=function(t){return this.H===t.H},Si);function Si(t){this.H=t}Ai.J=new Ai("");function Di(t){this.count=t}var ki,Ri,Li=(xi.prototype.tt=function(t){return new xi(this.target,this.targetId,this.X,t,this.Z,this.lastLimboFreeSnapshotVersion,this.resumeToken)},xi.prototype.et=function(t,e){return new xi(this.target,this.targetId,this.X,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},xi.prototype.nt=function(t){return new xi(this.target,this.targetId,this.X,this.sequenceNumber,this.Z,t,this.resumeToken)},xi);function xi(t,e,n,r,i,o,s){void 0===i&&(i=ii.min()),void 0===o&&(o=ii.min()),void 0===s&&(s=Ai.J),this.target=t,this.targetId=e,this.X=n,this.sequenceNumber=r,this.Z=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Oi(t){switch(t){case ei.OK:return Ur();case ei.CANCELLED:case ei.UNKNOWN:case ei.DEADLINE_EXCEEDED:case ei.RESOURCE_EXHAUSTED:case ei.INTERNAL:case ei.UNAVAILABLE:case ei.UNAUTHENTICATED:return;case ei.INVALID_ARGUMENT:case ei.NOT_FOUND:case ei.ALREADY_EXISTS:case ei.PERMISSION_DENIED:case ei.FAILED_PRECONDITION:case ei.ABORTED:case ei.OUT_OF_RANGE:case ei.UNIMPLEMENTED:case ei.DATA_LOSS:return 1;default:return Ur()}}function Pi(t){if(void 0===t)return Pr("GRPC error has no .code"),ei.UNKNOWN;switch(t){case ki.OK:return ei.OK;case ki.CANCELLED:return ei.CANCELLED;case ki.UNKNOWN:return ei.UNKNOWN;case ki.DEADLINE_EXCEEDED:return ei.DEADLINE_EXCEEDED;case ki.RESOURCE_EXHAUSTED:return ei.RESOURCE_EXHAUSTED;case ki.INTERNAL:return ei.INTERNAL;case ki.UNAVAILABLE:return ei.UNAVAILABLE;case ki.UNAUTHENTICATED:return ei.UNAUTHENTICATED;case ki.INVALID_ARGUMENT:return ei.INVALID_ARGUMENT;case ki.NOT_FOUND:return ei.NOT_FOUND;case ki.ALREADY_EXISTS:return ei.ALREADY_EXISTS;case ki.PERMISSION_DENIED:return ei.PERMISSION_DENIED;case ki.FAILED_PRECONDITION:return ei.FAILED_PRECONDITION;case ki.ABORTED:return ei.ABORTED;case ki.OUT_OF_RANGE:return ei.OUT_OF_RANGE;case ki.UNIMPLEMENTED:return ei.UNIMPLEMENTED;case ki.DATA_LOSS:return ei.DATA_LOSS;default:return Ur()}}(Ri=ki=ki||{})[Ri.OK=0]="OK",Ri[Ri.CANCELLED=1]="CANCELLED",Ri[Ri.UNKNOWN=2]="UNKNOWN",Ri[Ri.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ri[Ri.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ri[Ri.NOT_FOUND=5]="NOT_FOUND",Ri[Ri.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ri[Ri.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ri[Ri.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ri[Ri.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ri[Ri.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ri[Ri.ABORTED=10]="ABORTED",Ri[Ri.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ri[Ri.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ri[Ri.INTERNAL=13]="INTERNAL",Ri[Ri.UNAVAILABLE=14]="UNAVAILABLE",Ri[Ri.DATA_LOSS=15]="DATA_LOSS";var Ci=(qi.prototype.st=function(t,e){return new qi(this.P,this.root.st(t,e,this.P).copy(null,null,Ui.it,null,null))},qi.prototype.remove=function(t){return new qi(this.P,this.root.remove(t,this.P).copy(null,null,Ui.it,null,null))},qi.prototype.get=function(t){for(var e=this.root;!e._();){var n=this.P(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},qi.prototype.indexOf=function(t){for(var e=0,n=this.root;!n._();){var r=this.P(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},qi.prototype._=function(){return this.root._()},Object.defineProperty(qi.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),qi.prototype.rt=function(){return this.root.rt()},qi.prototype.ot=function(){return this.root.ot()},qi.prototype.ht=function(t){return this.root.ht(t)},qi.prototype.forEach=function(n){this.ht(function(t,e){return n(t,e),!1})},qi.prototype.toString=function(){var n=[];return this.ht(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},qi.prototype.at=function(t){return this.root.at(t)},qi.prototype.ut=function(){return new Vi(this.root,null,this.P,!1)},qi.prototype.ct=function(t){return new Vi(this.root,t,this.P,!1)},qi.prototype.lt=function(){return new Vi(this.root,null,this.P,!0)},qi.prototype._t=function(t){return new Vi(this.root,t,this.P,!0)},qi),Vi=(Fi.prototype.wt=function(){var t=this.dt.pop(),e={key:t.key,value:t.value};if(this.ft)for(t=t.left;!t._();)this.dt.push(t),t=t.right;else for(t=t.right;!t._();)this.dt.push(t),t=t.left;return e},Fi.prototype.Tt=function(){return 0<this.dt.length},Fi.prototype.Et=function(){if(0===this.dt.length)return null;var t=this.dt[this.dt.length-1];return{key:t.key,value:t.value}},Fi),Ui=(Mi.prototype.copy=function(t,e,n,r,i){return new Mi(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Mi.prototype._=function(){return!1},Mi.prototype.ht=function(t){return this.left.ht(t)||t(this.key,this.value)||this.right.ht(t)},Mi.prototype.at=function(t){return this.right.at(t)||t(this.key,this.value)||this.left.at(t)},Mi.prototype.min=function(){return this.left._()?this:this.left.min()},Mi.prototype.rt=function(){return this.min().key},Mi.prototype.ot=function(){return this.right._()?this.key:this.right.ot()},Mi.prototype.st=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.st(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.st(t,e,n))).It()},Mi.prototype.At=function(){if(this.left._())return Mi.EMPTY;var t=this;return t.left.Rt()||t.left.left.Rt()||(t=t.Pt()),(t=t.copy(null,null,null,t.left.At(),null)).It()},Mi.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left._()||r.left.Rt()||r.left.left.Rt()||(r=r.Pt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.Rt()&&(r=r.gt()),r.right._()||r.right.Rt()||r.right.left.Rt()||(r=r.Vt()),0===e(t,r.key)){if(r.right._())return Mi.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.At())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.It()},Mi.prototype.Rt=function(){return this.color},Mi.prototype.It=function(){var t=this;return t.right.Rt()&&!t.left.Rt()&&(t=t.yt()),t.left.Rt()&&t.left.left.Rt()&&(t=t.gt()),t.left.Rt()&&t.right.Rt()&&(t=t.pt()),t},Mi.prototype.Pt=function(){var t=this.pt();return t.right.left.Rt()&&(t=(t=(t=t.copy(null,null,null,null,t.right.gt())).yt()).pt()),t},Mi.prototype.Vt=function(){var t=this.pt();return t.left.left.Rt()&&(t=(t=t.gt()).pt()),t},Mi.prototype.yt=function(){var t=this.copy(null,null,Mi.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Mi.prototype.gt=function(){var t=this.copy(null,null,Mi.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Mi.prototype.pt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Mi.prototype.bt=function(){var t=this.vt();return Math.pow(2,t)<=this.size+1},Mi.prototype.vt=function(){if(this.Rt()&&this.left.Rt())throw Ur();if(this.right.Rt())throw Ur();var t=this.left.vt();if(t!==this.right.vt())throw Ur();return t+(this.Rt()?0:1)},Mi);function Mi(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Mi.RED,this.left=null!=r?r:Mi.EMPTY,this.right=null!=i?i:Mi.EMPTY,this.size=this.left.size+1+this.right.size}function Fi(t,e,n,r){this.ft=r,this.dt=[];for(var i=1;!t._();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.ft?t.left:t.right;else{if(0===i){this.dt.push(t);break}this.dt.push(t),t=this.ft?t.right:t.left}}function qi(t,e){this.P=t,this.root=e||Ui.EMPTY}function ji(){this.size=0}Ui.EMPTY=null,Ui.RED=!0,Ui.it=!1,Ui.EMPTY=(Object.defineProperty(ji.prototype,"key",{get:function(){throw Ur()},enumerable:!1,configurable:!0}),Object.defineProperty(ji.prototype,"value",{get:function(){throw Ur()},enumerable:!1,configurable:!0}),Object.defineProperty(ji.prototype,"color",{get:function(){throw Ur()},enumerable:!1,configurable:!0}),Object.defineProperty(ji.prototype,"left",{get:function(){throw Ur()},enumerable:!1,configurable:!0}),Object.defineProperty(ji.prototype,"right",{get:function(){throw Ur()},enumerable:!1,configurable:!0}),ji.prototype.copy=function(t,e,n,r,i){return this},ji.prototype.st=function(t,e,n){return new Ui(t,e)},ji.prototype.remove=function(t,e){return this},ji.prototype._=function(){return!0},ji.prototype.ht=function(t){return!1},ji.prototype.at=function(t){return!1},ji.prototype.rt=function(){return null},ji.prototype.ot=function(){return null},ji.prototype.Rt=function(){return!1},ji.prototype.bt=function(){return!0},ji.prototype.vt=function(){return 0},new ji);var Gi=(Wi.prototype.has=function(t){return null!==this.data.get(t)},Wi.prototype.first=function(){return this.data.rt()},Wi.prototype.last=function(){return this.data.ot()},Object.defineProperty(Wi.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Wi.prototype.indexOf=function(t){return this.data.indexOf(t)},Wi.prototype.forEach=function(n){this.data.ht(function(t,e){return n(t),!1})},Wi.prototype.St=function(t,e){for(var n=this.data.ct(t[0]);n.Tt();){var r=n.wt();if(0<=this.P(r.key,t[1]))return;e(r.key)}},Wi.prototype.Dt=function(t,e){for(var n=void 0!==e?this.data.ct(e):this.data.ut();n.Tt();)if(!t(n.wt().key))return},Wi.prototype.Ct=function(t){var e=this.data.ct(t);return e.Tt()?e.wt().key:null},Wi.prototype.ut=function(){return new Bi(this.data.ut())},Wi.prototype.ct=function(t){return new Bi(this.data.ct(t))},Wi.prototype.add=function(t){return this.copy(this.data.remove(t).st(t,!0))},Wi.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Wi.prototype._=function(){return this.data._()},Wi.prototype.Nt=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Wi.prototype.isEqual=function(t){if(!(t instanceof Wi))return!1;if(this.size!==t.size)return!1;for(var e=this.data.ut(),n=t.data.ut();e.Tt();){var r=e.wt().key,i=n.wt().key;if(0!==this.P(r,i))return!1}return!0},Wi.prototype.N=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Wi.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Wi.prototype.copy=function(t){var e=new Wi(this.P);return e.data=t,e},Wi),Bi=(Hi.prototype.wt=function(){return this.Ft.wt().key},Hi.prototype.Tt=function(){return this.Ft.Tt()},Hi),zi=new Ci(ci.P);function Hi(t){this.Ft=t}function Wi(t){this.P=t,this.data=new Ci(this.P)}var Ki=new Ci(ci.P);var Yi=new Ci(ci.P),Xi=new Gi(ci.P);function Qi(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Xi,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Zi=new Gi(Gr);function Ji(t,e,n,r){this.te=t,this.removedTargetIds=e,this.key=n,this.ee=r}function $i(t,e){this.targetId=t,this.ne=e}function to(t,e,n,r){void 0===n&&(n=Ai.J),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var eo=(yo.xt=function(t){return new yo(t.P)},yo.prototype.has=function(t){return null!=this.kt.get(t)},yo.prototype.get=function(t){return this.kt.get(t)},yo.prototype.first=function(){return this.$t.rt()},yo.prototype.last=function(){return this.$t.ot()},yo.prototype._=function(){return this.$t._()},yo.prototype.indexOf=function(t){var e=this.kt.get(t);return e?this.$t.indexOf(e):-1},Object.defineProperty(yo.prototype,"size",{get:function(){return this.$t.size},enumerable:!1,configurable:!0}),yo.prototype.forEach=function(n){this.$t.ht(function(t,e){return n(t),!1})},yo.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.kt.st(t.key,t),e.$t.st(t,null))},yo.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.kt.remove(t),this.$t.remove(e)):this},yo.prototype.isEqual=function(t){if(!(t instanceof yo))return!1;if(this.size!==t.size)return!1;for(var e=this.$t.ut(),n=t.$t.ut();e.Tt();){var r=e.wt().key,i=n.wt().key;if(!r.isEqual(i))return!1}return!0},yo.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},yo.prototype.copy=function(t,e){var n=new yo;return n.P=this.P,n.kt=t,n.$t=e,n},yo),no=(po.prototype.track=function(t){var e=t.doc.key,n=this.Ot.get(e);!n||0!==t.type&&3===n.type?this.Ot=this.Ot.st(e,t):3===t.type&&1!==n.type?this.Ot=this.Ot.st(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Ot=this.Ot.st(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Ot=this.Ot.st(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Ot=this.Ot.remove(e):1===t.type&&2===n.type?this.Ot=this.Ot.st(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Ot=this.Ot.st(e,{type:2,doc:t.doc}):Ur()},po.prototype.Mt=function(){var n=[];return this.Ot.ht(function(t,e){n.push(e)}),n},po),ro=(lo.Qt=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new lo(t,e,eo.xt(e),i,n,r,!0,!1)},Object.defineProperty(lo.prototype,"hasPendingWrites",{get:function(){return!this.qt._()},enumerable:!1,configurable:!0}),lo.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Bt===t.Bt&&this.qt.isEqual(t.qt)&&Du(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Lt.isEqual(t.Lt)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},lo),io=(fo.zt=function(t,e){var n=new Map;return n.set(t,oo.Ht(t,e)),new fo(ii.min(),n,Zi,zi,Qi())},fo),oo=(ho.Ht=function(t,e){return new ho(Ai.J,e,Qi(),Qi(),Qi())},ho),so=(Object.defineProperty(co.prototype,"Yt",{get:function(){return this.oe},enumerable:!1,configurable:!0}),Object.defineProperty(co.prototype,"resumeToken",{get:function(){return this.re},enumerable:!1,configurable:!0}),Object.defineProperty(co.prototype,"ae",{get:function(){return 0!==this.se},enumerable:!1,configurable:!0}),Object.defineProperty(co.prototype,"ue",{get:function(){return this.he},enumerable:!1,configurable:!0}),co.prototype.ce=function(t){0<t.Y()&&(this.he=!0,this.re=t)},co.prototype.le=function(){var n=Qi(),r=Qi(),i=Qi();return this.ie.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Ur()}}),new oo(this.re,this.oe,n,r,i)},co.prototype._e=function(){this.he=!1,this.ie=go()},co.prototype.fe=function(t,e){this.he=!0,this.ie=this.ie.st(t,e)},co.prototype.de=function(t){this.he=!0,this.ie=this.ie.remove(t)},co.prototype.we=function(){this.se+=1},co.prototype.Te=function(){--this.se},co.prototype.Ee=function(){this.he=!0,this.oe=!0},co),uo=(ao.prototype.ge=function(t){for(var e=0,n=t.te;e<n.length;e++){var r=n[e];t.ee instanceof fu?this.Ve(r,t.ee):t.ee instanceof lu&&this.ye(r,t.key,t.ee)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ye(s,t.key,t.ee)}},ao.prototype.pe=function(n){var r=this;this.be(n,function(t){var e=r.ve(t);switch(n.state){case 0:r.Se(t)&&e.ce(n.resumeToken);break;case 1:e.Te(),e.ae||e._e(),e.ce(n.resumeToken);break;case 2:e.Te(),e.ae||r.removeTarget(t);break;case 3:r.Se(t)&&(e.Ee(),e.ce(n.resumeToken));break;case 4:r.Se(t)&&(r.De(t),e.ce(n.resumeToken));break;default:Ur()}})},ao.prototype.be=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.me.forEach(function(t,e){r.Se(e)&&n(e)})},ao.prototype.Ce=function(t){var e,n,r=t.targetId,i=t.ne.count,o=this.Ne(r);o&&(Ni(e=o.target)?0===i?(n=new ci(e.path),this.ye(r,n,new lu(n,ii.min()))):Mr(1===i):this.Fe(r)!==i&&(this.De(r),this.Pe=this.Pe.add(r)))},ao.prototype.ke=function(i){var o=this,s=new Map;this.me.forEach(function(t,e){var n,r=o.Ne(e);r&&(t.Yt&&Ni(r.target)&&(n=new ci(r.target.path),null!==o.Ae.get(n)||o.$e(e,n)||o.ye(e,n,new lu(n,i))),t.ue&&(s.set(e,t.le()),t._e()))});var r=Qi();this.Re.forEach(function(t,e){var n=!0;e.Dt(function(t){var e=o.Ne(t);return!e||2===e.X||(n=!1)}),n&&(r=r.add(t))});var t=new io(i,s,this.Pe,this.Ae,r);return this.Ae=zi,this.Re=vo(),this.Pe=new Gi(Gr),t},ao.prototype.Ve=function(t,e){var n;this.Se(t)&&(n=this.$e(t,e.key)?2:0,this.ve(t).fe(e.key,n),this.Ae=this.Ae.st(e.key,e),this.Re=this.Re.st(e.key,this.xe(e.key).add(t)))},ao.prototype.ye=function(t,e,n){var r;this.Se(t)&&(r=this.ve(t),this.$e(t,e)?r.fe(e,1):r.de(e),this.Re=this.Re.st(e,this.xe(e).delete(t)),n&&(this.Ae=this.Ae.st(e,n)))},ao.prototype.removeTarget=function(t){this.me.delete(t)},ao.prototype.Fe=function(t){var e=this.ve(t).le();return this.Ie.Oe(t).size+e.Jt.size-e.Zt.size},ao.prototype.we=function(t){this.ve(t).we()},ao.prototype.ve=function(t){var e=this.me.get(t);return e||(e=new so,this.me.set(t,e)),e},ao.prototype.xe=function(t){var e=this.Re.get(t);return e||(e=new Gi(Gr),this.Re=this.Re.st(t,e)),e},ao.prototype.Se=function(t){var e=null!==this.Ne(t);return e||Or("WatchChangeAggregator","Detected inactive target",t),e},ao.prototype.Ne=function(t){var e=this.me.get(t);return e&&e.ae?null:this.Ie.Me(t)},ao.prototype.De=function(e){var n=this;this.me.set(e,new so),this.Ie.Oe(e).forEach(function(t){n.ye(e,t,null)})},ao.prototype.$e=function(t,e){return this.Ie.Oe(t).has(e)},ao);function ao(t){this.Ie=t,this.me=new Map,this.Ae=zi,this.Re=vo(),this.Pe=new Gi(Gr)}function co(){this.se=0,this.ie=go(),this.re=Ai.J,this.oe=!1,this.he=!0}function ho(t,e,n,r,i){this.resumeToken=t,this.Yt=e,this.Jt=n,this.Xt=r,this.Zt=i}function fo(t,e,n,r,i){this.Z=t,this.Wt=e,this.jt=n,this.Kt=r,this.Gt=i}function lo(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Lt=n,this.docChanges=r,this.qt=i,this.fromCache=o,this.Bt=s,this.Ut=u}function po(){this.Ot=new Ci(ci.P)}function yo(n){this.P=n?function(t,e){return n(t,e)||ci.P(t.key,e.key)}:function(t,e){return ci.P(t.key,e.key)},this.kt=Ki,this.$t=new Ci(this.P)}function vo(){return new Ci(ci.P)}function go(){return new Ci(ci.P)}function mo(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function wo(t){var e=So(t.mapValue.fields.__local_write_time__.timestampValue);return new ri(e.seconds,e.nanos)}var bo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Eo(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?mo(t)?4:10:Ur()}function Io(r,i){var t,e,n,o=Eo(r);if(o!==Eo(i))return!1;switch(o){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return wo(r).isEqual(wo(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=So(r.timestampValue),n=So(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return n=i,ko(r.bytesValue).isEqual(ko(n.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,Do((t=r).geoPointValue.latitude)===Do(e.geoPointValue.latitude)&&Do(t.geoPointValue.longitude)===Do(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Do(t.integerValue)===Do(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=Do(t.doubleValue),r=Do(e.doubleValue);return n===r?wi(n)===wi(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return Br(r.arrayValue.values||[],i.arrayValue.values||[],Io);case 10:return function(){var t=r.mapValue.fields||{},e=i.mapValue.fields||{};if(Yr(t)!==Yr(e))return!1;for(var n in t)if(t.hasOwnProperty(n)&&(void 0===e[n]||!Io(t[n],e[n])))return!1;return!0}();default:return Ur()}}function To(t,e){return void 0!==(t.values||[]).find(function(t){return Io(t,e)})}function _o(t,e){var n,r,i,o,s,u,a,c,h,f,l=Eo(t),p=Eo(e);if(l!==p)return Gr(l,p);switch(l){case 0:return 0;case 1:return Gr(t.booleanValue,e.booleanValue);case 2:return c=e,h=Do(t.integerValue||t.doubleValue),f=Do(c.integerValue||c.doubleValue),h<f?-1:f<h?1:h===f?0:isNaN(h)?isNaN(f)?0:-1:1;case 3:return No(t.timestampValue,e.timestampValue);case 4:return No(wo(t),wo(e));case 5:return Gr(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=ko(o),a=ko(s),u.o(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Gr(n[i],r[i]);if(0!==o)return o}return Gr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=Gr(Do(n.latitude),Do(r.latitude)))?i:Gr(Do(n.longitude),Do(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=_o(n[i],r[i]);if(o)return o}return Gr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Gr(r[s],o[s]);if(0!==u)return u;var a=_o(n[r[s]],i[o[s]]);if(0!==a)return a}return Gr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Ur()}}function No(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Gr(t,e);var n=So(t),r=So(e),i=Gr(n.seconds,r.seconds);return 0!==i?i:Gr(n.nanos,r.nanos)}function Ao(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=So(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?ko(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,ci.U(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++){e?e=!1:t+=",",t+=s(r[n])}return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):Ur();var t,e,n}(t)}function So(t){if(Mr(!!t),"string"!=typeof t)return{seconds:Do(t.seconds),nanos:Do(t.nanos)};var e,n=0,r=bo.exec(t);Mr(!!r),r[1]&&(e=((e=r[1])+"000000000").substr(0,9),n=Number(e));var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:n}}function Do(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function ko(t){return"string"==typeof t?Ai.fromBase64String(t):Ai.fromUint8Array(t)}function Ro(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.F()}}function Lo(t){return t&&"integerValue"in t}function xo(t){return!!t&&"arrayValue"in t}function Oo(t){return t&&"nullValue"in t}function Po(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Co(t){return t&&"mapValue"in t}var Vo={asc:"ASCENDING",desc:"DESCENDING"},Uo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Mo=function(t,e){this.s=t,this.Le=e};function Fo(t){return{integerValue:""+t}}function qo(t,e){if(t.Le){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:wi(e)?"-0":e}}function jo(t,e){return bi(e)?Fo(e):qo(t,e)}function Go(t,e){return t.Le?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Bo(t,e){return t.Le?e.toBase64():e.toUint8Array()}function zo(t){return Mr(!!t),ii.I((e=So(t),new ri(e.seconds,e.nanos)));var e}function Ho(t,e){return new si(["projects",t.projectId,"databases",t.database]).child("documents").child(e).F()}function Wo(t){var e=si.k(t);return Mr(as(e)),e}function Ko(t,e){return Ho(t.s,e.path)}function Yo(t,e){var n=Wo(e);return Mr(n.get(1)===t.s.projectId),Mr(!n.get(3)&&!t.s.database||n.get(3)===t.s.database),new ci(Jo(n))}function Xo(t,e){return Ho(t.s,e)}function Qo(t){var e=Wo(t);return 4===e.length?si.$():Jo(e)}function Zo(t){return new si(["projects",t.s.projectId,"databases",t.s.database]).F()}function Jo(t){return Mr(4<t.length&&"documents"===t.get(4)),t.V(5)}function $o(t,e,n){return{name:Ko(t,e),fields:n.proto.mapValue.fields}}function ts(t,e){var n,r,i,o,s,u;if(e instanceof js)n={update:$o(t,e.key,e.value)};else if(e instanceof Js)n={delete:Ko(t,e.key)};else if(e instanceof Gs)n={update:$o(t,e.key,e.data),updateMask:(r=e.qe,i=[],r.fields.forEach(function(t){return i.push(t.F())}),{fieldPaths:i})};else if(e instanceof Ks)n={transform:{document:Ko(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof ps)return{fieldPath:t.field.F(),setToServerValue:"REQUEST_TIME"};if(e instanceof ds)return{fieldPath:t.field.F(),appendMissingElements:{values:e.elements}};if(e instanceof ws)return{fieldPath:t.field.F(),removeAllFromArray:{values:e.elements}};if(e instanceof Ts)return{fieldPath:t.field.F(),increment:e.Be};throw Ur()})}};else{if(!(e instanceof $s))return Ur();n={verify:Ko(t,e.key)}}return e.Qe.Ue||(n.currentDocument=void 0!==(o=e.Qe).updateTime?{updateTime:(s=t,u=o.updateTime,Go(s,u.A()))}:void 0!==o.exists?{exists:o.exists}:Ur()),n}function es(e,t){var n,r,i=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?Ls.updateTime(zo(n.updateTime)):void 0!==n.exists?Ls.exists(n.exists):Ls.We():Ls.We();if(t.update){t.update.name;var o=Yo(e,t.update.name),s=new tu({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=(r=t.updateMask.fieldPaths||[],new Ss(r.map(function(t){return ai.q(t)})));return new Gs(o,s,u,i)}return new js(o,s,i)}if(t.delete){var a=Yo(e,t.delete);return new Js(a,i)}if(t.transform){var c=Yo(e,t.transform.document),h=t.transform.fieldTransforms.map(function(t){return function(t,e){var n,r,i=null;"setToServerValue"in e?(Mr("REQUEST_TIME"===e.setToServerValue),i=new ps):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],i=new ds(n)):"removeAllFromArray"in e?(r=e.removeAllFromArray.values||[],i=new ws(r)):"increment"in e?i=new Ts(t,e.increment):Ur();var o=ai.q(e.fieldPath);return new Ds(o,i)}(e,t)});return Mr(!0===i.exists),new Ks(c,h)}if(t.verify){var f=Yo(e,t.verify);return new $s(f,i)}return Ur()}function ns(t,e){return{documents:[Xo(t,e.path)]}}function rs(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Xo(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Xo(t,r.p()),n.structuredQuery.from=[{collectionId:r.S()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){if("=="===t.op){if(Po(t.value))return{unaryFilter:{field:ss(t.field),op:"IS_NAN"}};if(Oo(t.value))return{unaryFilter:{field:ss(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Po(t.value))return{unaryFilter:{field:ss(t.field),op:"IS_NOT_NAN"}};if(Oo(t.value))return{unaryFilter:{field:ss(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ss(t.field),op:(e=t.op,Uo[e]),value:t.value}};var e});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return{field:ss((e=t).field),direction:(n=e.dir,Vo[n])};var e,n})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s,u=(s=e.limit,t.Le||mi(s)?s:{value:s});return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=is(e.startAt)),e.endAt&&(n.structuredQuery.endAt=is(e.endAt)),n}function is(t){return{before:t.before,values:t.position}}function os(t){var e=!!t.before,n=t.values||[];return new ta(n,e)}function ss(t){return{fieldPath:t.F()}}function us(t){return ai.q(t.fieldPath)}function as(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function cs(){this.je=void 0}function hs(t,e){return t instanceof Ts?Lo(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}var fs,ls,ps=(o(vs,ls=cs),vs),ds=(o(ys,fs=cs),ys);function ys(t){var e=this;return(e=fs.call(this)||this).elements=t,e}function vs(){return null!==ls&&ls.apply(this,arguments)||this}function gs(t,e){for(var n=As(e),r=function(e){n.some(function(t){return Io(t,e)})||n.push(e)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ms,ws=(o(bs,ms=cs),bs);function bs(t){var e=this;return(e=ms.call(this)||this).elements=t,e}function Es(t,e){for(var n=As(e),r=function(e){n=n.filter(function(t){return!Io(t,e)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Is,Ts=(o(_s,Is=cs),_s);function _s(t,e){var n=this;return(n=Is.call(this)||this).serializer=t,n.Be=e,n}function Ns(t){return Do(t.integerValue||t.doubleValue)}function As(t){return xo(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Ss=(ks.prototype.Ke=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].D(t))return!0;return!1},ks.prototype.isEqual=function(t){return Br(this.fields,t.fields,function(t,e){return t.isEqual(e)})},ks),Ds=function(t,e){this.field=t,this.transform=e};function ks(t){(this.fields=t).sort(ai.P)}function Rs(t,e){this.version=t,this.transformResults=e}var Ls=(xs.We=function(){return new xs},xs.exists=function(t){return new xs(void 0,t)},xs.updateTime=function(t){return new xs(t)},Object.defineProperty(xs.prototype,"Ue",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),xs.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},xs);function xs(t,e){this.updateTime=t,this.exists=e}function Os(t,e){return void 0!==t.updateTime?e instanceof fu&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof fu}function Ps(){}function Cs(t,e,n){return t instanceof js?new fu(t.key,n.version,t.value,{hasCommittedMutations:!0}):t instanceof Gs?function(t,e,n){if(!Os(t.Qe,e))return new pu(t.key,n.version);var r=Hs(t,e);return new fu(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof Ks?function(t,e,n){if(Mr(null!=n.transformResults),!Os(t.Qe,e))return new pu(t.key,n.version);var r=e,i=function(t,e,n){var r=[];Mr(t.length===n.length);for(var i,o,s,u=0;u<n.length;u++){var a=t[u],c=a.transform,h=null;e instanceof fu&&(h=e.field(a.field)),r.push((i=c,o=h,s=n[u],i instanceof ds?gs(i,o):i instanceof ws?Es(i,o):s))}return r}(t.fieldTransforms,e,n.transformResults),o=n.version,s=Xs(t,r.data(),i);return new fu(t.key,o,s,{hasCommittedMutations:!0})}(t,e,n):new lu(t.key,n.version,{hasCommittedMutations:!0})}function Vs(t,e,n,r){return t instanceof js?function(t,e){if(!Os(t.Qe,e))return e;var n=Ms(e);return new fu(t.key,n,t.value,{Ge:!0})}(t,e):t instanceof Gs?function(t,e){if(!Os(t.Qe,e))return e;var n=Ms(e),r=Hs(t,e);return new fu(t.key,n,r,{Ge:!0})}(t,e):t instanceof Ks?function(t,e,n,r){if(!Os(t.Qe,e))return e;var i=e,o=function(t,e,n,r){for(var i,o,s,u,a,c,h,f=[],l=0,p=t;l<p.length;l++){var d=p[l],y=d.transform,v=null;n instanceof fu&&(v=n.field(d.field)),null===v&&r instanceof fu&&(v=r.field(d.field)),f.push((o=v,s=e,h=c=a=u=void 0,(i=y)instanceof ps?(h={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}},o&&(h.fields.__previous_value__=o),{mapValue:h}):i instanceof ds?gs(i,o):i instanceof ws?Es(i,o):(a=hs(u=i,o),c=Ns(a)+Ns(u.Be),Lo(a)&&Lo(u.Be)?Fo(c):qo(u.serializer,c))))}return f}(t.fieldTransforms,n,e,r),s=Xs(t,i.data(),o);return new fu(t.key,i.version,s,{Ge:!0})}(t,e,r,n):(o=e,Os((i=t).Qe,o)?new lu(i.key,ii.min()):o);var i,o}function Us(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Qe.isEqual(e.Qe)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.qe.isEqual(e.qe):2!==t.type||Br(t.fieldTransforms,t.fieldTransforms,function(t,e){return r=e,(n=t).field.isEqual(r.field)&&(i=n.transform,o=r.transform,i instanceof ds&&o instanceof ds||i instanceof ws&&o instanceof ws?Br(i.elements,o.elements,Io):i instanceof Ts&&o instanceof Ts?Io(i.Be,o.Be):i instanceof ps&&o instanceof ps);var n,r,i,o}))}function Ms(t){return t instanceof fu?t.version:ii.min()}var Fs,qs,js=(o(zs,qs=Ps),zs),Gs=(o(Bs,Fs=Ps),Bs);function Bs(t,e,n,r){var i=this;return(i=Fs.call(this)||this).key=t,i.data=e,i.qe=n,i.Qe=r,i.type=1,i}function zs(t,e,n){var r=this;return(r=qs.call(this)||this).key=t,r.value=e,r.Qe=n,r.type=0,r}function Hs(t,e){return n=t,r=e instanceof fu?e.data():tu.empty(),i=new eu(r),n.qe.fields.forEach(function(t){var e;t._()||(null!==(e=n.data.field(t))?i.set(t,e):i.delete(t))}),i.ze();var n,r,i}var Ws,Ks=(o(Ys,Ws=Ps),Ys);function Ys(t,e){var n=this;return(n=Ws.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Qe=Ls.exists(!0),n}function Xs(t,e,n){for(var r=new eu(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.ze()}var Qs,Zs,Js=(o(ou,Zs=Ps),ou),$s=(o(iu,Qs=Ps),iu),tu=(ru.empty=function(){return new ru({mapValue:{}})},ru.prototype.field=function(t){if(t._())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Co(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.S()])||null},ru.prototype.isEqual=function(t){return Io(this.proto,t.proto)},ru),eu=(nu.prototype.set=function(t,e){return this.Je(t,e),this},nu.prototype.delete=function(t){return this.Je(t,null),this},nu.prototype.Je=function(t,e){for(var n=this.Ye,r=0;r<t.length-1;++r)var i=t.get(r),o=n.get(i),n=(o instanceof Map||(o=o&&10===Eo(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),o);n.set(t.S(),e)},nu.prototype.ze=function(){var t=this.Xe(ai.$(),this.Ye);return null!=t?new tu(t):this.He},nu.prototype.Xe=function(r,t){var i=this,o=!1,e=this.He.field(r),s=Co(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.Xe(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},nu);function nu(t){void 0===t&&(t=tu.empty()),this.He=t,this.Ye=new Map}function ru(t){this.proto=t}function iu(t,e){var n=this;return(n=Qs.call(this)||this).key=t,n.Qe=e,n.type=4,n}function ou(t,e){var n=this;return(n=Zs.call(this)||this).key=t,n.Qe=e,n.type=3,n}function su(t){var u=[];return Xr(t.fields||{},function(t,e){var n=new ai([t]);if(Co(e)){var r=su(e.mapValue).fields;if(0===r.length)u.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];u.push(n.child(s))}}else u.push(n)}),new Ss(u)}function uu(t,e){this.key=t,this.version=e}var au,cu,hu,fu=(o(vu,hu=uu),vu.prototype.field=function(t){return this.Ze.field(t)},vu.prototype.data=function(){return this.Ze},vu.prototype.tn=function(){return this.Ze.proto},vu.prototype.isEqual=function(t){return t instanceof vu&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ge===t.Ge&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Ze.isEqual(t.Ze)},vu.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Ze.toString()+", {hasLocalMutations: "+this.Ge+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(vu.prototype,"hasPendingWrites",{get:function(){return this.Ge||this.hasCommittedMutations},enumerable:!1,configurable:!0}),vu),lu=(o(yu,cu=uu),yu.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(yu.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),yu.prototype.isEqual=function(t){return t instanceof yu&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},yu),pu=(o(du,au=uu),du.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(du.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),du.prototype.isEqual=function(t){return t instanceof du&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},du);function du(){return null!==au&&au.apply(this,arguments)||this}function yu(t,e,n){var r=this;return(r=cu.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function vu(t,e,n,r){var i=this;return(i=hu.call(this,t,e)||this).Ze=n,i.Ge=!!r.Ge,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function gu(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new ni(ei.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass '"+e.name+"' from a different Firestore SDK?"):new ni(ei.INVALID_ARGUMENT,"Expected type '"+e.name+"', but was '"+t.constructor.name+"'");return t}var mu=(wu.prototype.on=function(t){return new wu(t,null,this.en.slice(),this.filters.slice(),this.limit,this.nn,this.startAt,this.endAt)},wu.prototype.hn=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.en.length||1===this.en.length&&this.en[0].field.M())},wu.prototype.an=function(){return!mi(this.limit)&&"F"===this.nn},wu.prototype.un=function(){return!mi(this.limit)&&"L"===this.nn},wu.prototype.cn=function(){return 0<this.en.length?this.en[0].field:null},wu.prototype.ln=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n._n())return n.field}return null},wu.prototype.fn=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(0<=t.indexOf(r.op))return r.op}return null},wu);function wu(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.en=n,this.filters=r,this.limit=i,this.nn=o,this.startAt=s,this.endAt=u,this.sn=null,this.rn=null,this.startAt,this.endAt}function bu(t,e,n,r,i,o,s,u){return new mu(t,e,n,r,i,o,s,u)}function Eu(t){return new mu(t)}function Iu(t){return null!==t.collectionGroup}function Tu(t){var e=gu(t,mu);if(null===e.sn){e.sn=[];var n=e.ln(),r=e.cn();if(null!==n&&null===r)n.M()||e.sn.push(new aa(n)),e.sn.push(new aa(ai.L(),"asc"));else{for(var i,o=!1,s=0,u=e.en;s<u.length;s++){var a=u[s];e.sn.push(a),a.field.M()&&(o=!0)}o||(i=0<e.en.length?e.en[e.en.length-1].dir:"asc",e.sn.push(new aa(ai.L(),i)))}}return e.sn}function _u(t){var e=gu(t,mu);if(!e.rn)if("F"===e.nn)e.rn=Ii(e.path,e.collectionGroup,Tu(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=Tu(e);r<i.length;r++){var o=i[r],s="desc"===o.dir?"asc":"desc";n.push(new aa(o.field,s))}var u=e.endAt?new ta(e.endAt.position,!e.endAt.before):null,a=e.startAt?new ta(e.startAt.position,!e.startAt.before):null;e.rn=Ii(e.path,e.collectionGroup,n,e.filters,e.limit,u,a)}return e.rn}function Nu(t,e,n){return new mu(t.path,t.collectionGroup,t.en.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Au(t,e){return new mu(t.path,t.collectionGroup,t.en.slice(),t.filters.slice(),t.limit,t.nn,e,t.endAt)}function Su(t,e){return new mu(t.path,t.collectionGroup,t.en.slice(),t.filters.slice(),t.limit,t.nn,t.startAt,e)}function Du(t,e){return _i(_u(t),_u(e))&&t.nn===e.nn}function ku(t){return Ti(_u(t))+"|lt:"+t.nn}function Ru(t){return"Query(target="+(e=_u(t),n=e.path.F(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(e=t).field.F()+" "+e.op+" "+Ao(e.value);var e}).join(", ")+"]"),mi(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(e=t).field.F()+" ("+e.dir+")";var e}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+oa(e.startAt)),e.endAt&&(n+=", endAt: "+oa(e.endAt)),"Target("+n+")")+"; limitType="+t.nn+")";var e,n}function Lu(i,t){return r=i,o=t.key.path,(null!==r.collectionGroup?t.key.W(r.collectionGroup)&&r.path.D(o):ci.j(r.path)?r.path.isEqual(o):r.path.C(o))&&function(t){for(var e=0,n=i.en;e<n.length;e++){var r=n[e];if(!r.field.M()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(e=i).startAt||sa(e.startAt,Tu(e),n))&&(!e.endAt||!sa(e.endAt,Tu(e),n)));var e,n,r,o}function xu(u){return function(t,e){for(var n=!1,r=0,i=Tu(u);r<i.length;r++){var o=i[r],s=ca(o,t,e);if(0!==s)return s;n=n||o.field.M()}return 0}}var Ou,Pu=(o(Cu,Ou=function(){}),Cu.create=function(t,e,n){if(t.M())return"in"===e||"not-in"===e?this.dn(t,e,n):new Fu(t,e,n);if(Oo(n)){if("=="!==e&&"!="!==e)throw new ni(ei.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new Cu(t,e,n)}if(Po(n)){if("=="!==e&&"!="!==e)throw new ni(ei.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new Cu(t,e,n)}return"array-contains"===e?new Qu(t,n):"in"===e?new Zu(t,n):"not-in"===e?new Ju(t,n):"array-contains-any"===e?new $u(t,n):new Cu(t,e,n)},Cu.dn=function(t,e,n){return new("in"===e?qu:ju)(t,n)},Cu.prototype.matches=function(t){var e=t.field(this.field);return"!="===this.op?null!==e&&this.wn(_o(e,this.value)):null!==e&&Eo(this.value)===Eo(e)&&this.wn(_o(e,this.value))},Cu.prototype.wn=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return 0<t;case">=":return 0<=t;default:return Ur()}},Cu.prototype._n=function(){return 0<=["<","<=",">",">=","!="].indexOf(this.op)},Cu);function Cu(t,e,n){var r=this;return(r=Ou.call(this)||this).field=t,r.op=e,r.value=n,r}var Vu,Uu,Mu,Fu=(o(zu,Mu=Pu),zu.prototype.matches=function(t){var e=ci.P(t.key,this.key);return this.wn(e)},zu),qu=(o(Bu,Uu=Pu),Bu.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Bu),ju=(o(Gu,Vu=Pu),Gu.prototype.matches=function(e){return!this.keys.some(function(t){return t.isEqual(e.key)})},Gu);function Gu(t,e){var n=this;return(n=Vu.call(this,t,"not-in",e)||this).keys=Hu(0,e),n}function Bu(t,e){var n=this;return(n=Uu.call(this,t,"in",e)||this).keys=Hu(0,e),n}function zu(t,e,n){var r=this;return(r=Mu.call(this,t,e,n)||this).key=ci.U(n.referenceValue),r}function Hu(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return ci.U(t.referenceValue)})}var Wu,Ku,Yu,Xu,Qu=(o(ia,Xu=Pu),ia.prototype.matches=function(t){var e=t.field(this.field);return xo(e)&&To(e.arrayValue,this.value)},ia),Zu=(o(ra,Yu=Pu),ra.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&To(this.value.arrayValue,e)},ra),Ju=(o(na,Ku=Pu),na.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&!To(this.value.arrayValue,e)},na),$u=(o(ea,Wu=Pu),ea.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!xo(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return To(e.value.arrayValue,t)})},ea),ta=function(t,e){this.position=t,this.before=e};function ea(t,e){return Wu.call(this,t,"array-contains-any",e)||this}function na(t,e){return Ku.call(this,t,"not-in",e)||this}function ra(t,e){return Yu.call(this,t,"in",e)||this}function ia(t,e){return Xu.call(this,t,"array-contains",e)||this}function oa(t){return(t.before?"b":"a")+":"+t.position.map(Ao).join(",")}function sa(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.M()?ci.P(ci.U(s.referenceValue),n.key):_o(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function ua(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Io(t.position[n],e.position[n]))return!1;return!0}var aa=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function ca(t,e,n){var r,i,o,s,u=t.field.M()?ci.P(e.key,n.key):(r=t.field,i=n,o=e.field(r),s=i.field(r),null!==o&&null!==s?_o(o,s):Ur());switch(t.dir){case"asc":return u;case"desc":return-1*u;default:return Ur()}}var ha=(Aa.prototype.En=function(t,e,n){for(var r=n.In,i=0;i<this.mutations.length;i++){var o=this.mutations[i];o.key.isEqual(t)&&(e=Cs(o,e,r[i]))}return e},Aa.prototype.mn=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=Vs(i,e,e,this.Tn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=Vs(a,e,o,this.Tn))}return e},Aa.prototype.An=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.mn(t.key,n.get(t.key));e&&(i=i.st(t.key,e))}),i},Aa.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Qi())},Aa.prototype.isEqual=function(t){return this.batchId===t.batchId&&Br(this.mutations,t.mutations,Us)&&Br(this.baseMutations,t.baseMutations,Us)},Aa),fa=(Na.from=function(t,e,n){Mr(t.mutations.length===n.length);for(var r=Yi,i=t.mutations,o=0;o<i.length;o++)r=r.st(i[o].key,n[o].version);return new Na(t,e,n,r)},Na),la=(_a.prototype.catch=function(t){return this.next(void 0,t)},_a.prototype.next=function(r,i){var o=this;return this.pn&&Ur(),this.pn=!0,this.yn?this.error?this.bn(i,this.error):this.vn(r,this.result):new _a(function(e,n){o.gn=function(t){o.vn(r,t).next(e,n)},o.Vn=function(t){o.bn(i,t).next(e,n)}})},_a.prototype.Sn=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},_a.prototype.Dn=function(t){try{var e=t();return e instanceof _a?e:_a.resolve(e)}catch(t){return _a.reject(t)}},_a.prototype.vn=function(t,e){return t?this.Dn(function(){return t(e)}):_a.resolve(e)},_a.prototype.bn=function(t,e){return t?this.Dn(function(){return t(e)}):_a.reject(e)},_a.resolve=function(n){return new _a(function(t,e){t(n)})},_a.reject=function(n){return new _a(function(t,e){e(n)})},_a.Cn=function(t){return new _a(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},_a.Nn=function(t){for(var n=_a.resolve(!1),e=function(e){n=n.next(function(t){return t?_a.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},_a.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.Cn(i)},_a),pa=(Object.defineProperty(Ta.prototype,"readTime",{get:function(){return this.$n},set:function(t){this.$n=t},enumerable:!1,configurable:!0}),Ta.prototype.xn=function(t,e){this.On(),this.readTime=e,this.Fn.set(t.key,t)},Ta.prototype.Mn=function(t,e){this.On(),e&&(this.readTime=e),this.Fn.set(t,null)},Ta.prototype.Ln=function(t,e){this.On();var n=this.Fn.get(e);return void 0!==n?la.resolve(n):this.qn(t,e)},Ta.prototype.getEntries=function(t,e){return this.Bn(t,e)},Ta.prototype.apply=function(t){return this.On(),this.kn=!0,this.Un(t)},Ta.prototype.On=function(){},Ta),da="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ya=(Ia.prototype.Wn=function(t){this.Qn.push(t)},Ia.prototype.jn=function(){this.Qn.forEach(function(t){return t()})},Ia),va=(Ea.prototype.Hn=function(e,n){var r=this;return this.Gn.Yn(e,n).next(function(t){return r.Jn(e,n,t)})},Ea.prototype.Jn=function(t,r,i){return this.Kn.Ln(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].mn(r,t);return t})},Ea.prototype.Xn=function(t,e,i){var o=zi;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].mn(t,e);o=o.st(t,e)}),o},Ea.prototype.Zn=function(e,t){var n=this;return this.Kn.getEntries(e,t).next(function(t){return n.ts(e,t)})},Ea.prototype.ts=function(r,i){var o=this;return this.Gn.es(r,i).next(function(t){var e=o.Xn(r,i,t),n=zi;return e.forEach(function(t,e){e=e||new lu(t,ii.min()),n=n.st(t,e)}),n})},Ea.prototype.ns=function(t,e,n){return r=e,ci.j(r.path)&&null===r.collectionGroup&&0===r.filters.length?this.ss(t,e.path):Iu(e)?this.rs(t,e,n):this.os(t,e,n);var r},Ea.prototype.ss=function(t,e){return this.Hn(t,new ci(e)).next(function(t){var e=Ki;return t instanceof fu&&(e=e.st(t.key,t)),e})},Ea.prototype.rs=function(n,r,i){var o=this,s=r.collectionGroup,u=Ki;return this.zn.hs(n,s).next(function(t){return la.forEach(t,function(t){var e=r.on(t.child(s));return o.os(n,e,i).next(function(t){t.forEach(function(t,e){u=u.st(t,e)})})}).next(function(){return u})})},Ea.prototype.os=function(e,n,t){var h,f,r=this;return this.Kn.ns(e,n,t).next(function(t){return h=t,r.Gn.as(e,n)}).next(function(t){return f=t,r.us(e,f,h).next(function(t){h=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=h.get(u),c=Vs(s,a,a,r.Tn);h=c instanceof fu?h.st(u,c):h.remove(u)}})}).next(function(){return h.forEach(function(t,e){Lu(n,e)||(h=h.remove(t))}),h})},Ea.prototype.us=function(t,e,n){for(var r=Qi(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Gs&&null===n.get(a.key)&&(r=r.add(a.key))}var c=n;return this.Kn.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof fu&&(c=c.st(t,e))}),c})},Ea),ga=(ba._s=function(t,e){for(var n=Qi(),r=Qi(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new ba(t,e.fromCache,n,r)},ba),ma=(wa.prototype.ds=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},wa.prototype.next=function(){var t=++this.previousValue;return this.ws&&this.ws(t),t},wa);function wa(t,e){var n=this;this.previousValue=t,e&&(e.fs=function(t){return n.ds(t)},this.ws=function(t){return e.Ts(t)})}function ba(t,e,n,r){this.targetId=t,this.fromCache=e,this.cs=n,this.ls=r}function Ea(t,e,n){this.Kn=t,this.Gn=e,this.zn=n}function Ia(){this.Qn=[]}function Ta(){this.Fn=new ti(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.kn=!1}function _a(t){var e=this;this.gn=null,this.Vn=null,this.result=void 0,this.error=void 0,this.yn=!1,this.pn=!1,t(function(t){e.yn=!0,e.result=t,e.gn&&e.gn(t)},function(t){e.yn=!0,e.error=t,e.Vn&&e.Vn(t)})}function Na(t,e,n,r){this.batch=t,this.Rn=e,this.In=n,this.Pn=r}function Aa(t,e,n,r){this.batchId=t,this.Tn=e,this.baseMutations=n,this.mutations=r}ma.Es=-1;function Sa(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}var Da,ka=(Va.prototype.reset=function(){this.gs=0},Va.prototype.ps=function(){this.gs=this.Ps},Va.prototype.bs=function(t){var e=this;this.cancel();var n=Math.floor(this.gs+this.vs()),r=Math.max(0,Date.now()-this.ys),i=Math.max(0,n-r);0<i&&Or("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.gs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Vs=this.Is.Ss(this.ms,i,function(){return e.ys=Date.now(),t()}),this.gs*=this.Rs,this.gs<this.As&&(this.gs=this.As),this.gs>this.Ps&&(this.gs=this.Ps)},Va.prototype.Ds=function(){null!==this.Vs&&(this.Vs.Cs(),this.Vs=null)},Va.prototype.cancel=function(){null!==this.Vs&&(this.Vs.cancel(),this.Vs=null)},Va.prototype.vs=function(){return(Math.random()-.5)*this.gs},Va),Ra=(Ca.delete=function(t){return Or("SimpleDb","Removing database:",t),Ga(window.indexedDB.deleteDatabase(t)).Sn()},Ca.ks=function(){if("undefined"==typeof indexedDB)return!1;if(Ca.$s())return!0;var t=y(),e=Ca.Fs(t),n=0<e&&e<10,r=Ca.xs(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Ca.$s=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Os)},Ca.Ms=function(t,e){return t.store(e)},Ca.Fs=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Ca.xs=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Ca.prototype.Ls=function(){return g(this,void 0,void 0,function(){var e,o=this;return w(this,function(t){switch(t.label){case 0:return this.db?[3,2]:(Or("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(n,r){var i=indexedDB.open(o.name,o.version);i.onsuccess=function(t){var e=t.target.result;n(e)},i.onblocked=function(){r(new xa("Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new ni(ei.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(new xa(e))},i.onupgradeneeded=function(t){Or("SimpleDb",'Database "'+o.name+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;o.Ns.createOrUpgrade(e,i.transaction,t.oldVersion,o.version).next(function(){Or("SimpleDb","Database upgrade to version "+o.version+" complete")})}})]);case 1:e.db=t.sent(),t.label=2;case 2:return[2,(this.qs&&(this.db.onversionchange=function(t){return o.qs(t)}),this.db)]}})})},Ca.prototype.Bs=function(e){this.qs=e,this.db&&(this.db.onversionchange=function(t){return e(t)})},Ca.prototype.runTransaction=function(r,c,h){return g(this,void 0,void 0,function(){var s,u,e,a,n;return w(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return w(this,function(t){switch(t.label){case 0:++u,t.label=1;case 1:return t.trys.push([1,4,,5]),[4,a.Ls()];case 2:return a.db=t.sent(),e=Ma.open(a.db,s?"readonly":"readwrite",c),n=h(e).catch(function(t){return e.abort(t),la.reject(t)}).Sn(),r={},n.catch(function(){}),[4,e.Us];case 3:return[2,(r.value=(t.sent(),n),r)];case 4:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,Or("SimpleDb","Transaction failed with error: %s. Retrying: %s.",i.message,o),a.close(),o?[3,5]:[2,{value:Promise.reject(i)}];case 5:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},Ca.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},Ca),La=(Object.defineProperty(Pa.prototype,"yn",{get:function(){return this.Ws},enumerable:!1,configurable:!0}),Object.defineProperty(Pa.prototype,"Ks",{get:function(){return this.js},enumerable:!1,configurable:!0}),Object.defineProperty(Pa.prototype,"cursor",{set:function(t){this.Qs=t},enumerable:!1,configurable:!0}),Pa.prototype.done=function(){this.Ws=!0},Pa.prototype.Gs=function(t){this.js=t},Pa.prototype.delete=function(){return Ga(this.Qs.delete())},Pa),xa=(o(Oa,Da=ni),Oa);function Oa(t){var e=this;return(e=Da.call(this,ei.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function Pa(t){this.Qs=t,this.Ws=!1,this.js=null}function Ca(t,e,n){this.name=t,this.version=e,this.Ns=n,12.2===Ca.Fs(y())&&Pr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Va(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Is=t,this.ms=e,this.As=n,this.Rs=r,this.Ps=i,this.gs=0,this.Vs=null,this.ys=Date.now(),this.reset()}function Ua(t){return"IndexedDbTransactionError"===t.name}var Ma=(ja.open=function(t,e,n){try{return new ja(t.transaction(n,e))}catch(t){throw new xa(t)}},Object.defineProperty(ja.prototype,"Us",{get:function(){return this.zs.promise},enumerable:!1,configurable:!0}),ja.prototype.abort=function(t){t&&this.zs.reject(t),this.aborted||(Or("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},ja.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Fa(e)},ja),Fa=(qa.prototype.put=function(t,e){var n=void 0!==e?(Or("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Or("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t));return Ga(n)},qa.prototype.add=function(t){return Or("SimpleDb","ADD",this.store.name,t,t),Ga(this.store.add(t))},qa.prototype.get=function(e){var n=this;return Ga(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Or("SimpleDb","GET",n.store.name,e,t),t})},qa.prototype.delete=function(t){return Or("SimpleDb","DELETE",this.store.name,t),Ga(this.store.delete(t))},qa.prototype.count=function(){return Or("SimpleDb","COUNT",this.store.name),Ga(this.store.count())},qa.prototype.Hs=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Ys(n,function(t,e){r.push(e)}).next(function(){return r})},qa.prototype.Js=function(t,e){Or("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Xs=!1;var r=this.cursor(n);return this.Ys(r,function(t,e,n){return n.delete()})},qa.prototype.Zs=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Ys(r,e)},qa.prototype.ti=function(i){var t=this.cursor({});return new la(function(n,r){t.onerror=function(t){var e=za(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},qa.prototype.Ys=function(t,s){var u=[];return new la(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n,r,i=t.target.result;i?(e=new La(i),(n=s(i.primaryKey,i.value,e))instanceof la&&(r=n.catch(function(t){return e.done(),la.reject(t)}),u.push(r)),e.yn?o():null===e.Ks?i.continue():i.continue(e.Ks)):o()}}).next(function(){return la.Cn(u)})},qa.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},qa.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Xs?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},qa);function qa(t){this.store=t}function ja(t){var n=this;this.transaction=t,this.aborted=!1,this.zs=new Sa,this.transaction.oncomplete=function(){n.zs.resolve()},this.transaction.onabort=function(){t.error?n.zs.reject(new xa(t.error)):n.zs.resolve()},this.transaction.onerror=function(t){var e=za(t.target.error);n.zs.reject(new xa(e))}}function Ga(t){return new la(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=za(t.target.error);r(e)}})}var Ba=!1;function za(t){var e=Ra.Fs(y());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new ni("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ba||(Ba=!0,setTimeout(function(){throw r},0)),r}}return t}function Ha(){return"undefined"!=typeof window?window:null}function Wa(){return"undefined"!=typeof document?document:null}var Ka=(Qa.ri=function(t,e,n,r,i){var o=new Qa(t,e,Date.now()+n,r,i);return o.start(n),o},Qa.prototype.start=function(t){var e=this;this.oi=setTimeout(function(){return e.hi()},t)},Qa.prototype.Cs=function(){return this.hi()},Qa.prototype.cancel=function(t){null!==this.oi&&(this.clearTimeout(),this.ii.reject(new ni(ei.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Qa.prototype.hi=function(){var e=this;this.ei.ai(function(){return null!==e.oi?(e.clearTimeout(),e.op().then(function(t){return e.ii.resolve(t)})):Promise.resolve()})},Qa.prototype.clearTimeout=function(){null!==this.oi&&(this.si(this),clearTimeout(this.oi),this.oi=null)},Qa),Ya=(Object.defineProperty(Xa.prototype,"Ii",{get:function(){return this.li},enumerable:!1,configurable:!0}),Xa.prototype.ai=function(t){this.enqueue(t)},Xa.prototype.mi=function(t){this.Ai(),this.Ri(t)},Xa.prototype.Pi=function(){var t;this.li||(this.li=!0,(t=Wa())&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ei))},Xa.prototype.enqueue=function(t){return this.Ai(),this.li?new Promise(function(t){}):this.Ri(t)},Xa.prototype.gi=function(t){var e=this;this.ci.push(t),this.ai(function(){return e.Vi()})},Xa.prototype.Vi=function(){return g(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:if(0===this.ci.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.ci[0]()];case 2:return t.sent(),this.ci.shift(),this.Ti.reset(),[3,4];case 3:if(!Ua(e=t.sent()))throw e;return Or("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.ci.length&&this.Ti.bs(function(){return n.Vi()}),t.label=5;case 5:return[2]}})})},Xa.prototype.Ri=function(t){var r=this,e=this.ui.then(function(){return r.di=!0,t().catch(function(t){throw r.fi=t,r.di=!1,Pr("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.di=!1,t})});return this.ui=e},Xa.prototype.Ss=function(t,e,n){var r=this;this.Ai(),-1<this.wi.indexOf(t)&&(e=0);var i=Ka.ri(this,t,e,n,function(t){return r.yi(t)});return this._i.push(i),i},Xa.prototype.Ai=function(){this.fi&&Ur()},Xa.prototype.pi=function(){},Xa.prototype.bi=function(){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return[4,e=this.ui];case 1:t.sent(),t.label=2;case 2:if(e!==this.ui)return[3,0];t.label=3;case 3:return[2]}})})},Xa.prototype.vi=function(t){for(var e=0,n=this._i;e<n.length;e++)if(n[e].ms===t)return!0;return!1},Xa.prototype.Si=function(r){var i=this;return this.bi().then(function(){i._i.sort(function(t,e){return t.ni-e.ni});for(var t=0,e=i._i;t<e.length;t++){var n=e[t];if(n.Cs(),"all"!==r&&n.ms===r)break}return i.bi()})},Xa.prototype.Di=function(t){this.wi.push(t)},Xa.prototype.yi=function(t){var e=this._i.indexOf(t);this._i.splice(e,1)},Xa);function Xa(){var e=this;this.ui=Promise.resolve(),this.ci=[],this.li=!1,this._i=[],this.fi=null,this.di=!1,this.wi=[],this.Ti=new ka(this,"async_queue_retry"),this.Ei=function(){var t=Wa();t&&Or("AsyncQueue","Visibility state changed to  ",t.visibilityState),e.Ti.Ds()};var t=Wa();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Ei)}function Qa(t,e,n,r,i){this.ei=t,this.ms=e,this.ni=n,this.op=r,this.si=i,this.ii=new Sa,this.then=this.ii.promise.then.bind(this.ii.promise),this.ii.promise.catch(function(t){})}function Za(t,e){if(Pr("AsyncQueue",e+": "+t),Ua(t))return new ni(ei.UNAVAILABLE,e+": "+t);throw t}function Ja(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Gr(n,i);return 0===s?Gr(r,o):s}var $a=(rc.prototype.Fi=function(){return++this.Ni},rc.prototype.ki=function(t){var e,n=[t,this.Fi()];this.buffer.size<this.Ci?this.buffer=this.buffer.add(n):Ja(n,e=this.buffer.last())<0&&(this.buffer=this.buffer.delete(e).add(n))},Object.defineProperty(rc.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),rc),tc={$i:!1,xi:0,Oi:0,Mi:0},ec=(nc.Ui=function(t){return new nc(t,nc.Qi,nc.Wi)},nc);function nc(t,e,n){this.Li=t,this.qi=e,this.Bi=n}function rc(t){this.Ci=t,this.buffer=new Gi(Ja),this.Ni=0}ec.ji=-1,ec.Ki=1048576,ec.Gi=41943040,ec.Qi=10,ec.Wi=1e3,ec.zi=new ec(ec.Gi,ec.Qi,ec.Wi),ec.Hi=new ec(ec.ji,0,0);var ic=(uc.prototype.start=function(t){this.Yi.params.Li!==ec.ji&&this.Zi(t)},uc.prototype.stop=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},Object.defineProperty(uc.prototype,"tr",{get:function(){return null!==this.Xi},enumerable:!1,configurable:!0}),uc.prototype.Zi=function(n){var t=this,e=this.Ji?3e5:6e4;Or("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.Xi=this.ei.Ss("lru_garbage_collection",e,function(){return g(t,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:this.Xi=null,this.Ji=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.er(this.Yi)];case 2:return t.sent(),[3,7];case 3:return Ua(e=t.sent())?(Or("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Uh(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.Zi(n)];case 8:return t.sent(),[2]}})})})},uc),oc=(sc.prototype.sr=function(t,e){return this.nr.ir(t).next(function(t){return Math.floor(e/100*t)})},sc.prototype.rr=function(t,e){var n=this;if(0===e)return la.resolve(ma.Es);var r=new $a(e);return this.nr.be(t,function(t){return r.ki(t.sequenceNumber)}).next(function(){return n.nr.or(t,function(t){return r.ki(t)})}).next(function(){return r.maxValue})},sc.prototype.hr=function(t,e,n){return this.nr.hr(t,e,n)},sc.prototype.ar=function(t,e){return this.nr.ar(t,e)},sc.prototype.ur=function(e,n){var r=this;return this.params.Li===ec.ji?(Or("LruGarbageCollector","Garbage collection skipped; disabled"),la.resolve(tc)):this.cr(e).next(function(t){return t<r.params.Li?(Or("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.Li),tc):r.lr(e,n)})},sc.prototype.cr=function(t){return this.nr.cr(t)},sc.prototype.lr=function(e,n){var r,i,o,s,u,a,c,h=this,f=Date.now();return this.sr(e,this.params.qi).next(function(t){return i=t>h.params.Bi?(Or("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+h.params.Bi+" from "+t),h.params.Bi):t,s=Date.now(),h.rr(e,i)}).next(function(t){return r=t,u=Date.now(),h.hr(e,r,n)}).next(function(t){return o=t,a=Date.now(),h.ar(e,r)}).next(function(t){return c=Date.now(),xr()<=l.DEBUG&&Or("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-f)+"ms"),la.resolve({$i:!0,xi:i,Oi:o,Mi:t})})},sc);function sc(t,e){this.nr=t,this.params=e}function uc(t,e){this.Yi=t,this.ei=e,this.Ji=!1,this.Xi=null}function ac(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=hc(e)),e=cc(t.get(n),e);return hc(e)}function cc(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function hc(t){return t+""}function fc(t){var e=t.length;if(Mr(2<=e),2===e)return Mr(""===t.charAt(0)&&""===t.charAt(1)),si.$();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Ur(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Ur()}o=s+2}return new si(r)}function lc(t){this._r=t}function pc(t,e){if(e.document)return n=t._r,r=e.document,i=!!e.hasCommittedMutations,o=Yo(n,r.name),s=zo(r.updateTime),u=new tu({mapValue:{fields:r.fields}}),new fu(o,s,u,{hasCommittedMutations:!!i});var n,r,i,o,s,u;if(e.noDocument){var a=ci.K(e.noDocument.path),c=mc(e.noDocument.readTime);return new lu(a,c,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var h=ci.K(e.unknownDocument.path),f=mc(e.unknownDocument.version);return new pu(h,f)}return Ur()}function dc(t,e,n){var r,i,o=yc(n),s=e.key.path.p().N();if(e instanceof fu){var u={name:Ko(r=t._r,(i=e).key),fields:i.tn().mapValue.fields,updateTime:Go(r,i.version.A())},a=e.hasCommittedMutations;return new Zc(null,null,u,a,o,s)}if(e instanceof lu){var c=e.key.path.N(),h=gc(e.version),f=e.hasCommittedMutations;return new Zc(null,new Xc(c,h),null,f,o,s)}if(e instanceof pu){var l=e.key.path.N(),p=gc(e.version);return new Zc(new Qc(l,p),null,null,!0,o,s)}return Ur()}function yc(t){var e=t.A();return[e.seconds,e.nanoseconds]}function vc(t){var e=new ri(t[0],t[1]);return ii.I(e)}function gc(t){var e=t.A();return new qc(e.seconds,e.nanoseconds)}function mc(t){var e=new ri(t.seconds,t.nanoseconds);return ii.I(e)}function wc(e,t){var n=(t.baseMutations||[]).map(function(t){return es(e._r,t)}),r=t.mutations.map(function(t){return es(e._r,t)}),i=ri.fromMillis(t.localWriteTimeMs);return new ha(t.batchId,i,n,r)}function bc(t){var e,n=mc(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?mc(t.lastLimboFreeSnapshotVersion):ii.min(),i=void 0!==t.query.documents?(Mr(1===(e=t.query).documents.length),_u(Eu(Qo(e.documents[0])))):function(t){var e,n=Qo(t.parent),r=t.structuredQuery,i=r.from?r.from.length:0,o=null;0<i&&(Mr(1===i),(e=r.from[0]).allDescendants?o=e.collectionId:n=n.child(e.collectionId));var s=[];r.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=us(t.unaryFilter.field);return Pu.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=us(t.unaryFilter.field);return Pu.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=us(t.unaryFilter.field);return Pu.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=us(t.unaryFilter.field);return Pu.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Ur()}}(e)]:void 0!==e.fieldFilter?[(n=e,Pu.create(us(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Ur()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(t).reduce(function(t,e){return t.concat(e)}):Ur():[];var n}(r.where));var u=[];r.orderBy&&(u=r.orderBy.map(function(t){return new aa(us((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));var a,c,h=null;r.limit&&(a=r.limit,h=mi(c="object"==typeof a?a.value:a)?null:c);var f=null;r.startAt&&(f=os(r.startAt));var l=null;return r.endAt&&(l=os(r.endAt)),_u(bu(n,o,u,s,h,"F",f,l))}(t.query);return new Li(i,t.targetId,0,t.lastListenSequenceNumber,n,r,Ai.fromBase64String(t.resumeToken))}function Ec(t,e){var n=gc(e.Z),r=gc(e.lastLimboFreeSnapshotVersion),i=(Ni(e.target)?ns:rs)(t._r,e.target),o=e.resumeToken.toBase64();return new $c(e.targetId,Ti(e.target),n,o,e.sequenceNumber,r,i)}var Ic=(Tc.Tr=function(t,e,n,r){return Mr(""!==t.uid),new Tc(t.Er()?t.uid:"",e,n,r)},Tc.prototype.Ir=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ac(t).Zs({index:Wc.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Tc.prototype.mr=function(d,y,v,g){var m=this,w=Sc(d),b=Ac(d);return b.add({}).next(function(t){Mr("number"==typeof t);for(var e,n,r,i,o,s=new ha(t,y,v,g),u=(e=m.serializer,n=m.userId,i=(r=s).baseMutations.map(function(t){return ts(e._r,t)}),o=r.mutations.map(function(t){return ts(e._r,t)}),new Wc(n,r.batchId,r.Tn.toMillis(),i,o)),a=[],c=new Gi(function(t,e){return Gr(t.F(),e.F())}),h=0,f=g;h<f.length;h++){var l=f[h],p=Kc.key(m.userId,l.key.path,t),c=c.add(l.key.path.p());a.push(b.put(u)),a.push(w.put(p,Kc.PLACEHOLDER))}return c.forEach(function(t){a.push(m.zn.Ar(d,t))}),d.Wn(function(){m.wr[t]=s.keys()}),la.Cn(a).next(function(){return s})})},Tc.prototype.Rr=function(t,e){var n=this;return Ac(t).get(e).next(function(t){return t?(Mr(t.userId===n.userId),wc(n.serializer,t)):null})},Tc.prototype.Pr=function(t,n){var r=this;return this.wr[n]?la.resolve(this.wr[n]):this.Rr(t,n).next(function(t){if(t){var e=t.keys();return r.wr[n]=e}return null})},Tc.prototype.gr=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return Ac(t).Zs({index:Wc.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Mr(e.batchId>=i),o=wc(r.serializer,e)),n.done()}).next(function(){return o})},Tc.prototype.Vr=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return Ac(t).Zs({index:Wc.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},Tc.prototype.yr=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ac(t).Hs(Wc.userMutationsIndex,n).next(function(t){return t.map(function(t){return wc(e.serializer,t)})})},Tc.prototype.Yn=function(u,a){var c=this,t=Kc.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),h=[];return Sc(u).Zs({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=fc(i);if(r===c.userId&&a.path.isEqual(s))return Ac(u).get(o).next(function(t){if(!t)throw Ur();Mr(t.userId===c.userId),h.push(wc(c.serializer,t))});n.done()}).next(function(){return h})},Tc.prototype.es=function(r,t){var a=this,c=new Gi(Gr),i=[];return t.forEach(function(u){var t=Kc.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=Sc(r).Zs({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=fc(i);r===a.userId&&u.path.isEqual(s)?c=c.add(o):n.done()});i.push(n)}),la.Cn(i).next(function(){return a.pr(r,c)})},Tc.prototype.as=function(t,e){var u=this,a=e.path,c=a.length+1,n=Kc.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),h=new Gi(Gr);return Sc(t).Zs({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=fc(i);r===u.userId&&a.D(s)?s.length===c&&(h=h.add(o)):n.done()}).next(function(){return u.pr(t,h)})},Tc.prototype.pr=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push(Ac(e).get(t).next(function(t){if(null===t)throw Ur();Mr(t.userId===n.userId),r.push(wc(n.serializer,t))}))}),la.Cn(i).next(function(){return r})},Tc.prototype.br=function(e,n){var r=this;return Nc(e.vr,this.userId,n).next(function(t){return e.Wn(function(){r.Sr(n.batchId)}),la.forEach(t,function(t){return r.dr.Dr(e,t)})})},Tc.prototype.Sr=function(t){delete this.wr[t]},Tc.prototype.Cr=function(n){var o=this;return this.Ir(n).next(function(t){if(!t)return la.resolve();var e=IDBKeyRange.lowerBound(Kc.prefixForUser(o.userId)),i=[];return Sc(n).Zs({range:e},function(t,e,n){var r;t[0]===o.userId?(r=fc(t[1]),i.push(r)):n.done()}).next(function(){Mr(0===i.length)})})},Tc.prototype.Nr=function(t,e){return _c(t,this.userId,e)},Tc.prototype.Fr=function(t){var e=this;return Dc(t).get(this.userId).next(function(t){return t||new Hc(e.userId,-1,"")})},Tc);function Tc(t,e,n,r){this.userId=t,this.serializer=e,this.zn=n,this.dr=r,this.wr={}}function _c(t,o,e){var n=Kc.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return Sc(t).Zs({range:r,Xs:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function Nc(t,e,n){var r=t.store(Wc.store),i=t.store(Kc.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Zs({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){Mr(1===u)}));for(var c=[],h=0,f=n.mutations;h<f.length;h++){var l=f[h],p=Kc.key(e,l.key.path,n.batchId);o.push(i.delete(p)),c.push(l.key)}return la.Cn(o).next(function(){return c})}function Ac(t){return wh.Ms(t,Wc.store)}function Sc(t){return wh.Ms(t,Kc.store)}function Dc(t){return wh.Ms(t,Hc.store)}var kc,Rc=(Lc.prototype.xn=function(t,e,n){return Oc(t).put(Pc(e),n)},Lc.prototype.Mn=function(t,e){var n=Oc(t),r=Pc(e);return n.delete(r)},Lc.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.kr(e,t)})},Lc.prototype.Ln=function(t,e){var n=this;return Oc(t).get(Pc(e)).next(function(t){return n.$r(t)})},Lc.prototype.xr=function(t,e){var n=this;return Oc(t).get(Pc(e)).next(function(t){var e=n.$r(t);return e?{Or:e,size:Cc(t)}:null})},Lc.prototype.getEntries=function(t,e){var r=this,i=zi;return this.Mr(t,e,function(t,e){var n=r.$r(e);i=i.st(t,n)}).next(function(){return i})},Lc.prototype.Lr=function(t,e){var r=this,i=zi,o=new Ci(ci.P);return this.Mr(t,e,function(t,e){var n=r.$r(e);o=n?(i=i.st(t,n),o.st(t,Cc(e))):(i=i.st(t,null),o.st(t,0))}).next(function(){return{qr:i,Br:o}})},Lc.prototype.Mr=function(t,e,i){if(e._())return la.resolve();var n=IDBKeyRange.bound(e.first().path.N(),e.last().path.N()),o=e.ut(),s=o.wt();return Oc(t).Zs({range:n},function(t,e,n){for(var r=ci.K(t);s&&ci.P(s,r)<0;)i(s,null),s=o.wt();s&&s.isEqual(r)&&(i(s,e),s=o.Tt()?o.wt():null),s?n.Gs(s.path.N()):n.done()}).next(function(){for(;s;)i(s,null),s=o.Tt()?o.wt():null})},Lc.prototype.ns=function(t,i,e){var n,r,o,s=this,u=Ki,a=i.path.length+1,c={};return e.isEqual(ii.min())?(n=i.path.N(),c.range=IDBKeyRange.lowerBound(n)):(r=i.path.N(),o=yc(e),c.range=IDBKeyRange.lowerBound([r,o],!0),c.index=Zc.collectionReadTimeIndex),Oc(t).Zs(c,function(t,e,n){var r;t.length===a&&(r=pc(s.serializer,e),i.path.D(r.key.path)?r instanceof fu&&Lu(i,r)&&(u=u.st(r.key,r)):n.done())}).next(function(){return u})},Lc.prototype.Ur=function(t,e){var r=this,i=zi,o=yc(e),n=Oc(t),s=IDBKeyRange.lowerBound(o,!0);return n.Zs({index:Zc.readTimeIndex,range:s},function(t,e){var n=pc(r.serializer,e);i=i.st(n.key,n),o=e.readTime}).next(function(){return{Qr:i,readTime:vc(o)}})},Lc.prototype.Wr=function(t){var e=Oc(t),r=ii.min();return e.Zs({index:Zc.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=vc(e.readTime)),n.done()}).next(function(){return r})},Lc.prototype.jr=function(t){return new Lc.Kr(this,!!t&&t.Gr)},Lc.prototype.zr=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Lc.prototype.getMetadata=function(t){return xc(t).get(Jc.key).next(function(t){return Mr(!!t),t})},Lc.prototype.kr=function(t,e){return xc(t).put(Jc.key,e)},Lc.prototype.$r=function(t){if(t){var e=pc(this.serializer,t);return e instanceof lu&&e.version.isEqual(ii.min())?null:e}return null},Lc);function Lc(t,e){this.serializer=t,this.zn=e}function xc(t){return wh.Ms(t,Jc.store)}function Oc(t){return wh.Ms(t,Zc.store)}function Pc(t){return t.path.N()}function Cc(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Ur();e=t.noDocument}return JSON.stringify(e).length}function Vc(t,e){var n=this;return(n=kc.call(this)||this).Hr=t,n.Gr=e,n.Yr=new ti(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}Rc.Kr=(o(Vc,kc=pa),Vc.prototype.Un=function(s){var u=this,a=[],c=0,h=new Gi(function(t,e){return Gr(t.F(),e.F())});return this.Fn.forEach(function(t,e){var n,r,i,o=u.Yr.get(t);e?(n=dc(u.Hr.serializer,e,u.readTime),h=h.add(t.path.p()),r=Cc(n),c+=r-o,a.push(u.Hr.xn(s,t,n))):(c-=o,u.Gr?(i=dc(u.Hr.serializer,new lu(t,ii.min()),u.readTime),a.push(u.Hr.xn(s,t,i))):a.push(u.Hr.Mn(s,t)))}),h.forEach(function(t){a.push(u.Hr.zn.Ar(s,t))}),a.push(this.Hr.updateMetadata(s,c)),la.Cn(a)},Vc.prototype.qn=function(t,e){var n=this;return this.Hr.xr(t,e).next(function(t){return null===t?(n.Yr.set(e,0),null):(n.Yr.set(e,t.size),t.Or)})},Vc.prototype.Bn=function(t,e){var n=this;return this.Hr.Lr(t,e).next(function(t){var e=t.qr;return t.Br.forEach(function(t,e){n.Yr.set(t,e)}),e})},Vc);var Uc=(zc.prototype.Ar=function(t,e){return this.Jr.add(e),la.resolve()},zc.prototype.hs=function(t,e){return la.resolve(this.Jr.getEntries(e))},zc),Mc=(Bc.prototype.add=function(t){var e=t.S(),n=t.p(),r=this.index[e]||new Gi(si.P),i=!r.has(n);return this.index[e]=r.add(n),i},Bc.prototype.has=function(t){var e=t.S(),n=t.p(),r=this.index[e];return r&&r.has(n)},Bc.prototype.getEntries=function(t){return(this.index[t]||new Gi(si.P)).N()},Bc),Fc=(Gc.prototype.createOrUpgrade=function(n,r,t,e){var i=this;Mr(t<e&&0<=t&&e<=10);var o,s=new Ma(r);t<1&&1<=e&&(n.createObjectStore(jc.store),(o=n).createObjectStore(Hc.store,{keyPath:Hc.keyPath}),o.createObjectStore(Wc.store,{keyPath:Wc.keyPath,autoIncrement:!0}).createIndex(Wc.userMutationsIndex,Wc.userMutationsKeyPath,{unique:!0}),o.createObjectStore(Kc.store),rh(n),n.createObjectStore(Zc.store));var u,a=la.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(th.store),u.deleteObjectStore($c.store),u.deleteObjectStore(eh.store),rh(n)),a=a.next(function(){return t=s.store(eh.store),e=new eh(0,0,ii.min().A(),0),t.put(eh.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(Wc.store).Hs().next(function(t){r.deleteObjectStore(Wc.store),r.createObjectStore(Wc.store,{keyPath:Wc.keyPath,autoIncrement:!0}).createIndex(Wc.userMutationsIndex,Wc.userMutationsKeyPath,{unique:!0});var e=i.store(Wc.store),n=t.map(function(t){return e.put(t)});return la.Cn(n)});var r,i})),a=a.next(function(){n.createObjectStore(ih.store,{keyPath:ih.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(Jc.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(Zc.store)).createIndex(Zc.readTimeIndex,Zc.readTimeIndexPath,{unique:!1}),t.createIndex(Zc.collectionReadTimeIndex,Zc.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},Gc.prototype.addDocumentGlobal=function(e){var n=0;return e.store(Zc.store).Zs(function(t,e){n+=Cc(e)}).next(function(){var t=new Jc(n);return e.store(Jc.store).put(Jc.key,t)})},Gc.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(Hc.store),e=r.store(Wc.store);return t.Hs().next(function(t){return la.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.Hs(Wc.userMutationsIndex,t).next(function(t){return la.forEach(t,function(t){Mr(t.userId===n.userId);var e=wc(i.serializer,t);return Nc(r,n.userId,e).next(function(){})})})})})},Gc.prototype.ensureSequenceNumbers=function(t){var s=t.store(th.store),e=t.store(Zc.store);return t.store(eh.store).get(eh.key).next(function(i){var o=[];return e.Zs(function(t,e){var n=new si(t),r=[0,ac(n)];o.push(s.get(r).next(function(t){return t?la.resolve():s.put(new th(0,ac(n),i.highestListenSequenceNumber))}))}).next(function(){return la.Cn(o)})})},Gc.prototype.createCollectionParentIndex=function(t,e){function i(t){if(o.add(t)){var e=t.S(),n=t.p();return r.put({collectionId:e,parent:ac(n)})}}t.createObjectStore(nh.store,{keyPath:nh.keyPath});var r=e.store(nh.store),o=new Mc;return e.store(Zc.store).Zs({Xs:!0},function(t,e){var n=new si(t);return i(n.p())}).next(function(){return e.store(Kc.store).Zs({Xs:!0},function(t,e){t[0];var n=t[1],r=(t[2],fc(n));return i(r.p())})})},Gc.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store($c.store);return o.Zs(function(t,e){var n=bc(e),r=Ec(i.serializer,n);return o.put(r)})},Gc),qc=function(t,e){this.seconds=t,this.nanoseconds=e},jc=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function Gc(t){this.serializer=t}function Bc(){this.index={}}function zc(){this.Jr=new Mc}jc.store="owner",jc.key="owner";var Hc=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Hc.store="mutationQueues",Hc.keyPath="userId";var Wc=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};Wc.store="mutations",Wc.keyPath="batchId",Wc.userMutationsIndex="userMutationsIndex",Wc.userMutationsKeyPath=["userId","batchId"];var Kc=(Yc.prefixForUser=function(t){return[t]},Yc.prefixForPath=function(t,e){return[t,ac(e)]},Yc.key=function(t,e,n){return[t,ac(e),n]},Yc);function Yc(){}Kc.store="documentMutations",Kc.PLACEHOLDER=new Kc;var Xc=function(t,e){this.path=t,this.readTime=e},Qc=function(t,e){this.path=t,this.version=e},Zc=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Zc.store="remoteDocuments",Zc.readTimeIndex="readTimeIndex",Zc.readTimeIndexPath="readTime",Zc.collectionReadTimeIndex="collectionReadTimeIndex",Zc.collectionReadTimeIndexPath=["parentPath","readTime"];var Jc=function(t){this.byteSize=t};Jc.store="remoteDocumentGlobal",Jc.key="remoteDocumentGlobalKey";var $c=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};$c.store="targets",$c.keyPath="targetId",$c.queryTargetsIndexName="queryTargetsIndex",$c.queryTargetsKeyPath=["canonicalId","targetId"];var th=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};th.store="targetDocuments",th.keyPath=["targetId","path"],th.documentTargetsIndex="documentTargetsIndex",th.documentTargetsKeyPath=["path","targetId"];var eh=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};eh.key="targetGlobalKey",eh.store="targetGlobal";var nh=function(t,e){this.collectionId=t,this.parent=e};function rh(t){t.createObjectStore(th.store,{keyPath:th.keyPath}).createIndex(th.documentTargetsIndex,th.documentTargetsKeyPath,{unique:!0}),t.createObjectStore($c.store,{keyPath:$c.keyPath}).createIndex($c.queryTargetsIndexName,$c.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(eh.store)}nh.store="collectionParents",nh.keyPath=["collectionId","parent"];var ih=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};ih.store="clientMetadata",ih.keyPath="clientId";var oh=s(s(s([Hc.store,Wc.store,Kc.store,Zc.store,$c.store,jc.store,eh.store,th.store],[ih.store]),[Jc.store]),[nh.store]),sh=(uh.prototype.Ar=function(t,e){var n=this;if(this.Xr.has(e))return la.resolve();var r=e.S(),i=e.p();t.Wn(function(){n.Xr.add(e)});var o={collectionId:r,parent:ac(i)};return ah(t).put(o)},uh.prototype.hs=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[zr(i),""],!1,!0);return ah(t).Hs(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(fc(r.parent))}return o})},uh);function uh(){this.Xr=new Mc}function ah(t){return wh.Ms(t,nh.store)}var ch=(lh.prototype.next=function(){return this.Zr+=2,this.Zr},lh.to=function(){return new lh(0)},lh.eo=function(){return new lh(-1)},lh),hh=(fh.prototype.no=function(n){var r=this;return this.so(n).next(function(t){var e=new ch(t.highestTargetId);return t.highestTargetId=e.next(),r.io(n,t).next(function(){return t.highestTargetId})})},fh.prototype.ro=function(t){return this.so(t).next(function(t){return ii.I(new ri(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},fh.prototype.oo=function(t){return this.so(t).next(function(t){return t.highestListenSequenceNumber})},fh.prototype.ho=function(e,n,r){var i=this;return this.so(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.A()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.io(e,t)})},fh.prototype.ao=function(e,n){var r=this;return this.uo(e,n).next(function(){return r.so(e).next(function(t){return t.targetCount+=1,r.co(n,t),r.io(e,t)})})},fh.prototype.lo=function(t,e){return this.uo(t,e)},fh.prototype._o=function(e,t){var n=this;return this.fo(e,t.targetId).next(function(){return ph(e).delete(t.targetId)}).next(function(){return n.so(e)}).next(function(t){return Mr(0<t.targetCount),--t.targetCount,n.io(e,t)})},fh.prototype.hr=function(r,i,o){var s=this,u=0,a=[];return ph(r).Zs(function(t,e){var n=bc(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s._o(r,n)))}).next(function(){return la.Cn(a)}).next(function(){return u})},fh.prototype.be=function(t,r){return ph(t).Zs(function(t,e){var n=bc(e);r(n)})},fh.prototype.so=function(t){return dh(t).get(eh.key).next(function(t){return Mr(null!==t),t})},fh.prototype.io=function(t,e){return dh(t).put(eh.key,e)},fh.prototype.uo=function(t,e){return ph(t).put(Ec(this.serializer,e))},fh.prototype.co=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},fh.prototype.do=function(t){return this.so(t).next(function(t){return t.targetCount})},fh.prototype.wo=function(t,i){var e=Ti(i),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),o=null;return ph(t).Zs({range:n,index:$c.queryTargetsIndexName},function(t,e,n){var r=bc(e);_i(i,r.target)&&(o=r,n.done())}).next(function(){return o})},fh.prototype.To=function(n,t,r){var i=this,o=[],s=yh(n);return t.forEach(function(t){var e=ac(t.path);o.push(s.put(new th(r,e))),o.push(i.dr.Eo(n,r,t))}),la.Cn(o)},fh.prototype.Io=function(n,t,r){var i=this,o=yh(n);return la.forEach(t,function(t){var e=ac(t.path);return la.Cn([o.delete([r,e]),i.dr.mo(n,r,t)])})},fh.prototype.fo=function(t,e){var n=yh(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},fh.prototype.Ao=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=yh(t),o=Qi();return r.Zs({range:n,Xs:!0},function(t,e,n){var r=fc(t[1]),i=new ci(r);o=o.add(i)}).next(function(){return o})},fh.prototype.Nr=function(t,e){var n=ac(e.path),r=IDBKeyRange.bound([n],[zr(n)],!1,!0),i=0;return yh(t).Zs({index:th.documentTargetsIndex,Xs:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},fh.prototype.Me=function(t,e){return ph(t).get(e).next(function(t){return t?bc(t):null})},fh);function fh(t,e){this.dr=t,this.serializer=e}function lh(t){this.Zr=t}function ph(t){return wh.Ms(t,$c.store)}function dh(t){return wh.Ms(t,eh.store)}function yh(t){return wh.Ms(t,th.store)}var vh,gh="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",mh=(o(Eh,vh=ya),Eh),wh=(bh.Ms=function(t,e){if(t instanceof mh)return Ra.Ms(t.vr,e);throw Ur()},bh.prototype.start=function(){var e=this;return this.xo().then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new ni(ei.FAILED_PRECONDITION,gh);return e.Oo(),e.Mo(),e.Lo(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.ko.oo(t)})}).then(function(t){e.yo=new ma(t,e.Po)}).then(function(){e.po=!0}).catch(function(t){return e.Fo&&e.Fo.close(),Promise.reject(t)})},bh.prototype.qo=function(n){var t=this;return this.Co=function(e){return g(t,void 0,void 0,function(){return w(this,function(t){return this.tr?[2,n(e)]:[2]})})},n(this.isPrimary)},bh.prototype.Bo=function(n){var t=this;this.Fo.Bs(function(e){return g(t,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},bh.prototype.Uo=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Is.ai(function(){return g(e,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.tr?[4,this.xo()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},bh.prototype.xo=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Th(e).put(new ih(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n.Qo(e).next(function(t){t||(n.isPrimary=!1,n.Is.gi(function(){return n.Co(!1)}))})}).next(function(){return n.Wo(e)}).next(function(t){return n.isPrimary&&!t?n.jo(e).next(function(){return!1}):!!t&&n.Ko(e).next(function(){return!0})})}).catch(function(t){if(Ua(t))return Or("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Or("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.Is.gi(function(){return n.Co(t)}),n.isPrimary=t})},bh.prototype.Qo=function(t){var e=this;return Ih(t).get(jc.key).next(function(t){return la.resolve(e.Go(t))})},bh.prototype.zo=function(t){return Th(t).delete(this.clientId)},bh.prototype.Ho=function(){return g(this,void 0,void 0,function(){var e,n,r,i,o=this;return w(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.Yo(this.Do,18e5)?[3,2]:(this.Do=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=bh.Ms(t,ih.store);return r.Hs().next(function(t){var e=o.Jo(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return la.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.$o)for(n=0,r=e;n<r.length;n++)i=r[n],this.$o.removeItem(this.Xo(i.clientId));t.label=2;case 2:return[2]}})})},bh.prototype.Lo=function(){var t=this;this.So=this.Is.Ss("client_metadata_refresh",4e3,function(){return t.xo().then(function(){return t.Ho()}).then(function(){return t.Lo()})})},bh.prototype.Go=function(t){return!!t&&t.ownerId===this.clientId},bh.prototype.Wo=function(e){var i=this;return this.Vo?la.resolve(!0):Ih(e).get(jc.key).next(function(t){if(null!==t&&i.Yo(t.leaseTimestampMs,5e3)&&!i.Zo(t.ownerId)){if(i.Go(t)&&i.networkEnabled)return!0;if(!i.Go(t)){if(!t.allowTabSynchronization)throw new ni(ei.FAILED_PRECONDITION,gh);return!1}}return!(!i.networkEnabled||!i.inForeground)||Th(e).Hs().next(function(t){return void 0===i.Jo(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Or("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},bh.prototype.th=function(){return g(this,void 0,void 0,function(){var n=this;return w(this,function(t){switch(t.label){case 0:return this.po=!1,this.eh(),this.So&&(this.So.cancel(),this.So=null),this.nh(),this.sh(),[4,this.Fo.runTransaction("readwrite",[jc.store,ih.store],function(t){var e=new mh(t,ma.Es);return n.jo(e).next(function(){return n.zo(e)})})];case 1:return t.sent(),this.Fo.close(),this.ih(),[2]}})})},bh.prototype.Jo=function(t,e){var n=this;return t.filter(function(t){return n.Yo(t.updateTimeMs,e)&&!n.Zo(t.clientId)})},bh.prototype.rh=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return Th(t).Hs().next(function(t){return e.Jo(t,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(bh.prototype,"tr",{get:function(){return this.po},enumerable:!1,configurable:!0}),bh.prototype.oh=function(t){return Ic.Tr(t,this.serializer,this.zn,this.dr)},bh.prototype.hh=function(){return this.ko},bh.prototype.ah=function(){return this.Kn},bh.prototype.uh=function(){return this.zn},bh.prototype.runTransaction=function(e,n,r){var i=this;Or("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.Fo.runTransaction(t,oh,function(t){return o=new mh(t,i.yo?i.yo.next():ma.Es),"readwrite-primary"===n?i.Qo(o).next(function(t){return!!t||i.Wo(o)}).next(function(t){if(!t)throw Pr("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.Is.gi(function(){return i.Co(!1)}),new ni(ei.FAILED_PRECONDITION,da);return r(o)}).next(function(t){return i.Ko(o).next(function(){return t})}):i.lh(o).next(function(){return r(o)})}).then(function(t){return o.jn(),t})},bh.prototype.lh=function(t){var e=this;return Ih(t).get(jc.key).next(function(t){if(null!==t&&e.Yo(t.leaseTimestampMs,5e3)&&!e.Zo(t.ownerId)&&!e.Go(t)&&!(e.Vo||e.allowTabSynchronization&&t.allowTabSynchronization))throw new ni(ei.FAILED_PRECONDITION,gh)})},bh.prototype.Ko=function(t){var e=new jc(this.clientId,this.allowTabSynchronization,Date.now());return Ih(t).put(jc.key,e)},bh.ks=function(){return Ra.ks()},bh.prototype.jo=function(t){var e=this,n=Ih(t);return n.get(jc.key).next(function(t){return e.Go(t)?(Or("IndexedDbPersistence","Releasing primary lease."),n.delete(jc.key)):la.resolve()})},bh.prototype.Yo=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Pr("Detected an update time that is in the future: "+t+" > "+n),1))},bh.prototype.Oo=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.vo=function(){t.Is.ai(function(){return t.inForeground="visible"===t.document.visibilityState,t.xo()})},this.document.addEventListener("visibilitychange",this.vo),this.inForeground="visible"===this.document.visibilityState)},bh.prototype.nh=function(){this.vo&&(this.document.removeEventListener("visibilitychange",this.vo),this.vo=null)},bh.prototype.Mo=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.bo=function(){e.eh(),e.Is.ai(function(){return e.th()})},this.window.addEventListener("unload",this.bo))},bh.prototype.sh=function(){this.bo&&(this.window.removeEventListener("unload",this.bo),this.bo=null)},bh.prototype.Zo=function(t){var e;try{var n=null!==(null===(e=this.$o)||void 0===e?void 0:e.getItem(this.Xo(t)));return Or("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Pr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},bh.prototype.eh=function(){if(this.$o)try{this.$o.setItem(this.Xo(this.clientId),String(Date.now()))}catch(t){Pr("Failed to set zombie client id.",t)}},bh.prototype.ih=function(){if(this.$o)try{this.$o.removeItem(this.Xo(this.clientId))}catch(t){}},bh.prototype.Xo=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},bh);function bh(t,e,n,r,i,o,s,u,a,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Is=i,this.window=o,this.document=s,this.Po=a,this.Vo=c,this.yo=null,this.po=!1,this.isPrimary=!1,this.networkEnabled=!0,this.bo=null,this.inForeground=!1,this.vo=null,this.So=null,this.Do=Number.NEGATIVE_INFINITY,this.Co=function(t){return Promise.resolve()},!bh.ks())throw new ni(ei.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.dr=new _h(this,r),this.No=e+"main",this.serializer=new lc(u),this.Fo=new Ra(this.No,10,new Fc(this.serializer)),this.ko=new hh(this.dr,this.serializer),this.zn=new sh,this.Kn=new Rc(this.serializer,this.zn),this.window&&this.window.localStorage?this.$o=this.window.localStorage:(this.$o=null,!1===c&&Pr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function Eh(t,e){var n=this;return(n=vh.call(this)||this).vr=t,n.Ro=e,n}function Ih(t){return wh.Ms(t,jc.store)}function Th(t){return wh.Ms(t,ih.store)}var _h=(Nh.prototype.ir=function(t){var n=this._h(t);return this.db.hh().do(t).next(function(e){return n.next(function(t){return e+t})})},Nh.prototype._h=function(t){var e=0;return this.or(t,function(t){e++}).next(function(){return e})},Nh.prototype.be=function(t,e){return this.db.hh().be(t,e)},Nh.prototype.or=function(t,n){return this.fh(t,function(t,e){return n(e)})},Nh.prototype.Eo=function(t,e,n){return Ah(t,n)},Nh.prototype.mo=function(t,e,n){return Ah(t,n)},Nh.prototype.hr=function(t,e,n){return this.db.hh().hr(t,e,n)},Nh.prototype.Dr=Ah,Nh.prototype.dh=function(t,e){return r=e,i=!1,Dc(n=t).ti(function(t){return _c(n,t,r).next(function(t){return t&&(i=!0),la.resolve(!t)})}).next(function(){return i});var n,r,i},Nh.prototype.ar=function(r,i){var o=this,s=this.db.ah().jr(),u=[],a=0;return this.fh(r,function(e,t){var n;t<=i&&(n=o.dh(r,e).next(function(t){if(!t)return a++,s.Ln(r,e).next(function(){return s.Mn(e),yh(r).delete([0,ac(e.path)])})}),u.push(n))}).next(function(){return la.Cn(u)}).next(function(){return s.apply(r)}).next(function(){return a})},Nh.prototype.removeTarget=function(t,e){var n=e.tt(t.Ro);return this.db.hh().lo(t,n)},Nh.prototype.wh=Ah,Nh.prototype.fh=function(t,o){var s,e=yh(t),u=ma.Es;return e.Zs({index:th.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==ma.Es&&o(new ci(fc(s)),u),u=i,s=r):u=ma.Es}).next(function(){u!==ma.Es&&o(new ci(fc(s)),u)})},Nh.prototype.cr=function(t){return this.db.ah().zr(t)},Nh);function Nh(t,e){this.db=t,this.Yi=new oc(this,e)}function Ah(t,e){return yh(t).put((n=t.Ro,new th(0,ac(e.path),n)));var n}function Sh(t,e){var n=t.projectId;return t.i||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Dh=(kh.prototype.er=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.ur(t,n.Eh)})},kh);function kh(t,e,n){this.persistence=t,this.Th=e,this.Eh=new Ci(Gr),this.Ih=new ti(Ti,_i),this.mh=ii.min(),this.Gn=t.oh(n),this.Ah=t.ah(),this.ko=t.hh(),this.Rh=new va(this.Ah,this.Gn,this.persistence.uh()),this.Th.Ph(this.Rh)}function Rh(t,h){var f=t;return f.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e,n,i,o,s,r,u,a=h.batch.keys(),c=f.Ah.jr({Gr:!0});return e=f,n=t,o=c,s=(i=h).batch,r=s.keys(),u=la.resolve(),r.forEach(function(r){u=u.next(function(){return o.Ln(n,r)}).next(function(t){var e=t,n=i.Pn.get(r);Mr(null!==n),(!e||e.version.o(n)<0)&&(e=s.En(r,e,i))&&o.xn(e,i.Rn)})}),u.next(function(){return e.Gn.br(n,s)}).next(function(){return c.apply(t)}).next(function(){return f.Gn.Cr(t)}).next(function(){return f.Rh.Zn(t,a)})})}function Lh(t){var e=t;return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.ko.ro(t)})}function xh(t,s){var h=t,f=s.Z,l=h.Eh;return h.persistence.runTransaction("Apply remote event","readwrite-primary",function(a){var i=h.Ah.jr({Gr:!0});l=h.Eh;var c=[];s.Wt.forEach(function(t,e){var n,r,i,o,s,u=l.get(e);u&&(c.push(h.ko.Io(a,t.Zt,e).next(function(){return h.ko.To(a,t.Jt,e)})),0<(n=t.resumeToken).Y()&&(r=u.et(n,f).tt(a.Ro),l=l.st(e,r),i=u,s=t,Mr(0<(o=r).resumeToken.Y()),(0===i.resumeToken.Y()||3e8<=o.Z.m()-i.Z.m()||0<s.Jt.size+s.Xt.size+s.Zt.size)&&c.push(h.ko.lo(a,r))))});var t,o=zi,n=Qi();return s.Kt.forEach(function(t,e){n=n.add(t)}),c.push(i.getEntries(a,n).next(function(r){s.Kt.forEach(function(t,e){var n=r.get(t);e instanceof lu&&e.version.isEqual(ii.min())?(i.Mn(t,f),o=o.st(t,e)):null==n||0<e.version.o(n.version)||0===e.version.o(n.version)&&n.hasPendingWrites?(i.xn(e,f),o=o.st(t,e)):Or("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),s.Gt.has(t)&&c.push(h.persistence.dr.wh(a,t))})})),f.isEqual(ii.min())||(t=h.ko.ro(a).next(function(t){return h.ko.ho(a,a.Ro,f)}),c.push(t)),la.Cn(c).next(function(){return i.apply(a)}).next(function(){return h.Rh.ts(a,o)})}).then(function(t){return h.Eh=l,t})}function Oh(t,r){var i=t;return i.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.ko.wo(e,r).next(function(t){return t?(n=t,la.resolve(n)):i.ko.no(e).next(function(t){return n=new Li(r,t,0,e.Ro),i.ko.ao(e,n).next(function(){return n})})})}).then(function(t){var e=i.Eh.get(t.targetId);return(null===e||0<t.Z.o(e.Z))&&(i.Eh=i.Eh.st(t.targetId,t),i.Ih.set(r,t.targetId)),t})}function Ph(o,s,u){return g(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){switch(t.label){case 0:n=(e=o).Eh.get(s),r=u?"readwrite":"readwrite-primary",t.label=1;case 1:return t.trys.push([1,4,,5]),u?[3,3]:[4,e.persistence.runTransaction("Release target",r,function(t){return e.persistence.dr.removeTarget(t,n)})];case 2:t.sent(),t.label=3;case 3:return[3,5];case 4:if(!Ua(i=t.sent()))throw i;return Or("LocalStore","Failed to update sequence numbers for target "+s+": "+i),[3,5];case 5:return e.Eh=e.Eh.remove(s),e.Ih.delete(n.target),[2]}})})}function Ch(t,s,u){var a=t,c=ii.min(),h=Qi();return a.persistence.runTransaction("Execute query","readonly",function(e){return t=a,n=e,r=_u(s),(void 0!==(o=(i=t).Ih.get(r))?la.resolve(i.Eh.get(o)):i.ko.wo(n,r)).next(function(t){if(t)return c=t.lastLimboFreeSnapshotVersion,a.ko.Ao(e,t.targetId).next(function(t){h=t})}).next(function(){return a.Th.ns(e,s,u?c:ii.min(),u?h:Qi())}).next(function(t){return{documents:t,gh:h}});var t,n,r,i,o})}function Vh(t,e){var n=t,r=n.ko,i=n.Eh.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.Me(t,e).next(function(t){return t?t.target:null})})}function Uh(e){return g(this,void 0,void 0,function(){return w(this,function(t){if(e.code!==ei.FAILED_PRECONDITION||e.message!==da)throw e;return Or("LocalStore","Unexpectedly lost primary lease"),[2]})})}var Mh=(Bh.prototype._=function(){return this.Vh._()},Bh.prototype.Eo=function(t,e){var n=new Fh(t,e);this.Vh=this.Vh.add(n),this.ph=this.ph.add(n)},Bh.prototype.vh=function(t,e){var n=this;t.forEach(function(t){return n.Eo(t,e)})},Bh.prototype.mo=function(t,e){this.Sh(new Fh(t,e))},Bh.prototype.Dh=function(t,e){var n=this;t.forEach(function(t){return n.mo(t,e)})},Bh.prototype.Ch=function(t){var e=this,n=new ci(new si([])),r=new Fh(n,t),i=new Fh(n,t+1),o=[];return this.ph.St([r,i],function(t){e.Sh(t),o.push(t.key)}),o},Bh.prototype.Nh=function(){var e=this;this.Vh.forEach(function(t){return e.Sh(t)})},Bh.prototype.Sh=function(t){this.Vh=this.Vh.delete(t),this.ph=this.ph.delete(t)},Bh.prototype.Fh=function(t){var e=new ci(new si([])),n=new Fh(e,t),r=new Fh(e,t+1),i=Qi();return this.ph.St([n,r],function(t){i=i.add(t.key)}),i},Bh.prototype.Nr=function(t){var e=new Fh(t,0),n=this.Vh.Ct(e);return null!==n&&t.isEqual(n.key)},Bh),Fh=(Gh.yh=function(t,e){return ci.P(t.key,e.key)||Gr(t.kh,e.kh)},Gh.bh=function(t,e){return Gr(t.kh,e.kh)||ci.P(t.key,e.key)},Gh),qh=(jh.prototype.Er=function(){return null!=this.uid},jh.prototype.$h=function(){return this.Er()?"uid:"+this.uid:"anonymous-user"},jh.prototype.isEqual=function(t){return t.uid===this.uid},jh);function jh(t){this.uid=t}function Gh(t,e){this.key=t,this.kh=e}function Bh(){this.Vh=new Gi(Fh.yh),this.ph=new Gi(Fh.bh)}qh.UNAUTHENTICATED=new qh(null),qh.xh=new qh("google-credentials-uid"),qh.Oh=new qh("first-party-uid");function zh(t,e){this.user=e,this.type="OAuth",this.Mh={},this.Mh.Authorization="Bearer "+t}var Hh,Wh,Kh,Yh=(df.prototype.getToken=function(){return Promise.resolve(null)},df.prototype.qh=function(){},df.prototype.Bh=function(t){(this.Lh=t)(qh.UNAUTHENTICATED)},df.prototype.Uh=function(){this.Lh=null},df),Xh=(pf.prototype.getToken=function(){var e=this,n=this.jh,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.jh!==n?(Or("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Mr("string"==typeof t.accessToken),new zh(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},pf.prototype.qh=function(){this.forceRefresh=!0},pf.prototype.Bh=function(t){this.Lh=t,this.Wh&&t(this.currentUser)},pf.prototype.Uh=function(){this.auth&&this.auth.removeAuthTokenListener(this.Qh),this.Qh=null,this.Lh=null},pf.prototype.Kh=function(){var t=this.auth&&this.auth.getUid();return Mr(null===t||"string"==typeof t),new qh(t)},pf),Qh=(Object.defineProperty(lf.prototype,"Mh",{get:function(){var t={"X-Goog-AuthUser":this.zh},e=this.Gh.auth.Hh([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),lf),Zh=(ff.prototype.getToken=function(){return Promise.resolve(new Qh(this.Gh,this.zh))},ff.prototype.Bh=function(t){t(qh.Oh)},ff.prototype.Uh=function(){},ff.prototype.qh=function(){},ff),Jh=(hf.prototype.ea=function(){return 1===this.state||2===this.state||4===this.state},hf.prototype.na=function(){return 2===this.state},hf.prototype.start=function(){3!==this.state?this.auth():this.sa()},hf.prototype.stop=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.ea()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},hf.prototype.ia=function(){this.state=0,this.Ti.reset()},hf.prototype.ra=function(){var t=this;this.na()&&null===this.ta&&(this.ta=this.Is.Ss(this.Yh,6e4,function(){return t.oa()}))},hf.prototype.ha=function(t){this.aa(),this.stream.send(t)},hf.prototype.oa=function(){return g(this,void 0,void 0,function(){return w(this,function(t){return this.na()?[2,this.close(0)]:[2]})})},hf.prototype.aa=function(){this.ta&&(this.ta.cancel(),this.ta=null)},hf.prototype.close=function(e,n){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.aa(),this.Ti.cancel(),this.Zh++,3!==e?this.Ti.reset():n&&n.code===ei.RESOURCE_EXHAUSTED?(Pr(n.toString()),Pr("Using maximum backoff delay to prevent overloading the backend."),this.Ti.ps()):n&&n.code===ei.UNAUTHENTICATED&&this.Xh.qh(),null!==this.stream&&(this.ua(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener.ca(n)];case 1:return t.sent(),[2]}})})},hf.prototype.ua=function(){},hf.prototype.auth=function(){var n=this;this.state=1;var t=this.la(this.Zh),e=this.Zh;this.Xh.getToken().then(function(t){n.Zh===e&&n._a(t)},function(e){t(function(){var t=new ni(ei.UNKNOWN,"Fetching auth token failed: "+e.message);return n.fa(t)})})},hf.prototype._a=function(t){var e=this,n=this.la(this.Zh);this.stream=this.da(t),this.stream.wa(function(){n(function(){return e.state=2,e.listener.wa()})}),this.stream.ca(function(t){n(function(){return e.fa(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},hf.prototype.sa=function(){var t=this;this.state=4,this.Ti.bs(function(){return g(t,void 0,void 0,function(){return w(this,function(t){return this.state=0,this.start(),[2]})})})},hf.prototype.fa=function(t){return Or("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},hf.prototype.la=function(e){var n=this;return function(t){n.Is.ai(function(){return n.Zh===e?t():(Or("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},hf),$h=(o(cf,Kh=Jh),cf.prototype.da=function(t){return this.Jh.Ta("Listen",t)},cf.prototype.onMessage=function(t){this.Ti.reset();var e=function(t,e){var n,r,i,o;if("targetChange"in e){e.targetChange;var s="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Ur(),u=e.targetChange.targetIds||[],a=(i=e.targetChange.resumeToken,t.Le?(Mr(void 0===i||"string"==typeof i),Ai.fromBase64String(i||"")):(Mr(void 0===i||i instanceof Uint8Array),Ai.fromUint8Array(i||new Uint8Array))),c=e.targetChange.cause,h=c&&(r=void 0===(n=c).code?ei.UNKNOWN:Pi(n.code),new ni(r,n.message||"")),f=new to(s,u,a,h||null)}else if("documentChange"in e){e.documentChange;var l=e.documentChange;l.document,l.document.name,l.document.updateTime;var p=Yo(t,l.document.name),d=zo(l.document.updateTime),y=new tu({mapValue:{fields:l.document.fields}}),v=new fu(p,d,y,{}),g=l.targetIds||[],m=l.removedTargetIds||[];f=new Ji(g,m,v.key,v)}else if("documentDelete"in e){e.documentDelete;var w=e.documentDelete;w.document;var b=Yo(t,w.document),E=w.readTime?zo(w.readTime):ii.min(),I=new lu(b,E),T=w.removedTargetIds||[];f=new Ji([],T,I.key,I)}else if("documentRemove"in e){e.documentRemove;var _=e.documentRemove;_.document;var N=Yo(t,_.document),A=_.removedTargetIds||[];f=new Ji([],A,N,null)}else{if(!("filter"in e))return Ur();e.filter;var S=e.filter;S.targetId;var D=S.count||0,k=new Di(D),R=S.targetId;f=new $i(R,k)}return f}(this.serializer,t),n=function(t){if(!("targetChange"in t))return ii.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?ii.min():zo(e.readTime)}(t);return this.listener.Ea(e,n)},cf.prototype.Ia=function(t){var e,n,r,i,o={};o.database=Zo(this.serializer),o.addTarget=(e=this.serializer,i=(n=t).target,(r=Ni(i)?{documents:ns(e,i)}:{query:rs(e,i)}).targetId=n.targetId,0<n.resumeToken.Y()&&(r.resumeToken=Bo(e,n.resumeToken)),r);var s,u,a=(this.serializer,s=t,null==(u=function(){switch(s.X){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Ur()}}())?null:{"goog-listen-tags":u});a&&(o.labels=a),this.ha(o)},cf.prototype.ma=function(t){var e={};e.database=Zo(this.serializer),e.removeTarget=t,this.ha(e)},cf),tf=(o(af,Wh=Jh),Object.defineProperty(af.prototype,"Ra",{get:function(){return this.Aa},enumerable:!1,configurable:!0}),af.prototype.start=function(){this.Aa=!1,this.lastStreamToken=void 0,Wh.prototype.start.call(this)},af.prototype.ua=function(){this.Aa&&this.Pa([])},af.prototype.da=function(t){return this.Jh.Ta("Write",t)},af.prototype.onMessage=function(t){if(Mr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Aa){this.Ti.reset();var e=(r=t.writeResults,i=t.commitTime,r&&0<r.length?(Mr(void 0!==i),r.map(function(t){return function(t,e){var n=t.updateTime?zo(t.updateTime):zo(e);n.isEqual(ii.min())&&(n=zo(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new Rs(n,r)}(t,i)})):[]),n=zo(t.commitTime);return this.listener.ga(n,e)}var r,i;return Mr(!t.writeResults||0===t.writeResults.length),this.Aa=!0,this.listener.Va()},af.prototype.ya=function(){var t={};t.database=Zo(this.serializer),this.ha(t)},af.prototype.Pa=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return ts(e.serializer,t)})};this.ha(n)},af),ef=(o(uf,Hh=function(){}),uf.prototype.ba=function(){if(this.pa)throw new ni(ei.FAILED_PRECONDITION,"The client has already been terminated.")},uf.prototype.va=function(e,n,r){var i=this;return this.ba(),this.credentials.getToken().then(function(t){return i.Jh.va(e,n,r,t)}).catch(function(t){throw t.code===ei.UNAUTHENTICATED&&i.credentials.qh(),t})},uf.prototype.Sa=function(e,n,r){var i=this;return this.ba(),this.credentials.getToken().then(function(t){return i.Jh.Sa(e,n,r,t)}).catch(function(t){throw t.code===ei.UNAUTHENTICATED&&i.credentials.qh(),t})},uf.prototype.terminate=function(){this.pa=!1},uf),nf=(sf.prototype.ka=function(){var t=this;0===this.Ca&&(this.$a("Unknown"),this.Na=this.ei.Ss("online_state_timeout",1e4,function(){return t.Na=null,t.xa("Backend didn't respond within 10 seconds."),t.$a("Offline"),Promise.resolve()}))},sf.prototype.Oa=function(t){"Online"===this.state?this.$a("Unknown"):(this.Ca++,1<=this.Ca&&(this.Ma(),this.xa("Connection failed 1 times. Most recent error: "+t.toString()),this.$a("Offline")))},sf.prototype.set=function(t){this.Ma(),this.Ca=0,"Online"===t&&(this.Fa=!1),this.$a(t)},sf.prototype.$a=function(t){t!==this.state&&(this.state=t,this.Da(t))},sf.prototype.xa=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Fa?(Pr(e),this.Fa=!1):Or("OnlineStateTracker",e)},sf.prototype.Ma=function(){null!==this.Na&&(this.Na.cancel(),this.Na=null)},sf),rf=(of.prototype.start=function(){return this.enableNetwork()},of.prototype.enableNetwork=function(){return this.Wa.delete(0),this.iu()},of.prototype.iu=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Ga()?(this.ru()?this.ou():this.Ha.set("Unknown"),[4,this.hu()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},of.prototype.disableNetwork=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Wa.add(0),[4,this.au()];case 1:return t.sent(),this.Ha.set("Offline"),[2]}})})},of.prototype.au=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,this.tu.stop()];case 1:return t.sent(),[4,this.Ya.stop()];case 2:return t.sent(),0<this.Ba.length&&(Or("RemoteStore","Stopping write stream with "+this.Ba.length+" pending writes"),this.Ba=[]),this.uu(),[2]}})})},of.prototype.th=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return Or("RemoteStore","RemoteStore shutting down."),this.Wa.add(5),[4,this.au()];case 1:return t.sent(),this.ja.th(),this.Ha.set("Unknown"),[2]}})})},of.prototype.listen=function(t){this.Ua.has(t.targetId)||(this.Ua.set(t.targetId,t),this.ru()?this.ou():this.Ya.na()&&this.cu(t))},of.prototype.lu=function(t){this.Ua.delete(t),this.Ya.na()&&this._u(t),0===this.Ua.size&&(this.Ya.na()?this.Ya.ra():this.Ga()&&this.Ha.set("Unknown"))},of.prototype.Me=function(t){return this.Ua.get(t)||null},of.prototype.Oe=function(t){return this.fu.Oe(t)},of.prototype.cu=function(t){this.Qa.we(t.targetId),this.Ya.Ia(t)},of.prototype._u=function(t){this.Qa.we(t),this.Ya.ma(t)},of.prototype.ou=function(){this.Qa=new uo(this),this.Ya.start(),this.Ha.ka()},of.prototype.ru=function(){return this.Ga()&&!this.Ya.ea()&&0<this.Ua.size},of.prototype.Ga=function(){return 0===this.Wa.size},of.prototype.uu=function(){this.Qa=null},of.prototype.Ja=function(){return g(this,void 0,void 0,function(){var n=this;return w(this,function(t){return this.Ua.forEach(function(t,e){n.cu(t)}),[2]})})},of.prototype.Xa=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){return this.uu(),this.ru()?(this.Ha.Oa(e),this.ou()):this.Ha.set("Unknown"),[2]})})},of.prototype.Za=function(i,o){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:if(this.Ha.set("Online"),!(i instanceof to&&2===i.state&&i.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,this.du(i)];case 2:return t.sent(),[3,5];case 3:return e=t.sent(),Or("RemoteStore","Failed to remove targets %s: %s ",i.targetIds.join(","),e),[4,this.wu(e)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(i instanceof Ji?this.Qa.ge(i):i instanceof $i?this.Qa.Ce(i):this.Qa.pe(i),o.isEqual(ii.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,Lh(this.La)];case 8:return n=t.sent(),0<=o.o(n)?[4,this.Tu(o)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Or("RemoteStore","Failed to raise snapshot:",r=t.sent()),[4,this.wu(r)];case 12:return t.sent(),[3,13];case 13:return[2]}})})},of.prototype.wu=function(n,r){return g(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:if(!Ua(n))throw n;return this.Wa.add(1),[4,this.au()];case 1:return t.sent(),this.Ha.set("Offline"),r=r||function(){return Lh(e.La)},this.ei.gi(function(){return g(e,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return Or("RemoteStore","Retrying IndexedDB access"),[4,r()];case 1:return t.sent(),this.Wa.delete(1),[4,this.iu()];case 2:return t.sent(),[2]}})})}),[2]}})})},of.prototype.Eu=function(e){var n=this;return e().catch(function(t){return n.wu(t,e)})},of.prototype.Tu=function(r){var i=this,t=this.Qa.ke(r);return t.Wt.forEach(function(t,e){var n;0<t.resumeToken.Y()&&(n=i.Ua.get(e))&&i.Ua.set(e,n.et(t.resumeToken,r))}),t.jt.forEach(function(t){var e,n=i.Ua.get(t);n&&(i.Ua.set(t,n.et(Ai.J,n.Z)),i._u(t),e=new Li(n.target,t,1,n.sequenceNumber),i.cu(e))}),this.fu.Iu(t)},of.prototype.du=function(o){return g(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){switch(t.label){case 0:e=o.cause,n=0,r=o.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],this.Ua.has(i)?[4,this.fu.mu(i,e)]:[3,3]):[3,5];case 2:t.sent(),this.Ua.delete(i),this.Qa.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})},of.prototype.hu=function(){return g(this,void 0,void 0,function(){var i,o,s;return w(this,function(t){switch(t.label){case 0:i=0<this.Ba.length?this.Ba[this.Ba.length-1].batchId:-1,t.label=1;case 1:if(!this.Au())return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,(e=this.La,n=i,(r=e).persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===n&&(n=-1),r.Gn.gr(t,n)}))];case 3:return null===(o=t.sent())?(0===this.Ba.length&&this.tu.ra(),[3,7]):(i=o.batchId,this.Ru(o),[3,6]);case 4:return s=t.sent(),[4,this.wu(s)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return this.Pu()&&this.gu(),[2]}var e,n,r})})},of.prototype.Au=function(){return this.Ga()&&this.Ba.length<10},of.prototype.Vu=function(){return this.Ba.length},of.prototype.Ru=function(t){this.Ba.push(t),this.tu.na()&&this.tu.Ra&&this.tu.Pa(t.mutations)},of.prototype.Pu=function(){return this.Ga()&&!this.tu.ea()&&0<this.Ba.length},of.prototype.gu=function(){this.tu.start()},of.prototype.eu=function(){return g(this,void 0,void 0,function(){return w(this,function(t){return this.tu.ya(),[2]})})},of.prototype.su=function(){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){for(e=0,n=this.Ba;e<n.length;e++)r=n[e],this.tu.Pa(r.mutations);return[2]})})},of.prototype.ga=function(i,o){return g(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return e=this.Ba.shift(),n=fa.from(e,i,o),[4,this.Eu(function(){return r.fu.yu(n)})];case 1:return t.sent(),[4,this.hu()];case 2:return t.sent(),[2]}})})},of.prototype.nu=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return e&&this.tu.Ra?[4,this.pu(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.Pu()&&this.gu(),[2]}})})},of.prototype.pu=function(i){return g(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return Oi(n=i.code)&&n!==ei.ABORTED?(e=this.Ba.shift(),this.tu.ia(),[4,this.Eu(function(){return r.fu.bu(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,this.hu()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},of.prototype.za=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Wa.add(4),[4,this.au()];case 1:return t.sent(),this.Ha.set("Unknown"),this.tu.ia(),this.Ya.ia(),this.Wa.delete(4),[4,this.iu()];case 2:return t.sent(),[2]}})})},of.prototype.vu=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.ei.pi(),Or("RemoteStore","RemoteStore received new credentials"),this.Wa.add(3),[4,this.au()];case 1:return t.sent(),this.Ha.set("Unknown"),[4,this.fu.vu(e)];case 2:return t.sent(),this.Wa.delete(3),[4,this.iu()];case 3:return t.sent(),[2]}})})},of.prototype.Su=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return e?(this.Wa.delete(2),[4,this.iu()]):[3,2];case 1:return t.sent(),[3,5];case 2:return e?[3,4]:(this.Wa.add(2),[4,this.au()]);case 3:t.sent(),this.Ha.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})},of);function of(t,e,n,r,i){var o,s,u,a,c,h,f,l,p=this;this.La=t,this.qa=e,this.ei=n,this.Ba=[],this.Ua=new Map,this.Qa=null,this.Wa=new Set,this.ja=i,this.ja.Ka(function(t){n.ai(function(){return g(p,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Ga()?(Or("RemoteStore","Restarting streams for network reachability change."),[4,this.za()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Ha=new nf(n,r),this.Ya=(c=this.qa,h=n,f={wa:this.Ja.bind(this),ca:this.Xa.bind(this),Ea:this.Za.bind(this)},(l=c).ba(),new $h(h,l.Jh,l.credentials,l.serializer,f)),this.tu=(o=this.qa,s=n,u={wa:this.eu.bind(this),ca:this.nu.bind(this),Va:this.su.bind(this),ga:this.ga.bind(this)},(a=o).ba(),new tf(s,a.Jh,a.credentials,a.serializer,u))}function sf(t,e){this.ei=t,this.Da=e,this.state="Unknown",this.Ca=0,this.Na=null,this.Fa=!0}function uf(t,e,n){var r=this;return(r=Hh.call(this)||this).credentials=t,r.Jh=e,r.serializer=n,r.pa=!1,r}function af(t,e,n,r,i){var o=this;return(o=Wh.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.Aa=!1,o}function cf(t,e,n,r,i){var o=this;return(o=Kh.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function hf(t,e,n,r,i,o){this.Is=t,this.Yh=n,this.Jh=r,this.Xh=i,this.listener=o,this.state=0,this.Zh=0,this.ta=null,this.stream=null,this.Ti=new ka(t,e)}function ff(t,e){this.Gh=t,this.zh=e}function lf(t,e){this.Gh=t,this.zh=e,this.type="FirstParty",this.user=qh.Oh}function pf(t){var e=this;this.Qh=null,this.currentUser=qh.UNAUTHENTICATED,this.Wh=!1,this.jh=0,this.Lh=null,this.forceRefresh=!1,this.Qh=function(){e.jh++,e.currentUser=e.Kh(),e.Wh=!0,e.Lh&&e.Lh(e.currentUser)},this.jh=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.Qh):(this.Qh(null),t.get().then(function(t){e.auth=t,e.Qh&&e.auth.addAuthTokenListener(e.Qh)},function(){}))}function df(){this.Lh=null}function yf(t,e){return"firestore_clients_"+t+"_"+e}function vf(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Er()&&(r+="_"+e.uid),r}function gf(t,e){return"firestore_targets_"+t+"_"+e}function mf(t){this.key=t}function wf(t){this.key=t}function bf(t,e,n){this.query=t,this.targetId=e,this.view=n}function Ef(t){this.key=t,this.qc=!1}var If=(Ff.Du=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new ni(r.error.code,r.error.message)),i?new Ff(t,e,r.state,o):(Pr("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Ff.prototype.Cu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Ff),Tf=(Mf.Du=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new ni(n.error.code,n.error.message)),r?new Mf(t,n.state,i):(Pr("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Mf.prototype.Cu=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Mf),_f=(Uf.Du=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Zi,o=0;r&&o<n.activeTargetIds.length;++o)r=bi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Uf(t,i):(Pr("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Uf),Nf=(Vf.Du=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Vf(e.clientId,e.onlineState):(Pr("SharedClientState","Failed to parse online state: "+t),null)},Vf),Af=(Cf.prototype.Nu=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Cf.prototype.Fu=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Cf.prototype.Cu=function(){var t={activeTargetIds:this.activeTargetIds.N(),updateTimeMs:Date.now()};return JSON.stringify(t)},Cf),Sf=(Pf.ks=function(t){return!(!t||!t.localStorage)},Pf.prototype.start=function(){return g(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l=this;return w(this,function(t){switch(t.label){case 0:return[4,this.fu.rh()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.ku&&(o=this.getItem(yf(this.persistenceKey,i)))&&(s=_f.Du(i,o))&&(this.Ou=this.Ou.st(s.clientId,s));for(this.ju(),(u=this.storage.getItem(this.Wu))&&(a=this.Ku(u))&&this.Gu(a),c=0,h=this.Mu;c<h.length;c++)f=h[c],this.xu(f);return this.Mu=[],this.window.addEventListener("unload",function(){return l.th()}),this.tr=!0,[2]}})})},Pf.prototype.Ts=function(t){this.setItem(this.qu,JSON.stringify(t))},Pf.prototype.zu=function(){return this.Hu(this.Ou)},Pf.prototype.Yu=function(n){var r=!1;return this.Ou.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},Pf.prototype.Ju=function(t){this.Xu(t,"pending")},Pf.prototype.Zu=function(t,e,n){this.Xu(t,e,n),this.tc(t)},Pf.prototype.ec=function(t){var e,n,r="not-current";return this.Yu(t)&&(!(e=this.storage.getItem(gf(this.persistenceKey,t)))||(n=Tf.Du(t,e))&&(r=n.state)),this.nc.Nu(t),this.ju(),r},Pf.prototype.sc=function(t){this.nc.Fu(t),this.ju()},Pf.prototype.ic=function(t){return this.nc.activeTargetIds.has(t)},Pf.prototype.rc=function(t){this.removeItem(gf(this.persistenceKey,t))},Pf.prototype.oc=function(t,e,n){this.hc(t,e,n)},Pf.prototype.ac=function(t,e,n){var r=this;e.forEach(function(t){r.tc(t)}),this.currentUser=t,n.forEach(function(t){r.Ju(t)})},Pf.prototype.uc=function(t){this.cc(t)},Pf.prototype.th=function(){this.tr&&(this.window.removeEventListener("storage",this.$u),this.removeItem(this.Lu),this.tr=!1)},Pf.prototype.getItem=function(t){var e=this.storage.getItem(t);return Or("SharedClientState","READ",t,e),e},Pf.prototype.setItem=function(t,e){Or("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Pf.prototype.removeItem=function(t){Or("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Pf.prototype.xu=function(t){var e=this,u=t;if(u.storageArea===this.storage){if(Or("SharedClientState","EVENT",u.key,u.newValue),u.key===this.Lu)return void Pr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Is.gi(function(){return g(e,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){if(this.tr){if(null!==u.key)if(this.Bu.test(u.key)){if(null==u.newValue)return e=this.lc(u.key),[2,this._c(e,null)];if(n=this.fc(u.key,u.newValue))return[2,this._c(n.clientId,n)]}else if(this.Uu.test(u.key)){if(null!==u.newValue&&(r=this.dc(u.key,u.newValue)))return[2,this.wc(r)]}else if(this.Qu.test(u.key)){if(null!==u.newValue&&(i=this.Tc(u.key,u.newValue)))return[2,this.Ec(i)]}else if(u.key===this.Wu){if(null!==u.newValue&&(o=this.Ku(u.newValue)))return[2,this.Gu(o)]}else u.key===this.qu&&(s=function(t){var e=ma.Es;if(null!=t)try{var n=JSON.parse(t);Mr("number"==typeof n),e=n}catch(t){Pr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==ma.Es&&this.fs(s)}else this.Mu.push(u);return[2]})})})}},Object.defineProperty(Pf.prototype,"nc",{get:function(){return this.Ou.get(this.ku)},enumerable:!1,configurable:!0}),Pf.prototype.ju=function(){this.setItem(this.Lu,this.nc.Cu())},Pf.prototype.Xu=function(t,e,n){var r=new If(this.currentUser,t,e,n),i=vf(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Cu())},Pf.prototype.tc=function(t){var e=vf(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Pf.prototype.cc=function(t){var e={clientId:this.ku,onlineState:t};this.storage.setItem(this.Wu,JSON.stringify(e))},Pf.prototype.hc=function(t,e,n){var r=gf(this.persistenceKey,t),i=new Tf(t,e,n);this.setItem(r,i.Cu())},Pf.prototype.lc=function(t){var e=this.Bu.exec(t);return e?e[1]:null},Pf.prototype.fc=function(t,e){var n=this.lc(t);return _f.Du(n,e)},Pf.prototype.dc=function(t,e){var n=this.Uu.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return If.Du(new qh(i),r,e)},Pf.prototype.Tc=function(t,e){var n=this.Qu.exec(t),r=Number(n[1]);return Tf.Du(r,e)},Pf.prototype.Ku=function(t){return Nf.Du(t)},Pf.prototype.wc=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.fu.Ic(e.batchId,e.state,e.error)]:(Or("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},Pf.prototype.Ec=function(t){return this.fu.mc(t.targetId,t.state,t.error)},Pf.prototype._c=function(t,e){var n=this,r=e?this.Ou.st(t,e):this.Ou.remove(t),i=this.Hu(this.Ou),o=this.Hu(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.fu.Ac(s,u).then(function(){n.Ou=r})},Pf.prototype.Gu=function(t){this.Ou.get(t.clientId)&&this.Da(t.onlineState)},Pf.prototype.Hu=function(t){var n=Zi;return t.forEach(function(t,e){n=n.Nt(e.activeTargetIds)}),n},Pf),Df=(Of.prototype.Ju=function(t){},Of.prototype.Zu=function(t,e,n){},Of.prototype.ec=function(t){return this.Rc.Nu(t),this.Pc[t]||"not-current"},Of.prototype.oc=function(t,e,n){this.Pc[t]=e},Of.prototype.sc=function(t){this.Rc.Fu(t)},Of.prototype.ic=function(t){return this.Rc.activeTargetIds.has(t)},Of.prototype.rc=function(t){delete this.Pc[t]},Of.prototype.zu=function(){return this.Rc.activeTargetIds},Of.prototype.Yu=function(t){return this.Rc.activeTargetIds.has(t)},Of.prototype.start=function(){return this.Rc=new Af,Promise.resolve()},Of.prototype.ac=function(t,e,n){},Of.prototype.uc=function(t){},Of.prototype.th=function(){},Of.prototype.Ts=function(t){},Of),kf=(Object.defineProperty(xf.prototype,"vc",{get:function(){return this.gc},enumerable:!1,configurable:!0}),xf.prototype.Sc=function(t,e){var u=this,a=e?e.Dc:new no,c=e?e.bc:this.bc,h=e?e.qt:this.qt,f=c,l=!1,p=this.query.an()&&c.size===this.query.limit?c.last():null,d=this.query.un()&&c.size===this.query.limit?c.first():null;if(t.ht(function(t,e){var n=c.get(t),r=(r=e instanceof fu?e:null)&&(Lu(u.query,r)?r:null),i=!!n&&u.qt.has(n.key),o=!!r&&(r.Ge||u.qt.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.Cc(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.pc(r,p)||d&&u.pc(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(h=r?(f=f.add(r),o?h.add(t):h.delete(t)):(f=f.delete(t),h.delete(t)))}),this.query.an()||this.query.un())for(;f.size>this.query.limit;){var n=this.query.an()?f.last():f.first(),f=f.delete(n.key),h=h.delete(n.key);a.track({type:1,doc:n})}return{bc:f,Dc:a,Nc:l,qt:h}},xf.prototype.Cc=function(t,e){return t.Ge&&e.hasCommittedMutations&&!e.Ge},xf.prototype.Un=function(t,e,n){var o=this,r=this.bc;this.bc=t.bc,this.qt=t.qt;var i=t.Dc.Mt();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.pc(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ur()}}var r,i}),this.Fc(n);var s=e?this.kc():[],u=0===this.yc.size&&this.Yt?1:0,a=u!==this.Vc;return this.Vc=u,0!==i.length||a?{snapshot:new ro(this.query,t.bc,r,i,t.qt,0==u,a,!1),$c:s}:{$c:s}},xf.prototype.xc=function(t){return this.Yt&&"Offline"===t?(this.Yt=!1,this.Un({bc:this.bc,Dc:new no,qt:this.qt,Nc:!1},!1)):{$c:[]}},xf.prototype.Oc=function(t){return!this.gc.has(t)&&!!this.bc.has(t)&&!this.bc.get(t).Ge},xf.prototype.Fc=function(t){var e=this;t&&(t.Jt.forEach(function(t){return e.gc=e.gc.add(t)}),t.Xt.forEach(function(t){}),t.Zt.forEach(function(t){return e.gc=e.gc.delete(t)}),this.Yt=t.Yt)},xf.prototype.kc=function(){var e=this;if(!this.Yt)return[];var n=this.yc;this.yc=Qi(),this.bc.forEach(function(t){e.Oc(t.key)&&(e.yc=e.yc.add(t.key))});var r=[];return n.forEach(function(t){e.yc.has(t)||r.push(new wf(t))}),this.yc.forEach(function(t){n.has(t)||r.push(new mf(t))}),r},xf.prototype.Mc=function(t){this.gc=t.gh,this.yc=Qi();var e=this.Sc(t.documents);return this.Un(e,!0)},xf.prototype.Lc=function(){return ro.Qt(this.query,this.bc,this.qt,0===this.Vc)},xf),Rf=(Object.defineProperty(Lf.prototype,"el",{get:function(){return!0===this.tl},enumerable:!1,configurable:!0}),Lf.prototype.subscribe=function(t){this.Wc=t},Lf.prototype.listen=function(s){return g(this,void 0,void 0,function(){var e,n,r,i,o;return w(this,function(t){switch(t.label){case 0:return this.nl("listen()"),(r=this.jc.get(s))?(e=r.targetId,this.Uc.ec(e),n=r.view.Lc(),[3,4]):[3,1];case 1:return[4,Oh(this.La,_u(s))];case 2:return i=t.sent(),o=this.Uc.ec(i.targetId),e=i.targetId,[4,this.sl(s,e,"current"===o)];case 3:n=t.sent(),this.el&&this.Bc.listen(i),t.label=4;case 4:return[2,n]}})})},Lf.prototype.sl=function(u,a,c){return g(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return[4,Ch(this.La,u,!0)];case 1:return e=t.sent(),n=new kf(u,e.gh),r=n.Sc(e.documents),i=oo.Ht(a,c&&"Offline"!==this.onlineState),o=n.Un(r,this.el,i),this.il(a,o.$c),s=new bf(u,a,n),[2,(this.jc.set(u,s),this.Kc.has(a)?this.Kc.get(a).push(u):this.Kc.set(a,[u]),o.snapshot)]}})})},Lf.prototype.lu=function(i){return g(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return this.nl("unlisten()"),e=this.jc.get(i),1<(n=this.Kc.get(e.targetId)).length?[2,(this.Kc.set(e.targetId,n.filter(function(t){return!Du(t,i)})),void this.jc.delete(i))]:this.el?(this.Uc.sc(e.targetId),this.Uc.Yu(e.targetId)?[3,2]:[4,Ph(this.La,e.targetId,!1).then(function(){r.Uc.rc(e.targetId),r.Bc.lu(e.targetId),r.rl(e.targetId)}).catch(Uh)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.rl(e.targetId),[4,Ph(this.La,e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},Lf.prototype.write=function(s,u){return g(this,void 0,void 0,function(){var r,i,o;return w(this,function(t){switch(t.label){case 0:this.nl("write()"),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,(e=this.La,c=s,f=e,l=ri.now(),n=c.reduce(function(t,e){return t.add(e.key)},Qi()),f.persistence.runTransaction("Locally write mutations","readwrite",function(a){return f.Rh.Zn(a,n).next(function(t){h=t;for(var u,e,n=[],r=0,i=c;r<i.length;r++){var o=i[r],s=(u=o,e=h.get(o.key),u instanceof Ks?function(t){for(var e=null,n=0,r=u.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof fu?t.field(i.field):void 0,s=hs(i.transform,o||null);null!=s&&(e=null==e?(new eu).set(i.field,s):e.set(i.field,s))}return e?e.ze():null}(e):null);null!=s&&n.push(new Gs(o.key,s,su(s.proto.mapValue),Ls.exists(!0)))}return f.Gn.mr(a,l,n,c)})}).then(function(t){var e=t.An(h);return{batchId:t.batchId,Fn:e}}))];case 2:return r=t.sent(),this.Uc.Ju(r.batchId),this.ol(r.batchId,u),[4,this.hl(r.Fn)];case 3:return t.sent(),[4,this.Bc.hu()];case 4:return t.sent(),[3,6];case 5:return i=t.sent(),o=Za(i,"Failed to persist write"),u.reject(o),[3,6];case 6:return[2]}var e,c,h,f,l,n})})},Lf.prototype.Iu=function(n){return g(this,void 0,void 0,function(){var e,r=this;return w(this,function(t){switch(t.label){case 0:this.nl("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,xh(this.La,n)];case 2:return e=t.sent(),n.Wt.forEach(function(t,e){var n=r.Hc.get(e);n&&(Mr(t.Jt.size+t.Xt.size+t.Zt.size<=1),0<t.Jt.size?n.qc=!0:0<t.Xt.size?Mr(n.qc):0<t.Zt.size&&(Mr(n.qc),n.qc=!1))}),[4,this.hl(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,Uh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Lf.prototype.xc=function(r,t){var i;(this.el&&0===t||!this.el&&1===t)&&(this.nl("applyOnlineStateChange()"),i=[],this.jc.forEach(function(t,e){var n=e.view.xc(r);n.snapshot&&i.push(n.snapshot)}),this.Wc.al(r),this.Wc.Ea(i),this.onlineState=r,this.el&&this.Uc.uc(r))},Lf.prototype.mu=function(u,a){return g(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return w(this,function(t){switch(t.label){case 0:return this.nl("rejectListens()"),this.Uc.oc(u,"rejected",a),e=this.Hc.get(u),(n=e&&e.key)?(r=(r=new Ci(ci.P)).st(n,new lu(n,ii.min())),i=Qi().add(n),o=new io(ii.min(),new Map,new Gi(Gr),r,i),[4,this.Iu(o)]):[3,2];case 1:return t.sent(),this.zc=this.zc.remove(n),this.Hc.delete(u),this.ul(),[3,4];case 2:return[4,Ph(this.La,u,!1).then(function(){return s.rl(u,a)}).catch(Uh)];case 3:t.sent(),t.label=4;case 4:return[2]}})})},Lf.prototype.yu=function(r){return g(this,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:this.nl("applySuccessfulWrite()"),e=r.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,Rh(this.La,r)];case 2:return n=t.sent(),this.cl(e,null),this.ll(e),this.Uc.Zu(e,"acknowledged"),[4,this.hl(n)];case 3:return t.sent(),[3,6];case 4:return[4,Uh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},Lf.prototype.bu=function(o,s){return g(this,void 0,void 0,function(){var n;return w(this,function(t){switch(t.label){case 0:this.nl("rejectFailedWrite()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,(e=this.La,r=o,(i=e).persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return i.Gn.Rr(e,r).next(function(t){return Mr(null!==t),n=t.keys(),i.Gn.br(e,t)}).next(function(){return i.Gn.Cr(e)}).next(function(){return i.Rh.Zn(e,n)})}))];case 2:return n=t.sent(),this.cl(o,s),this.ll(o),this.Uc.Zu(o,"rejected",s),[4,this.hl(n)];case 3:return t.sent(),[3,6];case 4:return[4,Uh(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}var e,r,i})})},Lf.prototype._l=function(u){return g(this,void 0,void 0,function(){var r,i,o,s;return w(this,function(t){switch(t.label){case 0:this.Bc.Ga()||Or("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,(e=this.La,(n=e).persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return n.Gn.Vr(t)}))];case 2:return-1===(r=t.sent())?[2,void u.resolve()]:((i=this.Xc.get(r)||[]).push(u),this.Xc.set(r,i),[3,4]);case 3:return o=t.sent(),s=Za(o,"Initialization of waitForPendingWrites() operation failed"),u.reject(s),[3,4];case 4:return[2]}var e,n})})},Lf.prototype.ll=function(t){(this.Xc.get(t)||[]).forEach(function(t){t.resolve()}),this.Xc.delete(t)},Lf.prototype.fl=function(e){this.Xc.forEach(function(t){t.forEach(function(t){t.reject(new ni(ei.CANCELLED,e))})}),this.Xc.clear()},Lf.prototype.ol=function(t,e){var n=this.Jc[this.currentUser.$h()];n=(n=n||new Ci(Gr)).st(t,e),this.Jc[this.currentUser.$h()]=n},Lf.prototype.cl=function(t,e){var n,r=this.Jc[this.currentUser.$h()];r&&((n=r.get(t))&&(e?n.reject(e):n.resolve(),r=r.remove(t)),this.Jc[this.currentUser.$h()]=r)},Lf.prototype.rl=function(t,e){var n=this;void 0===e&&(e=null),this.Uc.sc(t);for(var r=0,i=this.Kc.get(t);r<i.length;r++){var o=i[r];this.jc.delete(o),e&&this.Wc.dl(o,e)}this.Kc.delete(t),this.el&&this.Yc.Ch(t).forEach(function(t){n.Yc.Nr(t)||n.wl(t)})},Lf.prototype.wl=function(t){var e=this.zc.get(t);null!==e&&(this.Bc.lu(e),this.zc=this.zc.remove(t),this.Hc.delete(e),this.ul())},Lf.prototype.il=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof mf?(this.Yc.Eo(i.key,t),this.Tl(i)):i instanceof wf?(Or("SyncEngine","Document no longer in limbo: "+i.key),this.Yc.mo(i.key,t),this.Yc.Nr(i.key)||this.wl(i.key)):Ur()}},Lf.prototype.Tl=function(t){var e=t.key;this.zc.get(e)||(Or("SyncEngine","New document in limbo: "+e),this.Gc.push(e),this.ul())},Lf.prototype.ul=function(){for(;0<this.Gc.length&&this.zc.size<this.Qc;){var t=this.Gc.shift(),e=this.Zc.next();this.Hc.set(e,new Ef(t)),this.zc=this.zc.st(t,e),this.Bc.listen(new Li(_u(Eu(t.path)),e,2,ma.Es))}},Lf.prototype.El=function(){return this.zc},Lf.prototype.Il=function(){return this.Gc},Lf.prototype.hl=function(r,a){return g(this,void 0,void 0,function(){var o,s,e,u=this;return w(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.jc.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.Sc(r);return n.Nc?Ch(u.La,i.query,!1).then(function(t){var e=t.documents;return i.view.Sc(e,n)}):n}).then(function(t){var e,n=a&&a.Wt.get(i.targetId),r=i.view.Un(t,u.el,n);u.il(i.targetId,r.$c),r.snapshot&&(u.el&&u.Uc.oc(i.targetId,r.snapshot.fromCache?"not-current":"current"),o.push(r.snapshot),e=ga._s(i.targetId,r.snapshot),s.push(e))}))}),[4,Promise.all(e)];case 1:return t.sent(),this.Wc.Ea(o),[4,function(h,f){return g(this,void 0,void 0,function(){var r,e,n,i,o,s,u,a,c;return w(this,function(t){switch(t.label){case 0:r=h,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return la.forEach(f,function(e){return la.forEach(e.cs,function(t){return r.persistence.dr.Eo(n,e.targetId,t)}).next(function(){return la.forEach(e.ls,function(t){return r.persistence.dr.mo(n,e.targetId,t)})})})})];case 2:return t.sent(),[3,4];case 3:if(!Ua(e=t.sent()))throw e;return Or("LocalStore","Failed to update sequence numbers: "+e),[3,4];case 4:for(n=0,i=f;n<i.length;n++)o=i[n],s=o.targetId,o.fromCache||(u=r.Eh.get(s),a=u.Z,c=u.nt(a),r.Eh=r.Eh.st(s,c));return[2]}})})}(this.La,s)];case 2:return t.sent(),[2]}})})},Lf.prototype.nl=function(t){},Lf.prototype.vu=function(n){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return this.currentUser.isEqual(n)?[3,3]:(Or("SyncEngine","User change. New user:",n.$h()),[4,function(i,o){return g(this,void 0,void 0,function(){var e,n,m,r;return w(this,function(t){switch(t.label){case 0:return n=(e=i).Gn,m=e.Rh,[4,e.persistence.runTransaction("Handle user change","readonly",function(v){var g;return e.Gn.yr(v).next(function(t){return g=t,n=e.persistence.oh(o),m=new va(e.Ah,n,e.persistence.uh()),n.yr(v)}).next(function(t){for(var e=[],n=[],r=Qi(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var c=a[u],r=r.add(c.key)}for(var h=0,f=t;h<f.length;h++){var l=f[h];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.Zn(v,r).next(function(t){return{ml:t,Al:e,Rl:n}})})})];case 1:return r=t.sent(),[2,(e.Gn=n,e.Rh=m,e.Th.Ph(e.Rh),r)]}})})}(this.La,n)]);case 1:return e=t.sent(),this.currentUser=n,this.fl("'waitForPendingWrites' promise is rejected due to a user change."),this.Uc.ac(n,e.Al,e.Rl),[4,this.hl(e.ml)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Lf.prototype.Oe=function(t){var e=this.Hc.get(t);if(e&&e.qc)return Qi().add(e.key);var n=Qi(),r=this.Kc.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++)var s=o[i],u=this.jc.get(s),n=n.Nt(u.view.vc);return n},Lf);function Lf(t,e,n,r,i,o){this.La=t,this.Bc=e,this.qa=n,this.Uc=r,this.currentUser=i,this.Qc=o,this.Wc=null,this.jc=new ti(ku,Du),this.Kc=new Map,this.Gc=[],this.zc=new Ci(ci.P),this.Hc=new Map,this.Yc=new Mh,this.Jc={},this.Xc=new Map,this.Zc=ch.eo(),this.onlineState="Unknown",this.tl=void 0}function xf(t,e){this.query=t,this.gc=e,this.Vc=null,this.Yt=!1,this.yc=Qi(),this.qt=Qi(),this.pc=xu(t),this.bc=new eo(this.pc)}function Of(){this.Rc=new Af,this.Pc={},this.Da=null,this.fs=null}function Pf(t,e,n,r,i){this.window=t,this.Is=e,this.persistenceKey=n,this.ku=r,this.fu=null,this.Da=null,this.fs=null,this.$u=this.xu.bind(this),this.Ou=new Ci(Gr),this.tr=!1,this.Mu=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Lu=yf(this.persistenceKey,this.ku),this.qu="firestore_sequence_number_"+this.persistenceKey,this.Ou=this.Ou.st(this.ku,new Af),this.Bu=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Uu=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Qu=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Wu="firestore_online_state_"+this.persistenceKey,this.window.addEventListener("storage",this.$u)}function Cf(){this.activeTargetIds=Zi}function Vf(t,e){this.clientId=t,this.onlineState=e}function Uf(t,e){this.clientId=t,this.activeTargetIds=e}function Mf(t,e,n){this.targetId=t,this.state=e,this.error=n}function Ff(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function qf(u,a,c,h){return g(this,void 0,void 0,function(){var o,s;return w(this,function(t){switch(t.label){case 0:return(o=u).nl("applyBatchState()"),[4,(e=o.La,n=a,i=(r=e).Gn,r.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return i.Pr(e,n).next(function(t){return t?r.Rh.Zn(e,t):la.resolve(null)})}))];case 1:return null===(s=t.sent())?[3,6]:"pending"!==c?[3,3]:[4,o.Bc.hu()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===c||"rejected"===c?(o.cl(a,h||null),o.La.Gn.Sr(a)):Ur(),t.label=4;case 4:return[4,o.hl(s)];case 5:return t.sent(),[3,7];case 6:Or("SyncEngine","Cannot apply mutation batch with id: "+a),t.label=7;case 7:return[2]}var e,n,r,i})})}function jf(h,f){return g(this,void 0,void 0,function(){var r,e,i,o,s,u,a,c;return w(this,function(t){switch(t.label){case 0:return r=h,!0!==f||!0===r.tl?[3,3]:(e=r.Uc.zu(),[4,Gf(r,e.N())]);case 1:return i=t.sent(),r.tl=!0,[4,r.Bc.Su(!0)];case 2:for(t.sent(),o=0,s=i;o<s.length;o++)u=s[o],r.Bc.listen(u);return[3,7];case 3:return!1!==f||!1===r.tl?[3,7]:(a=[],c=Promise.resolve(),r.Kc.forEach(function(t,e){r.Uc.ic(e)?a.push(e):c=c.then(function(){return r.rl(e),Ph(r.La,e,!0)}),r.Bc.lu(e)}),[4,c]);case 4:return t.sent(),[4,Gf(r,a)];case 5:return t.sent(),(n=r).Hc.forEach(function(t,e){n.Bc.lu(e)}),n.Yc.Nh(),n.Hc=new Map,n.zc=new Ci(ci.P),r.tl=!1,[4,r.Bc.Su(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}var n})})}function Gf(y,v){return g(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,c,h,f,l,p,d;return w(this,function(t){switch(t.label){case 0:e=y,n=[],r=[],i=0,o=v,t.label=1;case 1:return i<o.length?(s=o[i],u=void 0,(a=e.Kc.get(s))&&0!==a.length?[4,Oh(e.La,_u(a[0]))]:[3,7]):[3,13];case 2:u=t.sent(),c=0,h=a,t.label=3;case 3:return c<h.length?(f=h[c],l=e.jc.get(f),[4,function(i,o){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return[4,Ch((e=i).La,o.query,!0)];case 1:return n=t.sent(),r=o.view.Mc(n),[2,(e.el&&e.il(o.targetId,r.$c),r)]}})})}(e,l)]):[3,6];case 4:(p=t.sent()).snapshot&&r.push(p.snapshot),t.label=5;case 5:return c++,[3,3];case 6:return[3,11];case 7:return[4,Vh(e.La,s)];case 8:return d=t.sent(),[4,Oh(e.La,d)];case 9:return u=t.sent(),[4,e.sl(Bf(d),s,!1)];case 10:t.sent(),t.label=11;case 11:n.push(u),t.label=12;case 12:return i++,[3,1];case 13:return[2,(e.Wc.Ea(r),n)]}})})}function Bf(t){return bu(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function zf(s,u,a,c){return g(this,void 0,void 0,function(){var n,i,o;return w(this,function(t){switch(t.label){case 0:return(n=s).tl?(Or("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!n.Kc.has(u))return[3,8];switch(a){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,(r=n.La,e=r.Ah,r.persistence.runTransaction("Get new document changes","readonly",function(t){return e.Ur(t,r.mh)}).then(function(t){var e=t.Qr,n=t.readTime;return r.mh=n,e}))];case 3:return i=t.sent(),o=io.zt(u,"current"===a),[4,n.hl(i,o)];case 4:return t.sent(),[3,8];case 5:return[4,Ph(n.La,u,!0)];case 6:return t.sent(),n.rl(u,c),[3,8];case 7:Ur(),t.label=8;case 8:return[2]}var r,e})})}function Hf(){this.Pl=void 0,this.listeners=[]}var Wf,Kf=(nl.prototype.listen=function(u){return g(this,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:if(e=u.query,n=!1,(r=this.gl.get(e))||(n=!0,r=new Hf),!n)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),i=r,[4,this.fu.listen(e)];case 2:return i.Pl=t.sent(),[3,4];case 3:return o=t.sent(),s=Za(o,"Initialization of query '"+Ru(u.query)+"' failed"),[2,void u.onError(s)];case 4:return this.gl.set(e,r),r.listeners.push(u),u.xc(this.onlineState),r.Pl&&u.yl(r.Pl)&&this.pl(),[2]}})})},nl.prototype.lu=function(o){return g(this,void 0,void 0,function(){var e,n,r,i;return w(this,function(t){return e=o.query,n=!1,(r=this.gl.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?[2,(this.gl.delete(e),this.fu.lu(e))]:[2]})})},nl.prototype.Ea=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.gl.get(o);if(s){for(var u=0,a=s.listeners;u<a.length;u++)a[u].yl(i)&&(e=!0);s.Pl=i}}e&&this.pl()},nl.prototype.dl=function(t,e){var n=this.gl.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.gl.delete(t)},nl.prototype.al=function(i){this.onlineState=i;var o=!1;this.gl.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].xc(i)&&(o=!0)}),o&&this.pl()},nl.prototype.bl=function(t){this.Vl.add(t),t.next()},nl.prototype.vl=function(t){this.Vl.delete(t)},nl.prototype.pl=function(){this.Vl.forEach(function(t){t.next()})},nl),Yf=(el.prototype.yl=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new ro(t.query,t.docs,t.Lt,e,t.qt,t.fromCache,t.Bt,!0)}var o=!1;return this.Dl?this.Nl(t)&&(this.Sl.next(t),o=!0):this.Fl(t,this.onlineState)&&(this.kl(t),o=!0),this.Cl=t,o},el.prototype.onError=function(t){this.Sl.error(t)},el.prototype.xc=function(t){this.onlineState=t;var e=!1;return this.Cl&&!this.Dl&&this.Fl(this.Cl,t)&&(this.kl(this.Cl),e=!0),e},el.prototype.Fl=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.$l&&n||t.docs._()&&"Offline"!==e)},el.prototype.Nl=function(t){if(0<t.docChanges.length)return!0;var e=this.Cl&&this.Cl.hasPendingWrites!==t.hasPendingWrites;return!(!t.Bt&&!e)&&!0===this.options.includeMetadataChanges},el.prototype.kl=function(t){t=ro.Qt(t.query,t.docs,t.qt,t.fromCache),this.Dl=!0,this.Sl.next(t)},el),Xf=(tl.prototype.Ph=function(t){this.xl=t},tl.prototype.ns=function(e,r,i,o){var s=this;return r.hn()||i.isEqual(ii.min())?this.Ol(e,r):this.xl.Zn(e,o).next(function(t){var n=s.Ml(r,t);return(r.an()||r.un())&&s.Nc(r.nn,n,o,i)?s.Ol(e,r):(xr()<=l.DEBUG&&Or("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Ru(r)),s.xl.ns(e,r,i).next(function(e){return n.forEach(function(t){e=e.st(t.key,t)}),e}))})},tl.prototype.Ml=function(n,t){var r=new Gi(xu(n));return t.forEach(function(t,e){e instanceof fu&&Lu(n,e)&&(r=r.add(e))}),r},tl.prototype.Nc=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.o(r))},tl.prototype.Ol=function(t,e){return xr()<=l.DEBUG&&Or("IndexFreeQueryEngine","Using full collection scan to execute query:",Ru(e)),this.xl.ns(t,e,ii.min())},tl),Qf=($f.prototype.Ir=function(t){return la.resolve(0===this.Gn.length)},$f.prototype.mr=function(t,e,n,r){var i=this.Ll;this.Ll++,0<this.Gn.length&&this.Gn[this.Gn.length-1];var o=new ha(i,e,n,r);this.Gn.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.ql=this.ql.add(new Fh(a.key,i)),this.zn.Ar(t,a.key.path.p())}return la.resolve(o)},$f.prototype.Rr=function(t,e){return la.resolve(this.Bl(e))},$f.prototype.gr=function(t,e){var n=e+1,r=this.Ul(n),i=r<0?0:r;return la.resolve(this.Gn.length>i?this.Gn[i]:null)},$f.prototype.Vr=function(){return la.resolve(0===this.Gn.length?-1:this.Ll-1)},$f.prototype.yr=function(t){return la.resolve(this.Gn.slice())},$f.prototype.Yn=function(t,e){var n=this,r=new Fh(e,0),i=new Fh(e,Number.POSITIVE_INFINITY),o=[];return this.ql.St([r,i],function(t){var e=n.Bl(t.kh);o.push(e)}),la.resolve(o)},$f.prototype.es=function(t,e){var r=this,i=new Gi(Gr);return e.forEach(function(t){var e=new Fh(t,0),n=new Fh(t,Number.POSITIVE_INFINITY);r.ql.St([e,n],function(t){i=i.add(t.kh)})}),la.resolve(this.Ql(i))},$f.prototype.as=function(t,e){var n=e.path,r=n.length+1,i=n;ci.j(i)||(i=i.child(""));var o=new Fh(new ci(i),0),s=new Gi(Gr);return this.ql.Dt(function(t){var e=t.key.path;return!!n.D(e)&&(e.length===r&&(s=s.add(t.kh)),!0)},o),la.resolve(this.Ql(s))},$f.prototype.Ql=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.Bl(t);null!==e&&r.push(e)}),r},$f.prototype.br=function(n,r){var i=this;Mr(0===this.Wl(r.batchId,"removed")),this.Gn.shift();var o=this.ql;return la.forEach(r.mutations,function(t){var e=new Fh(t.key,r.batchId);return o=o.delete(e),i.dr.Dr(n,t.key)}).next(function(){i.ql=o})},$f.prototype.Sr=function(t){},$f.prototype.Nr=function(t,e){var n=new Fh(e,0),r=this.ql.Ct(n);return la.resolve(e.isEqual(r&&r.key))},$f.prototype.Cr=function(t){return this.Gn.length,la.resolve()},$f.prototype.Wl=function(t,e){return this.Ul(t)},$f.prototype.Ul=function(t){return 0===this.Gn.length?0:t-this.Gn[0].batchId},$f.prototype.Bl=function(t){var e=this.Ul(t);return e<0||e>=this.Gn.length?null:this.Gn[e]},$f),Zf=(Jf.prototype.xn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.jl(e);return this.docs=this.docs.st(r,{Or:e,size:s,readTime:n}),this.size+=s-o,this.zn.Ar(t,r.path.p())},Jf.prototype.Mn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Jf.prototype.Ln=function(t,e){var n=this.docs.get(e);return la.resolve(n?n.Or:null)},Jf.prototype.getEntries=function(t,e){var n=this,r=zi;return e.forEach(function(t){var e=n.docs.get(t);r=r.st(t,e?e.Or:null)}),la.resolve(r)},Jf.prototype.ns=function(t,e,n){for(var r=Ki,i=new ci(e.path.child("")),o=this.docs.ct(i);o.Tt();){var s=o.wt(),u=s.key,a=s.value,c=a.Or,h=a.readTime;if(!e.path.D(u.path))break;h.o(n)<=0||c instanceof fu&&Lu(e,c)&&(r=r.st(c.key,c))}return la.resolve(r)},Jf.prototype.Kl=function(t,e){return la.forEach(this.docs,function(t){return e(t)})},Jf.prototype.jr=function(t){return new Jf.Kr(this)},Jf.prototype.zr=function(t){return la.resolve(this.size)},Jf);function Jf(t,e){this.zn=t,this.jl=e,this.docs=new Ci(ci.P),this.size=0}function $f(t,e){this.zn=t,this.dr=e,this.Gn=[],this.Ll=1,this.ql=new Gi(Fh.yh)}function tl(){}function el(t,e,n){this.query=t,this.Sl=e,this.Dl=!1,this.Cl=null,this.onlineState="Unknown",this.options=n||{}}function nl(t){this.fu=t,this.gl=new ti(ku,Du),this.onlineState="Unknown",this.Vl=new Set,this.fu.subscribe(this)}function rl(t){var e=this;return(e=Wf.call(this)||this).Hr=t,e}Zf.Kr=(o(rl,Wf=pa),rl.prototype.Un=function(n){var r=this,i=[];return this.Fn.forEach(function(t,e){e?i.push(r.Hr.xn(n,e,r.readTime)):r.Hr.Mn(t)}),la.Cn(i)},rl.prototype.qn=function(t,e){return this.Hr.Ln(t,e)},rl.prototype.Bn=function(t,e){return this.Hr.getEntries(t,e)},rl);var il,ol,sl=(Tl.prototype.be=function(t,n){return this.Gl.forEach(function(t,e){return n(e)}),la.resolve()},Tl.prototype.ro=function(t){return la.resolve(this.lastRemoteSnapshotVersion)},Tl.prototype.oo=function(t){return la.resolve(this.zl)},Tl.prototype.no=function(t){return this.highestTargetId=this.Yl.next(),la.resolve(this.highestTargetId)},Tl.prototype.ho=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.zl&&(this.zl=e),la.resolve()},Tl.prototype.uo=function(t){this.Gl.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Yl=new ch(e),this.highestTargetId=e),t.sequenceNumber>this.zl&&(this.zl=t.sequenceNumber)},Tl.prototype.ao=function(t,e){return this.uo(e),this.targetCount+=1,la.resolve()},Tl.prototype.lo=function(t,e){return this.uo(e),la.resolve()},Tl.prototype._o=function(t,e){return this.Gl.delete(e.target),this.Hl.Ch(e.targetId),--this.targetCount,la.resolve()},Tl.prototype.hr=function(n,r,i){var o=this,s=0,u=[];return this.Gl.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.Gl.delete(t),u.push(o.fo(n,e.targetId)),s++)}),la.Cn(u).next(function(){return s})},Tl.prototype.do=function(t){return la.resolve(this.targetCount)},Tl.prototype.wo=function(t,e){var n=this.Gl.get(e)||null;return la.resolve(n)},Tl.prototype.To=function(t,e,n){return this.Hl.vh(e,n),la.resolve()},Tl.prototype.Io=function(e,t,n){this.Hl.Dh(t,n);var r=this.persistence.dr,i=[];return r&&t.forEach(function(t){i.push(r.Dr(e,t))}),la.Cn(i)},Tl.prototype.fo=function(t,e){return this.Hl.Ch(e),la.resolve()},Tl.prototype.Ao=function(t,e){var n=this.Hl.Fh(e);return la.resolve(n)},Tl.prototype.Nr=function(t,e){return la.resolve(this.Hl.Nr(e))},Tl),ul=(Il.prototype.start=function(){return Promise.resolve()},Il.prototype.th=function(){return this.po=!1,Promise.resolve()},Object.defineProperty(Il.prototype,"tr",{get:function(){return this.po},enumerable:!1,configurable:!0}),Il.prototype.Bo=function(){},Il.prototype.Uo=function(){},Il.prototype.uh=function(){return this.zn},Il.prototype.oh=function(t){var e=this.Jl[t.$h()];return e||(e=new Qf(this.zn,this.dr),this.Jl[t.$h()]=e),e},Il.prototype.hh=function(){return this.ko},Il.prototype.ah=function(){return this.Kn},Il.prototype.runTransaction=function(t,e,n){var r=this;Or("MemoryPersistence","Starting transaction:",t);var i=new al(this.yo.next());return this.dr.Zl(),n(i).next(function(t){return r.dr.t_(i).next(function(){return t})}).Sn().then(function(t){return i.jn(),t})},Il.prototype.e_=function(e,n){return la.Nn(Object.values(this.Jl).map(function(t){return function(){return t.Nr(e,n)}}))},Il),al=(o(El,ol=ya),El),cl=(bl.i_=function(t){return new bl(t)},Object.defineProperty(bl.prototype,"r_",{get:function(){if(this.s_)return this.s_;throw Ur()},enumerable:!1,configurable:!0}),bl.prototype.Eo=function(t,e,n){return this.n_.Eo(n,e),this.r_.delete(n.toString()),la.resolve()},bl.prototype.mo=function(t,e,n){return this.n_.mo(n,e),this.r_.add(n.toString()),la.resolve()},bl.prototype.Dr=function(t,e){return this.r_.add(e.toString()),la.resolve()},bl.prototype.removeTarget=function(t,e){var n=this;this.n_.Ch(e.targetId).forEach(function(t){return n.r_.add(t.toString())});var r=this.persistence.hh();return r.Ao(t,e.targetId).next(function(t){t.forEach(function(t){return n.r_.add(t.toString())})}).next(function(){return r._o(t,e)})},bl.prototype.Zl=function(){this.s_=new Set},bl.prototype.t_=function(n){var r=this,i=this.persistence.ah().jr();return la.forEach(this.r_,function(t){var e=ci.B(t);return r.o_(n,e).next(function(t){t||i.Mn(e)})}).next(function(){return r.s_=null,i.apply(n)})},bl.prototype.wh=function(t,e){var n=this;return this.o_(t,e).next(function(t){t?n.r_.delete(e.toString()):n.r_.add(e.toString())})},bl.prototype.Xl=function(t){return 0},bl.prototype.o_=function(t,e){var n=this;return la.Nn([function(){return la.resolve(n.n_.Nr(e))},function(){return n.persistence.hh().Nr(t,e)},function(){return n.persistence.e_(t,e)}])},bl),hl=(wl.prototype.wa=function(t){this.u_=t},wl.prototype.ca=function(t){this.c_=t},wl.prototype.onMessage=function(t){this.l_=t},wl.prototype.close=function(){this.a_()},wl.prototype.send=function(t){this.h_(t)},wl.prototype.__=function(){this.u_()},wl.prototype.f_=function(t){this.c_(t)},wl.prototype.d_=function(t){this.l_(t)},wl),fl={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},ll=(ml.prototype.va=function(e,t,n,r){var i=this.I_(e,t);Or("RestConnection","Sending: ",i,n);var o={};return this.m_(o,r),this.A_(e,i,o,n).then(function(t){return Or("RestConnection","Received: ",t),t},function(t){throw Cr("RestConnection",e+" failed with error: ",t,"url: ",i,"request:",n),t})},ml.prototype.Sa=function(t,e,n,r){return this.va(t,e,n,r)},ml.prototype.m_=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.19.1",t["Content-Type"]="text/plain",e)for(var n in e.Mh)e.Mh.hasOwnProperty(n)&&(t[n]=e.Mh[n])},ml.prototype.I_=function(t,e){var n=fl[t];return this.T_+"/v1/"+e+":"+n},o(gl,il=ml),gl.prototype.A_=function(a,e,n,r){return new Promise(function(o,s){var u=new Dr;u.listenOnce(Ar.COMPLETE,function(){try{switch(u.getLastErrorCode()){case Nr.NO_ERROR:var t=u.getResponseJson();Or("Connection","XHR received:",JSON.stringify(t)),o(t);break;case Nr.TIMEOUT:Or("Connection",'RPC "'+a+'" timed out'),s(new ni(ei.DEADLINE_EXCEEDED,"Request time out"));break;case Nr.HTTP_ERROR:var e,n,r=u.getStatus();Or("Connection",'RPC "'+a+'" failed with status:',r,"response text:",u.getResponseText()),0<r?(e=u.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace("_","-"),n=0<=Object.values(ei).indexOf(i)?i:ei.UNKNOWN,s(new ni(n,e.message))):s(new ni(ei.UNKNOWN,"Server responded with status "+u.getStatus())):s(new ni(ei.UNAVAILABLE,"Connection failed."));break;default:Ur()}}finally{Or("Connection",'RPC "'+a+'" completed.')}var i});var t=JSON.stringify(r);u.send(e,"POST",t,n,15)})},gl.prototype.Ta=function(t,e){var n,r,i=[this.T_,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=_r(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.m_(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(y())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=y().indexOf("Electron/")||0<=(r=y()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=y().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){c.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Or("Connection","Creating WebChannel: "+u,s);var c=o.createWebChannel(u,s),h=!1,f=!1,l=new hl({h_:function(t){f?Or("Connection","Not sending because WebChannel is closed:",t):(h||(Or("Connection","Opening WebChannel transport."),c.open(),h=!0),Or("Connection","WebChannel sending:",t),c.send(t))},a_:function(){return c.close()}});return a(Sr.EventType.OPEN,function(){f||Or("Connection","WebChannel transport opened.")}),a(Sr.EventType.CLOSE,function(){f||(f=!0,Or("Connection","WebChannel transport closed"),l.f_())}),a(Sr.EventType.ERROR,function(t){f||(f=!0,Cr("Connection","WebChannel transport errored:",t),l.f_(new ni(ei.UNAVAILABLE,"The operation could not be completed")))}),a(Sr.EventType.MESSAGE,function(t){var e,n,r,i,o,s;f||(Mr(!!(n=t.data[0])),(r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error))?(Or("Connection","WebChannel received error:",r),i=r.status,o=function(){var t=ki[i];if(void 0!==t)return Pi(t)}(),s=r.message,void 0===o&&(o=ei.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.f_(new ni(o,s)),c.close()):(Or("Connection","WebChannel received:",n),l.d_(n)))}),setTimeout(function(){l.__()},0),l},gl),pl=(vl.prototype.Ka=function(t){this.y_.push(t)},vl.prototype.th=function(){window.removeEventListener("online",this.R_),window.removeEventListener("offline",this.g_)},vl.prototype.p_=function(){window.addEventListener("online",this.R_),window.addEventListener("offline",this.g_)},vl.prototype.P_=function(){Or("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.y_;t<e.length;t++)(0,e[t])(0)},vl.prototype.V_=function(){Or("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.y_;t<e.length;t++)(0,e[t])(1)},vl.ks=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},vl),dl=(yl.prototype.Ka=function(t){},yl.prototype.th=function(){},yl);function yl(){}function vl(){var t=this;this.R_=function(){return t.P_()},this.g_=function(){return t.V_()},this.y_=[],this.p_()}function gl(t){var e=this;return(e=il.call(this,t)||this).forceLongPolling=t.forceLongPolling,e}function ml(t){this.w_=t,this.s=t.s;var e=t.ssl?"https":"http";this.T_=e+"://"+t.host,this.E_="projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents"}function wl(t){this.h_=t.h_,this.a_=t.a_}function bl(t){this.persistence=t,this.n_=new Mh,this.s_=null}function El(t){var e=this;return(e=ol.call(this)||this).Ro=t,e}function Il(t){var e=this;this.Jl={},this.yo=new ma(0),this.po=!1,this.po=!0,this.dr=t(this),this.ko=new sl(this),this.zn=new Uc,this.Kn=new Zf(this.zn,function(t){return e.dr.Xl(t)})}function Tl(t){this.persistence=t,this.Gl=new ti(Ti,_i),this.lastRemoteSnapshotVersion=ii.min(),this.highestTargetId=0,this.zl=0,this.Hl=new Mh,this.targetCount=0,this.Yl=ch.to()}function _l(t){return new Mo(t,!0)}var Nl,Al,Sl="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",Dl=(Pl.prototype.initialize=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Uc=this.b_(e),this.persistence=this.v_(e),[4,this.persistence.start()];case 1:return t.sent(),this.S_=this.D_(e),this.La=this.C_(e),[2]}})})},Pl.prototype.D_=function(t){return null},Pl.prototype.C_=function(t){return e=this.persistence,n=new Xf,r=t.N_,new Dh(e,n,r);var e,n,r},Pl.prototype.v_=function(t){if(t.k_.F_)throw new ni(ei.FAILED_PRECONDITION,Sl);return new ul(cl.i_)},Pl.prototype.b_=function(t){return new Df},Pl.prototype.terminate=function(){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.S_&&this.S_.stop(),[4,this.Uc.th()];case 1:return t.sent(),[4,this.persistence.th()];case 2:return t.sent(),[2]}})})},Pl.prototype.clearPersistence=function(t,e){throw new ni(ei.FAILED_PRECONDITION,Sl)},Pl),kl=(o(Ol,Al=Dl),Ol.prototype.initialize=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,Al.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,function(r){return g(this,void 0,void 0,function(){var e,n;return w(this,function(t){return n=(e=r).Ah,[2,e.persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.Wr(t)}).then(function(t){e.mh=t})]})})}(this.La)];case 2:return t.sent(),[2]}})})},Ol.prototype.D_=function(t){var e=this.persistence.dr.Yi;return new ic(e,t.ei)},Ol.prototype.v_=function(t){var e=Sh(t.w_.s,t.w_.persistenceKey),n=_l(t.w_.s);return new wh(t.k_.synchronizeTabs,e,t.clientId,ec.Ui(t.k_.cacheSizeBytes),t.ei,Ha(),Wa(),n,this.Uc,t.k_.Vo)},Ol.prototype.b_=function(t){return new Df},Ol.prototype.clearPersistence=function(t,e){return function(n){return g(this,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return Ra.ks()?(e=n+"main",[4,Ra.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})}(Sh(t,e))},o(xl,Nl=Ol),xl.prototype.initialize=function(r){return g(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:return[4,Nl.prototype.initialize.call(this,r)];case 1:return t.sent(),[4,this.x_.initialize(this,r)];case 2:return t.sent(),e=this.x_.fu,this.Uc instanceof Sf?(this.Uc.fu={Ic:qf.bind(null,e),mc:zf.bind(null,e),Ac:function(f,l,p){return g(this,void 0,void 0,function(){var n,e,r,i,o,s,u,a,c,h;return w(this,function(t){switch(t.label){case 0:if(!(n=f).tl)return[3,10];e=0,r=l,t.label=1;case 1:return e<r.length?(i=r[e],n.Kc.has(i)?(Or("SyncEngine","Adding an already active target "+i),[3,5]):[4,Vh(n.La,i)]):[3,6];case 2:return o=t.sent(),[4,Oh(n.La,o)];case 3:return s=t.sent(),[4,n.sl(Bf(o),s.targetId,!1)];case 4:t.sent(),n.Bc.listen(s),t.label=5;case 5:return e++,[3,1];case 6:u=function(e){return w(this,function(t){switch(t.label){case 0:return n.Kc.has(e)?[4,Ph(n.La,e,!1).then(function(){n.Bc.lu(e),n.rl(e)}).catch(Uh)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},a=0,c=p,t.label=7;case 7:return a<c.length?(h=c[a],[5,u(h)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})}.bind(null,e),rh:function(t){return t.La.persistence.rh()}.bind(null,e)},[4,this.Uc.start()]):[3,4];case 3:t.sent(),t.label=4;case 4:return[4,this.persistence.qo(function(e){return g(n,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,jf(this.x_.fu,e)];case 1:return t.sent(),this.S_&&(e&&!this.S_.tr?this.S_.start(this.La):e||this.S_.stop()),[2]}})})})];case 5:return t.sent(),[2]}})})},xl.prototype.b_=function(t){if(t.k_.F_&&t.k_.synchronizeTabs){var e=Ha();if(!Sf.ks(e))throw new ni(ei.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Sh(t.w_.s,t.w_.persistenceKey);return new Sf(e,t.ei,n,t.clientId,t.N_)}return new Df},xl),Rl=(Ll.prototype.initialize=function(n,r){return g(this,void 0,void 0,function(){var e=this;return w(this,function(t){switch(t.label){case 0:return this.La?[3,3]:(this.La=n.La,this.Uc=n.Uc,this.qa=this.O_(r),this.Bc=this.M_(r),this.fu=this.L_(r),this.q_=this.B_(r),this.Uc.Da=function(t){return e.fu.xc(t,1)},this.Bc.fu=this.fu,[4,this.Bc.start()]);case 1:return t.sent(),[4,this.Bc.Su(this.fu.el)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Ll.prototype.B_=function(t){return new Kf(this.fu)},Ll.prototype.O_=function(t){var e,n,r=_l(t.w_.s),i=(e=t.w_,new ll(e));return n=t.credentials,new ef(n,i,r)},Ll.prototype.M_=function(t){var e=this;return new rf(this.La,this.qa,t.ei,function(t){return e.fu.xc(t,0)},new(pl.ks()?pl:dl))},Ll.prototype.L_=function(t){return e=this.La,n=this.Bc,r=this.qa,i=this.Uc,o=t.N_,s=t.Qc,u=!t.k_.F_||!t.k_.synchronizeTabs,a=new Rf(e,n,r,i,o,s),u&&(a.tl=!0),a;var e,n,r,i,o,s,u,a},Ll.prototype.terminate=function(){return this.Bc.th()},Ll);function Ll(){}function xl(t){var e=this;return(e=Nl.call(this)||this).x_=t,e}function Ol(){return null!==Al&&Al.apply(this,arguments)||this}function Pl(){}function Cl(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Vl=(Ul.prototype.next=function(t){this.observer.next&&this.U_(this.observer.next,t)},Ul.prototype.error=function(t){this.observer.error?this.U_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},Ul.prototype.Q_=function(){this.muted=!0},Ul.prototype.U_=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},Ul);function Ul(t){this.observer=t,this.muted=!1}function Ml(t,e){if(0!==e.length)throw new ni(ei.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+np(e.length,"argument")+".")}function Fl(t,e,n){if(e.length!==n)throw new ni(ei.INVALID_ARGUMENT,"Function "+t+"() requires "+np(n,"argument")+", but was called with "+np(e.length,"argument")+".")}function ql(t,e,n){if(e.length<n)throw new ni(ei.INVALID_ARGUMENT,"Function "+t+"() requires at least "+np(n,"argument")+", but was called with "+np(e.length,"argument")+".")}function jl(t,e,n,r){if(e.length<n||e.length>r)throw new ni(ei.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+np(e.length,"argument")+".")}function Gl(t,e,n,r){Yl(t,e,ep(n)+" argument",r)}function Bl(t,e,n,r){void 0!==r&&Gl(t,e,n,r)}function zl(t,e,n,r){Yl(t,e,n+" option",r)}function Hl(t,e,n,r){void 0!==r&&zl(t,e,n,r)}function Wl(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(Ql(s))}var u=Ql(n);throw new ni(ei.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function Kl(t,e,n,r){if(!e.some(function(t){return t===r}))throw new ni(ei.INVALID_ARGUMENT,"Invalid value "+Ql(r)+" provided to function "+t+"() for its "+ep(n)+" argument. Acceptable values: "+e.join(", "));return r}function Yl(t,e,n,r){if(!("object"===e?Xl(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Ql(r);throw new ni(ei.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Xl(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Ql(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Ur();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Zl(t,e,n){if(void 0===n)throw new ni(ei.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+ep(e)+" argument, but it was undefined.")}function Jl(n,t,r){Xr(t,function(t,e){if(r.indexOf(t)<0)throw new ni(ei.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function $l(t,e,n,r){var i=Ql(r);return new ni(ei.INVALID_ARGUMENT,"Function "+t+"() requires its "+ep(n)+" argument to be a "+e+", but it was: "+i)}function tp(t,e,n){if(n<=0)throw new ni(ei.INVALID_ARGUMENT,"Function "+t+"() requires its "+ep(e)+" argument to be a positive number, but it was: "+n+".")}function ep(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function np(t,e){return t+" "+e+(1===t?"":"s")}function rp(){if("undefined"==typeof Uint8Array)throw new ni(ei.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function ip(){if("undefined"==typeof atob)throw new ni(ei.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var op,sp,up=(yp.fromBase64String=function(t){Fl("Blob.fromBase64String",arguments,1),Gl("Blob.fromBase64String","string",1,t),ip();try{return new yp(Ai.fromBase64String(t))}catch(t){throw new ni(ei.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},yp.fromUint8Array=function(t){if(Fl("Blob.fromUint8Array",arguments,1),rp(),!(t instanceof Uint8Array))throw $l("Blob.fromUint8Array","Uint8Array",1,t);return new yp(Ai.fromUint8Array(t))},yp.prototype.toBase64=function(){return Fl("Blob.toBase64",arguments,0),ip(),this.W_.toBase64()},yp.prototype.toUint8Array=function(){return Fl("Blob.toUint8Array",arguments,0),rp(),this.W_.toUint8Array()},yp.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},yp.prototype.isEqual=function(t){return this.W_.isEqual(t.W_)},yp),ap=function(t){!function(){if(!(t instanceof Array)||t.length<1)throw new ni(ei.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var e=0;e<t.length;++e)if(Gl("FieldPath","string",e,t[e]),0===t[e].length)throw new ni(ei.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.j_=new ai(t)},cp=(o(dp,sp=ap),dp.documentId=function(){return new dp(ai.L().F())},dp.prototype.isEqual=function(t){if(!(t instanceof dp))throw $l("isEqual","FieldPath",1,t);return this.j_.isEqual(t.j_)},dp),hp=new RegExp("[~\\*/\\[\\]]"),fp=function(){this.K_=this},lp=(o(pp,op=fp),pp.prototype.z_=function(t){if(2!==t.H_)throw 1===t.H_?t.Y_(this.G_+"() can only appear at the top level of your update data"):t.Y_(this.G_+"() cannot be used with set() unless you pass {merge:true}");return t.qe.push(t.path),null},pp.prototype.isEqual=function(t){return t instanceof pp},pp);function pp(t){var e=this;return(e=op.call(this)||this).G_=t,e}function dp(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return sp.call(this,t)||this}function yp(t){ip(),this.W_=t}function vp(t,e,n){return new zp({H_:3,J_:e.settings.J_,methodName:t.G_,X_:n},e.s,e.serializer,e.ignoreUndefinedProperties)}var gp,mp,wp,bp,Ep,Ip,Tp=(o(Gp,Ip=fp),Gp.prototype.z_=function(t){return new Ds(t.path,new ps)},Gp.prototype.isEqual=function(t){return t instanceof Gp},Gp),_p=(o(jp,Ep=fp),jp.prototype.z_=function(t){var e=vp(this,t,!0),n=this.Z_.map(function(t){return Jp(t,e)}),r=new ds(n);return new Ds(t.path,r)},jp.prototype.isEqual=function(t){return this===t},jp),Np=(o(qp,bp=fp),qp.prototype.z_=function(t){var e=vp(this,t,!0),n=this.Z_.map(function(t){return Jp(t,e)}),r=new ws(n);return new Ds(t.path,r)},qp.prototype.isEqual=function(t){return this===t},qp),Ap=(o(Fp,wp=fp),Fp.prototype.z_=function(t){var e=new Ts(t.serializer,jo(t.serializer,this.tf));return new Ds(t.path,e)},Fp.prototype.isEqual=function(t){return this===t},Fp),Sp=(o(Mp,mp=fp),Mp.delete=function(){return Ml("FieldValue.delete",arguments),new Dp(new lp("FieldValue.delete"))},Mp.serverTimestamp=function(){return Ml("FieldValue.serverTimestamp",arguments),new Dp(new Tp("FieldValue.serverTimestamp"))},Mp.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ql("FieldValue.arrayUnion",arguments,1),new Dp(new _p("FieldValue.arrayUnion",t))},Mp.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return ql("FieldValue.arrayRemove",arguments,1),new Dp(new Np("FieldValue.arrayRemove",t))},Mp.increment=function(t){return Gl("FieldValue.increment","number",1,t),Fl("FieldValue.increment",arguments,1),new Dp(new Ap("FieldValue.increment",t))},Mp),Dp=(o(Up,gp=Sp),Up.prototype.z_=function(t){return this.K_.z_(t)},Up.prototype.isEqual=function(t){return t instanceof Up&&this.K_.isEqual(t.K_)},Up),kp=(Object.defineProperty(Vp.prototype,"latitude",{get:function(){return this.ef},enumerable:!1,configurable:!0}),Object.defineProperty(Vp.prototype,"longitude",{get:function(){return this.nf},enumerable:!1,configurable:!0}),Vp.prototype.isEqual=function(t){return this.ef===t.ef&&this.nf===t.nf},Vp.prototype.toJSON=function(){return{latitude:this.ef,longitude:this.nf}},Vp.prototype.T=function(t){return Gr(this.ef,t.ef)||Gr(this.nf,t.nf)},Vp),Rp=/^__.*__$/,Lp=function(t,e,n){this.sf=t,this.if=e,this.rf=n},xp=(Cp.prototype.hf=function(t,e){var n=[];return null!==this.qe?n.push(new Gs(t,this.data,this.qe,e)):n.push(new js(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Ks(t,this.fieldTransforms)),n},Cp),Op=(Pp.prototype.hf=function(t,e){var n=[new Gs(t,this.data,this.qe,e)];return 0<this.fieldTransforms.length&&n.push(new Ks(t,this.fieldTransforms)),n},Pp);function Pp(t,e,n){this.data=t,this.qe=e,this.fieldTransforms=n}function Cp(t,e,n){this.data=t,this.qe=e,this.fieldTransforms=n}function Vp(t,e){if(Fl("GeoPoint",arguments,2),Gl("GeoPoint","number",1,t),Gl("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new ni(ei.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new ni(ei.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.ef=t,this.nf=e}function Up(t){var e=this;return(e=gp.call(this)||this).K_=t,e.G_=t.G_,e}function Mp(){return mp.call(this)||this}function Fp(t,e){var n=this;return(n=wp.call(this)||this).G_=t,n.tf=e,n}function qp(t,e){var n=this;return(n=bp.call(this)||this).G_=t,n.Z_=e,n}function jp(t,e){var n=this;return(n=Ep.call(this)||this).G_=t,n.Z_=e,n}function Gp(t){var e=this;return(e=Ip.call(this)||this).G_=t,e}function Bp(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Ur()}}var zp=(Object.defineProperty(Kp.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(Kp.prototype,"H_",{get:function(){return this.settings.H_},enumerable:!1,configurable:!0}),Kp.prototype.uf=function(t){return new Kp(Object.assign(Object.assign({},this.settings),t),this.s,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.qe)},Kp.prototype.cf=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.uf({path:n,X_:!1});return r.lf(t),r},Kp.prototype._f=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.uf({path:n,X_:!1});return r.af(),r},Kp.prototype.ff=function(t){return this.uf({path:void 0,X_:!0})},Kp.prototype.Y_=function(t){return id(t,this.settings.methodName,this.settings.df||!1,this.path,this.settings.J_)},Kp.prototype.contains=function(e){return void 0!==this.qe.find(function(t){return e.D(t)})||void 0!==this.fieldTransforms.find(function(t){return e.D(t.field)})},Kp.prototype.af=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.lf(this.path.get(t))},Kp.prototype.lf=function(t){if(0===t.length)throw this.Y_("Document fields must not be empty");if(Bp(this.H_)&&Rp.test(t))throw this.Y_('Document fields cannot begin and end with "__"')},Kp),Hp=(Wp.prototype.wf=function(t,e,n,r){return void 0===r&&(r=!1),new zp({H_:t,methodName:e,J_:n,path:ai.$(),X_:!1,df:r},this.s,this.serializer,this.ignoreUndefinedProperties)},Wp);function Wp(t,e,n){this.s=t,this.ignoreUndefinedProperties=e,this.serializer=n||_l(t)}function Kp(t,e,n,r,i,o){this.settings=t,this.s=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.af(),this.fieldTransforms=i||[],this.qe=o||[]}function Yp(t,e,n,r,i,o){void 0===o&&(o={});var s=t.wf(o.merge||o.mergeFields?2:0,e,n,i);ed("Data must be an object, but it was:",s,r);var u,a,c=$p(r,s);if(o.merge)u=new Ss(s.qe),a=s.fieldTransforms;else if(o.mergeFields){for(var h=[],f=0,l=o.mergeFields;f<l.length;f++){var p=l[f],d=void 0;if(p instanceof ap)d=p.j_;else{if("string"!=typeof p)throw Ur();d=rd(e,p,n)}if(!s.contains(d))throw new ni(ei.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");od(h,d)||h.push(d)}u=new Ss(h),a=s.fieldTransforms.filter(function(t){return u.Ke(t.field)})}else u=null,a=s.fieldTransforms;return new xp(new tu(c),u,a)}function Xp(t,o,s,e){var u=t.wf(1,o,s);ed("Data must be an object, but it was:",u,e);var a=[],c=new eu;Xr(e,function(t,e){var n,r=rd(o,t,s),i=u._f(r);e instanceof fp&&e.K_ instanceof lp?a.push(r):null!=(n=Jp(e,i))&&(a.push(r),c.set(r,n))});var n=new Ss(a);return new Op(c.ze(),n,u.fieldTransforms)}function Qp(t,e,n,r,i,o){var s=t.wf(1,e,n),u=[nd(e,r,n)],a=[i];if(o.length%2!=0)throw new ni(ei.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)u.push(nd(e,o[c])),a.push(o[c+1]);for(var h,f,l,p,d=[],y=new eu,v=u.length-1;0<=v;--v){od(d,u[v])||(h=u[v],f=a[v],l=s._f(h),f instanceof fp&&f.K_ instanceof lp?d.push(h):null!=(p=Jp(f,l))&&(d.push(h),y.set(h,p)))}var g=new Ss(d);return new Op(y.ze(),g,s.fieldTransforms)}function Zp(t,e,n,r){return void 0===r&&(r=!1),Jp(n,t.wf(r?4:3,e))}function Jp(s,t){if(td(s))return ed("Unsupported field value:",t,s),$p(s,t);if(s instanceof fp)return function(t,e){if(!Bp(e.H_))throw e.Y_(t.G_+"() can only be used with update() and set()");if(!e.path)throw e.Y_(t.G_+"() is not currently supported inside arrays");var n=t.z_(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.qe.push(t.path),s instanceof Array){if(t.settings.X_&&4!==t.H_)throw t.Y_("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Jp(i[r],t.ff(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return jo(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ri.fromDate(t);return{timestampValue:Go(e.serializer,n)}}if(t instanceof ri){var r=new ri(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Go(e.serializer,r)}}if(t instanceof kp)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof up)return{bytesValue:Bo(e.serializer,t)};if(t instanceof Lp){var i=e.s,o=t.sf;if(!o.isEqual(i))throw e.Y_("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:Ho(t.sf||e.s,t.if.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.Y_("Unsupported field value: "+Ql(t))}(s,t)}function $p(t,r){var i={};return Qr(t)?r.path&&0<r.path.length&&r.qe.push(r.path):Xr(t,function(t,e){var n=Jp(e,r.cf(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function td(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ri||t instanceof kp||t instanceof up||t instanceof Lp||t instanceof fp)}function ed(t,e,n){if(!td(n)||!Xl(n)){var r=Ql(n);throw"an object"===r?e.Y_(t+" a custom object"):e.Y_(t+" "+r)}}function nd(t,e,n){if(e instanceof ap)return e.j_;if("string"==typeof e)return rd(t,e);throw id("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function rd(t,e,n){try{return function(e){if(0<=e.search(hp))throw new ni(ei.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(cp.bind.apply(cp,s([void 0],e.split("."))))}catch(t){throw new ni(ei.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).j_}catch(e){throw id(e instanceof Error?e.message:e.toString(),t,!1,void 0,n)}}function id(t,e,n,r,i){var o=r&&!r._(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new ni(ei.INVALID_ARGUMENT,(u+=". ")+t+a)}function od(t,e){return t.some(function(t){return t.isEqual(e)})}var sd=(fd.prototype.Af=function(r){return g(this,void 0,void 0,function(){var e,n=this;return w(this,function(t){switch(t.label){case 0:if(this.Rf(),0<this.mutations.length)throw new ni(ei.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(u,a){return g(this,void 0,void 0,function(){var i,e,n,r,o,s;return w(this,function(t){switch(t.label){case 0:return e=Zo((i=u).serializer)+"/documents",n={documents:a.map(function(t){return Ko(i.serializer,t)})},[4,i.Sa("BatchGetDocuments",e,n)];case 1:return r=t.sent(),o=new Map,r.forEach(function(t){var e,n,r=(e=i.serializer,"found"in(n=t)?function(t,e){Mr(!!e.found),e.found.name,e.found.updateTime;var n=Yo(t,e.found.name),r=zo(e.found.updateTime),i=new tu({mapValue:{fields:e.found.fields}});return new fu(n,r,i,{})}(e,n):"missing"in n?function(t,e){Mr(!!e.missing),Mr(!!e.readTime);var n=Yo(t,e.missing),r=zo(e.readTime);return new lu(n,r)}(e,n):Ur());o.set(r.key.toString(),r)}),s=[],[2,(a.forEach(function(t){var e=o.get(t.toString());Mr(!!e),s.push(e)}),s)]}})})}(this.qa,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof lu||t instanceof fu?n.Pf(t):Ur()}),e)]}})})},fd.prototype.set=function(t,e){this.write(e.hf(t,this.Qe(t))),this.mf.add(t.toString())},fd.prototype.update=function(t,e){try{this.write(e.hf(t,this.gf(t)))}catch(t){this.If=t}this.mf.add(t.toString())},fd.prototype.delete=function(t){this.write([new Js(t,this.Qe(t))]),this.mf.add(t.toString())},fd.prototype.commit=function(){return g(this,void 0,void 0,function(){var e,r=this;return w(this,function(t){switch(t.label){case 0:if(this.Rf(),this.If)throw this.If;return e=this.Tf,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){var n=ci.B(e);r.mutations.push(new $s(n,r.Qe(n)))}),[4,function(i,o){return g(this,void 0,void 0,function(){var e,n,r;return w(this,function(t){switch(t.label){case 0:return n=Zo((e=i).serializer)+"/documents",r={writes:o.map(function(t){return ts(e.serializer,t)})},[4,e.va("Commit",n,r)];case 1:return t.sent(),[2]}})})}(this.qa,this.mutations)];case 1:return t.sent(),this.Ef=!0,[2]}})})},fd.prototype.Pf=function(t){var e;if(t instanceof fu)e=t.version;else{if(!(t instanceof lu))throw Ur();e=ii.min()}var n=this.Tf.get(t.key.toString());if(n){if(!e.isEqual(n))throw new ni(ei.ABORTED,"Document version changed between two reads.")}else this.Tf.set(t.key.toString(),e)},fd.prototype.Qe=function(t){var e=this.Tf.get(t.toString());return!this.mf.has(t.toString())&&e?Ls.updateTime(e):Ls.We()},fd.prototype.gf=function(t){var e=this.Tf.get(t.toString());if(this.mf.has(t.toString())||!e)return Ls.exists(!0);if(e.isEqual(ii.min()))throw new ni(ei.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ls.updateTime(e)},fd.prototype.write=function(t){this.Rf(),this.mutations=this.mutations.concat(t)},fd.prototype.Rf=function(){},fd),ud=(hd.prototype.run=function(){this.yf()},hd.prototype.yf=function(){var t=this;this.Ti.bs(function(){return g(t,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){return e=new sd(this.qa),(n=this.pf(e))&&n.then(function(t){r.ei.ai(function(){return e.commit().then(function(){r.ii.resolve(t)}).catch(function(t){r.bf(t)})})}).catch(function(t){r.bf(t)}),[2]})})})},hd.prototype.pf=function(t){try{var e=this.updateFunction(t);return!mi(e)&&e.catch&&e.then?e:(this.ii.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.ii.reject(t),null}},hd.prototype.bf=function(t){var e=this;0<this.Vf&&this.vf(t)?(--this.Vf,this.ei.ai(function(){return e.yf(),Promise.resolve()})):this.ii.reject(t)},hd.prototype.vf=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Oi(e)},hd),ad=(cd.prototype.start=function(t,e,n,r){var i=this;this.Df(),this.w_=t;var o=new Sa,s=!1;return this.credentials.Bh(function(t){if(!s)return s=!0,Or("FirestoreClient","Initializing. user=",t.uid),i.Cf(e,n,r,t,o).then(i.Sf.resolve,i.Sf.reject);i.ei.gi(function(){return i.Bc.vu(t)})}),this.ei.ai(function(){return i.Sf.promise}),o.promise},cd.prototype.enableNetwork=function(){var t=this;return this.Df(),this.ei.enqueue(function(){return t.persistence.Uo(!0),t.Bc.enableNetwork()})},cd.prototype.Cf=function(i,o,s,u,a){return g(this,void 0,void 0,function(){var e,n,r=this;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),e={ei:this.ei,w_:this.w_,clientId:this.clientId,credentials:this.credentials,N_:u,Qc:100,k_:s},[4,i.initialize(e)];case 1:return t.sent(),[4,o.initialize(i,e)];case 2:return t.sent(),this.persistence=i.persistence,this.Uc=i.Uc,this.La=i.La,this.S_=i.S_,this.qa=o.qa,this.Bc=o.Bc,this.fu=o.fu,this.Nf=o.q_,this.persistence.Bo(function(){return g(r,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),a.resolve(),[3,4];case 3:if(n=t.sent(),a.reject(n),!this.Ff(n))throw n;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+n),this.Cf(new Dl,new Rl,{F_:!1},u,a))];case 4:return[2]}})})},cd.prototype.Ff=function(t){return"FirebaseError"===t.name?t.code===ei.FAILED_PRECONDITION||t.code===ei.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},cd.prototype.Df=function(){if(this.ei.Ii)throw new ni(ei.FAILED_PRECONDITION,"The client has already been terminated.")},cd.prototype.disableNetwork=function(){var t=this;return this.Df(),this.ei.enqueue(function(){return t.persistence.Uo(!1),t.Bc.disableNetwork()})},cd.prototype.terminate=function(){var t=this;this.ei.Pi();var r=new Sa;return this.ei.mi(function(){return g(t,void 0,void 0,function(){var e,n;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),this.S_&&this.S_.stop(),[4,this.Bc.th()];case 1:return t.sent(),[4,this.Uc.th()];case 2:return t.sent(),[4,this.persistence.th()];case 3:return t.sent(),this.credentials.Uh(),r.resolve(),[3,5];case 4:return e=t.sent(),n=Za(e,"Failed to shutdown persistence"),r.reject(n),[3,5];case 5:return[2]}})})}),r.promise},cd.prototype.waitForPendingWrites=function(){var t=this;this.Df();var e=new Sa;return this.ei.ai(function(){return t.fu._l(e)}),e.promise},cd.prototype.listen=function(t,e,n){var r=this;this.Df();var i=new Vl(n),o=new Yf(t,i,e);return this.ei.ai(function(){return r.Nf.listen(o)}),function(){i.Q_(),r.ei.ai(function(){return r.Nf.lu(o)})}},cd.prototype.kf=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(t.sent(),function(n,u,a){return g(this,void 0,void 0,function(){var s,e=this;return w(this,function(t){switch(t.label){case 0:return s=new Sa,[4,n.enqueue(function(){return g(e,void 0,void 0,function(){var r,i,o;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,(e=a,(n=u).persistence.runTransaction("read document","readonly",function(t){return n.Rh.Hn(t,e)}))];case 1:return(r=t.sent())instanceof fu?s.resolve(r):r instanceof lu?s.resolve(null):s.reject(new ni(ei.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return i=t.sent(),o=Za(i,"Failed to get document '"+a+" from cache"),s.reject(o),[3,3];case 3:return[2]}var e,n})})})];case 1:return[2,(t.sent(),s.promise)]}})})}(this.ei,this.La,e))]}})})},cd.prototype.$f=function(u,a){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(t.sent(),e=this.ei,n=this.Nf,r=u,i=a,o=new Sa,s=ld(e,n,Eu(r.path),{includeMetadataChanges:!0,$l:!0},{next:function(t){s();var e=t.docs.has(r);!e&&t.fromCache?o.reject(new ni(ei.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&i&&"server"===i.source?o.reject(new ni(ei.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):o.resolve(t)},error:function(t){return o.reject(t)}}),o.promise)]}var e,n,r,i,o,s})})},cd.prototype.xf=function(e){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(t.sent(),function(n,a,c){return g(this,void 0,void 0,function(){var u,e=this;return w(this,function(t){switch(t.label){case 0:return u=new Sa,[4,n.enqueue(function(){return g(e,void 0,void 0,function(){var e,n,r,i,o,s;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Ch(a,c,!0)];case 1:return e=t.sent(),n=new kf(c,e.gh),r=n.Sc(e.documents),i=n.Un(r,!1),u.resolve(i.snapshot),[3,3];case 2:return o=t.sent(),s=Za(o,"Failed to execute query '"+c+" against cache"),u.reject(s),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),u.promise)]}})})}(this.ei,this.La,e))]}})})},cd.prototype.Of=function(u,a){return g(this,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Df(),[4,this.Sf.promise];case 1:return[2,(t.sent(),e=this.ei,n=this.Nf,r=u,i=a,o=new Sa,s=ld(e,n,r,{includeMetadataChanges:!0,$l:!0},{next:function(t){s(),t.fromCache&&i&&"server"===i.source?o.reject(new ni(ei.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):o.resolve(t)},error:function(t){return o.reject(t)}}),o.promise)]}var e,n,r,i,o,s})})},cd.prototype.write=function(t){var e=this;this.Df();var n=new Sa;return this.ei.ai(function(){return e.fu.write(t,n)}),n.promise},cd.prototype.s=function(){return this.w_.s},cd.prototype.bl=function(t){var e=this;this.Df();var n=new Vl(t);return this.ei.ai(function(){return g(e,void 0,void 0,function(){return w(this,function(t){return[2,this.Nf.bl(n)]})})}),function(){n.Q_(),e.ei.ai(function(){return g(e,void 0,void 0,function(){return w(this,function(t){return[2,this.Nf.vl(n)]})})})}},Object.defineProperty(cd.prototype,"Mf",{get:function(){return this.ei.Ii},enumerable:!1,configurable:!0}),cd.prototype.transaction=function(t){var e=this;this.Df();var n=new Sa;return this.ei.ai(function(){return new ud(e.ei,e.qa,t,n).run(),Promise.resolve()}),n.promise},cd);function cd(t,e){this.credentials=t,this.ei=e,this.clientId=qr.t(),this.Sf=new Sa}function hd(t,e,n,r){this.ei=t,this.qa=e,this.updateFunction=n,this.ii=r,this.Vf=5,this.Ti=new ka(this.ei,"transaction_retry")}function fd(t){this.qa=t,this.Tf=new Map,this.mutations=[],this.Ef=!1,this.If=null,this.mf=new Set}function ld(t,e,n,r,i){var o=new Vl(i),s=new Yf(n,o,r);return t.ai(function(){return e.listen(s)}),function(){o.Q_(),t.ai(function(){return e.lu(s)})}}var pd,dd,yd=(Od.prototype.Bf=function(t){switch(Eo(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Do(t.integerValue||t.doubleValue);case 3:return this.Uf(t.timestampValue);case 4:return this.Qf(t);case 5:return t.stringValue;case 6:return new up(ko(t.bytesValue));case 7:return this.Wf(t.referenceValue);case 8:return this.jf(t.geoPointValue);case 9:return this.Kf(t.arrayValue);case 10:return this.Gf(t.mapValue);default:throw Ur()}},Od.prototype.Gf=function(t){var n=this,r={};return Xr(t.fields||{},function(t,e){r[t]=n.Bf(e)}),r},Od.prototype.jf=function(t){return new kp(Do(t.latitude),Do(t.longitude))},Od.prototype.Kf=function(t){var e=this;return(t.values||[]).map(function(t){return e.Bf(t)})},Od.prototype.Qf=function(t){switch(this.Lf){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return mo(n)?t(n):n}(t);return null==e?null:this.Bf(e);case"estimate":return this.Uf(wo(t));default:return null}},Od.prototype.Uf=function(t){var e=So(t),n=new ri(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},Od.prototype.Wf=function(t){var e=si.k(t);Mr(as(e));var n=new Wr(e.get(1),e.get(3)),r=new ci(e.V(5));return n.isEqual(this.s)||Pr("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.s.projectId+"/"+this.s.database+") instead."),this.qf(r)},Od),vd=ec.ji,gd=(xd.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},xd),md=(Object.defineProperty(Ld.prototype,"rd",{get:function(){return this.od||(this.od=new Hp(this.sf,this.sd.ignoreUndefinedProperties)),this.od},enumerable:!1,configurable:!0}),Ld.prototype.settings=function(t){Fl("Firestore.settings",arguments,1),Gl("Firestore.settings","object",1,t),t.merge&&delete(t=Object.assign(Object.assign({},this.sd),t)).merge;var e=new gd(t);if(this.Zf&&!this.sd.isEqual(e))throw new ni(ei.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.sd=e).credentials&&(this.nd=function(t){if(!t)return new Yh;switch(t.type){case"gapi":var e=t.hd;return Mr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Zh(e,t.zh||"0");case"provider":return t.hd;default:throw new ni(ei.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},Ld.prototype.enableNetwork=function(){return this.Xf(),this.Zf.enableNetwork()},Ld.prototype.disableNetwork=function(){return this.Xf(),this.Zf.disableNetwork()},Ld.prototype.enablePersistence=function(t){var e,n;if(this.Zf)throw new ni(ei.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&Pr("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new ni(ei.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.ad(this.zf,this.Hf,{F_:!0,cacheSizeBytes:this.sd.cacheSizeBytes,synchronizeTabs:r,Vo:i})},Ld.prototype.clearPersistence=function(){return g(this,void 0,void 0,function(){var n,e=this;return w(this,function(t){if(void 0!==this.Zf&&!this.Zf.Mf)throw new ni(ei.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return n=new Sa,[2,(this.Jf.mi(function(){return g(e,void 0,void 0,function(){var e;return w(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.zf.clearPersistence(this.sf,this.ed)];case 1:return t.sent(),n.resolve(),[3,3];case 2:return e=t.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise)]})})},Ld.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(Ld.prototype,"ud",{get:function(){return this.Xf(),this.Zf.Mf},enumerable:!1,configurable:!0}),Ld.prototype.waitForPendingWrites=function(){return this.Xf(),this.Zf.waitForPendingWrites()},Ld.prototype.onSnapshotsInSync=function(t){if(this.Xf(),Cl(t))return this.Zf.bl(t);Gl("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.Zf.bl(e)},Ld.prototype.Xf=function(){return this.Zf||this.ad(new Dl,new Rl,{F_:!1}),this.Zf},Ld.prototype.ld=function(){return new Hr(this.sf,this.ed,this.sd.host,this.sd.ssl,this.sd.experimentalForceLongPolling)},Ld.prototype.ad=function(t,e,n){var r=this.ld();return this.Zf=new ad(this.nd,this.Jf),this.Zf.start(r,t,e,n)},Ld.td=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new ni(ei.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new ni(ei.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Wr(n)},Object.defineProperty(Ld.prototype,"app",{get:function(){if(!this.Yf)throw new ni(ei.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Yf},enumerable:!1,configurable:!0}),Ld.prototype.collection=function(t){return Fl("Firestore.collection",arguments,1),Gl("Firestore.collection","non-empty string",1,t),this.Xf(),new jd(si.k(t),this,null)},Ld.prototype.doc=function(t){return Fl("Firestore.doc",arguments,1),Gl("Firestore.doc","non-empty string",1,t),this.Xf(),Ed._d(si.k(t),this,null)},Ld.prototype.collectionGroup=function(t){if(Fl("Firestore.collectionGroup",arguments,1),Gl("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new ni(ei.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.Xf(),new Fd((e=t,new mu(si.$(),e)),this,null);var e},Ld.prototype.runTransaction=function(e){var n=this;return Fl("Firestore.runTransaction",arguments,1),Gl("Firestore.runTransaction","function",1,e),this.Xf().transaction(function(t){return e(new wd(n,t))})},Ld.prototype.batch=function(){return this.Xf(),new bd(this)},Object.defineProperty(Ld,"logLevel",{get:function(){switch(xr()){case l.DEBUG:return"debug";case l.ERROR:return"error";case l.SILENT:return"silent";case l.WARN:return"warn";case l.INFO:return"info";case l.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),Ld.setLogLevel=function(t){Fl("Firestore.setLogLevel",arguments,1),Kl("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),Lr.setLogLevel(t)},Ld.prototype.fd=function(){return this.sd.timestampsInSnapshots},Ld.prototype.dd=function(){return this.sd},Ld),wd=(Rd.prototype.get=function(t){var n=this;Fl("Transaction.get",arguments,1);var r=Yd("Transaction.get",t,this.wd);return this.Td.Af([r.if]).then(function(t){if(!t||1!==t.length)return Ur();var e=t[0];if(e instanceof lu)return new Td(n.wd,r.if,null,!1,!1,r.rf);if(e instanceof fu)return new Td(n.wd,r.if,e,!1,!1,r.rf);throw Ur()})},Rd.prototype.set=function(t,e,n){jl("Transaction.set",arguments,2,3);var r=Yd("Transaction.set",t,this.wd);n=Hd("Transaction.set",n);var i=Xd(r.rf,e,n),o=Yp(this.wd.rd,"Transaction.set",r.if,i,null!==r.rf,n);return this.Td.set(r.if,o),this},Rd.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof cp?(ql("Transaction.update",arguments,3),r=Yd("Transaction.update",t,this.wd),Qp(this.wd.rd,"Transaction.update",r.if,e,n,o)):(Fl("Transaction.update",arguments,2),r=Yd("Transaction.update",t,this.wd),Xp(this.wd.rd,"Transaction.update",r.if,e)),this.Td.update(r.if,i),this},Rd.prototype.delete=function(t){Fl("Transaction.delete",arguments,1);var e=Yd("Transaction.delete",t,this.wd);return this.Td.delete(e.if),this},Rd),bd=(kd.prototype.set=function(t,e,n){jl("WriteBatch.set",arguments,2,3),this.md();var r=Yd("WriteBatch.set",t,this.wd);n=Hd("WriteBatch.set",n);var i=Xd(r.rf,e,n),o=Yp(this.wd.rd,"WriteBatch.set",r.if,i,null!==r.rf,n);return this.Ed=this.Ed.concat(o.hf(r.if,Ls.We())),this},kd.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.md(),i="string"==typeof e||e instanceof cp?(ql("WriteBatch.update",arguments,3),r=Yd("WriteBatch.update",t,this.wd),Qp(this.wd.rd,"WriteBatch.update",r.if,e,n,o)):(Fl("WriteBatch.update",arguments,2),r=Yd("WriteBatch.update",t,this.wd),Xp(this.wd.rd,"WriteBatch.update",r.if,e)),this.Ed=this.Ed.concat(i.hf(r.if,Ls.exists(!0))),this},kd.prototype.delete=function(t){Fl("WriteBatch.delete",arguments,1),this.md();var e=Yd("WriteBatch.delete",t,this.wd);return this.Ed=this.Ed.concat(new Js(e.if,Ls.We())),this},kd.prototype.commit=function(){return this.md(),this.Id=!0,0<this.Ed.length?this.wd.Xf().write(this.Ed):Promise.resolve()},kd.prototype.md=function(){if(this.Id)throw new ni(ei.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},kd),Ed=(o(Dd,dd=Lp),Dd._d=function(t,e,n){if(t.length%2!=0)throw new ni(ei.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.F()+" has "+t.length);return new Dd(new ci(t),e,n)},Object.defineProperty(Dd.prototype,"id",{get:function(){return this.if.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(Dd.prototype,"parent",{get:function(){return new jd(this.if.path.p(),this.firestore,this.rf)},enumerable:!1,configurable:!0}),Object.defineProperty(Dd.prototype,"path",{get:function(){return this.if.path.F()},enumerable:!1,configurable:!0}),Dd.prototype.collection=function(t){if(Fl("DocumentReference.collection",arguments,1),Gl("DocumentReference.collection","non-empty string",1,t),!t)throw new ni(ei.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=si.k(t);return new jd(this.if.path.child(e),this.firestore,null)},Dd.prototype.isEqual=function(t){if(!(t instanceof Dd))throw $l("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.if.isEqual(t.if)&&this.rf===t.rf},Dd.prototype.set=function(t,e){jl("DocumentReference.set",arguments,1,2),e=Hd("DocumentReference.set",e);var n=Xd(this.rf,t,e),r=Yp(this.firestore.rd,"DocumentReference.set",this.if,n,null!==this.rf,e);return this.Zf.write(r.hf(this.if,Ls.We()))},Dd.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof cp?(ql("DocumentReference.update",arguments,2),Qp(this.firestore.rd,"DocumentReference.update",this.if,t,e,r)):(Fl("DocumentReference.update",arguments,1),Xp(this.firestore.rd,"DocumentReference.update",this.if,t)),this.Zf.write(n.hf(this.if,Ls.exists(!0)))},Dd.prototype.delete=function(){return Fl("DocumentReference.delete",arguments,0),this.Zf.write([new Js(this.if,Ls.We())])},Dd.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];jl("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||Cl(i[u])||(Jl("DocumentReference.onSnapshot",s=i[u],["includeMetadataChanges"]),Hl("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++);var a,c={includeMetadataChanges:s.includeMetadataChanges};Cl(i[u])?(a=i[u],i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)):(Gl("DocumentReference.onSnapshot","function",u,i[u]),Bl("DocumentReference.onSnapshot","function",u+1,i[u+1]),Bl("DocumentReference.onSnapshot","function",u+2,i[u+2]));var h={next:function(t){i[u]&&i[u](r.Ad(t))},error:i[u+1],complete:i[u+2]};return this.Zf.listen(Eu(this.if.path),c,h)},Dd.prototype.get=function(t){var e=this;jl("DocumentReference.get",arguments,0,1),Kd("DocumentReference.get",t);var n=this.firestore.Xf();return t&&"cache"===t.source?n.kf(this.if).then(function(t){return new Td(e.firestore,e.if,t,!0,t instanceof fu&&t.Ge,e.rf)}):n.$f(this.if,t).then(function(t){return e.Ad(t)})},Dd.prototype.withConverter=function(t){return new Dd(this.if,this.firestore,t)},Dd.prototype.Ad=function(t){var e=t.docs.get(this.if);return new Td(this.firestore,this.if,e,t.fromCache,t.hasPendingWrites,this.rf)},Dd),Id=(Sd.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},Sd),Td=(Ad.prototype.data=function(t){var e=this;if(jl("DocumentSnapshot.data",arguments,0,1),t=Wd("DocumentSnapshot.data",t),this.Rd){if(this.rf){var n=new _d(this.wd,this.if,this.Rd,this.Pd,this.gd,null);return this.rf.fromFirestore(n,t)}return new yd(this.wd.sf,this.wd.fd(),t.serverTimestamps||"none",function(t){return new Ed(t,e.wd,null)}).Bf(this.Rd.tn())}},Ad.prototype.get=function(t,e){var n=this;if(jl("DocumentSnapshot.get",arguments,1,2),e=Wd("DocumentSnapshot.get",e),this.Rd){var r=this.Rd.data().field(nd("DocumentSnapshot.get",t,this.if));if(null!==r)return new yd(this.wd.sf,this.wd.fd(),e.serverTimestamps||"none",function(t){return new Ed(t,n.wd,n.rf)}).Bf(r)}},Object.defineProperty(Ad.prototype,"id",{get:function(){return this.if.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(Ad.prototype,"ref",{get:function(){return new Ed(this.if,this.wd,this.rf)},enumerable:!1,configurable:!0}),Object.defineProperty(Ad.prototype,"exists",{get:function(){return null!==this.Rd},enumerable:!1,configurable:!0}),Object.defineProperty(Ad.prototype,"metadata",{get:function(){return new Id(this.gd,this.Pd)},enumerable:!1,configurable:!0}),Ad.prototype.isEqual=function(t){if(!(t instanceof Ad))throw $l("isEqual","DocumentSnapshot",1,t);return this.wd===t.wd&&this.Pd===t.Pd&&this.if.isEqual(t.if)&&(null===this.Rd?null===t.Rd:this.Rd.isEqual(t.Rd))&&this.rf===t.rf},Ad),_d=(o(Nd,pd=Td),Nd.prototype.data=function(t){return pd.prototype.data.call(this,t)},Nd);function Nd(){return null!==pd&&pd.apply(this,arguments)||this}function Ad(t,e,n,r,i,o){this.wd=t,this.if=e,this.Rd=n,this.Pd=r,this.gd=i,this.rf=o}function Sd(t,e){this.hasPendingWrites=t,this.fromCache=e}function Dd(t,e,n){var r=this;return(r=dd.call(this,e.sf,t,n)||this).if=t,r.firestore=e,r.rf=n,r.Zf=r.firestore.Xf(),r}function kd(t){this.wd=t,this.Ed=[],this.Id=!1}function Rd(t,e){this.wd=t,this.Td=e}function Ld(t,e,n,r){var i=this;if(void 0===n&&(n=new Dl),void 0===r&&(r=new Rl),this.zf=n,this.Hf=r,this.Yf=null,this.Jf=new Ya,this.INTERNAL={delete:function(){return g(i,void 0,void 0,function(){return w(this,function(t){switch(t.label){case 0:return this.Xf(),[4,this.Zf.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var o=t;this.Yf=o,this.sf=Ld.td(o),this.ed=o.name,this.nd=new Xh(e)}else{var s=t;if(!s.projectId)throw new ni(ei.INVALID_ARGUMENT,"Must provide projectId");this.sf=new Wr(s.projectId,s.database),this.ed="[DEFAULT]",this.nd=new Yh}this.sd=new gd({})}function xd(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new ni(ei.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else zl("settings","non-empty string","host",t.host),this.host=t.host,Hl("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Jl("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),Hl("settings","object","credentials",t.credentials),this.credentials=t.credentials,Hl("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),Hl("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?Pr("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Pr("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,Hl("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=ec.Gi;else{if(t.cacheSizeBytes!==vd&&t.cacheSizeBytes<ec.Ki)throw new ni(ei.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+ec.Ki);this.cacheSizeBytes=t.cacheSizeBytes}Hl("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.experimentalForceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}function Od(t,e,n,r){this.s=t,this.timestampsInSnapshots=e,this.Lf=n,this.qf=r}function Pd(t,e,n){if("string"==typeof n){if(""===n)throw new ni(ei.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Iu(e)&&-1!==n.indexOf("/"))throw new ni(ei.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(si.k(n));if(!ci.j(r))throw new ni(ei.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Ro(t,new ci(r))}if(n instanceof Lp)return Ro(t,n.if);throw new ni(ei.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ql(n)+".")}function Cd(t,e){if(!Array.isArray(t)||0===t.length)throw new ni(ei.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new ni(ei.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if("in"===e||"array-contains-any"===e){if(0<=t.indexOf(null))throw new ni(ei.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new ni(ei.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")}}function Vd(t,e,n){if(!n.isEqual(e))throw new ni(ei.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}function Ud(t){if(t.un()&&0===t.en.length)throw new ni(ei.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Md,Fd=(zd.prototype.where=function(t,e,n){var r;Fl("Query.where",arguments,3),Zl("Query.where",3,n),r="not-in"===e||"!="===e?e:Kl("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e);var i,o,s=nd("Query.where",t),u=function(t,e,n,r,i,o,s){var u;if(i.M()){if("array-contains"===o||"array-contains-any"===o)throw new ni(ei.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){Cd(s,o);for(var a=[],c=0,h=s;c<h.length;c++){var f=h[c];a.push(Pd(r,t,f))}u={arrayValue:{values:a}}}else u=Pd(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||Cd(s,o),u=Zp(n,e,s,"in"===o||"not-in"===o);var l=Pu.create(i,o,u);return function(t,e){if(e._n()){var n=t.ln();if(null!==n&&!n.isEqual(e.field))throw new ni(ei.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=t.cn();null!==r&&Vd(0,e.field,r)}var i=t.fn(function(){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==i)throw i===e.op?new ni(ei.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter."):new ni(ei.INVALID_ARGUMENT,"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(this.Vd,"Query.where",this.firestore.rd,this.firestore.sf,s,r,n);return new zd((i=this.Vd,o=i.filters.concat([u]),new mu(i.path,i.collectionGroup,i.en.slice(),o,i.limit,i.nn,i.startAt,i.endAt)),this.firestore,this.rf)},zd.prototype.orderBy=function(t,e){var n;if(jl("Query.orderBy",arguments,1,2),Bl("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new ni(ei.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}var r,i,o=nd("Query.orderBy",t),s=function(t,e,n){if(null!==t.startAt)throw new ni(ei.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new ni(ei.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r,i,o,s=new aa(e,n);return i=s,null!==(r=t).cn()||null!==(o=r.ln())&&Vd(0,o,i.field),s}(this.Vd,o,n);return new zd((r=this.Vd,i=r.en.concat([s]),new mu(r.path,r.collectionGroup,i,r.filters.slice(),r.limit,r.nn,r.startAt,r.endAt)),this.firestore,this.rf)},zd.prototype.limit=function(t){return Fl("Query.limit",arguments,1),Gl("Query.limit","number",1,t),tp("Query.limit",1,t),new zd(Nu(this.Vd,t,"F"),this.firestore,this.rf)},zd.prototype.limitToLast=function(t){return Fl("Query.limitToLast",arguments,1),Gl("Query.limitToLast","number",1,t),tp("Query.limitToLast",1,t),new zd(Nu(this.Vd,t,"L"),this.firestore,this.rf)},zd.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ql("Query.startAt",arguments,1);var r=this.yd("Query.startAt",t,e,!0);return new zd(Au(this.Vd,r),this.firestore,this.rf)},zd.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ql("Query.startAfter",arguments,1);var r=this.yd("Query.startAfter",t,e,!1);return new zd(Au(this.Vd,r),this.firestore,this.rf)},zd.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ql("Query.endBefore",arguments,1);var r=this.yd("Query.endBefore",t,e,!0);return new zd(Su(this.Vd,r),this.firestore,this.rf)},zd.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];ql("Query.endAt",arguments,1);var r=this.yd("Query.endAt",t,e,!1);return new zd(Su(this.Vd,r),this.firestore,this.rf)},zd.prototype.isEqual=function(t){if(!(t instanceof zd))throw $l("isEqual","Query",1,t);return this.firestore===t.firestore&&Du(this.Vd,t.Vd)&&this.rf===t.rf},zd.prototype.withConverter=function(t){return new zd(this.Vd,this.firestore,t)},zd.prototype.yd=function(h,t,e,n){if(Zl(h,1,t),t instanceof Td)return Fl(h,s([t],e),1),function(t,e,n,r){if(!n)throw new ni(ei.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+h+"().");for(var i=[],o=0,s=Tu(t);o<s.length;o++){var u=s[o];if(u.field.M())i.push(Ro(e,n.key));else{var a=n.field(u.field);if(mo(a))throw new ni(ei.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===a){var c=u.field.F();throw new ni(ei.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+c+"' (used as the orderBy) does not exist.")}i.push(a)}}return new ta(i,r)}(this.Vd,this.firestore.sf,t.Rd,n);var r=[t].concat(e);return function(t,e,n,r,i,o){var s=t.en;if(i.length>s.length)throw new ni(ei.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var u=[],a=0;a<i.length;a++){var c=i[a];if(s[a].field.M()){if("string"!=typeof c)throw new ni(ei.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!Iu(t)&&-1!==c.indexOf("/"))throw new ni(ei.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(si.k(c));if(!ci.j(h))throw new ni(ei.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var f=new ci(h);u.push(Ro(e,f))}else{var l=Zp(n,r,c);u.push(l)}}return new ta(u,o)}(this.Vd,this.firestore.sf,this.firestore.rd,h,r,n)},zd.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];jl("Query.onSnapshot",arguments,1,4);var s,u={},a=0;"object"!=typeof i[a]||Cl(i[a])||(Jl("Query.onSnapshot",u=i[a],["includeMetadataChanges"]),Hl("Query.onSnapshot","boolean","includeMetadataChanges",u.includeMetadataChanges),a++),Cl(i[a])?(s=i[a],i[a]=null===(t=s.next)||void 0===t?void 0:t.bind(s),i[a+1]=null===(e=s.error)||void 0===e?void 0:e.bind(s),i[a+2]=null===(n=s.complete)||void 0===n?void 0:n.bind(s)):(Gl("Query.onSnapshot","function",a,i[a]),Bl("Query.onSnapshot","function",a+1,i[a+1]),Bl("Query.onSnapshot","function",a+2,i[a+2]));var c={next:function(t){i[a]&&i[a](new qd(r.firestore,r.Vd,t,r.rf))},error:i[a+1],complete:i[a+2]};return Ud(this.Vd),this.firestore.Xf().listen(this.Vd,u,c)},zd.prototype.get=function(t){var e=this;jl("Query.get",arguments,0,1),Kd("Query.get",t),Ud(this.Vd);var n=this.firestore.Xf();return(t&&"cache"===t.source?n.xf(this.Vd):n.Of(this.Vd,t)).then(function(t){return new qd(e.firestore,e.Vd,t,e.rf)})},zd),qd=(Object.defineProperty(Bd.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(Bd.prototype,"empty",{get:function(){return this.bd.docs._()},enumerable:!1,configurable:!0}),Object.defineProperty(Bd.prototype,"size",{get:function(){return this.bd.docs.size},enumerable:!1,configurable:!0}),Bd.prototype.forEach=function(e,n){var r=this;jl("QuerySnapshot.forEach",arguments,1,2),Gl("QuerySnapshot.forEach","function",1,e),this.bd.docs.forEach(function(t){e.call(n,r.Dd(t,r.metadata.fromCache,r.bd.qt.has(t.key)))})},Object.defineProperty(Bd.prototype,"query",{get:function(){return new Fd(this.pd,this.wd,this.rf)},enumerable:!1,configurable:!0}),Bd.prototype.docChanges=function(t){t&&(Jl("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Hl("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.bd.Ut)throw new ni(ei.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.vd&&this.Sd===e||(this.vd=function(i,e,o){if(i.Lt._()){var n=0;return i.docChanges.map(function(t){var e=o(t.doc,i.fromCache,i.qt.has(t.doc.key));return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var s=i.Lt;return i.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=o(t.doc,i.fromCache,i.qt.has(t.doc.key)),n=-1,r=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(r=(s=s.add(t.doc)).indexOf(t.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ur()}}(t.type),doc:e,oldIndex:n,newIndex:r}})}(this.bd,e,this.Dd.bind(this)),this.Sd=e),this.vd},Bd.prototype.isEqual=function(t){if(!(t instanceof Bd))throw $l("isEqual","QuerySnapshot",1,t);return this.wd===t.wd&&Du(this.pd,t.pd)&&this.bd.isEqual(t.bd)&&this.rf===t.rf},Bd.prototype.Dd=function(t,e,n){return new _d(this.wd,t.key,t,e,n,this.rf)},Bd),jd=(o(Gd,Md=Fd),Object.defineProperty(Gd.prototype,"id",{get:function(){return this.Vd.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(Gd.prototype,"parent",{get:function(){var t=this.Vd.path.p();return t._()?null:new Ed(new ci(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(Gd.prototype,"path",{get:function(){return this.Vd.path.F()},enumerable:!1,configurable:!0}),Gd.prototype.doc=function(t){jl("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=qr.t()),Gl("CollectionReference.doc","non-empty string",1,t);var e=si.k(t);return Ed._d(this.Vd.path.child(e),this.firestore,this.rf)},Gd.prototype.add=function(t){Fl("CollectionReference.add",arguments,1),Gl("CollectionReference.add","object",1,this.rf?this.rf.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},Gd.prototype.withConverter=function(t){return new Gd(this.Cd,this.firestore,t)},Gd);function Gd(t,e,n){var r=this;if(((r=Md.call(this,Eu(t),e,n)||this).Cd=t).length%2!=1)throw new ni(ei.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.F()+" has "+t.length);return r}function Bd(t,e,n,r){this.wd=t,this.pd=e,this.bd=n,this.rf=r,this.vd=null,this.Sd=null,this.metadata=new Id(n.hasPendingWrites,n.fromCache)}function zd(t,e,n){this.Vd=t,this.firestore=e,this.rf=n}function Hd(t,e){if(void 0===e)return{merge:!1};if(Jl(t,e,["merge","mergeFields"]),Hl(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n,r){if(!(n instanceof Array))throw new ni(ei.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Ql(n));for(var i=0;i<n.length;++i)if(!r(n[i]))throw new ni(ei.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+Ql(n[i]))}(t,"mergeFields",n,function(t){return"string"==typeof t||t instanceof cp}),void 0!==e.mergeFields&&void 0!==e.merge)throw new ni(ei.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function Wd(t,e){return void 0===e?{}:(Jl(t,e,["serverTimestamps"]),Wl(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Kd(t,e){Bl(t,"object",1,e),e&&(Jl(t,e,["source"]),Wl(t,0,"source",e.source,["default","server","cache"]))}function Yd(t,e,n){if(e instanceof Lp){if(e.firestore!==n)throw new ni(ei.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw $l(t,"DocumentReference",1,e)}function Xd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var Qd={Firestore:md,GeoPoint:kp,Timestamp:ri,Blob:up,Transaction:wd,WriteBatch:bd,DocumentReference:Ed,DocumentSnapshot:Td,Query:Fd,QueryDocumentSnapshot:_d,QuerySnapshot:qd,CollectionReference:jd,FieldPath:cp,FieldValue:Sp,setLogLevel:md.setLogLevel,CACHE_SIZE_UNLIMITED:vd};function Zd(t){t.INTERNAL.registerComponent(new kr("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),r=new Rl,i=new kl(r),new md(e,n,i,r);var e,n,r,i},"PUBLIC").setServiceProps(Object.assign({},Qd))),t.registerVersion("@firebase/firestore","1.16.6")}Zd(r.default),Jd.__PRIVATE_registerFirestore=Zd,Object.defineProperty(Jd,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});