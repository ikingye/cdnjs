!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("@firebase/app")):"function"==typeof define&&define.amd?define(["@firebase/app"],e):e((t=t||self).firebase)}(this,function(ld){"use strict";try{(function(){ld=ld&&Object.prototype.hasOwnProperty.call(ld,"default")?ld.default:ld;var t,p,e,r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function n(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function y(t,s,u,a){return new(u=u||Promise)(function(n,e){function r(t){try{o(a.next(t))}catch(t){e(t)}}function i(t){try{o(a.throw(t))}catch(t){e(t)}}function o(t){var e;t.done?n(t.value):((e=t.value)instanceof u?e:new u(function(t){t(e)})).then(r,i)}o((a=a.apply(t,s||[])).next())})}function v(n,r){var i,o,s,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},t={next:e(0),throw:e(1),return:e(2)};return"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(i)throw new TypeError("Generator is already executing.");for(;u;)try{if(i=1,o&&(s=2&e[0]?o.return:e[0]?o.throw||((s=o.return)&&s.call(o),0):o.next)&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,o=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=r.call(n,u)}catch(t){e=[6,t],o=0}finally{i=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}}function d(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;for(var r=Array(t),i=0,e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function i(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=a[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,s(["["+i+"]  "+t.name+":"],n))}}(e=p=p||{})[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT";var o={debug:p.DEBUG,verbose:p.VERBOSE,info:p.INFO,warn:p.WARN,error:p.ERROR,silent:p.SILENT},u=p.INFO,a=((t={})[p.DEBUG]="log",t[p.VERBOSE]="log",t[p.INFO]="info",t[p.WARN]="warn",t[p.ERROR]="error",t),h=(Object.defineProperty(c.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in p))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),c.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?o[t]:t},Object.defineProperty(c.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),c.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.DEBUG],t)),this._logHandler.apply(this,s([this,p.DEBUG],t))},c.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.VERBOSE],t)),this._logHandler.apply(this,s([this,p.VERBOSE],t))},c.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.INFO],t)),this._logHandler.apply(this,s([this,p.INFO],t))},c.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.WARN],t)),this._logHandler.apply(this,s([this,p.WARN],t))},c.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,s([this,p.ERROR],t)),this._logHandler.apply(this,s([this,p.ERROR],t))},c);function c(t){this.name=t,this._logLevel=u,this._logHandler=i,this._userLogHandler=null}function g(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var f,m=(n(l,f=Error),l);function l(t,e){var n=f.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,l.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,w.prototype.create),n}var w=(b.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(I,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",a=this.serviceName+": "+u+" ("+o+").",h=new m(o,a),c=0,f=Object.keys(i);c<f.length;c++){var l=f[c];"_"!==l.slice(-1)&&(l in h&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),h[l]=i[l])}return h},b);function b(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var I=/\{\$([^}]+)}/g;function E(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var _,T="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},N=N||{},A=T||self;function x(){}function S(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function D(t){var e=S(t);return"array"==e||"object"==e&&"number"==typeof t.length}function P(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var R="closure_uid_"+(1e9*Math.random()>>>0),O=0;function k(t,e,n){return t.call.apply(t.bind,arguments)}function L(e,n,t){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,r),e.apply(n,t)}}return function(){return e.apply(n,arguments)}}function C(t,e,n){return(C=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?k:L).apply(null,arguments)}function V(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var U=Date.now||function(){return+new Date};function j(t,e){function n(){}n.prototype=e.prototype,t.M=e.prototype,t.prototype=new n,t.prototype.constructor=t}function M(){this.j=this.j,this.i=this.i}M.prototype.j=!1,M.prototype.da=function(){!this.j&&(this.j=!0,this.C(),0)&&(Object.prototype.hasOwnProperty.call(this,R)&&this[R]||(this[R]=++O))},M.prototype.C=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var F=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},q=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function B(t){return Array.prototype.concat.apply([],arguments)}function G(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function z(t){return/^[\s\xa0]*$/.test(t)}var H,W=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Y(t,e){return-1!=t.indexOf(e)}function X(t,e){return t<e?-1:e<t?1:0}t:{var K=A.navigator;if(K){var Q=K.userAgent;if(Q){H=Q;break t}}H=""}function J(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function $(t){var e={};for(var n in t)e[n]=t[n];return e}var Z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function tt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<Z.length;o++)n=Z[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function et(t){return et[" "](t),t}et[" "]=x;var nt,rt,it=Y(H,"Opera"),ot=Y(H,"Trident")||Y(H,"MSIE"),st=Y(H,"Edge"),ut=st||ot,at=Y(H,"Gecko")&&!(Y(H.toLowerCase(),"webkit")&&!Y(H,"Edge"))&&!(Y(H,"Trident")||Y(H,"MSIE"))&&!Y(H,"Edge"),ht=Y(H.toLowerCase(),"webkit")&&!Y(H,"Edge");function ct(){var t=A.document;return t?t.documentMode:void 0}t:{var ft="",lt=(rt=H,at?/rv:([^\);]+)(\)|;)/.exec(rt):st?/Edge\/([\d\.]+)/.exec(rt):ot?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(rt):ht?/WebKit\/(\S+)/.exec(rt):it?/(?:Version)[ \/]?(\S+)/.exec(rt):void 0);if(lt&&(ft=lt?lt[1]:""),ot){var pt=ct();if(null!=pt&&pt>parseFloat(ft)){nt=String(pt);break t}}nt=ft}var dt={};function yt(u){return t=u,e=function(){for(var t=0,e=W(String(nt)).split("."),n=W(String(u)).split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=X(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||X(0==o[2].length,0==s[2].length)||X(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t},n=dt,Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e();var t,e,n}var vt=A.document&&ot&&(ct()||parseInt(nt,10))||void 0,gt=!ot||9<=Number(vt),mt=ot&&!yt("9"),wt=function(){if(!A.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{A.addEventListener("test",x,e),A.removeEventListener("test",x,e)}catch(t){}return t}();function bt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function It(t,e){if(bt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(at){t:{try{et(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Et[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}bt.prototype.b=function(){this.defaultPrevented=!0},j(It,bt);var Et={2:"touch",3:"pen",4:"mouse"};It.prototype.b=function(){It.M.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,mt)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var _t="closure_listenable_"+(1e6*Math.random()|0),Tt=0;function Nt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.aa=i,this.key=++Tt,this.V=this.X=!1}function At(t){t.V=!0,t.listener=null,t.proxy=null,t.src=null,t.aa=null}function xt(t){this.src=t,this.a={},this.b=0}function St(t,e){var n,r,i,o=e.type;o in t.a&&(r=t.a[o],(n=0<=(i=F(r,e)))&&Array.prototype.splice.call(r,i,1),n&&(At(e),0==t.a[o].length&&(delete t.a[o],t.b--)))}function Dt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.V&&o.listener==e&&o.capture==!!n&&o.aa==r)return i}return-1}xt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Dt(t,e,r,i);return-1<s?(e=t[s],n||(e.X=!1)):((e=new Nt(e,this.src,o,!!r,i)).X=n,t.push(e)),e};var Pt="closure_lm_"+(1e6*Math.random()|0),Rt={};function Ot(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Ft(r),e&&e[_t]?e.sa(n,r,P(i)?!!i.capture:!!i,o):kt(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Ot(t,e[o],n,r,i);return null}return n=Ft(n),t&&t[_t]?t.ra(e,n,P(r)?!!r.capture:!!r,i):kt(t,e,n,!1,r,i)}function kt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=P(i)?!!i.capture:!!i;if(s&&!gt)return null;var u,a,h=jt(t);if(h||(t[Pt]=h=new xt(t)),(n=h.add(e,n,r,s,o)).proxy)return n;if(u=Ut,r=a=gt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)wt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ct(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Lt(t){var e,n,r;"number"!=typeof t&&t&&!t.V&&((e=t.src)&&e[_t]?St(e.c,t):(n=t.type,r=t.proxy,e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ct(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=jt(e))?(St(n,t),0==n.b&&(n.src=null,e[Pt]=null)):At(t)))}function Ct(t){return t in Rt?Rt[t]:Rt[t]="on"+t}function Vt(t,e){var n=t.listener,r=t.aa||t.src;return t.X&&Lt(t),n.call(r,e)}function Ut(t,e){if(t.V)return!0;if(gt)return Vt(t,new It(e,this));if(!e)t:{e=["window","event"];for(var n=A,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Vt(t,e=new It(e,this))}function jt(t){return(t=t[Pt])instanceof xt?t:null}var Mt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ft(e){return"function"==S(e)?e:(e[Mt]||(e[Mt]=function(t){return e.handleEvent(t)}),e[Mt])}function qt(){M.call(this),this.c=new xt(this),(this.J=this).A=null}function Bt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s,u,a=e[o];a&&!a.V&&a.capture==n&&(s=a.listener,u=a.aa||a.src,a.X&&St(t.c,a),i=!1!==s.call(u,r)&&i)}return i&&!r.defaultPrevented}j(qt,M),qt.prototype[_t]=!0,(_=qt.prototype).addEventListener=function(t,e,n,r){Ot(this,t,e,n,r)},_.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=P(i)?!!i.capture:!!i,r=Ft(r),e&&e[_t]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Dt(s=e.a[n],r,i,o))&&(At(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&jt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Dt(n,r,i,o)),(r=-1<e?n[e]:null)&&Lt(r))}(this,t,e,n,r)},_.dispatchEvent=function(t){var e,n=this.A;if(n)for(e=[];n;n=n.A)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t?t=new bt(t,n):t instanceof bt?t.target=t.target||n:(s=t,tt(t=new bt(r,n),s)),s=!0,e)for(var i=e.length-1;0<=i;i--)var o=t.a=e[i],s=Bt(o,r,!0,t)&&s;if(s=Bt(o=t.a=n,r,!0,t)&&s,s=Bt(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)s=Bt(o=t.a=e[i],r,!1,t)&&s;return s},_.C=function(){if(qt.M.C.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)At(n[r]);delete e.a[t],e.b--}}this.A=null},_.ra=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},_.sa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Gt=A.JSON.stringify;function zt(){this.b=this.a=null}var Ht,Wt=(Yt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Yt(function(){return new Xt},function(t){t.reset()},100));function Yt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function Xt(){this.next=this.b=this.a=null}function Kt(t){A.setTimeout(function(){throw t},0)}function Qt(t,e){var n;Ht||(n=A.Promise.resolve(void 0),Ht=function(){n.then(Zt)}),Jt||(Ht(),Jt=!0),$t.add(t,e)}zt.prototype.add=function(t,e){var n=Wt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Xt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var Jt=!(Xt.prototype.reset=function(){this.next=this.b=this.a=null}),$t=new zt;function Zt(){for(var t,e,n;n=e=void 0,n=null,(e=$t).a&&(n=e.a,e.a=e.a.next,e.a||(e.b=null),n.next=null),t=n;){try{t.a.call(t.b)}catch(t){Kt(t)}var r=Wt;r.g(t),r.b<r.f&&(r.b++,t.next=r.a,r.a=t)}Jt=!1}function te(t,e){qt.call(this),this.b=t||1,this.a=e||A,this.f=C(this.Ua,this),this.g=U()}function ee(t){t.Z=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function ne(t,e,n){if("function"==S(t))n&&(t=C(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=C(t.handleEvent,t)}return 2147483647<Number(e)?-1:A.setTimeout(t,e||0)}function re(t,e,n){M.call(this),this.f=null!=n?C(t,n):t,this.c=e,this.b=C(this.Pa,this),this.a=[]}function ie(t){t.T=ne(t.b,t.c),t.f.apply(null,t.a)}function oe(t){M.call(this),this.b=t,this.a={}}j(te,qt),(_=te.prototype).Z=!1,_.L=null,_.Ua=function(){var t;this.Z&&(0<(t=U()-this.g)&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.Z&&(ee(this),this.start())))},_.start=function(){this.Z=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=U())},_.C=function(){te.M.C.call(this),ee(this),delete this.a},j(re,M),(_=re.prototype).ba=!1,_.T=null,_.Ia=function(t){this.a=arguments,this.T?this.ba=!0:ie(this)},_.C=function(){re.M.C.call(this),this.T&&(A.clearTimeout(this.T),this.T=null,this.ba=!1,this.a=[])},_.Pa=function(){this.T=null,this.ba&&(this.ba=!1,ie(this))},j(oe,M);var se=[];function ue(t,e,n,r){Array.isArray(n)||(n&&(se[0]=n.toString()),n=se);for(var i=0;i<n.length;i++){var o=Ot(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function ae(t){J(t.a,function(t,e){this.a.hasOwnProperty(e)&&Lt(t)},t),t.a={}}function he(){}oe.prototype.C=function(){oe.M.C.call(this),ae(this)},oe.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ce=null;function fe(){return ce=ce||new qt}function le(t){bt.call(this,"serverreachability",t)}function pe(){var t=fe();t.dispatchEvent(new le(t))}function de(t){bt.call(this,"statevent",t)}function ye(){var t=fe();t.dispatchEvent(new de(t))}function ve(t){bt.call(this,"timingevent",t)}function ge(t,e){if("function"!=S(t))throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){t()},e)}j(le,bt),j(de,bt),j(ve,bt);var me={NO_ERROR:0,Va:1,bb:2,ab:3,Ya:4,$a:5,cb:6,za:7,TIMEOUT:8,gb:9},we={Xa:"complete",kb:"success",Aa:"error",za:"abort",ib:"ready",jb:"readystatechange",TIMEOUT:"timeout",eb:"incrementaldata",hb:"progress",Za:"downloadprogress",lb:"uploadprogress"};function be(){}function Ie(t){var e;return(e=t.a)||(e=t.a={}),e}function Ee(){}be.prototype.a=null;var _e,Te={OPEN:"a",Wa:"b",Aa:"c",fb:"d"};function Ne(){bt.call(this,"d")}function Ae(){bt.call(this,"c")}function xe(){}function Se(t,e,n){this.g=t,this.W=e,this.U=n||1,this.G=new oe(this),this.N=De,t=ut?125:void 0,this.O=new te(t),this.m=null,this.b=!1,this.j=this.A=this.f=this.B=this.s=this.P=this.h=null,this.i=[],this.a=null,this.w=0,this.c=this.v=null,this.H=-1,this.l=!1,this.J=0,this.D=null,this.o=this.R=this.F=!1}j(Ne,bt),j(Ae,bt),j(xe,be),_e=new xe;var De=45e3,Pe={},Re={};function Oe(t,e,n){t.B=1,t.f=Ze(Ye(e)),t.j=n,t.F=!0,ke(t,null)}function ke(t,e){t.s=U(),Ce(t),t.A=Ye(t.f);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),pn(n.b,"t",r),t.w=0,t.a=ir(t.g,t.g.w?e:null),0<t.J&&(t.D=new re(C(t.ya,t,t.a),t.J)),ue(t.G,t.a,"readystatechange",t.Sa),e=t.m?$(t.m):{},t.j?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.$(t.A,t.v,t.j,e)):(t.v="GET",t.a.$(t.A,t.v,null,e)),pe()}function Le(t,e,n){for(var r,i,o,s,u=!0;!t.l&&t.w<n.length;){var a=(i=n,s=o=void 0,o=(r=t).w,-1==(s=i.indexOf("\n",o))?Re:(o=Number(i.substring(o,s)),isNaN(o)?Pe:(s+=1)+o>i.length?Re:(i=i.substr(s,o),r.w=s+o,i)));if(a==Re){4==e&&(t.c=4,ye(),u=!1);break}if(a==Pe){t.c=4,ye(),u=!1;break}Fe(t,a)}4==e&&0==n.length&&(t.c=1,ye(),u=!1),t.b=t.b&&u,u||(Me(t),je(t))}function Ce(t){t.P=U()+t.N,Ve(t,t.N)}function Ve(t,e){if(null!=t.h)throw Error("WatchDog timer not null");t.h=ge(C(t.Qa,t),e)}function Ue(t){t.h&&(A.clearTimeout(t.h),t.h=null)}function je(t){0==t.g.u||t.l||Zn(t.g,t)}function Me(t){Ue(t);var e=t.D;e&&"function"==typeof e.da&&e.da(),t.D=null,ee(t.O),ae(t.G),t.a&&(e=t.a,t.a=null,e.abort(),e.da())}function Fe(t,e){try{var n,r,i,o,s,u,a,h,c,f,l=t.g;if(0!=l.u&&(l.a==t||bn(l.b,t)))if(l.A=t.H,!t.o&&bn(l.b,t)&&3==l.u){try{var p=l.ja.a.parse(e)}catch(t){p=null}if(Array.isArray(p)&&3==p.length){var d=p;if(0==d[0]){t:if(!l.i){if(l.a){if(!(l.a.s+3e3<t.s))break t;$n(l),l.a.cancel(),l.a=null}Jn(l),ye()}}else l.ia=d[1],0<l.ia-l.G&&d[2]<37500&&l.U&&0==l.m&&!l.l&&(l.l=ge(C(l.Na,l),6e3));if(wn(l.b)<=1&&l.O){try{l.O()}catch(t){}l.O=void 0}}else er(l,11)}else if(!t.o&&l.a!=t||$n(l),!z(e))for(e=p=l.ja.a.parse(e),p=0;p<e.length;p++){d=e[p],l.G=d[0],d=d[1],2==l.u?"c"==d[0]?(l.B=d[1],l.R=d[2],null!=(n=d[3])&&(l.oa=n),null!=(r=d[5])&&"number"==typeof r&&0<r&&(l.D=1.5*r),i=l,(o=t.a)&&(!(s=o.a?o.a.getResponseHeader("X-Client-Wire-Protocol"):null)||!(u=i.b).a&&(Y(s,"spdy")||Y(s,"quic")||Y(s,"h2"))&&(u.f=u.g,u.a=new Set,u.b&&(In(u,u.b),u.b=null)),!i.s||(a=o.a?o.a.getResponseHeader("X-HTTP-Session-Id"):null)&&(i.ha=a,$e(i.v,i.s,a))),l.u=3,l.c&&l.c.na(),h=t,(i=l).ea=rr(i,i.w?i.R:null,i.P),h.o?(En(i.b,h),c=h,(f=i.D)&&c.setTimeout(f),c.h&&(Ue(c),Ce(c)),i.a=h):Qn(i),0<l.f.length&&Wn(l)):"stop"!=d[0]&&"close"!=d[0]||er(l,7):3==l.u&&("stop"==d[0]||"close"==d[0]?"stop"==d[0]?er(l,7):Gn(l):"noop"!=d[0]&&l.c&&l.c.ma(d),l.m=0)}pe()}catch(t){}}function qe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(D(t)||"string"==typeof t)q(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.I&&"function"==typeof t.I)n=void 0;else if(D(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.I&&"function"==typeof t.I)return t.I();if("string"==typeof t)return t.split("");if(D(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Be(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Be)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Ge(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];ze(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){for(var i={},n=e=0;e<t.a.length;)ze(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function ze(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(_=Se.prototype).setTimeout=function(t){this.N=t},_.Sa=function(t){t=t.target;var e=this.D;e&&3==Mn(t)?e.Ia():this.ya(t)},_.ya=function(t){try{if(t==this.a)t:{var e=Mn(this.a),n=this.a.qa();this.a.S();if(!(e<3||3==e&&!ut&&!this.a.Y())){this.l||4!=e||7==n||pe(),Ue(this);var r=this.a.S();this.H=r;var i=this.a.Y();if(this.b=200==r){if(this.R&&!this.o){e:{if(this.a){var o,s=this.a;if((o=s.a?s.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!z(o)){var u=o;break e}}u=null}if(!u){this.b=!1,this.c=3,ye(),Me(this),je(this);break t}this.o=!0,Fe(this,u)}this.F?(Le(this,e,i),ut&&this.b&&3==e&&(ue(this.G,this.O,"tick",this.Ra),this.O.start())):Fe(this,i),4==e&&Me(this),this.b&&!this.l&&(4==e?Zn(this.g,this):(this.b=!1,Ce(this)))}else 400==r&&0<i.indexOf("Unknown SID")?this.c=3:this.c=0,ye(),Me(this),je(this)}}}catch(t){}},_.Ra=function(){var t,e;this.a&&(t=Mn(this.a),e=this.a.Y(),this.w<e.length&&(Ue(this),Le(this,t,e),this.b&&4!=t&&Ce(this)))},_.cancel=function(){this.l=!0,Me(this)},_.Qa=function(){this.h=null;var t=U();0<=t-this.P?(2!=this.B&&(pe(),ye()),Me(this),this.c=2,je(this)):Ve(this,this.P-t)},(_=Be.prototype).I=function(){Ge(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},_.K=function(){return Ge(this),this.a.concat()},_.get=function(t,e){return ze(this.b,t)?this.b[t]:e},_.set=function(t,e){ze(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},_.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var He=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function We(t,e){var n;this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof We?(this.a=void 0!==e?e:t.a,Xe(this,t.f),this.j=t.j,Ke(this,t.c),Qe(this,t.h),this.g=t.g,e=t.b,(n=new hn).c=e.c,e.a&&(n.a=new Be(e.a),n.b=e.b),Je(this,n),this.i=t.i):t&&(n=String(t).match(He))?(this.a=!!e,Xe(this,n[1]||"",!0),this.j=tn(n[2]||""),Ke(this,n[3]||"",!0),Qe(this,n[4]),this.g=tn(n[5]||"",!0),Je(this,n[6]||"",!0),this.i=tn(n[7]||"")):(this.a=!!e,this.b=new hn(null,this.a))}function Ye(t){return new We(t)}function Xe(t,e,n){t.f=n?tn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Ke(t,e,n){t.c=n?tn(e,!0):e}function Qe(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Je(t,e,n){var r,i;e instanceof hn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(cn(r),r.c=null,r.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(fn(this,e),pn(this,n,t))},r)),r.f=i):(n||(e=en(e,un)),t.b=new hn(e,t.a))}function $e(t,e,n){t.b.set(e,n)}function Ze(t){return $e(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^U()).toString(36)),t}function tn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function en(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,nn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function nn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}We.prototype.toString=function(){var t=[],e=this.f;e&&t.push(en(e,rn,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(en(e,rn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(en(n,"/"==n.charAt(0)?sn:on,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",en(n,an)),t.join("")};var rn=/[#\/\?@]/g,on=/[#\?:]/g,sn=/[#\?]/g,un=/[#\?@]/g,an=/#/g;function hn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function cn(u){u.a||(u.a=new Be,u.b=0,u.c&&function(t){if(t){t=t.split("&");for(var e=0;e<t.length;e++){var n,r=t[e].indexOf("="),i=null;0<=r?(n=t[e].substring(0,r),i=t[e].substring(r+1)):n=t[e],o=n,s=i?decodeURIComponent(i.replace(/\+/g," ")):"",u.add(decodeURIComponent(o.replace(/\+/g," ")),s)}}var o,s}(u.c))}function fn(t,e){cn(t),e=dn(t,e),ze(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,ze((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ge(t)))}function ln(t,e){return cn(t),e=dn(t,e),ze(t.a.b,e)}function pn(t,e,n){fn(t,e),0<n.length&&(t.c=null,t.a.set(dn(t,e),G(n)),t.b+=n.length)}function dn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function yn(t,e){this.b=t,this.a=e}function vn(t){this.g=t||gn,t=A.PerformanceNavigationTiming?0<(t=A.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(A.ca&&A.ca.ua&&A.ca.ua()&&A.ca.ua().mb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(_=hn.prototype).add=function(t,e){cn(this),this.c=null,t=dn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},_.forEach=function(n,r){cn(this),this.a.forEach(function(t,e){q(t,function(t){n.call(r,t,e,this)},this)},this)},_.K=function(){cn(this);for(var t=this.a.I(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},_.I=function(t){cn(this);var e=[];if("string"==typeof t)ln(this,t)&&(e=B(e,this.a.get(dn(this,t))));else{t=this.a.I();for(var n=0;n<t.length;n++)e=B(e,t[n])}return e},_.set=function(t,e){return cn(this),this.c=null,ln(this,t=dn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},_.get=function(t,e){return t&&0<(t=this.I(t)).length?String(t[0]):e},_.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++)for(var r=e[n],i=encodeURIComponent(String(r)),r=this.I(r),o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}return this.c=t.join("&")};var gn=10;function mn(t){return t.b||t.a&&t.a.size>=t.f}function wn(t){return t.b?1:t.a?t.a.size:0}function bn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function In(t,e){t.a?t.a.add(e):t.b=e}function En(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function _n(t){var e,n;if(null!=t.b)return t.c.concat(t.b.i);if(null==t.a||0===t.a.size)return G(t.c);var r=t.c;try{for(var i=E(t.a.values()),o=i.next();!o.done;o=i.next())var s=o.value,r=r.concat(s.i)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Tn(){}function Nn(){this.a=new Tn}function An(t,r,e){var i=e||"";try{qe(t,function(t,e){var n=t;P(t)&&(n=Gt(t)),r.push(i+e+"="+encodeURIComponent(n))})}catch(t){throw r.push(i+"type="+encodeURIComponent("_badmap")),t}}function xn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}vn.prototype.cancel=function(){var t,e;if(this.c=_n(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=E(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},Tn.prototype.stringify=function(t){return A.JSON.stringify(t,void 0)},Tn.prototype.parse=function(t){return A.JSON.parse(t,void 0)};var Sn=A.JSON.parse;function Dn(t){qt.call(this),this.headers=new Be,this.G=t||null,this.b=!1,this.s=this.a=null,this.D="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.H=Pn,this.B=this.F=!1}j(Dn,qt);var Pn="",Rn=/^https?$/i,On=["POST","PUT"];function kn(t){return"content-type"==t.toLowerCase()}function Ln(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Cn(t),Un(t)}function Cn(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Vn(t){if(t.b&&void 0!==N&&(!t.s[1]||4!=Mn(t)||2!=t.S()))if(t.l&&4==Mn(t))ne(t.va,0,t);else if(t.dispatchEvent("readystatechange"),4==Mn(t)){t.b=!1;try{var e,n,r,i,o=t.S();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if((e=s)||((n=0===o)&&(!(i=String(t.D).match(He)[1]||null)&&A.self&&A.self.location&&(i=(r=A.self.location.protocol).substr(0,r.length-1)),n=!Rn.test(i?i.toLowerCase():"")),e=n),e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Mn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.S()+"]",Cn(t)}}finally{Un(t)}}}function Un(t,e){if(t.a){jn(t);var n=t.a,r=t.s[0]?x:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function jn(t){t.a&&t.B&&(t.a.ontimeout=null),t.m&&(A.clearTimeout(t.m),t.m=null)}function Mn(t){return t.a?t.a.readyState:0}function Fn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",J(n,function(t,e){i+=e,i+=":",i+=t,i+="\r\n"}),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):$e(t,e,n))}function qn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Bn(t){this.f=[],this.R=this.ea=this.v=this.P=this.a=this.ha=this.s=this.N=this.h=this.F=this.j=null,this.Fa=this.H=0,this.Ca=qn("failFast",!1,t),this.U=this.l=this.i=this.g=this.c=null,this.W=!0,this.A=this.ia=this.G=-1,this.J=this.m=this.o=0,this.Ba=qn("baseRetryDelayMs",5e3,t),this.Ga=qn("retryDelaySeedMs",1e4,t),this.Da=qn("forwardChannelMaxRetries",2,t),this.ga=qn("forwardChannelRequestTimeoutMs",2e4,t),this.Ea=t&&t.nb||void 0,this.D=void 0,this.w=t&&t.supportsCrossDomainXhr||!1,this.B="",this.b=new vn(t&&t.concurrentRequestLimit),this.ja=new Nn,this.fa=t&&t.fastHandshake||!1,t&&t.forceLongPolling&&(this.W=!1),this.O=void 0}function Gn(t){var e,n;zn(t),3==t.u&&(e=t.H++,$e(n=Ye(t.v),"SID",t.B),$e(n,"RID",e),$e(n,"TYPE","terminate"),Xn(t,n),(e=new Se(t,e,void 0)).B=2,e.f=Ze(Ye(n)),n=!1,A.navigator&&A.navigator.sendBeacon&&(n=A.navigator.sendBeacon(e.f.toString(),"")),!n&&A.Image&&((new Image).src=e.f,n=!0),n||(e.a=ir(e.g,null),e.a.$(e.f)),e.s=U(),Ce(e)),nr(t)}function zn(t){t.a&&(t.a.cancel(),t.a=null),t.i&&(A.clearTimeout(t.i),t.i=null),$n(t),t.b.cancel(),t.g&&("number"==typeof t.g&&A.clearTimeout(t.g),t.g=null)}function Hn(t,e){t.f.push(new yn(t.Fa++,e)),3==t.u&&Wn(t)}function Wn(t){mn(t.b)||t.g||(t.g=!0,Qt(t.xa,t),t.o=0)}function Yn(t,e){var n=e?e.W:t.H++,r=Ye(t.v);$e(r,"SID",t.B),$e(r,"RID",n),$e(r,"AID",t.G),Xn(t,r),t.h&&t.j&&Fn(r,t.h,t.j),n=new Se(t,n,t.o+1),null===t.h&&(n.m=t.j),e&&(t.f=e.i.concat(t.f)),e=Kn(t,n,1e3),n.setTimeout(Math.round(.5*t.ga)+Math.round(.5*t.ga*Math.random())),In(t.b,n),Oe(n,r,e)}function Xn(t,n){t.c&&qe({},function(t,e){$e(n,e,t)})}function Kn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?C(t.c.Ha,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var h=i[a].b,c=i[a].a;if((h-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{An(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(u){r=s.join("&");break t}}return t=t.f.splice(0,n),e.i=t,r}function Qn(t){t.a||t.i||(t.J=1,Qt(t.wa,t),t.m=0)}function Jn(t){return!(t.a||t.i||3<=t.m)&&(t.J++,t.i=ge(C(t.wa,t),tr(t,t.m)),t.m++,1)}function $n(t){null!=t.l&&(A.clearTimeout(t.l),t.l=null)}function Zn(t,e){var n,r=null;if(t.a==e){$n(t),t.a=null;var i=2}else{if(!bn(t.b,e))return;r=e.i,En(t.b,e),i=1}if(t.A=e.H,0!=t.u)if(e.b){1==i?(r=e.j?e.j.length:0,e=U()-e.s,n=t.o,(i=fe()).dispatchEvent(new ve(i)),Wn(t)):Qn(t)}else if(3==(n=e.c)||0==n&&0<t.A||!(1==i&&function(t,e){if(!(wn(t.b)>=t.b.f-(t.g?1:0))){if(t.g)return t.f=e.i.concat(t.f),1;if(!(1==t.u||2==t.u||t.o>=(t.Ca?0:t.Da)))return t.g=ge(C(t.xa,t,e),tr(t,t.o)),t.o++,1}}(t,e)||2==i&&Jn(t)))switch(r&&0<r.length&&(e=t.b,e.c=e.c.concat(r)),n){case 1:er(t,5);break;case 4:er(t,10);break;case 3:er(t,6);break;default:er(t,2)}}function tr(t,e){var n=t.Ba+Math.floor(Math.random()*t.Ga);return t.c||(n*=2),n*e}function er(t,e){var n,r,i,o,s,u;2==e?(n=null,t.c&&(n=null),r=C(t.Ta,t),n||(n=new We("//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||Xe(n,"https"),Ze(n)),i=n.toString(),o=r,u=new he,A.Image?((s=new Image).onload=V(xn,u,s,"TestLoadImage: loaded",!0,o),s.onerror=V(xn,u,s,"TestLoadImage: error",!1,o),s.onabort=V(xn,u,s,"TestLoadImage: abort",!1,o),s.ontimeout=V(xn,u,s,"TestLoadImage: timeout",!1,o),A.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=i):o(!1)):ye(),t.u=0,t.c&&t.c.la(e),nr(t),zn(t)}function nr(t){t.u=0,t.A=-1,t.c&&(0==_n(t.b).length&&0==t.f.length||(t.b.c.length=0,G(t.f),t.f.length=0),t.c.ka())}function rr(t,e,n){var r,i,o,s,u,a,h,c=(r=n)instanceof We?Ye(r):new We(r,void 0);return""!=c.c?(e&&Ke(c,e+"."+c.c),Qe(c,c.h)):(o=(i=A.location).protocol,s=e?e+"."+i.hostname:i.hostname,u=+i.port,a=n,h=new We(null,void 0),o&&Xe(h,o),s&&Ke(h,s),u&&Qe(h,u),a&&(h.g=a),c=h),t.N&&J(t.N,function(t,e){$e(c,e,t)}),e=t.s,n=t.ha,e&&n&&$e(c,e,n),$e(c,"VER",t.oa),Xn(t,c),c}function ir(t,e){if(e&&!t.w)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Dn(t.Ea)).F=t.w,e}function or(){}function sr(){if(ot&&!(10<=Number(vt)))throw Error("Environmental error: no available transport.")}function ur(t,e){qt.call(this),this.a=new Bn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.j=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.pa&&(t?t["X-WebChannel-Client-Profile"]=e.pa:t={"X-WebChannel-Client-Profile":e.pa}),this.a.F=t,(t=e&&e.httpHeadersOverwriteParam)&&!z(t)&&(this.a.h=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!z(e)&&(this.a.s=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new cr(this)}function ar(t){Ne.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function hr(){Ae.call(this),this.status=1}function cr(t){this.a=t}(_=Dn.prototype).$=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.G?Ie(this.G):Ie(_e),this.a.onreadystatechange=C(this.va,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void Ln(this,t)}t=n||"";var i,o=new Be(this.headers);r&&qe(r,function(t,e){o.set(e,t)}),r=function(t){t:{for(var e=kn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.K()),n=A.FormData&&t instanceof A.FormData,0<=F(On,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.H&&(this.a.responseType=this.H),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{jn(this),0<this.o&&((this.B=(i=this.a,ot&&yt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=C(this.ta,this)):this.m=ne(this.ta,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Ln(this,t)}},_.ta=function(){void 0!==N&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},_.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Un(this))},_.C=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Un(this,!0)),Dn.M.C.call(this)},_.va=function(){this.j||(this.w||this.l||this.g?Vn(this):this.Oa())},_.Oa=function(){Vn(this)},_.S=function(){try{return 2<Mn(this)?this.a.status:-1}catch(t){return-1}},_.Y=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},_.Ja=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Sn(e)}},_.qa=function(){return this.h},_.Ma=function(){return"string"==typeof this.f?this.f:String(this.f)},(_=Bn.prototype).oa=8,_.u=1,_.xa=function(t){if(this.g)if(this.g=null,1==this.u){if(!t){this.H=Math.floor(1e5*Math.random()),t=this.H++;var e,n=new Se(this,t,void 0),r=this.j;if(this.F&&(r?tt(r=$(r),this.F):r=this.F),null===this.h&&(n.m=r),this.fa)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Kn(this,n,e),$e(i=Ye(this.v),"RID",t),$e(i,"CVER",22),this.s&&$e(i,"X-HTTP-Session-Id",this.s),Xn(this,i),this.h&&r&&Fn(i,this.h,r),In(this.b,n),this.fa?($e(i,"$req",e),$e(i,"SID","null"),n.R=!0,Oe(n,i,null)):Oe(n,i,e),this.u=2}}else 3==this.u&&(t?Yn(this,t):0==this.f.length||mn(this.b)||Yn(this))},_.wa=function(){this.i=null,this.a=new Se(this,"rpc",this.J),null===this.h&&(this.a.m=this.j),this.a.J=0;var t=Ye(this.ea);$e(t,"RID","rpc"),$e(t,"SID",this.B),$e(t,"CI",this.U?"0":"1"),$e(t,"AID",this.G),Xn(this,t),$e(t,"TYPE","xmlhttp"),this.h&&this.j&&Fn(t,this.h,this.j),this.D&&this.a.setTimeout(this.D);var e=this.a,n=this.R;e.B=1,e.f=Ze(Ye(t)),e.j=null,e.F=!0,ke(e,n)},_.Na=function(){null!=this.l&&(this.l=null,this.a.cancel(),this.a=null,Jn(this),ye())},_.Ta=function(t){ye()},(_=or.prototype).na=function(){},_.ma=function(){},_.la=function(){},_.ka=function(){},_.Ha=function(){},sr.prototype.a=function(t,e){return new ur(t,e)},j(ur,qt),(_=ur.prototype).addEventListener=function(t,e,n,r){ur.M.addEventListener.call(this,t,e,n,r)},_.removeEventListener=function(t,e,n,r){ur.M.removeEventListener.call(this,t,e,n,r)},_.Ka=function(){this.a.c=this.f,this.h&&(this.a.w=!0);var t=this.a,e=this.l,n=this.b||void 0;ye(),t.P=e,t.N=n||{},t.U=t.W,t.v=rr(t,null,t.P),Wn(t)},_.close=function(){Gn(this.a)},_.La=function(t){var e;"string"==typeof t?((e={}).__data__=t,Hn(this.a,e)):this.g?((e={}).__data__=Gt(t),Hn(this.a,e)):Hn(this.a,t)},_.C=function(){this.a.c=null,delete this.f,Gn(this.a),delete this.a,ur.M.C.call(this)},j(ar,Ne),j(hr,Ae),j(cr,or),cr.prototype.na=function(){this.a.dispatchEvent("a")},cr.prototype.ma=function(t){this.a.dispatchEvent(new ar(t))},cr.prototype.la=function(t){this.a.dispatchEvent(new hr)},cr.prototype.ka=function(){this.a.dispatchEvent("b")},sr.prototype.createWebChannel=sr.prototype.a,ur.prototype.send=ur.prototype.La,ur.prototype.open=ur.prototype.Ka,ur.prototype.close=ur.prototype.close,me.NO_ERROR=0,me.TIMEOUT=8,me.HTTP_ERROR=6,we.COMPLETE="complete",(Ee.EventType=Te).OPEN="a",Te.CLOSE="b",Te.ERROR="c",Te.MESSAGE="d",qt.prototype.listen=qt.prototype.ra,Dn.prototype.listenOnce=Dn.prototype.sa,Dn.prototype.getLastError=Dn.prototype.Ma,Dn.prototype.getLastErrorCode=Dn.prototype.qa,Dn.prototype.getStatus=Dn.prototype.S,Dn.prototype.getResponseJson=Dn.prototype.Ja,Dn.prototype.getResponseText=Dn.prototype.Y,Dn.prototype.send=Dn.prototype.$;var fr={createWebChannelTransport:function(){return new sr},ErrorCode:me,EventType:we,WebChannel:Ee,XhrIo:Dn},lr=fr.createWebChannelTransport,pr=fr.ErrorCode,dr=fr.EventType,yr=fr.WebChannel,vr=fr.XhrIo,gr=(mr.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},mr.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},mr.prototype.setServiceProps=function(t){return this.serviceProps=t,this},mr);function mr(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var wr=ld.SDK_VERSION,br=new h("@firebase/firestore");function Ir(){return br.logLevel}function Er(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];br.logLevel<=p.DEBUG&&(e=n.map(Tr),br.debug.apply(br,d(["Firestore ("+wr+"): "+t],e)))}function _r(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];br.logLevel<=p.ERROR&&(e=n.map(Tr),br.error.apply(br,d(["Firestore ("+wr+"): "+t],e)))}function Tr(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function Nr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE ("+wr+") INTERNAL ASSERTION FAILED: "+t;throw _r(e),new Error(e)}function Ar(t){t||Nr()}function xr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Sr=(Dr.t=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=xr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},Dr);function Dr(){}function Pr(t,e){return t<e?-1:e<t?1:0}function Rr(t,n,r){return t.length===n.length&&t.every(function(t,e){return r(t,n[e])})}function Or(t){return t+"\0"}function kr(t,e,n,r,i){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var Lr=(Object.defineProperty(Cr.prototype,"i",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),Cr.prototype.isEqual=function(t){return t instanceof Cr&&t.projectId===this.projectId&&t.database===this.database},Cr.prototype.o=function(t){return Pr(this.projectId,t.projectId)||Pr(this.database,t.database)},Cr);function Cr(t,e){this.projectId=t,this.database=e||"(default)"}function Vr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ur(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function jr(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var Mr,Fr,qr,Br=(oi.prototype.get=function(t){var e=this.h(t),n=this.l[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(this.u(s,t))return u}},oi.prototype.has=function(t){return void 0!==this.get(t)},oi.prototype.set=function(t,e){var n=this.h(t),r=this.l[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.u(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.l[n]=[[t,e]]},oi.prototype.delete=function(t){var e=this.h(t),n=this.l[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.u(n[r][0],t))return 1===n.length?delete this.l[e]:n.splice(r,1),!0;return!1},oi.prototype.forEach=function(u){Ur(this.l,function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n],o=i[0],s=i[1];u(o,s)}})},oi.prototype._=function(){return jr(this.l)},oi),Gr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},zr=(n(ii,qr=Error),ii),Hr=(ri.now=function(){return ri.fromMillis(Date.now())},ri.fromDate=function(t){return ri.fromMillis(t.getTime())},ri.fromMillis=function(t){var e=Math.floor(t/1e3);return new ri(e,1e6*(t-1e3*e))},ri.prototype.toDate=function(){return new Date(this.toMillis())},ri.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},ri.prototype.T=function(t){return this.seconds===t.seconds?Pr(this.nanoseconds,t.nanoseconds):Pr(this.seconds,t.seconds)},ri.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},ri.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},ri.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},ri),Wr=(ni.I=function(t){return new ni(t)},ni.min=function(){return new ni(new Hr(0,0))},ni.prototype.o=function(t){return this.timestamp.T(t.timestamp)},ni.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},ni.prototype.m=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},ni.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},ni.prototype.A=function(){return this.timestamp},ni),Yr=(Object.defineProperty(ei.prototype,"length",{get:function(){return this.R},enumerable:!1,configurable:!0}),ei.prototype.isEqual=function(t){return 0===ei.P(this,t)},ei.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof ei?t.forEach(function(t){e.push(t)}):e.push(t),this.V(e)},ei.prototype.limit=function(){return this.offset+this.length},ei.prototype.g=function(t){return t=void 0===t?1:t,this.V(this.segments,this.offset+t,this.length-t)},ei.prototype.p=function(){return this.V(this.segments,this.offset,this.length-1)},ei.prototype.v=function(){return this.segments[this.offset]},ei.prototype.S=function(){return this.get(this.length-1)},ei.prototype.get=function(t){return this.segments[this.offset+t]},ei.prototype._=function(){return 0===this.length},ei.prototype.D=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ei.prototype.C=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},ei.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},ei.prototype.F=function(){return this.segments.slice(this.offset,this.limit())},ei.P=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},ei),Xr=(n(ti,Fr=Yr),ti.prototype.V=function(t,e,n){return new ti(t,e,n)},ti.prototype.N=function(){return this.F().join("/")},ti.prototype.toString=function(){return this.N()},ti.$=function(t){if(0<=t.indexOf("//"))throw new zr(Gr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new ti(t.split("/").filter(function(t){return 0<t.length}))},ti.k=function(){return new ti([])},ti),Kr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Qr=(n(Zr,Mr=Yr),Zr.prototype.V=function(t,e,n){return new Zr(t,e,n)},Zr.M=function(t){return Kr.test(t)},Zr.prototype.N=function(){return this.F().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Zr.M(t)||(t="`"+t+"`"),t}).join(".")},Zr.prototype.toString=function(){return this.N()},Zr.prototype.O=function(){return 1===this.length&&"__name__"===this.get(0)},Zr.L=function(){return new Zr(["__name__"])},Zr.B=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new zr(Gr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new zr(Gr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new zr(Gr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new zr(Gr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Zr(e)},Zr.k=function(){return new Zr([])},Zr),Jr=($r.q=function(t){return new $r(Xr.$(t).g(5))},$r.prototype.U=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},$r.prototype.isEqual=function(t){return null!==t&&0===Xr.P(this.path,t.path)},$r.prototype.toString=function(){return this.path.toString()},$r.P=function(t,e){return Xr.P(t.path,e.path)},$r.W=function(t){return t.length%2==0},$r.j=function(t){return new $r(new Xr(t.slice()))},$r);function $r(t){this.path=t}function Zr(){return null!==Mr&&Mr.apply(this,arguments)||this}function ti(){return null!==Fr&&Fr.apply(this,arguments)||this}function ei(t,e,n){void 0===e?e=0:e>t.length&&Nr(),void 0===n?n=t.length-e:n>t.length-e&&Nr(),this.segments=t,this.offset=e,this.R=n}function ni(t){this.timestamp=t}function ri(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new zr(Gr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new zr(Gr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new zr(Gr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new zr(Gr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function ii(t,e){var n=this;return(n=qr.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}function oi(t,e){this.h=t,this.u=e,this.l={}}function si(t){return null==t}function ui(t){return-0===t&&1/t==-1/0}function ai(t){return"number"==typeof t&&Number.isInteger(t)&&!ui(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function hi(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.K=null}function ci(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new hi(t,e,n,r,i,o,s)}function fi(t){var e,n=t;return null===n.K&&(e=n.path.N(),null!==n.collectionGroup&&(e+="|cg:"+n.collectionGroup),e+="|f:",e+=n.filters.map(function(t){return(e=t).field.N()+e.op.toString()+po(e.value);var e}).join(","),e+="|ob:",e+=n.orderBy.map(function(t){return(e=t).field.N()+e.dir;var e}).join(","),si(n.limit)||(e+="|l:",e+=n.limit),n.startAt&&(e+="|lb:",e+=Pu(n.startAt)),n.endAt&&(e+="|ub:",e+=Pu(n.endAt)),n.K=e),n.K}function li(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n,r,i,o,s=0;s<t.orderBy.length;s++)if(n=t.orderBy[s],r=e.orderBy[s],n.dir!==r.dir||!n.field.isEqual(r.field))return!1;if(t.filters.length!==e.filters.length)return!1;for(var u=0;u<t.filters.length;u++)if(i=t.filters[u],o=e.filters[u],!(i instanceof lu&&o instanceof lu&&i.op===o.op&&i.field.isEqual(o.field)&&ho(i.value,o.value)))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Ou(t.startAt,e.startAt)&&Ou(t.endAt,e.endAt)}function pi(t){return Jr.W(t.path)&&null===t.collectionGroup&&0===t.filters.length}var di=(yi.fromBase64String=function(t){return new yi(atob(t))},yi.fromUint8Array=function(t){return new yi(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},yi.prototype.toBase64=function(){return t=this.G,btoa(t);var t},yi.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.G)},yi.prototype.H=function(){return 2*this.G.length},yi.prototype.o=function(t){return Pr(this.G,t.G)},yi.prototype.isEqual=function(t){return this.G===t.G},yi);function yi(t){this.G=t}function vi(t){this.count=t}di.Y=new di("");var gi,mi,wi=(bi.prototype.Z=function(t){return new bi(this.target,this.targetId,this.J,t,this.X,this.lastLimboFreeSnapshotVersion,this.resumeToken)},bi.prototype.tt=function(t,e){return new bi(this.target,this.targetId,this.J,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},bi.prototype.et=function(t){return new bi(this.target,this.targetId,this.J,this.sequenceNumber,this.X,t,this.resumeToken)},bi);function bi(t,e,n,r,i,o,s){void 0===i&&(i=Wr.min()),void 0===o&&(o=Wr.min()),void 0===s&&(s=di.Y),this.target=t,this.targetId=e,this.J=n,this.sequenceNumber=r,this.X=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Ii(t){switch(t){case Gr.OK:return Nr();case Gr.CANCELLED:case Gr.UNKNOWN:case Gr.DEADLINE_EXCEEDED:case Gr.RESOURCE_EXHAUSTED:case Gr.INTERNAL:case Gr.UNAVAILABLE:case Gr.UNAUTHENTICATED:return;case Gr.INVALID_ARGUMENT:case Gr.NOT_FOUND:case Gr.ALREADY_EXISTS:case Gr.PERMISSION_DENIED:case Gr.FAILED_PRECONDITION:case Gr.ABORTED:case Gr.OUT_OF_RANGE:case Gr.UNIMPLEMENTED:case Gr.DATA_LOSS:return 1;default:return Nr()}}function Ei(t){if(void 0===t)return _r("GRPC error has no .code"),Gr.UNKNOWN;switch(t){case gi.OK:return Gr.OK;case gi.CANCELLED:return Gr.CANCELLED;case gi.UNKNOWN:return Gr.UNKNOWN;case gi.DEADLINE_EXCEEDED:return Gr.DEADLINE_EXCEEDED;case gi.RESOURCE_EXHAUSTED:return Gr.RESOURCE_EXHAUSTED;case gi.INTERNAL:return Gr.INTERNAL;case gi.UNAVAILABLE:return Gr.UNAVAILABLE;case gi.UNAUTHENTICATED:return Gr.UNAUTHENTICATED;case gi.INVALID_ARGUMENT:return Gr.INVALID_ARGUMENT;case gi.NOT_FOUND:return Gr.NOT_FOUND;case gi.ALREADY_EXISTS:return Gr.ALREADY_EXISTS;case gi.PERMISSION_DENIED:return Gr.PERMISSION_DENIED;case gi.FAILED_PRECONDITION:return Gr.FAILED_PRECONDITION;case gi.ABORTED:return Gr.ABORTED;case gi.OUT_OF_RANGE:return Gr.OUT_OF_RANGE;case gi.UNIMPLEMENTED:return Gr.UNIMPLEMENTED;case gi.DATA_LOSS:return Gr.DATA_LOSS;default:return Nr()}}(mi=gi=gi||{})[mi.OK=0]="OK",mi[mi.CANCELLED=1]="CANCELLED",mi[mi.UNKNOWN=2]="UNKNOWN",mi[mi.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",mi[mi.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",mi[mi.NOT_FOUND=5]="NOT_FOUND",mi[mi.ALREADY_EXISTS=6]="ALREADY_EXISTS",mi[mi.PERMISSION_DENIED=7]="PERMISSION_DENIED",mi[mi.UNAUTHENTICATED=16]="UNAUTHENTICATED",mi[mi.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",mi[mi.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",mi[mi.ABORTED=10]="ABORTED",mi[mi.OUT_OF_RANGE=11]="OUT_OF_RANGE",mi[mi.UNIMPLEMENTED=12]="UNIMPLEMENTED",mi[mi.INTERNAL=13]="INTERNAL",mi[mi.UNAVAILABLE=14]="UNAVAILABLE",mi[mi.DATA_LOSS=15]="DATA_LOSS";var _i=(Si.prototype.nt=function(t,e){return new Si(this.P,this.root.nt(t,e,this.P).copy(null,null,Ni.st,null,null))},Si.prototype.remove=function(t){return new Si(this.P,this.root.remove(t,this.P).copy(null,null,Ni.st,null,null))},Si.prototype.get=function(t){for(var e=this.root;!e._();){var n=this.P(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},Si.prototype.indexOf=function(t){for(var e=0,n=this.root;!n._();){var r=this.P(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},Si.prototype._=function(){return this.root._()},Object.defineProperty(Si.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),Si.prototype.it=function(){return this.root.it()},Si.prototype.rt=function(){return this.root.rt()},Si.prototype.ot=function(t){return this.root.ot(t)},Si.prototype.forEach=function(n){this.ot(function(t,e){return n(t,e),!1})},Si.prototype.toString=function(){var n=[];return this.ot(function(t,e){return n.push(t+":"+e),!1}),"{"+n.join(", ")+"}"},Si.prototype.ht=function(t){return this.root.ht(t)},Si.prototype.at=function(){return new Ti(this.root,null,this.P,!1)},Si.prototype.ut=function(t){return new Ti(this.root,t,this.P,!1)},Si.prototype.ct=function(){return new Ti(this.root,null,this.P,!0)},Si.prototype.lt=function(t){return new Ti(this.root,t,this.P,!0)},Si),Ti=(xi.prototype.dt=function(){var t=this.ft.pop(),e={key:t.key,value:t.value};if(this._t)for(t=t.left;!t._();)this.ft.push(t),t=t.right;else for(t=t.right;!t._();)this.ft.push(t),t=t.left;return e},xi.prototype.wt=function(){return 0<this.ft.length},xi.prototype.Tt=function(){if(0===this.ft.length)return null;var t=this.ft[this.ft.length-1];return{key:t.key,value:t.value}},xi),Ni=(Ai.prototype.copy=function(t,e,n,r,i){return new Ai(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},Ai.prototype._=function(){return!1},Ai.prototype.ot=function(t){return this.left.ot(t)||t(this.key,this.value)||this.right.ot(t)},Ai.prototype.ht=function(t){return this.right.ht(t)||t(this.key,this.value)||this.left.ht(t)},Ai.prototype.min=function(){return this.left._()?this:this.left.min()},Ai.prototype.it=function(){return this.min().key},Ai.prototype.rt=function(){return this.right._()?this.key:this.right.rt()},Ai.prototype.nt=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.nt(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.nt(t,e,n))).Et()},Ai.prototype.It=function(){if(this.left._())return Ai.EMPTY;var t=this;return t.left.At()||t.left.left.At()||(t=t.Rt()),(t=t.copy(null,null,null,t.left.It(),null)).Et()},Ai.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left._()||r.left.At()||r.left.left.At()||(r=r.Rt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.At()&&(r=r.Pt()),r.right._()||r.right.At()||r.right.left.At()||(r=r.Vt()),0===e(t,r.key)){if(r.right._())return Ai.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.It())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.Et()},Ai.prototype.At=function(){return this.color},Ai.prototype.Et=function(){var t=this;return t.right.At()&&!t.left.At()&&(t=t.gt()),t.left.At()&&t.left.left.At()&&(t=t.Pt()),t.left.At()&&t.right.At()&&(t=t.yt()),t},Ai.prototype.Rt=function(){var t=this.yt();return t.right.left.At()&&(t=(t=(t=t.copy(null,null,null,null,t.right.Pt())).gt()).yt()),t},Ai.prototype.Vt=function(){var t=this.yt();return t.left.left.At()&&(t=(t=t.Pt()).yt()),t},Ai.prototype.gt=function(){var t=this.copy(null,null,Ai.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},Ai.prototype.Pt=function(){var t=this.copy(null,null,Ai.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},Ai.prototype.yt=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},Ai.prototype.pt=function(){var t=this.bt();return Math.pow(2,t)<=this.size+1},Ai.prototype.bt=function(){if(this.At()&&this.left.At())throw Nr();if(this.right.At())throw Nr();var t=this.left.bt();if(t!==this.right.bt())throw Nr();return t+(this.At()?0:1)},Ai);function Ai(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Ai.RED,this.left=null!=r?r:Ai.EMPTY,this.right=null!=i?i:Ai.EMPTY,this.size=this.left.size+1+this.right.size}function xi(t,e,n,r){this._t=r,this.ft=[];for(var i=1;!t._();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this._t?t.left:t.right;else{if(0===i){this.ft.push(t);break}this.ft.push(t),t=this._t?t.right:t.left}}function Si(t,e){this.P=t,this.root=e||Ni.EMPTY}function Di(){this.size=0}Ni.EMPTY=null,Ni.RED=!0,Ni.st=!1,Ni.EMPTY=(Object.defineProperty(Di.prototype,"key",{get:function(){throw Nr()},enumerable:!1,configurable:!0}),Object.defineProperty(Di.prototype,"value",{get:function(){throw Nr()},enumerable:!1,configurable:!0}),Object.defineProperty(Di.prototype,"color",{get:function(){throw Nr()},enumerable:!1,configurable:!0}),Object.defineProperty(Di.prototype,"left",{get:function(){throw Nr()},enumerable:!1,configurable:!0}),Object.defineProperty(Di.prototype,"right",{get:function(){throw Nr()},enumerable:!1,configurable:!0}),Di.prototype.copy=function(t,e,n,r,i){return this},Di.prototype.nt=function(t,e,n){return new Ni(t,e)},Di.prototype.remove=function(t,e){return this},Di.prototype._=function(){return!0},Di.prototype.ot=function(t){return!1},Di.prototype.ht=function(t){return!1},Di.prototype.it=function(){return null},Di.prototype.rt=function(){return null},Di.prototype.At=function(){return!1},Di.prototype.pt=function(){return!0},Di.prototype.bt=function(){return 0},new Di);var Pi=(Li.prototype.has=function(t){return null!==this.data.get(t)},Li.prototype.first=function(){return this.data.it()},Li.prototype.last=function(){return this.data.rt()},Object.defineProperty(Li.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),Li.prototype.indexOf=function(t){return this.data.indexOf(t)},Li.prototype.forEach=function(n){this.data.ot(function(t,e){return n(t),!1})},Li.prototype.vt=function(t,e){for(var n=this.data.ut(t[0]);n.wt();){var r=n.dt();if(0<=this.P(r.key,t[1]))return;e(r.key)}},Li.prototype.St=function(t,e){for(var n=void 0!==e?this.data.ut(e):this.data.at();n.wt();)if(!t(n.dt().key))return},Li.prototype.Dt=function(t){var e=this.data.ut(t);return e.wt()?e.dt().key:null},Li.prototype.at=function(){return new Ri(this.data.at())},Li.prototype.ut=function(t){return new Ri(this.data.ut(t))},Li.prototype.add=function(t){return this.copy(this.data.remove(t).nt(t,!0))},Li.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},Li.prototype._=function(){return this.data._()},Li.prototype.Ct=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},Li.prototype.isEqual=function(t){if(!(t instanceof Li))return!1;if(this.size!==t.size)return!1;for(var e=this.data.at(),n=t.data.at();e.wt();){var r=e.dt().key,i=n.dt().key;if(0!==this.P(r,i))return!1}return!0},Li.prototype.F=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},Li.prototype.toString=function(){var e=[];return this.forEach(function(t){return e.push(t)}),"SortedSet("+e.toString()+")"},Li.prototype.copy=function(t){var e=new Li(this.P);return e.data=t,e},Li),Ri=(ki.prototype.dt=function(){return this.Ft.dt().key},ki.prototype.wt=function(){return this.Ft.wt()},ki),Oi=new _i(Jr.P);function ki(t){this.Ft=t}function Li(t){this.P=t,this.data=new _i(this.P)}var Ci=new _i(Jr.P);var Vi=new _i(Jr.P),Ui=new Pi(Jr.P);function ji(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=Ui,r=0,i=t;r<i.length;r++)var o=i[r],n=n.add(o);return n}var Mi=new Pi(Pr);function Fi(t,e,n,r){this.Zt=t,this.removedTargetIds=e,this.key=n,this.te=r}function qi(t,e){this.targetId=t,this.ee=e}function Bi(t,e,n,r){void 0===n&&(n=di.Y),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var Gi=(no.kt=function(t){return new no(t.P)},no.prototype.has=function(t){return null!=this.Nt.get(t)},no.prototype.get=function(t){return this.Nt.get(t)},no.prototype.first=function(){return this.$t.it()},no.prototype.last=function(){return this.$t.rt()},no.prototype._=function(){return this.$t._()},no.prototype.indexOf=function(t){var e=this.Nt.get(t);return e?this.$t.indexOf(e):-1},Object.defineProperty(no.prototype,"size",{get:function(){return this.$t.size},enumerable:!1,configurable:!0}),no.prototype.forEach=function(n){this.$t.ot(function(t,e){return n(t),!1})},no.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.Nt.nt(t.key,t),e.$t.nt(t,null))},no.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.Nt.remove(t),this.$t.remove(e)):this},no.prototype.isEqual=function(t){if(!(t instanceof no))return!1;if(this.size!==t.size)return!1;for(var e=this.$t.at(),n=t.$t.at();e.wt();){var r=e.dt().key,i=n.dt().key;if(!r.isEqual(i))return!1}return!0},no.prototype.toString=function(){var e=[];return this.forEach(function(t){e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"},no.prototype.copy=function(t,e){var n=new no;return n.P=this.P,n.Nt=t,n.$t=e,n},no),zi=(eo.prototype.track=function(t){var e=t.doc.key,n=this.xt.get(e);!n||0!==t.type&&3===n.type?this.xt=this.xt.nt(e,t):3===t.type&&1!==n.type?this.xt=this.xt.nt(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.xt=this.xt.nt(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.xt=this.xt.nt(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.xt=this.xt.remove(e):1===t.type&&2===n.type?this.xt=this.xt.nt(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.xt=this.xt.nt(e,{type:2,doc:t.doc}):Nr()},eo.prototype.Mt=function(){var n=[];return this.xt.ot(function(t,e){n.push(e)}),n},eo),Hi=(to.Ut=function(t,e,n,r){var i=[];return e.forEach(function(t){i.push({type:0,doc:t})}),new to(t,e,Gi.kt(e),i,n,r,!0,!1)},Object.defineProperty(to.prototype,"hasPendingWrites",{get:function(){return!this.Lt._()},enumerable:!1,configurable:!0}),to.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.Bt===t.Bt&&this.Lt.isEqual(t.Lt)&&su(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ot.isEqual(t.Ot)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},to),Wi=(Zi.Gt=function(t,e){var n=new Map;return n.set(t,Yi.zt(t,e)),new Zi(Wr.min(),n,Mi,Oi,ji())},Zi),Yi=($i.zt=function(t,e){return new $i(di.Y,e,ji(),ji(),ji())},$i),Xi=(Object.defineProperty(Ji.prototype,"Ht",{get:function(){return this.re},enumerable:!1,configurable:!0}),Object.defineProperty(Ji.prototype,"resumeToken",{get:function(){return this.ie},enumerable:!1,configurable:!0}),Object.defineProperty(Ji.prototype,"he",{get:function(){return 0!==this.ne},enumerable:!1,configurable:!0}),Object.defineProperty(Ji.prototype,"ae",{get:function(){return this.oe},enumerable:!1,configurable:!0}),Ji.prototype.ue=function(t){0<t.H()&&(this.oe=!0,this.ie=t)},Ji.prototype.ce=function(){var n=ji(),r=ji(),i=ji();return this.se.forEach(function(t,e){switch(e){case 0:n=n.add(t);break;case 2:r=r.add(t);break;case 1:i=i.add(t);break;default:Nr()}}),new Yi(this.ie,this.re,n,r,i)},Ji.prototype.le=function(){this.oe=!1,this.se=io()},Ji.prototype._e=function(t,e){this.oe=!0,this.se=this.se.nt(t,e)},Ji.prototype.fe=function(t){this.oe=!0,this.se=this.se.remove(t)},Ji.prototype.de=function(){this.ne+=1},Ji.prototype.we=function(){--this.ne},Ji.prototype.Te=function(){this.oe=!0,this.re=!0},Ji),Ki=(Qi.prototype.Pe=function(t){for(var e=0,n=t.Zt;e<n.length;e++){var r=n[e];t.te instanceof $s?this.Ve(r,t.te):t.te instanceof Zs&&this.ge(r,t.key,t.te)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.ge(s,t.key,t.te)}},Qi.prototype.ye=function(n){var r=this;this.pe(n,function(t){var e=r.be(t);switch(n.state){case 0:r.ve(t)&&e.ue(n.resumeToken);break;case 1:e.we(),e.he||e.le(),e.ue(n.resumeToken);break;case 2:e.we(),e.he||r.removeTarget(t);break;case 3:r.ve(t)&&(e.Te(),e.ue(n.resumeToken));break;case 4:r.ve(t)&&(r.Se(t),e.ue(n.resumeToken));break;default:Nr()}})},Qi.prototype.pe=function(t,n){var r=this;0<t.targetIds.length?t.targetIds.forEach(n):this.Ie.forEach(function(t,e){r.ve(e)&&n(e)})},Qi.prototype.De=function(t){var e,n,r=t.targetId,i=t.ee.count,o=this.Ce(r);o&&(pi(e=o.target)?0===i?(n=new Jr(e.path),this.ge(r,n,new Zs(n,Wr.min()))):Ar(1===i):this.Fe(r)!==i&&(this.Se(r),this.Re=this.Re.add(r)))},Qi.prototype.Ne=function(i){var o=this,s=new Map;this.Ie.forEach(function(t,e){var n,r=o.Ce(e);r&&(t.Ht&&pi(r.target)&&(n=new Jr(r.target.path),null!==o.me.get(n)||o.$e(e,n)||o.ge(e,n,new Zs(n,i))),t.ae&&(s.set(e,t.ce()),t.le()))});var r=ji();this.Ae.forEach(function(t,e){var n=!0;e.St(function(t){var e=o.Ce(t);return!e||2===e.J||(n=!1)}),n&&(r=r.add(t))});var t=new Wi(i,s,this.Re,this.me,r);return this.me=Oi,this.Ae=ro(),this.Re=new Pi(Pr),t},Qi.prototype.Ve=function(t,e){var n;this.ve(t)&&(n=this.$e(t,e.key)?2:0,this.be(t)._e(e.key,n),this.me=this.me.nt(e.key,e),this.Ae=this.Ae.nt(e.key,this.ke(e.key).add(t)))},Qi.prototype.ge=function(t,e,n){var r;this.ve(t)&&(r=this.be(t),this.$e(t,e)?r._e(e,1):r.fe(e),this.Ae=this.Ae.nt(e,this.ke(e).delete(t)),n&&(this.me=this.me.nt(e,n)))},Qi.prototype.removeTarget=function(t){this.Ie.delete(t)},Qi.prototype.Fe=function(t){var e=this.be(t).ce();return this.Ee.xe(t).size+e.Yt.size-e.Xt.size},Qi.prototype.de=function(t){this.be(t).de()},Qi.prototype.be=function(t){var e=this.Ie.get(t);return e||(e=new Xi,this.Ie.set(t,e)),e},Qi.prototype.ke=function(t){var e=this.Ae.get(t);return e||(e=new Pi(Pr),this.Ae=this.Ae.nt(t,e)),e},Qi.prototype.ve=function(t){var e=null!==this.Ce(t);return e||Er("WatchChangeAggregator","Detected inactive target",t),e},Qi.prototype.Ce=function(t){var e=this.Ie.get(t);return e&&e.he?null:this.Ee.Me(t)},Qi.prototype.Se=function(e){var n=this;this.Ie.set(e,new Xi),this.Ee.xe(e).forEach(function(t){n.ge(e,t,null)})},Qi.prototype.$e=function(t,e){return this.Ee.xe(t).has(e)},Qi);function Qi(t){this.Ee=t,this.Ie=new Map,this.me=Oi,this.Ae=ro(),this.Re=new Pi(Pr)}function Ji(){this.ne=0,this.se=io(),this.ie=di.Y,this.re=!1,this.oe=!0}function $i(t,e,n,r,i){this.resumeToken=t,this.Ht=e,this.Yt=n,this.Jt=r,this.Xt=i}function Zi(t,e,n,r,i){this.X=t,this.Qt=e,this.Wt=n,this.jt=r,this.Kt=i}function to(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.Ot=n,this.docChanges=r,this.Lt=i,this.fromCache=o,this.Bt=s,this.qt=u}function eo(){this.xt=new _i(Jr.P)}function no(n){this.P=n?function(t,e){return n(t,e)||Jr.P(t.key,e.key)}:function(t,e){return Jr.P(t.key,e.key)},this.Nt=Ci,this.$t=new _i(this.P)}function ro(){return new _i(Jr.P)}function io(){return new _i(Jr.P)}function oo(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function so(t){var e=yo(t.mapValue.fields.__local_write_time__.timestampValue);return new Hr(e.seconds,e.nanos)}var uo=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ao(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?oo(t)?4:10:Nr()}function ho(r,i){var t,e,n,o=ao(r);if(o!==ao(i))return!1;switch(o){case 0:return!0;case 1:return r.booleanValue===i.booleanValue;case 4:return so(r).isEqual(so(i));case 3:return function(t){if("string"==typeof r.timestampValue&&"string"==typeof t.timestampValue&&r.timestampValue.length===t.timestampValue.length)return r.timestampValue===t.timestampValue;var e=yo(r.timestampValue),n=yo(t.timestampValue);return e.seconds===n.seconds&&e.nanos===n.nanos}(i);case 5:return r.stringValue===i.stringValue;case 6:return n=i,go(r.bytesValue).isEqual(go(n.bytesValue));case 7:return r.referenceValue===i.referenceValue;case 8:return e=i,vo((t=r).geoPointValue.latitude)===vo(e.geoPointValue.latitude)&&vo(t.geoPointValue.longitude)===vo(e.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return vo(t.integerValue)===vo(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=vo(t.doubleValue),r=vo(e.doubleValue);return n===r?ui(n)===ui(r):isNaN(n)&&isNaN(r)}return!1}(r,i);case 9:return Rr(r.arrayValue.values||[],i.arrayValue.values||[],ho);case 10:return function(){var t=r.mapValue.fields||{},e=i.mapValue.fields||{};if(Vr(t)!==Vr(e))return!1;for(var n in t)if(t.hasOwnProperty(n)&&(void 0===e[n]||!ho(t[n],e[n])))return!1;return!0}();default:return Nr()}}function co(t,e){return void 0!==(t.values||[]).find(function(t){return ho(t,e)})}function fo(t,e){var n,r,i,o,s,u,a,h,c,f,l=ao(t),p=ao(e);if(l!==p)return Pr(l,p);switch(l){case 0:return 0;case 1:return Pr(t.booleanValue,e.booleanValue);case 2:return h=e,(c=vo(t.integerValue||t.doubleValue))<(f=vo(h.integerValue||h.doubleValue))?-1:f<c?1:c===f?0:isNaN(c)?isNaN(f)?0:-1:1;case 3:return lo(t.timestampValue,e.timestampValue);case 4:return lo(so(t),so(e));case 5:return Pr(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=go(o),a=go(s),u.o(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Pr(n[i],r[i]);if(0!==o)return o}return Pr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=Pr(vo(n.latitude),vo(r.latitude)))?i:Pr(vo(n.longitude),vo(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=fo(n[i],r[i]);if(o)return o}return Pr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=Pr(r[s],o[s]);if(0!==u)return u;var a=fo(n[r[s]],i[o[s]]);if(0!==a)return a}return Pr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Nr()}}function lo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Pr(t,e);var n=yo(t),r=yo(e),i=Pr(n.seconds,r.seconds);return 0!==i?i:Pr(n.nanos,r.nanos)}function po(t){return function s(i){return"nullValue"in i?"null":"booleanValue"in i?""+i.booleanValue:"integerValue"in i?""+i.integerValue:"doubleValue"in i?""+i.doubleValue:"timestampValue"in i?"time("+(t=yo(i.timestampValue)).seconds+","+t.nanos+")":"stringValue"in i?i.stringValue:"bytesValue"in i?go(i.bytesValue).toBase64():"referenceValue"in i?(n=i.referenceValue,Jr.q(n).toString()):"geoPointValue"in i?"geo("+(e=i.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in i?function(){for(var t="[",e=!0,n=0,r=i.arrayValue.values||[];n<r.length;n++)e?e=!1:t+=",",t+=s(r[n]);return t+"]"}():"mapValue"in i?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+s(t.fields[o])}return e+"}"}(i.mapValue):Nr();var t,e,n}(t)}function yo(t){if(Ar(!!t),"string"!=typeof t)return{seconds:vo(t.seconds),nanos:vo(t.nanos)};var e,n=0,r=uo.exec(t);Ar(!!r),r[1]&&(e=((e=r[1])+"000000000").substr(0,9),n=Number(e));var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:n}}function vo(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function go(t){return"string"==typeof t?di.fromBase64String(t):di.fromUint8Array(t)}function mo(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.N()}}function wo(t){return t&&"integerValue"in t}function bo(t){return!!t&&"arrayValue"in t}function Io(t){return t&&"nullValue"in t}function Eo(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function _o(t){return t&&"mapValue"in t}var To={asc:"ASCENDING",desc:"DESCENDING"},No={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ao=function(t,e){this.s=t,this.Oe=e};function xo(t){return{integerValue:""+t}}function So(t,e){if(t.Oe){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ui(e)?"-0":e}}function Do(t,e){return ai(e)?xo(e):So(t,e)}function Po(t,e){return t.Oe?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ro(t,e){return t.Oe?e.toBase64():e.toUint8Array()}function Oo(t){return Ar(!!t),Wr.I((e=yo(t),new Hr(e.seconds,e.nanos)));var e}function ko(t,e){return new Xr(["projects",t.projectId,"databases",t.database]).child("documents").child(e).N()}function Lo(t){var e=Xr.$(t);return Ar(Qo(e)),e}function Co(t,e){return ko(t.s,e.path)}function Vo(t,e){var n=Lo(e);return Ar(n.get(1)===t.s.projectId),Ar(!n.get(3)&&!t.s.database||n.get(3)===t.s.database),new Jr(Fo(n))}function Uo(t,e){return ko(t.s,e)}function jo(t){var e=Lo(t);return 4===e.length?Xr.k():Fo(e)}function Mo(t){return new Xr(["projects",t.s.projectId,"databases",t.s.database]).N()}function Fo(t){return Ar(4<t.length&&"documents"===t.get(4)),t.g(5)}function qo(t,e,n){return{name:Co(t,e),fields:n.proto.mapValue.fields}}function Bo(t,e){var n,r,i,o;if(e instanceof Ss)n={update:qo(t,e.key,e.value)};else if(e instanceof Ms)n={delete:Co(t,e.key)};else if(e instanceof Ds)n={update:qo(t,e.key,e.data),updateMask:(r=e.Le,i=[],r.fields.forEach(function(t){return i.push(t.N())}),{fieldPaths:i})};else if(e instanceof Ls)n={transform:{document:Co(t,e.key),fieldTransforms:e.fieldTransforms.map(function(t){var e=t.transform;if(e instanceof es)return{fieldPath:t.field.N(),setToServerValue:"REQUEST_TIME"};if(e instanceof ns)return{fieldPath:t.field.N(),appendMissingElements:{values:e.elements}};if(e instanceof us)return{fieldPath:t.field.N(),removeAllFromArray:{values:e.elements}};if(e instanceof fs)return{fieldPath:t.field.N(),increment:e.Be};throw Nr()})}};else{if(!(e instanceof Fs))return Nr();n={verify:Co(t,e.key)}}return e.Ue.qe||(n.currentDocument=void 0!==(o=e.Ue).updateTime?{updateTime:Po(t,o.updateTime.A())}:void 0!==o.exists?{exists:o.exists}:Nr()),n}function Go(e,t){var n,r,i=t.currentDocument?void 0!==(n=t.currentDocument).updateTime?ws.updateTime(Oo(n.updateTime)):void 0!==n.exists?ws.exists(n.exists):ws.Qe():ws.Qe();if(t.update){t.update.name;var o=Vo(e,t.update.name),s=new qs({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=(r=t.updateMask.fieldPaths||[],new ys(r.map(function(t){return Qr.B(t)})));return new Ds(o,s,u,i)}return new Ss(o,s,i)}if(t.delete){var a=Vo(e,t.delete);return new Ms(a,i)}if(t.transform){var h=Vo(e,t.transform.document),c=t.transform.fieldTransforms.map(function(t){return function(t,e){var n,r,i=null;"setToServerValue"in e?(Ar("REQUEST_TIME"===e.setToServerValue),i=new es):"appendMissingElements"in e?(n=e.appendMissingElements.values||[],i=new ns(n)):"removeAllFromArray"in e?(r=e.removeAllFromArray.values||[],i=new us(r)):"increment"in e?i=new fs(t,e.increment):Nr();var o=Qr.B(e.fieldPath);return new vs(o,i)}(e,t)});return Ar(!0===i.exists),new Ls(h,c)}if(t.verify){var f=Vo(e,t.verify);return new Fs(f,i)}return Nr()}function zo(t,e){return{documents:[Uo(t,e.path)]}}function Ho(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Uo(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Uo(t,r.p()),n.structuredQuery.from=[{collectionId:r.S()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return t instanceof lu?function(t){if("=="===t.op){if(Eo(t.value))return{unaryFilter:{field:Xo(t.field),op:"IS_NAN"}};if(Io(t.value))return{unaryFilter:{field:Xo(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:Xo(t.field),op:(e=t.op,No[e]),value:t.value}};var e}(t):Nr()});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return{field:Xo((e=t).field),direction:(n=e.dir,To[n])};var e,n})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s,u=(s=e.limit,t.Oe||si(s)?s:{value:s});return null!==u&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=Wo(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Wo(e.endAt)),n}function Wo(t){return{before:t.before,values:t.position}}function Yo(t){var e=!!t.before,n=t.values||[];return new Tu(n,e)}function Xo(t){return{fieldPath:t.N()}}function Ko(t){return Qr.B(t.fieldPath)}function Qo(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}function Jo(){this.je=void 0}function $o(t,e){return t instanceof fs?wo(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}var Zo,ts,es=(n(is,ts=Jo),is),ns=(n(rs,Zo=Jo),rs);function rs(t){var e=this;return(e=Zo.call(this)||this).elements=t,e}function is(){return null!==ts&&ts.apply(this,arguments)||this}function os(t,e){for(var n=ds(e),r=function(e){n.some(function(t){return ho(t,e)})||n.push(e)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ss,us=(n(as,ss=Jo),as);function as(t){var e=this;return(e=ss.call(this)||this).elements=t,e}function hs(t,e){for(var n=ds(e),r=function(e){n=n.filter(function(t){return!ho(t,e)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var cs,fs=(n(ls,cs=Jo),ls);function ls(t,e){var n=this;return(n=cs.call(this)||this).serializer=t,n.Be=e,n}function ps(t){return vo(t.integerValue||t.doubleValue)}function ds(t){return bo(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var ys=(gs.prototype.Ke=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].D(t))return!0;return!1},gs.prototype.isEqual=function(t){return Rr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},gs),vs=function(t,e){this.field=t,this.transform=e};function gs(t){(this.fields=t).sort(Qr.P)}function ms(t,e){this.version=t,this.transformResults=e}var ws=(bs.Qe=function(){return new bs},bs.exists=function(t){return new bs(void 0,t)},bs.updateTime=function(t){return new bs(t)},Object.defineProperty(bs.prototype,"qe",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),bs.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},bs);function bs(t,e){this.updateTime=t,this.exists=e}function Is(t,e){return void 0!==t.updateTime?e instanceof $s&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof $s}function Es(){}function _s(t,e,n,r){return t instanceof Ss?function(t,e){if(!Is(t.Ue,e))return e;var n=Ns(e);return new $s(t.key,n,t.value,{Ge:!0})}(t,e):t instanceof Ds?function(t,e){if(!Is(t.Ue,e))return e;var n=Ns(e),r=Os(t,e);return new $s(t.key,n,r,{Ge:!0})}(t,e):t instanceof Ls?function(t,e,n,r){if(!Is(t.Ue,e))return e;var i=e,o=function(t,e,n,r){for(var i,o,s,u,a,h,c=[],f=0,l=t;f<l.length;f++){var p=l[f],d=p.transform,y=null;n instanceof $s&&(y=n.field(p.field)),null===y&&r instanceof $s&&(y=r.field(p.field)),c.push((o=y,h=a=u=s=void 0,(i=d)instanceof es?(h={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}},o&&(h.fields.__previous_value__=o),{mapValue:h}):i instanceof ns?os(i,o):i instanceof us?hs(i,o):(a=ps(u=$o(s=i,o))+ps(s.Be),wo(u)&&wo(s.Be)?xo(a):So(s.serializer,a))))}return c}(t.fieldTransforms,n,e,r),s=Vs(t,i.data(),o);return new $s(t.key,i.version,s,{Ge:!0})}(t,e,r,n):(o=e,Is((i=t).Ue,o)?new Zs(i.key,Wr.min()):o);var i,o}function Ts(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ue.isEqual(e.Ue)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Le.isEqual(e.Le):2!==t.type||Rr(t.fieldTransforms,t.fieldTransforms,function(t,e){return r=e,(n=t).field.isEqual(r.field)&&(i=n.transform,o=r.transform,i instanceof ns&&o instanceof ns||i instanceof us&&o instanceof us?Rr(i.elements,o.elements,ho):i instanceof fs&&o instanceof fs?ho(i.Be,o.Be):i instanceof es&&o instanceof es);var n,r,i,o}))}function Ns(t){return t instanceof $s?t.version:Wr.min()}var As,xs,Ss=(n(Rs,xs=Es),Rs),Ds=(n(Ps,As=Es),Ps);function Ps(t,e,n,r){var i=this;return(i=As.call(this)||this).key=t,i.data=e,i.Le=n,i.Ue=r,i.type=1,i}function Rs(t,e,n){var r=this;return(r=xs.call(this)||this).key=t,r.value=e,r.Ue=n,r.type=0,r}function Os(t,e){return n=t,r=e instanceof $s?e.data():qs.empty(),i=new Bs(r),n.Le.fields.forEach(function(t){var e;t._()||(null!==(e=n.data.field(t))?i.set(t,e):i.delete(t))}),i.ze();var n,r,i}var ks,Ls=(n(Cs,ks=Es),Cs);function Cs(t,e){var n=this;return(n=ks.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Ue=ws.exists(!0),n}function Vs(t,e,n){for(var r=new Bs(e),i=0;i<t.fieldTransforms.length;i++){var o=t.fieldTransforms[i];r.set(o.field,n[i])}return r.ze()}var Us,js,Ms=(n(Ws,js=Es),Ws),Fs=(n(Hs,Us=Es),Hs),qs=(zs.empty=function(){return new zs({mapValue:{}})},zs.prototype.field=function(t){if(t._())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!_o(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.S()])||null},zs.prototype.isEqual=function(t){return ho(this.proto,t.proto)},zs),Bs=(Gs.prototype.set=function(t,e){return this.Je(t,e),this},Gs.prototype.delete=function(t){return this.Je(t,null),this},Gs.prototype.Je=function(t,e){for(var n=this.Ye,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map||(o=o&&10===ao(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),n=o}n.set(t.S(),e)},Gs.prototype.ze=function(){var t=this.Xe(Qr.k(),this.Ye);return null!=t?new qs(t):this.He},Gs.prototype.Xe=function(r,t){var i=this,o=!1,e=this.He.field(r),s=_o(e)?Object.assign({},e.mapValue.fields):{};return t.forEach(function(t,e){var n;t instanceof Map?null!=(n=i.Xe(r.child(e),t))&&(s[e]=n,o=!0):null!==t?(s[e]=t,o=!0):s.hasOwnProperty(e)&&(delete s[e],o=!0)}),o?{mapValue:{fields:s}}:null},Gs);function Gs(t){void 0===t&&(t=qs.empty()),this.He=t,this.Ye=new Map}function zs(t){this.proto=t}function Hs(t,e){var n=this;return(n=Us.call(this)||this).key=t,n.Ue=e,n.type=4,n}function Ws(t,e){var n=this;return(n=js.call(this)||this).key=t,n.Ue=e,n.type=3,n}function Ys(t){var u=[];return Ur(t.fields||{},function(t,e){var n=new Qr([t]);if(_o(e)){var r=Ys(e.mapValue).fields;if(0===r.length)u.push(n);else for(var i=0,o=r;i<o.length;i++){var s=o[i];u.push(n.child(s))}}else u.push(n)}),new ys(u)}function Xs(t,e){this.key=t,this.version=e}var Ks,Qs,Js,$s=(n(ou,Js=Xs),ou.prototype.field=function(t){return this.Ze.field(t)},ou.prototype.data=function(){return this.Ze},ou.prototype.tn=function(){return this.Ze.proto},ou.prototype.isEqual=function(t){return t instanceof ou&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.Ge===t.Ge&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Ze.isEqual(t.Ze)},ou.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.Ze.toString()+", {hasLocalMutations: "+this.Ge+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(ou.prototype,"hasPendingWrites",{get:function(){return this.Ge||this.hasCommittedMutations},enumerable:!1,configurable:!0}),ou),Zs=(n(iu,Qs=Xs),iu.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(iu.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!1,configurable:!0}),iu.prototype.isEqual=function(t){return t instanceof iu&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},iu),tu=(n(ru,Ks=Xs),ru.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(ru.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!1,configurable:!0}),ru.prototype.isEqual=function(t){return t instanceof ru&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},ru),eu=(nu.hn=function(t){return new nu(t)},Object.defineProperty(nu.prototype,"orderBy",{get:function(){if(null===this.sn){this.sn=[];var t=this.an(),e=this.un();if(null!==t&&null===e)t.O()||this.sn.push(new ku(t)),this.sn.push(new ku(Qr.L(),"asc"));else{for(var n,r=!1,i=0,o=this.en;i<o.length;i++){var s=o[i];this.sn.push(s),s.field.O()&&(r=!0)}r||(n=0<this.en.length?this.en[this.en.length-1].dir:"asc",this.sn.push(new ku(Qr.L(),n)))}}return this.sn},enumerable:!1,configurable:!0}),nu.prototype.cn=function(t){var e=this.filters.concat([t]);return new nu(this.path,this.collectionGroup,this.en.slice(),e,this.limit,this.nn,this.startAt,this.endAt)},nu.prototype.ln=function(t){var e=this.en.concat([t]);return new nu(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.nn,this.startAt,this.endAt)},nu.prototype._n=function(t){return new nu(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),t,"F",this.startAt,this.endAt)},nu.prototype.fn=function(t){return new nu(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),t,"L",this.startAt,this.endAt)},nu.prototype.dn=function(t){return new nu(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),this.limit,this.nn,t,this.endAt)},nu.prototype.wn=function(t){return new nu(this.path,this.collectionGroup,this.en.slice(),this.filters.slice(),this.limit,this.nn,this.startAt,t)},nu.prototype.Tn=function(t){return new nu(t,null,this.en.slice(),this.filters.slice(),this.limit,this.nn,this.startAt,this.endAt)},nu.prototype.En=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.en.length||1===this.en.length&&this.en[0].field.O())},nu.prototype.In=function(){return!si(this.limit)&&"F"===this.nn},nu.prototype.mn=function(){return!si(this.limit)&&"L"===this.nn},nu.prototype.un=function(){return 0<this.en.length?this.en[0].field:null},nu.prototype.an=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof lu&&n.An())return n.field}return null},nu.prototype.Rn=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof lu&&0<=t.indexOf(r.op))return r.op}return null},nu.prototype.Pn=function(){return pi(this.We())},nu.prototype.Vn=function(){return null!==this.collectionGroup},nu.prototype.We=function(){if(!this.rn)if("F"===this.nn)this.rn=ci(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i="desc"===r.dir?"asc":"desc";t.push(new ku(r.field,i))}var o=this.endAt?new Tu(this.endAt.position,!this.endAt.before):null,s=this.startAt?new Tu(this.startAt.position,!this.startAt.before):null;this.rn=ci(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.rn},nu.prototype.on=function(t){},nu);function nu(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.en=n,this.filters=r,this.limit=i,this.nn=o,this.startAt=s,this.endAt=u,this.sn=null,this.rn=null,this.startAt&&this.on(this.startAt),this.endAt&&this.on(this.endAt)}function ru(){return null!==Ks&&Ks.apply(this,arguments)||this}function iu(t,e,n){var r=this;return(r=Qs.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function ou(t,e,n,r){var i=this;return(i=Js.call(this,t,e)||this).Ze=n,i.Ge=!!r.Ge,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function su(t,e){return li(t.We(),e.We())&&t.nn===e.nn}function uu(t){return fi(t.We())+"|lt:"+t.nn}function au(t){return"Query(target="+(n=(e=t.We()).path.N(),null!==e.collectionGroup&&(n+=" collectionGroup="+e.collectionGroup),0<e.filters.length&&(n+=", filters: ["+e.filters.map(function(t){return(e=t).field.N()+" "+e.op+" "+po(e.value);var e}).join(", ")+"]"),si(e.limit)||(n+=", limit: "+e.limit),0<e.orderBy.length&&(n+=", orderBy: ["+e.orderBy.map(function(t){return(e=t).field.N()+" ("+e.dir+")";var e}).join(", ")+"]"),e.startAt&&(n+=", startAt: "+Pu(e.startAt)),e.endAt&&(n+=", endAt: "+Pu(e.endAt)),"Target("+n+")")+"; limitType="+t.nn+")";var e,n}function hu(i,t){return r=i,o=t.key.path,(null!==r.collectionGroup?t.key.U(r.collectionGroup)&&r.path.D(o):Jr.W(r.path)?r.path.isEqual(o):r.path.C(o))&&function(t){for(var e=0,n=i.en;e<n.length;e++){var r=n[e];if(!r.field.O()&&null===t.field(r.field))return}return 1}(t)&&function(t){for(var e=0,n=i.filters;e<n.length;e++)if(!n[e].matches(t))return;return 1}(t)&&(n=t,(!(e=i).startAt||Ru(e.startAt,e.orderBy,n))&&(!e.endAt||!Ru(e.endAt,e.orderBy,n)));var e,n,r,o}function cu(u){return function(t,e){for(var n=!1,r=0,i=u.orderBy;r<i.length;r++){var o=i[r],s=Lu(o,t,e);if(0!==s)return s;n=n||o.field.O()}return 0}}var fu,lu=(n(pu,fu=function(){}),pu.create=function(t,e,n){if(t.O())return"in"===e?new bu(t,n):new wu(t,e,n);if(Io(n)){if("=="!==e)throw new zr(Gr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new pu(t,e,n)}if(Eo(n)){if("=="!==e)throw new zr(Gr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new pu(t,e,n)}return"array-contains"===e?new Iu(t,n):"in"===e?new Eu(t,n):"array-contains-any"===e?new _u(t,n):new pu(t,e,n)},pu.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&ao(this.value)===ao(e)&&this.gn(fo(e,this.value))},pu.prototype.gn=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case">":return 0<t;case">=":return 0<=t;default:return Nr()}},pu.prototype.An=function(){return 0<=["<","<=",">",">="].indexOf(this.op)},pu);function pu(t,e,n){var r=this;return(r=fu.call(this)||this).field=t,r.op=e,r.value=n,r}var du,yu,vu,gu,mu,wu=(n(Du,mu=lu),Du.prototype.matches=function(t){var e=Jr.P(t.key,this.key);return this.gn(e)},Du),bu=(n(Su,gu=lu),Su.prototype.matches=function(e){return this.keys.some(function(t){return t.isEqual(e.key)})},Su),Iu=(n(xu,vu=lu),xu.prototype.matches=function(t){var e=t.field(this.field);return bo(e)&&co(e.arrayValue,this.value)},xu),Eu=(n(Au,yu=lu),Au.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&co(this.value.arrayValue,e)},Au),_u=(n(Nu,du=lu),Nu.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!bo(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return co(e.value.arrayValue,t)})},Nu),Tu=function(t,e){this.position=t,this.before=e};function Nu(t,e){return du.call(this,t,"array-contains-any",e)||this}function Au(t,e){return yu.call(this,t,"in",e)||this}function xu(t,e){return vu.call(this,t,"array-contains",e)||this}function Su(t,e){var n=this;return(n=gu.call(this,t,"in",e)||this).keys=(e.arrayValue.values||[]).map(function(t){return Jr.q(t.referenceValue)}),n}function Du(t,e,n){var r=this;return(r=mu.call(this,t,e,n)||this).key=Jr.q(n.referenceValue),r}function Pu(t){return(t.before?"b":"a")+":"+t.position.map(po).join(",")}function Ru(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i],r=o.field.O()?Jr.P(Jr.q(s.referenceValue),n.key):fo(s,n.field(o.field));if("desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Ou(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!ho(t.position[n],e.position[n]))return!1;return!0}var ku=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Lu(t,e,n){var r,i,o,s,u=t.field.O()?Jr.P(e.key,n.key):(r=t.field,i=n,o=e.field(r),s=i.field(r),null!==o&&null!==s?fo(o,s):Nr());switch(t.dir){case"asc":return u;case"desc":return-1*u;default:return Nr()}}var Cu=(Ju.prototype.pn=function(t,e,n){for(var r,i,o,s=n.bn,u=0;u<this.mutations.length;u++){var a=this.mutations[u];a.key.isEqual(t)&&(r=a,i=e,o=s[u],e=r instanceof Ss?new $s(r.key,o.version,r.value,{hasCommittedMutations:!0}):r instanceof Ds?function(t,e,n){if(!Is(t.Ue,e))return new tu(t.key,n.version);var r=Os(t,e);return new $s(t.key,n.version,r,{hasCommittedMutations:!0})}(r,i,o):r instanceof Ls?function(t,e,n){if(Ar(null!=n.transformResults),!Is(t.Ue,e))return new tu(t.key,n.version);var r=e,i=function(t,e,n){var r,i,o,s=[];Ar(t.length===n.length);for(var u=0;u<n.length;u++){var a=t[u],h=a.transform,c=null;e instanceof $s&&(c=e.field(a.field)),s.push((r=h,i=c,o=n[u],r instanceof ns?os(r,i):r instanceof us?hs(r,i):o))}return s}(t.fieldTransforms,e,n.transformResults),o=n.version,s=Vs(t,r.data(),i);return new $s(t.key,o,s,{hasCommittedMutations:!0})}(r,i,o):new Zs(r.key,o.version,{hasCommittedMutations:!0}))}return e},Ju.prototype.vn=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=_s(i,e,e,this.yn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=_s(a,e,o,this.yn))}return e},Ju.prototype.Sn=function(n){var r=this,i=n;return this.mutations.forEach(function(t){var e=r.vn(t.key,n.get(t.key));e&&(i=i.nt(t.key,e))}),i},Ju.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},ji())},Ju.prototype.isEqual=function(t){return this.batchId===t.batchId&&Rr(this.mutations,t.mutations,Ts)&&Rr(this.baseMutations,t.baseMutations,Ts)},Ju),Vu=(Qu.from=function(t,e,n){Ar(t.mutations.length===n.length);for(var r=Vi,i=t.mutations,o=0;o<i.length;o++)r=r.nt(i[o].key,n[o].version);return new Qu(t,e,n,r)},Qu),Uu=(Ku.prototype.catch=function(t){return this.next(void 0,t)},Ku.prototype.next=function(r,i){var o=this;return this.kn&&Nr(),this.kn=!0,this.$n?this.error?this.xn(i,this.error):this.Mn(r,this.result):new Ku(function(e,n){o.Fn=function(t){o.Mn(r,t).next(e,n)},o.Nn=function(t){o.xn(i,t).next(e,n)}})},Ku.prototype.On=function(){var n=this;return new Promise(function(t,e){n.next(t,e)})},Ku.prototype.Ln=function(t){try{var e=t();return e instanceof Ku?e:Ku.resolve(e)}catch(t){return Ku.reject(t)}},Ku.prototype.Mn=function(t,e){return t?this.Ln(function(){return t(e)}):Ku.resolve(e)},Ku.prototype.xn=function(t,e){return t?this.Ln(function(){return t(e)}):Ku.reject(e)},Ku.resolve=function(n){return new Ku(function(t,e){t(n)})},Ku.reject=function(n){return new Ku(function(t,e){e(n)})},Ku.Bn=function(t){return new Ku(function(e,n){var r=0,i=0,o=!1;t.forEach(function(t){++r,t.next(function(){++i,o&&i===r&&e()},function(t){return n(t)})}),o=!0,i===r&&e()})},Ku.qn=function(t){for(var n=Ku.resolve(!1),e=function(e){n=n.next(function(t){return t?Ku.resolve(t):e()})},r=0,i=t;r<i.length;r++)e(i[r]);return n},Ku.forEach=function(t,n){var r=this,i=[];return t.forEach(function(t,e){i.push(n.call(r,t,e))}),this.Bn(i)},Ku),ju=(Object.defineProperty(Xu.prototype,"readTime",{get:function(){return this.Wn},set:function(t){this.Wn=t},enumerable:!1,configurable:!0}),Xu.prototype.jn=function(t,e){this.Kn(),this.readTime=e,this.Un.set(t.key,t)},Xu.prototype.Gn=function(t,e){this.Kn(),e&&(this.readTime=e),this.Un.set(t,null)},Xu.prototype.zn=function(t,e){this.Kn();var n=this.Un.get(e);return void 0!==n?Uu.resolve(n):this.Hn(t,e)},Xu.prototype.getEntries=function(t,e){return this.Yn(t,e)},Xu.prototype.apply=function(t){return this.Kn(),this.Qn=!0,this.Jn(t)},Xu.prototype.Kn=function(){},Xu),Mu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Fu=(Yu.prototype.Zn=function(t){this.Xn.push(t)},Yu.prototype.ts=function(){this.Xn.forEach(function(t){return t()})},Yu),qu=(Wu.prototype.rs=function(e,n){var r=this;return this.ns.os(e,n).next(function(t){return r.hs(e,n,t)})},Wu.prototype.hs=function(t,r,i){return this.es.zn(t,r).next(function(t){for(var e=0,n=i;e<n.length;e++)t=n[e].vn(r,t);return t})},Wu.prototype.as=function(t,e,i){var o=Oi;return e.forEach(function(t,e){for(var n=0,r=i;n<r.length;n++)e=r[n].vn(t,e);o=o.nt(t,e)}),o},Wu.prototype.us=function(e,t){var n=this;return this.es.getEntries(e,t).next(function(t){return n.cs(e,t)})},Wu.prototype.cs=function(r,i){var o=this;return this.ns.ls(r,i).next(function(t){var e=o.as(r,i,t),n=Oi;return e.forEach(function(t,e){e=e||new Zs(t,Wr.min()),n=n.nt(t,e)}),n})},Wu.prototype._s=function(t,e,n){return e.Pn()?this.fs(t,e.path):e.Vn()?this.ds(t,e,n):this.ws(t,e,n)},Wu.prototype.fs=function(t,e){return this.rs(t,new Jr(e)).next(function(t){var e=Ci;return t instanceof $s&&(e=e.nt(t.key,t)),e})},Wu.prototype.ds=function(n,r,i){var o=this,s=r.collectionGroup,u=Ci;return this.ss.Ts(n,s).next(function(t){return Uu.forEach(t,function(t){var e=r.Tn(t.child(s));return o.ws(n,e,i).next(function(t){t.forEach(function(t,e){u=u.nt(t,e)})})}).next(function(){return u})})},Wu.prototype.ws=function(e,n,t){var c,f,r=this;return this.es._s(e,n,t).next(function(t){return c=t,r.ns.Es(e,n)}).next(function(t){return f=t,r.Is(e,f,c).next(function(t){c=t;for(var e=0,n=f;e<n.length;e++)for(var r=n[e],i=0,o=r.mutations;i<o.length;i++){var s=o[i],u=s.key,a=c.get(u),h=_s(s,a,a,r.yn);c=h instanceof $s?c.nt(u,h):c.remove(u)}})}).next(function(){return c.forEach(function(t,e){hu(n,e)||(c=c.remove(t))}),c})},Wu.prototype.Is=function(t,e,n){for(var r=ji(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof Ds&&null===n.get(a.key)&&(r=r.add(a.key))}var h=n;return this.es.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof $s&&(h=h.nt(t,e))}),h})},Wu),Bu=(Hu.Rs=function(t,e){for(var n=ji(),r=ji(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new Hu(t,e.fromCache,n,r)},Hu),Gu=(zu.prototype.Vs=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},zu.prototype.next=function(){var t=++this.previousValue;return this.gs&&this.gs(t),t},zu);function zu(t,e){var n=this;this.previousValue=t,e&&(e.Ps=function(t){return n.Vs(t)},this.gs=function(t){return e.ys(t)})}function Hu(t,e,n,r){this.targetId=t,this.fromCache=e,this.ms=n,this.As=r}function Wu(t,e,n){this.es=t,this.ns=e,this.ss=n}function Yu(){this.Xn=[]}function Xu(){this.Un=new Br(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.Qn=!1}function Ku(t){var e=this;this.Fn=null,this.Nn=null,this.result=void 0,this.error=void 0,this.$n=!1,this.kn=!1,t(function(t){e.$n=!0,e.result=t,e.Fn&&e.Fn(t)},function(t){e.$n=!0,e.error=t,e.Nn&&e.Nn(t)})}function Qu(t,e,n,r){this.batch=t,this.Dn=e,this.bn=n,this.Cn=r}function Ju(t,e,n,r){this.batchId=t,this.yn=e,this.baseMutations=n,this.mutations=r}function $u(){var n=this;this.promise=new Promise(function(t,e){n.resolve=t,n.reject=e})}Gu.ps=-1;var Zu=(ta.prototype.reset=function(){this.Fs=0},ta.prototype.ks=function(){this.Fs=this.Cs},ta.prototype.xs=function(t){var e=this;this.cancel();var n=Math.floor(this.Fs+this.Ms()),r=Math.max(0,Date.now()-this.$s),i=Math.max(0,n-r);0<i&&Er("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.Fs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ns=this.bs.Os(this.vs,i,function(){return e.$s=Date.now(),t()}),this.Fs*=this.Ds,this.Fs<this.Ss&&(this.Fs=this.Ss),this.Fs>this.Cs&&(this.Fs=this.Cs)},ta.prototype.Ls=function(){null!==this.Ns&&(this.Ns.Bs(),this.Ns=null)},ta.prototype.cancel=function(){null!==this.Ns&&(this.Ns.cancel(),this.Ns=null)},ta.prototype.Ms=function(){return(Math.random()-.5)*this.Fs},ta);function ta(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.bs=t,this.vs=e,this.Ss=n,this.Ds=r,this.Cs=i,this.Fs=0,this.Ns=null,this.$s=Date.now(),this.reset()}function ea(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=ra(e)),e=na(t.get(n),e);return ra(e)}function na(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="";break;case"":n+="";break;default:n+=o}}return n}function ra(t){return t+""}function ia(t){var e=t.length;if(Ar(2<=e),2===e)return Ar(""===t.charAt(0)&&""===t.charAt(1)),Xr.k();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("",o);switch((s<0||n<s)&&Nr(),t.charAt(s+1)){case"":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"":i+=t.substring(o,s),i+="\0";break;case"":i+=t.substring(o,s+1);break;default:Nr()}o=s+2}return new Xr(r)}var oa=(ca.prototype.Us=function(t,e){return this.qs.add(e),Uu.resolve()},ca.prototype.Ts=function(t,e){return Uu.resolve(this.qs.getEntries(e))},ca),sa=(ha.prototype.add=function(t){var e=t.S(),n=t.p(),r=this.index[e]||new Pi(Xr.P),i=!r.has(n);return this.index[e]=r.add(n),i},ha.prototype.has=function(t){var e=t.S(),n=t.p(),r=this.index[e];return r&&r.has(n)},ha.prototype.getEntries=function(t){return(this.index[t]||new Pi(Xr.P)).F()},ha),ua=(aa.prototype.Us=function(t,e){var n=this;if(this.Qs.has(e))return Uu.resolve();var r=e.S(),i=e.p();t.Zn(function(){n.Qs.add(e)});var o={collectionId:r,parent:ea(i)};return fa(t).put(o)},aa.prototype.Ts=function(t,i){var o=[],e=IDBKeyRange.bound([i,""],[Or(i),""],!1,!0);return fa(t).Ws(e).next(function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(r.collectionId!==i)break;o.push(ia(r.parent))}return o})},aa);function aa(){this.Qs=new sa}function ha(){this.index={}}function ca(){this.qs=new sa}function fa(t){return Fa.js(t,gh.store)}function la(t){this.Ks=t}function pa(t,e){if(e.document)return n=t.Ks,r=e.document,i=!!e.hasCommittedMutations,o=Vo(n,r.name),s=Oo(r.updateTime),u=new qs({mapValue:{fields:r.fields}}),new $s(o,s,u,{hasCommittedMutations:!!i});var n,r,i,o,s,u;if(e.noDocument){var a=Jr.j(e.noDocument.path),h=ma(e.noDocument.readTime);return new Zs(a,h,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){var c=Jr.j(e.unknownDocument.path),f=ma(e.unknownDocument.version);return new tu(c,f)}return Nr()}function da(t,e,n){var r,i,o=ya(n),s=e.key.path.p().F();if(e instanceof $s){var u={name:Co(r=t.Ks,(i=e).key),fields:i.tn().mapValue.fields,updateTime:Po(r,i.version.A())},a=e.hasCommittedMutations;return new lh(null,null,u,a,o,s)}if(e instanceof Zs){var h=e.key.path.F(),c=ga(e.version),f=e.hasCommittedMutations;return new lh(null,new ch(h,c),null,f,o,s)}if(e instanceof tu){var l=e.key.path.F(),p=ga(e.version);return new lh(new fh(l,p),null,null,!0,o,s)}return Nr()}function ya(t){var e=t.A();return[e.seconds,e.nanoseconds]}function va(t){var e=new Hr(t[0],t[1]);return Wr.I(e)}function ga(t){var e=t.A();return new rh(e.seconds,e.nanoseconds)}function ma(t){var e=new Hr(t.seconds,t.nanoseconds);return Wr.I(e)}function wa(e,t){var n=(t.baseMutations||[]).map(function(t){return Go(e.Ks,t)}),r=t.mutations.map(function(t){return Go(e.Ks,t)}),i=Hr.fromMillis(t.localWriteTimeMs);return new Cu(t.batchId,i,n,r)}function ba(t){var e=ma(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?ma(t.lastLimboFreeSnapshotVersion):Wr.min(),r=(void 0!==t.query.documents?function(t){Ar(1===t.documents.length);var e=t.documents[0];return eu.hn(jo(e)).We()}:function(t){var e,n=jo(t.parent),r=t.structuredQuery,i=r.from?r.from.length:0,o=null;0<i&&(Ar(1===i),(e=r.from[0]).allDescendants?o=e.collectionId:n=n.child(e.collectionId));var s=[];r.where&&(s=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=Ko(t.unaryFilter.field);return lu.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=Ko(t.unaryFilter.field);return lu.create(n,"==",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Nr()}}(e)]:void 0!==e.fieldFilter?[(n=e,lu.create(Ko(n.fieldFilter.field),function(){switch(n.fieldFilter.op){case"EQUAL":return"==";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Nr()}}(),n.fieldFilter.value))]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(t).reduce(function(t,e){return t.concat(e)}):Nr():[];var n}(r.where));var u=[];r.orderBy&&(u=r.orderBy.map(function(t){return new ku(Ko((e=t).field),function(){switch(e.direction){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}());var e}));var a,h,c=null;r.limit&&(c=si(h="object"==typeof(a=r.limit)?a.value:a)?null:h);var f=null;r.startAt&&(f=Yo(r.startAt));var l=null;return r.endAt&&(l=Yo(r.endAt)),new eu(n,o,u,s,c,"F",f,l).We()})(t.query);return new wi(r,t.targetId,0,t.lastListenSequenceNumber,e,n,di.fromBase64String(t.resumeToken))}function Ia(t,e){var n=ga(e.X),r=ga(e.lastLimboFreeSnapshotVersion),i=(pi(e.target)?zo:Ho)(t.Ks,e.target),o=e.resumeToken.toBase64();return new dh(e.targetId,fi(e.target),n,o,e.sequenceNumber,r,i)}var Ea,_a=(Ta.prototype.jn=function(t,e,n){return Aa(t).put(xa(e),n)},Ta.prototype.Gn=function(t,e){var n=Aa(t),r=xa(e);return n.delete(r)},Ta.prototype.updateMetadata=function(e,n){var r=this;return this.getMetadata(e).next(function(t){return t.byteSize+=n,r.Gs(e,t)})},Ta.prototype.zn=function(t,e){var n=this;return Aa(t).get(xa(e)).next(function(t){return n.zs(t)})},Ta.prototype.Hs=function(t,e){var n=this;return Aa(t).get(xa(e)).next(function(t){var e=n.zs(t);return e?{Ys:e,size:Sa(t)}:null})},Ta.prototype.getEntries=function(t,e){var r=this,i=Oi;return this.Js(t,e,function(t,e){var n=r.zs(e);i=i.nt(t,n)}).next(function(){return i})},Ta.prototype.Xs=function(t,e){var r=this,i=Oi,o=new _i(Jr.P);return this.Js(t,e,function(t,e){var n=r.zs(e);o=n?(i=i.nt(t,n),o.nt(t,Sa(e))):(i=i.nt(t,null),o.nt(t,0))}).next(function(){return{Zs:i,ti:o}})},Ta.prototype.Js=function(t,e,i){if(e._())return Uu.resolve();var n=IDBKeyRange.bound(e.first().path.F(),e.last().path.F()),o=e.at(),s=o.dt();return Aa(t).ei({range:n},function(t,e,n){for(var r=Jr.j(t);s&&Jr.P(s,r)<0;)i(s,null),s=o.dt();s&&s.isEqual(r)&&(i(s,e),s=o.wt()?o.dt():null),s?n.ni(s.path.F()):n.done()}).next(function(){for(;s;)i(s,null),s=o.wt()?o.dt():null})},Ta.prototype._s=function(t,i,e){var n,r,o,s=this,u=Ci,a=i.path.length+1,h={};return e.isEqual(Wr.min())?(n=i.path.F(),h.range=IDBKeyRange.lowerBound(n)):(r=i.path.F(),o=ya(e),h.range=IDBKeyRange.lowerBound([r,o],!0),h.index=lh.collectionReadTimeIndex),Aa(t).ei(h,function(t,e,n){var r;t.length===a&&(r=pa(s.serializer,e),i.path.D(r.key.path)?r instanceof $s&&hu(i,r)&&(u=u.nt(r.key,r)):n.done())}).next(function(){return u})},Ta.prototype.si=function(t,e){var r=this,i=Oi,o=ya(e),n=Aa(t),s=IDBKeyRange.lowerBound(o,!0);return n.ei({index:lh.readTimeIndex,range:s},function(t,e){var n=pa(r.serializer,e);i=i.nt(n.key,n),o=e.readTime}).next(function(){return{ii:i,readTime:va(o)}})},Ta.prototype.ri=function(t){var e=Aa(t),r=Wr.min();return e.ei({index:lh.readTimeIndex,reverse:!0},function(t,e,n){e.readTime&&(r=va(e.readTime)),n.done()}).next(function(){return r})},Ta.prototype.oi=function(t){return new Ta.hi(this,!!t&&t.ai)},Ta.prototype.ui=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},Ta.prototype.getMetadata=function(t){return Na(t).get(ph.key).next(function(t){return Ar(!!t),t})},Ta.prototype.Gs=function(t,e){return Na(t).put(ph.key,e)},Ta.prototype.zs=function(t){if(t){var e=pa(this.serializer,t);return e instanceof Zs&&e.version.isEqual(Wr.min())?null:e}return null},Ta);function Ta(t,e){this.serializer=t,this.ss=e}function Na(t){return Fa.js(t,ph.store)}function Aa(t){return Fa.js(t,lh.store)}function xa(t){return t.path.F()}function Sa(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Nr();e=t.noDocument}return JSON.stringify(e).length}function Da(t,e){var n=this;return(n=Ea.call(this)||this).ci=t,n.ai=e,n.li=new Br(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),n}_a.hi=(n(Da,Ea=ju),Da.prototype.Jn=function(s){var u=this,a=[],h=0,c=new Pi(function(t,e){return Pr(t.N(),e.N())});return this.Un.forEach(function(t,e){var n,r,i,o=u.li.get(t);e?(n=da(u.ci.serializer,e,u.readTime),c=c.add(t.path.p()),r=Sa(n),h+=r-o,a.push(u.ci.jn(s,t,n))):(h-=o,u.ai?(i=da(u.ci.serializer,new Zs(t,Wr.min()),u.readTime),a.push(u.ci.jn(s,t,i))):a.push(u.ci.Gn(s,t)))}),c.forEach(function(t){a.push(u.ci.ss.Us(s,t))}),a.push(this.ci.updateMetadata(s,h)),Uu.Bn(a)},Da.prototype.Hn=function(t,e){var n=this;return this.ci.Hs(t,e).next(function(t){return null===t?(n.li.set(e,0),null):(n.li.set(e,t.size),t.Ys)})},Da.prototype.Yn=function(t,e){var n=this;return this.ci.Xs(t,e).next(function(t){var e=t.Zs;return t.ti.forEach(function(t,e){n.li.set(t,e)}),e})},Da);var Pa=(ka.prototype.next=function(){return this._i+=2,this._i},ka.fi=function(){return new ka(0)},ka.di=function(){return new ka(-1)},ka),Ra=(Oa.prototype.Ti=function(n){var r=this;return this.Ei(n).next(function(t){var e=new Pa(t.highestTargetId);return t.highestTargetId=e.next(),r.Ii(n,t).next(function(){return t.highestTargetId})})},Oa.prototype.mi=function(t){return this.Ei(t).next(function(t){return Wr.I(new Hr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},Oa.prototype.Ai=function(t){return this.Ei(t).next(function(t){return t.highestListenSequenceNumber})},Oa.prototype.Ri=function(e,n,r){var i=this;return this.Ei(e).next(function(t){return t.highestListenSequenceNumber=n,r&&(t.lastRemoteSnapshotVersion=r.A()),n>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=n),i.Ii(e,t)})},Oa.prototype.Pi=function(e,n){var r=this;return this.Vi(e,n).next(function(){return r.Ei(e).next(function(t){return t.targetCount+=1,r.gi(n,t),r.Ii(e,t)})})},Oa.prototype.yi=function(t,e){return this.Vi(t,e)},Oa.prototype.pi=function(e,t){var n=this;return this.bi(e,t.targetId).next(function(){return La(e).delete(t.targetId)}).next(function(){return n.Ei(e)}).next(function(t){return Ar(0<t.targetCount),--t.targetCount,n.Ii(e,t)})},Oa.prototype.vi=function(r,i,o){var s=this,u=0,a=[];return La(r).ei(function(t,e){var n=ba(e);n.sequenceNumber<=i&&null===o.get(n.targetId)&&(u++,a.push(s.pi(r,n)))}).next(function(){return Uu.Bn(a)}).next(function(){return u})},Oa.prototype.pe=function(t,r){return La(t).ei(function(t,e){var n=ba(e);r(n)})},Oa.prototype.Ei=function(t){return Ca(t).get(vh.key).next(function(t){return Ar(null!==t),t})},Oa.prototype.Ii=function(t,e){return Ca(t).put(vh.key,e)},Oa.prototype.Vi=function(t,e){return La(t).put(Ia(this.serializer,e))},Oa.prototype.gi=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},Oa.prototype.Si=function(t){return this.Ei(t).next(function(t){return t.targetCount})},Oa.prototype.Di=function(t,i){var e=fi(i),n=IDBKeyRange.bound([e,Number.NEGATIVE_INFINITY],[e,Number.POSITIVE_INFINITY]),o=null;return La(t).ei({range:n,index:dh.queryTargetsIndexName},function(t,e,n){var r=ba(e);li(i,r.target)&&(o=r,n.done())}).next(function(){return o})},Oa.prototype.Ci=function(n,t,r){var i=this,o=[],s=Va(n);return t.forEach(function(t){var e=ea(t.path);o.push(s.put(new yh(r,e))),o.push(i.wi.Fi(n,r,t))}),Uu.Bn(o)},Oa.prototype.Ni=function(n,t,r){var i=this,o=Va(n);return Uu.forEach(t,function(t){var e=ea(t.path);return Uu.Bn([o.delete([r,e]),i.wi.$i(n,r,t)])})},Oa.prototype.bi=function(t,e){var n=Va(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},Oa.prototype.ki=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Va(t),o=ji();return r.ei({range:n,xi:!0},function(t,e,n){var r=ia(t[1]),i=new Jr(r);o=o.add(i)}).next(function(){return o})},Oa.prototype.Mi=function(t,e){var n=ea(e.path),r=IDBKeyRange.bound([n],[Or(n)],!1,!0),i=0;return Va(t).ei({index:yh.documentTargetsIndex,xi:!0,range:r},function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())}).next(function(){return 0<i})},Oa.prototype.Me=function(t,e){return La(t).get(e).next(function(t){return t?ba(t):null})},Oa);function Oa(t,e){this.wi=t,this.serializer=e}function ka(t){this._i=t}function La(t){return Fa.js(t,dh.store)}function Ca(t){return Fa.js(t,vh.store)}function Va(t){return Fa.js(t,yh.store)}var Ua,ja="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ma=(n(Ba,Ua=Fu),Ba),Fa=(qa.js=function(t,e){if(t instanceof Ma)return Eh.js(t.Oi,e);throw Nr()},qa.prototype.start=function(){var e=this;return Eh.tr(this.Yi,eh,new nh(this.serializer)).then(function(t){return e.er=t,e.nr()}).then(function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new zr(Gr.FAILED_PRECONDITION,ja);return e.sr(),e.ir(),e.rr(),e.runTransaction("getHighestListenSequenceNumber","readonly",function(t){return e.Xi.Ai(t)})}).then(function(t){e.Ui=new Gu(t,e.Bi)}).then(function(){e.Qi=!0}).catch(function(t){return e.er&&e.er.close(),Promise.reject(t)})},qa.prototype.or=function(n){var t=this;return this.zi=function(e){return y(t,void 0,void 0,function(){return v(this,function(t){return this.hr?[2,n(e)]:[2]})})},n(this.isPrimary)},qa.prototype.ar=function(n){var t=this;this.er.ur(function(e){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return null===e.newVersion?[4,n()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})},qa.prototype.cr=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.bs.lr(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.hr?[4,this.nr()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},qa.prototype.nr=function(){var n=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return za(e).put(new wh(n.clientId,Date.now(),n.networkEnabled,n.inForeground)).next(function(){if(n.isPrimary)return n._r(e).next(function(t){t||(n.isPrimary=!1,n.bs.dr(function(){return n.zi(!1)}))})}).next(function(){return n.wr(e)}).next(function(t){return n.isPrimary&&!t?n.Tr(e).next(function(){return!1}):!!t&&n.Er(e).next(function(){return!0})})}).catch(function(t){if(Sh(t))return Er("IndexedDbPersistence","Failed to extend owner lease: ",t),n.isPrimary;if(!n.allowTabSynchronization)throw t;return Er("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(function(t){n.isPrimary!==t&&n.bs.dr(function(){return n.zi(t)}),n.isPrimary=t})},qa.prototype._r=function(t){var e=this;return Ga(t).get(ih.key).next(function(t){return Uu.resolve(e.Ir(t))})},qa.prototype.mr=function(t){return za(t).delete(this.clientId)},qa.prototype.Ar=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o=this;return v(this,function(t){switch(t.label){case 0:return!this.isPrimary||this.Rr(this.Gi,18e5)?[3,2]:(this.Gi=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var r=qa.js(t,wh.store);return r.Ws().next(function(t){var e=o.Pr(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)});return Uu.forEach(n,function(t){return r.delete(t.clientId)}).next(function(){return n})})}).catch(function(){return[]})]);case 1:if(e=t.sent(),this.Zi)for(n=0,r=e;n<r.length;n++)i=r[n],this.Zi.removeItem(this.Vr(i.clientId));t.label=2;case 2:return[2]}})})},qa.prototype.rr=function(){var t=this;this.Ki=this.bs.Os("client_metadata_refresh",4e3,function(){return t.nr().then(function(){return t.Ar()}).then(function(){return t.rr()})})},qa.prototype.Ir=function(t){return!!t&&t.ownerId===this.clientId},qa.prototype.wr=function(e){var i=this;return this.qi?Uu.resolve(!0):Ga(e).get(ih.key).next(function(t){if(null!==t&&i.Rr(t.leaseTimestampMs,5e3)&&!i.gr(t.ownerId)){if(i.Ir(t)&&i.networkEnabled)return!0;if(!i.Ir(t)){if(!t.allowTabSynchronization)throw new zr(Gr.FAILED_PRECONDITION,ja);return!1}}return!(!i.networkEnabled||!i.inForeground)||za(e).Ws().next(function(t){return void 0===i.Pr(t,5e3).find(function(t){if(i.clientId!==t.clientId){var e=!i.networkEnabled&&t.networkEnabled,n=!i.inForeground&&t.inForeground,r=i.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1})})}).next(function(t){return i.isPrimary!==t&&Er("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},qa.prototype.yr=function(){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.Qi=!1,this.pr(),this.Ki&&(this.Ki.cancel(),this.Ki=null),this.br(),this.vr(),[4,this.runTransaction("shutdown","readwrite",function(t){return e.Tr(t).next(function(){return e.mr(t)})}).catch(function(t){Er("IndexedDbPersistence","Proceeding with shutdown despite failure: ",t)})];case 1:return t.sent(),this.er.close(),this.Sr(),[2]}})})},qa.prototype.Pr=function(t,e){var n=this;return t.filter(function(t){return n.Rr(t.updateTimeMs,e)&&!n.gr(t.clientId)})},qa.prototype.Dr=function(){var e=this;return this.runTransaction("getActiveClients","readonly",function(t){return za(t).Ws().next(function(t){return e.Pr(t,18e5).map(function(t){return t.clientId})})})},qa.clearPersistence=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return qa.Hi()?(e=n+qa.Ji,[4,Eh.delete(e)]):[2,Promise.resolve()];case 1:return t.sent(),[2]}})})},Object.defineProperty(qa.prototype,"hr",{get:function(){return this.Qi},enumerable:!1,configurable:!0}),qa.prototype.Cr=function(t){return Xa.Fr(t,this.serializer,this.ss,this.wi)},qa.prototype.Nr=function(){return this.Xi},qa.prototype.$r=function(){return this.es},qa.prototype.kr=function(){return this.ss},qa.prototype.runTransaction=function(e,n,r){var i=this;Er("IndexedDbPersistence","Starting transaction:",e);var o,t="readonly"===n?"readonly":"readwrite";return this.er.runTransaction(t,Ih,function(t){return o=new Ma(t,i.Ui?i.Ui.next():Gu.ps),"readwrite-primary"===n?i._r(o).next(function(t){return!!t||i.wr(o)}).next(function(t){if(!t)throw _r("Failed to obtain primary lease for action '"+e+"'."),i.isPrimary=!1,i.bs.dr(function(){return i.zi(!1)}),new zr(Gr.FAILED_PRECONDITION,Mu);return r(o)}).next(function(t){return i.Er(o).next(function(){return t})}):i.xr(o).next(function(){return r(o)})}).then(function(t){return o.ts(),t})},qa.prototype.xr=function(t){var e=this;return Ga(t).get(ih.key).next(function(t){if(null!==t&&e.Rr(t.leaseTimestampMs,5e3)&&!e.gr(t.ownerId)&&!e.Ir(t)&&!(e.qi||e.allowTabSynchronization&&t.allowTabSynchronization))throw new zr(Gr.FAILED_PRECONDITION,ja)})},qa.prototype.Er=function(t){var e=new ih(this.clientId,this.allowTabSynchronization,Date.now());return Ga(t).put(ih.key,e)},qa.Hi=function(){return Eh.Hi()},qa.Mr=function(t){var e=t.s.projectId;return t.s.i||(e+="."+t.s.database),"firestore/"+t.persistenceKey+"/"+e+"/"},qa.prototype.Tr=function(t){var e=this,n=Ga(t);return n.get(ih.key).next(function(t){return e.Ir(t)?(Er("IndexedDbPersistence","Releasing primary lease."),n.delete(ih.key)):Uu.resolve()})},qa.prototype.Rr=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(_r("Detected an update time that is in the future: "+t+" > "+n),1))},qa.prototype.sr=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ji=function(){t.bs.lr(function(){return t.inForeground="visible"===t.document.visibilityState,t.nr()})},this.document.addEventListener("visibilitychange",this.ji),this.inForeground="visible"===this.document.visibilityState)},qa.prototype.br=function(){this.ji&&(this.document.removeEventListener("visibilitychange",this.ji),this.ji=null)},qa.prototype.ir=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Wi=function(){e.pr(),e.bs.lr(function(){return e.yr()})},this.window.addEventListener("unload",this.Wi))},qa.prototype.vr=function(){this.Wi&&(this.window.removeEventListener("unload",this.Wi),this.Wi=null)},qa.prototype.gr=function(t){var e;try{var n=null!==(null===(e=this.Zi)||void 0===e?void 0:e.getItem(this.Vr(t)));return Er("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return _r("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},qa.prototype.pr=function(){if(this.Zi)try{this.Zi.setItem(this.Vr(this.clientId),String(Date.now()))}catch(t){_r("Failed to set zombie client id.",t)}},qa.prototype.Sr=function(){if(this.Zi)try{this.Zi.removeItem(this.Vr(this.clientId))}catch(t){}},qa.prototype.Vr=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},qa);function qa(t,e,n,r,i,o,s,u,a,h){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.bs=i,this.window=o,this.document=s,this.Bi=a,this.qi=h,this.Ui=null,this.Qi=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Wi=null,this.inForeground=!1,this.ji=null,this.Ki=null,this.Gi=Number.NEGATIVE_INFINITY,this.zi=function(t){return Promise.resolve()},!qa.Hi())throw new zr(Gr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.wi=new Ha(this,r),this.Yi=e+qa.Ji,this.serializer=new la(u),this.Xi=new Ra(this.wi,this.serializer),this.ss=new ua,this.es=new _a(this.serializer,this.ss),this.window&&this.window.localStorage?this.Zi=this.window.localStorage:(this.Zi=null,!1===h&&_r("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}function Ba(t,e){var n=this;return(n=Ua.call(this)||this).Oi=t,n.Li=e,n}function Ga(t){return Fa.js(t,ih.store)}function za(t){return Fa.js(t,wh.store)}Fa.Ji="main";var Ha=(Wa.prototype.Lr=function(t){var n=this.Br(t);return this.db.Nr().Si(t).next(function(e){return n.next(function(t){return e+t})})},Wa.prototype.Br=function(t){var e=0;return this.qr(t,function(t){e++}).next(function(){return e})},Wa.prototype.pe=function(t,e){return this.db.Nr().pe(t,e)},Wa.prototype.qr=function(t,n){return this.Ur(t,function(t,e){return n(e)})},Wa.prototype.Fi=function(t,e,n){return Ya(t,n)},Wa.prototype.$i=function(t,e,n){return Ya(t,n)},Wa.prototype.vi=function(t,e,n){return this.db.Nr().vi(t,e,n)},Wa.prototype.Qr=Ya,Wa.prototype.Wr=function(t,e){return r=e,i=!1,th(n=t).jr(function(t){return Qa(n,t,r).next(function(t){return t&&(i=!0),Uu.resolve(!t)})}).next(function(){return i});var n,r,i},Wa.prototype.Kr=function(r,i){var o=this,s=this.db.$r().oi(),u=[],a=0;return this.Ur(r,function(e,t){var n;t<=i&&(n=o.Wr(r,e).next(function(t){if(!t)return a++,s.zn(r,e).next(function(){return s.Gn(e),Va(r).delete([0,ea(e.path)])})}),u.push(n))}).next(function(){return Uu.Bn(u)}).next(function(){return s.apply(r)}).next(function(){return a})},Wa.prototype.removeTarget=function(t,e){var n=e.Z(t.Li);return this.db.Nr().yi(t,n)},Wa.prototype.Gr=Ya,Wa.prototype.Ur=function(t,o){var s,e=Va(t),u=Gu.ps;return e.ei({index:yh.documentTargetsIndex},function(t,e){var n=t[0],r=(t[1],e.path),i=e.sequenceNumber;0===n?(u!==Gu.ps&&o(new Jr(ia(s)),u),u=i,s=r):u=Gu.ps}).next(function(){u!==Gu.ps&&o(new Jr(ia(s)),u)})},Wa.prototype.zr=function(t){return this.db.$r().ui(t)},Wa);function Wa(t,e){this.db=t,this.Or=new Kh(this,e)}function Ya(t,e){return Va(t).put((n=t.Li,new yh(0,ea(e.path),n)));var n}var Xa=(Ka.Fr=function(t,e,n,r){return Ar(""!==t.uid),new Ka(t.Yr()?t.uid:"",e,n,r)},Ka.prototype.Jr=function(t){var r=!0,e=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return $a(t).ei({index:uh.userMutationsIndex,range:e},function(t,e,n){r=!1,n.done()}).next(function(){return r})},Ka.prototype.Xr=function(d,y,v,g){var m=this,w=Za(d),b=$a(d);return b.add({}).next(function(t){Ar("number"==typeof t);for(var e,n,r,i,o,s=new Cu(t,y,v,g),u=(e=m.serializer,n=m.userId,i=(r=s).baseMutations.map(function(t){return Bo(e.Ks,t)}),o=r.mutations.map(function(t){return Bo(e.Ks,t)}),new uh(n,r.batchId,r.yn.toMillis(),i,o)),a=[],h=new Pi(function(t,e){return Pr(t.N(),e.N())}),c=0,f=g;c<f.length;c++){var l=f[c],p=ah.key(m.userId,l.key.path,t),h=h.add(l.key.path.p());a.push(b.put(u)),a.push(w.put(p,ah.PLACEHOLDER))}return h.forEach(function(t){a.push(m.ss.Us(d,t))}),d.Zn(function(){m.Hr[t]=s.keys()}),Uu.Bn(a).next(function(){return s})})},Ka.prototype.Zr=function(t,e){var n=this;return $a(t).get(e).next(function(t){return t?(Ar(t.userId===n.userId),wa(n.serializer,t)):null})},Ka.prototype.to=function(t,n){var r=this;return this.Hr[n]?Uu.resolve(this.Hr[n]):this.Zr(t,n).next(function(t){if(t){var e=t.keys();return r.Hr[n]=e}return null})},Ka.prototype.eo=function(t,e){var r=this,i=e+1,n=IDBKeyRange.lowerBound([this.userId,i]),o=null;return $a(t).ei({index:uh.userMutationsIndex,range:n},function(t,e,n){e.userId===r.userId&&(Ar(e.batchId>=i),o=wa(r.serializer,e)),n.done()}).next(function(){return o})},Ka.prototype.no=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return $a(t).ei({index:uh.userMutationsIndex,range:e,reverse:!0},function(t,e,n){r=e.batchId,n.done()}).next(function(){return r})},Ka.prototype.so=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return $a(t).Ws(uh.userMutationsIndex,n).next(function(t){return t.map(function(t){return wa(e.serializer,t)})})},Ka.prototype.os=function(u,a){var h=this,t=ah.prefixForPath(this.userId,a.path),e=IDBKeyRange.lowerBound(t),c=[];return Za(u).ei({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=ia(i);if(r===h.userId&&a.path.isEqual(s))return $a(u).get(o).next(function(t){if(!t)throw Nr();Ar(t.userId===h.userId),c.push(wa(h.serializer,t))});n.done()}).next(function(){return c})},Ka.prototype.ls=function(r,t){var a=this,h=new Pi(Pr),i=[];return t.forEach(function(u){var t=ah.prefixForPath(a.userId,u.path),e=IDBKeyRange.lowerBound(t),n=Za(r).ei({range:e},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=ia(i);r===a.userId&&u.path.isEqual(s)?h=h.add(o):n.done()});i.push(n)}),Uu.Bn(i).next(function(){return a.io(r,h)})},Ka.prototype.Es=function(t,e){var u=this,a=e.path,h=a.length+1,n=ah.prefixForPath(this.userId,a),r=IDBKeyRange.lowerBound(n),c=new Pi(Pr);return Za(t).ei({range:r},function(t,e,n){var r=t[0],i=t[1],o=t[2],s=ia(i);r===u.userId&&a.D(s)?s.length===h&&(c=c.add(o)):n.done()}).next(function(){return u.io(t,c)})},Ka.prototype.io=function(e,t){var n=this,r=[],i=[];return t.forEach(function(t){i.push($a(e).get(t).next(function(t){if(null===t)throw Nr();Ar(t.userId===n.userId),r.push(wa(n.serializer,t))}))}),Uu.Bn(i).next(function(){return r})},Ka.prototype.ro=function(e,n){var r=this;return Ja(e.Oi,this.userId,n).next(function(t){return e.Zn(function(){r.oo(n.batchId)}),Uu.forEach(t,function(t){return r.wi.Qr(e,t)})})},Ka.prototype.oo=function(t){delete this.Hr[t]},Ka.prototype.ho=function(n){var o=this;return this.Jr(n).next(function(t){if(!t)return Uu.resolve();var e=IDBKeyRange.lowerBound(ah.prefixForUser(o.userId)),i=[];return Za(n).ei({range:e},function(t,e,n){var r;t[0]===o.userId?(r=ia(t[1]),i.push(r)):n.done()}).next(function(){Ar(0===i.length)})})},Ka.prototype.Mi=function(t,e){return Qa(t,this.userId,e)},Ka.prototype.ao=function(t){var e=this;return th(t).get(this.userId).next(function(t){return t||new sh(e.userId,-1,"")})},Ka);function Ka(t,e,n,r){this.userId=t,this.serializer=e,this.ss=n,this.wi=r,this.Hr={}}function Qa(t,o,e){var n=ah.prefixForPath(o,e.path),s=n[1],r=IDBKeyRange.lowerBound(n),u=!1;return Za(t).ei({range:r,xi:!0},function(t,e,n){var r=t[0],i=t[1];t[2],r===o&&i===s&&(u=!0),n.done()}).next(function(){return u})}function Ja(t,e,n){var r=t.store(uh.store),i=t.store(ah.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.ei({range:s},function(t,e,n){return u++,n.delete()});o.push(a.next(function(){Ar(1===u)}));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=ah.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return Uu.Bn(o).next(function(){return h})}function $a(t){return Fa.js(t,uh.store)}function Za(t){return Fa.js(t,ah.store)}function th(t){return Fa.js(t,sh.store)}var eh=10,nh=(oh.prototype.createOrUpgrade=function(n,r,t,e){var i=this;Ar(t<e&&0<=t&&e<=eh);var o,s=new Dh(r);t<1&&1<=e&&(n.createObjectStore(ih.store),(o=n).createObjectStore(sh.store,{keyPath:sh.keyPath}),o.createObjectStore(uh.store,{keyPath:uh.keyPath,autoIncrement:!0}).createIndex(uh.userMutationsIndex,uh.userMutationsKeyPath,{unique:!0}),o.createObjectStore(ah.store),mh(n),n.createObjectStore(lh.store));var u,a=Uu.resolve();return t<3&&3<=e&&(0!==t&&((u=n).deleteObjectStore(yh.store),u.deleteObjectStore(dh.store),u.deleteObjectStore(vh.store),mh(n)),a=a.next(function(){return t=s.store(vh.store),e=new vh(0,0,Wr.min().A(),0),t.put(vh.key,e);var t,e})),t<4&&4<=e&&(0!==t&&(a=a.next(function(){return r=n,(i=s).store(uh.store).Ws().next(function(t){r.deleteObjectStore(uh.store),r.createObjectStore(uh.store,{keyPath:uh.keyPath,autoIncrement:!0}).createIndex(uh.userMutationsIndex,uh.userMutationsKeyPath,{unique:!0});var e=i.store(uh.store),n=t.map(function(t){return e.put(t)});return Uu.Bn(n)});var r,i})),a=a.next(function(){n.createObjectStore(wh.store,{keyPath:wh.keyPath})})),t<5&&5<=e&&(a=a.next(function(){return i.removeAcknowledgedMutations(s)})),t<6&&6<=e&&(a=a.next(function(){return n.createObjectStore(ph.store),i.addDocumentGlobal(s)})),t<7&&7<=e&&(a=a.next(function(){return i.ensureSequenceNumbers(s)})),t<8&&8<=e&&(a=a.next(function(){return i.createCollectionParentIndex(n,s)})),t<9&&9<=e&&(a=a.next(function(){var t,e;(e=n).objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges"),(t=r.objectStore(lh.store)).createIndex(lh.readTimeIndex,lh.readTimeIndexPath,{unique:!1}),t.createIndex(lh.collectionReadTimeIndex,lh.collectionReadTimeIndexPath,{unique:!1})})),t<10&&10<=e&&(a=a.next(function(){return i.rewriteCanonicalIds(s)})),a},oh.prototype.addDocumentGlobal=function(e){var n=0;return e.store(lh.store).ei(function(t,e){n+=Sa(e)}).next(function(){var t=new ph(n);return e.store(ph.store).put(ph.key,t)})},oh.prototype.removeAcknowledgedMutations=function(r){var i=this,t=r.store(sh.store),e=r.store(uh.store);return t.Ws().next(function(t){return Uu.forEach(t,function(n){var t=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return e.Ws(uh.userMutationsIndex,t).next(function(t){return Uu.forEach(t,function(t){Ar(t.userId===n.userId);var e=wa(i.serializer,t);return Ja(r,n.userId,e).next(function(){})})})})})},oh.prototype.ensureSequenceNumbers=function(t){var s=t.store(yh.store),e=t.store(lh.store);return t.store(vh.store).get(vh.key).next(function(i){var o=[];return e.ei(function(t,e){var n=new Xr(t),r=[0,ea(n)];o.push(s.get(r).next(function(t){return t?Uu.resolve():s.put(new yh(0,ea(n),i.highestListenSequenceNumber))}))}).next(function(){return Uu.Bn(o)})})},oh.prototype.createCollectionParentIndex=function(t,e){function r(t){if(o.add(t)){var e=t.S(),n=t.p();return i.put({collectionId:e,parent:ea(n)})}}t.createObjectStore(gh.store,{keyPath:gh.keyPath});var i=e.store(gh.store),o=new sa;return e.store(lh.store).ei({xi:!0},function(t,e){return r(new Xr(t).p())}).next(function(){return e.store(ah.store).ei({xi:!0},function(t,e){t[0];var n=t[1];return r((t[2],ia(n)).p())})})},oh.prototype.rewriteCanonicalIds=function(t){var i=this,o=t.store(dh.store);return o.ei(function(t,e){var n=ba(e),r=Ia(i.serializer,n);return o.put(r)})},oh),rh=function(t,e){this.seconds=t,this.nanoseconds=e},ih=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function oh(t){this.serializer=t}ih.store="owner",ih.key="owner";var sh=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};sh.store="mutationQueues",sh.keyPath="userId";var uh=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};uh.store="mutations",uh.keyPath="batchId",uh.userMutationsIndex="userMutationsIndex",uh.userMutationsKeyPath=["userId","batchId"];var ah=(hh.prefixForUser=function(t){return[t]},hh.prefixForPath=function(t,e){return[t,ea(e)]},hh.key=function(t,e,n){return[t,ea(e),n]},hh);function hh(){}ah.store="documentMutations",ah.PLACEHOLDER=new ah;var ch=function(t,e){this.path=t,this.readTime=e},fh=function(t,e){this.path=t,this.version=e},lh=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};lh.store="remoteDocuments",lh.readTimeIndex="readTimeIndex",lh.readTimeIndexPath="readTime",lh.collectionReadTimeIndex="collectionReadTimeIndex",lh.collectionReadTimeIndexPath=["parentPath","readTime"];var ph=function(t){this.byteSize=t};ph.store="remoteDocumentGlobal",ph.key="remoteDocumentGlobalKey";var dh=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};dh.store="targets",dh.keyPath="targetId",dh.queryTargetsIndexName="queryTargetsIndex",dh.queryTargetsKeyPath=["canonicalId","targetId"];var yh=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};yh.store="targetDocuments",yh.keyPath=["targetId","path"],yh.documentTargetsIndex="documentTargetsIndex",yh.documentTargetsKeyPath=["path","targetId"];var vh=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};vh.key="targetGlobalKey",vh.store="targetGlobal";var gh=function(t,e){this.collectionId=t,this.parent=e};function mh(t){t.createObjectStore(yh.store,{keyPath:yh.keyPath}).createIndex(yh.documentTargetsIndex,yh.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(dh.store,{keyPath:dh.keyPath}).createIndex(dh.queryTargetsIndexName,dh.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(vh.store)}gh.store="collectionParents",gh.keyPath=["collectionId","parent"];var wh=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};wh.store="clientMetadata",wh.keyPath="clientId";var bh,Ih=d(d(d([sh.store,uh.store,ah.store,lh.store,dh.store,ih.store,vh.store,yh.store],[wh.store]),[ph.store]),[gh.store]),Eh=(xh.tr=function(o,t,s){return Er("SimpleDb","Opening database:",o),new Uu(function(n,r){var i=indexedDB.open(o,t);i.onsuccess=function(t){var e=t.target.result;n(new xh(e))},i.onblocked=function(){r(new zr(Gr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(t){var e=t.target.error;"VersionError"===e.name?r(new zr(Gr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):r(e)},i.onupgradeneeded=function(t){Er("SimpleDb",'Database "'+o+'" requires upgrade from version:',t.oldVersion);var e=t.target.result;s.createOrUpgrade(e,i.transaction,t.oldVersion,eh).next(function(){Er("SimpleDb","Database upgrade to version "+eh+" complete")})}}).On()},xh.delete=function(t){return Er("SimpleDb","Removing database:",t),kh(window.indexedDB.deleteDatabase(t)).On()},xh.Hi=function(){if("undefined"==typeof indexedDB)return!1;if(xh.co())return!0;var t=g(),e=xh.uo(t),n=0<e&&e<10,r=xh.lo(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},xh.co=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t._o)},xh.js=function(t,e){return t.store(e)},xh.uo=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},xh.lo=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},xh.prototype.ur=function(e){this.db.onversionchange=function(t){return e(t)}},xh.prototype.runTransaction=function(r,h,c){return y(this,void 0,void 0,function(){var s,u,e,a,n;return v(this,function(t){switch(t.label){case 0:s="readonly"===r,u=0,e=function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:++u,e=Dh.open(a.db,s?"readonly":"readwrite",h),t.label=1;case 1:return t.trys.push([1,3,,4]),n=c(e).catch(function(t){return e.abort(t),Uu.reject(t)}).On(),r={},n.catch(function(){}),[4,e.fo];case 2:return[2,(r.value=(t.sent(),n),r)];case 3:return i=t.sent(),o="FirebaseError"!==i.name&&u<3,Er("SimpleDb","Transaction failed with error: %s. Retrying: %s.",i.message,o),o?[3,4]:[2,{value:Promise.reject(i)}];case 4:return[2]}})},a=this,t.label=1;case 1:return[5,e()];case 2:if("object"==typeof(n=t.sent()))return[2,n.value];t.label=3;case 3:return[3,1];case 4:return[2]}})})},xh.prototype.close=function(){this.db.close()},xh),_h=(Object.defineProperty(Ah.prototype,"$n",{get:function(){return this.wo},enumerable:!1,configurable:!0}),Object.defineProperty(Ah.prototype,"Eo",{get:function(){return this.To},enumerable:!1,configurable:!0}),Object.defineProperty(Ah.prototype,"cursor",{set:function(t){this.do=t},enumerable:!1,configurable:!0}),Ah.prototype.done=function(){this.wo=!0},Ah.prototype.ni=function(t){this.To=t},Ah.prototype.delete=function(){return kh(this.do.delete())},Ah),Th=(n(Nh,bh=zr),Nh);function Nh(t){var e=this;return(e=bh.call(this,Gr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function Ah(t){this.do=t,this.wo=!1,this.To=null}function xh(t){this.db=t,12.2===xh.uo(g())&&_r("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Sh(t){return"IndexedDbTransactionError"===t.name}var Dh=(Oh.open=function(t,e,n){return new Oh(t.transaction(n,e))},Object.defineProperty(Oh.prototype,"fo",{get:function(){return this.Io.promise},enumerable:!1,configurable:!0}),Oh.prototype.abort=function(t){t&&this.Io.reject(t),this.aborted||(Er("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},Oh.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Ph(e)},Oh),Ph=(Rh.prototype.put=function(t,e){return kh(void 0!==e?(Er("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Er("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Rh.prototype.add=function(t){return Er("SimpleDb","ADD",this.store.name,t,t),kh(this.store.add(t))},Rh.prototype.get=function(e){var n=this;return kh(this.store.get(e)).next(function(t){return void 0===t&&(t=null),Er("SimpleDb","GET",n.store.name,e,t),t})},Rh.prototype.delete=function(t){return Er("SimpleDb","DELETE",this.store.name,t),kh(this.store.delete(t))},Rh.prototype.count=function(){return Er("SimpleDb","COUNT",this.store.name),kh(this.store.count())},Rh.prototype.Ws=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.mo(n,function(t,e){r.push(e)}).next(function(){return r})},Rh.prototype.Ao=function(t,e){Er("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.xi=!1;var r=this.cursor(n);return this.mo(r,function(t,e,n){return n.delete()})},Rh.prototype.ei=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.mo(r,e)},Rh.prototype.jr=function(i){var t=this.cursor({});return new Uu(function(n,r){t.onerror=function(t){var e=Ch(t.target.error);r(e)},t.onsuccess=function(t){var e=t.target.result;e?i(e.primaryKey,e.value).next(function(t){t?e.continue():n()}):n()}})},Rh.prototype.mo=function(t,s){var u=[];return new Uu(function(o,e){t.onerror=function(t){e(t.target.error)},t.onsuccess=function(t){var e,n,r,i=t.target.result;i?(e=new _h(i),(n=s(i.primaryKey,i.value,e))instanceof Uu&&(r=n.catch(function(t){return e.done(),Uu.reject(t)}),u.push(r)),e.$n?o():null===e.Eo?i.continue():i.continue(e.Eo)):o()}}).next(function(){return Uu.Bn(u)})},Rh.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Rh.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.xi?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Rh);function Rh(t){this.store=t}function Oh(t){var n=this;this.transaction=t,this.aborted=!1,this.Io=new $u,this.transaction.oncomplete=function(){n.Io.resolve()},this.transaction.onabort=function(){t.error?n.Io.reject(new Th(t.error)):n.Io.resolve()},this.transaction.onerror=function(t){var e=Ch(t.target.error);n.Io.reject(new Th(e))}}function kh(t){return new Uu(function(n,r){t.onsuccess=function(t){var e=t.target.result;n(e)},t.onerror=function(t){var e=Ch(t.target.error);r(e)}})}var Lh=!1;function Ch(t){var e=Eh.uo(g());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new zr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Lh||(Lh=!0,setTimeout(function(){throw r},0)),r}}return t}function Vh(){return"undefined"!=typeof window?window:null}var Uh=(Fh.po=function(t,e,n,r,i){var o=new Fh(t,e,Date.now()+n,r,i);return o.start(n),o},Fh.prototype.start=function(t){var e=this;this.bo=setTimeout(function(){return e.vo()},t)},Fh.prototype.Bs=function(){return this.vo()},Fh.prototype.cancel=function(t){null!==this.bo&&(this.clearTimeout(),this.yo.reject(new zr(Gr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},Fh.prototype.vo=function(){var e=this;this.Ro.lr(function(){return null!==e.bo?(e.clearTimeout(),e.op().then(function(t){return e.yo.resolve(t)})):Promise.resolve()})},Fh.prototype.clearTimeout=function(){null!==this.bo&&(this.Vo(this),clearTimeout(this.bo),this.bo=null)},Fh),jh=(Object.defineProperty(Mh.prototype,"Oo",{get:function(){return this.Co},enumerable:!1,configurable:!0}),Mh.prototype.lr=function(t){this.enqueue(t)},Mh.prototype.Lo=function(t){this.Bo(),this.qo(t)},Mh.prototype.Uo=function(t){return this.Bo(),this.qo(t)},Mh.prototype.Qo=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.Bo(),this.Co?[3,2]:(this.Co=!0,(e=Vh())&&e.removeEventListener("visibilitychange",this.Mo),[4,this.Uo(n)]);case 1:t.sent(),t.label=2;case 2:return[2]}})})},Mh.prototype.enqueue=function(t){return this.Bo(),this.Co?new Promise(function(t){}):this.qo(t)},Mh.prototype.dr=function(t){var e=this;this.Do.push(t),this.lr(function(){return e.Wo()})},Mh.prototype.Wo=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(0===this.Do.length)return[3,5];t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.Do[0]()];case 2:return t.sent(),this.Do.shift(),this.xo.reset(),[3,4];case 3:if(!Sh(e=t.sent()))throw e;return Er("AsyncQueue","Operation failed with retryable error: "+e),[3,4];case 4:0<this.Do.length&&this.xo.xs(function(){return n.Wo()}),t.label=5;case 5:return[2]}})})},Mh.prototype.qo=function(t){var r=this,e=this.So.then(function(){return r.$o=!0,t().catch(function(t){throw r.No=t,r.$o=!1,_r("INTERNAL UNHANDLED ERROR: ",(n=(e=t).message||"",e.stack&&(n=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),n)),t;var e,n}).then(function(t){return r.$o=!1,t})});return this.So=e},Mh.prototype.Os=function(t,e,n){var r=this;this.Bo(),-1<this.ko.indexOf(t)&&(e=0);var i=Uh.po(this,t,e,n,function(t){return r.jo(t)});return this.Fo.push(i),i},Mh.prototype.Bo=function(){this.No&&Nr()},Mh.prototype.Ko=function(){},Mh.prototype.Go=function(){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return[4,e=this.So];case 1:t.sent(),t.label=2;case 2:if(e!==this.So)return[3,0];t.label=3;case 3:return[2]}})})},Mh.prototype.zo=function(t){for(var e=0,n=this.Fo;e<n.length;e++)if(n[e].vs===t)return!0;return!1},Mh.prototype.Ho=function(r){var i=this;return this.Go().then(function(){i.Fo.sort(function(t,e){return t.Po-e.Po});for(var t=0,e=i.Fo;t<e.length;t++){var n=e[t];if(n.Bs(),"all"!==r&&n.vs===r)break}return i.Go()})},Mh.prototype.Yo=function(t){this.ko.push(t)},Mh.prototype.jo=function(t){var e=this.Fo.indexOf(t);this.Fo.splice(e,1)},Mh);function Mh(){var t=this;this.So=Promise.resolve(),this.Do=[],this.Co=!1,this.Fo=[],this.No=null,this.$o=!1,this.ko=[],this.xo=new Zu(this,"async_queue_retry"),this.Mo=function(){return t.xo.Ls()};var e=Vh();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Mo)}function Fh(t,e,n,r,i){this.Ro=t,this.vs=e,this.Po=n,this.op=r,this.Vo=i,this.yo=new $u,this.then=this.yo.promise.then.bind(this.yo.promise),this.yo.promise.catch(function(t){})}function qh(t,e){if(_r("AsyncQueue",e+": "+t),Sh(t))return new zr(Gr.UNAVAILABLE,e+": "+t);throw t}function Bh(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=Pr(n,i);return 0===s?Pr(r,o):s}var Gh=(Yh.prototype.Zo=function(){return++this.Xo},Yh.prototype.th=function(t){var e,n=[t,this.Zo()];this.buffer.size<this.Jo?this.buffer=this.buffer.add(n):Bh(n,e=this.buffer.last())<0&&(this.buffer=this.buffer.delete(e).add(n))},Object.defineProperty(Yh.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),Yh),zh={eh:!1,nh:0,sh:0,ih:0},Hh=(Wh.ah=function(t){return new Wh(t,Wh.uh,Wh.lh)},Wh);function Wh(t,e,n){this.rh=t,this.oh=e,this.hh=n}function Yh(t){this.Jo=t,this.buffer=new Pi(Bh),this.Xo=0}Hh._h=-1,Hh.fh=1048576,Hh.dh=41943040,Hh.uh=10,Hh.lh=1e3,Hh.wh=new Hh(Hh.dh,Hh.uh,Hh.lh),Hh.Th=new Hh(Hh._h,0,0);var Xh=(Zh.prototype.start=function(t){this.Or.params.rh!==Hh._h&&this.mh(t)},Zh.prototype.stop=function(){this.Ih&&(this.Ih.cancel(),this.Ih=null)},Object.defineProperty(Zh.prototype,"hr",{get:function(){return null!==this.Ih},enumerable:!1,configurable:!0}),Zh.prototype.mh=function(n){var t=this,e=this.Eh?3e5:6e4;Er("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.Ih=this.Ro.Os("lru_garbage_collection",e,function(){return y(t,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.Ih=null,this.Eh=!0,t.label=1;case 1:return t.trys.push([1,3,,7]),[4,n.Ah(this.Or)];case 2:return t.sent(),[3,7];case 3:return Sh(e=t.sent())?(Er("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,rc(e)];case 5:t.sent(),t.label=6;case 6:return[3,7];case 7:return[4,this.mh(n)];case 8:return t.sent(),[2]}})})})},Zh),Kh=($h.prototype.Ph=function(t,e){return this.Rh.Lr(t).next(function(t){return Math.floor(e/100*t)})},$h.prototype.Vh=function(t,e){var n=this;if(0===e)return Uu.resolve(Gu.ps);var r=new Gh(e);return this.Rh.pe(t,function(t){return r.th(t.sequenceNumber)}).next(function(){return n.Rh.qr(t,function(t){return r.th(t)})}).next(function(){return r.maxValue})},$h.prototype.vi=function(t,e,n){return this.Rh.vi(t,e,n)},$h.prototype.Kr=function(t,e){return this.Rh.Kr(t,e)},$h.prototype.gh=function(e,n){var r=this;return this.params.rh===Hh._h?(Er("LruGarbageCollector","Garbage collection skipped; disabled"),Uu.resolve(zh)):this.zr(e).next(function(t){return t<r.params.rh?(Er("LruGarbageCollector","Garbage collection skipped; Cache size "+t+" is lower than threshold "+r.params.rh),zh):r.yh(e,n)})},$h.prototype.zr=function(t){return this.Rh.zr(t)},$h.prototype.yh=function(e,n){var r,i,o,s,u,a,h,c=this,f=Date.now();return this.Ph(e,this.params.oh).next(function(t){return i=t>c.params.hh?(Er("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.hh+" from "+t),c.params.hh):t,s=Date.now(),c.Vh(e,i)}).next(function(t){return r=t,u=Date.now(),c.vi(e,r,n)}).next(function(t){return o=t,a=Date.now(),c.Kr(e,r)}).next(function(t){return h=Date.now(),Ir()<=p.DEBUG&&Er("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(h-a)+"ms\nTotal Duration: "+(h-f)+"ms"),Uu.resolve({eh:!0,nh:i,sh:o,ih:t})})},$h),Qh=(Jh.prototype.start=function(){return Promise.resolve()},Jh.prototype.Nh=function(i){return y(this,void 0,void 0,function(){var e,m,n,r=this;return v(this,function(t){switch(t.label){case 0:return e=this.ns,m=this.Ch,[4,this.persistence.runTransaction("Handle user change","readonly",function(v){var g;return r.ns.so(v).next(function(t){return g=t,e=r.persistence.Cr(i),m=new qu(r.Dh,e,r.persistence.kr()),e.so(v)}).next(function(t){for(var e=[],n=[],r=ji(),i=0,o=g;i<o.length;i++){var s=o[i];e.push(s.batchId);for(var u=0,a=s.mutations;u<a.length;u++)var h=a[u],r=r.add(h.key)}for(var c=0,f=t;c<f.length;c++){var l=f[c];n.push(l.batchId);for(var p=0,d=l.mutations;p<d.length;p++){var y=d[p];r=r.add(y.key)}}return m.us(v,r).next(function(t){return{$h:t,kh:e,xh:n}})})})];case 1:return n=t.sent(),[2,(this.ns=e,this.Ch=m,this.ph.Fh(this.Ch),n)]}})})},Jh.prototype.Mh=function(h){var c,f=this,l=Hr.now(),t=h.reduce(function(t,e){return t.add(e.key)},ji());return this.persistence.runTransaction("Locally write mutations","readwrite",function(a){return f.Ch.us(a,t).next(function(t){c=t;for(var u,e,n=[],r=0,i=h;r<i.length;r++){var o=i[r],s=(u=o,e=c.get(o.key),u instanceof Ls?function(t){for(var e=null,n=0,r=u.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof $s?t.field(i.field):void 0,s=$o(i.transform,o||null);null!=s&&(e=null==e?(new Bs).set(i.field,s):e.set(i.field,s))}return e?e.ze():null}(e):null);null!=s&&n.push(new Ds(o.key,s,Ys(s.proto.mapValue),ws.exists(!0)))}return f.ns.Xr(a,l,n,h)})}).then(function(t){var e=t.Sn(c);return{batchId:t.batchId,Un:e}})},Jh.prototype.Oh=function(r){var i=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var e=r.batch.keys(),n=i.Dh.oi({ai:!0});return i.Lh(t,r,n).next(function(){return n.apply(t)}).next(function(){return i.ns.ho(t)}).next(function(){return i.Ch.us(t,e)})})},Jh.prototype.Bh=function(t){var r=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(e){var n;return r.ns.Zr(e,t).next(function(t){return Ar(null!==t),n=t.keys(),r.ns.ro(e,t)}).next(function(){return r.ns.ho(e)}).next(function(){return r.Ch.us(e,n)})})},Jh.prototype.no=function(){var e=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e.ns.no(t)})},Jh.prototype.mi=function(){var e=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.Xi.mi(t)})},Jh.prototype.qh=function(a){var h=this,c=a.X,f=this.bh;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var i=h.Dh.oi({ai:!0});f=h.bh;var s=[];a.Qt.forEach(function(t,e){var n,r,i=f.get(e);i&&(s.push(h.Xi.Ni(o,t.Xt,e).next(function(){return h.Xi.Ci(o,t.Yt,e)})),0<(n=t.resumeToken).H()&&(r=i.tt(n,c).Z(o.Li),f=f.nt(e,r),Jh.Uh(i,r,t)&&s.push(h.Xi.yi(o,r))))});var t,u=Oi,n=ji();return a.jt.forEach(function(t,e){n=n.add(t)}),s.push(i.getEntries(o,n).next(function(r){a.jt.forEach(function(t,e){var n=r.get(t);e instanceof Zs&&e.version.isEqual(Wr.min())?(i.Gn(t,c),u=u.nt(t,e)):null==n||0<e.version.o(n.version)||0===e.version.o(n.version)&&n.hasPendingWrites?(i.jn(e,c),u=u.nt(t,e)):Er("LocalStore","Ignoring outdated watch update for ",t,". Current version:",n.version," Watch version:",e.version),a.Kt.has(t)&&s.push(h.persistence.wi.Gr(o,t))})})),c.isEqual(Wr.min())||(t=h.Xi.mi(o).next(function(t){return h.Xi.Ri(o,o.Li,c)}),s.push(t)),Uu.Bn(s).next(function(){return i.apply(o)}).next(function(){return h.Ch.cs(o,u)})}).then(function(t){return h.bh=f,t})},Jh.Uh=function(t,e,n){return Ar(0<e.resumeToken.H()),0===t.resumeToken.H()||e.X.m()-t.X.m()>=this.Qh||0<n.Yt.size+n.Jt.size+n.Xt.size},Jh.prototype.Wh=function(c){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return Uu.forEach(c,function(e){return Uu.forEach(e.ms,function(t){return h.persistence.wi.Fi(n,e.targetId,t)}).next(function(){return Uu.forEach(e.As,function(t){return h.persistence.wi.$i(n,e.targetId,t)})})})})];case 1:return t.sent(),[3,3];case 2:if(!Sh(e=t.sent()))throw e;return Er("LocalStore","Failed to update sequence numbers: "+e),[3,3];case 3:for(n=0,r=c;n<r.length;n++)i=r[n],o=i.targetId,i.fromCache||(s=this.bh.get(o),u=s.X,a=s.et(u),this.bh=this.bh.nt(o,a));return[2]}})})},Jh.prototype.jh=function(e){var n=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n.ns.eo(t,e)})},Jh.prototype.Kh=function(e){var n=this;return this.persistence.runTransaction("read document","readonly",function(t){return n.Ch.rs(t,e)})},Jh.prototype.Gh=function(r){var i=this;return this.persistence.runTransaction("Allocate target","readwrite",function(e){var n;return i.Xi.Di(e,r).next(function(t){return t?(n=t,Uu.resolve(n)):i.Xi.Ti(e).next(function(t){return n=new wi(r,t,0,e.Li),i.Xi.Pi(e,n).next(function(){return n})})})}).then(function(t){var e=i.bh.get(t.targetId);return(null===e||0<t.X.o(e.X))&&(i.bh=i.bh.nt(t.targetId,t),i.vh.set(r,t.targetId)),t})},Jh.prototype.Di=function(t,e){var n=this.vh.get(e);return void 0!==n?Uu.resolve(this.bh.get(n)):this.Xi.Di(t,e)},Jh.prototype.zh=function(t,e){var n=this,r=this.bh.get(t),i=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release target",i,function(t){return e?Uu.resolve():n.persistence.wi.removeTarget(t,r)}).then(function(){n.bh=n.bh.remove(t),n.vh.delete(r.target)})},Jh.prototype.Hh=function(t,n){var r=this,i=Wr.min(),o=ji();return this.persistence.runTransaction("Execute query","readonly",function(e){return r.Di(e,t.We()).next(function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.Xi.ki(e,t.targetId).next(function(t){o=t})}).next(function(){return r.ph._s(e,t,n?i:Wr.min(),n?o:ji())}).next(function(t){return{documents:t,Yh:o}})})},Jh.prototype.Lh=function(t,i,o){var e=this,s=i.batch,n=s.keys(),u=Uu.resolve();return n.forEach(function(r){u=u.next(function(){return o.zn(t,r)}).next(function(t){var e=t,n=i.Cn.get(r);Ar(null!==n),(!e||e.version.o(n)<0)&&(e=s.pn(r,e,i))&&o.jn(e,i.Dn)})}),u.next(function(){return e.ns.ro(t,s)})},Jh.prototype.Ah=function(e){var n=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(t){return e.gh(t,n.bh)})},Jh);function Jh(t,e,n){this.persistence=t,this.ph=e,this.bh=new _i(Pr),this.vh=new Br(fi,li),this.Sh=Wr.min(),this.ns=t.Cr(n),this.Dh=t.$r(),this.Xi=t.Nr(),this.Ch=new qu(this.Dh,this.ns,this.persistence.kr()),this.ph.Fh(this.Ch)}function $h(t,e){this.Rh=t,this.params=e}function Zh(t,e){this.Or=t,this.Ro=e,this.Eh=!1,this.Ih=null}Qh.Qh=3e8;var tc,ec=(n(nc,tc=Qh),nc.prototype.start=function(){return this.Jh()},nc.prototype.Xh=function(t){var n=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(e){return n.ns.to(e,t).next(function(t){return t?n.Ch.us(e,t):Uu.resolve(null)})})},nc.prototype.Zh=function(t){this.ns.oo(t)},nc.prototype.cr=function(t){this.persistence.cr(t)},nc.prototype.Dr=function(){return this.persistence.Dr()},nc.prototype.ta=function(e){var n=this,t=this.bh.get(e);return t?Promise.resolve(t.target):this.persistence.runTransaction("Get target data","readonly",function(t){return n.Xi.Me(t,e).next(function(t){return t?t.target:null})})},nc.prototype.si=function(){var r=this;return this.persistence.runTransaction("Get new document changes","readonly",function(t){return r.Dh.si(t,r.Sh)}).then(function(t){var e=t.ii,n=t.readTime;return r.Sh=n,e})},nc.prototype.Jh=function(){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:return[4,(e=this).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return n.Dh.ri(t)})];case 1:return e.Sh=t.sent(),[2]}})})},nc);function nc(t,e,n){var r=this;return(r=tc.call(this,t,e,n)||this).persistence=t,r.ns=t.Cr(n),r.Dh=t.$r(),r.Xi=t.Nr(),r}function rc(e){return y(this,void 0,void 0,function(){return v(this,function(t){if(e.code!==Gr.FAILED_PRECONDITION||e.message!==Mu)throw e;return Er("LocalStore","Unexpectedly lost primary lease"),[2]})})}var ic=(uc.prototype._=function(){return this.ea._()},uc.prototype.Fi=function(t,e){var n=new oc(t,e);this.ea=this.ea.add(n),this.sa=this.sa.add(n)},uc.prototype.ra=function(t,e){var n=this;t.forEach(function(t){return n.Fi(t,e)})},uc.prototype.$i=function(t,e){this.oa(new oc(t,e))},uc.prototype.ha=function(t,e){var n=this;t.forEach(function(t){return n.$i(t,e)})},uc.prototype.aa=function(t){var e=this,n=new Jr(new Xr([])),r=new oc(n,t),i=new oc(n,t+1),o=[];return this.sa.vt([r,i],function(t){e.oa(t),o.push(t.key)}),o},uc.prototype.ua=function(){var e=this;this.ea.forEach(function(t){return e.oa(t)})},uc.prototype.oa=function(t){this.ea=this.ea.delete(t),this.sa=this.sa.delete(t)},uc.prototype.ca=function(t){var e=new Jr(new Xr([])),n=new oc(e,t),r=new oc(e,t+1),i=ji();return this.sa.vt([n,r],function(t){i=i.add(t.key)}),i},uc.prototype.Mi=function(t){var e=new oc(t,0),n=this.ea.Dt(e);return null!==n&&t.isEqual(n.key)},uc),oc=(sc.na=function(t,e){return Jr.P(t.key,e.key)||Pr(t.la,e.la)},sc.ia=function(t,e){return Pr(t.la,e.la)||Jr.P(t.key,e.key)},sc);function sc(t,e){this.key=t,this.la=e}function uc(){this.ea=new Pi(oc.na),this.sa=new Pi(oc.ia)}function ac(t,e){if(0!==e.length)throw new zr(Gr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Ac(e.length,"argument")+".")}function hc(t,e,n){if(e.length!==n)throw new zr(Gr.INVALID_ARGUMENT,"Function "+t+"() requires "+Ac(n,"argument")+", but was called with "+Ac(e.length,"argument")+".")}function cc(t,e,n){if(e.length<n)throw new zr(Gr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Ac(n,"argument")+", but was called with "+Ac(e.length,"argument")+".")}function fc(t,e,n,r){if(e.length<n||e.length>r)throw new zr(Gr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Ac(e.length,"argument")+".")}function lc(t,e,n,r){mc(t,e,Nc(n)+" argument",r)}function pc(t,e,n,r){void 0!==r&&lc(t,e,n,r)}function dc(t,e,n,r){mc(t,e,n+" option",r)}function yc(t,e,n,r){void 0!==r&&dc(t,e,n,r)}function vc(t,e,n,r,a){void 0!==r&&function(t,e,n){for(var r=[],i=0,o=a;i<o.length;i++){var s=o[i];if(s===n)return;r.push(bc(s))}var u=bc(n);throw new zr(Gr.INVALID_ARGUMENT,"Invalid value "+u+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function gc(t,e,n,r){if(!e.some(function(t){return t===r}))throw new zr(Gr.INVALID_ARGUMENT,"Invalid value "+bc(r)+" provided to function "+t+"() for its "+Nc(n)+" argument. Acceptable values: "+e.join(", "));return r}function mc(t,e,n,r){if(!("object"===e?wc(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=bc(r);throw new zr(Gr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function wc(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function bc(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return 20<e.length&&(e=e.substring(0,20)+"..."),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"!=typeof e)return"function"==typeof e?"a function":Nr();if(e instanceof Array)return"an array";var t=function(){if(e.constructor){var t=/function\s+([^\s(]+)\s*\(/.exec(e.constructor.toString());if(t&&1<t.length)return t[1]}return null}();return t?"a custom "+t+" object":"an object"}function Ic(t,e,n){if(void 0===n)throw new zr(Gr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Nc(e)+" argument, but it was undefined.")}function Ec(n,t,r){Ur(t,function(t,e){if(r.indexOf(t)<0)throw new zr(Gr.INVALID_ARGUMENT,"Unknown option '"+t+"' passed to function "+n+"(). Available options: "+r.join(", "))})}function _c(t,e,n,r){var i=bc(r);return new zr(Gr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Nc(n)+" argument to be a "+e+", but it was: "+i)}function Tc(t,e,n){if(n<=0)throw new zr(Gr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Nc(e)+" argument to be a positive number, but it was: "+n+".")}function Nc(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Ac(t,e){return t+" "+e+(1===t?"":"s")}function xc(){if("undefined"==typeof Uint8Array)throw new zr(Gr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Sc(){if("undefined"==typeof atob)throw new zr(Gr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Dc,Pc,Rc=(Mc.fromBase64String=function(t){hc("Blob.fromBase64String",arguments,1),lc("Blob.fromBase64String","string",1,t),Sc();try{return new Mc(di.fromBase64String(t))}catch(t){throw new zr(Gr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Mc.fromUint8Array=function(t){if(hc("Blob.fromUint8Array",arguments,1),xc(),!(t instanceof Uint8Array))throw _c("Blob.fromUint8Array","Uint8Array",1,t);return new Mc(di.fromUint8Array(t))},Mc.prototype.toBase64=function(){return hc("Blob.toBase64",arguments,0),Sc(),this._a.toBase64()},Mc.prototype.toUint8Array=function(){return hc("Blob.toUint8Array",arguments,0),xc(),this._a.toUint8Array()},Mc.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Mc.prototype.isEqual=function(t){return this._a.isEqual(t._a)},Mc),Oc=function(t){!function(){if(!(t instanceof Array)||t.length<1)throw new zr(Gr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var e=0;e<t.length;++e)if(lc("FieldPath","string",e,t[e]),0===t[e].length)throw new zr(Gr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.fa=new Qr(t)},kc=(n(jc,Pc=Oc),jc.documentId=function(){return new jc(Qr.L().N())},jc.prototype.isEqual=function(t){if(!(t instanceof jc))throw _c("isEqual","FieldPath",1,t);return this.fa.isEqual(t.fa)},jc),Lc=new RegExp("[~\\*/\\[\\]]"),Cc=function(){this.da=this},Vc=(n(Uc,Dc=Cc),Uc.prototype.Ta=function(t){if(2!==t.Ea)throw 1===t.Ea?t.Ia(this.wa+"() can only appear at the top level of your update data"):t.Ia(this.wa+"() cannot be used with set() unless you pass {merge:true}");return t.Le.push(t.path),null},Uc.prototype.isEqual=function(t){return t instanceof Uc},Uc);function Uc(t){var e=this;return(e=Dc.call(this)||this).wa=t,e}function jc(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Pc.call(this,t)||this}function Mc(t){Sc(),this._a=t}function Fc(t,e,n){return new vf({Ea:3,ma:e.settings.ma,methodName:t.wa,Aa:n},e.s,e.serializer,e.ignoreUndefinedProperties)}var qc,Bc,Gc,zc,Hc,Wc,Yc=(n(uf,Wc=Cc),uf.prototype.Ta=function(t){return new vs(t.path,new es)},uf.prototype.isEqual=function(t){return t instanceof uf},uf),Xc=(n(sf,Hc=Cc),sf.prototype.Ta=function(t){var e=Fc(this,t,!0),n=this.Ra.map(function(t){return Tf(t,e)}),r=new ns(n);return new vs(t.path,r)},sf.prototype.isEqual=function(t){return this===t},sf),Kc=(n(of,zc=Cc),of.prototype.Ta=function(t){var e=Fc(this,t,!0),n=this.Ra.map(function(t){return Tf(t,e)}),r=new us(n);return new vs(t.path,r)},of.prototype.isEqual=function(t){return this===t},of),Qc=(n(rf,Gc=Cc),rf.prototype.Ta=function(t){var e=new fs(t.serializer,Do(t.serializer,this.Pa));return new vs(t.path,e)},rf.prototype.isEqual=function(t){return this===t},rf),Jc=(n(nf,Bc=Cc),nf.delete=function(){return ac("FieldValue.delete",arguments),new $c(new Vc("FieldValue.delete"))},nf.serverTimestamp=function(){return ac("FieldValue.serverTimestamp",arguments),new $c(new Yc("FieldValue.serverTimestamp"))},nf.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return cc("FieldValue.arrayUnion",arguments,1),new $c(new Xc("FieldValue.arrayUnion",t))},nf.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return cc("FieldValue.arrayRemove",arguments,1),new $c(new Kc("FieldValue.arrayRemove",t))},nf.increment=function(t){return lc("FieldValue.increment","number",1,t),hc("FieldValue.increment",arguments,1),new $c(new Qc("FieldValue.increment",t))},nf),$c=(n(ef,qc=Jc),ef.prototype.Ta=function(t){return this.da.Ta(t)},ef.prototype.isEqual=function(t){return t instanceof ef&&this.da.isEqual(t.da)},ef),Zc=(Object.defineProperty(tf.prototype,"latitude",{get:function(){return this.Va},enumerable:!1,configurable:!0}),Object.defineProperty(tf.prototype,"longitude",{get:function(){return this.ga},enumerable:!1,configurable:!0}),tf.prototype.isEqual=function(t){return this.Va===t.Va&&this.ga===t.ga},tf.prototype.T=function(t){return Pr(this.Va,t.Va)||Pr(this.ga,t.ga)},tf);function tf(t,e){if(hc("GeoPoint",arguments,2),lc("GeoPoint","number",1,t),lc("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new zr(Gr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new zr(Gr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.Va=t,this.ga=e}function ef(t){var e=this;return(e=qc.call(this)||this).da=t,e.wa=t.wa,e}function nf(){return Bc.call(this)||this}function rf(t,e){var n=this;return(n=Gc.call(this)||this).wa=t,n.Pa=e,n}function of(t,e){var n=this;return(n=zc.call(this)||this).wa=t,n.Ra=e,n}function sf(t,e){var n=this;return(n=Hc.call(this)||this).wa=t,n.Ra=e,n}function uf(t){var e=this;return(e=Wc.call(this)||this).wa=t,e}function af(t){return new Ao(t,!0)}var hf=/^__.*__$/,cf=function(t,e,n){this.ya=t,this.pa=e,this.ba=n},ff=(df.prototype.va=function(t,e){var n=[];return null!==this.Le?n.push(new Ds(t,this.data,this.Le,e)):n.push(new Ss(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Ls(t,this.fieldTransforms)),n},df),lf=(pf.prototype.va=function(t,e){var n=[new Ds(t,this.data,this.Le,e)];return 0<this.fieldTransforms.length&&n.push(new Ls(t,this.fieldTransforms)),n},pf);function pf(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n}function df(t,e,n){this.data=t,this.Le=e,this.fieldTransforms=n}function yf(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Nr()}}var vf=(Object.defineProperty(wf.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(wf.prototype,"Ea",{get:function(){return this.settings.Ea},enumerable:!1,configurable:!0}),wf.prototype.Da=function(t){return new wf(Object.assign(Object.assign({},this.settings),t),this.s,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Le)},wf.prototype.Ca=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Da({path:n,Aa:!1});return r.Fa(t),r},wf.prototype.Na=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Da({path:n,Aa:!1});return r.Sa(),r},wf.prototype.$a=function(t){return this.Da({path:void 0,Aa:!0})},wf.prototype.Ia=function(t){return Pf(t,this.settings.methodName,this.settings.ka||!1,this.path,this.settings.ma)},wf.prototype.contains=function(e){return void 0!==this.Le.find(function(t){return e.D(t)})||void 0!==this.fieldTransforms.find(function(t){return e.D(t.field)})},wf.prototype.Sa=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Fa(this.path.get(t))},wf.prototype.Fa=function(t){if(0===t.length)throw this.Ia("Document fields must not be empty");if(yf(this.Ea)&&hf.test(t))throw this.Ia('Document fields cannot begin and end with "__"')},wf),gf=(mf.prototype.xa=function(t,e,n,r){return void 0===r&&(r=!1),new vf({Ea:t,methodName:e,ma:n,path:Qr.k(),Aa:!1,ka:r},this.s,this.serializer,this.ignoreUndefinedProperties)},mf);function mf(t,e,n){this.s=t,this.ignoreUndefinedProperties=e,this.serializer=n||af(t)}function wf(t,e,n,r,i,o){this.settings=t,this.s=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Sa(),this.fieldTransforms=i||[],this.Le=o||[]}function bf(t,e,n,r,i,o){void 0===o&&(o={});var s=t.xa(o.merge||o.mergeFields?2:0,e,n,i);xf("Data must be an object, but it was:",s,r);var u,a,h=Nf(r,s);if(o.merge)u=new ys(s.Le),a=s.fieldTransforms;else if(o.mergeFields){for(var c=[],f=0,l=o.mergeFields;f<l.length;f++){var p=l[f],d=void 0;if(p instanceof Oc)d=p.fa;else{if("string"!=typeof p)throw Nr();d=Df(e,p,n)}if(!s.contains(d))throw new zr(Gr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Rf(c,d)||c.push(d)}u=new ys(c),a=s.fieldTransforms.filter(function(t){return u.Ke(t.field)})}else u=null,a=s.fieldTransforms;return new ff(new qs(h),u,a)}function If(t,o,s,e){var u=t.xa(1,o,s);xf("Data must be an object, but it was:",u,e);var a=[],h=new Bs;Ur(e,function(t,e){var n,r=Df(o,t,s),i=u.Na(r);e instanceof Cc&&e.da instanceof Vc?a.push(r):null!=(n=Tf(e,i))&&(a.push(r),h.set(r,n))});var n=new ys(a);return new lf(h.ze(),n,u.fieldTransforms)}function Ef(t,e,n,r,i,o){var s=t.xa(1,e,n),u=[Sf(e,r,n)],a=[i];if(o.length%2!=0)throw new zr(Gr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var h=0;h<o.length;h+=2)u.push(Sf(e,o[h])),a.push(o[h+1]);for(var c,f,l,p,d=[],y=new Bs,v=u.length-1;0<=v;--v){Rf(d,u[v])||(c=u[v],f=a[v],l=s.Na(c),f instanceof Cc&&f.da instanceof Vc?d.push(c):null!=(p=Tf(f,l))&&(d.push(c),y.set(c,p)))}var g=new ys(d);return new lf(y.ze(),g,s.fieldTransforms)}function _f(t,e,n,r){return void 0===r&&(r=!1),Tf(n,t.xa(r?4:3,e))}function Tf(s,t){if(Af(s))return xf("Unsupported field value:",t,s),Nf(s,t);if(s instanceof Cc)return function(t,e){if(!yf(e.Ea))throw e.Ia(t.wa+"() can only be used with update() and set()");if(!e.path)throw e.Ia(t.wa+"() is not currently supported inside arrays");var n=t.Ta(e);n&&e.fieldTransforms.push(n)}(s,t),null;if(t.path&&t.Le.push(t.path),s instanceof Array){if(t.settings.Aa&&4!==t.Ea)throw t.Ia("Nested arrays are not supported");return function(t){for(var e=[],n=0,r=0,i=s;r<i.length;r++){var o=Tf(i[r],t.$a(n));null==o&&(o={nullValue:"NULL_VALUE"}),e.push(o),n++}return{arrayValue:{values:e}}}(t)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Do(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Hr.fromDate(t);return{timestampValue:Po(e.serializer,n)}}if(t instanceof Hr){var r=new Hr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Po(e.serializer,r)}}if(t instanceof Zc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Rc)return{bytesValue:Ro(e.serializer,t)};if(t instanceof cf){var i=e.s,o=t.ya;if(!o.isEqual(i))throw e.Ia("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:ko(t.ya||e.s,t.pa.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.Ia("Unsupported field value: "+bc(t))}(s,t)}function Nf(t,r){var i={};return jr(t)?r.path&&0<r.path.length&&r.Le.push(r.path):Ur(t,function(t,e){var n=Tf(e,r.Ca(t));null!=n&&(i[t]=n)}),{mapValue:{fields:i}}}function Af(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Hr||t instanceof Zc||t instanceof Rc||t instanceof cf||t instanceof Cc)}function xf(t,e,n){if(!Af(n)||!wc(n)){var r=bc(n);throw"an object"===r?e.Ia(t+" a custom object"):e.Ia(t+" "+r)}}function Sf(t,e,n){if(e instanceof Oc)return e.fa;if("string"==typeof e)return Df(t,e);throw Pf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Df(t,e,n){try{return function(e){if(0<=e.search(Lc))throw new zr(Gr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(kc.bind.apply(kc,d([void 0],e.split("."))))}catch(t){throw new zr(Gr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).fa}catch(e){throw Pf(e instanceof Error?e.message:e.toString(),t,!1,void 0,n)}}function Pf(t,e,n,r,i){var o=r&&!r._(),s=void 0!==i,u="Function "+e+"() called with invalid data";n&&(u+=" (via `toFirestore()`)");var a="";return(o||s)&&(a+=" (found",o&&(a+=" in field "+r),s&&(a+=" in document "+i),a+=")"),new zr(Gr.INVALID_ARGUMENT,(u+=". ")+t+a)}function Rf(t,e){return t.some(function(t){return t.isEqual(e)})}var Of=(kf.prototype.Yr=function(){return null!=this.uid},kf.prototype.Ma=function(){return this.Yr()?"uid:"+this.uid:"anonymous-user"},kf.prototype.isEqual=function(t){return t.uid===this.uid},kf);function kf(t){this.uid=t}function Lf(t,e){this.user=e,this.type="OAuth",this.Ba={},this.Ba.Authorization="Bearer "+t}Of.UNAUTHENTICATED=new Of(null),Of.Oa=new Of("google-credentials-uid"),Of.La=new Of("first-party-uid");var Cf,Vf,Uf,jf=(ol.prototype.getToken=function(){return Promise.resolve(null)},ol.prototype.Ua=function(){},ol.prototype.Qa=function(t){(this.qa=t)(Of.UNAUTHENTICATED)},ol.prototype.Wa=function(){this.qa=null},ol),Mf=(il.prototype.getToken=function(){var e=this,n=this.Ga,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(function(t){return e.Ga!==n?(Er("FirebaseCredentialsProvider","getToken aborted due to token change."),e.getToken()):t?(Ar("string"==typeof t.accessToken),new Lf(t.accessToken,e.currentUser)):null}):Promise.resolve(null)},il.prototype.Ua=function(){this.forceRefresh=!0},il.prototype.Qa=function(t){this.qa=t,this.Ka&&t(this.currentUser)},il.prototype.Wa=function(){this.auth&&this.auth.removeAuthTokenListener(this.ja),this.ja=null,this.qa=null},il.prototype.za=function(){var t=this.auth&&this.auth.getUid();return Ar(null===t||"string"==typeof t),new Of(t)},il),Ff=(Object.defineProperty(rl.prototype,"Ba",{get:function(){var t={"X-Goog-AuthUser":this.Ya},e=this.Ha.auth.Ja([]);return e&&(t.Authorization=e),t},enumerable:!1,configurable:!0}),rl),qf=(nl.prototype.getToken=function(){return Promise.resolve(new Ff(this.Ha,this.Ya))},nl.prototype.Qa=function(t){t(Of.La)},nl.prototype.Wa=function(){},nl.prototype.Ua=function(){},nl),Bf=(el.prototype.su=function(){return 1===this.state||2===this.state||4===this.state},el.prototype.iu=function(){return 2===this.state},el.prototype.start=function(){3!==this.state?this.auth():this.ru()},el.prototype.stop=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.su()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},el.prototype.ou=function(){this.state=0,this.xo.reset()},el.prototype.hu=function(){var t=this;this.iu()&&null===this.nu&&(this.nu=this.bs.Os(this.Xa,6e4,function(){return t.au()}))},el.prototype.uu=function(t){this.cu(),this.stream.send(t)},el.prototype.au=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.iu()?[2,this.close(0)]:[2]})})},el.prototype.cu=function(){this.nu&&(this.nu.cancel(),this.nu=null)},el.prototype.close=function(e,n){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.cu(),this.xo.cancel(),this.eu++,3!==e?this.xo.reset():n&&n.code===Gr.RESOURCE_EXHAUSTED?(_r(n.toString()),_r("Using maximum backoff delay to prevent overloading the backend."),this.xo.ks()):n&&n.code===Gr.UNAUTHENTICATED&&this.tu.Ua(),null!==this.stream&&(this.lu(),this.stream.close(),this.stream=null),this.state=e,[4,this.listener._u(n)];case 1:return t.sent(),[2]}})})},el.prototype.lu=function(){},el.prototype.auth=function(){var n=this;this.state=1;var t=this.fu(this.eu),e=this.eu;this.tu.getToken().then(function(t){n.eu===e&&n.du(t)},function(e){t(function(){var t=new zr(Gr.UNKNOWN,"Fetching auth token failed: "+e.message);return n.wu(t)})})},el.prototype.du=function(t){var e=this,n=this.fu(this.eu);this.stream=this.Tu(t),this.stream.Eu(function(){n(function(){return e.state=2,e.listener.Eu()})}),this.stream._u(function(t){n(function(){return e.wu(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},el.prototype.ru=function(){var t=this;this.state=4,this.xo.xs(function(){return y(t,void 0,void 0,function(){return v(this,function(t){return this.state=0,this.start(),[2]})})})},el.prototype.wu=function(t){return Er("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},el.prototype.fu=function(e){var n=this;return function(t){n.bs.lr(function(){return n.eu===e?t():(Er("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},el),Gf=(n(tl,Uf=Bf),tl.prototype.Tu=function(t){return this.Za.Iu("Listen",t)},tl.prototype.onMessage=function(t){this.xo.reset();var e=function(t,e){var n,r,i,o;if("targetChange"in e){e.targetChange;var s="NO_CHANGE"===(o=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===o?1:"REMOVE"===o?2:"CURRENT"===o?3:"RESET"===o?4:Nr(),u=e.targetChange.targetIds||[],a=(i=e.targetChange.resumeToken,t.Oe?(Ar(void 0===i||"string"==typeof i),di.fromBase64String(i||"")):(Ar(void 0===i||i instanceof Uint8Array),di.fromUint8Array(i||new Uint8Array))),h=e.targetChange.cause,c=new Bi(s,u,a,h&&(r=void 0===(n=h).code?Gr.UNKNOWN:Ei(n.code),new zr(r,n.message||""))||null)}else if("documentChange"in e){e.documentChange;var f=e.documentChange;f.document,f.document.name,f.document.updateTime;var l=Vo(t,f.document.name),p=Oo(f.document.updateTime),d=new qs({mapValue:{fields:f.document.fields}}),y=new $s(l,p,d,{});c=new Fi(f.targetIds||[],f.removedTargetIds||[],y.key,y)}else if("documentDelete"in e){e.documentDelete;var v=e.documentDelete;v.document;var g=Vo(t,v.document),m=v.readTime?Oo(v.readTime):Wr.min(),w=new Zs(g,m);c=new Fi([],v.removedTargetIds||[],w.key,w)}else if("documentRemove"in e){e.documentRemove;var b=e.documentRemove;b.document;var I=Vo(t,b.document);c=new Fi([],b.removedTargetIds||[],I,null)}else{if(!("filter"in e))return Nr();e.filter;var E=e.filter;E.targetId;var _=new vi(E.count||0);c=new qi(E.targetId,_)}return c}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Wr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Wr.min():Oo(e.readTime)}(t);return this.listener.mu(e,n)},tl.prototype.Au=function(t){var e,n,r,i,o={};o.database=Mo(this.serializer),o.addTarget=(e=this.serializer,(r=pi(i=(n=t).target)?{documents:zo(e,i)}:{query:Ho(e,i)}).targetId=n.targetId,0<n.resumeToken.H()&&(r.resumeToken=Ro(e,n.resumeToken)),r);var s,u,a=(this.serializer,s=t,null==(u=function(){switch(s.J){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Nr()}}())?null:{"goog-listen-tags":u});a&&(o.labels=a),this.uu(o)},tl.prototype.Ru=function(t){var e={};e.database=Mo(this.serializer),e.removeTarget=t,this.uu(e)},tl),zf=(n(Zf,Vf=Bf),Object.defineProperty(Zf.prototype,"Vu",{get:function(){return this.Pu},enumerable:!1,configurable:!0}),Zf.prototype.start=function(){this.Pu=!1,this.lastStreamToken=void 0,Vf.prototype.start.call(this)},Zf.prototype.lu=function(){this.Pu&&this.gu([])},Zf.prototype.Tu=function(t){return this.Za.Iu("Write",t)},Zf.prototype.onMessage=function(t){if(Ar(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Pu){this.xo.reset();var e=(r=t.writeResults,i=t.commitTime,r&&0<r.length?(Ar(void 0!==i),r.map(function(t){return function(t,e){var n=t.updateTime?Oo(t.updateTime):Oo(e);n.isEqual(Wr.min())&&(n=Oo(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new ms(n,r)}(t,i)})):[]),n=Oo(t.commitTime);return this.listener.yu(n,e)}var r,i;return Ar(!t.writeResults||0===t.writeResults.length),this.Pu=!0,this.listener.pu()},Zf.prototype.bu=function(){var t={};t.database=Mo(this.serializer),this.uu(t)},Zf.prototype.gu=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Bo(e.serializer,t)})};this.uu(n)},Zf),Hf=(n($f,Cf=function(){this.je=void 0}),$f.prototype.Su=function(){if(this.vu)throw new zr(Gr.FAILED_PRECONDITION,"The client has already been terminated.")},$f.prototype.Du=function(e,n){var r=this;return this.Su(),this.credentials.getToken().then(function(t){return r.Za.Du(e,n,t)}).catch(function(t){throw t.code===Gr.UNAUTHENTICATED&&r.credentials.Ua(),t})},$f.prototype.Cu=function(e,n){var r=this;return this.Su(),this.credentials.getToken().then(function(t){return r.Za.Cu(e,n,t)}).catch(function(t){throw t.code===Gr.UNAUTHENTICATED&&r.credentials.Ua(),t})},$f),Wf=(Jf.prototype.Mu=function(r){return y(this,void 0,void 0,function(){var e,n=this;return v(this,function(t){switch(t.label){case 0:if(this.Ou(),0<this.mutations.length)throw new zr(Gr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(s,u){return y(this,void 0,void 0,function(){var i,e,n,o,r;return v(this,function(t){switch(t.label){case 0:return e={database:Mo((i=s).serializer),documents:u.map(function(t){return Co(i.serializer,t)})},[4,i.Cu("BatchGetDocuments",e)];case 1:return n=t.sent(),o=new Map,n.forEach(function(t){var e,n,r=(e=i.serializer,"found"in(n=t)?function(t,e){Ar(!!e.found),e.found.name,e.found.updateTime;var n=Vo(t,e.found.name),r=Oo(e.found.updateTime),i=new qs({mapValue:{fields:e.found.fields}});return new $s(n,r,i,{})}(e,n):"missing"in n?function(t,e){Ar(!!e.missing),Ar(!!e.readTime);var n=Vo(t,e.missing),r=Oo(e.readTime);return new Zs(n,r)}(e,n):Nr());o.set(r.key.toString(),r)}),r=[],[2,(u.forEach(function(t){var e=o.get(t.toString());Ar(!!e),r.push(e)}),r)]}})})}(this.Fu,r)];case 1:return[2,((e=t.sent()).forEach(function(t){t instanceof Zs||t instanceof $s?n.Lu(t):Nr()}),e)]}})})},Jf.prototype.set=function(t,e){this.write(e.va(t,this.Ue(t))),this.xu.add(t)},Jf.prototype.update=function(t,e){try{this.write(e.va(t,this.Bu(t)))}catch(t){this.ku=t}this.xu.add(t)},Jf.prototype.delete=function(t){this.write([new Ms(t,this.Ue(t))]),this.xu.add(t)},Jf.prototype.commit=function(){return y(this,void 0,void 0,function(){var e,r=this;return v(this,function(t){switch(t.label){case 0:if(this.Ou(),this.ku)throw this.ku;return e=this.Nu,this.mutations.forEach(function(t){e.delete(t.key.toString())}),e.forEach(function(t,e){var n=new Jr(Xr.$(e));r.mutations.push(new Fs(n,r.Ue(n)))}),[4,function(r,i){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return n={database:Mo((e=r).serializer),writes:i.map(function(t){return Bo(e.serializer,t)})},[4,e.Du("Commit",n)];case 1:return t.sent(),[2]}})})}(this.Fu,this.mutations)];case 1:return t.sent(),this.$u=!0,[2]}})})},Jf.prototype.Lu=function(t){var e;if(t instanceof $s)e=t.version;else{if(!(t instanceof Zs))throw Nr();e=Wr.min()}var n=this.Nu.get(t.key.toString());if(n){if(!e.isEqual(n))throw new zr(Gr.ABORTED,"Document version changed between two reads.")}else this.Nu.set(t.key.toString(),e)},Jf.prototype.Ue=function(t){var e=this.Nu.get(t.toString());return!this.xu.has(t)&&e?ws.updateTime(e):ws.Qe()},Jf.prototype.Bu=function(t){var e=this.Nu.get(t.toString());if(this.xu.has(t)||!e)return ws.exists(!0);if(e.isEqual(Wr.min()))throw new zr(Gr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ws.updateTime(e)},Jf.prototype.write=function(t){this.Ou(),this.mutations=this.mutations.concat(t)},Jf.prototype.Ou=function(){},Jf),Yf=(Qf.prototype.ju=function(){var t=this;0===this.Uu&&(this.Ku("Unknown"),this.Qu=this.Ro.Os("online_state_timeout",1e4,function(){return t.Qu=null,t.Gu("Backend didn't respond within 10 seconds."),t.Ku("Offline"),Promise.resolve()}))},Qf.prototype.zu=function(t){"Online"===this.state?this.Ku("Unknown"):(this.Uu++,1<=this.Uu&&(this.Hu(),this.Gu("Connection failed 1 times. Most recent error: "+t.toString()),this.Ku("Offline")))},Qf.prototype.set=function(t){this.Hu(),this.Uu=0,"Online"===t&&(this.Wu=!1),this.Ku(t)},Qf.prototype.Ku=function(t){t!==this.state&&(this.state=t,this.qu(t))},Qf.prototype.Gu=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Wu?(_r(e),this.Wu=!1):Er("OnlineStateTracker",e)},Qf.prototype.Hu=function(){null!==this.Qu&&(this.Qu.cancel(),this.Qu=null)},Qf),Xf=(Kf.prototype.start=function(){return this.enableNetwork()},Kf.prototype.enableNetwork=function(){return this.tc.delete(0),this.dc()},Kf.prototype.dc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.sc()?(this.wc()?this.Tc():this.rc.set("Unknown"),[4,this.Ec()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},Kf.prototype.disableNetwork=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.tc.add(0),[4,this.Ic()];case 1:return t.sent(),this.rc.set("Offline"),[2]}})})},Kf.prototype.Ic=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.cc.stop()];case 1:return t.sent(),[4,this.oc.stop()];case 2:return t.sent(),0<this.Ju.length&&(Er("RemoteStore","Stopping write stream with "+this.Ju.length+" pending writes"),this.Ju=[]),this.mc(),[2]}})})},Kf.prototype.yr=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Er("RemoteStore","RemoteStore shutting down."),this.tc.add(5),[4,this.Ic()];case 1:return t.sent(),this.ec.yr(),this.rc.set("Unknown"),[2]}})})},Kf.prototype.listen=function(t){this.Xu.has(t.targetId)||(this.Xu.set(t.targetId,t),this.wc()?this.Tc():this.oc.iu()&&this.Ac(t))},Kf.prototype.Rc=function(t){this.Xu.delete(t),this.oc.iu()&&this.Pc(t),0===this.Xu.size&&(this.oc.iu()?this.oc.hu():this.sc()&&this.rc.set("Unknown"))},Kf.prototype.Me=function(t){return this.Xu.get(t)||null},Kf.prototype.xe=function(t){return this.Vc.xe(t)},Kf.prototype.Ac=function(t){this.Zu.de(t.targetId),this.oc.Au(t)},Kf.prototype.Pc=function(t){this.Zu.de(t),this.oc.Ru(t)},Kf.prototype.Tc=function(){this.Zu=new Ki(this),this.oc.start(),this.rc.ju()},Kf.prototype.wc=function(){return this.sc()&&!this.oc.su()&&0<this.Xu.size},Kf.prototype.sc=function(){return 0===this.tc.size},Kf.prototype.mc=function(){this.Zu=null},Kf.prototype.hc=function(){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){return this.Xu.forEach(function(t,e){n.Ac(t)}),[2]})})},Kf.prototype.ac=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return this.mc(),this.wc()?(this.rc.zu(e),this.Tc()):this.rc.set("Unknown"),[2]})})},Kf.prototype.uc=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:if(this.rc.set("Online"),!(i instanceof Bi&&2===i.state&&i.cause))return[3,6];t.label=1;case 1:return t.trys.push([1,3,,5]),[4,this.gc(i)];case 2:return t.sent(),[3,5];case 3:return e=t.sent(),Er("RemoteStore","Failed to remove targets %s: %s ",i.targetIds.join(","),e),[4,this.yc(e)];case 4:return t.sent(),[3,5];case 5:return[3,13];case 6:if(i instanceof Fi?this.Zu.Pe(i):i instanceof qi?this.Zu.De(i):this.Zu.ye(i),o.isEqual(Wr.min()))return[3,13];t.label=7;case 7:return t.trys.push([7,11,,13]),[4,this.Yu.mi()];case 8:return n=t.sent(),0<=o.o(n)?[4,this.pc(o)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[3,13];case 11:return Er("RemoteStore","Failed to raise snapshot:",r=t.sent()),[4,this.yc(r)];case 12:return t.sent(),[3,13];case 13:return[2]}})})},Kf.prototype.yc=function(n,r){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:if(!Sh(n))throw n;return this.tc.add(1),[4,this.Ic()];case 1:return t.sent(),this.rc.set("Offline"),r=r||function(){return e.Yu.mi()},this.Ro.dr(function(){return y(e,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return Er("RemoteStore","Retrying IndexedDB access"),[4,r()];case 1:return t.sent(),this.tc.delete(1),[4,this.dc()];case 2:return t.sent(),[2]}})})}),[2]}})})},Kf.prototype.bc=function(e){var n=this;return e().catch(function(t){return n.yc(t,e)})},Kf.prototype.pc=function(r){var i=this,t=this.Zu.Ne(r);return t.Qt.forEach(function(t,e){var n;0<t.resumeToken.H()&&((n=i.Xu.get(e))&&i.Xu.set(e,n.tt(t.resumeToken,r)))}),t.Wt.forEach(function(t){var e,n=i.Xu.get(t);n&&(i.Xu.set(t,n.tt(di.Y,n.X)),i.Pc(t),e=new wi(n.target,t,1,n.sequenceNumber),i.Ac(e))}),this.Vc.qh(t)},Kf.prototype.gc=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:e=o.cause,n=0,r=o.targetIds,t.label=1;case 1:return n<r.length?(i=r[n],this.Xu.has(i)?[4,this.Vc.vc(i,e)]:[3,3]):[3,5];case 2:t.sent(),this.Xu.delete(i),this.Zu.removeTarget(i),t.label=3;case 3:t.label=4;case 4:return n++,[3,1];case 5:return[2]}})})},Kf.prototype.Ec=function(){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:e=0<this.Ju.length?this.Ju[this.Ju.length-1].batchId:-1,t.label=1;case 1:if(!this.Sc())return[3,7];t.label=2;case 2:return t.trys.push([2,4,,6]),[4,this.Yu.jh(e)];case 3:return null===(n=t.sent())?(0===this.Ju.length&&this.cc.hu(),[3,7]):(e=n.batchId,this.Dc(n),[3,6]);case 4:return r=t.sent(),[4,this.yc(r)];case 5:return t.sent(),[3,6];case 6:return[3,1];case 7:return this.Cc()&&this.Fc(),[2]}})})},Kf.prototype.Sc=function(){return this.sc()&&this.Ju.length<10},Kf.prototype.Nc=function(){return this.Ju.length},Kf.prototype.Dc=function(t){this.Ju.push(t),this.cc.iu()&&this.cc.Vu&&this.cc.gu(t.mutations)},Kf.prototype.Cc=function(){return this.sc()&&!this.cc.su()&&0<this.Ju.length},Kf.prototype.Fc=function(){this.cc.start()},Kf.prototype.lc=function(){return y(this,void 0,void 0,function(){return v(this,function(t){return this.cc.bu(),[2]})})},Kf.prototype.fc=function(){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){for(e=0,n=this.Ju;e<n.length;e++)r=n[e],this.cc.gu(r.mutations);return[2]})})},Kf.prototype.yu=function(i,o){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return e=this.Ju.shift(),n=Vu.from(e,i,o),[4,this.bc(function(){return r.Vc.$c(n)})];case 1:return t.sent(),[4,this.Ec()];case 2:return t.sent(),[2]}})})},Kf.prototype._c=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e&&this.cc.Vu?[4,this.kc(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return this.Cc()&&this.Fc(),[2]}})})},Kf.prototype.kc=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return Ii(n=i.code)&&n!==Gr.ABORTED?(e=this.Ju.shift(),this.cc.ou(),[4,this.bc(function(){return r.Vc.xc(e.batchId,i)})]):[3,3];case 1:return t.sent(),[4,this.Ec()];case 2:t.sent(),t.label=3;case 3:return[2]}})})},Kf.prototype.Mc=function(){return new Wf(this.Fu)},Kf.prototype.ic=function(){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.tc.add(4),[4,this.Ic()];case 1:return t.sent(),this.rc.set("Unknown"),this.tc.delete(4),[4,this.dc()];case 2:return t.sent(),[2]}})})},Kf.prototype.Oc=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Ro.Ko(),Er("RemoteStore","RemoteStore received new credentials"),this.tc.add(3),[4,this.Ic()];case 1:return t.sent(),this.rc.set("Unknown"),[4,this.Vc.Oc(e)];case 2:return t.sent(),this.tc.delete(3),[4,this.dc()];case 3:return t.sent(),[2]}})})},Kf.prototype.Lc=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return e?(this.tc.delete(2),[4,this.dc()]):[3,2];case 1:return t.sent(),[3,5];case 2:return e?[3,4]:(this.tc.add(2),[4,this.Ic()]);case 3:t.sent(),this.rc.set("Unknown"),t.label=4;case 4:t.label=5;case 5:return[2]}})})},Kf);function Kf(t,e,n,r,i){var o,s,u,a,h,c,f=this;this.Yu=t,this.Fu=e,this.Ro=n,this.Ju=[],this.Xu=new Map,this.Zu=null,this.tc=new Set,this.ec=i,this.ec.nc(function(t){n.lr(function(){return y(f,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.sc()?(Er("RemoteStore","Restarting streams for network reachability change."),[4,this.ic()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.rc=new Yf(n,r),this.oc=(a=this.Fu,h=n,c={Eu:this.hc.bind(this),_u:this.ac.bind(this),mu:this.uc.bind(this)},new Gf(h,a.Za,a.credentials,a.serializer,c)),this.cc=(o=this.Fu,s=n,u={Eu:this.lc.bind(this),_u:this._c.bind(this),pu:this.fc.bind(this),yu:this.yu.bind(this)},new zf(s,o.Za,o.credentials,o.serializer,u))}function Qf(t,e){this.Ro=t,this.qu=e,this.state="Unknown",this.Uu=0,this.Qu=null,this.Wu=!0}function Jf(t){this.Fu=t,this.Nu=new Map,this.mutations=[],this.$u=!1,this.ku=null,this.xu=new Set}function $f(t,e,n){var r=this;return(r=Cf.call(this)||this).Za=t,r.credentials=e,r.serializer=n,r.vu=!1,r}function Zf(t,e,n,r,i){var o=this;return(o=Vf.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.Pu=!1,o}function tl(t,e,n,r,i){var o=this;return(o=Uf.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function el(t,e,n,r,i,o){this.bs=t,this.Xa=n,this.Za=r,this.tu=i,this.listener=o,this.state=0,this.eu=0,this.nu=null,this.stream=null,this.xo=new Zu(t,e)}function nl(t,e){this.Ha=t,this.Ya=e}function rl(t,e){this.Ha=t,this.Ya=e,this.type="FirstParty",this.user=Of.La}function il(t){var e=this;this.ja=null,this.currentUser=Of.UNAUTHENTICATED,this.Ka=!1,this.Ga=0,this.qa=null,this.forceRefresh=!1,this.ja=function(){e.Ga++,e.currentUser=e.za(),e.Ka=!0,e.qa&&e.qa(e.currentUser)},this.Ga=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.ja):(this.ja(null),t.get().then(function(t){e.auth=t,e.ja&&e.auth.addAuthTokenListener(e.ja)},function(){}))}function ol(){this.qa=null}function sl(t,e){return"firestore_clients_"+t+"_"+e}function ul(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.Yr()&&(r+="_"+e.uid),r}function al(t,e){return"firestore_targets_"+t+"_"+e}function hl(t){this.key=t}function cl(t){this.key=t}function fl(t,e,n){this.query=t,this.targetId=e,this.view=n}function ll(t){this.key=t,this.t_=!1}function pl(){this.O_=void 0,this.listeners=[]}var dl,yl,vl=(Yl.Bc=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new zr(r.error.code,r.error.message)),i?new Yl(t,e,r.state,o):(_r("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},Yl.prototype.qc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Yl),gl=(Wl.Bc=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new zr(n.error.code,n.error.message)),r?new Wl(t,n.state,i):(_r("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Wl.prototype.qc=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Wl),ml=(Hl.Bc=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=Mi,o=0;r&&o<n.activeTargetIds.length;++o)r=ai(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new Hl(t,i):(_r("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},Hl),wl=(zl.Bc=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new zl(e.clientId,e.onlineState):(_r("SharedClientState","Failed to parse online state: "+t),null)},zl),bl=(Gl.prototype.Uc=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Gl.prototype.Qc=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Gl.prototype.qc=function(){var t={activeTargetIds:this.activeTargetIds.F(),updateTimeMs:Date.now()};return JSON.stringify(t)},Gl),Il=(Bl.Hi=function(t){return!(!t||!t.localStorage)},Bl.prototype.start=function(){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l=this;return v(this,function(t){switch(t.label){case 0:return[4,this.Vc.Dr()];case 1:for(e=t.sent(),n=0,r=e;n<r.length;n++)(i=r[n])!==this.Wc&&(o=this.getItem(sl(this.persistenceKey,i)))&&(s=ml.Bc(i,o))&&(this.Gc=this.Gc.nt(s.clientId,s));for(this.el(),(u=this.storage.getItem(this.tl))&&(a=this.nl(u))&&this.sl(a),h=0,c=this.zc;h<c.length;h++)f=c[h],this.Kc(f);return this.zc=[],this.window.addEventListener("unload",function(){return l.yr()}),this.hr=!0,[2]}})})},Bl.prototype.ys=function(t){this.setItem(this.Yc,JSON.stringify(t))},Bl.prototype.il=function(){return this.rl(this.Gc)},Bl.prototype.ol=function(n){var r=!1;return this.Gc.forEach(function(t,e){e.activeTargetIds.has(n)&&(r=!0)}),r},Bl.prototype.hl=function(t){this.al(t,"pending")},Bl.prototype.ul=function(t,e,n){this.al(t,e,n),this.cl(t)},Bl.prototype.ll=function(t){var e,n,r="not-current";return this.ol(t)&&(!(e=this.storage.getItem(al(this.persistenceKey,t)))||(n=gl.Bc(t,e))&&(r=n.state)),this._l.Uc(t),this.el(),r},Bl.prototype.fl=function(t){this._l.Qc(t),this.el()},Bl.prototype.dl=function(t){return this._l.activeTargetIds.has(t)},Bl.prototype.wl=function(t){this.removeItem(al(this.persistenceKey,t))},Bl.prototype.Tl=function(t,e,n){this.El(t,e,n)},Bl.prototype.Nh=function(t,e,n){var r=this;e.forEach(function(t){r.cl(t)}),this.currentUser=t,n.forEach(function(t){r.hl(t)})},Bl.prototype.Il=function(t){this.ml(t)},Bl.prototype.yr=function(){this.hr&&(this.window.removeEventListener("storage",this.jc),this.removeItem(this.Hc),this.hr=!1)},Bl.prototype.getItem=function(t){var e=this.storage.getItem(t);return Er("SharedClientState","READ",t,e),e},Bl.prototype.setItem=function(t,e){Er("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Bl.prototype.removeItem=function(t){Er("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Bl.prototype.Kc=function(t){var e=this,u=t;if(u.storageArea===this.storage){if(Er("SharedClientState","EVENT",u.key,u.newValue),u.key===this.Hc)return void _r("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.bs.dr(function(){return y(e,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){if(this.hr){if(null!==u.key)if(this.Jc.test(u.key)){if(null==u.newValue)return e=this.Al(u.key),[2,this.Rl(e,null)];if(n=this.Pl(u.key,u.newValue))return[2,this.Rl(n.clientId,n)]}else if(this.Xc.test(u.key)){if(null!==u.newValue&&(r=this.Vl(u.key,u.newValue)))return[2,this.gl(r)]}else if(this.Zc.test(u.key)){if(null!==u.newValue&&(i=this.yl(u.key,u.newValue)))return[2,this.pl(i)]}else if(u.key===this.tl){if(null!==u.newValue&&(o=this.nl(u.newValue)))return[2,this.sl(o)]}else u.key===this.Yc&&(s=function(t){var e=Gu.ps;if(null!=t)try{var n=JSON.parse(t);Ar("number"==typeof n),e=n}catch(t){_r("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(u.newValue))!==Gu.ps&&this.Ps(s)}else this.zc.push(u);return[2]})})})}},Object.defineProperty(Bl.prototype,"_l",{get:function(){return this.Gc.get(this.Wc)},enumerable:!1,configurable:!0}),Bl.prototype.el=function(){this.setItem(this.Hc,this._l.qc())},Bl.prototype.al=function(t,e,n){var r=new vl(this.currentUser,t,e,n),i=ul(this.persistenceKey,this.currentUser,t);this.setItem(i,r.qc())},Bl.prototype.cl=function(t){var e=ul(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Bl.prototype.ml=function(t){var e={clientId:this.Wc,onlineState:t};this.storage.setItem(this.tl,JSON.stringify(e))},Bl.prototype.El=function(t,e,n){var r=al(this.persistenceKey,t),i=new gl(t,e,n);this.setItem(r,i.qc())},Bl.prototype.Al=function(t){var e=this.Jc.exec(t);return e?e[1]:null},Bl.prototype.Pl=function(t,e){var n=this.Al(t);return ml.Bc(n,e)},Bl.prototype.Vl=function(t,e){var n=this.Xc.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return vl.Bc(new Of(i),r,e)},Bl.prototype.yl=function(t,e){var n=this.Zc.exec(t),r=Number(n[1]);return gl.Bc(r,e)},Bl.prototype.nl=function(t){return wl.Bc(t)},Bl.prototype.gl=function(e){return y(this,void 0,void 0,function(){return v(this,function(t){return e.user.uid===this.currentUser.uid?[2,this.Vc.bl(e.batchId,e.state,e.error)]:(Er("SharedClientState","Ignoring mutation for non-active user "+e.user.uid),[2])})})},Bl.prototype.pl=function(t){return this.Vc.vl(t.targetId,t.state,t.error)},Bl.prototype.Rl=function(t,e){var n=this,r=e?this.Gc.nt(t,e):this.Gc.remove(t),i=this.rl(this.Gc),o=this.rl(r),s=[],u=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||u.push(t)}),this.Vc.Sl(s,u).then(function(){n.Gc=r})},Bl.prototype.sl=function(t){this.Gc.get(t.clientId)&&this.qu(t.onlineState)},Bl.prototype.rl=function(t){var n=Mi;return t.forEach(function(t,e){n=n.Ct(e.activeTargetIds)}),n},Bl),El=(ql.prototype.hl=function(t){},ql.prototype.ul=function(t,e,n){},ql.prototype.ll=function(t){return this.Dl.Uc(t),this.Cl[t]||"not-current"},ql.prototype.Tl=function(t,e,n){this.Cl[t]=e},ql.prototype.fl=function(t){this.Dl.Qc(t)},ql.prototype.dl=function(t){return this.Dl.activeTargetIds.has(t)},ql.prototype.wl=function(t){delete this.Cl[t]},ql.prototype.il=function(){return this.Dl.activeTargetIds},ql.prototype.ol=function(t){return this.Dl.activeTargetIds.has(t)},ql.prototype.start=function(){return this.Dl=new bl,Promise.resolve()},ql.prototype.Nh=function(t,e,n){},ql.prototype.Il=function(t){},ql.prototype.yr=function(){},ql.prototype.ys=function(t){},ql),_l=(Object.defineProperty(Fl.prototype,"Ml",{get:function(){return this.Fl},enumerable:!1,configurable:!0}),Fl.prototype.Ol=function(t,e){var u=this,a=e?e.Ll:new zi,h=e?e.xl:this.xl,c=e?e.Lt:this.Lt,f=h,l=!1,p=this.query.In()&&h.size===this.query.limit?h.last():null,d=this.query.mn()&&h.size===this.query.limit?h.first():null;if(t.ot(function(t,e){var n=h.get(t),r=(r=e instanceof $s?e:null)&&(hu(u.query,r)?r:null),i=!!n&&u.Lt.has(n.key),o=!!r&&(r.Ge||u.Lt.has(r.key)&&r.hasCommittedMutations),s=!1;n&&r?n.data().isEqual(r.data())?i!==o&&(a.track({type:3,doc:r}),s=!0):u.Bl(n,r)||(a.track({type:2,doc:r}),s=!0,(p&&0<u.kl(r,p)||d&&u.kl(r,d)<0)&&(l=!0)):!n&&r?(a.track({type:0,doc:r}),s=!0):n&&!r&&(a.track({type:1,doc:n}),s=!0,(p||d)&&(l=!0)),s&&(c=r?(f=f.add(r),o?c.add(t):c.delete(t)):(f=f.delete(t),c.delete(t)))}),this.query.In()||this.query.mn())for(;f.size>this.query.limit;){var n=this.query.In()?f.last():f.first(),f=f.delete(n.key),c=c.delete(n.key);a.track({type:1,doc:n})}return{xl:f,Ll:a,ql:l,Lt:c}},Fl.prototype.Bl=function(t,e){return t.Ge&&e.hasCommittedMutations&&!e.Ge},Fl.prototype.Jn=function(t,e,n){var o=this,r=this.xl;this.xl=t.xl,this.Lt=t.Lt;var i=t.Ll.Mt();i.sort(function(t,e){return r=t.type,i=e.type,n(r)-n(i)||o.kl(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Nr()}}var r,i}),this.Ul(n);var s=e?this.Ql():[],u=0===this.$l.size&&this.Ht?1:0,a=u!==this.Nl;return this.Nl=u,0!==i.length||a?{snapshot:new Hi(this.query,t.xl,r,i,t.Lt,0==u,a,!1),Wl:s}:{Wl:s}},Fl.prototype.jl=function(t){return this.Ht&&"Offline"===t?(this.Ht=!1,this.Jn({xl:this.xl,Ll:new zi,Lt:this.Lt,ql:!1},!1)):{Wl:[]}},Fl.prototype.Kl=function(t){return!this.Fl.has(t)&&!!this.xl.has(t)&&!this.xl.get(t).Ge},Fl.prototype.Ul=function(t){var e=this;t&&(t.Yt.forEach(function(t){return e.Fl=e.Fl.add(t)}),t.Jt.forEach(function(t){}),t.Xt.forEach(function(t){return e.Fl=e.Fl.delete(t)}),this.Ht=t.Ht)},Fl.prototype.Ql=function(){var e=this;if(!this.Ht)return[];var n=this.$l;this.$l=ji(),this.xl.forEach(function(t){e.Kl(t.key)&&(e.$l=e.$l.add(t.key))});var r=[];return n.forEach(function(t){e.$l.has(t)||r.push(new cl(t))}),this.$l.forEach(function(t){n.has(t)||r.push(new hl(t))}),r},Fl.prototype.Gl=function(t){this.Fl=t.Yh,this.$l=ji();var e=this.Ol(t.documents);return this.Jn(e,!0)},Fl.prototype.zl=function(){return Hi.Ut(this.query,this.xl,this.Lt,0===this.Nl)},Fl),Tl=(Ml.prototype.run=function(){this.Yl()},Ml.prototype.Yl=function(){var t=this;this.xo.xs(function(){return y(t,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){return e=new Wf(this.Fu),(n=this.Jl(e))&&n.then(function(t){r.Ro.lr(function(){return e.commit().then(function(){r.yo.resolve(t)}).catch(function(t){r.Xl(t)})})}).catch(function(t){r.Xl(t)}),[2]})})})},Ml.prototype.Jl=function(t){try{var e=this.updateFunction(t);return!si(e)&&e.catch&&e.then?e:(this.yo.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.yo.reject(t),null}},Ml.prototype.Xl=function(t){var e=this;0<this.Hl&&this.Zl(t)?(--this.Hl,this.Ro.lr(function(){return e.Yl(),Promise.resolve()})):this.yo.reject(t)},Ml.prototype.Zl=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Ii(e)},Ml),Nl=(Object.defineProperty(jl.prototype,"d_",{get:function(){return!0},enumerable:!1,configurable:!0}),jl.prototype.subscribe=function(t){this.i_=t},jl.prototype.listen=function(s){return y(this,void 0,void 0,function(){var e,n,r,i,o;return v(this,function(t){switch(t.label){case 0:return this.w_("listen()"),(r=this.r_.get(s))?(e=r.targetId,this.n_.ll(e),n=r.view.zl(),[3,4]):[3,1];case 1:return[4,this.Yu.Gh(s.We())];case 2:return i=t.sent(),o=this.n_.ll(i.targetId),e=i.targetId,[4,this.T_(s,e,"current"===o)];case 3:n=t.sent(),this.d_&&this.e_.listen(i),t.label=4;case 4:return[2,n]}})})},jl.prototype.T_=function(u,a,h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return[4,this.Yu.Hh(u,!0)];case 1:return e=t.sent(),n=new _l(u,e.Yh),r=n.Ol(e.documents),i=Yi.zt(a,h&&"Offline"!==this.onlineState),o=n.Jn(r,this.d_,i),this.E_(a,o.Wl),s=new fl(u,a,n),[2,(this.r_.set(u,s),this.o_.has(a)?this.o_.get(a).push(u):this.o_.set(a,[u]),o.snapshot)]}})})},jl.prototype.Rc=function(i){return y(this,void 0,void 0,function(){var e,n,r=this;return v(this,function(t){switch(t.label){case 0:return this.w_("unlisten()"),e=this.r_.get(i),1<(n=this.o_.get(e.targetId)).length?[2,(this.o_.set(e.targetId,n.filter(function(t){return!su(t,i)})),void this.r_.delete(i))]:this.d_?(this.n_.fl(e.targetId),this.n_.ol(e.targetId)?[3,2]:[4,this.Yu.zh(e.targetId,!1).then(function(){r.n_.wl(e.targetId),r.e_.Rc(e.targetId),r.I_(e.targetId)}).catch(rc)]):[3,3];case 1:t.sent(),t.label=2;case 2:return[3,5];case 3:return this.I_(e.targetId),[4,this.Yu.zh(e.targetId,!0)];case 4:t.sent(),t.label=5;case 5:return[2]}})})},jl.prototype.write=function(i,o){return y(this,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:this.w_("write()"),t.label=1;case 1:return t.trys.push([1,5,,6]),[4,this.Yu.Mh(i)];case 2:return e=t.sent(),this.n_.hl(e.batchId),this.m_(e.batchId,o),[4,this.A_(e.Un)];case 3:return t.sent(),[4,this.e_.Ec()];case 4:return t.sent(),[3,6];case 5:return n=t.sent(),r=qh(n,"Failed to persist write"),o.reject(r),[3,6];case 6:return[2]}})})},jl.prototype.runTransaction=function(t,e,n){new Tl(t,this.Fu,e,n).run()},jl.prototype.qh=function(n){return y(this,void 0,void 0,function(){var e,r=this;return v(this,function(t){switch(t.label){case 0:this.w_("applyRemoteEvent()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Yu.qh(n)];case 2:return e=t.sent(),n.Qt.forEach(function(t,e){var n=r.u_.get(e);n&&(Ar(t.Yt.size+t.Jt.size+t.Xt.size<=1),0<t.Yt.size?n.t_=!0:0<t.Jt.size?Ar(n.t_):0<t.Xt.size&&(Ar(n.t_),n.t_=!1))}),[4,this.A_(e,n)];case 3:return t.sent(),[3,6];case 4:return[4,rc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},jl.prototype.jl=function(r,t){this.w_("applyOnlineStateChange()");var i=[];this.r_.forEach(function(t,e){var n=e.view.jl(r);n.snapshot&&i.push(n.snapshot)}),this.i_.R_(r),this.i_.mu(i),this.onlineState=r},jl.prototype.vc=function(u,a){return y(this,void 0,void 0,function(){var e,n,r,i,o,s=this;return v(this,function(t){switch(t.label){case 0:return this.w_("rejectListens()"),this.n_.Tl(u,"rejected",a),e=this.u_.get(u),(n=e&&e.key)?(r=(r=new _i(Jr.P)).nt(n,new Zs(n,Wr.min())),i=ji().add(n),o=new Wi(Wr.min(),new Map,new Pi(Pr),r,i),[4,this.qh(o)]):[3,2];case 1:return t.sent(),this.a_=this.a_.remove(n),this.u_.delete(u),this.P_(),[3,4];case 2:return[4,this.Yu.zh(u,!1).then(function(){return s.I_(u,a)}).catch(rc)];case 3:t.sent(),t.label=4;case 4:return[2]}})})},jl.prototype.$c=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:this.w_("applySuccessfulWrite()"),e=r.batch.batchId,t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Yu.Oh(r)];case 2:return n=t.sent(),this.V_(e,null),this.g_(e),this.n_.ul(e,"acknowledged"),[4,this.A_(n)];case 3:return t.sent(),[3,6];case 4:return[4,rc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},jl.prototype.xc=function(n,r){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:this.w_("rejectFailedWrite()"),t.label=1;case 1:return t.trys.push([1,4,,6]),[4,this.Yu.Bh(n)];case 2:return e=t.sent(),this.V_(n,r),this.g_(n),this.n_.ul(n,"rejected",r),[4,this.A_(e)];case 3:return t.sent(),[3,6];case 4:return[4,rc(t.sent())];case 5:return t.sent(),[3,6];case 6:return[2]}})})},jl.prototype.y_=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){switch(t.label){case 0:this.e_.sc()||Er("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this.Yu.no()];case 2:return-1===(e=t.sent())?[2,void o.resolve()]:((n=this.__.get(e)||[]).push(o),this.__.set(e,n),[3,4]);case 3:return r=t.sent(),i=qh(r,"Initialization of waitForPendingWrites() operation failed"),o.reject(i),[3,4];case 4:return[2]}})})},jl.prototype.g_=function(t){(this.__.get(t)||[]).forEach(function(t){t.resolve()}),this.__.delete(t)},jl.prototype.p_=function(e){this.__.forEach(function(t){t.forEach(function(t){t.reject(new zr(Gr.CANCELLED,e))})}),this.__.clear()},jl.prototype.m_=function(t,e){var n=(n=(n=this.l_[this.currentUser.Ma()])||new _i(Pr)).nt(t,e);this.l_[this.currentUser.Ma()]=n},jl.prototype.V_=function(t,e){var n,r=this.l_[this.currentUser.Ma()];r&&((n=r.get(t))&&(e?n.reject(e):n.resolve(),r=r.remove(t)),this.l_[this.currentUser.Ma()]=r)},jl.prototype.I_=function(t,e){var n=this;void 0===e&&(e=null),this.n_.fl(t);for(var r=0,i=this.o_.get(t);r<i.length;r++){var o=i[r];this.r_.delete(o),e&&this.i_.b_(o,e)}this.o_.delete(t),this.d_&&this.c_.aa(t).forEach(function(t){n.c_.Mi(t)||n.v_(t)})},jl.prototype.v_=function(t){var e=this.a_.get(t);null!==e&&(this.e_.Rc(e),this.a_=this.a_.remove(t),this.u_.delete(e),this.P_())},jl.prototype.E_=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof hl?(this.c_.Fi(i.key,t),this.S_(i)):i instanceof cl?(Er("SyncEngine","Document no longer in limbo: "+i.key),this.c_.$i(i.key,t),this.c_.Mi(i.key)||this.v_(i.key)):Nr()}},jl.prototype.S_=function(t){var e=t.key;this.a_.get(e)||(Er("SyncEngine","New document in limbo: "+e),this.h_.push(e),this.P_())},jl.prototype.P_=function(){for(;0<this.h_.length&&this.a_.size<this.s_;){var t=this.h_.shift(),e=this.f_.next();this.u_.set(e,new ll(t)),this.a_=this.a_.nt(t,e),this.e_.listen(new wi(eu.hn(t.path).We(),e,2,Gu.ps))}},jl.prototype.D_=function(){return this.a_},jl.prototype.C_=function(){return this.h_},jl.prototype.A_=function(r,a){return y(this,void 0,void 0,function(){var o,s,e,u=this;return v(this,function(t){switch(t.label){case 0:return o=[],s=[],e=[],this.r_.forEach(function(t,i){e.push(Promise.resolve().then(function(){var n=i.view.Ol(r);return n.ql?u.Yu.Hh(i.query,!1).then(function(t){var e=t.documents;return i.view.Ol(e,n)}):n}).then(function(t){var e,n=a&&a.Qt.get(i.targetId),r=i.view.Jn(t,u.d_,n);u.E_(i.targetId,r.Wl),r.snapshot&&(u.d_&&u.n_.Tl(i.targetId,r.snapshot.fromCache?"not-current":"current"),o.push(r.snapshot),e=Bu.Rs(i.targetId,r.snapshot),s.push(e))}))}),[4,Promise.all(e)];case 1:return t.sent(),this.i_.mu(o),[4,this.Yu.Wh(s)];case 2:return t.sent(),[2]}})})},jl.prototype.w_=function(t){},jl.prototype.Oc=function(n){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.currentUser.isEqual(n)?[3,3]:(Er("SyncEngine","User change. New user:",n.Ma()),[4,this.Yu.Nh(n)]);case 1:return e=t.sent(),this.currentUser=n,this.p_("'waitForPendingWrites' promise is rejected due to a user change."),this.n_.Nh(n,e.kh,e.xh),[4,this.A_(e.$h)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},jl.prototype.enableNetwork=function(){return this.e_.enableNetwork()},jl.prototype.disableNetwork=function(){return this.e_.disableNetwork()},jl.prototype.xe=function(t){var e=this.u_.get(t);if(e&&e.t_)return ji().add(e.key);var n=ji(),r=this.o_.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++)var s=o[i],u=this.r_.get(s),n=n.Ct(u.view.Ml);return n},jl),Al=(n(Ul,dl=Nl),Object.defineProperty(Ul.prototype,"d_",{get:function(){return!0===this.F_},enumerable:!1,configurable:!0}),Ul.prototype.enableNetwork=function(){return this.Yu.cr(!0),dl.prototype.enableNetwork.call(this)},Ul.prototype.disableNetwork=function(){return this.Yu.cr(!1),dl.prototype.disableNetwork.call(this)},Ul.prototype.N_=function(r){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return[4,this.Yu.Hh(r.query,!0)];case 1:return e=t.sent(),n=r.view.Gl(e),[2,(this.F_&&this.E_(r.targetId,n.Wl),n)]}})})},Ul.prototype.jl=function(t,e){this.d_&&0===e&&(dl.prototype.jl.call(this,t,e),this.n_.Il(t)),this.d_||1!==e||dl.prototype.jl.call(this,t,e)},Ul.prototype.bl=function(n,r,i){return y(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return this.w_("applyBatchState()"),[4,this.Yu.Xh(n)];case 1:return null===(e=t.sent())?[3,6]:"pending"!==r?[3,3]:[4,this.e_.Ec()];case 2:return t.sent(),[3,4];case 3:"acknowledged"===r||"rejected"===r?(this.V_(n,i||null),this.Yu.Zh(n)):Nr(),t.label=4;case 4:return[4,this.A_(e)];case 5:return t.sent(),[3,7];case 6:Er("SyncEngine","Cannot apply mutation batch with id: "+n),t.label=7;case 7:return[2]}})})},Ul.prototype.Lc=function(h){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a=this;return v(this,function(t){switch(t.label){case 0:return!0!==h||!0===this.F_?[3,3]:(e=this.n_.il(),[4,this.k_(e.F(),!0)]);case 1:return n=t.sent(),this.F_=!0,[4,this.e_.Lc(!0)];case 2:for(t.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.e_.listen(o);return[3,7];case 3:return!1!==h||!1===this.F_?[3,7]:(s=[],u=Promise.resolve(),this.o_.forEach(function(t,e){a.n_.dl(e)?s.push(e):u=u.then(function(){return a.I_(e),a.Yu.zh(e,!0)}),a.e_.Rc(e)}),[4,u]);case 4:return t.sent(),[4,this.k_(s,!1)];case 5:return t.sent(),this.x_(),this.F_=!1,[4,this.e_.Lc(!1)];case 6:t.sent(),t.label=7;case 7:return[2]}})})},Ul.prototype.x_=function(){var n=this;this.u_.forEach(function(t,e){n.e_.Rc(e)}),this.c_.ua(),this.u_=new Map,this.a_=new _i(Jr.P)},Ul.prototype.k_=function(d,t){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f,l,p;return v(this,function(t){switch(t.label){case 0:e=[],n=[],r=0,i=d,t.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(u=this.o_.get(o))&&0!==u.length?[4,this.Yu.Gh(u[0].We())]:[3,7]):[3,13];case 2:s=t.sent(),a=0,h=u,t.label=3;case 3:return a<h.length?(c=h[a],f=this.r_.get(c),[4,this.N_(f)]):[3,6];case 4:(l=t.sent()).snapshot&&n.push(l.snapshot),t.label=5;case 5:return a++,[3,3];case 6:return[3,11];case 7:return[4,this.Yu.ta(o)];case 8:return p=t.sent(),[4,this.Yu.Gh(p)];case 9:return s=t.sent(),[4,this.T_(this.M_(p),o,!1)];case 10:t.sent(),t.label=11;case 11:e.push(s),t.label=12;case 12:return r++,[3,1];case 13:return[2,(this.i_.mu(n),e)]}})})},Ul.prototype.M_=function(t){return new eu(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},Ul.prototype.Dr=function(){return this.Yu.Dr()},Ul.prototype.vl=function(r,i,o){return y(this,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return this.F_?(Er("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!this.o_.has(r))return[3,8];switch(i){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,this.Yu.si()];case 3:return e=t.sent(),n=Wi.Gt(r,"current"===i),[4,this.A_(e,n)];case 4:return t.sent(),[3,8];case 5:return[4,this.Yu.zh(r,!0)];case 6:return t.sent(),this.I_(r,o),[3,8];case 7:Nr(),t.label=8;case 8:return[2]}})})},Ul.prototype.Sl=function(l,p){return y(this,void 0,void 0,function(){var e,n,r,i,o,s,u,a,h,c,f=this;return v(this,function(t){switch(t.label){case 0:if(!this.F_)return[3,10];e=0,n=l,t.label=1;case 1:return e<n.length?(r=n[e],this.o_.has(r)?(Er("SyncEngine","Adding an already active target "+r),[3,5]):[4,this.Yu.ta(r)]):[3,6];case 2:return i=t.sent(),[4,this.Yu.Gh(i)];case 3:return o=t.sent(),[4,this.T_(this.M_(i),o.targetId,!1)];case 4:t.sent(),this.e_.listen(o),t.label=5;case 5:return e++,[3,1];case 6:s=function(e){return v(this,function(t){switch(t.label){case 0:return u.o_.has(e)?[4,u.Yu.zh(e,!1).then(function(){f.e_.Rc(e),f.I_(e)}).catch(rc)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})},u=this,a=0,h=p,t.label=7;case 7:return a<h.length?(c=h[a],[5,s(c)]):[3,10];case 8:t.sent(),t.label=9;case 9:return a++,[3,7];case 10:return[2]}})})},Ul),xl=(Vl.prototype.listen=function(u){return y(this,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:if(e=u.query,n=!1,(r=this.L_.get(e))||(n=!0,r=new pl),!n)return[3,4];t.label=1;case 1:return t.trys.push([1,3,,4]),i=r,[4,this.Vc.listen(e)];case 2:return i.O_=t.sent(),[3,4];case 3:return o=t.sent(),s=qh(o,"Initialization of query '"+au(u.query)+"' failed"),[2,void u.onError(s)];case 4:return this.L_.set(e,r),r.listeners.push(u),u.jl(this.onlineState),r.O_&&u.q_(r.O_)&&this.U_(),[2]}})})},Vl.prototype.Rc=function(o){return y(this,void 0,void 0,function(){var e,n,r,i;return v(this,function(t){return e=o.query,n=!1,(r=this.L_.get(e))&&0<=(i=r.listeners.indexOf(o))&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?[2,(this.L_.delete(e),this.Vc.Rc(e))]:[2]})})},Vl.prototype.mu=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.L_.get(o);if(s){for(var u=0,a=s.listeners;u<a.length;u++)a[u].q_(i)&&(e=!0);s.O_=i}}e&&this.U_()},Vl.prototype.b_=function(t,e){var n=this.L_.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++)i[r].onError(e);this.L_.delete(t)},Vl.prototype.R_=function(i){this.onlineState=i;var o=!1;this.L_.forEach(function(t,e){for(var n=0,r=e.listeners;n<r.length;n++)r[n].jl(i)&&(o=!0)}),o&&this.U_()},Vl.prototype.Q_=function(t){this.B_.add(t),t.next()},Vl.prototype.W_=function(t){this.B_.delete(t)},Vl.prototype.U_=function(){this.B_.forEach(function(t){t.next()})},Vl),Sl=(Cl.prototype.q_=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Hi(t.query,t.docs,t.Ot,e,t.Lt,t.fromCache,t.Bt,!0)}var o=!1;return this.K_?this.z_(t)&&(this.j_.next(t),o=!0):this.H_(t,this.onlineState)&&(this.Y_(t),o=!0),this.G_=t,o},Cl.prototype.onError=function(t){this.j_.error(t)},Cl.prototype.jl=function(t){this.onlineState=t;var e=!1;return this.G_&&!this.K_&&this.H_(this.G_,t)&&(this.Y_(this.G_),e=!0),e},Cl.prototype.H_=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.J_&&n||t.docs._()&&"Offline"!==e)},Cl.prototype.z_=function(t){if(0<t.docChanges.length)return!0;var e=this.G_&&this.G_.hasPendingWrites!==t.hasPendingWrites;return!(!t.Bt&&!e)&&!0===this.options.includeMetadataChanges},Cl.prototype.Y_=function(t){t=Hi.Ut(t.query,t.docs,t.Lt,t.fromCache),this.K_=!0,this.j_.next(t)},Cl),Dl=(Ll.prototype.Fh=function(t){this.X_=t},Ll.prototype._s=function(e,r,i,o){var s=this;return r.En()||i.isEqual(Wr.min())?this.Z_(e,r):this.X_.us(e,o).next(function(t){var n=s.tf(r,t);return(r.In()||r.mn())&&s.ql(r.nn,n,o,i)?s.Z_(e,r):(Ir()<=p.DEBUG&&Er("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),au(r)),s.X_._s(e,r,i).next(function(e){return n.forEach(function(t){e=e.nt(t.key,t)}),e}))})},Ll.prototype.tf=function(n,t){var r=new Pi(cu(n));return t.forEach(function(t,e){e instanceof $s&&hu(n,e)&&(r=r.add(e))}),r},Ll.prototype.ql=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.o(r))},Ll.prototype.Z_=function(t,e){return Ir()<=p.DEBUG&&Er("IndexFreeQueryEngine","Using full collection scan to execute query:",au(e)),this.X_._s(t,e,Wr.min())},Ll),Pl=(kl.prototype.Jr=function(t){return Uu.resolve(0===this.ns.length)},kl.prototype.Xr=function(t,e,n,r){var i=this.ef;this.ef++,0<this.ns.length&&this.ns[this.ns.length-1];var o=new Cu(i,e,n,r);this.ns.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.nf=this.nf.add(new oc(a.key,i)),this.ss.Us(t,a.key.path.p())}return Uu.resolve(o)},kl.prototype.Zr=function(t,e){return Uu.resolve(this.sf(e))},kl.prototype.eo=function(t,e){var n=e+1,r=this.if(n),i=r<0?0:r;return Uu.resolve(this.ns.length>i?this.ns[i]:null)},kl.prototype.no=function(){return Uu.resolve(0===this.ns.length?-1:this.ef-1)},kl.prototype.so=function(t){return Uu.resolve(this.ns.slice())},kl.prototype.os=function(t,e){var n=this,r=new oc(e,0),i=new oc(e,Number.POSITIVE_INFINITY),o=[];return this.nf.vt([r,i],function(t){var e=n.sf(t.la);o.push(e)}),Uu.resolve(o)},kl.prototype.ls=function(t,e){var r=this,i=new Pi(Pr);return e.forEach(function(t){var e=new oc(t,0),n=new oc(t,Number.POSITIVE_INFINITY);r.nf.vt([e,n],function(t){i=i.add(t.la)})}),Uu.resolve(this.rf(i))},kl.prototype.Es=function(t,e){var n=e.path,r=n.length+1,i=n;Jr.W(i)||(i=i.child(""));var o=new oc(new Jr(i),0),s=new Pi(Pr);return this.nf.St(function(t){var e=t.key.path;return!!n.D(e)&&(e.length===r&&(s=s.add(t.la)),!0)},o),Uu.resolve(this.rf(s))},kl.prototype.rf=function(t){var n=this,r=[];return t.forEach(function(t){var e=n.sf(t);null!==e&&r.push(e)}),r},kl.prototype.ro=function(n,r){var i=this;Ar(0===this.hf(r.batchId,"removed")),this.ns.shift();var o=this.nf;return Uu.forEach(r.mutations,function(t){var e=new oc(t.key,r.batchId);return o=o.delete(e),i.wi.Qr(n,t.key)}).next(function(){i.nf=o})},kl.prototype.oo=function(t){},kl.prototype.Mi=function(t,e){var n=new oc(e,0),r=this.nf.Dt(n);return Uu.resolve(e.isEqual(r&&r.key))},kl.prototype.ho=function(t){return this.ns.length,Uu.resolve()},kl.prototype.hf=function(t,e){return this.if(t)},kl.prototype.if=function(t){return 0===this.ns.length?0:t-this.ns[0].batchId},kl.prototype.sf=function(t){var e=this.if(t);return e<0||e>=this.ns.length?null:this.ns[e]},kl),Rl=(Ol.prototype.jn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.af(e);return this.docs=this.docs.nt(r,{Ys:e,size:s,readTime:n}),this.size+=s-o,this.ss.Us(t,r.path.p())},Ol.prototype.Gn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},Ol.prototype.zn=function(t,e){var n=this.docs.get(e);return Uu.resolve(n?n.Ys:null)},Ol.prototype.getEntries=function(t,e){var n=this,r=Oi;return e.forEach(function(t){var e=n.docs.get(t);r=r.nt(t,e?e.Ys:null)}),Uu.resolve(r)},Ol.prototype._s=function(t,e,n){for(var r=Ci,i=new Jr(e.path.child("")),o=this.docs.ut(i);o.wt();){var s=o.dt(),u=s.key,a=s.value,h=a.Ys,c=a.readTime;if(!e.path.D(u.path))break;c.o(n)<=0||h instanceof $s&&hu(e,h)&&(r=r.nt(h.key,h))}return Uu.resolve(r)},Ol.prototype.uf=function(t,e){return Uu.forEach(this.docs,function(t){return e(t)})},Ol.prototype.oi=function(t){return new Ol.hi(this)},Ol.prototype.ui=function(t){return Uu.resolve(this.size)},Ol);function Ol(t,e){this.ss=t,this.af=e,this.docs=new _i(Jr.P),this.size=0}function kl(t,e){this.ss=t,this.wi=e,this.ns=[],this.ef=1,this.nf=new Pi(oc.na)}function Ll(){}function Cl(t,e,n){this.query=t,this.j_=e,this.K_=!1,this.G_=null,this.onlineState="Unknown",this.options=n||{}}function Vl(t){this.Vc=t,this.L_=new Br(uu,su),this.onlineState="Unknown",this.B_=new Set,this.Vc.subscribe(this)}function Ul(t,e,n,r,i,o){var s=this;return(s=dl.call(this,t,e,n,r,i,o)||this).Yu=t,s.F_=void 0,s}function jl(t,e,n,r,i,o){this.Yu=t,this.e_=e,this.Fu=n,this.n_=r,this.currentUser=i,this.s_=o,this.i_=null,this.r_=new Br(uu,su),this.o_=new Map,this.h_=[],this.a_=new _i(Jr.P),this.u_=new Map,this.c_=new ic,this.l_={},this.__=new Map,this.f_=Pa.di(),this.onlineState="Unknown"}function Ml(t,e,n,r){this.Ro=t,this.Fu=e,this.updateFunction=n,this.yo=r,this.Hl=5,this.xo=new Zu(this.Ro,"transaction_retry")}function Fl(t,e){this.query=t,this.Fl=e,this.Nl=null,this.Ht=!1,this.$l=ji(),this.Lt=ji(),this.kl=cu(t),this.xl=new Gi(this.kl)}function ql(){this.Dl=new bl,this.Cl={},this.Vc=null,this.qu=null,this.Ps=null}function Bl(t,e,n,r,i){this.window=t,this.bs=e,this.persistenceKey=n,this.Wc=r,this.Vc=null,this.qu=null,this.Ps=null,this.jc=this.Kc.bind(this),this.Gc=new _i(Pr),this.hr=!1,this.zc=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Hc=sl(this.persistenceKey,this.Wc),this.Yc="firestore_sequence_number_"+this.persistenceKey,this.Gc=this.Gc.nt(this.Wc,new bl),this.Jc=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Xc=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Zc=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.tl="firestore_online_state_"+this.persistenceKey,this.window.addEventListener("storage",this.jc)}function Gl(){this.activeTargetIds=Mi}function zl(t,e){this.clientId=t,this.onlineState=e}function Hl(t,e){this.clientId=t,this.activeTargetIds=e}function Wl(t,e,n){this.targetId=t,this.state=e,this.error=n}function Yl(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Xl(t){var e=this;return(e=yl.call(this)||this).ci=t,e}Rl.hi=(n(Xl,yl=ju),Xl.prototype.Jn=function(n){var r=this,i=[];return this.Un.forEach(function(t,e){e?i.push(r.ci.jn(n,e,r.readTime)):r.ci.Gn(t)}),Uu.Bn(i)},Xl.prototype.Hn=function(t,e){return this.ci.zn(t,e)},Xl.prototype.Yn=function(t,e){return this.ci.getEntries(t,e)},Xl);var Kl,Ql,Jl=(_p.prototype.pe=function(t,n){return this.cf.forEach(function(t,e){return n(e)}),Uu.resolve()},_p.prototype.mi=function(t){return Uu.resolve(this.lastRemoteSnapshotVersion)},_p.prototype.Ai=function(t){return Uu.resolve(this.lf)},_p.prototype.Ti=function(t){return this.highestTargetId=this.ff.next(),Uu.resolve(this.highestTargetId)},_p.prototype.Ri=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.lf&&(this.lf=e),Uu.resolve()},_p.prototype.Vi=function(t){this.cf.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ff=new Pa(e),this.highestTargetId=e),t.sequenceNumber>this.lf&&(this.lf=t.sequenceNumber)},_p.prototype.Pi=function(t,e){return this.Vi(e),this.targetCount+=1,Uu.resolve()},_p.prototype.yi=function(t,e){return this.Vi(e),Uu.resolve()},_p.prototype.pi=function(t,e){return this.cf.delete(e.target),this._f.aa(e.targetId),--this.targetCount,Uu.resolve()},_p.prototype.vi=function(n,r,i){var o=this,s=0,u=[];return this.cf.forEach(function(t,e){e.sequenceNumber<=r&&null===i.get(e.targetId)&&(o.cf.delete(t),u.push(o.bi(n,e.targetId)),s++)}),Uu.Bn(u).next(function(){return s})},_p.prototype.Si=function(t){return Uu.resolve(this.targetCount)},_p.prototype.Di=function(t,e){var n=this.cf.get(e)||null;return Uu.resolve(n)},_p.prototype.Ci=function(t,e,n){return this._f.ra(e,n),Uu.resolve()},_p.prototype.Ni=function(e,t,n){this._f.ha(t,n);var r=this.persistence.wi,i=[];return r&&t.forEach(function(t){i.push(r.Qr(e,t))}),Uu.Bn(i)},_p.prototype.bi=function(t,e){return this._f.aa(e),Uu.resolve()},_p.prototype.ki=function(t,e){var n=this._f.ca(e);return Uu.resolve(n)},_p.prototype.Mi=function(t,e){return Uu.resolve(this._f.Mi(e))},_p),$l=(Ep.prototype.start=function(){return Promise.resolve()},Ep.prototype.yr=function(){return this.Qi=!1,Promise.resolve()},Object.defineProperty(Ep.prototype,"hr",{get:function(){return this.Qi},enumerable:!1,configurable:!0}),Ep.prototype.ar=function(){},Ep.prototype.kr=function(){return this.ss},Ep.prototype.Cr=function(t){var e=this.df[t.Ma()];return e||(e=new Pl(this.ss,this.wi),this.df[t.Ma()]=e),e},Ep.prototype.Nr=function(){return this.Xi},Ep.prototype.$r=function(){return this.es},Ep.prototype.runTransaction=function(t,e,n){var r=this;Er("MemoryPersistence","Starting transaction:",t);var i=new Zl(this.Ui.next());return this.wi.Tf(),n(i).next(function(t){return r.wi.Ef(i).next(function(){return t})}).On().then(function(t){return i.ts(),t})},Ep.prototype.If=function(e,n){return Uu.qn(Object.values(this.df).map(function(t){return function(){return t.Mi(e,n)}}))},Ep),Zl=(n(Ip,Ql=Fu),Ip),tp=(bp.Rf=function(t){return new bp(t)},Object.defineProperty(bp.prototype,"Pf",{get:function(){if(this.Af)return this.Af;throw Nr()},enumerable:!1,configurable:!0}),bp.prototype.Fi=function(t,e,n){return this.mf.Fi(n,e),this.Pf.delete(n),Uu.resolve()},bp.prototype.$i=function(t,e,n){return this.mf.$i(n,e),this.Pf.add(n),Uu.resolve()},bp.prototype.Qr=function(t,e){return this.Pf.add(e),Uu.resolve()},bp.prototype.removeTarget=function(t,e){var n=this;this.mf.aa(e.targetId).forEach(function(t){return n.Pf.add(t)});var r=this.persistence.Nr();return r.ki(t,e.targetId).next(function(t){t.forEach(function(t){return n.Pf.add(t)})}).next(function(){return r.pi(t,e)})},bp.prototype.Tf=function(){this.Af=new Set},bp.prototype.Ef=function(t){var n=this,r=this.persistence.$r().oi();return Uu.forEach(this.Pf,function(e){return n.Vf(t,e).next(function(t){t||r.Gn(e)})}).next(function(){return n.Af=null,r.apply(t)})},bp.prototype.Gr=function(t,e){var n=this;return this.Vf(t,e).next(function(t){t?n.Pf.delete(e):n.Pf.add(e)})},bp.prototype.wf=function(t){return 0},bp.prototype.Vf=function(t,e){var n=this;return Uu.qn([function(){return Uu.resolve(n.mf.Mi(e))},function(){return n.persistence.Nr().Mi(t,e)},function(){return n.persistence.If(t,e)}])},bp),ep=(wp.prototype.Eu=function(t){this.pf=t},wp.prototype._u=function(t){this.bf=t},wp.prototype.onMessage=function(t){this.vf=t},wp.prototype.close=function(){this.yf()},wp.prototype.send=function(t){this.gf(t)},wp.prototype.Sf=function(){this.pf()},wp.prototype.Df=function(t){this.bf(t)},wp.prototype.Cf=function(t){this.vf(t)},wp),np={BatchGetDocuments:"batchGet",Commit:"commit"},rp="gl-js/ fire/"+wr,ip=(mp.prototype.Nf=function(t,e){if(e)for(var n in e.Ba)e.Ba.hasOwnProperty(n)&&(t[n]=e.Ba[n]);t["X-Goog-Api-Client"]=rp},mp.prototype.Du=function(a,r,i){var h=this,c=this.$f(a);return new Promise(function(o,s){var u=new vr;u.listenOnce(dr.COMPLETE,function(){try{switch(u.getLastErrorCode()){case pr.NO_ERROR:var t=u.getResponseJson();Er("Connection","XHR received:",JSON.stringify(t)),o(t);break;case pr.TIMEOUT:Er("Connection",'RPC "'+a+'" timed out'),s(new zr(Gr.DEADLINE_EXCEEDED,"Request time out"));break;case pr.HTTP_ERROR:var e,n,r=u.getStatus();Er("Connection",'RPC "'+a+'" failed with status:',r,"response text:",u.getResponseText()),0<r?(e=u.getResponseJson().error)&&e.status&&e.message?(i=e.status.toLowerCase().replace("_","-"),n=0<=Object.values(Gr).indexOf(i)?i:Gr.UNKNOWN,s(new zr(n,e.message))):s(new zr(Gr.UNKNOWN,"Server responded with status "+u.getStatus())):(Er("Connection",'RPC "'+a+'" failed'),s(new zr(Gr.UNAVAILABLE,"Connection failed.")));break;default:Nr()}}finally{Er("Connection",'RPC "'+a+'" completed.')}var i});var t=Object.assign({},r);delete t.database;var e=JSON.stringify(t);Er("Connection","XHR sending: ",c+" "+e);var n={"Content-Type":"text/plain"};h.Nf(n,i),u.send(c,"POST",e,n,15)})},mp.prototype.Cu=function(t,e,n){return this.Du(t,e,n)},mp.prototype.Iu=function(t,e){var n,r,i=[this.Ff,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=lr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.s.projectId+"/databases/"+this.s.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.Nf(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(g())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=g().indexOf("Electron/")||0<=(r=g()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=g().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){h.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})}Er("Connection","Creating WebChannel: "+u+" "+s);var h=o.createWebChannel(u,s),c=!1,f=!1,l=new ep({gf:function(t){f?Er("Connection","Not sending because WebChannel is closed:",t):(c||(Er("Connection","Opening WebChannel transport."),h.open(),c=!0),Er("Connection","WebChannel sending:",t),h.send(t))},yf:function(){return h.close()}});return a(yr.EventType.OPEN,function(){f||Er("Connection","WebChannel transport opened.")}),a(yr.EventType.CLOSE,function(){f||(f=!0,Er("Connection","WebChannel transport closed"),l.Df())}),a(yr.EventType.ERROR,function(t){f||(f=!0,function(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];br.logLevel<=p.WARN&&(e=n.map(Tr),br.warn.apply(br,d(["Firestore ("+wr+"): Connection"],e)))}("Connection","WebChannel transport errored:",t),l.Df(new zr(Gr.UNAVAILABLE,"The operation could not be completed")))}),a(yr.EventType.MESSAGE,function(t){var e,n,r,i,o,s;f||(Ar(!!(n=t.data[0])),(r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error))?(Er("Connection","WebChannel received error:",r),i=r.status,o=function(){var t=gi[i];if(void 0!==t)return Ei(t)}(),s=r.message,void 0===o&&(o=Gr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.Df(new zr(o,s)),h.close()):(Er("Connection","WebChannel received:",n),l.Cf(n)))}),setTimeout(function(){l.Sf()},0),l},mp.prototype.$f=function(t){var e=np[t];return this.Ff+"/v1/projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents:"+e},mp),op=(gp.prototype.nc=function(t){this.Lf.push(t)},gp.prototype.yr=function(){window.removeEventListener("online",this.kf),window.removeEventListener("offline",this.Mf)},gp.prototype.Bf=function(){window.addEventListener("online",this.kf),window.addEventListener("offline",this.Mf)},gp.prototype.xf=function(){Er("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.Lf;t<e.length;t++)(0,e[t])(0)},gp.prototype.Of=function(){Er("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.Lf;t<e.length;t++)(0,e[t])(1)},gp.Hi=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},gp),sp=(vp.prototype.nc=function(t){},vp.prototype.yr=function(){},vp),up="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.",ap=(yp.prototype.initialize=function(n){return y(this,void 0,void 0,function(){var e=this;return v(this,function(t){switch(t.label){case 0:return this.n_=this.qf(n),this.persistence=this.Uf(n),[4,this.persistence.start()];case 1:return t.sent(),this.Qf=this.Wf(n),this.Yu=this.jf(n),this.e_=this.Kf(n),this.Vc=this.Gf(n),this.zf=this.Hf(n),this.n_.qu=function(t){return e.Vc.jl(t,1)},this.e_.Vc=this.Vc,[4,this.Yu.start()];case 2:return t.sent(),[4,this.n_.start()];case 3:return t.sent(),[4,this.e_.start()];case 4:return t.sent(),[4,this.e_.Lc(this.Vc.d_)];case 5:return t.sent(),[2]}})})},yp.prototype.Hf=function(t){return new xl(this.Vc)},yp.prototype.Wf=function(t){return null},yp.prototype.jf=function(t){return e=this.persistence,n=new Dl,r=t.Yf,new Qh(e,n,r);var e,n,r},yp.prototype.Uf=function(t){if(t.Xf.Jf)throw new zr(Gr.FAILED_PRECONDITION,up);return new $l(tp.Rf)},yp.prototype.Kf=function(t){var e=this;return new Xf(this.Yu,t.Fu,t.Ro,function(t){return e.Vc.jl(t,0)},new(op.Hi()?op:sp))},yp.prototype.qf=function(t){return new El},yp.prototype.Gf=function(t){return e=this.Yu,n=this.e_,r=t.Fu,i=this.n_,o=t.Yf,s=t.s_,new Nl(e,n,r,i,o,s);var e,n,r,i,o,s},yp.prototype.clearPersistence=function(t){throw new zr(Gr.FAILED_PRECONDITION,up)},yp),hp=(n(dp,Kl=ap),dp.prototype.initialize=function(e){return y(this,void 0,void 0,function(){var n=this;return v(this,function(t){switch(t.label){case 0:return[4,Kl.prototype.initialize.call(this,e)];case 1:return t.sent(),[4,this.persistence.or(function(e){return y(n,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.Vc.Lc(e)];case 1:return t.sent(),this.Qf&&(e&&!this.Qf.hr?this.Qf.start(this.Yu):e||this.Qf.stop()),[2]}})})})];case 2:return t.sent(),[2]}})})},dp.prototype.jf=function(t){return e=this.persistence,n=new Dl,r=t.Yf,new ec(e,n,r);var e,n,r},dp.prototype.Gf=function(t){var e,n,r,i,o,s,u=(e=this.Yu,n=this.e_,r=t.Fu,i=this.n_,o=t.Yf,s=t.s_,new Al(e,n,r,i,o,s));return this.n_ instanceof Il&&(this.n_.Vc=u),u},dp.prototype.Wf=function(t){var e=this.persistence.wi.Or;return new Xh(e,t.Ro)},dp.prototype.Uf=function(t){var e=Fa.Mr(t.Zf),n=af(t.Zf.s);return new Fa(t.Xf.synchronizeTabs,e,t.clientId,Hh.ah(t.Xf.cacheSizeBytes),t.Ro,Vh(),"undefined"!=typeof document?document:null,n,this.n_,t.Xf.qi)},dp.prototype.qf=function(t){if(t.Xf.Jf&&t.Xf.synchronizeTabs){var e=Vh();if(!Il.Hi(e))throw new zr(Gr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Fa.Mr(t.Zf);return new Il(e,t.Ro,n,t.clientId,t.Yf)}return new El},dp.prototype.clearPersistence=function(t){var e=Fa.Mr(t);return Fa.clearPersistence(e)},dp),cp=(pp.prototype.start=function(t,e,n){var r=this;this.Su(),this.Zf=t;var i=new $u,o=new $u,s=!1;return this.credentials.Qa(function(t){if(!s)return s=!0,Er("FirestoreClient","Initializing. user=",t.uid),r.td(e,n,t,o).then(i.resolve,i.reject);r.Ro.dr(function(){return r.e_.Oc(t)})}),this.Ro.lr(function(){return i.promise}),o.promise},pp.prototype.enableNetwork=function(){var t=this;return this.Su(),this.Ro.enqueue(function(){return t.Vc.enableNetwork()})},pp.prototype.td=function(a,h,c,f){return y(this,void 0,void 0,function(){var n,r,i,o,s,u=this;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,(s=this.Zf,Promise.resolve(new ip(s)))];case 1:return n=t.sent(),r=af(this.Zf.s),e=this.credentials,i=new Hf(n,e,r),[4,a.initialize({Ro:this.Ro,Zf:this.Zf,Fu:i,clientId:this.clientId,Yf:c,s_:100,Xf:h})];case 2:return t.sent(),this.persistence=a.persistence,this.n_=a.n_,this.Yu=a.Yu,this.e_=a.e_,this.Vc=a.Vc,this.Qf=a.Qf,this.ed=a.zf,this.persistence.ar(function(){return y(u,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})}),f.resolve(),[3,4];case 3:if(o=t.sent(),f.reject(o),!this.nd(o))throw o;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+o),this.td(new ap,{Jf:!1},c,f))];case 4:return[2]}var e})})},pp.prototype.nd=function(t){return"FirebaseError"===t.name?t.code===Gr.FAILED_PRECONDITION||t.code===Gr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},pp.prototype.Su=function(){if(this.Ro.Oo)throw new zr(Gr.FAILED_PRECONDITION,"The client has already been terminated.")},pp.prototype.disableNetwork=function(){var t=this;return this.Su(),this.Ro.enqueue(function(){return t.Vc.disableNetwork()})},pp.prototype.terminate=function(){var t=this;return this.Ro.Qo(function(){return y(t,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Qf&&this.Qf.stop(),[4,this.e_.yr()];case 1:return t.sent(),[4,this.n_.yr()];case 2:return t.sent(),[4,this.persistence.yr()];case 3:return t.sent(),this.credentials.Wa(),[2]}})})})},pp.prototype.waitForPendingWrites=function(){var t=this;this.Su();var e=new $u;return this.Ro.lr(function(){return t.Vc.y_(e)}),e.promise},pp.prototype.listen=function(t,e,n){var r=this;this.Su();var i=new Sl(t,e,n);return this.Ro.lr(function(){return r.ed.listen(i)}),i},pp.prototype.Rc=function(t){var e=this;this.sd||this.Ro.lr(function(){return e.ed.Rc(t)})},pp.prototype.rd=function(o){return y(this,void 0,void 0,function(){var i,e=this;return v(this,function(t){switch(t.label){case 0:return this.Su(),i=new $u,[4,this.Ro.enqueue(function(){return y(e,void 0,void 0,function(){var e,n,r;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.Yu.Kh(o)];case 1:return(e=t.sent())instanceof $s?i.resolve(e):e instanceof Zs?i.resolve(null):i.reject(new zr(Gr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return n=t.sent(),r=qh(n,"Failed to get document '"+o+" from cache"),i.reject(r),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),i.promise)]}})})},pp.prototype.od=function(a){return y(this,void 0,void 0,function(){var u,e=this;return v(this,function(t){switch(t.label){case 0:return this.Su(),u=new $u,[4,this.Ro.enqueue(function(){return y(e,void 0,void 0,function(){var e,n,r,i,o,s;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.Yu.Hh(a,!0)];case 1:return e=t.sent(),n=new _l(a,e.Yh),r=n.Ol(e.documents),i=n.Jn(r,!1),u.resolve(i.snapshot),[3,3];case 2:return o=t.sent(),s=qh(o,"Failed to execute query '"+a+" against cache"),u.reject(s),[3,3];case 3:return[2]}})})})];case 1:return[2,(t.sent(),u.promise)]}})})},pp.prototype.write=function(t){var e=this;this.Su();var n=new $u;return this.Ro.lr(function(){return e.Vc.write(t,n)}),n.promise},pp.prototype.s=function(){return this.Zf.s},pp.prototype.Q_=function(t){var e=this;this.Su(),this.Ro.lr(function(){return e.ed.Q_(t),Promise.resolve()})},pp.prototype.W_=function(t){var e=this;this.sd||this.Ro.lr(function(){return e.ed.W_(t),Promise.resolve()})},Object.defineProperty(pp.prototype,"sd",{get:function(){return this.Ro.Oo},enumerable:!1,configurable:!0}),pp.prototype.transaction=function(t){var e=this;this.Su();var n=new $u;return this.Ro.lr(function(){return e.Vc.runTransaction(e.Ro,t,n),Promise.resolve()}),n.promise},pp),fp=(lp.prototype.next=function(t){this.hd(this.observer.next,t)},lp.prototype.error=function(t){this.hd(this.observer.error,t)},lp.prototype.ad=function(){this.muted=!0},lp.prototype.hd=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},lp);function lp(t){this.observer=t,this.muted=!1}function pp(t,e){this.credentials=t,this.Ro=e,this.clientId=Sr.t()}function dp(){return null!==Kl&&Kl.apply(this,arguments)||this}function yp(){}function vp(){}function gp(){var t=this;this.kf=function(){return t.xf()},this.Mf=function(){return t.Of()},this.Lf=[],this.Bf()}function mp(t){this.s=t.s;var e=t.ssl?"https":"http";this.Ff=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function wp(t){this.gf=t.gf,this.yf=t.yf}function bp(t){this.persistence=t,this.mf=new ic,this.Af=null}function Ip(t){var e=this;return(e=Ql.call(this)||this).Li=t,e}function Ep(t){var e=this;this.df={},this.Ui=new Gu(0),this.Qi=!1,this.Qi=!0,this.wi=t(this),this.Xi=new Jl(this),this.ss=new oa,this.es=new Rl(this.ss,function(t){return e.wi.wf(t)})}function _p(t){this.persistence=t,this.cf=new Br(fi,li),this.lastRemoteSnapshotVersion=Wr.min(),this.highestTargetId=0,this.lf=0,this._f=new ic,this.targetCount=0,this.ff=Pa.fi()}function Tp(i){return function(){if("object"==typeof i&&null!==i)for(var t=i,e=0,n=["next","error","complete"];e<n.length;e++){var r=n[e];if(r in t&&"function"==typeof t[r])return 1}}()}var Np=(Rp.prototype._d=function(t){switch(ao(t)){case 0:return null;case 1:return t.booleanValue;case 2:return vo(t.integerValue||t.doubleValue);case 3:return this.fd(t.timestampValue);case 4:return this.dd(t);case 5:return t.stringValue;case 6:return new Rc(go(t.bytesValue));case 7:return this.wd(t.referenceValue);case 8:return this.Td(t.geoPointValue);case 9:return this.Ed(t.arrayValue);case 10:return this.Id(t.mapValue);default:throw Nr()}},Rp.prototype.Id=function(t){var n=this,r={};return Ur(t.fields||{},function(t,e){r[t]=n._d(e)}),r},Rp.prototype.Td=function(t){return new Zc(vo(t.latitude),vo(t.longitude))},Rp.prototype.Ed=function(t){var e=this;return(t.values||[]).map(function(t){return e._d(t)})},Rp.prototype.dd=function(t){switch(this.ud){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return oo(n)?t(n):n}(t);return null==e?null:this._d(e);case"estimate":return this.fd(so(t));default:return null}},Rp.prototype.fd=function(t){var e=yo(t),n=new Hr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},Rp.prototype.wd=function(t){var e=Xr.$(t);Ar(Qo(e));var n=new Lr(e.get(1),e.get(3)),r=new Jr(e.g(5));return n.isEqual(this.s)||_r("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.s.projectId+"/"+this.s.database+") instead."),this.ld(r)},Rp),Ap=Hh._h,xp=(Pp.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties},Pp),Sp=(Object.defineProperty(Dp.prototype,"vd",{get:function(){return this.Sd||(this.Sd=new gf(this.ya,this.bd.ignoreUndefinedProperties)),this.Sd},enumerable:!1,configurable:!0}),Dp.prototype.settings=function(t){hc("Firestore.settings",arguments,1),lc("Firestore.settings","object",1,t);var e=new xp(t);if(this.Pd&&!this.bd.isEqual(e))throw new zr(Gr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.bd=e).credentials&&(this.yd=function(t){if(!t)return new jf;switch(t.type){case"gapi":var e=t.Dd;return Ar(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new qf(e,t.Ya||"0");case"provider":return t.Dd;default:throw new zr(Gr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},Dp.prototype.enableNetwork=function(){return this.Rd(),this.Pd.enableNetwork()},Dp.prototype.disableNetwork=function(){return this.Rd(),this.Pd.disableNetwork()},Dp.prototype.enablePersistence=function(t){var e,n;if(this.Pd)throw new zr(Gr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1,i=!1;if(t&&(void 0!==t.experimentalTabSynchronization&&_r("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n,i=!!t.experimentalForceOwningTab&&t.experimentalForceOwningTab,r&&i))throw new zr(Gr.INVALID_ARGUMENT,"The 'experimentalForceOwningTab' setting cannot be used with 'synchronizeTabs'.");return this.Cd(this.pd,{Jf:!0,cacheSizeBytes:this.bd.cacheSizeBytes,synchronizeTabs:r,qi:i})},Dp.prototype.clearPersistence=function(){return y(this,void 0,void 0,function(){var r,e=this;return v(this,function(t){if(void 0!==this.Pd&&!this.Pd.sd)throw new zr(Gr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");return r=new $u,[2,(this.Ad.Lo(function(){return y(e,void 0,void 0,function(){var e,n;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),e=this.Fd(),[4,this.pd.clearPersistence(e)];case 1:return t.sent(),r.resolve(),[3,3];case 2:return n=t.sent(),r.reject(n),[3,3];case 3:return[2]}})})}),r.promise)]})})},Dp.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(Dp.prototype,"Nd",{get:function(){return this.Rd(),this.Pd.sd},enumerable:!1,configurable:!0}),Dp.prototype.waitForPendingWrites=function(){return this.Rd(),this.Pd.waitForPendingWrites()},Dp.prototype.onSnapshotsInSync=function(t){if(this.Rd(),Tp(t))return Op(this.Pd,t);lc("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return Op(this.Pd,e)},Dp.prototype.Rd=function(){return this.Pd||this.Cd(new ap,{Jf:!1}),this.Pd},Dp.prototype.Fd=function(){return new kr(this.ya,this.gd,this.bd.host,this.bd.ssl,this.bd.forceLongPolling)},Dp.prototype.Cd=function(t,e){var n=this.Fd();return this.Pd=new cp(this.yd,this.Ad),this.Pd.start(n,t,e)},Dp.Vd=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new zr(Gr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new zr(Gr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new Lr(n)},Object.defineProperty(Dp.prototype,"app",{get:function(){if(!this.md)throw new zr(Gr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.md},enumerable:!1,configurable:!0}),Dp.prototype.collection=function(t){return hc("Firestore.collection",arguments,1),lc("Firestore.collection","non-empty string",1,t),this.Rd(),new nd(Xr.$(t),this,null)},Dp.prototype.doc=function(t){return hc("Firestore.doc",arguments,1),lc("Firestore.doc","non-empty string",1,t),this.Rd(),Vp.$d(Xr.$(t),this,null)},Dp.prototype.collectionGroup=function(t){if(hc("Firestore.collectionGroup",arguments,1),lc("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new zr(Gr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.Rd(),new Qp(new eu(Xr.k(),t),this,null)},Dp.prototype.runTransaction=function(e){var n=this;return hc("Firestore.runTransaction",arguments,1),lc("Firestore.runTransaction","function",1,e),this.Rd().transaction(function(t){return e(new Lp(n,t))})},Dp.prototype.batch=function(){return this.Rd(),new Cp(this)},Object.defineProperty(Dp,"logLevel",{get:function(){switch(Ir()){case p.DEBUG:return"debug";case p.ERROR:return"error";case p.SILENT:return"silent";case p.WARN:return"warn";case p.INFO:return"info";case p.VERBOSE:return"verbose";default:return"error"}},enumerable:!1,configurable:!0}),Dp.setLogLevel=function(t){hc("Firestore.setLogLevel",arguments,1),gc("setLogLevel",["debug","error","silent","warn","info","verbose"],1,t),br.setLogLevel(t)},Dp.prototype.kd=function(){return this.bd.timestampsInSnapshots},Dp);function Dp(t,e,n){var r=this;if(void 0===n&&(n=new ap),this.md=null,this.Ad=new jh,this.INTERNAL={delete:function(){return y(r,void 0,void 0,function(){return v(this,function(t){switch(t.label){case 0:return this.Rd(),[4,this.Pd.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof t.options){var i=t;this.md=i,this.ya=Dp.Vd(i),this.gd=i.name,this.yd=new Mf(e)}else{var o=t;if(!o.projectId)throw new zr(Gr.INVALID_ARGUMENT,"Must provide projectId");this.ya=new Lr(o.projectId,o.database),this.gd="[DEFAULT]",this.yd=new jf}this.pd=n,this.bd=new xp({})}function Pp(t){var e,n,r,i;if(void 0===t.host){if(void 0!==t.ssl)throw new zr(Gr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else dc("settings","non-empty string","host",t.host),this.host=t.host,yc("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Ec("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling","ignoreUndefinedProperties"]),yc("settings","object","credentials",t.credentials),this.credentials=t.credentials,yc("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),yc("settings","boolean","ignoreUndefinedProperties",t.ignoreUndefinedProperties),!0===t.timestampsInSnapshots?_r("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&_r("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,this.ignoreUndefinedProperties=null!==(r=t.ignoreUndefinedProperties)&&void 0!==r&&r,yc("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Hh.dh;else{if(t.cacheSizeBytes!==Ap&&t.cacheSizeBytes<Hh.fh)throw new zr(Gr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Hh.fh);this.cacheSizeBytes=t.cacheSizeBytes}yc("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=null!==(i=t.experimentalForceLongPolling)&&void 0!==i&&i}function Rp(t,e,n,r){this.s=t,this.timestampsInSnapshots=e,this.ud=n,this.ld=r}function Op(t,e){var n=new fp({next:function(){e.next&&e.next()},error:function(t){throw Nr()}});return t.Q_(n),function(){n.ad(),t.W_(n)}}var kp,Lp=(Mp.prototype.get=function(t){var n=this;hc("Transaction.get",arguments,1);var r=ad("Transaction.get",t,this.xd);return this.Md.Mu([r.pa]).then(function(t){if(!t||1!==t.length)return Nr();var e=t[0];if(e instanceof Zs)return new Gp(n.xd,r.pa,null,!1,!1,r.ba);if(e instanceof $s)return new Gp(n.xd,r.pa,e,!1,!1,r.ba);throw Nr()})},Mp.prototype.set=function(t,e,n){fc("Transaction.set",arguments,2,3);var r=ad("Transaction.set",t,this.xd);n=od("Transaction.set",n);var i=hd(r.ba,e,n),o=bf(this.xd.vd,"Transaction.set",r.pa,i,null!==r.ba,n);return this.Md.set(r.pa,o),this},Mp.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof kc?(cc("Transaction.update",arguments,3),r=ad("Transaction.update",t,this.xd),Ef(this.xd.vd,"Transaction.update",r.pa,e,n,o)):(hc("Transaction.update",arguments,2),r=ad("Transaction.update",t,this.xd),If(this.xd.vd,"Transaction.update",r.pa,e)),this.Md.update(r.pa,i),this},Mp.prototype.delete=function(t){hc("Transaction.delete",arguments,1);var e=ad("Transaction.delete",t,this.xd);return this.Md.delete(e.pa),this},Mp),Cp=(jp.prototype.set=function(t,e,n){fc("WriteBatch.set",arguments,2,3),this.Bd();var r=ad("WriteBatch.set",t,this.xd);n=od("WriteBatch.set",n);var i=hd(r.ba,e,n),o=bf(this.xd.vd,"WriteBatch.set",r.pa,i,null!==r.ba,n);return this.Od=this.Od.concat(o.va(r.pa,ws.Qe())),this},jp.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.Bd(),i="string"==typeof e||e instanceof kc?(cc("WriteBatch.update",arguments,3),r=ad("WriteBatch.update",t,this.xd),Ef(this.xd.vd,"WriteBatch.update",r.pa,e,n,o)):(hc("WriteBatch.update",arguments,2),r=ad("WriteBatch.update",t,this.xd),If(this.xd.vd,"WriteBatch.update",r.pa,e)),this.Od=this.Od.concat(i.va(r.pa,ws.exists(!0))),this},jp.prototype.delete=function(t){hc("WriteBatch.delete",arguments,1),this.Bd();var e=ad("WriteBatch.delete",t,this.xd);return this.Od=this.Od.concat(new Ms(e.pa,ws.Qe())),this},jp.prototype.commit=function(){return this.Bd(),this.Ld=!0,0<this.Od.length?this.xd.Rd().write(this.Od):Promise.resolve()},jp.prototype.Bd=function(){if(this.Ld)throw new zr(Gr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},jp),Vp=(n(Up,kp=cf),Up.$d=function(t,e,n){if(t.length%2!=0)throw new zr(Gr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.N()+" has "+t.length);return new Up(new Jr(t),e,n)},Object.defineProperty(Up.prototype,"id",{get:function(){return this.pa.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(Up.prototype,"parent",{get:function(){return new nd(this.pa.path.p(),this.firestore,this.ba)},enumerable:!1,configurable:!0}),Object.defineProperty(Up.prototype,"path",{get:function(){return this.pa.path.N()},enumerable:!1,configurable:!0}),Up.prototype.collection=function(t){if(hc("DocumentReference.collection",arguments,1),lc("DocumentReference.collection","non-empty string",1,t),!t)throw new zr(Gr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Xr.$(t);return new nd(this.pa.path.child(e),this.firestore,null)},Up.prototype.isEqual=function(t){if(!(t instanceof Up))throw _c("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.pa.isEqual(t.pa)&&this.ba===t.ba},Up.prototype.set=function(t,e){fc("DocumentReference.set",arguments,1,2),e=od("DocumentReference.set",e);var n=hd(this.ba,t,e),r=bf(this.firestore.vd,"DocumentReference.set",this.pa,n,null!==this.ba,e);return this.Pd.write(r.va(this.pa,ws.Qe()))},Up.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof kc?(cc("DocumentReference.update",arguments,2),Ef(this.firestore.vd,"DocumentReference.update",this.pa,t,e,r)):(hc("DocumentReference.update",arguments,1),If(this.firestore.vd,"DocumentReference.update",this.pa,t)),this.Pd.write(n.va(this.pa,ws.exists(!0)))},Up.prototype.delete=function(){return hc("DocumentReference.delete",arguments,0),this.Pd.write([new Ms(this.pa,ws.Qe())])},Up.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];fc("DocumentReference.onSnapshot",arguments,1,4);var s={includeMetadataChanges:!1},u=0;"object"!=typeof i[u]||Tp(i[u])||(Ec("DocumentReference.onSnapshot",s=i[u],["includeMetadataChanges"]),yc("DocumentReference.onSnapshot","boolean","includeMetadataChanges",s.includeMetadataChanges),u++);var a,h={includeMetadataChanges:s.includeMetadataChanges};Tp(i[u])?(a=i[u],i[u]=null===(t=a.next)||void 0===t?void 0:t.bind(a),i[u+1]=null===(e=a.error)||void 0===e?void 0:e.bind(a),i[u+2]=null===(n=a.complete)||void 0===n?void 0:n.bind(a)):(lc("DocumentReference.onSnapshot","function",u,i[u]),pc("DocumentReference.onSnapshot","function",u+1,i[u+1]),pc("DocumentReference.onSnapshot","function",u+2,i[u+2]));var c={next:function(t){i[u]&&i[u](r.qd(t))},error:i[u+1],complete:i[u+2]};return Fp(this.Pd,this.pa,h,c)},Up.prototype.get=function(t){var e,n,r,i,o,s=this;return fc("DocumentReference.get",arguments,0,1),ud("DocumentReference.get",t),t&&"cache"===t.source?this.firestore.Rd().rd(this.pa).then(function(t){return new Gp(s.firestore,s.pa,t,!0,t instanceof $s&&t.Ge,s.ba)}):(e=this.Pd,n=this.pa,r=t,i=new $u,o=Fp(e,n,{includeMetadataChanges:!0,J_:!0},{next:function(t){o();var e=t.docs.has(n);!e&&t.fromCache?i.reject(new zr(Gr.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&r&&"server"===r.source?i.reject(new zr(Gr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(t)},error:function(t){return i.reject(t)}}),i.promise.then(function(t){return s.qd(t)}))},Up.prototype.withConverter=function(t){return new Up(this.pa,this.firestore,t)},Up.prototype.qd=function(t){var e=t.docs.get(this.pa);return new Gp(this.firestore,this.pa,e,t.fromCache,t.hasPendingWrites,this.ba)},Up);function Up(t,e,n){var r=this;return(r=kp.call(this,e.ya,t,n)||this).pa=t,r.firestore=e,r.ba=n,r.Pd=r.firestore.Rd(),r}function jp(t){this.xd=t,this.Od=[],this.Ld=!1}function Mp(t,e){this.xd=t,this.Md=e}function Fp(t,e,n,r){var i=function(t){console.error("Uncaught Error in onSnapshot:",t)};r.error&&(i=r.error.bind(r));var o=new fp({next:function(t){r.next&&r.next(t)},error:i}),s=t.listen(eu.hn(e.path),o,n);return function(){o.ad(),t.Rc(s)}}var qp,Bp=(Yp.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},Yp),Gp=(Wp.prototype.data=function(t){var e=this;if(fc("DocumentSnapshot.data",arguments,0,1),t=sd("DocumentSnapshot.data",t),this.Ud){if(this.ba){var n=new zp(this.xd,this.pa,this.Ud,this.Qd,this.Wd,null);return this.ba.fromFirestore(n,t)}return new Np(this.xd.ya,this.xd.kd(),t.serverTimestamps||"none",function(t){return new Vp(t,e.xd,null)})._d(this.Ud.tn())}},Wp.prototype.get=function(t,e){var n=this;if(fc("DocumentSnapshot.get",arguments,1,2),e=sd("DocumentSnapshot.get",e),this.Ud){var r=this.Ud.data().field(Sf("DocumentSnapshot.get",t,this.pa));if(null!==r)return new Np(this.xd.ya,this.xd.kd(),e.serverTimestamps||"none",function(t){return new Vp(t,n.xd,n.ba)})._d(r)}},Object.defineProperty(Wp.prototype,"id",{get:function(){return this.pa.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(Wp.prototype,"ref",{get:function(){return new Vp(this.pa,this.xd,this.ba)},enumerable:!1,configurable:!0}),Object.defineProperty(Wp.prototype,"exists",{get:function(){return null!==this.Ud},enumerable:!1,configurable:!0}),Object.defineProperty(Wp.prototype,"metadata",{get:function(){return new Bp(this.Wd,this.Qd)},enumerable:!1,configurable:!0}),Wp.prototype.isEqual=function(t){if(!(t instanceof Wp))throw _c("isEqual","DocumentSnapshot",1,t);return this.xd===t.xd&&this.Qd===t.Qd&&this.pa.isEqual(t.pa)&&(null===this.Ud?null===t.Ud:this.Ud.isEqual(t.Ud))&&this.ba===t.ba},Wp),zp=(n(Hp,qp=Gp),Hp.prototype.data=function(t){return qp.prototype.data.call(this,t)},Hp);function Hp(){return null!==qp&&qp.apply(this,arguments)||this}function Wp(t,e,n,r,i,o){this.xd=t,this.pa=e,this.Ud=n,this.Qd=r,this.Wd=i,this.ba=o}function Yp(t,e){this.hasPendingWrites=t,this.fromCache=e}function Xp(t){if(t.mn()&&0===t.en.length)throw new zr(Gr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Kp,Qp=($p.prototype.Kd=function(t,e,n){var r;if(t.O()){if("array-contains"===e||"array-contains-any"===e)throw new zr(Gr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+e+"' queries on FieldPath.documentId().");if("in"===e){this.Gd(n,e);for(var i=[],o=0,s=n;o<s.length;o++){var u=s[o];i.push(this.zd(u))}r={arrayValue:{values:i}}}else r=this.zd(n)}else"in"!==e&&"array-contains-any"!==e||this.Gd(n,e),r=_f(this.vd,"Query.where",n,"in"===e);var a=lu.create(t,e,r);return this.Hd(a),a},$p.prototype.Yd=function(t,e){if(null!==this.jd.startAt)throw new zr(Gr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.jd.endAt)throw new zr(Gr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var n=new ku(t,e);return this.Jd(n),n},$p.prototype.Xd=function(t,e,n){if(!e)throw new zr(Gr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");for(var r=[],i=0,o=this.jd.orderBy;i<o.length;i++){var s=o[i];if(s.field.O())r.push(mo(this.ya,e.key));else{var u=e.field(s.field);if(oo(u))throw new zr(Gr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===u){var a=s.field.N();throw new zr(Gr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+a+"' (used as the orderBy) does not exist.")}r.push(u)}}return new Tu(r,n)},$p.prototype.Zd=function(t,e,n){var r=this.jd.en;if(e.length>r.length)throw new zr(Gr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.O()){if("string"!=typeof s)throw new zr(Gr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.jd.Vn()&&-1!==s.indexOf("/"))throw new zr(Gr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var u=this.jd.path.child(Xr.$(s));if(!Jr.W(u))throw new zr(Gr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+u+"' is not because it contains an odd number of segments.");var a=new Jr(u);i.push(mo(this.ya,a))}else{var h=_f(this.vd,t,s);i.push(h)}}return new Tu(i,n)},$p.prototype.zd=function(t){if("string"==typeof t){if(""===t)throw new zr(Gr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.jd.Vn()&&-1!==t.indexOf("/"))throw new zr(Gr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.jd.path.child(Xr.$(t));if(!Jr.W(e))throw new zr(Gr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return mo(this.ya,new Jr(e))}if(t instanceof cf)return mo(this.ya,t.pa);throw new zr(Gr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+bc(t)+".")},$p.prototype.Gd=function(t,e){if(!Array.isArray(t)||0===t.length)throw new zr(Gr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new zr(Gr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new zr(Gr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter(function(t){return Number.isNaN(t)}).length)throw new zr(Gr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},$p.prototype.Hd=function(t){if(t instanceof lu){var e=["array-contains","array-contains-any"],n=["in","array-contains-any"],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.An()){var o=this.jd.an();if(null!==o&&!o.isEqual(t.field))throw new zr(Gr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.jd.un();null!==s&&this.tw(t.field,s)}else if(i||r){var u=null;if(i&&(u=this.jd.Rn(n)),null===u&&r&&(u=this.jd.Rn(e)),null!==u)throw u===t.op?new zr(Gr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new zr(Gr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+u.toString()+"' filters.")}}},$p.prototype.Jd=function(t){var e;null!==this.jd.un()||null!==(e=this.jd.an())&&this.tw(e,t.field)},$p.prototype.tw=function(t,e){if(!e.isEqual(t))throw new zr(Gr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},n(Jp,Kp=$p),Jp.prototype.where=function(t,e,n){hc("Query.where",arguments,3),Ic("Query.where",3,n);var r=gc("Query.where",["<","<=","==",">=",">","array-contains","in","array-contains-any"],2,e),i=Sf("Query.where",t),o=this.Kd(i,r,n);return new Jp(this.jd.cn(o),this.firestore,this.ba)},Jp.prototype.orderBy=function(t,e){var n;if(fc("Query.orderBy",arguments,1,2),pc("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new zr(Gr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}var r=Sf("Query.orderBy",t),i=this.Yd(r,n);return new Jp(this.jd.ln(i),this.firestore,this.ba)},Jp.prototype.limit=function(t){return hc("Query.limit",arguments,1),lc("Query.limit","number",1,t),Tc("Query.limit",1,t),new Jp(this.jd._n(t),this.firestore,this.ba)},Jp.prototype.limitToLast=function(t){return hc("Query.limitToLast",arguments,1),lc("Query.limitToLast","number",1,t),Tc("Query.limitToLast",1,t),new Jp(this.jd.fn(t),this.firestore,this.ba)},Jp.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];cc("Query.startAt",arguments,1);var r=this.ew("Query.startAt",t,e,!0);return new Jp(this.jd.dn(r),this.firestore,this.ba)},Jp.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];cc("Query.startAfter",arguments,1);var r=this.ew("Query.startAfter",t,e,!1);return new Jp(this.jd.dn(r),this.firestore,this.ba)},Jp.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];cc("Query.endBefore",arguments,1);var r=this.ew("Query.endBefore",t,e,!0);return new Jp(this.jd.wn(r),this.firestore,this.ba)},Jp.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];cc("Query.endAt",arguments,1);var r=this.ew("Query.endAt",t,e,!1);return new Jp(this.jd.wn(r),this.firestore,this.ba)},Jp.prototype.isEqual=function(t){if(!(t instanceof Jp))throw _c("isEqual","Query",1,t);return this.firestore===t.firestore&&su(this.jd,t.jd)&&this.ba===t.ba},Jp.prototype.withConverter=function(t){return new Jp(this.jd,this.firestore,t)},Jp.prototype.ew=function(t,e,n,r){if(Ic(t,1,e),e instanceof Gp)return hc(t,d([e],n),1),this.Xd(t,e.Ud,r);var i=[e].concat(n);return this.Zd(t,i,r)},Jp.prototype.onSnapshot=function(){for(var t,e,n,r=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];fc("Query.onSnapshot",arguments,1,4);var s,u={},a=0;"object"!=typeof i[a]||Tp(i[a])||(Ec("Query.onSnapshot",u=i[a],["includeMetadataChanges"]),yc("Query.onSnapshot","boolean","includeMetadataChanges",u.includeMetadataChanges),a++),Tp(i[a])?(s=i[a],i[a]=null===(t=s.next)||void 0===t?void 0:t.bind(s),i[a+1]=null===(e=s.error)||void 0===e?void 0:e.bind(s),i[a+2]=null===(n=s.complete)||void 0===n?void 0:n.bind(s)):(lc("Query.onSnapshot","function",a,i[a]),pc("Query.onSnapshot","function",a+1,i[a+1]),pc("Query.onSnapshot","function",a+2,i[a+2]));var h={next:function(t){i[a]&&i[a](new ed(r.firestore,r.jd,t,r.ba))},error:i[a+1],complete:i[a+2]};return Xp(this.jd),Zp(this.firestore.Rd(),this.jd,u,h)},Jp.prototype.get=function(t){var e=this;fc("Query.get",arguments,0,1),ud("Query.get",t),Xp(this.jd);var n,r,i,o,s,u=this.firestore.Rd();return(t&&"cache"===t.source?u.od(this.jd):(n=u,r=this.jd,i=t,o=new $u,s=Zp(n,r,{includeMetadataChanges:!0,J_:!0},{next:function(t){s(),t.fromCache&&i&&"server"===i.source?o.reject(new zr(Gr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):o.resolve(t)},error:function(t){return o.reject(t)}}),o.promise)).then(function(t){return new ed(e.firestore,e.jd,t,e.ba)})},Jp);function Jp(t,e,n){var r=this;return(r=Kp.call(this,e.ya,e.vd,t)||this).jd=t,r.firestore=e,r.ba=n,r}function $p(t,e,n){this.ya=t,this.vd=e,this.jd=n}function Zp(t,e,n,r){var i=function(t){console.error("Uncaught Error in onSnapshot:",t)};r.error&&(i=r.error.bind(r));var o=new fp({next:function(t){r.next&&r.next(t)},error:i}),s=t.listen(e,o,n);return function(){o.ad(),t.Rc(s)}}var td,ed=(Object.defineProperty(id.prototype,"docs",{get:function(){var e=[];return this.forEach(function(t){return e.push(t)}),e},enumerable:!1,configurable:!0}),Object.defineProperty(id.prototype,"empty",{get:function(){return this.sw.docs._()},enumerable:!1,configurable:!0}),Object.defineProperty(id.prototype,"size",{get:function(){return this.sw.docs.size},enumerable:!1,configurable:!0}),id.prototype.forEach=function(e,n){var r=this;fc("QuerySnapshot.forEach",arguments,1,2),lc("QuerySnapshot.forEach","function",1,e),this.sw.docs.forEach(function(t){e.call(n,r.ow(t,r.metadata.fromCache,r.sw.Lt.has(t.key)))})},Object.defineProperty(id.prototype,"query",{get:function(){return new Qp(this.nw,this.xd,this.ba)},enumerable:!1,configurable:!0}),id.prototype.docChanges=function(t){t&&(Ec("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),yc("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.sw.qt)throw new zr(Gr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.iw&&this.rw===e||(this.iw=function(i,e,o){if(i.Ot._()){var n=0;return i.docChanges.map(function(t){var e=o(t.doc,i.fromCache,i.Lt.has(t.doc.key));return t.doc,{type:"added",doc:e,oldIndex:-1,newIndex:n++}})}var s=i.Ot;return i.docChanges.filter(function(t){return e||3!==t.type}).map(function(t){var e=o(t.doc,i.fromCache,i.Lt.has(t.doc.key)),n=-1,r=-1;return 0!==t.type&&(n=s.indexOf(t.doc.key),s=s.delete(t.doc.key)),1!==t.type&&(r=(s=s.add(t.doc)).indexOf(t.doc.key)),{type:function(){switch(t.type){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Nr()}}(),doc:e,oldIndex:n,newIndex:r}})}(this.sw,e,this.ow.bind(this)),this.rw=e),this.iw},id.prototype.isEqual=function(t){if(!(t instanceof id))throw _c("isEqual","QuerySnapshot",1,t);return this.xd===t.xd&&su(this.nw,t.nw)&&this.sw.isEqual(t.sw)&&this.ba===t.ba},id.prototype.ow=function(t,e,n){return new zp(this.xd,t.key,t,e,n,this.ba)},id),nd=(n(rd,td=Qp),Object.defineProperty(rd.prototype,"id",{get:function(){return this.jd.path.S()},enumerable:!1,configurable:!0}),Object.defineProperty(rd.prototype,"parent",{get:function(){var t=this.jd.path.p();return t._()?null:new Vp(new Jr(t),this.firestore,null)},enumerable:!1,configurable:!0}),Object.defineProperty(rd.prototype,"path",{get:function(){return this.jd.path.N()},enumerable:!1,configurable:!0}),rd.prototype.doc=function(t){fc("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=Sr.t()),lc("CollectionReference.doc","non-empty string",1,t);var e=Xr.$(t);return Vp.$d(this.jd.path.child(e),this.firestore,this.ba)},rd.prototype.add=function(t){hc("CollectionReference.add",arguments,1),lc("CollectionReference.add","object",1,this.ba?this.ba.toFirestore(t):t);var e=this.doc();return e.set(t).then(function(){return e})},rd.prototype.withConverter=function(t){return new rd(this.hw,this.firestore,t)},rd);function rd(t,e,n){var r=this;if(((r=td.call(this,eu.hn(t),e,n)||this).hw=t).length%2!=1)throw new zr(Gr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.N()+" has "+t.length);return r}function id(t,e,n,r){this.xd=t,this.nw=e,this.sw=n,this.ba=r,this.iw=null,this.rw=null,this.metadata=new Bp(n.hasPendingWrites,n.fromCache)}function od(t,e){if(void 0===e)return{merge:!1};if(Ec(t,e,["merge","mergeFields"]),yc(t,"boolean","merge",e.merge),void 0!==(n=e.mergeFields)&&function(t,e,n){if(!(n instanceof Array))throw new zr(Gr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+bc(n));for(var r,i=0;i<n.length;++i)if(!("string"==typeof(r=n[i])||r instanceof kc))throw new zr(Gr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+bc(n[i]))}(t,"mergeFields",n),void 0!==e.mergeFields&&void 0!==e.merge)throw new zr(Gr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n;return e}function sd(t,e){return void 0===e?{}:(Ec(t,e,["serverTimestamps"]),vc(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function ud(t,e){pc(t,"object",1,e),e&&(Ec(t,e,["source"]),vc(t,0,"source",e.source,["default","server","cache"]))}function ad(t,e,n){if(e instanceof cf){if(e.firestore!==n)throw new zr(Gr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw _c(t,"DocumentReference",1,e)}function hd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var cd,fd={Firestore:Sp,GeoPoint:Zc,Timestamp:Hr,Blob:Rc,Transaction:Lp,WriteBatch:Cp,DocumentReference:Vp,DocumentSnapshot:Gp,Query:Qp,QueryDocumentSnapshot:zp,QuerySnapshot:ed,CollectionReference:nd,FieldPath:kc,FieldValue:Jc,setLogLevel:Sp.setLogLevel,CACHE_SIZE_UNLIMITED:Ap};(cd=ld).INTERNAL.registerComponent(new gr("firestore",function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),new Sp(e,n,new hp);var e,n},"PUBLIC").setServiceProps(Object.assign({},fd))),cd.registerVersion("@firebase/firestore","1.16.0")}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});