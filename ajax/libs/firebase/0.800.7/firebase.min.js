!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.app={}))}(this,function(t){"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,n)},n=function(){return(n=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)};function r(t,e,n,r){return new(n=n||Promise)(function(s,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?s(t.value):((e=t.value)instanceof n?e:new n(function(t){t(e)})).then(o,a)}u((r=r.apply(t,e||[])).next())})}function s(t,e){var n,r,s,i={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]},o={next:a(0),throw:a(1),return:a(2)};return"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(s=2&o[0]?r.return:o[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,o[1])).done)return s;switch(r=0,s&&(o=[2&o[0],s.value]),o[0]){case 0:case 1:s=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(s=0<(s=i.trys).length&&s[s.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!s||o[1]>s[0]&&o[1]<s[3])){i.label=o[1];break}if(6===o[0]&&i.label<s[1]){i.label=s[1],s=o;break}if(s&&i.label<s[2]){i.label=s[2],i.ops.push(o);break}s[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],r=0}finally{n=s=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function i(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,s,i=n.call(t),o=[];try{for(;(void 0===e||0<e--)&&!(r=i.next()).done;)o.push(r.value)}catch(t){s={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return o}var a=(u.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(n):t(n,r))}},u);function u(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}var c,h,l,f="FirebaseError",d=(c=Error,e(h=g,l=c),h.prototype=null===l?Object.create(l):(p.prototype=l.prototype,new p),g);function p(){this.constructor=h}function g(t,e){var n=c.call(this,e)||this;return n.code=t,n.name=f,Object.setPrototypeOf(n,g.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,m.prototype.create),n}var m=(y.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,s=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?(r=s,o.replace(w,function(t,e){var n=r[e];return null!=n?String(n):"<"+e+"?>"})):"Error",u=this.serviceName+": "+a+" ("+i+").",c=new d(i,u),h=0,l=Object.keys(s);h<l.length;h++){var f=l[h];"_"!==f.slice(-1)&&(f in c&&console.warn('Overwriting FirebaseError base field "'+f+'" can cause unexpected behavior.'),c[f]=s[f])}return c},y);function y(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var w=/\{\$([^}]+)}/g,v=(b.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},b.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},b.prototype.setServiceProps=function(t){return this.serviceProps=t,this},b);function b(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}var E="[DEFAULT]",I=(_.prototype.get=function(t){void 0===t&&(t=E);var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new a;this.instancesDeferred.set(e,n);try{var r=this.getOrInitializeService(e);r&&n.resolve(r)}catch(t){}}return this.instancesDeferred.get(e).promise},_.prototype.getImmediate=function(t){var e=n({identifier:E,optional:!1},t),r=e.identifier,s=e.optional,i=this.normalizeInstanceIdentifier(r);try{var o=this.getOrInitializeService(i);if(o)return o;if(s)return null;throw Error("Service "+this.name+" is not available")}catch(t){if(s)return null;throw t}},_.prototype.getComponent=function(){return this.component},_.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if("EAGER"===(this.component=t).instantiationMode)try{this.getOrInitializeService(E)}catch(t){}try{for(var r=i(this.instancesDeferred.entries()),s=r.next();!s.done;s=r.next()){var a=o(s.value,2),u=a[0],c=a[1],h=this.normalizeInstanceIdentifier(u);try{var l=this.getOrInitializeService(h);c.resolve(l)}catch(t){}}}catch(t){e={error:t}}finally{try{s&&!s.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},_.prototype.clearInstance=function(t){void 0===t&&(t=E),this.instancesDeferred.delete(t),this.instances.delete(t)},_.prototype.delete=function(){return r(this,void 0,void 0,function(){var t;return s(this,function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(o(arguments[e]));return t}(t.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}),t.filter(function(t){return"_delete"in t}).map(function(t){return t._delete()})))];case 1:return e.sent(),[2]}})})},_.prototype.isComponentSet=function(){return null!=this.component},_.prototype.getOrInitializeService=function(t){var e,n=this.instances.get(t);return!n&&this.component&&(n=this.component.instanceFactory(this.container,(e=t)===E?void 0:e),this.instances.set(t,n)),n||null},_.prototype.normalizeInstanceIdentifier=function(t){return!this.component||this.component.multipleInstances?t:E},_);function _(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}var T,N=(A.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},A.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},A.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new I(t,this);return this.providers.set(t,e),e},A.prototype.getProviders=function(){return Array.from(this.providers.values())},A);function A(t){this.name=t,this.providers=new Map}function S(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),s=0;for(e=0;e<n;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,s++)r[s]=i[o];return r}var x,D,O=[];function C(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var s=(new Date).toISOString(),i=L[e];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[i].apply(console,S(["["+s+"]  "+t.name+":"],n))}}(D=x=x||{})[D.DEBUG=0]="DEBUG",D[D.VERBOSE=1]="VERBOSE",D[D.INFO=2]="INFO",D[D.WARN=3]="WARN",D[D.ERROR=4]="ERROR",D[D.SILENT=5]="SILENT";var k={debug:x.DEBUG,verbose:x.VERBOSE,info:x.INFO,warn:x.WARN,error:x.ERROR,silent:x.SILENT},R=x.INFO,L=((T={})[x.DEBUG]="log",T[x.VERBOSE]="log",T[x.INFO]="info",T[x.WARN]="warn",T[x.ERROR]="error",T),P=(Object.defineProperty(V.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in x))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),V.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?k[t]:t},Object.defineProperty(V.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(V.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),V.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,S([this,x.DEBUG],t)),this._logHandler.apply(this,S([this,x.DEBUG],t))},V.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,S([this,x.VERBOSE],t)),this._logHandler.apply(this,S([this,x.VERBOSE],t))},V.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,S([this,x.INFO],t)),this._logHandler.apply(this,S([this,x.INFO],t))},V.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,S([this,x.WARN],t)),this._logHandler.apply(this,S([this,x.WARN],t))},V.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,S([this,x.ERROR],t)),this._logHandler.apply(this,S([this,x.ERROR],t))},V);function V(t){this.name=t,this._logLevel=R,this._logHandler=C,this._userLogHandler=null,O.push(this)}var U=(M.prototype.getPlatformInfoString=function(){return this.container.getProviders().map(function(t){if("VERSION"!==(null==(e=t.getComponent())?void 0:e.type))return null;var e,n=t.getImmediate();return n.library+"/"+n.version}).filter(function(t){return t}).join(" ")},M);function M(t){this.container=t}var q,F,j="@firebase/app",G=new P("@firebase/app"),$="[DEFAULT]",B=((q={})[j]="fire-core",q["@firebase/app-compat"]="fire-core-compat",q["@firebase/analytics"]="fire-analytics",q["@firebase/auth"]="fire-auth",q["@firebase/database"]="fire-rtdb",q["@firebase/functions"]="fire-fn",q["@firebase/installations"]="fire-iid",q["@firebase/messaging"]="fire-fcm",q["@firebase/performance"]="fire-perf",q["@firebase/remote-config"]="fire-rc",q["@firebase/storage"]="fire-gcs",q["@firebase/firestore"]="fire-fst",q["fire-js"]="fire-js",q.firebase="fire-js-all",q),z=new Map,H=new Map;function K(t,e){try{t.container.addComponent(e)}catch(n){G.debug("Component "+e.name+" failed to register with FirebaseApp "+t.name,n)}}function W(t){var e,n,r=t.name;if(H.has(r))return G.debug("There were multiple attempts to register component "+r+"."),!1;H.set(r,t);try{for(var s=i(z.values()),o=s.next();!o.done;o=s.next())K(o.value,t)}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return!0}function X(t,e){return t.container.getProvider(e)}var Q=((F={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",F["bad-app-name"]="Illegal App name: '{$appName}",F["duplicate-app"]="Firebase App named '{$appName}' already exists",F["app-deleted"]="Firebase App named '{$appName}' already deleted",F["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",F["invalid-log-argument"]="First argument to `onLog` must be null or a function.",F),J=new m("app","Firebase",Q),Y=(Object.defineProperty(Z.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"name",{get:function(){return this.checkDestroyed(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(Z.prototype,"options",{get:function(){return this.checkDestroyed(),this.options_},enumerable:!1,configurable:!0}),Z.prototype.checkDestroyed=function(){if(this.isDeleted)throw J.create("app-deleted",{appName:this.name_})},Z);function Z(t,e,r){var s=this;this.isDeleted=!1,this.options_=n({},t),this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled,this.container=r,this.container.addComponent(new v("app-exp",function(){return s},"PUBLIC"))}function tt(t,e,n){var r,s=null!==(r=B[t])&&void 0!==r?r:t;n&&(s+="-"+n);var i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){var a=['Unable to register library "'+s+'" with version "'+e+'":'];return i&&a.push('library name "'+s+'" contains illegal characters (whitespace or "/")'),i&&o&&a.push("and"),o&&a.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void G.warn(a.join(" "))}W(new v(s+"-version",function(){return{library:s,version:e}},"VERSION"))}W(new v("platform-logger",function(t){return new U(t)},"PRIVATE")),tt(j,"0.0.800-exp.aca9933ee",void 0),tt("fire-js",""),tt("firebase","0.800.7","app"),t.SDK_VERSION="7.19.1",t._DEFAULT_ENTRY_NAME=$,t._addComponent=K,t._addOrOverwriteComponent=function(t,e){t.container.addOrOverwriteComponent(e)},t._apps=z,t._clearComponents=function(){H.clear()},t._components=H,t._getProvider=X,t._registerComponent=W,t._removeServiceInstance=function(t,e,n){void 0===n&&(n=$),X(t,e).clearInstance(n)},t.deleteApp=function(t){return r(this,void 0,void 0,function(){var e;return s(this,function(n){switch(n.label){case 0:return e=t.name,z.has(e)?(z.delete(e),[4,Promise.all(t.container.getProviders().map(function(t){return t.delete()}))]):[3,2];case 1:n.sent(),t.isDeleted=!0,n.label=2;case 2:return[2]}})})},t.getApp=function(t){void 0===t&&(t=$);var e=z.get(t);if(!e)throw J.create("no-app",{appName:t});return e},t.getApps=function(){return Array.from(z.values())},t.initializeApp=function(t,e){var r,s;void 0===e&&(e={}),"object"!=typeof e&&(e={name:e});var o=n({name:$,automaticDataCollectionEnabled:!1},e),a=o.name;if("string"!=typeof a||!a)throw J.create("bad-app-name",{appName:String(a)});if(z.has(a))throw J.create("duplicate-app",{appName:a});var u=new N(a);try{for(var c=i(H.values()),h=c.next();!h.done;h=c.next()){var l=h.value;u.addComponent(l)}}catch(t){r={error:t}}finally{try{h&&!h.done&&(s=c.return)&&s.call(c)}finally{if(r)throw r.error}}var f=new Y(t,o,u);return z.set(a,f),f},t.onLog=function(t,e){if(null!==t&&"function"!=typeof t)throw J.create("invalid-log-argument",{appName:name});!function(t,e){for(var n=0,r=O;n<r.length;n++)!function(n){var r=null;e&&e.level&&(r=k[e.level]),n.userLogHandler=null===t?null:function(e,n){for(var s=[],i=2;i<arguments.length;i++)s[i-2]=arguments[i];var o=s.map(function(t){if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}}).filter(function(t){return t}).join(" ");n>=(null!=r?r:e.logLevel)&&t({level:x[n].toLowerCase(),message:o,args:s,type:e.name})}}(r[n])}(t,e)},t.registerVersion=tt,t.setLogLevel=function(t){var e;e=t,O.forEach(function(t){t.setLogLevel(e)})},Object.defineProperty(t,"__esModule",{value:!0})}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.functions=t.firebase.functions||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function r(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}function s(t,e,n,r){return new(n||(n=Promise))(function(s,i){function o(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(o,a)}u((r=r.apply(t,e||[])).next())})}function i(t,e){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=(s=o.trys).length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var o="FirebaseError",a=function(t){function e(n,r){var s=t.call(this,r)||this;return s.code=n,s.name=o,Object.setPrototypeOf(s,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(s,u.prototype.create),s}return r(e,t),e}(Error),u=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},s=this.service+"/"+t,i=this.errors[t],o=i?function(t,e){return t.replace(c,function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"})}(i,r):"Error",u=this.serviceName+": "+o+" ("+s+").",h=new a(s,u),l=0,f=Object.keys(r);l<f.length;l++){var d=f[l];"_"!==d.slice(-1)&&(d in h&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),h[d]=r[d])}return h},t}();var c=/\{\$([^}]+)}/g,h=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}(),l="type.googleapis.com/google.protobuf.Int64Value",f="type.googleapis.com/google.protobuf.UInt64Value";function d(t,e){var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e(t[r]));return n}function p(t){if(null==t)return t;if(t["@type"])switch(t["@type"]){case l:case f:var e=Number(t.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+t);return e;default:throw new Error("Data cannot be decoded from JSON: "+t)}return Array.isArray(t)?t.map(function(t){return p(t)}):"function"==typeof t||"object"==typeof t?d(t,function(t){return p(t)}):t}var g="functions",m={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},y=function(t){function e(e,n,r){var s=t.call(this,g+"/"+e,n||"")||this;return s.details=r,s}return r(e,t),e}(a);var w=function(){function t(t,e){var n=this;this.auth=null,this.messaging=null,this.auth=t.getImmediate({optional:!0}),this.messaging=e.getImmediate({optional:!0}),this.auth||t.get().then(function(t){return n.auth=t},function(){}),this.messaging||e.get().then(function(t){return n.messaging=t},function(){})}return t.prototype.getAuthToken=function(){return s(this,void 0,void 0,function(){var t;return i(this,function(e){switch(e.label){case 0:if(!this.auth)return[2,void 0];e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.auth.getToken()];case 2:return[2,null==(t=e.sent())?void 0:t.accessToken];case 3:return e.sent(),[2,void 0];case 4:return[2]}})})},t.prototype.getMessagingToken=function(){return s(this,void 0,void 0,function(){return i(this,function(t){if(!(this.messaging&&"Notification"in self&&"granted"===Notification.permission))return[2,void 0];try{return[2,this.messaging.getToken()]}catch(t){return[2,void 0]}return[2]})})},t.prototype.getContext=function(){return s(this,void 0,void 0,function(){var t,e;return i(this,function(n){switch(n.label){case 0:return[4,this.getAuthToken()];case 1:return t=n.sent(),[4,this.getMessagingToken()];case 2:return e=n.sent(),[2,{authToken:t,messagingToken:e}]}})})},t}(),v="us-central1";var b=function(){function t(t,e,n,r){var s=this;void 0===r&&(r=v),this.app=t,this.region=r,this.emulatorOrigin=null,this.contextProvider=new w(e,n),this.cancelAllRequests=new Promise(function(t){s.deleteService=function(){return Promise.resolve(t())}})}return t.prototype._delete=function(){return this.deleteService()},t.prototype._url=function(t){var e=this.app.options.projectId,n=this.region;return null!==this.emulatorOrigin?this.emulatorOrigin+"/"+e+"/"+n+"/"+t:"https://"+n+"-"+e+".cloudfunctions.net/"+t},t}();function E(t,e,n){return function(r){return function(t,e,n,r){return s(this,void 0,void 0,function(){var o,a,u,c,h,l,f,g;return i(this,function(w){switch(w.label){case 0:return o=t._url(e),n=function t(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"==typeof e&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(Array.isArray(e))return e.map(function(e){return t(e)});if("function"==typeof e||"object"==typeof e)return d(e,function(e){return t(e)});throw new Error("Data cannot be encoded in JSON: "+e)}(n),a={data:n},u=new Headers,[4,t.contextProvider.getContext()];case 1:return(c=w.sent()).authToken&&u.append("Authorization","Bearer "+c.authToken),c.messagingToken&&u.append("Firebase-Instance-ID-Token",c.messagingToken),h=r.timeout||7e4,[4,Promise.race([function(t,e,n){return s(this,void 0,void 0,function(){var r,s;return i(this,function(i){switch(i.label){case 0:n.append("Content-Type","application/json"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,fetch(t,{method:"POST",body:JSON.stringify(e),headers:n})];case 2:return r=i.sent(),[3,4];case 3:return i.sent(),[2,{status:0,json:null}];case 4:s=null,i.label=5;case 5:return i.trys.push([5,7,,8]),[4,r.json()];case 6:return s=i.sent(),[3,8];case 7:return i.sent(),[3,8];case 8:return[2,{status:r.status,json:s}]}})})}(o,a,u),(v=h,new Promise(function(t,e){setTimeout(function(){e(new y("deadline-exceeded","deadline-exceeded"))},v)})),t.cancelAllRequests])];case 2:if(!(l=w.sent()))throw new y("cancelled","Firebase Functions instance was deleted.");if(f=function(t,e){var n=function(t){if(t>=200&&t<300)return"ok";switch(t){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(t),r=n,s=void 0;try{var i=e&&e.error;if(i){var o=i.status;if("string"==typeof o){if(!m[o])return new y("internal","internal");n=m[o],r=o}var a=i.message;"string"==typeof a&&(r=a),void 0!==(s=i.details)&&(s=p(s))}}catch(t){}return"ok"===n?null:new y(n,r,s)}(l.status,l.json))throw f;if(!l.json)throw new y("internal","Response is not valid JSON object.");if(void 0===(g=l.json.data)&&(g=l.json.result),void 0===g)throw new y("internal","Response is missing data field.");return[2,{data:p(g)}]}var v})})}(t,e,r,n||{})}}var I=function(t,e){var n=t.getProvider("app-exp").getImmediate(),r=t.getProvider("auth-internal"),s=t.getProvider("messaging");return new b(n,r,s,e)};var _;_={Functions:b},e._registerComponent(new h(g,I,"PUBLIC").setServiceProps(_).setMultipleInstances(!0)),e.registerVersion("@firebase/functions-exp","0.0.800"),t.getFunctions=function(t,n){return void 0===n&&(n=v),e._getProvider(t,g).getImmediate({identifier:n})},t.httpsCallable=function(t,e,n){return E(t,e,n)},t.useFunctionsEmulator=function(t,e){!function(t,e){t.emulatorOrigin=e}(t,e)},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-functions.js - be sure to load firebase-app.js first.")}}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.firestore=t.firebase.firestore||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function r(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var s="FirebaseError",i=function(t){function e(n,r){var i=t.call(this,r)||this;return i.code=n,i.name=s,Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,o.prototype.create),i}return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e}(Error),o=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},s=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(c,function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"})}(o,r):"Error",u=this.serviceName+": "+a+" ("+s+").",h=new i(s,u),l=0,f=Object.keys(r);l<f.length;l++){var d=f[l];"_"!==d.slice(-1)&&(d in h&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),h[d]=r[d])}return h},t}();var a,u,c=/\{\$([^}]+)}/g,h=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}();function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),s=0;for(e=0;e<n;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,s++)r[s]=i[o];return r}!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(u||(u={}));var f={debug:u.DEBUG,verbose:u.VERBOSE,info:u.INFO,warn:u.WARN,error:u.ERROR,silent:u.SILENT},d=u.INFO,p=((a={})[u.DEBUG]="log",a[u.VERBOSE]="log",a[u.INFO]="info",a[u.WARN]="warn",a[u.ERROR]="error",a),g=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var s=(new Date).toISOString(),i=p[e];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[i].apply(console,l(["["+s+"]  "+t.name+":"],n))}},m=function(){function t(t){this.name=t,this._logLevel=d,this._logHandler=g,this._userLogHandler=null}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in u))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?f[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,u.DEBUG],t)),this._logHandler.apply(this,l([this,u.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,u.VERBOSE],t)),this._logHandler.apply(this,l([this,u.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,u.INFO],t)),this._logHandler.apply(this,l([this,u.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,u.WARN],t)),this._logHandler.apply(this,l([this,u.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,u.ERROR],t)),this._logHandler.apply(this,l([this,u.ERROR],t))},t}(),y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function w(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var v,b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},E=E||{},I=b||self;function _(){}function T(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function N(t){var e=T(t);return"array"==e||"object"==e&&"number"==typeof t.length}function A(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var S="closure_uid_"+(1e9*Math.random()>>>0),x=0;function D(t,e,n){return t.call.apply(t.bind,arguments)}function O(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function C(t,e,n){return(C=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?D:O).apply(null,arguments)}function k(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var R=Date.now;function L(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,t.prototype.constructor=t}function P(){this.j=this.j,this.i=this.i}P.prototype.j=!1,P.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(t){Object.prototype.hasOwnProperty.call(t,S)&&t[S]||(t[S]=++x)})(this)},P.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var V=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},U=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,s="string"==typeof t?t.split(""):t,i=0;i<r;i++)i in s&&e.call(n,s[i],i,t)};function M(t){return Array.prototype.concat.apply([],arguments)}function q(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function F(t){return/^[\s\xa0]*$/.test(t)}var j,G=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function $(t,e){return-1!=t.indexOf(e)}function B(t,e){return t<e?-1:t>e?1:0}t:{var z=I.navigator;if(z){var H=z.userAgent;if(H){j=H;break t}}j=""}function K(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function W(t){var e={};for(var n in t)e[n]=t[n];return e}var X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Q(t,e){for(var n,r,s=1;s<arguments.length;s++){for(n in r=arguments[s])t[n]=r[n];for(var i=0;i<X.length;i++)n=X[i],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function J(t){return J[" "](t),t}J[" "]=_;var Y,Z,tt=$(j,"Opera"),et=$(j,"Trident")||$(j,"MSIE"),nt=$(j,"Edge"),rt=nt||et,st=$(j,"Gecko")&&!($(j.toLowerCase(),"webkit")&&!$(j,"Edge"))&&!($(j,"Trident")||$(j,"MSIE"))&&!$(j,"Edge"),it=$(j.toLowerCase(),"webkit")&&!$(j,"Edge");function ot(){var t=I.document;return t?t.documentMode:void 0}t:{var at="",ut=(Z=j,st?/rv:([^\);]+)(\)|;)/.exec(Z):nt?/Edge\/([\d\.]+)/.exec(Z):et?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Z):it?/WebKit\/(\S+)/.exec(Z):tt?/(?:Version)[ \/]?(\S+)/.exec(Z):void 0);if(ut&&(at=ut?ut[1]:""),et){var ct=ot();if(null!=ct&&ct>parseFloat(at)){Y=String(ct);break t}}Y=at}var ht,lt={};function ft(t){return function(t,e){var n=lt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=G(String(Y)).split("."),r=G(String(t)).split("."),s=Math.max(n.length,r.length),i=0;0==e&&i<s;i++){var o=n[i]||"",a=r[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;e=B(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||B(0==o[2].length,0==a[2].length)||B(o[2],a[2]),o=o[3],a=a[3]}while(0==e)}return 0<=e})}if(I.document&&et){var dt=ot();ht=dt||(parseInt(Y,10)||void 0)}else ht=void 0;var pt=ht,gt=!et||9<=Number(pt),mt=et&&!ft("9"),yt=function(){if(!I.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{I.addEventListener("test",_,e),I.removeEventListener("test",_,e)}catch(t){}return t}();function wt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function vt(t,e){if(wt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(st){t:{try{J(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:bt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}wt.prototype.b=function(){this.defaultPrevented=!0},L(vt,wt);var bt={2:"touch",3:"pen",4:"mouse"};vt.prototype.b=function(){vt.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,mt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var Et="closure_listenable_"+(1e6*Math.random()|0),It=0;function _t(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Tt(t){this.src=t,this.a={},this.b=0}function Nt(t,e){var n=e.type;if(n in t.a){var r,s=t.a[n],i=V(s,e);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(_t(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function At(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.Y&&i.listener==e&&i.capture==!!n&&i.ca==r)return s}return-1}Tt.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.a[i])||(t=this.a[i]=[],this.b++);var o=At(t,e,r,s);return-1<o?(e=t[o],n||(e.Z=!1)):((e=new function(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ca=s,this.key=++It,this.Y=this.Z=!1}(e,this.src,i,!!r,s)).Z=n,t.push(e)),e};var St="closure_lm_"+(1e6*Math.random()|0),xt={};function Dt(t,e,n,r,s){if(r&&r.once)return function t(e,n,r,s,i){if(Array.isArray(n)){for(var o=0;o<n.length;o++)t(e,n[o],r,s,i);return null}r=Ut(r);return e&&e[Et]?e.wa(n,r,A(s)?!!s.capture:!!s,i):Ot(e,n,r,!0,s,i)}(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)Dt(t,e[i],n,r,s);return null}return n=Ut(n),t&&t[Et]?t.va(e,n,A(r)?!!r.capture:!!r,s):Ot(t,e,n,!1,r,s)}function Ot(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o=A(s)?!!s.capture:!!s;if(o&&!gt)return null;var a=Pt(t);if(a||(t[St]=a=new Tt(t)),(n=a.add(e,n,r,o,i)).proxy)return n;if(r=function(){var t=Lt,e=gt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)yt||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(kt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Ct(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[Et])Nt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(kt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Pt(e))?(Nt(n,t),0==n.b&&(n.src=null,e[St]=null)):_t(t)}}}function kt(t){return t in xt?xt[t]:xt[t]="on"+t}function Rt(t,e){var n=t.listener,r=t.ca||t.src;return t.Z&&Ct(t),n.call(r,e)}function Lt(t,e){if(t.Y)return!0;if(!gt){if(!e)t:{e=["window","event"];for(var n=I,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Rt(t,e=new vt(e,this))}return Rt(t,new vt(e,this))}function Pt(t){return(t=t[St])instanceof Tt?t:null}var Vt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ut(t){return"function"==T(t)?t:(t[Vt]||(t[Vt]=function(e){return t.handleEvent(e)}),t[Vt])}function Mt(){P.call(this),this.c=new Tt(this),this.J=this,this.C=null}function qt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.Y&&o.capture==n){var a=o.listener,u=o.ca||o.src;o.Z&&Nt(t.c,o),s=!1!==a.call(u,r)&&s}}return s&&!r.defaultPrevented}L(Mt,P),Mt.prototype[Et]=!0,(v=Mt.prototype).addEventListener=function(t,e,n,r){Dt(this,t,e,n,r)},v.removeEventListener=function(t,e,n,r){!function t(e,n,r,s,i){if(Array.isArray(n))for(var o=0;o<n.length;o++)t(e,n[o],r,s,i);else s=A(s)?!!s.capture:!!s,r=Ut(r),e&&e[Et]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=At(o=e.a[n],r,s,i))&&(_t(o[r]),Array.prototype.splice.call(o,r,1),0==o.length&&(delete e.a[n],e.b--))):e&&(e=Pt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=At(n,r,s,i)),(r=-1<e?n[e]:null)&&Ct(r))}(this,t,e,n,r)},v.dispatchEvent=function(t){var e,n=this.C;if(n)for(e=[];n;n=n.C)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t)t=new wt(t,n);else if(t instanceof wt)t.target=t.target||n;else{var s=t;Q(t=new wt(r,n),s)}if(s=!0,e)for(var i=e.length-1;0<=i;i--){var o=t.a=e[i];s=qt(o,r,!0,t)&&s}if(s=qt(o=t.a=n,r,!0,t)&&s,s=qt(o,r,!1,t)&&s,e)for(i=0;i<e.length;i++)s=qt(o=t.a=e[i],r,!1,t)&&s;return s},v.G=function(){if(Mt.S.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)_t(n[r]);delete e.a[t],e.b--}}this.C=null},v.va=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},v.wa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Ft=I.JSON.stringify;function jt(){this.b=this.a=null}var Gt,$t=new(function(){function t(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())(function(){return new zt},function(t){t.reset()},100);function Bt(){var t=Xt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function zt(){this.next=this.b=this.a=null}function Ht(t){I.setTimeout(function(){throw t},0)}function Kt(t,e){Gt||function(){var t=I.Promise.resolve(void 0);Gt=function(){t.then(Qt)}}(),Wt||(Gt(),Wt=!0),Xt.add(t,e)}jt.prototype.add=function(t,e){var n=$t.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},zt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},zt.prototype.reset=function(){this.next=this.b=this.a=null};var Wt=!1,Xt=new jt;function Qt(){for(var t;t=Bt();){try{t.a.call(t.b)}catch(t){Ht(t)}var e=$t;e.g(t),e.b<e.f&&(e.b++,t.next=e.a,e.a=t)}Wt=!1}function Jt(t,e){Mt.call(this),this.b=t||1,this.a=e||I,this.f=C(this.Ya,this),this.g=R()}function Yt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Zt(t,e,n){if("function"==T(t))n&&(t=C(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=C(t.handleEvent,t)}return 2147483647<Number(e)?-1:I.setTimeout(t,e||0)}L(Jt,Mt),(v=Jt.prototype).aa=!1,v.M=null,v.Ya=function(){if(this.aa){var t=R()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(Yt(this),this.start()))}},v.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=R())},v.G=function(){Jt.S.G.call(this),Yt(this),delete this.a};var te=function(t){function e(e,n,r){var s=t.call(this)||this;return s.g=null!=r?e.bind(r):e,s.h=n,s.b=null,s.c=!1,s.a=null,s}return function(t,e){function n(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Zt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(I.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(P);function ee(t){P.call(this),this.b=t,this.a={}}L(ee,P);var ne=[];function re(t,e,n,r){Array.isArray(n)||(n&&(ne[0]=n.toString()),n=ne);for(var s=0;s<n.length;s++){var i=Dt(e,n[s],r||t.handleEvent,!1,t.b||t);if(!i)break;t.a[i.key]=i}}function se(t){K(t.a,function(t,e){this.a.hasOwnProperty(e)&&Ct(t)},t),t.a={}}function ie(){this.a=!0}function oe(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return Ft(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}ee.prototype.G=function(){ee.S.G.call(this),se(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ie.prototype.info=function(){};var ae=null;function ue(){return ae=ae||new Mt}function ce(t){wt.call(this,"serverreachability",t)}function he(t){var e=ue();e.dispatchEvent(new ce(e,t))}function le(t){wt.call(this,"statevent",t)}function fe(t){var e=ue();e.dispatchEvent(new le(e,t))}function de(t){wt.call(this,"timingevent",t)}function pe(t,e){if("function"!=T(t))throw Error("Fn must not be null and must be a function");return I.setTimeout(function(){t()},e)}L(ce,wt),L(le,wt),L(de,wt);var ge={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},me={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function ye(){}function we(t){var e;return(e=t.a)||(e=t.a={}),e}function ve(){}ye.prototype.a=null;var be,Ee={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function Ie(){wt.call(this,"d")}function _e(){wt.call(this,"c")}function Te(){}function Ne(t,e,n,r){this.g=t,this.c=e,this.f=n,this.T=r||1,this.J=new ee(this),this.P=Ae,t=rt?125:void 0,this.R=new Jt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}L(Ie,wt),L(_e,wt),L(Te,ye),be=new Te;var Ae=45e3,Se={},xe={};function De(t,e,n){t.H=1,t.i=Je(ze(e)),t.j=n,t.I=!0,Oe(t,null)}function Oe(t,e){t.u=R(),Re(t),t.l=ze(t.i);var n=t.l,r=t.T;Array.isArray(r)||(r=[String(r)]),ln(n.b,"t",r),t.D=0,t.a=rr(t.g,t.g.C?e:null),0<t.O&&(t.F=new te(C(t.Ca,t,t.a),t.O)),re(t.J,t.a,"readystatechange",t.Wa),e=t.B?W(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),he(1),function(t,e,n,r,s,i){t.info(function(){if(t.a)if(i)for(var o="",a=i.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+c+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o})}(t.c,t.m,t.l,t.f,t.T,t.j)}function Ce(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var s=ke(t,n);if(s==xe){4==e&&(t.h=4,fe(14),r=!1),oe(t.c,t.f,null,"[Incomplete Response]");break}if(s==Se){t.h=4,fe(15),oe(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}oe(t.c,t.f,s,null),Me(t,s)}4==e&&0==n.length&&(t.h=1,fe(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.W&&(t.W=!0,(e=t.g).a==t&&e.V&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Xn(e),e.F=!0)):(oe(t.c,t.f,n,"[Invalid Chunked Response]"),Ue(t),Ve(t))}function ke(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?xe:(n=Number(e.substring(n,r)),isNaN(n)?Se:(r+=1)+n>e.length?xe:(e=e.substr(r,n),t.D=r+n,e))}function Re(t){t.U=R()+t.P,Le(t,t.P)}function Le(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=pe(C(t.Ua,t),e)}function Pe(t){t.o&&(I.clearTimeout(t.o),t.o=null)}function Ve(t){0==t.g.v||t.A||Yn(t.g,t)}function Ue(t){Pe(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Yt(t.R),se(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Me(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||yn(n.b,t)))if(n.I=t.N,!t.C&&yn(n.b,t)&&3==n.v){try{var r=n.ka.a.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Jn(n),Fn(n)}Wn(n),fe(18)}}else n.oa=s[1],0<n.oa-n.P&&37500>s[2]&&n.H&&0==n.o&&!n.m&&(n.m=pe(C(n.Ra,n),6e3));if(1>=mn(n.b)&&n.ea){try{n.ea()}catch(t){}n.ea=void 0}}else tr(n,11)}else if((t.C||n.a==t)&&Jn(n),!F(e))for(e=r=n.ka.a.parse(e),r=0;r<e.length;r++)if(s=e[r],n.P=s[0],s=s[1],2==n.v)if("c"==s[0]){n.J=s[1],n.ga=s[2];var i=s[3];null!=i&&(n.ha=i,n.c.info("VER="+n.ha));var o=s[4];null!=o&&(n.pa=o,n.c.info("SVER="+n.pa));var a=s[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&($(h,"spdy")||$(h,"quic")||$(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(wn(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.na=f,Qe(u.B,u.A,f))}}n.v=3,n.f&&n.f.ta(),n.V&&(n.N=R()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).la=nr(u,u.C?u.ga:null,u.fa),d.C){vn(u.b,d);var p=d,g=u.D;g&&p.setTimeout(g),p.o&&(Pe(p),Re(p)),u.a=d}else Kn(u);0<n.g.length&&$n(n)}else"stop"!=s[0]&&"close"!=s[0]||tr(n,7);else 3==n.v&&("stop"==s[0]||"close"==s[0]?"stop"==s[0]?tr(n,7):qn(n):"noop"!=s[0]&&n.f&&n.f.sa(s),n.o=0);he(4)}catch(t){}}function qe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(N(t)||"string"==typeof t)U(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(N(t)||"string"==typeof t){n=[];for(var r=t.length,s=0;s<r;s++)n.push(s)}else for(s in n=[],r=0,t)n[r++]=s;s=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(N(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}}function Fe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Fe)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function je(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ge(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var s={};for(n=e=0;e<t.a.length;)Ge(s,r=t.a[e])||(t.a[n++]=r,s[r]=1),e++;t.a.length=n}}function Ge(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(v=Ne.prototype).setTimeout=function(t){this.P=t},v.Wa=function(t){t=t.target;var e=this.F;e&&3==Pn(t)?e.f():this.Ca(t)},v.Ca=function(t){try{if(t==this.a)t:{var e=Pn(this.a),n=this.a.ua(),r=this.a.X();if(!(3>e||3==e&&!rt&&!this.a.$())){this.A||4!=e||7==n||he(8==n||0>=r?3:2),Pe(this);var s=this.a.X();this.N=s;var i=this.a.$();if(this.b=200==s,function(t,e,n,r,s,i,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o})}(this.c,this.m,this.l,this.f,this.T,e,s),this.b){if(this.V&&!this.C){e:{if(this.a){var o,a=this.a;if((o=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(o)){var u=o;break e}}u=null}if(!u){this.b=!1,this.h=3,fe(12),Ue(this),Ve(this);break t}oe(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Me(this,u)}this.I?(Ce(this,e,i),rt&&this.b&&3==e&&(re(this.J,this.R,"tick",this.Va),this.R.start())):(oe(this.c,this.f,i,null),Me(this,i)),4==e&&Ue(this),this.b&&!this.A&&(4==e?Yn(this.g,this):(this.b=!1,Re(this)))}else 400==s&&0<i.indexOf("Unknown SID")?(this.h=3,fe(12)):(this.h=0,fe(13)),Ue(this),Ve(this)}}}catch(t){}},v.Va=function(){if(this.a){var t=Pn(this.a),e=this.a.$();this.D<e.length&&(Pe(this),Ce(this,t,e),this.b&&4!=t&&Re(this))}},v.cancel=function(){this.A=!0,Ue(this)},v.Ua=function(){this.o=null;var t=R();0<=t-this.U?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.H&&(he(3),fe(17)),Ue(this),this.h=2,Ve(this)):Le(this,this.U-t)},(v=Fe.prototype).K=function(){je(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},v.L=function(){return je(this),this.a.concat()},v.get=function(t,e){return Ge(this.b,t)?this.b[t]:e},v.set=function(t,e){Ge(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},v.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var s=n[r],i=this.get(s);t.call(e,i,s,this)}};var $e=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Be(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Be){this.a=void 0!==e?e:t.a,He(this,t.f),this.j=t.j,Ke(this,t.c),We(this,t.h),this.g=t.g,e=t.b;var n=new an;n.c=e.c,e.a&&(n.a=new Fe(e.a),n.b=e.b),Xe(this,n),this.i=t.i}else t&&(n=String(t).match($e))?(this.a=!!e,He(this,n[1]||"",!0),this.j=Ye(n[2]||""),Ke(this,n[3]||"",!0),We(this,n[4]),this.g=Ye(n[5]||"",!0),Xe(this,n[6]||"",!0),this.i=Ye(n[7]||"")):(this.a=!!e,this.b=new an(null,this.a))}function ze(t){return new Be(t)}function He(t,e,n){t.f=n?Ye(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Ke(t,e,n){t.c=n?Ye(e,!0):e}function We(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Xe(t,e,n){e instanceof an?(t.b=e,function(t,e){e&&!t.f&&(un(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(cn(this,e),ln(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=Ze(e,sn)),t.b=new an(e,t.a))}function Qe(t,e,n){t.b.set(e,n)}function Je(t){return Qe(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^R()).toString(36)),t}function Ye(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ze(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,tn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function tn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Be.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ze(e,en,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Ze(e,en,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ze(n,"/"==n.charAt(0)?rn:nn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Ze(n,on)),t.join("")};var en=/[#\/\?@]/g,nn=/[#\?:]/g,rn=/[#\?]/g,sn=/[#\?@]/g,on=/#/g;function an(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function un(t){t.a||(t.a=new Fe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function cn(t,e){un(t),e=fn(t,e),Ge(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ge((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&je(t)))}function hn(t,e){return un(t),e=fn(t,e),Ge(t.a.b,e)}function ln(t,e,n){cn(t,e),0<n.length&&(t.c=null,t.a.set(fn(t,e),q(n)),t.b+=n.length)}function fn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function dn(t){this.g=t||pn,I.PerformanceNavigationTiming?t=0<(t=I.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(I.ia&&I.ia.ya&&I.ia.ya()&&I.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(v=an.prototype).add=function(t,e){un(this),this.c=null,t=fn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},v.forEach=function(t,e){un(this),this.a.forEach(function(n,r){U(n,function(n){t.call(e,n,r,this)},this)},this)},v.L=function(){un(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var s=t[r],i=0;i<s.length;i++)n.push(e[r]);return n},v.K=function(t){un(this);var e=[];if("string"==typeof t)hn(this,t)&&(e=M(e,this.a.get(fn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=M(e,t[n])}return e},v.set=function(t,e){return un(this),this.c=null,hn(this,t=fn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},v.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},v.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],s=encodeURIComponent(String(r));r=this.K(r);for(var i=0;i<r.length;i++){var o=s;""!==r[i]&&(o+="="+encodeURIComponent(String(r[i]))),t.push(o)}}return this.c=t.join("&")};var pn=10;function gn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function mn(t){return t.b?1:t.a?t.a.size:0}function yn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function wn(t,e){t.a?t.a.add(e):t.b=e}function vn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function bn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var s=w(t.a.values()),i=s.next();!i.done;i=s.next()){var o=i.value;r=r.concat(o.s)}}catch(t){e={error:t}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(e)throw e.error}}return r}return q(t.c)}function En(){}function In(t,e,n){var r=n||"";try{qe(t,function(t,n){var s=t;A(t)&&(s=Ft(t)),e.push(r+n+"="+encodeURIComponent(s))})}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function _n(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(t){}}dn.prototype.cancel=function(){var t,e;if(this.c=bn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=w(this.a.values()),r=n.next();!r.done;r=n.next()){r.value.cancel()}}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},En.prototype.stringify=function(t){return I.JSON.stringify(t,void 0)},En.prototype.parse=function(t){return I.JSON.parse(t,void 0)};var Tn=I.JSON.parse;function Nn(t){Mt.call(this),this.headers=new Fe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=An,this.D=this.F=!1}L(Nn,Mt);var An="",Sn=/^https?$/i,xn=["POST","PUT"];function Dn(t){return"content-type"==t.toLowerCase()}function On(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Cn(t),Rn(t)}function Cn(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function kn(t){if(t.b&&void 0!==E&&(!t.s[1]||4!=Pn(t)||2!=t.X()))if(t.l&&4==Pn(t))Zt(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==Pn(t)){t.b=!1;try{var e,n=t.X();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var s;if(s=0===n){var i=String(t.B).match($e)[1]||null;if(!i&&I.self&&I.self.location){var o=I.self.location.protocol;i=o.substr(0,o.length-1)}s=!Sn.test(i?i.toLowerCase():"")}e=s}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var a=2<Pn(t)?t.a.statusText:""}catch(t){a=""}t.f=a+" ["+t.X()+"]",Cn(t)}}finally{Rn(t)}}}function Rn(t,e){if(t.a){Ln(t);var n=t.a,r=t.s[0]?_:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Ln(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(I.clearTimeout(t.m),t.m=null)}function Pn(t){return t.a?t.a.readyState:0}function Vn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return K(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Qe(t,e,n))}function Un(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Mn(t){this.pa=0,this.g=[],this.c=new ie,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=Un("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=Un("baseRetryDelayMs",5e3,t),this.Ma=Un("retryDelaySeedMs",1e4,t),this.Ja=Un("forwardChannelMaxRetries",2,t),this.ma=Un("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new dn(t&&t.concurrentRequestLimit),this.ka=new function(){this.a=new En},this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function qn(t){if(jn(t),3==t.v){var e=t.R++,n=ze(t.B);Qe(n,"SID",t.J),Qe(n,"RID",e),Qe(n,"TYPE","terminate"),zn(t,n),(e=new Ne(t,t.c,e,void 0)).H=2,e.i=Je(ze(n)),n=!1,I.navigator&&I.navigator.sendBeacon&&(n=I.navigator.sendBeacon(e.i.toString(),"")),!n&&I.Image&&((new Image).src=e.i,n=!0),n||(e.a=rr(e.g,null),e.a.ba(e.i)),e.u=R(),Re(e)}er(t)}function Fn(t){t.a&&(Xn(t),t.a.cancel(),t.a=null)}function jn(t){Fn(t),t.j&&(I.clearTimeout(t.j),t.j=null),Jn(t),t.b.cancel(),t.h&&("number"==typeof t.h&&I.clearTimeout(t.h),t.h=null)}function Gn(t,e){t.g.push(new function(t,e){this.b=t,this.a=e}(t.La++,e)),3==t.v&&$n(t)}function $n(t){gn(t.b)||t.h||(t.h=!0,Kt(t.Ba,t),t.u=0)}function Bn(t,e){var n;n=e?e.f:t.R++;var r=ze(t.B);Qe(r,"SID",t.J),Qe(r,"RID",n),Qe(r,"AID",t.P),zn(t,r),t.i&&t.l&&Vn(r,t.i,t.l),n=new Ne(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Hn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),wn(t.b,n),De(n,r,e)}function zn(t,e){t.f&&qe({},function(t,n){Qe(e,n,t)})}function Hn(t,e,n){n=Math.min(t.g.length,n);var r=t.f?C(t.f.Ha,t.f,t):null;t:for(var s=t.g,i=-1;;){var o=["count="+n];-1==i?0<n?(i=s[0].b,o.push("ofs="+i)):i=0:o.push("ofs="+i);for(var a=!0,u=0;u<n;u++){var c=s[u].b,h=s[u].a;if(0>(c-=i))i=Math.max(0,s[u].b-100),a=!1;else try{In(h,o,"req"+c+"_")}catch(t){r&&r(h)}}if(a){r=o.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function Kn(t){t.a||t.j||(t.U=1,Kt(t.Aa,t),t.o=0)}function Wn(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=pe(C(t.Aa,t),Zn(t,t.o)),t.o++,!0)}function Xn(t){null!=t.s&&(I.clearTimeout(t.s),t.s=null)}function Qn(t){t.a=new Ne(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=ze(t.la);Qe(e,"RID","rpc"),Qe(e,"SID",t.J),Qe(e,"CI",t.H?"0":"1"),Qe(e,"AID",t.P),zn(t,e),Qe(e,"TYPE","xmlhttp"),t.i&&t.l&&Vn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Je(ze(e)),n.j=null,n.I=!0,Oe(n,t)}function Jn(t){null!=t.m&&(I.clearTimeout(t.m),t.m=null)}function Yn(t,e){var n=null;if(t.a==e){Jn(t),Xn(t),t.a=null;var r=2}else{if(!yn(t.b,e))return;n=e.s,vn(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=R()-e.u;var s=t.u;(r=ue()).dispatchEvent(new de(r,n,e,s)),$n(t)}else Kn(t);else if(3==(s=e.h)||0==s&&0<t.I||!(1==r&&function(t,e){return!(mn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja)||(t.h=pe(C(t.Ba,t,e),Zn(t,t.u)),t.u++,0)))}(t,e)||2==r&&Wn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),s){case 1:tr(t,5);break;case 4:tr(t,10);break;case 3:tr(t,6);break;default:tr(t,2)}}function Zn(t,e){var n=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(n*=2),n*e}function tr(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=C(t.Xa,t);n||(n=new Be("//www.google.com/images/cleardot.gif"),I.location&&"http"==I.location.protocol||He(n,"https"),Je(n)),function(t,e){var n=new ie;if(I.Image){var r=new Image;r.onload=k(_n,n,r,"TestLoadImage: loaded",!0,e),r.onerror=k(_n,n,r,"TestLoadImage: error",!1,e),r.onabort=k(_n,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=k(_n,n,r,"TestLoadImage: timeout",!1,e),I.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else fe(2);t.v=0,t.f&&t.f.ra(e),er(t),jn(t)}function er(t){t.v=0,t.I=-1,t.f&&(0==bn(t.b).length&&0==t.g.length||(t.b.c.length=0,q(t.g),t.g.length=0),t.f.qa())}function nr(t,e,n){var r=function(t){return t instanceof Be?ze(t):new Be(t,void 0)}(n);if(""!=r.c)e&&Ke(r,e+"."+r.c),We(r,r.h);else{var s=I.location;r=function(t,e,n,r){var s=new Be(null,void 0);return t&&He(s,t),e&&Ke(s,e),n&&We(s,n),r&&(s.g=r),s}(s.protocol,e?e+"."+s.hostname:s.hostname,+s.port,n)}return t.W&&K(t.W,function(t,e){Qe(r,e,t)}),e=t.A,n=t.na,e&&n&&Qe(r,e,n),Qe(r,"VER",t.ha),zn(t,r),r}function rr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Nn(t.Ka)).F=t.C,e}function sr(){}function ir(){if(et&&!(10<=Number(pt)))throw Error("Environmental error: no available transport.")}function or(t,e){Mt.call(this),this.a=new Mn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!F(t)&&(this.a.i=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!F(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new cr(this)}function ar(t){Ie.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function ur(){_e.call(this),this.status=1}function cr(t){this.a=t}(v=Nn.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?we(this.H):we(be),this.a.onreadystatechange=C(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void On(this,t)}t=n||"";var s=new Fe(this.headers);r&&qe(r,function(t,e){s.set(e,t)}),r=function(t){t:{for(var e=Dn,n=t.length,r="string"==typeof t?t.split(""):t,s=0;s<n;s++)if(s in r&&e.call(void 0,r[s],s,t)){e=s;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(s.L()),n=I.FormData&&t instanceof I.FormData,!(0<=V(xn,e))||r||n||s.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),s.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Ln(this),0<this.o&&((this.D=function(t){return et&&ft(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=C(this.xa,this)):this.m=Zt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){On(this,t)}},v.xa=function(){void 0!==E&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},v.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Rn(this))},v.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Rn(this,!0)),Nn.S.G.call(this)},v.za=function(){this.j||(this.A||this.l||this.g?kn(this):this.Ta())},v.Ta=function(){kn(this)},v.X=function(){try{return 2<Pn(this)?this.a.status:-1}catch(t){return-1}},v.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},v.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Tn(e)}},v.ua=function(){return this.h},v.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(v=Mn.prototype).ha=8,v.v=1,v.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ne(this,this.c,t,void 0),r=this.l;if(this.O&&(r?Q(r=W(r),this.O):r=this.O),null===this.i&&(n.B=r),this.da)t:{for(var s=e=0;s<this.g.length;s++){var i=this.g[s];if(void 0===(i="__data__"in i.a&&"string"==typeof(i=i.a.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=s;break t}if(4096===e||s===this.g.length-1){e=s+1;break t}}e=1e3}else e=1e3;e=Hn(this,n,e),Qe(s=ze(this.B),"RID",t),Qe(s,"CVER",22),this.A&&Qe(s,"X-HTTP-Session-Id",this.A),zn(this,s),this.i&&r&&Vn(s,this.i,r),wn(this.b,n),this.Ga&&Qe(s,"TYPE","init"),this.da?(Qe(s,"$req",e),Qe(s,"SID","null"),n.V=!0,De(n,s,null)):De(n,s,e),this.v=2}}else 3==this.v&&(t?Bn(this,t):0==this.g.length||gn(this.b)||Bn(this))},v.Aa=function(){if(this.j=null,Qn(this),this.V&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=pe(C(this.Sa,this),t)}},v.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Fn(this),Qn(this))},v.Ra=function(){null!=this.m&&(this.m=null,Fn(this),Wn(this),fe(19))},v.Xa=function(t){t?(this.c.info("Successfully pinged google.com"),fe(2)):(this.c.info("Failed to ping google.com"),fe(1))},(v=sr.prototype).ta=function(){},v.sa=function(){},v.ra=function(){},v.qa=function(){},v.Ha=function(){},ir.prototype.a=function(t,e){return new or(t,e)},L(or,Mt),(v=or.prototype).addEventListener=function(t,e,n,r){or.S.addEventListener.call(this,t,e,n,r)},v.removeEventListener=function(t,e,n,r){or.S.removeEventListener.call(this,t,e,n,r)},v.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,e=this.l,n=this.b||void 0;fe(0),t.fa=e,t.W=n||{},t.H=t.T,t.B=nr(t,null,t.fa),$n(t)},v.close=function(){qn(this.a)},v.Pa=function(t){if("string"==typeof t){var e={};e.__data__=t,Gn(this.a,e)}else this.g?((e={}).__data__=Ft(t),Gn(this.a,e)):Gn(this.a,t)},v.G=function(){this.a.f=null,delete this.f,qn(this.a),delete this.a,or.S.G.call(this)},L(ar,Ie),L(ur,_e),L(cr,sr),cr.prototype.ta=function(){this.a.dispatchEvent("a")},cr.prototype.sa=function(t){this.a.dispatchEvent(new ar(t))},cr.prototype.ra=function(t){this.a.dispatchEvent(new ur(t))},cr.prototype.qa=function(){this.a.dispatchEvent("b")},ir.prototype.createWebChannel=ir.prototype.a,or.prototype.send=or.prototype.Pa,or.prototype.open=or.prototype.Oa,or.prototype.close=or.prototype.close,ge.NO_ERROR=0,ge.TIMEOUT=8,ge.HTTP_ERROR=6,me.COMPLETE="complete",ve.EventType=Ee,Ee.OPEN="a",Ee.CLOSE="b",Ee.ERROR="c",Ee.MESSAGE="d",Mt.prototype.listen=Mt.prototype.va,Nn.prototype.listenOnce=Nn.prototype.wa,Nn.prototype.getLastError=Nn.prototype.Qa,Nn.prototype.getLastErrorCode=Nn.prototype.ua,Nn.prototype.getStatus=Nn.prototype.X,Nn.prototype.getResponseJson=Nn.prototype.Na,Nn.prototype.getResponseText=Nn.prototype.$,Nn.prototype.send=Nn.prototype.ba;var hr={createWebChannelTransport:function(){return new ir},ErrorCode:ge,EventType:me,WebChannel:ve,XhrIo:Nn},lr=hr.createWebChannelTransport,fr=hr.ErrorCode,dr=hr.EventType,pr=hr.WebChannel,gr=hr.XhrIo;class mr{constructor(t){this.uid=t}t(){return null!=this.uid}s(){return this.t()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}mr.UNAUTHENTICATED=new mr(null),mr.i=new mr("google-credentials-uid"),mr.o=new mr("first-party-uid");const yr=new m("@firebase/firestore");function wr(){return yr.logLevel}function vr(t,...e){if(yr.logLevel<=u.DEBUG){const n=e.map(Ir);yr.debug("Firestore (7.19.1): "+t,...n)}}function br(t,...e){if(yr.logLevel<=u.ERROR){const n=e.map(Ir);yr.error("Firestore (7.19.1): "+t,...n)}}function Er(t,...e){if(yr.logLevel<=u.WARN){const n=e.map(Ir);yr.warn("Firestore (7.19.1): "+t,...n)}}function Ir(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function _r(t="Unexpected state"){const e="FIRESTORE (7.19.1) INTERNAL ASSERTION FAILED: "+t;throw br(e),new Error(e)}function Tr(t,e){t||_r()}function Nr(t,e){return t}const Ar={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Sr extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=(()=>`${this.name}: [code=${this.code}]: ${this.message}`)}}class xr{constructor(t,e){this.user=e,this.type="OAuth",this.u={},this.u.Authorization="Bearer "+t}}class Dr{constructor(t){this.h=null,this.currentUser=mr.UNAUTHENTICATED,this.l=!1,this._=0,this.T=null,this.forceRefresh=!1,this.h=(()=>{this._++,this.currentUser=this.I(),this.l=!0,this.T&&this.T(this.currentUser)}),this._=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.h):(this.h(null),t.get().then(t=>{this.auth=t,this.h&&this.auth.addAuthTokenListener(this.h)},()=>{}))}getToken(){const t=this._,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this._!==t?(vr("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Tr("string"==typeof e.accessToken),new xr(e.accessToken,this.currentUser)):null):Promise.resolve(null)}m(){this.forceRefresh=!0}A(t){this.T=t,this.l&&t(this.currentUser)}R(){this.auth&&this.auth.removeAuthTokenListener(this.h),this.h=null,this.T=null}I(){const t=this.auth&&this.auth.getUid();return Tr(null===t||"string"==typeof t),new mr(t)}}function Or(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Cr{static P(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const r=Or(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<e&&(n+=t.charAt(r[s]%t.length))}return n}}function kr(t,e){return t<e?-1:t>e?1:0}function Rr(t,e,n){return t.length===e.length&&t.every((t,r)=>n(t,e[r]))}function Lr(t){return t+"\0"}class Pr{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Sr(Ar.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Sr(Ar.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Sr(Ar.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Sr(Ar.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Pr.fromMillis(Date.now())}static fromDate(t){return Pr.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3);return new Pr(e,1e6*(t-1e3*e))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}V(t){return this.seconds===t.seconds?kr(this.nanoseconds,t.nanoseconds):kr(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Vr{constructor(t){this.timestamp=t}static g(t){return new Vr(t)}static min(){return new Vr(new Pr(0,0))}p(t){return this.timestamp.V(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}v(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}S(){return this.timestamp}}class Ur{constructor(t,e,n){void 0===e?e=0:e>t.length&&_r(),void 0===n?n=t.length-e:n>t.length-e&&_r(),this.segments=t,this.offset=e,this.D=n}get length(){return this.D}isEqual(t){return 0===Ur.C(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Ur?t.forEach(t=>{e.push(t)}):e.push(t),this.N(e)}limit(){return this.offset+this.length}O(t){return t=void 0===t?1:t,this.N(this.segments,this.offset+t,this.length-t)}k(){return this.N(this.segments,this.offset,this.length-1)}F(){return this.segments[this.offset]}M(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}$(){return 0===this.length}L(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}q(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}B(){return this.segments.slice(this.offset,this.limit())}static C(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Mr extends Ur{N(t,e,n){return new Mr(t,e,n)}U(){return this.B().join("/")}toString(){return this.U()}static W(t){if(t.indexOf("//")>=0)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid path (${t}). Paths must not contain // in them.`);const e=t.split("/").filter(t=>t.length>0);return new Mr(e)}static K(){return new Mr([])}}const qr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Fr extends Ur{N(t,e,n){return new Fr(t,e,n)}static j(t){return qr.test(t)}U(){return this.B().map(t=>(t=t.replace("\\","\\\\").replace("`","\\`"),Fr.j(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.U()}G(){return 1===this.length&&"__name__"===this.get(0)}static H(){return new Fr(["__name__"])}static J(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Sr(Ar.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Sr(Ar.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new Sr(Ar.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Fr(e)}static K(){return new Fr([])}}class jr{constructor(t){this.path=t}static Y(t){return new jr(Mr.W(t))}static X(t){return new jr(Mr.W(t).O(5))}Z(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===Mr.C(this.path,t.path)}toString(){return this.path.toString()}static C(t,e){return Mr.C(t.path,e.path)}static tt(t){return t.length%2==0}static et(t){return new jr(new Mr(t.slice()))}}class Gr{constructor(t,e,n,r,s){this.nt=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=s}}class $r{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get st(){return"(default)"===this.database}isEqual(t){return t instanceof $r&&t.projectId===this.projectId&&t.database===this.database}p(t){return kr(this.projectId,t.projectId)||kr(this.database,t.database)}}function Br(t){return null==t}function zr(t){return-0===t&&1/t==-1/0}function Hr(t){return"number"==typeof t&&Number.isInteger(t)&&!zr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class Kr{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.it=null}}function Wr(t,e=null,n=[],r=[],s=null,i=null,o=null){return new Kr(t,e,n,r,s,i,o)}function Xr(t){const e=Nr(t);if(null===e.it){let t=e.path.U();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>(function(t){return t.field.U()+t.op.toString()+$s(t.value)})(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>(function(t){return t.field.U()+t.dir})(t)).join(","),Br(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Mo(e.startAt)),e.endAt&&(t+="|ub:",t+=Mo(e.endAt)),e.it=t}return e.it}function Qr(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!$o(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(n=t.filters[s],r=e.filters[s],n.op!==r.op||!n.field.isEqual(r.field)||!qs(n.value,r.value))return!1;var n,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Fo(t.startAt,e.startAt)&&Fo(t.endAt,e.endAt)}function Jr(t){return jr.tt(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Yr{constructor(t){this.rt=t}static fromBase64String(t){const e=atob(t);return new Yr(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Yr(e)}toBase64(){return t=this.rt,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.rt)}ot(){return 2*this.rt.length}p(t){return kr(this.rt,t.rt)}isEqual(t){return this.rt===t.rt}}Yr.at=new Yr("");class Zr{constructor(t,e,n,r,s=Vr.min(),i=Vr.min(),o=Yr.at){this.target=t,this.targetId=e,this.ct=n,this.sequenceNumber=r,this.ut=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o}ht(t){return new Zr(this.target,this.targetId,this.ct,t,this.ut,this.lastLimboFreeSnapshotVersion,this.resumeToken)}lt(t,e){return new Zr(this.target,this.targetId,this.ct,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}_t(t){return new Zr(this.target,this.targetId,this.ct,this.sequenceNumber,this.ut,t,this.resumeToken)}}class ts{constructor(t){this.count=t}}var es,ns;function rs(t){switch(t){case Ar.OK:return _r();case Ar.CANCELLED:case Ar.UNKNOWN:case Ar.DEADLINE_EXCEEDED:case Ar.RESOURCE_EXHAUSTED:case Ar.INTERNAL:case Ar.UNAVAILABLE:case Ar.UNAUTHENTICATED:return!1;case Ar.INVALID_ARGUMENT:case Ar.NOT_FOUND:case Ar.ALREADY_EXISTS:case Ar.PERMISSION_DENIED:case Ar.FAILED_PRECONDITION:case Ar.ABORTED:case Ar.OUT_OF_RANGE:case Ar.UNIMPLEMENTED:case Ar.DATA_LOSS:return!0;default:return _r()}}function ss(t){if(void 0===t)return br("GRPC error has no .code"),Ar.UNKNOWN;switch(t){case es.OK:return Ar.OK;case es.CANCELLED:return Ar.CANCELLED;case es.UNKNOWN:return Ar.UNKNOWN;case es.DEADLINE_EXCEEDED:return Ar.DEADLINE_EXCEEDED;case es.RESOURCE_EXHAUSTED:return Ar.RESOURCE_EXHAUSTED;case es.INTERNAL:return Ar.INTERNAL;case es.UNAVAILABLE:return Ar.UNAVAILABLE;case es.UNAUTHENTICATED:return Ar.UNAUTHENTICATED;case es.INVALID_ARGUMENT:return Ar.INVALID_ARGUMENT;case es.NOT_FOUND:return Ar.NOT_FOUND;case es.ALREADY_EXISTS:return Ar.ALREADY_EXISTS;case es.PERMISSION_DENIED:return Ar.PERMISSION_DENIED;case es.FAILED_PRECONDITION:return Ar.FAILED_PRECONDITION;case es.ABORTED:return Ar.ABORTED;case es.OUT_OF_RANGE:return Ar.OUT_OF_RANGE;case es.UNIMPLEMENTED:return Ar.UNIMPLEMENTED;case es.DATA_LOSS:return Ar.DATA_LOSS;default:return _r()}}(ns=es||(es={}))[ns.OK=0]="OK",ns[ns.CANCELLED=1]="CANCELLED",ns[ns.UNKNOWN=2]="UNKNOWN",ns[ns.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ns[ns.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ns[ns.NOT_FOUND=5]="NOT_FOUND",ns[ns.ALREADY_EXISTS=6]="ALREADY_EXISTS",ns[ns.PERMISSION_DENIED=7]="PERMISSION_DENIED",ns[ns.UNAUTHENTICATED=16]="UNAUTHENTICATED",ns[ns.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ns[ns.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ns[ns.ABORTED=10]="ABORTED",ns[ns.OUT_OF_RANGE=11]="OUT_OF_RANGE",ns[ns.UNIMPLEMENTED=12]="UNIMPLEMENTED",ns[ns.INTERNAL=13]="INTERNAL",ns[ns.UNAVAILABLE=14]="UNAVAILABLE",ns[ns.DATA_LOSS=15]="DATA_LOSS";class is{constructor(t,e){this.C=t,this.root=e||as.EMPTY}ft(t,e){return new is(this.C,this.root.ft(t,e,this.C).copy(null,null,as.dt,null,null))}remove(t){return new is(this.C,this.root.remove(t,this.C).copy(null,null,as.dt,null,null))}get(t){let e=this.root;for(;!e.$();){const n=this.C(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.$();){const r=this.C(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}$(){return this.root.$()}get size(){return this.root.size}wt(){return this.root.wt()}Et(){return this.root.Et()}Tt(t){return this.root.Tt(t)}forEach(t){this.Tt((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.Tt((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}It(t){return this.root.It(t)}At(){return new os(this.root,null,this.C,!1)}Rt(t){return new os(this.root,t,this.C,!1)}Pt(){return new os(this.root,null,this.C,!0)}Vt(t){return new os(this.root,t,this.C,!0)}}class os{constructor(t,e,n,r){this.gt=r,this.yt=[];let s=1;for(;!t.$();)if(s=e?n(t.key,e):1,r&&(s*=-1),s<0)t=this.gt?t.left:t.right;else{if(0===s){this.yt.push(t);break}this.yt.push(t),t=this.gt?t.right:t.left}}pt(){let t=this.yt.pop();const e={key:t.key,value:t.value};if(this.gt)for(t=t.left;!t.$();)this.yt.push(t),t=t.right;else for(t=t.right;!t.$();)this.yt.push(t),t=t.left;return e}bt(){return this.yt.length>0}vt(){if(0===this.yt.length)return null;const t=this.yt[this.yt.length-1];return{key:t.key,value:t.value}}}class as{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:as.RED,this.left=null!=r?r:as.EMPTY,this.right=null!=s?s:as.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new as(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}$(){return!1}Tt(t){return this.left.Tt(t)||t(this.key,this.value)||this.right.Tt(t)}It(t){return this.right.It(t)||t(this.key,this.value)||this.left.It(t)}min(){return this.left.$()?this:this.left.min()}wt(){return this.min().key}Et(){return this.right.$()?this.key:this.right.Et()}ft(t,e,n){let r=this;const s=n(t,r.key);return(r=s<0?r.copy(null,null,null,r.left.ft(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.ft(t,e,n))).St()}Dt(){if(this.left.$())return as.EMPTY;let t=this;return t.left.Ct()||t.left.left.Ct()||(t=t.Nt()),(t=t.copy(null,null,null,t.left.Dt(),null)).St()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.$()||r.left.Ct()||r.left.left.Ct()||(r=r.Nt()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.Ct()&&(r=r.xt()),r.right.$()||r.right.Ct()||r.right.left.Ct()||(r=r.Ot()),0===e(t,r.key)){if(r.right.$())return as.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.Dt())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.St()}Ct(){return this.color}St(){let t=this;return t.right.Ct()&&!t.left.Ct()&&(t=t.kt()),t.left.Ct()&&t.left.left.Ct()&&(t=t.xt()),t.left.Ct()&&t.right.Ct()&&(t=t.Ft()),t}Nt(){let t=this.Ft();return t.right.left.Ct()&&(t=(t=(t=t.copy(null,null,null,null,t.right.xt())).kt()).Ft()),t}Ot(){let t=this.Ft();return t.left.left.Ct()&&(t=(t=t.xt()).Ft()),t}kt(){const t=this.copy(null,null,as.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}xt(){const t=this.copy(null,null,as.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}Ft(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}Mt(){const t=this.$t();return Math.pow(2,t)<=this.size+1}$t(){if(this.Ct()&&this.left.Ct())throw _r();if(this.right.Ct())throw _r();const t=this.left.$t();if(t!==this.right.$t())throw _r();return t+(this.Ct()?0:1)}}as.EMPTY=null,as.RED=!0,as.dt=!1,as.EMPTY=new class{constructor(){this.size=0}get key(){throw _r()}get value(){throw _r()}get color(){throw _r()}get left(){throw _r()}get right(){throw _r()}copy(t,e,n,r,s){return this}ft(t,e,n){return new as(t,e)}remove(t,e){return this}$(){return!0}Tt(t){return!1}It(t){return!1}wt(){return null}Et(){return null}Ct(){return!1}Mt(){return!0}$t(){return 0}};class us{constructor(t){this.C=t,this.data=new is(this.C)}has(t){return null!==this.data.get(t)}first(){return this.data.wt()}last(){return this.data.Et()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.Tt((e,n)=>(t(e),!1))}Lt(t,e){const n=this.data.Rt(t[0]);for(;n.bt();){const r=n.pt();if(this.C(r.key,t[1])>=0)return;e(r.key)}}qt(t,e){let n;for(n=void 0!==e?this.data.Rt(e):this.data.At();n.bt();)if(!t(n.pt().key))return}Bt(t){const e=this.data.Rt(t);return e.bt()?e.pt().key:null}At(){return new cs(this.data.At())}Rt(t){return new cs(this.data.Rt(t))}add(t){return this.copy(this.data.remove(t).ft(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}$(){return this.data.$()}Ut(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof us))return!1;if(this.size!==t.size)return!1;const e=this.data.At(),n=t.data.At();for(;e.bt();){const t=e.pt().key,r=n.pt().key;if(0!==this.C(t,r))return!1}return!0}B(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new us(this.C);return e.data=t,e}}class cs{constructor(t){this.Wt=t}pt(){return this.Wt.pt().key}bt(){return this.Wt.bt()}}const hs=new is(jr.C);function ls(){return hs}function fs(){return ls()}const ds=new is(jr.C);function ps(){return ds}const gs=new is(jr.C),ms=new us(jr.C);function ys(...t){let e=ms;for(const n of t)e=e.add(n);return e}const ws=new us(kr);function vs(){return ws}class bs{constructor(t){this.C=t?(e,n)=>t(e,n)||jr.C(e.key,n.key):(t,e)=>jr.C(t.key,e.key),this.Kt=ps(),this.Qt=new is(this.C)}static jt(t){return new bs(t.C)}has(t){return null!=this.Kt.get(t)}get(t){return this.Kt.get(t)}first(){return this.Qt.wt()}last(){return this.Qt.Et()}$(){return this.Qt.$()}indexOf(t){const e=this.Kt.get(t);return e?this.Qt.indexOf(e):-1}get size(){return this.Qt.size}forEach(t){this.Qt.Tt((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.Kt.ft(t.key,t),e.Qt.ft(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.Kt.remove(t),this.Qt.remove(e)):this}isEqual(t){if(!(t instanceof bs))return!1;if(this.size!==t.size)return!1;const e=this.Qt.At(),n=t.Qt.At();for(;e.bt();){const t=e.pt().key,r=n.pt().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new bs;return n.C=this.C,n.Kt=t,n.Qt=e,n}}class Es{constructor(){this.Gt=new is(jr.C)}track(t){const e=t.doc.key,n=this.Gt.get(e);n?0!==t.type&&3===n.type?this.Gt=this.Gt.ft(e,t):3===t.type&&1!==n.type?this.Gt=this.Gt.ft(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Gt=this.Gt.ft(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Gt=this.Gt.ft(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Gt=this.Gt.remove(e):1===t.type&&2===n.type?this.Gt=this.Gt.ft(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Gt=this.Gt.ft(e,{type:2,doc:t.doc}):_r():this.Gt=this.Gt.ft(e,t)}zt(){const t=[];return this.Gt.Tt((e,n)=>{t.push(n)}),t}}class Is{constructor(t,e,n,r,s,i,o,a){this.query=t,this.docs=e,this.Ht=n,this.docChanges=r,this.Jt=s,this.fromCache=i,this.Yt=o,this.Xt=a}static Zt(t,e,n,r){const s=[];return e.forEach(t=>{s.push({type:0,doc:t})}),new Is(t,e,bs.jt(e),s,n,r,!0,!1)}get hasPendingWrites(){return!this.Jt.$()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.Yt===t.Yt&&this.Jt.isEqual(t.Jt)&&_o(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ht.isEqual(t.Ht)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class _s{constructor(t,e,n,r,s){this.ut=t,this.te=e,this.ee=n,this.ne=r,this.se=s}static ie(t,e){const n=new Map;return n.set(t,Ts.re(t,e)),new _s(Vr.min(),n,vs(),ls(),ys())}}class Ts{constructor(t,e,n,r,s){this.resumeToken=t,this.oe=e,this.ae=n,this.ce=r,this.ue=s}static re(t,e){return new Ts(Yr.at,e,ys(),ys(),ys())}}class Ns{constructor(t,e,n,r){this.he=t,this.removedTargetIds=e,this.key=n,this.le=r}}class As{constructor(t,e){this.targetId=t,this._e=e}}class Ss{constructor(t,e,n=Yr.at,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class xs{constructor(){this.fe=0,this.de=Cs(),this.we=Yr.at,this.Ee=!1,this.Te=!0}get oe(){return this.Ee}get resumeToken(){return this.we}get Ie(){return 0!==this.fe}get me(){return this.Te}Ae(t){t.ot()>0&&(this.Te=!0,this.we=t)}Re(){let t=ys(),e=ys(),n=ys();return this.de.forEach((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:_r()}}),new Ts(this.we,this.Ee,t,e,n)}Pe(){this.Te=!1,this.de=Cs()}Ve(t,e){this.Te=!0,this.de=this.de.ft(t,e)}ge(t){this.Te=!0,this.de=this.de.remove(t)}ye(){this.fe+=1}pe(){this.fe-=1}be(){this.Te=!0,this.Ee=!0}}class Ds{constructor(t){this.ve=t,this.Se=new Map,this.De=ls(),this.Ce=Os(),this.Ne=new us(kr)}xe(t){for(const e of t.he)t.le instanceof uo?this.Oe(e,t.le):t.le instanceof co&&this.ke(e,t.key,t.le);for(const e of t.removedTargetIds)this.ke(e,t.key,t.le)}Fe(t){this.Me(t,e=>{const n=this.$e(e);switch(t.state){case 0:this.Le(e)&&n.Ae(t.resumeToken);break;case 1:n.pe(),n.Ie||n.Pe(),n.Ae(t.resumeToken);break;case 2:n.pe(),n.Ie||this.removeTarget(e);break;case 3:this.Le(e)&&(n.be(),n.Ae(t.resumeToken));break;case 4:this.Le(e)&&(this.qe(e),n.Ae(t.resumeToken));break;default:_r()}})}Me(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Se.forEach((t,n)=>{this.Le(n)&&e(n)})}Be(t){const e=t.targetId,n=t._e.count,r=this.Ue(e);if(r){const t=r.target;if(Jr(t))if(0===n){const n=new jr(t.path);this.ke(e,n,new co(n,Vr.min()))}else Tr(1===n);else this.We(e)!==n&&(this.qe(e),this.Ne=this.Ne.add(e))}}Ke(t){const e=new Map;this.Se.forEach((n,r)=>{const s=this.Ue(r);if(s){if(n.oe&&Jr(s.target)){const e=new jr(s.target.path);null!==this.De.get(e)||this.Qe(r,e)||this.ke(r,e,new co(e,t))}n.me&&(e.set(r,n.Re()),n.Pe())}});let n=ys();this.Ce.forEach((t,e)=>{let r=!0;e.qt(t=>{const e=this.Ue(t);return!e||2===e.ct||(r=!1,!1)}),r&&(n=n.add(t))});const r=new _s(t,e,this.Ne,this.De,n);return this.De=ls(),this.Ce=Os(),this.Ne=new us(kr),r}Oe(t,e){if(!this.Le(t))return;const n=this.Qe(t,e.key)?2:0;this.$e(t).Ve(e.key,n),this.De=this.De.ft(e.key,e),this.Ce=this.Ce.ft(e.key,this.je(e.key).add(t))}ke(t,e,n){if(!this.Le(t))return;const r=this.$e(t);this.Qe(t,e)?r.Ve(e,1):r.ge(e),this.Ce=this.Ce.ft(e,this.je(e).delete(t)),n&&(this.De=this.De.ft(e,n))}removeTarget(t){this.Se.delete(t)}We(t){const e=this.$e(t).Re();return this.ve.Ge(t).size+e.ae.size-e.ue.size}ye(t){this.$e(t).ye()}$e(t){let e=this.Se.get(t);return e||(e=new xs,this.Se.set(t,e)),e}je(t){let e=this.Ce.get(t);return e||(e=new us(kr),this.Ce=this.Ce.ft(t,e)),e}Le(t){const e=null!==this.Ue(t);return e||vr("WatchChangeAggregator","Detected inactive target",t),e}Ue(t){const e=this.Se.get(t);return e&&e.Ie?null:this.ve.ze(t)}qe(t){this.Se.set(t,new xs),this.ve.Ge(t).forEach(e=>{this.ke(t,e,null)})}Qe(t,e){return this.ve.Ge(t).has(e)}}function Os(){return new is(jr.C)}function Cs(){return new is(jr.C)}function ks(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Rs(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Ls(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Ps(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Vs(t){const e=Bs(t.mapValue.fields.__local_write_time__.timestampValue);return new Pr(e.seconds,e.nanos)}const Us=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ms(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Ps(t)?4:10:_r()}function qs(t,e){const n=Ms(t);if(n!==Ms(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Vs(t).isEqual(Vs(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Bs(t.timestampValue),r=Bs(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Hs(t.bytesValue).isEqual(Hs(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return zs(t.geoPointValue.latitude)===zs(e.geoPointValue.latitude)&&zs(t.geoPointValue.longitude)===zs(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return zs(t.integerValue)===zs(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=zs(t.doubleValue),r=zs(e.doubleValue);return n===r?zr(n)===zr(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Rr(t.arrayValue.values||[],e.arrayValue.values||[],qs);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(ks(n)!==ks(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!qs(n[t],r[t])))return!1;return!0}(t,e);default:return _r()}}function Fs(t,e){return void 0!==(t.values||[]).find(t=>qs(t,e))}function js(t,e){const n=Ms(t),r=Ms(e);if(n!==r)return kr(n,r);switch(n){case 0:return 0;case 1:return kr(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=zs(t.integerValue||t.doubleValue),r=zs(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Gs(t.timestampValue,e.timestampValue);case 4:return Gs(Vs(t),Vs(e));case 5:return kr(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Hs(t),r=Hs(e);return n.p(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=kr(n[t],r[t]);if(0!==e)return e}return kr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=kr(zs(t.latitude),zs(e.latitude));return 0!==n?n:kr(zs(t.longitude),zs(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=js(n[t],r[t]);if(e)return e}return kr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=kr(r[t],i[t]);if(0!==e)return e;const o=js(n[r[t]],s[i[t]]);if(0!==o)return o}return kr(r.length,i.length)}(t.mapValue,e.mapValue);default:throw _r()}}function Gs(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return kr(t,e);const n=Bs(t),r=Bs(e),s=kr(n.seconds,r.seconds);return 0!==s?s:kr(n.nanos,r.nanos)}function $s(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){const e=Bs(t);return`time(${e.seconds},${e.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Hs(e.bytesValue).toBase64():"referenceValue"in e?(r=e.referenceValue,jr.X(r).toString()):"geoPointValue"in e?`geo(${(n=e.geoPointValue).latitude},${n.longitude})`:"arrayValue"in e?function(e){let n="[",r=!0;for(const s of e.values||[])r?r=!1:n+=",",n+=t(s);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){const n=Object.keys(e.fields||{}).sort();let r="{",s=!0;for(const i of n)s?s=!1:r+=",",r+=`${i}:${t(e.fields[i])}`;return r+"}"}(e.mapValue):_r();var n,r}(t)}function Bs(t){if(Tr(!!t),"string"==typeof t){let e=0;const n=Us.exec(t);if(Tr(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:zs(t.seconds),nanos:zs(t.nanos)}}function zs(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Hs(t){return"string"==typeof t?Yr.fromBase64String(t):Yr.fromUint8Array(t)}function Ks(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.U()}`}}function Ws(t){return!!t&&"integerValue"in t}function Xs(t){return!!t&&"arrayValue"in t}function Qs(t){return!!t&&"nullValue"in t}function Js(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ys(t){return!!t&&"mapValue"in t}const Zs={asc:"ASCENDING",desc:"DESCENDING"},ti={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class ei{constructor(t,e){this.nt=t,this.He=e}}function ni(t){return{integerValue:""+t}}function ri(t,e){if(t.He){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zr(e)?"-0":e}}function si(t,e){return Hr(e)?ni(e):ri(t,e)}function ii(t,e){return t.He?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function oi(t,e){return t.He?e.toBase64():e.toUint8Array()}function ai(t){return Tr(!!t),Vr.g(function(t){const e=Bs(t);return new Pr(e.seconds,e.nanos)}(t))}function ui(t,e){return function(t){return new Mr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).U()}function ci(t){const e=Mr.W(t);return Tr(Ai(e)),e}function hi(t,e){return ui(t.nt,e.path)}function li(t,e){const n=ci(e);return Tr(n.get(1)===t.nt.projectId),Tr(!n.get(3)&&!t.nt.database||n.get(3)===t.nt.database),new jr(gi(n))}function fi(t,e){return ui(t.nt,e)}function di(t){const e=ci(t);return 4===e.length?Mr.K():gi(e)}function pi(t){return new Mr(["projects",t.nt.projectId,"databases",t.nt.database]).U()}function gi(t){return Tr(t.length>4&&"documents"===t.get(4)),t.O(5)}function mi(t,e,n){return{name:hi(t,e),fields:n.proto.mapValue.fields}}function yi(t,e){let n;if(e instanceof Qi)n={update:mi(t,e.key,e.value)};else if(e instanceof no)n={delete:hi(t,e.key)};else if(e instanceof Ji)n={update:mi(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.U())),{fieldPaths:e}}(e.Je)};else if(e instanceof Zi)n={transform:{document:hi(t,e.key),fieldTransforms:e.fieldTransforms.map(t=>(function(t,e){const n=e.transform;if(n instanceof Ci)return{fieldPath:e.field.U(),setToServerValue:"REQUEST_TIME"};if(n instanceof ki)return{fieldPath:e.field.U(),appendMissingElements:{values:n.elements}};if(n instanceof Li)return{fieldPath:e.field.U(),removeAllFromArray:{values:n.elements}};if(n instanceof Vi)return{fieldPath:e.field.U(),increment:n.Ye};throw _r()})(0,t))}};else{if(!(e instanceof ro))return _r();n={verify:hi(t,e.key)}}return e.Ze.Xe||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:function(t,e){return ii(t,e.S())}(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:_r()}(t,e.Ze)),n}function wi(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?Gi.updateTime(ai(t.updateTime)):void 0!==t.exists?Gi.exists(t.exists):Gi.tn()}(e.currentDocument):Gi.tn();if(e.update){e.update.name;const r=li(t,e.update.name),s=new so({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new qi(e.map(t=>Fr.J(t)))}(e.updateMask);return new Ji(r,s,t,n)}return new Qi(r,s,n)}if(e.delete){const r=li(t,e.delete);return new no(r,n)}if(e.transform){const r=li(t,e.transform.document),s=e.transform.fieldTransforms.map(e=>(function(t,e){let n=null;if("setToServerValue"in e)Tr("REQUEST_TIME"===e.setToServerValue),n=new Ci;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new ki(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Li(t)}else"increment"in e?n=new Vi(t,e.increment):_r();const r=Fr.J(e.fieldPath);return new Fi(r,n)})(t,e));return Tr(!0===n.exists),new Zi(r,s)}if(e.verify){const r=li(t,e.verify);return new ro(r,n)}return _r()}function vi(t,e){return{documents:[fi(t,e.path)]}}function bi(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=fi(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=fi(t,r.k()),n.structuredQuery.from=[{collectionId:r.M()}]);const s=function(t){if(0===t.length)return;const e=t.map(t=>(function(t){if("=="===t.op){if(Js(t.value))return{unaryFilter:{field:Ti(t.field),op:"IS_NAN"}};if(Qs(t.value))return{unaryFilter:{field:Ti(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Js(t.value))return{unaryFilter:{field:Ti(t.field),op:"IS_NOT_NAN"}};if(Qs(t.value))return{unaryFilter:{field:Ti(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ti(t.field),op:function(t){return ti[t]}(t.op),value:t.value}}})(t));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);s&&(n.structuredQuery.where=s);const i=function(t){if(0!==t.length)return t.map(t=>(function(t){return{field:Ti(t.field),direction:function(t){return Zs[t]}(t.dir)}})(t))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=function(t,e){return t.He||Br(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=Ii(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ii(e.endAt)),n}function Ei(t){let e=di(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Tr(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Ni(t.unaryFilter.field);return xo.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Ni(t.unaryFilter.field);return xo.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Ni(t.unaryFilter.field);return xo.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Ni(t.unaryFilter.field);return xo.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return _r()}}(e)]:void 0!==e.fieldFilter?[function(t){return xo.create(Ni(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return _r()}}(t.fieldFilter.op),t.fieldFilter.value)}(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((t,e)=>t.concat(e)):_r():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(t=>(function(t){return new jo(Ni(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))})(t)));let a=null;n.limit&&(a=function(t){let e;return Br(e="object"==typeof t?t.value:t)?null:e}(n.limit));let u=null;n.startAt&&(u=_i(n.startAt));let c=null;return n.endAt&&(c=_i(n.endAt)),Io(po(e,s,o,i,a,"F",u,c))}function Ii(t){return{before:t.before,values:t.position}}function _i(t){const e=!!t.before,n=t.values||[];return new Uo(n,e)}function Ti(t){return{fieldPath:t.U()}}function Ni(t){return Fr.J(t.fieldPath)}function Ai(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Si{constructor(){this.en=void 0}}function xi(t,e,n){return t instanceof Ci?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof ki?Ri(t,e):t instanceof Li?Pi(t,e):function(t,e){const n=Oi(t,e),r=Ui(n)+Ui(t.Ye);return Ws(n)&&Ws(t.Ye)?ni(r):ri(t.serializer,r)}(t,e)}function Di(t,e,n){return t instanceof ki?Ri(t,e):t instanceof Li?Pi(t,e):n}function Oi(t,e){return t instanceof Vi?Ws(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}class Ci extends Si{}class ki extends Si{constructor(t){super(),this.elements=t}}function Ri(t,e){const n=Mi(e);for(const e of t.elements)n.some(t=>qs(t,e))||n.push(e);return{arrayValue:{values:n}}}class Li extends Si{constructor(t){super(),this.elements=t}}function Pi(t,e){let n=Mi(e);for(const e of t.elements)n=n.filter(t=>!qs(t,e));return{arrayValue:{values:n}}}class Vi extends Si{constructor(t,e){super(),this.serializer=t,this.Ye=e}}function Ui(t){return zs(t.integerValue||t.doubleValue)}function Mi(t){return Xs(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class qi{constructor(t){this.fields=t,t.sort(Fr.C)}nn(t){for(const e of this.fields)if(e.L(t))return!0;return!1}isEqual(t){return Rr(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class Fi{constructor(t,e){this.field=t,this.transform=e}}class ji{constructor(t,e){this.version=t,this.transformResults=e}}class Gi{constructor(t,e){this.updateTime=t,this.exists=e}static tn(){return new Gi}static exists(t){return new Gi(void 0,t)}static updateTime(t){return new Gi(t)}get Xe(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function $i(t,e){return void 0!==t.updateTime?e instanceof uo&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof uo}class Bi{}function zi(t,e,n){return t instanceof Qi?function(t,e,n){return new uo(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof Ji?function(t,e,n){if(!$i(t.Ze,e))return new ho(t.key,n.version);const r=Yi(t,e);return new uo(t.key,n.version,r,{hasCommittedMutations:!0})}(t,e,n):t instanceof Zi?function(t,e,n){if(Tr(null!=n.transformResults),!$i(t.Ze,e))return new ho(t.key,n.version);const r=to(t,e),s=function(t,e,n){const r=[];Tr(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform;let a=null;e instanceof uo&&(a=e.field(i.field)),r.push(Di(o,a,n[s]))}return r}(t.fieldTransforms,e,n.transformResults),i=n.version,o=eo(t,r.data(),s);return new uo(t.key,i,o,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new co(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function Hi(t,e,n,r){return t instanceof Qi?function(t,e){if(!$i(t.Ze,e))return e;const n=Xi(e);return new uo(t.key,n,t.value,{sn:!0})}(t,e):t instanceof Ji?function(t,e){if(!$i(t.Ze,e))return e;const n=Xi(e),r=Yi(t,e);return new uo(t.key,n,r,{sn:!0})}(t,e):t instanceof Zi?function(t,e,n,r){if(!$i(t.Ze,e))return e;const s=to(t,e),i=function(t,e,n,r){const s=[];for(const i of t){const t=i.transform;let o=null;n instanceof uo&&(o=n.field(i.field)),null===o&&r instanceof uo&&(o=r.field(i.field)),s.push(xi(t,o,e))}return s}(t.fieldTransforms,n,e,r),o=eo(t,s.data(),i);return new uo(t.key,s.version,o,{sn:!0})}(t,e,r,n):function(t,e){return $i(t.Ze,e)?new co(t.key,Vr.min()):e}(t,e)}function Ki(t,e){return t instanceof Zi?function(t,e){let n=null;for(const r of t.fieldTransforms){const t=e instanceof uo?e.field(r.field):void 0,s=Oi(r.transform,t||null);null!=s&&(n=null==n?(new io).set(r.field,s):n.set(r.field,s))}return n?n.rn():null}(t,e):null}function Wi(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ze.isEqual(e.Ze)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Je.isEqual(e.Je):2!==t.type||Rr(t.fieldTransforms,t.fieldTransforms,(t,e)=>(function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof ki&&e instanceof ki||t instanceof Li&&e instanceof Li?Rr(t.elements,e.elements,qs):t instanceof Vi&&e instanceof Vi?qs(t.Ye,e.Ye):t instanceof Ci&&e instanceof Ci}(t.transform,e.transform)})(t,e)))}function Xi(t){return t instanceof uo?t.version:Vr.min()}class Qi extends Bi{constructor(t,e,n){super(),this.key=t,this.value=e,this.Ze=n,this.type=0}}class Ji extends Bi{constructor(t,e,n,r){super(),this.key=t,this.data=e,this.Je=n,this.Ze=r,this.type=1}}function Yi(t,e){let n;return function(t,e){const n=new io(e);return t.Je.fields.forEach(e=>{if(!e.$()){const r=t.data.field(e);null!==r?n.set(e,r):n.delete(e)}}),n.rn()}(t,n=e instanceof uo?e.data():so.empty())}class Zi extends Bi{constructor(t,e){super(),this.key=t,this.fieldTransforms=e,this.type=2,this.Ze=Gi.exists(!0)}}function to(t,e){return e}function eo(t,e,n){const r=new io(e);for(let e=0;e<t.fieldTransforms.length;e++){const s=t.fieldTransforms[e];r.set(s.field,n[e])}return r.rn()}class no extends Bi{constructor(t,e){super(),this.key=t,this.Ze=e,this.type=3}}class ro extends Bi{constructor(t,e){super(),this.key=t,this.Ze=e,this.type=4}}class so{constructor(t){this.proto=t}static empty(){return new so({mapValue:{}})}field(t){if(t.$())return this.proto;{let e=this.proto;for(let n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Ys(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.M()])||null}}isEqual(t){return qs(this.proto,t.proto)}}class io{constructor(t=so.empty()){this.on=t,this.an=new Map}set(t,e){return this.cn(t,e),this}delete(t){return this.cn(t,null),this}cn(t,e){let n=this.an;for(let e=0;e<t.length-1;++e){const r=t.get(e);let s=n.get(r);s instanceof Map?n=s:s&&10===Ms(s)?(s=new Map(Object.entries(s.mapValue.fields||{})),n.set(r,s),n=s):(s=new Map,n.set(r,s),n=s)}n.set(t.M(),e)}rn(){const t=this.un(Fr.K(),this.an);return null!=t?new so(t):this.on}un(t,e){let n=!1;const r=this.on.field(t),s=Ys(r)?Object.assign({},r.mapValue.fields):{};return e.forEach((e,r)=>{if(e instanceof Map){const i=this.un(t.child(r),e);null!=i&&(s[r]=i,n=!0)}else null!==e?(s[r]=e,n=!0):s.hasOwnProperty(r)&&(delete s[r],n=!0)}),n?{mapValue:{fields:s}}:null}}function oo(t){const e=[];return Rs(t.fields||{},(t,n)=>{const r=new Fr([t]);if(Ys(n)){const t=oo(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)}),new qi(e)}class ao{constructor(t,e){this.key=t,this.version=e}}class uo extends ao{constructor(t,e,n,r){super(t,e),this.hn=n,this.sn=!!r.sn,this.hasCommittedMutations=!!r.hasCommittedMutations}field(t){return this.hn.field(t)}data(){return this.hn}ln(){return this.hn.proto}isEqual(t){return t instanceof uo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.sn===t.sn&&this.hasCommittedMutations===t.hasCommittedMutations&&this.hn.isEqual(t.hn)}toString(){return`Document(${this.key}, ${this.version}, ${this.hn.toString()}, {hasLocalMutations: ${this.sn}}), {hasCommittedMutations: ${this.hasCommittedMutations}})`}get hasPendingWrites(){return this.sn||this.hasCommittedMutations}}class co extends ao{constructor(t,e,n){super(t,e),this.hasCommittedMutations=!(!n||!n.hasCommittedMutations)}toString(){return`NoDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return this.hasCommittedMutations}isEqual(t){return t instanceof co&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class ho extends ao{toString(){return`UnknownDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return!0}isEqual(t){return t instanceof ho&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}function lo(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new Sr(Ar.INVALID_ARGUMENT,`Type does not match the expected instance. Did you pass '${e.name}' from a different Firestore SDK?`):new Sr(Ar.INVALID_ARGUMENT,`Expected type '${e.name}', but was '${t.constructor.name}'`);return t}class fo{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this._n=n,this.filters=r,this.limit=s,this.fn=i,this.startAt=o,this.endAt=a,this.dn=null,this.wn=null,this.startAt,this.endAt}}function po(t,e,n,r,s,i,o,a){return new fo(t,e,n,r,s,i,o,a)}function go(t){return new fo(t)}function mo(t){return!Br(t.limit)&&"F"===t.fn}function yo(t){return!Br(t.limit)&&"L"===t.fn}function wo(t){return t._n.length>0?t._n[0].field:null}function vo(t){for(const e of t.filters)if(e.En())return e.field;return null}function bo(t){return null!==t.collectionGroup}function Eo(t){const e=lo(t,fo);if(null===e.dn){e.dn=[];const t=vo(e),n=wo(e);if(null!==t&&null===n)t.G()||e.dn.push(new jo(t)),e.dn.push(new jo(Fr.H(),"asc"));else{let t=!1;for(const n of e._n)e.dn.push(n),n.field.G()&&(t=!0);if(!t){const t=e._n.length>0?e._n[e._n.length-1].dir:"asc";e.dn.push(new jo(Fr.H(),t))}}}return e.dn}function Io(t){const e=lo(t,fo);if(!e.wn)if("F"===e.fn)e.wn=Wr(e.path,e.collectionGroup,Eo(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of Eo(e)){const e="desc"===n.dir?"asc":"desc";t.push(new jo(n.field,e))}const n=e.endAt?new Uo(e.endAt.position,!e.endAt.before):null,r=e.startAt?new Uo(e.startAt.position,!e.startAt.before):null;e.wn=Wr(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e.wn}function _o(t,e){return Qr(Io(t),Io(e))&&t.fn===e.fn}function To(t){return`${Xr(Io(t))}|lt:${t.fn}`}function No(t){return`Query(target=${function(t){let e=t.path.U();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>{return`${(e=t).field.U()} ${e.op} ${$s(e.value)}`;var e}).join(", ")}]`),Br(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>(function(t){return`${t.field.U()} (${t.dir})`})(t)).join(", ")}]`),t.startAt&&(e+=", startAt: "+Mo(t.startAt)),t.endAt&&(e+=", endAt: "+Mo(t.endAt)),`Target(${e})`}(Io(t))}; limitType=${t.fn})`}function Ao(t,e){return function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.Z(t.collectionGroup)&&t.path.L(n):jr.tt(t.path)?t.path.isEqual(n):t.path.q(n)}(t,e)&&function(t,e){for(const n of t._n)if(!n.field.G()&&null===e.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!qo(t.startAt,Eo(t),e))&&(!t.endAt||!qo(t.endAt,Eo(t),e))}(t,e)}function So(t){return(e,n)=>{let r=!1;for(const s of Eo(t)){const t=Go(s,e,n);if(0!==t)return t;r=r||s.field.G()}return 0}}class xo extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){if(t.G())return"in"===e||"not-in"===e?this.Tn(t,e,n):new Do(t,e,n);if(Qs(n)){if("=="!==e&&"!="!==e)throw new Sr(Ar.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new xo(t,e,n)}if(Js(n)){if("=="!==e&&"!="!==e)throw new Sr(Ar.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new xo(t,e,n)}return"array-contains"===e?new Ro(t,n):"in"===e?new Lo(t,n):"not-in"===e?new Po(t,n):"array-contains-any"===e?new Vo(t,n):new xo(t,e,n)}static Tn(t,e,n){return"in"===e?new Oo(t,n):new Co(t,n)}matches(t){const e=t.field(this.field);return"!="===this.op?null!==e&&this.In(js(e,this.value)):null!==e&&Ms(this.value)===Ms(e)&&this.In(js(e,this.value))}In(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return _r()}}En(){return["<","<=",">",">=","!="].indexOf(this.op)>=0}}class Do extends xo{constructor(t,e,n){super(t,e,n),this.key=jr.X(n.referenceValue)}matches(t){const e=jr.C(t.key,this.key);return this.In(e)}}class Oo extends xo{constructor(t,e){super(t,"in",e),this.keys=ko("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Co extends xo{constructor(t,e){super(t,"not-in",e),this.keys=ko("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function ko(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>jr.X(t.referenceValue))}class Ro extends xo{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.field(this.field);return Xs(e)&&Fs(e.arrayValue,this.value)}}class Lo extends xo{constructor(t,e){super(t,"in",e)}matches(t){const e=t.field(this.field);return null!==e&&Fs(this.value.arrayValue,e)}}class Po extends xo{constructor(t,e){super(t,"not-in",e)}matches(t){const e=t.field(this.field);return null!==e&&!Fs(this.value.arrayValue,e)}}class Vo extends xo{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.field(this.field);return!(!Xs(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>Fs(this.value.arrayValue,t))}}class Uo{constructor(t,e){this.position=t,this.before=e}}function Mo(t){return`${t.before?"b":"a"}:${t.position.map(t=>$s(t)).join(",")}`}function qo(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.G()?jr.C(jr.X(o.referenceValue),n.key):js(o,n.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function Fo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!qs(t.position[n],e.position[n]))return!1;return!0}class jo{constructor(t,e="asc"){this.field=t,this.dir=e}}function Go(t,e,n){const r=t.field.G()?jr.C(e.key,n.key):function(t,e,n){const r=e.field(t),s=n.field(t);return null!==r&&null!==s?js(r,s):_r()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return _r()}}function $o(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Bo{constructor(t,e,n,r){this.batchId=t,this.mn=e,this.baseMutations=n,this.mutations=r}An(t,e,n){const r=n.Rn;for(let n=0;n<this.mutations.length;n++){const s=this.mutations[n];s.key.isEqual(t)&&(e=zi(s,e,r[n]))}return e}Pn(t,e){for(const n of this.baseMutations)n.key.isEqual(t)&&(e=Hi(n,e,e,this.mn));const n=e;for(const r of this.mutations)r.key.isEqual(t)&&(e=Hi(r,e,n,this.mn));return e}Vn(t){let e=t;return this.mutations.forEach(n=>{const r=this.Pn(n.key,t.get(n.key));r&&(e=e.ft(n.key,r))}),e}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),ys())}isEqual(t){return this.batchId===t.batchId&&Rr(this.mutations,t.mutations,(t,e)=>Wi(t,e))&&Rr(this.baseMutations,t.baseMutations,(t,e)=>Wi(t,e))}}class zo{constructor(t,e,n,r){this.batch=t,this.gn=e,this.Rn=n,this.yn=r}static from(t,e,n){Tr(t.mutations.length===n.length);let r=gs;const s=t.mutations;for(let t=0;t<s.length;t++)r=r.ft(s[t].key,n[t].version);return new zo(t,e,n,r)}}class Ho{constructor(t,e){this.pn=t,this.bn=e,this.vn={}}get(t){const e=this.pn(t),n=this.vn[e];if(void 0!==n)for(const[e,r]of n)if(this.bn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.pn(t),r=this.vn[n];if(void 0!==r){for(let n=0;n<r.length;n++)if(this.bn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e])}else this.vn[n]=[[t,e]]}delete(t){const e=this.pn(t),n=this.vn[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.bn(n[r][0],t))return 1===n.length?delete this.vn[e]:n.splice(r,1),!0;return!1}forEach(t){Rs(this.vn,(e,n)=>{for(const[e,r]of n)t(e,r)})}$(){return Ls(this.vn)}}class Ko{constructor(t){this.Sn=null,this.Dn=null,this.result=void 0,this.error=void 0,this.Cn=!1,this.Nn=!1,t(t=>{this.Cn=!0,this.result=t,this.Sn&&this.Sn(t)},t=>{this.Cn=!0,this.error=t,this.Dn&&this.Dn(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.Nn&&_r(),this.Nn=!0,this.Cn?this.error?this.xn(e,this.error):this.On(t,this.result):new Ko((n,r)=>{this.Sn=(e=>{this.On(t,e).next(n,r)}),this.Dn=(t=>{this.xn(e,t).next(n,r)})})}kn(){return new Promise((t,e)=>{this.next(t,e)})}Fn(t){try{const e=t();return e instanceof Ko?e:Ko.resolve(e)}catch(t){return Ko.reject(t)}}On(t,e){return t?this.Fn(()=>t(e)):Ko.resolve(e)}xn(t,e){return t?this.Fn(()=>t(e)):Ko.reject(e)}static resolve(t){return new Ko((e,n)=>{e(t)})}static reject(t){return new Ko((e,n)=>{n(t)})}static Mn(t){return new Ko((e,n)=>{let r=0,s=0,i=!1;t.forEach(t=>{++r,t.next(()=>{++s,i&&s===r&&e()},t=>n(t))}),i=!0,s===r&&e()})}static $n(t){let e=Ko.resolve(!1);for(const n of t)e=e.next(t=>t?Ko.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,r)=>{n.push(e.call(this,t,r))}),this.Mn(n)}}class Wo{constructor(){this.Ln=new Ho(t=>t.toString(),(t,e)=>t.isEqual(e)),this.qn=!1}set readTime(t){this.Bn=t}get readTime(){return this.Bn}Un(t,e){this.Wn(),this.readTime=e,this.Ln.set(t.key,t)}Kn(t,e){this.Wn(),e&&(this.readTime=e),this.Ln.set(t,null)}Qn(t,e){this.Wn();const n=this.Ln.get(e);return void 0!==n?Ko.resolve(n):this.jn(t,e)}getEntries(t,e){return this.Gn(t,e)}apply(t){return this.Wn(),this.qn=!0,this.zn(t)}Wn(){}}const Xo="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Qo{constructor(){this.Hn=[]}Jn(t){this.Hn.push(t)}Yn(){this.Hn.forEach(t=>t())}}class Jo{constructor(t,e,n){this.Xn=t,this.Zn=e,this.ts=n}es(t,e){return this.Zn.ns(t,e).next(n=>this.ss(t,e,n))}ss(t,e,n){return this.Xn.Qn(t,e).next(t=>{for(const r of n)t=r.Pn(e,t);return t})}rs(t,e,n){let r=fs();return e.forEach((t,e)=>{for(const r of n)e=r.Pn(t,e);r=r.ft(t,e)}),r}os(t,e){return this.Xn.getEntries(t,e).next(e=>this.as(t,e))}as(t,e){return this.Zn.cs(t,e).next(n=>{const r=this.rs(t,e,n);let s=ls();return r.forEach((t,e)=>{e||(e=new co(t,Vr.min())),s=s.ft(t,e)}),s})}us(t,e,n){return function(t){return jr.tt(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.hs(t,e.path):bo(e)?this.ls(t,e,n):this._s(t,e,n)}hs(t,e){return this.es(t,new jr(e)).next(t=>{let e=ps();return t instanceof uo&&(e=e.ft(t.key,t)),e})}ls(t,e,n){const r=e.collectionGroup;let s=ps();return this.ts.fs(t,r).next(i=>Ko.forEach(i,i=>{const o=function(t,e){return new fo(e,null,t._n.slice(),t.filters.slice(),t.limit,t.fn,t.startAt,t.endAt)}(e,i.child(r));return this._s(t,o,n).next(t=>{t.forEach((t,e)=>{s=s.ft(t,e)})})}).next(()=>s))}_s(t,e,n){let r,s;return this.Xn.us(t,e,n).next(n=>(r=n,this.Zn.ds(t,e))).next(e=>(s=e,this.ws(t,s,r).next(t=>{r=t;for(const t of s)for(const e of t.mutations){const n=e.key,s=r.get(n),i=Hi(e,s,s,t.mn);r=i instanceof uo?r.ft(n,i):r.remove(n)}}))).next(()=>(r.forEach((t,n)=>{Ao(e,n)||(r=r.remove(t))}),r))}ws(t,e,n){let r=ys();for(const t of e)for(const e of t.mutations)e instanceof Ji&&null===n.get(e.key)&&(r=r.add(e.key));let s=n;return this.Xn.getEntries(t,r).next(t=>(t.forEach((t,e)=>{null!==e&&e instanceof uo&&(s=s.ft(t,e))}),s))}}class Yo{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.Es=n,this.Ts=r}static Is(t,e){let n=ys(),r=ys();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Yo(t,e.fromCache,n,r)}}class Zo{constructor(t,e){this.previousValue=t,e&&(e.ms=(t=>this.As(t)),this.Rs=(t=>e.Ps(t)))}As(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.Rs&&this.Rs(t),t}}Zo.Vs=-1;class ta{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class ea{constructor(t,e,n=1e3,r=1.5,s=6e4){this.gs=t,this.ys=e,this.ps=n,this.bs=r,this.vs=s,this.Ss=0,this.Ds=null,this.Cs=Date.now(),this.reset()}reset(){this.Ss=0}Ns(){this.Ss=this.vs}xs(t){this.cancel();const e=Math.floor(this.Ss+this.Os()),n=Math.max(0,Date.now()-this.Cs),r=Math.max(0,e-n);r>0&&vr("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ss} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Ds=this.gs.ks(this.ys,r,()=>(this.Cs=Date.now(),t())),this.Ss*=this.bs,this.Ss<this.ps&&(this.Ss=this.ps),this.Ss>this.vs&&(this.Ss=this.vs)}Fs(){null!==this.Ds&&(this.Ds.Ms(),this.Ds=null)}cancel(){null!==this.Ds&&(this.Ds.cancel(),this.Ds=null)}Os(){return(Math.random()-.5)*this.Ss}}class na{constructor(t,e,n){this.name=t,this.version=e,this.$s=n,12.2===na.Ls(r())&&br("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return vr("SimpleDb","Removing database:",t),ua(window.indexedDB.deleteDatabase(t)).kn()}static qs(){if("undefined"==typeof indexedDB)return!1;if(na.Bs())return!0;const t=r(),e=na.Ls(t),n=0<e&&e<10,s=na.Us(t),i=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static Bs(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Ws)}static Ks(t,e){return t.store(e)}static Ls(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Us(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Qs(){return this.db||(vr("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,e)=>{const n=indexedDB.open(this.name,this.version);n.onsuccess=(e=>{const n=e.target.result;t(n)}),n.onblocked=(()=>{e(new sa("Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))}),n.onerror=(t=>{const n=t.target.error;"VersionError"===n.name?e(new Sr(Ar.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):e(new sa(n))}),n.onupgradeneeded=(t=>{vr("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.$s.createOrUpgrade(e,n.transaction,t.oldVersion,this.version).next(()=>{vr("SimpleDb","Database upgrade to version "+this.version+" complete")})})})),this.js&&(this.db.onversionchange=(t=>this.js(t))),this.db}Gs(t){this.js=t,this.db&&(this.db.onversionchange=(e=>t(e)))}async runTransaction(t,e,n){const r="readonly"===t;for(;;){0;try{this.db=await this.Qs();const s=oa.open(this.db,r?"readonly":"readwrite",e),i=n(s).catch(t=>(s.abort(t),Ko.reject(t))).kn();return i.catch(()=>{}),await s.zs,i}catch(t){const e="FirebaseError"!==t.name&&i<3;if(vr("SimpleDb","Transaction failed with error: %s. Retrying: %s.",t.message,e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class ra{constructor(t){this.Hs=t,this.Js=!1,this.Ys=null}get Cn(){return this.Js}get Xs(){return this.Ys}set cursor(t){this.Hs=t}done(){this.Js=!0}Zs(t){this.Ys=t}delete(){return ua(this.Hs.delete())}}class sa extends Sr{constructor(t){super(Ar.UNAVAILABLE,"IndexedDB transaction failed: "+t),this.name="IndexedDbTransactionError"}}function ia(t){return"IndexedDbTransactionError"===t.name}class oa{constructor(t){this.transaction=t,this.aborted=!1,this.ti=new ta,this.transaction.oncomplete=(()=>{this.ti.resolve()}),this.transaction.onabort=(()=>{t.error?this.ti.reject(new sa(t.error)):this.ti.resolve()}),this.transaction.onerror=(t=>{const e=ha(t.target.error);this.ti.reject(new sa(e))})}static open(t,e,n){try{return new oa(t.transaction(n,e))}catch(t){throw new sa(t)}}get zs(){return this.ti.promise}abort(t){t&&this.ti.reject(t),this.aborted||(vr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new aa(e)}}class aa{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(vr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(vr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ua(n)}add(t){return vr("SimpleDb","ADD",this.store.name,t,t),ua(this.store.add(t))}get(t){return ua(this.store.get(t)).next(e=>(void 0===e&&(e=null),vr("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return vr("SimpleDb","DELETE",this.store.name,t),ua(this.store.delete(t))}count(){return vr("SimpleDb","COUNT",this.store.name),ua(this.store.count())}ei(t,e){const n=this.cursor(this.options(t,e)),r=[];return this.ni(n,(t,e)=>{r.push(e)}).next(()=>r)}si(t,e){vr("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.ii=!1;const r=this.cursor(n);return this.ni(r,(t,e,n)=>n.delete())}ri(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.ni(r,e)}oi(t){const e=this.cursor({});return new Ko((n,r)=>{e.onerror=(t=>{const e=ha(t.target.error);r(e)}),e.onsuccess=(e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next(t=>{t?r.continue():n()}):n()})})}ni(t,e){const n=[];return new Ko((r,s)=>{t.onerror=(t=>{s(t.target.error)}),t.onsuccess=(t=>{const s=t.target.result;if(!s)return void r();const i=new ra(s),o=e(s.primaryKey,s.value,i);if(o instanceof Ko){const t=o.catch(t=>(i.done(),Ko.reject(t)));n.push(t)}i.Cn?r():null===i.Xs?s.continue():s.continue(i.Xs)})}).next(()=>Ko.Mn(n))}options(t,e){let n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.ii?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function ua(t){return new Ko((e,n)=>{t.onsuccess=(t=>{const n=t.target.result;e(n)}),t.onerror=(t=>{const e=ha(t.target.error);n(e)})})}let ca=!1;function ha(t){const e=na.Ls(r());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Sr("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ca||(ca=!0,setTimeout(()=>{throw t},0)),t}}return t}function la(){return"undefined"!=typeof window?window:null}function fa(){return"undefined"!=typeof document?document:null}class da{constructor(t,e,n,r,s){this.ai=t,this.ys=e,this.ci=n,this.op=r,this.ui=s,this.hi=new ta,this.then=this.hi.promise.then.bind(this.hi.promise),this.hi.promise.catch(t=>{})}static li(t,e,n,r,s){const i=Date.now()+n,o=new da(t,e,i,r,s);return o.start(n),o}start(t){this._i=setTimeout(()=>this.fi(),t)}Ms(){return this.fi()}cancel(t){null!==this._i&&(this.clearTimeout(),this.hi.reject(new Sr(Ar.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}fi(){this.ai.di(()=>null!==this._i?(this.clearTimeout(),this.op().then(t=>this.hi.resolve(t))):Promise.resolve())}clearTimeout(){null!==this._i&&(this.ui(this),clearTimeout(this._i),this._i=null)}}class pa{constructor(){this.wi=Promise.resolve(),this.Ei=[],this.Ti=!1,this.Ii=[],this.mi=null,this.Ai=!1,this.Ri=[],this.Pi=new ea(this,"async_queue_retry"),this.Vi=(()=>{const t=fa();t&&vr("AsyncQueue","Visibility state changed to  ",t.visibilityState),this.Pi.Fs()});const t=fa();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vi)}get gi(){return this.Ti}di(t){this.enqueue(t)}yi(t){this.pi(),this.bi(t)}vi(){if(!this.Ti){this.Ti=!0;const t=fa();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vi)}}enqueue(t){return this.pi(),this.Ti?new Promise(t=>{}):this.bi(t)}Si(t){this.Ei.push(t),this.di(()=>this.Di())}async Di(){if(0!==this.Ei.length){try{await this.Ei[0](),this.Ei.shift(),this.Pi.reset()}catch(t){if(!ia(t))throw t;vr("AsyncQueue","Operation failed with retryable error: "+t)}this.Ei.length>0&&this.Pi.xs(()=>this.Di())}}bi(t){const e=this.wi.then(()=>(this.Ai=!0,t().catch(t=>{throw this.mi=t,this.Ai=!1,br("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.Ai=!1,t))));return this.wi=e,e}ks(t,e,n){this.pi(),this.Ri.indexOf(t)>-1&&(e=0);const r=da.li(this,t,e,n,t=>this.Ci(t));return this.Ii.push(r),r}pi(){this.mi&&_r()}Ni(){}async xi(){let t;do{t=this.wi,await t}while(t!==this.wi)}Oi(t){for(const e of this.Ii)if(e.ys===t)return!0;return!1}ki(t){return this.xi().then(()=>{this.Ii.sort((t,e)=>t.ci-e.ci);for(const e of this.Ii)if(e.Ms(),"all"!==t&&e.ys===t)break;return this.xi()})}Fi(t){this.Ri.push(t)}Ci(t){const e=this.Ii.indexOf(t);this.Ii.splice(e,1)}}function ga(t,e){if(br("AsyncQueue",`${e}: ${t}`),ia(t))return new Sr(Ar.UNAVAILABLE,`${e}: ${t}`);throw t}function ma([t,e],[n,r]){const s=kr(t,n);return 0===s?kr(e,r):s}class ya{constructor(t){this.Mi=t,this.buffer=new us(ma),this.$i=0}Li(){return++this.$i}qi(t){const e=[t,this.Li()];if(this.buffer.size<this.Mi)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();ma(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}const wa={Bi:!1,Ui:0,Wi:0,Ki:0};class va{constructor(t,e,n){this.Qi=t,this.ji=e,this.Gi=n}static zi(t){return new va(t,va.Hi,va.Ji)}}va.Yi=-1,va.Xi=1048576,va.Zi=41943040,va.Hi=10,va.Ji=1e3,va.tr=new va(va.Zi,va.Hi,va.Ji),va.er=new va(va.Yi,0,0);class ba{constructor(t,e){this.nr=t,this.ai=e,this.sr=!1,this.ir=null}start(t){this.nr.params.Qi!==va.Yi&&this.rr(t)}stop(){this.ir&&(this.ir.cancel(),this.ir=null)}get or(){return null!==this.ir}rr(t){const e=this.sr?3e5:6e4;vr("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.ir=this.ai.ks("lru_garbage_collection",e,async()=>{this.ir=null,this.sr=!0;try{await t.ar(this.nr)}catch(t){ia(t)?vr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Vu(t)}await this.rr(t)})}}class Ea{constructor(t,e){this.cr=t,this.params=e}ur(t,e){return this.cr.hr(t).next(t=>Math.floor(e/100*t))}lr(t,e){if(0===e)return Ko.resolve(Zo.Vs);const n=new ya(e);return this.cr.Me(t,t=>n.qi(t.sequenceNumber)).next(()=>this.cr._r(t,t=>n.qi(t))).next(()=>n.maxValue)}dr(t,e,n){return this.cr.dr(t,e,n)}wr(t,e){return this.cr.wr(t,e)}Er(t,e){return this.params.Qi===va.Yi?(vr("LruGarbageCollector","Garbage collection skipped; disabled"),Ko.resolve(wa)):this.Tr(t).next(n=>n<this.params.Qi?(vr("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold `+this.params.Qi),wa):this.Ir(t,e))}Tr(t){return this.cr.Tr(t)}Ir(t,e){let n,r,s,i,o,a,c;const h=Date.now();return this.ur(t,this.params.ji).next(e=>(e>this.params.Gi?(vr("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.Gi} from `+e),r=this.params.Gi):r=e,i=Date.now(),this.lr(t,r))).next(r=>(n=r,o=Date.now(),this.dr(t,n,e))).next(e=>(s=e,a=Date.now(),this.wr(t,n))).next(t=>(c=Date.now(),wr()<=u.DEBUG&&vr("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-h}ms\n\tDetermined least recently used ${r} in `+(o-i)+"ms\n"+`\tRemoved ${s} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-h}ms`),Ko.resolve({Bi:!0,Ui:r,Wi:s,Ki:t})))}}function Ia(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Ta(e)),e=_a(t.get(n),e);return Ta(e)}function _a(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function Ta(t){return t+""}function Na(t){const e=t.length;if(Tr(e>=2),2===e)return Tr(""===t.charAt(0)&&""===t.charAt(1)),Mr.K();const n=e-2,r=[];let s="";for(let n=0;n<e;){const e=t.indexOf("",n);switch((e<0||e>i)&&_r(),t.charAt(e+1)){case"":const i=t.substring(n,e);let o;0===s.length?o=i:(o=s+=i,s=""),r.push(o);break;case"":s+=t.substring(n,e),s+="\0";break;case"":s+=t.substring(n,e+1);break;default:_r()}n=e+2}return new Mr(r)}class Aa{constructor(t){this.mr=t}}function Sa(t,e){if(e.document)return function(t,e,n){const r=li(t,e.name),s=ai(e.updateTime),i=new so({mapValue:{fields:e.fields}});return new uo(r,s,i,{hasCommittedMutations:!!n})}(t.mr,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=jr.et(e.noDocument.path),n=ka(e.noDocument.readTime);return new co(t,n,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){const t=jr.et(e.unknownDocument.path),n=ka(e.unknownDocument.version);return new ho(t,n)}return _r()}function xa(t,e,n){const r=Da(n),s=e.key.path.k().B();if(e instanceof uo){const n=function(t,e){return{name:hi(t,e.key),fields:e.ln().mapValue.fields,updateTime:ii(t,e.version.S())}}(t.mr,e),i=e.hasCommittedMutations;return new ru(null,null,n,i,r,s)}if(e instanceof co){const t=e.key.path.B(),n=Ca(e.version),i=e.hasCommittedMutations;return new ru(null,new eu(t,n),null,i,r,s)}if(e instanceof ho){const t=e.key.path.B(),n=Ca(e.version);return new ru(new nu(t,n),null,null,!0,r,s)}return _r()}function Da(t){const e=t.S();return[e.seconds,e.nanoseconds]}function Oa(t){const e=new Pr(t[0],t[1]);return Vr.g(e)}function Ca(t){const e=t.S();return new Qa(e.seconds,e.nanoseconds)}function ka(t){const e=new Pr(t.seconds,t.nanoseconds);return Vr.g(e)}function Ra(t,e){const n=(e.baseMutations||[]).map(e=>wi(t.mr,e)),r=e.mutations.map(e=>wi(t.mr,e)),s=Pr.fromMillis(e.localWriteTimeMs);return new Bo(e.batchId,s,n,r)}function La(t){const e=ka(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?ka(t.lastLimboFreeSnapshotVersion):Vr.min();let r;var s;return void 0!==t.query.documents?(Tr(1===(s=t.query).documents.length),r=Io(go(di(s.documents[0])))):r=Ei(t.query),new Zr(r,t.targetId,0,t.lastListenSequenceNumber,e,n,Yr.fromBase64String(t.resumeToken))}function Pa(t,e){const n=Ca(e.ut),r=Ca(e.lastLimboFreeSnapshotVersion);let s;s=Jr(e.target)?vi(t.mr,e.target):bi(t.mr,e.target);const i=e.resumeToken.toBase64();return new iu(e.targetId,Xr(e.target),n,i,e.sequenceNumber,r,s)}class Va{constructor(t,e,n,r){this.userId=t,this.serializer=e,this.ts=n,this.Ar=r,this.Rr={}}static Pr(t,e,n,r){Tr(""!==t.uid);const s=t.t()?t.uid:"";return new Va(s,e,n,r)}Vr(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return qa(t).ri({index:Za.userMutationsIndex,range:n},(t,n,r)=>{e=!1,r.done()}).next(()=>e)}gr(t,e,n,r){const s=Fa(t),i=qa(t);return i.add({}).next(o=>{Tr("number"==typeof o);const a=new Bo(o,e,n,r),u=function(t,e,n){const r=n.baseMutations.map(e=>yi(t.mr,e)),s=n.mutations.map(e=>yi(t.mr,e));return new Za(e,n.batchId,n.mn.toMillis(),r,s)}(this.serializer,this.userId,a),c=[];let h=new us((t,e)=>kr(t.U(),e.U()));for(const t of r){const e=tu.key(this.userId,t.key.path,o);h=h.add(t.key.path.k()),c.push(i.put(u)),c.push(s.put(e,tu.PLACEHOLDER))}return h.forEach(e=>{c.push(this.ts.yr(t,e))}),t.Jn(()=>{this.Rr[o]=a.keys()}),Ko.Mn(c).next(()=>a)})}pr(t,e){return qa(t).get(e).next(t=>t?(Tr(t.userId===this.userId),Ra(this.serializer,t)):null)}br(t,e){return this.Rr[e]?Ko.resolve(this.Rr[e]):this.pr(t,e).next(t=>{if(t){const n=t.keys();return this.Rr[e]=n,n}return null})}vr(t,e){const n=e+1,r=IDBKeyRange.lowerBound([this.userId,n]);let s=null;return qa(t).ri({index:Za.userMutationsIndex,range:r},(t,e,r)=>{e.userId===this.userId&&(Tr(e.batchId>=n),s=Ra(this.serializer,e)),r.done()}).next(()=>s)}Sr(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return qa(t).ri({index:Za.userMutationsIndex,range:e,reverse:!0},(t,e,r)=>{n=e.batchId,r.done()}).next(()=>n)}Dr(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return qa(t).ei(Za.userMutationsIndex,e).next(t=>t.map(t=>Ra(this.serializer,t)))}ns(t,e){const n=tu.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(n),s=[];return Fa(t).ri({range:r},(n,r,i)=>{const[o,a,u]=n,c=Na(a);if(o===this.userId&&e.path.isEqual(c))return qa(t).get(u).next(t=>{if(!t)throw _r();Tr(t.userId===this.userId),s.push(Ra(this.serializer,t))});i.done()}).next(()=>s)}cs(t,e){let n=new us(kr);const r=[];return e.forEach(e=>{const s=tu.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(s),o=Fa(t).ri({range:i},(t,r,s)=>{const[i,o,a]=t,u=Na(o);i===this.userId&&e.path.isEqual(u)?n=n.add(a):s.done()});r.push(o)}),Ko.Mn(r).next(()=>this.Cr(t,n))}ds(t,e){const n=e.path,r=n.length+1,s=tu.prefixForPath(this.userId,n),i=IDBKeyRange.lowerBound(s);let o=new us(kr);return Fa(t).ri({range:i},(t,e,s)=>{const[i,a,u]=t,c=Na(a);i===this.userId&&n.L(c)?c.length===r&&(o=o.add(u)):s.done()}).next(()=>this.Cr(t,o))}Cr(t,e){const n=[],r=[];return e.forEach(e=>{r.push(qa(t).get(e).next(t=>{if(null===t)throw _r();Tr(t.userId===this.userId),n.push(Ra(this.serializer,t))}))}),Ko.Mn(r).next(()=>n)}Nr(t,e){return Ma(t.xr,this.userId,e).next(n=>(t.Jn(()=>{this.Or(e.batchId)}),Ko.forEach(n,e=>this.Ar.kr(t,e))))}Or(t){delete this.Rr[t]}Fr(t){return this.Vr(t).next(e=>{if(!e)return Ko.resolve();const n=IDBKeyRange.lowerBound(tu.prefixForUser(this.userId)),r=[];return Fa(t).ri({range:n},(t,e,n)=>{if(t[0]===this.userId){const e=Na(t[1]);r.push(e)}else n.done()}).next(()=>{Tr(0===r.length)})})}Mr(t,e){return Ua(t,this.userId,e)}$r(t){return ja(t).get(this.userId).next(t=>t||new Ya(this.userId,-1,""))}}function Ua(t,e,n){const r=tu.prefixForPath(e,n.path),s=r[1],i=IDBKeyRange.lowerBound(r);let o=!1;return Fa(t).ri({range:i,ii:!0},(t,n,r)=>{const[i,a,u]=t;i===e&&a===s&&(o=!0),r.done()}).next(()=>o)}function Ma(t,e,n){const r=t.store(Za.store),s=t.store(tu.store),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const u=r.ri({range:o},(t,e,n)=>(a++,n.delete()));i.push(u.next(()=>{Tr(1===a)}));const c=[];for(const t of n.mutations){const r=tu.key(e,t.key.path,n.batchId);i.push(s.delete(r)),c.push(t.key)}return Ko.Mn(i).next(()=>c)}function qa(t){return Eu.Ks(t,Za.store)}function Fa(t){return Eu.Ks(t,tu.store)}function ja(t){return Eu.Ks(t,Ya.store)}class Ga{constructor(t,e){this.serializer=t,this.ts=e}Un(t,e,n){return Ba(t).put(za(e),n)}Kn(t,e){const n=Ba(t),r=za(e);return n.delete(r)}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.Lr(t,n)))}Qn(t,e){return Ba(t).get(za(e)).next(t=>this.qr(t))}Br(t,e){return Ba(t).get(za(e)).next(t=>{const e=this.qr(t);return e?{Ur:e,size:Ha(t)}:null})}getEntries(t,e){let n=fs();return this.Wr(t,e,(t,e)=>{const r=this.qr(e);n=n.ft(t,r)}).next(()=>n)}Kr(t,e){let n=fs(),r=new is(jr.C);return this.Wr(t,e,(t,e)=>{const s=this.qr(e);s?(n=n.ft(t,s),r=r.ft(t,Ha(e))):(n=n.ft(t,null),r=r.ft(t,0))}).next(()=>({Qr:n,jr:r}))}Wr(t,e,n){if(e.$())return Ko.resolve();const r=IDBKeyRange.bound(e.first().path.B(),e.last().path.B()),s=e.At();let i=s.pt();return Ba(t).ri({range:r},(t,e,r)=>{const o=jr.et(t);for(;i&&jr.C(i,o)<0;)n(i,null),i=s.pt();i&&i.isEqual(o)&&(n(i,e),i=s.bt()?s.pt():null),i?r.Zs(i.path.B()):r.done()}).next(()=>{for(;i;)n(i,null),i=s.bt()?s.pt():null})}us(t,e,n){let r=ps();const s=e.path.length+1,i={};if(n.isEqual(Vr.min())){const t=e.path.B();i.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.B(),r=Da(n);i.range=IDBKeyRange.lowerBound([t,r],!0),i.index=ru.collectionReadTimeIndex}return Ba(t).ri(i,(t,n,i)=>{if(t.length!==s)return;const o=Sa(this.serializer,n);e.path.L(o.key.path)?o instanceof uo&&Ao(e,o)&&(r=r.ft(o.key,o)):i.done()}).next(()=>r)}Gr(t,e){let n=ls(),r=Da(e);const s=Ba(t),i=IDBKeyRange.lowerBound(r,!0);return s.ri({index:ru.readTimeIndex,range:i},(t,e)=>{const s=Sa(this.serializer,e);n=n.ft(s.key,s),r=e.readTime}).next(()=>({zr:n,readTime:Oa(r)}))}Hr(t){const e=Ba(t);let n=Vr.min();return e.ri({index:ru.readTimeIndex,reverse:!0},(t,e,r)=>{e.readTime&&(n=Oa(e.readTime)),r.done()}).next(()=>n)}Jr(t){return new Ga.Yr(this,!!t&&t.Xr)}Zr(t){return this.getMetadata(t).next(t=>t.byteSize)}getMetadata(t){return $a(t).get(su.key).next(t=>(Tr(!!t),t))}Lr(t,e){return $a(t).put(su.key,e)}qr(t){if(t){const e=Sa(this.serializer,t);return e instanceof co&&e.version.isEqual(Vr.min())?null:e}return null}}function $a(t){return Eu.Ks(t,su.store)}function Ba(t){return Eu.Ks(t,ru.store)}function za(t){return t.path.B()}function Ha(t){let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw _r();e=t.noDocument}return JSON.stringify(e).length}Ga.Yr=class extends Wo{constructor(t,e){super(),this.to=t,this.Xr=e,this.eo=new Ho(t=>t.toString(),(t,e)=>t.isEqual(e))}zn(t){const e=[];let n=0,r=new us((t,e)=>kr(t.U(),e.U()));return this.Ln.forEach((s,i)=>{const o=this.eo.get(s);if(i){const a=xa(this.to.serializer,i,this.readTime);r=r.add(s.path.k());const u=Ha(a);n+=u-o,e.push(this.to.Un(t,s,a))}else if(n-=o,this.Xr){const n=xa(this.to.serializer,new co(s,Vr.min()),this.readTime);e.push(this.to.Un(t,s,n))}else e.push(this.to.Kn(t,s))}),r.forEach(n=>{e.push(this.to.ts.yr(t,n))}),e.push(this.to.updateMetadata(t,n)),Ko.Mn(e)}jn(t,e){return this.to.Br(t,e).next(t=>null===t?(this.eo.set(e,0),null):(this.eo.set(e,t.size),t.Ur))}Gn(t,e){return this.to.Kr(t,e).next(({Qr:t,jr:e})=>(e.forEach((t,e)=>{this.eo.set(t,e)}),t))}};class Ka{constructor(){this.no=new Wa}yr(t,e){return this.no.add(e),Ko.resolve()}fs(t,e){return Ko.resolve(this.no.getEntries(e))}}class Wa{constructor(){this.index={}}add(t){const e=t.M(),n=t.k(),r=this.index[e]||new us(Mr.C),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.M(),n=t.k(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new us(Mr.C)).B()}}class Xa{constructor(t){this.serializer=t}createOrUpgrade(t,e,n,r){Tr(n<r&&n>=0&&r<=10);const s=new oa(e);n<1&&r>=1&&(function(t){t.createObjectStore(Ja.store)}(t),function(t){t.createObjectStore(Ya.store,{keyPath:Ya.keyPath}),t.createObjectStore(Za.store,{keyPath:Za.keyPath,autoIncrement:!0}).createIndex(Za.userMutationsIndex,Za.userMutationsKeyPath,{unique:!0}),t.createObjectStore(tu.store)}(t),cu(t),function(t){t.createObjectStore(ru.store)}(t));let i=Ko.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(ou.store),t.deleteObjectStore(iu.store),t.deleteObjectStore(au.store)}(t),cu(t)),i=i.next(()=>(function(t){const e=s.store(au.store),n=new au(0,0,Vr.min().S(),0);return e.put(au.key,n)})())),n<4&&r>=4&&(0!==n&&(i=i.next(()=>(function(t,e){return e.store(Za.store).ei().next(n=>{t.deleteObjectStore(Za.store),t.createObjectStore(Za.store,{keyPath:Za.keyPath,autoIncrement:!0}).createIndex(Za.userMutationsIndex,Za.userMutationsKeyPath,{unique:!0});const r=e.store(Za.store),s=n.map(t=>r.put(t));return Ko.Mn(s)})})(t,s))),i=i.next(()=>{!function(t){t.createObjectStore(hu.store,{keyPath:hu.keyPath})}(t)})),n<5&&r>=5&&(i=i.next(()=>this.removeAcknowledgedMutations(s))),n<6&&r>=6&&(i=i.next(()=>((function(t){t.createObjectStore(su.store)})(t),this.addDocumentGlobal(s)))),n<7&&r>=7&&(i=i.next(()=>this.ensureSequenceNumbers(s))),n<8&&r>=8&&(i=i.next(()=>this.createCollectionParentIndex(t,s))),n<9&&r>=9&&(i=i.next(()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(ru.store);e.createIndex(ru.readTimeIndex,ru.readTimeIndexPath,{unique:!1}),e.createIndex(ru.collectionReadTimeIndex,ru.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(i=i.next(()=>this.rewriteCanonicalIds(s))),i}addDocumentGlobal(t){let e=0;return t.store(ru.store).ri((t,n)=>{e+=Ha(n)}).next(()=>{const n=new su(e);return t.store(su.store).put(su.key,n)})}removeAcknowledgedMutations(t){const e=t.store(Ya.store),n=t.store(Za.store);return e.ei().next(e=>Ko.forEach(e,e=>{const r=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.ei(Za.userMutationsIndex,r).next(n=>Ko.forEach(n,n=>{Tr(n.userId===e.userId);const r=Ra(this.serializer,n);return Ma(t,e.userId,r).next(()=>{})}))}))}ensureSequenceNumbers(t){const e=t.store(ou.store),n=t.store(ru.store);return t.store(au.store).get(au.key).next(t=>{const r=[];return n.ri((n,s)=>{const i=new Mr(n),o=function(t){return[0,Ia(i)]}();r.push(e.get(o).next(n=>n?Ko.resolve():(n=>e.put(new ou(0,Ia(n),t.highestListenSequenceNumber)))(i)))}).next(()=>Ko.Mn(r))})}createCollectionParentIndex(t,e){t.createObjectStore(uu.store,{keyPath:uu.keyPath});const n=e.store(uu.store),r=new Wa,s=t=>{if(r.add(t)){const e=t.M(),r=t.k();return n.put({collectionId:e,parent:Ia(r)})}};return e.store(ru.store).ri({ii:!0},(t,e)=>{const n=new Mr(t);return s(n.k())}).next(()=>e.store(tu.store).ri({ii:!0},([t,e,n],r)=>{const i=Na(e);return s(i.k())}))}rewriteCanonicalIds(t){const e=t.store(iu.store);return e.ri((t,n)=>{const r=La(n),s=Pa(this.serializer,r);return e.put(s)})}}class Qa{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class Ja{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}Ja.store="owner",Ja.key="owner";class Ya{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}Ya.store="mutationQueues",Ya.keyPath="userId";class Za{constructor(t,e,n,r,s){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=s}}Za.store="mutations",Za.keyPath="batchId",Za.userMutationsIndex="userMutationsIndex",Za.userMutationsKeyPath=["userId","batchId"];class tu{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,Ia(e)]}static key(t,e,n){return[t,Ia(e),n]}}tu.store="documentMutations",tu.PLACEHOLDER=new tu;class eu{constructor(t,e){this.path=t,this.readTime=e}}class nu{constructor(t,e){this.path=t,this.version=e}}class ru{constructor(t,e,n,r,s,i){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=s,this.parentPath=i}}ru.store="remoteDocuments",ru.readTimeIndex="readTimeIndex",ru.readTimeIndexPath="readTime",ru.collectionReadTimeIndex="collectionReadTimeIndex",ru.collectionReadTimeIndexPath=["parentPath","readTime"];class su{constructor(t){this.byteSize=t}}su.store="remoteDocumentGlobal",su.key="remoteDocumentGlobalKey";class iu{constructor(t,e,n,r,s,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=s,this.lastLimboFreeSnapshotVersion=i,this.query=o}}iu.store="targets",iu.keyPath="targetId",iu.queryTargetsIndexName="queryTargetsIndex",iu.queryTargetsKeyPath=["canonicalId","targetId"];class ou{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}ou.store="targetDocuments",ou.keyPath=["targetId","path"],ou.documentTargetsIndex="documentTargetsIndex",ou.documentTargetsKeyPath=["path","targetId"];class au{constructor(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}}au.key="targetGlobalKey",au.store="targetGlobal";class uu{constructor(t,e){this.collectionId=t,this.parent=e}}function cu(t){t.createObjectStore(ou.store,{keyPath:ou.keyPath}).createIndex(ou.documentTargetsIndex,ou.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(iu.store,{keyPath:iu.keyPath}).createIndex(iu.queryTargetsIndexName,iu.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(au.store)}uu.store="collectionParents",uu.keyPath=["collectionId","parent"];class hu{constructor(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r}}hu.store="clientMetadata",hu.keyPath="clientId";const lu=[...[...[...[Ya.store,Za.store,tu.store,ru.store,iu.store,Ja.store,au.store,ou.store],hu.store],su.store],uu.store];class fu{constructor(){this.so=new Wa}yr(t,e){if(!this.so.has(e)){const n=e.M(),r=e.k();t.Jn(()=>{this.so.add(e)});const s={collectionId:n,parent:Ia(r)};return du(t).put(s)}return Ko.resolve()}fs(t,e){const n=[],r=IDBKeyRange.bound([e,""],[Lr(e),""],!1,!0);return du(t).ei(r).next(t=>{for(const r of t){if(r.collectionId!==e)break;n.push(Na(r.parent))}return n})}}function du(t){return Eu.Ks(t,uu.store)}class pu{constructor(t){this.io=t}next(){return this.io+=2,this.io}static ro(){return new pu(0)}static oo(){return new pu(-1)}}class gu{constructor(t,e){this.Ar=t,this.serializer=e}ao(t){return this.co(t).next(e=>{const n=new pu(e.highestTargetId);return e.highestTargetId=n.next(),this.uo(t,e).next(()=>e.highestTargetId)})}ho(t){return this.co(t).next(t=>Vr.g(new Pr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}lo(t){return this.co(t).next(t=>t.highestListenSequenceNumber)}_o(t,e,n){return this.co(t).next(r=>(r.highestListenSequenceNumber=e,n&&(r.lastRemoteSnapshotVersion=n.S()),e>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=e),this.uo(t,r)))}fo(t,e){return this.do(t,e).next(()=>this.co(t).next(n=>(n.targetCount+=1,this.wo(e,n),this.uo(t,n))))}Eo(t,e){return this.do(t,e)}To(t,e){return this.Io(t,e.targetId).next(()=>mu(t).delete(e.targetId)).next(()=>this.co(t)).next(e=>(Tr(e.targetCount>0),e.targetCount-=1,this.uo(t,e)))}dr(t,e,n){let r=0;const s=[];return mu(t).ri((i,o)=>{const a=La(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r++,s.push(this.To(t,a)))}).next(()=>Ko.Mn(s)).next(()=>r)}Me(t,e){return mu(t).ri((t,n)=>{const r=La(n);e(r)})}co(t){return yu(t).get(au.key).next(t=>(Tr(null!==t),t))}uo(t,e){return yu(t).put(au.key,e)}do(t,e){return mu(t).put(Pa(this.serializer,e))}wo(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}mo(t){return this.co(t).next(t=>t.targetCount)}Ao(t,e){const n=Xr(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let s=null;return mu(t).ri({range:r,index:iu.queryTargetsIndexName},(t,n,r)=>{const i=La(n);Qr(e,i.target)&&(s=i,r.done())}).next(()=>s)}Ro(t,e,n){const r=[],s=wu(t);return e.forEach(e=>{const i=Ia(e.path);r.push(s.put(new ou(n,i))),r.push(this.Ar.Po(t,n,e))}),Ko.Mn(r)}Vo(t,e,n){const r=wu(t);return Ko.forEach(e,e=>{const s=Ia(e.path);return Ko.Mn([r.delete([n,s]),this.Ar.yo(t,n,e)])})}Io(t,e){const n=wu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)}po(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),r=wu(t);let s=ys();return r.ri({range:n,ii:!0},(t,e,n)=>{const r=Na(t[1]),i=new jr(r);s=s.add(i)}).next(()=>s)}Mr(t,e){const n=Ia(e.path),r=IDBKeyRange.bound([n],[Lr(n)],!1,!0);let s=0;return wu(t).ri({index:ou.documentTargetsIndex,ii:!0,range:r},([t,e],n,r)=>{0!==t&&(s++,r.done())}).next(()=>s>0)}ze(t,e){return mu(t).get(e).next(t=>t?La(t):null)}}function mu(t){return Eu.Ks(t,iu.store)}function yu(t){return Eu.Ks(t,au.store)}function wu(t){return Eu.Ks(t,ou.store)}const vu="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class bu extends Qo{constructor(t,e){super(),this.xr=t,this.bo=e}}class Eu{constructor(t,e,n,r,s,i,o,a,u,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.gs=s,this.window=i,this.document=o,this.vo=u,this.So=c,this.Do=null,this.Co=!1,this.isPrimary=!1,this.networkEnabled=!0,this.No=null,this.inForeground=!1,this.xo=null,this.Oo=null,this.ko=Number.NEGATIVE_INFINITY,this.Fo=(t=>Promise.resolve()),!Eu.qs())throw new Sr(Ar.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Ar=new Tu(this,r),this.Mo=e+"main",this.serializer=new Aa(a),this.$o=new na(this.Mo,10,new Xa(this.serializer)),this.Lo=new gu(this.Ar,this.serializer),this.ts=new fu,this.Xn=new Ga(this.serializer,this.ts),this.window&&this.window.localStorage?this.qo=this.window.localStorage:(this.qo=null,!1===c&&br("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}static Ks(t,e){if(t instanceof bu)return na.Ks(t.xr,e);throw _r()}start(){return this.Bo().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Sr(Ar.FAILED_PRECONDITION,vu);return this.Uo(),this.Wo(),this.Ko(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Lo.lo(t))}).then(t=>{this.Do=new Zo(t,this.vo)}).then(()=>{this.Co=!0}).catch(t=>(this.$o&&this.$o.close(),Promise.reject(t)))}Qo(t){return this.Fo=(async e=>{if(this.or)return t(e)}),t(this.isPrimary)}jo(t){this.$o.Gs(async e=>{null===e.newVersion&&await t()})}Go(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.gs.di(async()=>{this.or&&await this.Bo()}))}Bo(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>_u(t).put(new hu(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.zo(t).next(t=>{t||(this.isPrimary=!1,this.gs.Si(()=>this.Fo(!1)))})}).next(()=>this.Ho(t)).next(e=>this.isPrimary&&!e?this.Jo(t).next(()=>!1):!!e&&this.Yo(t).next(()=>!0))).catch(t=>{if(ia(t))return vr("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return vr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.gs.Si(()=>this.Fo(t)),this.isPrimary=t})}zo(t){return Iu(t).get(Ja.key).next(t=>Ko.resolve(this.Xo(t)))}Zo(t){return _u(t).delete(this.clientId)}async ta(){if(this.isPrimary&&!this.ea(this.ko,18e5)){this.ko=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const e=Eu.Ks(t,hu.store);return e.ei().next(t=>{const n=this.na(t,18e5),r=t.filter(t=>-1===n.indexOf(t));return Ko.forEach(r,t=>e.delete(t.clientId)).next(()=>r)})}).catch(()=>[]);if(this.qo)for(const e of t)this.qo.removeItem(this.sa(e.clientId))}}Ko(){this.Oo=this.gs.ks("client_metadata_refresh",4e3,()=>this.Bo().then(()=>this.ta()).then(()=>this.Ko()))}Xo(t){return!!t&&t.ownerId===this.clientId}Ho(t){return this.So?Ko.resolve(!0):Iu(t).get(Ja.key).next(e=>{if(null!==e&&this.ea(e.leaseTimestampMs,5e3)&&!this.ia(e.ownerId)){if(this.Xo(e)&&this.networkEnabled)return!0;if(!this.Xo(e)){if(!e.allowTabSynchronization)throw new Sr(Ar.FAILED_PRECONDITION,vu);return!1}}return!(!this.networkEnabled||!this.inForeground)||_u(t).ei().next(t=>void 0===this.na(t,5e3).find(t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,r=this.networkEnabled===t.networkEnabled;if(e||n&&r)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&vr("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async ra(){this.Co=!1,this.oa(),this.Oo&&(this.Oo.cancel(),this.Oo=null),this.aa(),this.ca(),await this.$o.runTransaction("readwrite",[Ja.store,hu.store],t=>{const e=new bu(t,Zo.Vs);return this.Jo(e).next(()=>this.Zo(e))}),this.$o.close(),this.ua()}na(t,e){return t.filter(t=>this.ea(t.updateTimeMs,e)&&!this.ia(t.clientId))}ha(){return this.runTransaction("getActiveClients","readonly",t=>_u(t).ei().next(t=>this.na(t,18e5).map(t=>t.clientId)))}get or(){return this.Co}la(t){return Va.Pr(t,this.serializer,this.ts,this.Ar)}_a(){return this.Lo}fa(){return this.Xn}da(){return this.ts}runTransaction(t,e,n){vr("IndexedDbPersistence","Starting transaction:",t);const r="readonly"===e?"readonly":"readwrite";let s;return this.$o.runTransaction(r,lu,r=>(s=new bu(r,this.Do?this.Do.next():Zo.Vs),"readwrite-primary"===e?this.zo(s).next(t=>!!t||this.Ho(s)).next(e=>{if(!e)throw br(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.gs.Si(()=>this.Fo(!1)),new Sr(Ar.FAILED_PRECONDITION,Xo);return n(s)}).next(t=>this.Yo(s).next(()=>t)):this.wa(s).next(()=>n(s)))).then(t=>(s.Yn(),t))}wa(t){return Iu(t).get(Ja.key).next(t=>{if(null!==t&&this.ea(t.leaseTimestampMs,5e3)&&!this.ia(t.ownerId)&&!this.Xo(t)&&!(this.So||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Sr(Ar.FAILED_PRECONDITION,vu)})}Yo(t){const e=new Ja(this.clientId,this.allowTabSynchronization,Date.now());return Iu(t).put(Ja.key,e)}static qs(){return na.qs()}Jo(t){const e=Iu(t);return e.get(Ja.key).next(t=>this.Xo(t)?(vr("IndexedDbPersistence","Releasing primary lease."),e.delete(Ja.key)):Ko.resolve())}ea(t,e){const n=Date.now();return!(t<n-e||t>n&&(br(`Detected an update time that is in the future: ${t} > ${n}`),1))}Uo(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.xo=(()=>{this.gs.di(()=>(this.inForeground="visible"===this.document.visibilityState,this.Bo()))}),this.document.addEventListener("visibilitychange",this.xo),this.inForeground="visible"===this.document.visibilityState)}aa(){this.xo&&(this.document.removeEventListener("visibilitychange",this.xo),this.xo=null)}Wo(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.No=(()=>{this.oa(),this.gs.di(()=>this.ra())}),this.window.addEventListener("unload",this.No))}ca(){this.No&&(this.window.removeEventListener("unload",this.No),this.No=null)}ia(t){var e;try{const n=null!==(null===(e=this.qo)||void 0===e?void 0:e.getItem(this.sa(t)));return vr("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return br("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}oa(){if(this.qo)try{this.qo.setItem(this.sa(this.clientId),String(Date.now()))}catch(t){br("Failed to set zombie client id.",t)}}ua(){if(this.qo)try{this.qo.removeItem(this.sa(this.clientId))}catch(t){}}sa(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Iu(t){return Eu.Ks(t,Ja.store)}function _u(t){return Eu.Ks(t,hu.store)}class Tu{constructor(t,e){this.db=t,this.nr=new Ea(this,e)}hr(t){const e=this.Ea(t);return this.db._a().mo(t).next(t=>e.next(e=>t+e))}Ea(t){let e=0;return this._r(t,t=>{e++}).next(()=>e)}Me(t,e){return this.db._a().Me(t,e)}_r(t,e){return this.Ta(t,(t,n)=>e(n))}Po(t,e,n){return Nu(t,n)}yo(t,e,n){return Nu(t,n)}dr(t,e,n){return this.db._a().dr(t,e,n)}kr(t,e){return Nu(t,e)}Ia(t,e){return function(t,e){let n=!1;return ja(t).oi(r=>Ua(t,r,e).next(t=>(t&&(n=!0),Ko.resolve(!t)))).next(()=>n)}(t,e)}wr(t,e){const n=this.db.fa().Jr(),r=[];let s=0;return this.Ta(t,(i,o)=>{if(o<=e){const e=this.Ia(t,i).next(e=>{if(!e)return s++,n.Qn(t,i).next(()=>(n.Kn(i),wu(t).delete([0,Ia(i.path)])))});r.push(e)}}).next(()=>Ko.Mn(r)).next(()=>n.apply(t)).next(()=>s)}removeTarget(t,e){const n=e.ht(t.bo);return this.db._a().Eo(t,n)}ma(t,e){return Nu(t,e)}Ta(t,e){const n=wu(t);let r,s=Zo.Vs;return n.ri({index:ou.documentTargetsIndex},([t,n],{path:i,sequenceNumber:o})=>{0===t?(s!==Zo.Vs&&e(new jr(Na(r)),s),s=o,r=i):s=Zo.Vs}).next(()=>{s!==Zo.Vs&&e(new jr(Na(r)),s)})}Tr(t){return this.db.fa().Zr(t)}}function Nu(t,e){return wu(t).put(function(t,e){return new ou(0,Ia(t.path),e)}(e,t.bo))}function Au(t,e){let n=t.projectId;return t.st||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}async function Su(t){if(!na.qs())return Promise.resolve();const e=t+"main";await na.delete(e)}class xu{constructor(t,e,n){this.persistence=t,this.Aa=e,this.Ra=new is(kr),this.Pa=new Ho(t=>Xr(t),Qr),this.Va=Vr.min(),this.Zn=t.la(n),this.ga=t.fa(),this.Lo=t._a(),this.ya=new Jo(this.ga,this.Zn,this.persistence.da()),this.Aa.pa(this.ya)}ar(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.Er(e,this.Ra))}}async function Du(t,e){const n=Nr(t);let r=n.Zn,s=n.ya;const i=await n.persistence.runTransaction("Handle user change","readonly",t=>{let i;return n.Zn.Dr(t).next(o=>(i=o,r=n.persistence.la(e),s=new Jo(n.ga,r,n.persistence.da()),r.Dr(t))).next(e=>{const n=[],r=[];let o=ys();for(const t of i){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return s.os(t,o).next(t=>({ba:t,va:n,Sa:r}))})});return n.Zn=r,n.ya=s,n.Aa.pa(n.ya),i}function Ou(t){const e=Nr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Lo.ho(t))}function Cu(t,e){const n=Nr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===e&&(e=-1),n.Zn.vr(t,e)))}function ku(t,e){const n=Nr(t);return n.persistence.runTransaction("Allocate target","readwrite",t=>{let r;return n.Lo.Ao(t,e).next(s=>s?(r=s,Ko.resolve(r)):n.Lo.ao(t).next(s=>(r=new Zr(e,s,0,t.bo),n.Lo.fo(t,r).next(()=>r))))}).then(t=>{const r=n.Ra.get(t.targetId);return(null===r||t.ut.p(r.ut)>0)&&(n.Ra=n.Ra.ft(t.targetId,t),n.Pa.set(e,t.targetId)),t})}async function Ru(t,e,n){const r=Nr(t),s=r.Ra.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,t=>r.persistence.Ar.removeTarget(t,s))}catch(t){if(!ia(t))throw t;vr("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.Ra=r.Ra.remove(e),r.Pa.delete(s.target)}function Lu(t,e,n){const r=Nr(t);let s=Vr.min(),i=ys();return r.persistence.runTransaction("Execute query","readonly",t=>(function(t,e,n){const r=Nr(t),s=r.Pa.get(n);return void 0!==s?Ko.resolve(r.Ra.get(s)):r.Lo.Ao(e,n)})(r,t,Io(e)).next(e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Lo.po(t,e.targetId).next(t=>{i=t})}).next(()=>r.Aa.us(t,e,n?s:Vr.min(),n?i:ys())).next(t=>({documents:t,Da:i})))}function Pu(t,e){const n=Nr(t),r=Nr(n.Lo),s=n.Ra.get(e);return s?Promise.resolve(s.target):n.persistence.runTransaction("Get target data","readonly",t=>r.ze(t,e).next(t=>t?t.target:null))}async function Vu(t){if(t.code!==Ar.FAILED_PRECONDITION||t.message!==Xo)throw t;vr("LocalStore","Unexpectedly lost primary lease")}class Uu{constructor(t,e,n,r,s,i){this.gs=t,this.Ca=n,this.Na=r,this.xa=s,this.listener=i,this.state=0,this.Oa=0,this.ka=null,this.stream=null,this.Pi=new ea(t,e)}Fa(){return 1===this.state||2===this.state||4===this.state}Ma(){return 2===this.state}start(){3!==this.state?this.auth():this.$a()}async stop(){this.Fa()&&await this.close(0)}La(){this.state=0,this.Pi.reset()}qa(){this.Ma()&&null===this.ka&&(this.ka=this.gs.ks(this.Ca,6e4,()=>this.Ba()))}Ua(t){this.Wa(),this.stream.send(t)}async Ba(){if(this.Ma())return this.close(0)}Wa(){this.ka&&(this.ka.cancel(),this.ka=null)}async close(t,e){this.Wa(),this.Pi.cancel(),this.Oa++,3!==t?this.Pi.reset():e&&e.code===Ar.RESOURCE_EXHAUSTED?(br(e.toString()),br("Using maximum backoff delay to prevent overloading the backend."),this.Pi.Ns()):e&&e.code===Ar.UNAUTHENTICATED&&this.xa.m(),null!==this.stream&&(this.Ka(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Qa(e)}Ka(){}auth(){this.state=1;const t=this.ja(this.Oa),e=this.Oa;this.xa.getToken().then(t=>{this.Oa===e&&this.Ga(t)},e=>{t(()=>{const t=new Sr(Ar.UNKNOWN,"Fetching auth token failed: "+e.message);return this.za(t)})})}Ga(t){const e=this.ja(this.Oa);this.stream=this.Ha(t),this.stream.Ja(()=>{e(()=>(this.state=2,this.listener.Ja()))}),this.stream.Qa(t=>{e(()=>this.za(t))}),this.stream.onMessage(t=>{e(()=>this.onMessage(t))})}$a(){this.state=4,this.Pi.xs(async()=>{this.state=0,this.start()})}za(t){return vr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)}ja(t){return e=>{this.gs.di(()=>this.Oa===t?e():(vr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Mu extends Uu{constructor(t,e,n,r,s){super(t,"listen_stream_connection_backoff","listen_stream_idle",e,n,s),this.serializer=r}Ha(t){return this.Na.Ya("Listen",t)}onMessage(t){this.Pi.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:_r()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.He?(Tr(void 0===e||"string"==typeof e),Yr.fromBase64String(e||"")):(Tr(void 0===e||e instanceof Uint8Array),Yr.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Ar.UNKNOWN:ss(t.code);return new Sr(e,t.message||"")}(o);n=new Ss(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=li(t,r.document.name),i=ai(r.document.updateTime),o=new so({mapValue:{fields:r.document.fields}}),a=new uo(s,i,o,{}),u=r.targetIds||[],c=r.removedTargetIds||[];n=new Ns(u,c,a.key,a)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=li(t,r.document),i=r.readTime?ai(r.readTime):Vr.min(),o=new co(s,i),a=r.removedTargetIds||[];n=new Ns([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=li(t,r.document),i=r.removedTargetIds||[];n=new Ns([],i,s,null)}else{if(!("filter"in e))return _r();{e.filter;const t=e.filter;t.targetId;const r=t.count||0,s=new ts(r),i=t.targetId;n=new As(i,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Vr.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Vr.min():e.readTime?ai(e.readTime):Vr.min()}(t);return this.listener.Xa(e,n)}Za(t){const e={};e.database=pi(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;return(n=Jr(r)?{documents:vi(t,r)}:{query:bi(t,r)}).targetId=e.targetId,e.resumeToken.ot()>0&&(n.resumeToken=oi(t,e.resumeToken)),n}(this.serializer,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return _r()}}(0,e.ct);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Ua(e)}tc(t){const e={};e.database=pi(this.serializer),e.removeTarget=t,this.Ua(e)}}class qu extends Uu{constructor(t,e,n,r,s){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,s),this.serializer=r,this.ec=!1}get nc(){return this.ec}start(){this.ec=!1,this.lastStreamToken=void 0,super.start()}Ka(){this.ec&&this.sc([])}Ha(t){return this.Na.Ya("Write",t)}onMessage(t){if(Tr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.ec){this.Pi.reset();const e=function(t,e){return t&&t.length>0?(Tr(void 0!==e),t.map(t=>(function(t,e){let n=t.updateTime?ai(t.updateTime):ai(e);n.isEqual(Vr.min())&&(n=ai(e));let r=null;return t.transformResults&&t.transformResults.length>0&&(r=t.transformResults),new ji(n,r)})(t,e))):[]}(t.writeResults,t.commitTime),n=ai(t.commitTime);return this.listener.ic(n,e)}return Tr(!t.writeResults||0===t.writeResults.length),this.ec=!0,this.listener.rc()}oc(){const t={};t.database=pi(this.serializer),this.Ua(t)}sc(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>yi(this.serializer,t))};this.Ua(e)}}class Fu extends class{}{constructor(t,e,n){super(),this.credentials=t,this.Na=e,this.serializer=n,this.ac=!1}cc(){if(this.ac)throw new Sr(Ar.FAILED_PRECONDITION,"The client has already been terminated.")}uc(t,e,n){return this.cc(),this.credentials.getToken().then(r=>this.Na.uc(t,e,n,r)).catch(t=>{throw t.code===Ar.UNAUTHENTICATED&&this.credentials.m(),t})}hc(t,e,n){return this.cc(),this.credentials.getToken().then(r=>this.Na.hc(t,e,n,r)).catch(t=>{throw t.code===Ar.UNAUTHENTICATED&&this.credentials.m(),t})}terminate(){this.ac=!1}}function ju(t,e,n){return new Fu(t,e,n)}class Gu{constructor(t,e){this.ai=t,this.lc=e,this.state="Unknown",this._c=0,this.fc=null,this.dc=!0}wc(){0===this._c&&(this.Ec("Unknown"),this.fc=this.ai.ks("online_state_timeout",1e4,()=>(this.fc=null,this.Tc("Backend didn't respond within 10 seconds."),this.Ec("Offline"),Promise.resolve())))}Ic(t){"Online"===this.state?this.Ec("Unknown"):(this._c++,this._c>=1&&(this.mc(),this.Tc("Connection failed 1 times. Most recent error: "+t.toString()),this.Ec("Offline")))}set(t){this.mc(),this._c=0,"Online"===t&&(this.dc=!1),this.Ec(t)}Ec(t){t!==this.state&&(this.state=t,this.lc(t))}Tc(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.dc?(br(e),this.dc=!1):vr("OnlineStateTracker",e)}mc(){null!==this.fc&&(this.fc.cancel(),this.fc=null)}}class $u{constructor(t,e,n,r,s){this.Ac=t,this.Rc=e,this.ai=n,this.Pc=[],this.Vc=new Map,this.gc=null,this.yc=new Set,this.pc={},this.bc=s,this.bc.vc(t=>{n.di(async()=>{this.Sc()&&(vr("RemoteStore","Restarting streams for network reachability change."),await this.Dc())})}),this.Cc=new Gu(n,r),this.Nc=function(t,e,n){const r=Nr(t);return r.cc(),new Mu(e,r.Na,r.credentials,r.serializer,n)}(this.Rc,n,{Ja:this.xc.bind(this),Qa:this.Oc.bind(this),Xa:this.kc.bind(this)}),this.Fc=function(t,e,n){const r=Nr(t);return r.cc(),new qu(e,r.Na,r.credentials,r.serializer,n)}(this.Rc,n,{Ja:this.Mc.bind(this),Qa:this.$c.bind(this),rc:this.Lc.bind(this),ic:this.ic.bind(this)})}start(){return this.enableNetwork()}enableNetwork(){return this.yc.delete(0),this.qc()}async qc(){this.Sc()&&(this.Bc()?this.Uc():this.Cc.set("Unknown"),await this.Wc())}async disableNetwork(){this.yc.add(0),await this.Kc(),this.Cc.set("Offline")}async Kc(){await this.Fc.stop(),await this.Nc.stop(),this.Pc.length>0&&(vr("RemoteStore",`Stopping write stream with ${this.Pc.length} pending writes`),this.Pc=[]),this.Qc()}async ra(){vr("RemoteStore","RemoteStore shutting down."),this.yc.add(5),await this.Kc(),this.bc.ra(),this.Cc.set("Unknown")}listen(t){this.Vc.has(t.targetId)||(this.Vc.set(t.targetId,t),this.Bc()?this.Uc():this.Nc.Ma()&&this.jc(t))}Gc(t){this.Vc.delete(t),this.Nc.Ma()&&this.zc(t),0===this.Vc.size&&(this.Nc.Ma()?this.Nc.qa():this.Sc()&&this.Cc.set("Unknown"))}ze(t){return this.Vc.get(t)||null}Ge(t){return this.pc.Ge(t)}jc(t){this.gc.ye(t.targetId),this.Nc.Za(t)}zc(t){this.gc.ye(t),this.Nc.tc(t)}Uc(){this.gc=new Ds(this),this.Nc.start(),this.Cc.wc()}Bc(){return this.Sc()&&!this.Nc.Fa()&&this.Vc.size>0}Sc(){return 0===this.yc.size}Qc(){this.gc=null}async xc(){this.Vc.forEach((t,e)=>{this.jc(t)})}async Oc(t){this.Qc(),this.Bc()?(this.Cc.Ic(t),this.Uc()):this.Cc.set("Unknown")}async kc(t,e){if(this.Cc.set("Online"),t instanceof Ss&&2===t.state&&t.cause)try{await this.Hc(t)}catch(e){vr("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),e),await this.Jc(e)}else if(t instanceof Ns?this.gc.xe(t):t instanceof As?this.gc.Be(t):this.gc.Fe(t),!e.isEqual(Vr.min()))try{const n=await Ou(this.Ac);e.p(n)>=0&&await this.Yc(e)}catch(t){vr("RemoteStore","Failed to raise snapshot:",t),await this.Jc(t)}}async Jc(t,e){if(!ia(t))throw t;this.yc.add(1),await this.Kc(),this.Cc.set("Offline"),e||(e=(()=>Ou(this.Ac))),this.ai.Si(async()=>{vr("RemoteStore","Retrying IndexedDB access"),await e(),this.yc.delete(1),await this.qc()})}Xc(t){return t().catch(e=>this.Jc(e,t))}Yc(t){const e=this.gc.Ke(t);return e.te.forEach((e,n)=>{if(e.resumeToken.ot()>0){const r=this.Vc.get(n);r&&this.Vc.set(n,r.lt(e.resumeToken,t))}}),e.ee.forEach(t=>{const e=this.Vc.get(t);if(!e)return;this.Vc.set(t,e.lt(Yr.at,e.ut)),this.zc(t);const n=new Zr(e.target,t,1,e.sequenceNumber);this.jc(n)}),this.pc.Zc(e)}async Hc(t){const e=t.cause;for(const n of t.targetIds)this.Vc.has(n)&&(await this.pc.tu(n,e),this.Vc.delete(n),this.gc.removeTarget(n))}async Wc(){let t=this.Pc.length>0?this.Pc[this.Pc.length-1].batchId:-1;for(;this.eu();)try{const e=await Cu(this.Ac,t);if(null===e){0===this.Pc.length&&this.Fc.qa();break}t=e.batchId,this.nu(e)}catch(t){await this.Jc(t)}this.su()&&this.iu()}eu(){return this.Sc()&&this.Pc.length<10}ru(){return this.Pc.length}nu(t){this.Pc.push(t),this.Fc.Ma()&&this.Fc.nc&&this.Fc.sc(t.mutations)}su(){return this.Sc()&&!this.Fc.Fa()&&this.Pc.length>0}iu(){this.Fc.start()}async Mc(){this.Fc.oc()}async Lc(){for(const t of this.Pc)this.Fc.sc(t.mutations)}async ic(t,e){const n=this.Pc.shift(),r=zo.from(n,t,e);await this.Xc(()=>this.pc.ou(r)),await this.Wc()}async $c(t){t&&this.Fc.nc&&await this.au(t),this.su()&&this.iu()}async au(t){if(rs(e=t.code)&&e!==Ar.ABORTED){const e=this.Pc.shift();this.Fc.La(),await this.Xc(()=>this.pc.cu(e.batchId,t)),await this.Wc()}var e}async Dc(){this.yc.add(4),await this.Kc(),this.Cc.set("Unknown"),this.Fc.La(),this.Nc.La(),this.yc.delete(4),await this.qc()}async uu(t){this.ai.Ni(),vr("RemoteStore","RemoteStore received new credentials");const e=this.Sc();this.yc.add(3),await this.Kc(),e&&this.Cc.set("Unknown"),await this.pc.uu(t),this.yc.delete(3),await this.qc()}async hu(t){t?(this.yc.delete(2),await this.qc()):t||(this.yc.add(2),await this.Kc(),this.Cc.set("Unknown"))}}class Bu{constructor(){this.lu=void 0,this.listeners=[]}}class zu{constructor(){this._u=new Ho(t=>To(t),_o),this.onlineState="Unknown",this.fu=new Set}}function Hu(t){t.fu.forEach(t=>{t.next()})}class Ku{constructor(t,e,n){this.query=t,this.Eu=e,this.Tu=!1,this.Iu=null,this.onlineState="Unknown",this.options=n||{}}du(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Is(t.query,t.docs,t.Ht,e,t.Jt,t.fromCache,t.Yt,!0)}let e=!1;return this.Tu?this.mu(t)&&(this.Eu.next(t),e=!0):this.Au(t,this.onlineState)&&(this.Ru(t),e=!0),this.Iu=t,e}onError(t){this.Eu.error(t)}wu(t){this.onlineState=t;let e=!1;return this.Iu&&!this.Tu&&this.Au(this.Iu,t)&&(this.Ru(this.Iu),e=!0),e}Au(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.Pu&&n||t.docs.$()&&"Offline"!==e)}mu(t){if(t.docChanges.length>0)return!0;const e=this.Iu&&this.Iu.hasPendingWrites!==t.hasPendingWrites;return!(!t.Yt&&!e)&&!0===this.options.includeMetadataChanges}Ru(t){t=Is.Zt(t.query,t.docs,t.Jt,t.fromCache),this.Tu=!0,this.Eu.next(t)}}class Wu{constructor(){this.Vu=new us(Xu.gu),this.yu=new us(Xu.pu)}$(){return this.Vu.$()}Po(t,e){const n=new Xu(t,e);this.Vu=this.Vu.add(n),this.yu=this.yu.add(n)}bu(t,e){t.forEach(t=>this.Po(t,e))}yo(t,e){this.vu(new Xu(t,e))}Su(t,e){t.forEach(t=>this.yo(t,e))}Du(t){const e=new jr(new Mr([])),n=new Xu(e,t),r=new Xu(e,t+1),s=[];return this.yu.Lt([n,r],t=>{this.vu(t),s.push(t.key)}),s}Cu(){this.Vu.forEach(t=>this.vu(t))}vu(t){this.Vu=this.Vu.delete(t),this.yu=this.yu.delete(t)}Nu(t){const e=new jr(new Mr([])),n=new Xu(e,t),r=new Xu(e,t+1);let s=ys();return this.yu.Lt([n,r],t=>{s=s.add(t.key)}),s}Mr(t){const e=new Xu(t,0),n=this.Vu.Bt(e);return null!==n&&t.isEqual(n.key)}}class Xu{constructor(t,e){this.key=t,this.xu=e}static gu(t,e){return jr.C(t.key,e.key)||kr(t.xu,e.xu)}static pu(t,e){return kr(t.xu,e.xu)||jr.C(t.key,e.key)}}function Qu(t,e){return`firestore_clients_${t}_${e}`}function Ju(t,e,n){let r=`firestore_mutations_${t}_${n}`;return e.t()&&(r+="_"+e.uid),r}function Yu(t,e){return`firestore_targets_${t}_${e}`}class Zu{constructor(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}static Ou(t,e,n){const r=JSON.parse(n);let s="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),i=void 0;return s&&r.error&&((s="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(i=new Sr(r.error.code,r.error.message))),s?new Zu(t,e,r.state,i):(br("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}ku(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class tc{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Ou(t,e){const n=JSON.parse(e);let r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),s=void 0;return r&&n.error&&((r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(s=new Sr(n.error.code,n.error.message))),r?new tc(t,n.state,s):(br("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}ku(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class ec{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ou(t,e){const n=JSON.parse(e);let r="object"==typeof n&&n.activeTargetIds instanceof Array,s=vs();for(let t=0;r&&t<n.activeTargetIds.length;++t)r=Hr(n.activeTargetIds[t]),s=s.add(n.activeTargetIds[t]);return r?new ec(t,s):(br("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class nc{constructor(t,e){this.clientId=t,this.onlineState=e}static Ou(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new nc(e.clientId,e.onlineState):(br("SharedClientState","Failed to parse online state: "+t),null)}}class rc{constructor(){this.activeTargetIds=vs()}Fu(t){this.activeTargetIds=this.activeTargetIds.add(t)}Mu(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ku(){const t={activeTargetIds:this.activeTargetIds.B(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class sc{constructor(t,e,n,r,s){this.window=t,this.gs=e,this.persistenceKey=n,this.$u=r,this.Lu=null,this.lc=null,this.ms=null,this.qu=this.Bu.bind(this),this.Uu=new is(kr),this.or=!1,this.Wu=[];const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ku=Qu(this.persistenceKey,this.$u),this.Qu=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Uu=this.Uu.ft(this.$u,new rc),this.ju=new RegExp(`^firestore_clients_${i}_([^_]*)$`),this.Gu=new RegExp(`^firestore_mutations_${i}_(\\d+)(?:_(.*))?$`),this.zu=new RegExp(`^firestore_targets_${i}_(\\d+)$`),this.Hu=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.qu)}static qs(t){return!(!t||!t.localStorage)}async start(){const t=await this.Lu.ha();for(const e of t){if(e===this.$u)continue;const t=this.getItem(Qu(this.persistenceKey,e));if(t){const n=ec.Ou(e,t);n&&(this.Uu=this.Uu.ft(n.clientId,n))}}this.Ju();const e=this.storage.getItem(this.Hu);if(e){const t=this.Yu(e);t&&this.Xu(t)}for(const t of this.Wu)this.Bu(t);this.Wu=[],this.window.addEventListener("unload",()=>this.ra()),this.or=!0}Ps(t){this.setItem(this.Qu,JSON.stringify(t))}Zu(){return this.th(this.Uu)}eh(t){let e=!1;return this.Uu.forEach((n,r)=>{r.activeTargetIds.has(t)&&(e=!0)}),e}nh(t){this.sh(t,"pending")}ih(t,e,n){this.sh(t,e,n),this.rh(t)}oh(t){let e="not-current";if(this.eh(t)){const n=this.storage.getItem(Yu(this.persistenceKey,t));if(n){const r=tc.Ou(t,n);r&&(e=r.state)}}return this.ah.Fu(t),this.Ju(),e}uh(t){this.ah.Mu(t),this.Ju()}hh(t){return this.ah.activeTargetIds.has(t)}lh(t){this.removeItem(Yu(this.persistenceKey,t))}_h(t,e,n){this.fh(t,e,n)}dh(t,e,n){e.forEach(t=>{this.rh(t)}),this.currentUser=t,n.forEach(t=>{this.nh(t)})}wh(t){this.Eh(t)}ra(){this.or&&(this.window.removeEventListener("storage",this.qu),this.removeItem(this.Ku),this.or=!1)}getItem(t){const e=this.storage.getItem(t);return vr("SharedClientState","READ",t,e),e}setItem(t,e){vr("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){vr("SharedClientState","REMOVE",t),this.storage.removeItem(t)}Bu(t){const e=t;if(e.storageArea===this.storage){if(vr("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Ku)return void br("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.gs.Si(async()=>{if(this.or){if(null!==e.key)if(this.ju.test(e.key)){if(null==e.newValue){const t=this.Th(e.key);return this.Ih(t,null)}{const t=this.mh(e.key,e.newValue);if(t)return this.Ih(t.clientId,t)}}else if(this.Gu.test(e.key)){if(null!==e.newValue){const t=this.Ah(e.key,e.newValue);if(t)return this.Rh(t)}}else if(this.zu.test(e.key)){if(null!==e.newValue){const t=this.Ph(e.key,e.newValue);if(t)return this.Vh(t)}}else if(e.key===this.Hu){if(null!==e.newValue){const t=this.Yu(e.newValue);if(t)return this.Xu(t)}}else if(e.key===this.Qu){const t=function(t){let e=Zo.Vs;if(null!=t)try{const n=JSON.parse(t);Tr("number"==typeof n),e=n}catch(t){br("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==Zo.Vs&&this.ms(t)}}else this.Wu.push(e)})}}get ah(){return this.Uu.get(this.$u)}Ju(){this.setItem(this.Ku,this.ah.ku())}sh(t,e,n){const r=new Zu(this.currentUser,t,e,n),s=Ju(this.persistenceKey,this.currentUser,t);this.setItem(s,r.ku())}rh(t){const e=Ju(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Eh(t){const e={clientId:this.$u,onlineState:t};this.storage.setItem(this.Hu,JSON.stringify(e))}fh(t,e,n){const r=Yu(this.persistenceKey,t),s=new tc(t,e,n);this.setItem(r,s.ku())}Th(t){const e=this.ju.exec(t);return e?e[1]:null}mh(t,e){const n=this.Th(t);return ec.Ou(n,e)}Ah(t,e){const n=this.Gu.exec(t),r=Number(n[1]),s=void 0!==n[2]?n[2]:null;return Zu.Ou(new mr(s),r,e)}Ph(t,e){const n=this.zu.exec(t),r=Number(n[1]);return tc.Ou(r,e)}Yu(t){return nc.Ou(t)}async Rh(t){if(t.user.uid===this.currentUser.uid)return this.Lu.gh(t.batchId,t.state,t.error);vr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid)}Vh(t){return this.Lu.yh(t.targetId,t.state,t.error)}Ih(t,e){const n=e?this.Uu.ft(t,e):this.Uu.remove(t),r=this.th(this.Uu),s=this.th(n),i=[],o=[];return s.forEach(t=>{r.has(t)||i.push(t)}),r.forEach(t=>{s.has(t)||o.push(t)}),this.Lu.ph(i,o).then(()=>{this.Uu=n})}Xu(t){this.Uu.get(t.clientId)&&this.lc(t.onlineState)}th(t){let e=vs();return t.forEach((t,n)=>{e=e.Ut(n.activeTargetIds)}),e}}class ic{constructor(){this.bh=new rc,this.vh={},this.lc=null,this.ms=null}nh(t){}ih(t,e,n){}oh(t){return this.bh.Fu(t),this.vh[t]||"not-current"}_h(t,e,n){this.vh[t]=e}uh(t){this.bh.Mu(t)}hh(t){return this.bh.activeTargetIds.has(t)}lh(t){delete this.vh[t]}Zu(){return this.bh.activeTargetIds}eh(t){return this.bh.activeTargetIds.has(t)}start(){return this.bh=new rc,Promise.resolve()}dh(t,e,n){}wh(t){}ra(){}Ps(t){}}class oc{constructor(t){this.key=t}}class ac{constructor(t){this.key=t}}class uc{constructor(t,e){this.query=t,this.Sh=e,this.Dh=null,this.oe=!1,this.Ch=ys(),this.Jt=ys(),this.Nh=So(t),this.xh=new bs(this.Nh)}get Oh(){return this.Sh}kh(t,e){const n=e?e.Fh:new Es,r=e?e.xh:this.xh;let s=e?e.Jt:this.Jt,i=r,o=!1;const a=mo(this.query)&&r.size===this.query.limit?r.last():null,u=yo(this.query)&&r.size===this.query.limit?r.first():null;if(t.Tt((t,e)=>{const c=r.get(t);let h=e instanceof uo?e:null;h&&(h=Ao(this.query,h)?h:null);const l=!!c&&this.Jt.has(c.key),f=!!h&&(h.sn||this.Jt.has(h.key)&&h.hasCommittedMutations);let d=!1;c&&h?c.data().isEqual(h.data())?l!==f&&(n.track({type:3,doc:h}),d=!0):this.Mh(c,h)||(n.track({type:2,doc:h}),d=!0,(a&&this.Nh(h,a)>0||u&&this.Nh(h,u)<0)&&(o=!0)):!c&&h?(n.track({type:0,doc:h}),d=!0):c&&!h&&(n.track({type:1,doc:c}),d=!0,(a||u)&&(o=!0)),d&&(h?(i=i.add(h),s=f?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))}),mo(this.query)||yo(this.query))for(;i.size>this.query.limit;){const t=mo(this.query)?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{xh:i,Fh:n,$h:o,Jt:s}}Mh(t,e){return t.sn&&e.hasCommittedMutations&&!e.sn}zn(t,e,n){const r=this.xh;this.xh=t.xh,this.Jt=t.Jt;const s=t.Fh.zt();s.sort((t,e)=>(function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _r()}};return n(t)-n(e)})(t.type,e.type)||this.Nh(t.doc,e.doc)),this.Lh(n);const i=e?this.qh():[],o=0===this.Ch.size&&this.oe?1:0,a=o!==this.Dh;return this.Dh=o,0!==s.length||a?{snapshot:new Is(this.query,t.xh,r,s,t.Jt,0===o,a,!1),Bh:i}:{Bh:i}}wu(t){return this.oe&&"Offline"===t?(this.oe=!1,this.zn({xh:this.xh,Fh:new Es,Jt:this.Jt,$h:!1},!1)):{Bh:[]}}Uh(t){return!this.Sh.has(t)&&!!this.xh.has(t)&&!this.xh.get(t).sn}Lh(t){t&&(t.ae.forEach(t=>this.Sh=this.Sh.add(t)),t.ce.forEach(t=>{}),t.ue.forEach(t=>this.Sh=this.Sh.delete(t)),this.oe=t.oe)}qh(){if(!this.oe)return[];const t=this.Ch;this.Ch=ys(),this.xh.forEach(t=>{this.Uh(t.key)&&(this.Ch=this.Ch.add(t.key))});const e=[];return t.forEach(t=>{this.Ch.has(t)||e.push(new ac(t))}),this.Ch.forEach(n=>{t.has(n)||e.push(new oc(n))}),e}Wh(t){this.Sh=t.Da,this.Ch=ys();const e=this.kh(t.documents);return this.zn(e,!0)}Kh(){return Is.Zt(this.query,this.xh,this.Jt,0===this.Dh)}}class cc{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class hc{constructor(t){this.key=t,this.Qh=!1}}class lc{constructor(t,e,n,r,s){this.Ac=t,this.jh=e,this.Gh=n,this.currentUser=r,this.zh=s,this.Hh=null,this.Jh=new Ho(t=>To(t),_o),this.Yh=new Map,this.Xh=[],this.Zh=new is(jr.C),this.tl=new Map,this.el=new Wu,this.nl={},this.sl=new Map,this.il=pu.oo(),this.onlineState="Unknown",this.rl=void 0}get ol(){return!0===this.rl}subscribe(t){this.Hh=t}al(t){}}async function fc(t,e,n,r){t.cl=((e,n,r)=>(async function(t,e,n,r){let s=e.view.kh(n);s.$h&&(s=await Lu(t.Ac,e.query,!1).then(({documents:t})=>e.view.kh(t,s)));const i=r&&r.te.get(e.targetId),o=e.view.zn(s,t.ol,i);return bc(t,e.targetId,o.Bh),o.snapshot})(t,e,n,r));const s=await Lu(t.Ac,e,!0),i=new uc(e,s.Da),o=i.kh(s.documents),a=Ts.re(n,r&&"Offline"!==t.onlineState),u=i.zn(o,t.ol,a);bc(t,n,u.Bh);const c=new cc(e,n,i);return t.Jh.set(e,c),t.Yh.has(n)?t.Yh.get(n).push(e):t.Yh.set(n,[e]),u.snapshot}async function dc(t,e){const n=Nr(t);n.al("applyRemoteEvent()");try{const r=await function(t,e){const n=Nr(t),r=e.ut;let s=n.Ra;return n.persistence.runTransaction("Apply remote event","readwrite-primary",t=>{const i=n.ga.Jr({Xr:!0});s=n.Ra;const o=[];e.te.forEach((e,i)=>{const a=s.get(i);if(!a)return;o.push(n.Lo.Vo(t,e.ue,i).next(()=>n.Lo.Ro(t,e.ae,i)));const u=e.resumeToken;if(u.ot()>0){const c=a.lt(u,r).ht(t.bo);s=s.ft(i,c),function(t,e,n){return Tr(e.resumeToken.ot()>0),0===t.resumeToken.ot()||e.ut.v()-t.ut.v()>=3e8||n.ae.size+n.ce.size+n.ue.size>0}(a,c,e)&&o.push(n.Lo.Eo(t,c))}});let a=ls(),u=ys();if(e.ne.forEach((t,e)=>{u=u.add(t)}),o.push(i.getEntries(t,u).next(s=>{e.ne.forEach((u,c)=>{const h=s.get(u);c instanceof co&&c.version.isEqual(Vr.min())?(i.Kn(u,r),a=a.ft(u,c)):null==h||c.version.p(h.version)>0||0===c.version.p(h.version)&&h.hasPendingWrites?(i.Un(c,r),a=a.ft(u,c)):vr("LocalStore","Ignoring outdated watch update for ",u,". Current version:",h.version," Watch version:",c.version),e.se.has(u)&&o.push(n.persistence.Ar.ma(t,u))})})),!r.isEqual(Vr.min())){const e=n.Lo.ho(t).next(e=>n.Lo._o(t,t.bo,r));o.push(e)}return Ko.Mn(o).next(()=>i.apply(t)).next(()=>n.ya.as(t,a))}).then(t=>(n.Ra=s,t))}(n.Ac,e);e.te.forEach((t,e)=>{const r=n.tl.get(e);r&&(Tr(t.ae.size+t.ce.size+t.ue.size<=1),t.ae.size>0?r.Qh=!0:t.ce.size>0?Tr(r.Qh):t.ue.size>0&&(Tr(r.Qh),r.Qh=!1))}),await _c(n,r,e)}catch(t){await Vu(t)}}function pc(t,e,n){const r=Nr(t);if(r.ol&&0===n||!r.ol&&1===n){r.al("applyOnlineStateChange()");const t=[];r.Jh.forEach((n,r)=>{const s=r.view.wu(e);s.snapshot&&t.push(s.snapshot)}),r.Hh.ul(e),r.Hh.Xa(t),r.onlineState=e,r.ol&&r.Gh.wh(e)}}async function gc(t,e){const n=Nr(t);n.al("applySuccessfulWrite()");const r=e.batch.batchId;try{const s=await function(t,e){const n=Nr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",t=>{const r=e.batch.keys(),s=n.ga.Jr({Xr:!0});return function(t,e,n,r){const s=n.batch,i=s.keys();let o=Ko.resolve();return i.forEach(t=>{o=o.next(()=>r.Qn(e,t)).next(e=>{let i=e;const o=n.yn.get(t);Tr(null!==o),(!i||i.version.p(o)<0)&&(i=s.An(t,i,n))&&r.Un(i,n.gn)})}),o.next(()=>t.Zn.Nr(e,s))}(n,t,e,s).next(()=>s.apply(t)).next(()=>n.Zn.Fr(t)).next(()=>n.ya.os(t,r))})}(n.Ac,e);yc(n,r,null),mc(n,r),n.Gh.ih(r,"acknowledged"),await _c(n,s)}catch(t){await Vu(t)}}function mc(t,e){(t.sl.get(e)||[]).forEach(t=>{t.resolve()}),t.sl.delete(e)}function yc(t,e,n){const r=Nr(t);let s=r.nl[r.currentUser.s()];if(s){const t=s.get(e);t&&(n?t.reject(n):t.resolve(),s=s.remove(e)),r.nl[r.currentUser.s()]=s}}function wc(t,e,n=null){t.Gh.uh(e);for(const r of t.Yh.get(e))t.Jh.delete(r),n&&t.Hh.hl(r,n);t.Yh.delete(e),t.ol&&t.el.Du(e).forEach(e=>{t.el.Mr(e)||vc(t,e)})}function vc(t,e){const n=t.Zh.get(e);null!==n&&(t.jh.Gc(n),t.Zh=t.Zh.remove(e),t.tl.delete(n),Ic(t))}function bc(t,e,n){for(const r of n)r instanceof oc?(t.el.Po(r.key,e),Ec(t,r)):r instanceof ac?(vr("SyncEngine","Document no longer in limbo: "+r.key),t.el.yo(r.key,e),t.el.Mr(r.key)||vc(t,r.key)):_r()}function Ec(t,e){const n=e.key;t.Zh.get(n)||(vr("SyncEngine","New document in limbo: "+n),t.Xh.push(n),Ic(t))}function Ic(t){for(;t.Xh.length>0&&t.Zh.size<t.zh;){const e=t.Xh.shift(),n=t.il.next();t.tl.set(n,new hc(e)),t.Zh=t.Zh.ft(e,n),t.jh.listen(new Zr(Io(go(e.path)),n,2,Zo.Vs))}}async function _c(t,e,n){const r=Nr(t),s=[],i=[],o=[];r.Jh.forEach((t,a)=>{o.push(r.cl(a,e,n).then(t=>{if(t){r.ol&&r.Gh._h(a.targetId,t.fromCache?"not-current":"current"),s.push(t);const e=Yo.Is(a.targetId,t);i.push(e)}}))}),await Promise.all(o),r.Hh.Xa(s),await async function(t,e){const n=Nr(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>Ko.forEach(e,e=>Ko.forEach(e.Es,r=>n.persistence.Ar.Po(t,e.targetId,r)).next(()=>Ko.forEach(e.Ts,r=>n.persistence.Ar.yo(t,e.targetId,r)))))}catch(t){if(!ia(t))throw t;vr("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ra.get(e),r=t.ut,s=t._t(r);n.Ra=n.Ra.ft(e,s)}}}(r.Ac,i)}async function Tc(t,e){const n=Nr(t),r=await Lu(n.Ac,e.query,!0),s=e.view.Wh(r);return n.ol&&bc(n,e.targetId,s.Bh),s}async function Nc(t,e,n){const r=Nr(t),s=[],i=[];for(const t of e){let e;const n=r.Yh.get(t);if(n&&0!==n.length){e=await ku(r.Ac,Io(n[0]));for(const t of n){const e=r.Jh.get(t),n=await Tc(r,e);n.snapshot&&i.push(n.snapshot)}}else{const n=await Pu(r.Ac,t);e=await ku(r.Ac,n),await fc(r,Ac(n),t,!1)}s.push(e)}return r.Hh.Xa(i),s}function Ac(t){return po(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Sc(t){const e=Nr(t);return e.jh.pc.Zc=dc.bind(null,e),e.jh.pc.Ge=function(t,e){const n=Nr(t),r=n.tl.get(e);if(r&&r.Qh)return ys().add(r.key);{let t=ys();const r=n.Yh.get(e);if(!r)return t;for(const e of r){const r=n.Jh.get(e);t=t.Ut(r.view.Oh)}return t}}.bind(null,e),e.jh.pc.tu=async function(t,e,n){const r=Nr(t);r.al("rejectListens()"),r.Gh._h(e,"rejected",n);const s=r.tl.get(e),i=s&&s.key;if(i){let t=new is(jr.C);t=t.ft(i,new co(i,Vr.min()));const n=ys().add(i),s=new _s(Vr.min(),new Map,new us(kr),t,n);await dc(r,s),r.Zh=r.Zh.remove(i),r.tl.delete(e),Ic(r)}else await Ru(r.Ac,e,!1).then(()=>wc(r,e,n)).catch(Vu)}.bind(null,e),e}function xc(t){const e=Nr(t);return e.jh.pc.ou=gc.bind(null,e),e.jh.pc.cu=async function(t,e,n){const r=Nr(t);r.al("rejectFailedWrite()");try{const t=await function(t,e){const n=Nr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let r;return n.Zn.pr(t,e).next(e=>(Tr(null!==e),r=e.keys(),n.Zn.Nr(t,e))).next(()=>n.Zn.Fr(t)).next(()=>n.ya.os(t,r))})}(r.Ac,e);yc(r,e,n),mc(r,e),r.Gh.ih(e,"rejected",n),await _c(r,t)}catch(n){await Vu(n)}}.bind(null,e),e}class Dc{pa(t){this.ll=t}us(t,e,n,r){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t._n.length||1===t._n.length&&t._n[0].field.G())}(e)||n.isEqual(Vr.min())?this._l(t,e):this.ll.os(t,r).next(s=>{const i=this.fl(e,s);return(mo(e)||yo(e))&&this.$h(e.fn,i,r,n)?this._l(t,e):(wr()<=u.DEBUG&&vr("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),No(e)),this.ll.us(t,e,n).next(t=>(i.forEach(e=>{t=t.ft(e.key,e)}),t)))})}fl(t,e){let n=new us(So(t));return e.forEach((e,r)=>{r instanceof uo&&Ao(t,r)&&(n=n.add(r))}),n}$h(t,e,n,r){if(n.size!==e.size)return!0;const s="F"===t?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.p(r)>0)}_l(t,e){return wr()<=u.DEBUG&&vr("IndexFreeQueryEngine","Using full collection scan to execute query:",No(e)),this.ll.us(t,e,Vr.min())}}class Oc{constructor(t,e){this.ts=t,this.Ar=e,this.Zn=[],this.dl=1,this.wl=new us(Xu.gu)}Vr(t){return Ko.resolve(0===this.Zn.length)}gr(t,e,n,r){const s=this.dl;this.dl++,this.Zn.length>0&&this.Zn[this.Zn.length-1];const i=new Bo(s,e,n,r);this.Zn.push(i);for(const e of r)this.wl=this.wl.add(new Xu(e.key,s)),this.ts.yr(t,e.key.path.k());return Ko.resolve(i)}pr(t,e){return Ko.resolve(this.El(e))}vr(t,e){const n=e+1,r=this.Tl(n),s=r<0?0:r;return Ko.resolve(this.Zn.length>s?this.Zn[s]:null)}Sr(){return Ko.resolve(0===this.Zn.length?-1:this.dl-1)}Dr(t){return Ko.resolve(this.Zn.slice())}ns(t,e){const n=new Xu(e,0),r=new Xu(e,Number.POSITIVE_INFINITY),s=[];return this.wl.Lt([n,r],t=>{const e=this.El(t.xu);s.push(e)}),Ko.resolve(s)}cs(t,e){let n=new us(kr);return e.forEach(t=>{const e=new Xu(t,0),r=new Xu(t,Number.POSITIVE_INFINITY);this.wl.Lt([e,r],t=>{n=n.add(t.xu)})}),Ko.resolve(this.Il(n))}ds(t,e){const n=e.path,r=n.length+1;let s=n;jr.tt(s)||(s=s.child(""));const i=new Xu(new jr(s),0);let o=new us(kr);return this.wl.qt(t=>{const e=t.key.path;return!!n.L(e)&&(e.length===r&&(o=o.add(t.xu)),!0)},i),Ko.resolve(this.Il(o))}Il(t){const e=[];return t.forEach(t=>{const n=this.El(t);null!==n&&e.push(n)}),e}Nr(t,e){Tr(0===this.ml(e.batchId,"removed")),this.Zn.shift();let n=this.wl;return Ko.forEach(e.mutations,r=>{const s=new Xu(r.key,e.batchId);return n=n.delete(s),this.Ar.kr(t,r.key)}).next(()=>{this.wl=n})}Or(t){}Mr(t,e){const n=new Xu(e,0),r=this.wl.Bt(n);return Ko.resolve(e.isEqual(r&&r.key))}Fr(t){return this.Zn.length,Ko.resolve()}ml(t,e){return this.Tl(t)}Tl(t){return 0===this.Zn.length?0:t-this.Zn[0].batchId}El(t){const e=this.Tl(t);return e<0||e>=this.Zn.length?null:this.Zn[e]}}class Cc{constructor(t,e){this.ts=t,this.Al=e,this.docs=new is(jr.C),this.size=0}Un(t,e,n){const r=e.key,s=this.docs.get(r),i=s?s.size:0,o=this.Al(e);return this.docs=this.docs.ft(r,{Ur:e,size:o,readTime:n}),this.size+=o-i,this.ts.yr(t,r.path.k())}Kn(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}Qn(t,e){const n=this.docs.get(e);return Ko.resolve(n?n.Ur:null)}getEntries(t,e){let n=fs();return e.forEach(t=>{const e=this.docs.get(t);n=n.ft(t,e?e.Ur:null)}),Ko.resolve(n)}us(t,e,n){let r=ps();const s=new jr(e.path.child("")),i=this.docs.Rt(s);for(;i.bt();){const{key:t,value:{Ur:s,readTime:o}}=i.pt();if(!e.path.L(t.path))break;o.p(n)<=0||s instanceof uo&&Ao(e,s)&&(r=r.ft(s.key,s))}return Ko.resolve(r)}Rl(t,e){return Ko.forEach(this.docs,t=>e(t))}Jr(t){return new Cc.Yr(this)}Zr(t){return Ko.resolve(this.size)}}Cc.Yr=class extends Wo{constructor(t){super(),this.to=t}zn(t){const e=[];return this.Ln.forEach((n,r)=>{r?e.push(this.to.Un(t,r,this.readTime)):this.to.Kn(n)}),Ko.Mn(e)}jn(t,e){return this.to.Qn(t,e)}Gn(t,e){return this.to.getEntries(t,e)}};class kc{constructor(t){this.persistence=t,this.Pl=new Ho(t=>Xr(t),Qr),this.lastRemoteSnapshotVersion=Vr.min(),this.highestTargetId=0,this.Vl=0,this.gl=new Wu,this.targetCount=0,this.yl=pu.ro()}Me(t,e){return this.Pl.forEach((t,n)=>e(n)),Ko.resolve()}ho(t){return Ko.resolve(this.lastRemoteSnapshotVersion)}lo(t){return Ko.resolve(this.Vl)}ao(t){return this.highestTargetId=this.yl.next(),Ko.resolve(this.highestTargetId)}_o(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Vl&&(this.Vl=e),Ko.resolve()}do(t){this.Pl.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.yl=new pu(e),this.highestTargetId=e),t.sequenceNumber>this.Vl&&(this.Vl=t.sequenceNumber)}fo(t,e){return this.do(e),this.targetCount+=1,Ko.resolve()}Eo(t,e){return this.do(e),Ko.resolve()}To(t,e){return this.Pl.delete(e.target),this.gl.Du(e.targetId),this.targetCount-=1,Ko.resolve()}dr(t,e,n){let r=0;const s=[];return this.Pl.forEach((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Pl.delete(i),s.push(this.Io(t,o.targetId)),r++)}),Ko.Mn(s).next(()=>r)}mo(t){return Ko.resolve(this.targetCount)}Ao(t,e){const n=this.Pl.get(e)||null;return Ko.resolve(n)}Ro(t,e,n){return this.gl.bu(e,n),Ko.resolve()}Vo(t,e,n){this.gl.Su(e,n);const r=this.persistence.Ar,s=[];return r&&e.forEach(e=>{s.push(r.kr(t,e))}),Ko.Mn(s)}Io(t,e){return this.gl.Du(e),Ko.resolve()}po(t,e){const n=this.gl.Nu(e);return Ko.resolve(n)}Mr(t,e){return Ko.resolve(this.gl.Mr(e))}}class Rc{constructor(t){this.pl={},this.Do=new Zo(0),this.Co=!1,this.Co=!0,this.Ar=t(this),this.Lo=new kc(this),this.ts=new Ka,this.Xn=new Cc(this.ts,t=>this.Ar.bl(t))}start(){return Promise.resolve()}ra(){return this.Co=!1,Promise.resolve()}get or(){return this.Co}jo(){}Go(){}da(){return this.ts}la(t){let e=this.pl[t.s()];return e||(e=new Oc(this.ts,this.Ar),this.pl[t.s()]=e),e}_a(){return this.Lo}fa(){return this.Xn}runTransaction(t,e,n){vr("MemoryPersistence","Starting transaction:",t);const r=new Lc(this.Do.next());return this.Ar.vl(),n(r).next(t=>this.Ar.Sl(r).next(()=>t)).kn().then(t=>(r.Yn(),t))}Dl(t,e){return Ko.$n(Object.values(this.pl).map(n=>()=>n.Mr(t,e)))}}class Lc extends Qo{constructor(t){super(),this.bo=t}}class Pc{constructor(t){this.persistence=t,this.Cl=new Wu,this.Nl=null}static xl(t){return new Pc(t)}get Ol(){if(this.Nl)return this.Nl;throw _r()}Po(t,e,n){return this.Cl.Po(n,e),this.Ol.delete(n.toString()),Ko.resolve()}yo(t,e,n){return this.Cl.yo(n,e),this.Ol.add(n.toString()),Ko.resolve()}kr(t,e){return this.Ol.add(e.toString()),Ko.resolve()}removeTarget(t,e){this.Cl.Du(e.targetId).forEach(t=>this.Ol.add(t.toString()));const n=this.persistence._a();return n.po(t,e.targetId).next(t=>{t.forEach(t=>this.Ol.add(t.toString()))}).next(()=>n.To(t,e))}vl(){this.Nl=new Set}Sl(t){const e=this.persistence.fa().Jr();return Ko.forEach(this.Ol,n=>{const r=jr.Y(n);return this.kl(t,r).next(t=>{t||e.Kn(r)})}).next(()=>(this.Nl=null,e.apply(t)))}ma(t,e){return this.kl(t,e).next(t=>{t?this.Ol.delete(e.toString()):this.Ol.add(e.toString())})}bl(t){return 0}kl(t,e){return Ko.$n([()=>Ko.resolve(this.Cl.Mr(e)),()=>this.persistence._a().Mr(t,e),()=>this.persistence.Dl(t,e)])}}class Vc{constructor(t){this.Fl=t.Fl,this.Ml=t.Ml}Ja(t){this.$l=t}Qa(t){this.Ll=t}onMessage(t){this.ql=t}close(){this.Ml()}send(t){this.Fl(t)}Bl(){this.$l()}Ul(t){this.Ll(t)}Wl(t){this.ql(t)}}const Uc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Mc extends class{constructor(t){this.Kl=t,this.nt=t.nt;const e=t.ssl?"https":"http";this.Ql=e+"://"+t.host,this.jl="projects/"+this.nt.projectId+"/databases/"+this.nt.database+"/documents"}uc(t,e,n,r){const s=this.Gl(t,e);vr("RestConnection","Sending: ",s,n);const i={};return this.zl(i,r),this.Hl(t,s,i,n).then(t=>(vr("RestConnection","Received: ",t),t),e=>{throw Er("RestConnection",t+" failed with error: ",e,"url: ",s,"request:",n),e})}hc(t,e,n,r){return this.uc(t,e,n,r)}zl(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.19.1",t["Content-Type"]="text/plain",e)for(const n in e.u)e.u.hasOwnProperty(n)&&(t[n]=e.u[n])}Gl(t,e){const n=Uc[t];return`${this.Ql}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling}Hl(t,e,n,r){return new Promise((s,i)=>{const o=new gr;o.listenOnce(dr.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case fr.NO_ERROR:const e=o.getResponseJson();vr("Connection","XHR received:",JSON.stringify(e)),s(e);break;case fr.TIMEOUT:vr("Connection",'RPC "'+t+'" timed out'),i(new Sr(Ar.DEADLINE_EXCEEDED,"Request time out"));break;case fr.HTTP_ERROR:const n=o.getStatus();if(vr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace("_","-");return Object.values(Ar).indexOf(e)>=0?e:Ar.UNKNOWN}(t.status);i(new Sr(e,t.message))}else i(new Sr(Ar.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new Sr(Ar.UNAVAILABLE,"Connection failed."));break;default:_r()}}finally{vr("Connection",'RPC "'+t+'" completed.')}});const a=JSON.stringify(r);o.send(e,"POST",a,n,15)})}Ya(t,e){const n=[this.Ql,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=lr(),i={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.nt.projectId}/databases/${this.nt.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};var o,a;this.zl(i.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(r())||"object"==typeof navigator&&"ReactNative"===navigator.product||r().indexOf("Electron/")>=0||((a=r()).indexOf("MSIE ")>=0||a.indexOf("Trident/")>=0)||r().indexOf("MSAppHost/")>=0||"object"==typeof(o="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==o.id||(i.httpHeadersOverwriteParam="$httpHeaders");const u=n.join("");vr("Connection","Creating WebChannel: "+u,i);const c=s.createWebChannel(u,i);let h=!1,l=!1;const f=new Vc({Fl:t=>{l?vr("Connection","Not sending because WebChannel is closed:",t):(h||(vr("Connection","Opening WebChannel transport."),c.open(),h=!0),vr("Connection","WebChannel sending:",t),c.send(t))},Ml:()=>c.close()}),d=(t,e)=>{c.listen(t,t=>{try{e(t)}catch(t){setTimeout(()=>{throw t},0)}})};return d(pr.EventType.OPEN,()=>{l||vr("Connection","WebChannel transport opened.")}),d(pr.EventType.CLOSE,()=>{l||(l=!0,vr("Connection","WebChannel transport closed"),f.Ul())}),d(pr.EventType.ERROR,t=>{l||(l=!0,Er("Connection","WebChannel transport errored:",t),f.Ul(new Sr(Ar.UNAVAILABLE,"The operation could not be completed")))}),d(pr.EventType.MESSAGE,t=>{var e;if(!l){const n=t.data[0];Tr(!!n);const r=n,s=r.error||(null===(e=r[0])||void 0===e?void 0:e.error);if(s){vr("Connection","WebChannel received error:",s);const t=s.status;let e=function(t){const e=es[t];if(void 0!==e)return ss(e)}(t),n=s.message;void 0===e&&(e=Ar.INTERNAL,n="Unknown error status: "+t+" with message "+s.message),l=!0,f.Ul(new Sr(e,n)),c.close()}else vr("Connection","WebChannel received:",n),f.Wl(n)}}),setTimeout(()=>{f.Bl()},0),f}}class qc{constructor(){this.Jl=(()=>this.Yl()),this.Xl=(()=>this.Zl()),this.t_=[],this.e_()}vc(t){this.t_.push(t)}ra(){window.removeEventListener("online",this.Jl),window.removeEventListener("offline",this.Xl)}e_(){window.addEventListener("online",this.Jl),window.addEventListener("offline",this.Xl)}Yl(){vr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.t_)t(0)}Zl(){vr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.t_)t(1)}static qs(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}class Fc{vc(t){}ra(){}}function jc(t){return new Mc(t)}function Gc(t){return new ei(t,!0)}const $c="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.";class Bc{async initialize(t){this.Gh=this.n_(t),this.persistence=this.s_(t),await this.persistence.start(),this.i_=this.r_(t),this.Ac=this.o_(t)}r_(t){return null}o_(t){return e=this.persistence,n=new Dc,r=t.a_,new xu(e,n,r);var e,n,r}s_(t){if(t.u_.c_)throw new Sr(Ar.FAILED_PRECONDITION,$c);return new Rc(Pc.xl)}n_(t){return new ic}async terminate(){this.i_&&this.i_.stop(),await this.Gh.ra(),await this.persistence.ra()}clearPersistence(t,e){throw new Sr(Ar.FAILED_PRECONDITION,$c)}}class zc extends Bc{async initialize(t){await super.initialize(t),await async function(t){const e=Nr(t),n=Nr(e.ga);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>n.Hr(t)).then(t=>{e.Va=t})}(this.Ac)}r_(t){const e=this.persistence.Ar.nr;return new ba(e,t.ai)}s_(t){const e=Au(t.Kl.nt,t.Kl.persistenceKey),n=Gc(t.Kl.nt);return new Eu(t.u_.synchronizeTabs,e,t.clientId,va.zi(t.u_.cacheSizeBytes),t.ai,la(),fa(),n,this.Gh,t.u_.So)}n_(t){return new ic}clearPersistence(t,e){return Su(Au(t,e))}}class Hc extends zc{constructor(t){super(),this.h_=t}async initialize(t){await super.initialize(t),await this.h_.initialize(this,t);const e=this.h_.Lu;this.Gh instanceof sc&&(this.Gh.Lu={gh:async function(t,e,n,r){const s=Nr(t);s.al("applyBatchState()");const i=await function(t,e){const n=Nr(t),r=Nr(n.Zn);return n.persistence.runTransaction("Lookup mutation documents","readonly",t=>r.br(t,e).next(e=>e?n.ya.os(t,e):Ko.resolve(null)))}(s.Ac,e);null!==i?("pending"===n?await s.jh.Wc():"acknowledged"===n||"rejected"===n?(yc(s,e,r||null),function(t,e){Nr(Nr(t).Zn).Or(e)}(s.Ac,e)):_r(),await _c(s,i)):vr("SyncEngine","Cannot apply mutation batch with id: "+e)}.bind(null,e),yh:async function(t,e,n,r){const s=Nr(t);if(s.rl)vr("SyncEngine","Ignoring unexpected query state notification.");else if(s.Yh.has(e))switch(n){case"current":case"not-current":{const t=await function(t){const e=Nr(s.Ac),n=Nr(e.ga);return e.persistence.runTransaction("Get new document changes","readonly",t=>n.Gr(t,e.Va)).then(({zr:t,readTime:n})=>(e.Va=n,t))}(),r=_s.ie(e,"current"===n);await _c(s,t,r);break}case"rejected":await Ru(s.Ac,e,!0),wc(s,e,r);break;default:_r()}}.bind(null,e),ph:async function(t,e,n){const r=Sc(t);if(r.rl){for(const t of e){if(r.Yh.has(t)){vr("SyncEngine","Adding an already active target "+t);continue}const e=await Pu(r.Ac,t),n=await ku(r.Ac,e);await fc(r,Ac(e),n.targetId,!1),r.jh.listen(n)}for(const t of n)r.Yh.has(t)&&await Ru(r.Ac,t,!1).then(()=>{r.jh.Gc(t),wc(r,t)}).catch(Vu)}}.bind(null,e),ha:function(t){return Nr(Nr(Nr(t).Ac).persistence).ha()}.bind(null,e)},await this.Gh.start()),await this.persistence.Qo(async t=>{await async function(t,e){const n=Nr(t);if(Sc(n),xc(n),!0===e&&!0!==n.rl){const t=n.Gh.Zu(),e=await Nc(n,t.B());n.rl=!0,await n.jh.hu(!0);for(const t of e)n.jh.listen(t)}else if(!1===e&&!1!==n.rl){const t=[];let e=Promise.resolve();n.Yh.forEach((r,s)=>{n.Gh.hh(s)?t.push(s):e=e.then(()=>(wc(n,s),Ru(n.Ac,s,!0))),n.jh.Gc(s)}),await e,await Nc(n,t),function(t){const e=Nr(n);e.tl.forEach((t,n)=>{e.jh.Gc(n)}),e.el.Cu(),e.tl=new Map,e.Zh=new is(jr.C)}(),n.rl=!1,await n.jh.hu(!1)}}(this.h_.Lu,t),this.i_&&(t&&!this.i_.or?this.i_.start(this.Ac):t||this.i_.stop())})}n_(t){if(t.u_.c_&&t.u_.synchronizeTabs){const e=la();if(!sc.qs(e))throw new Sr(Ar.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Au(t.Kl.nt,t.Kl.persistenceKey);return new sc(e,t.ai,n,t.clientId,t.a_)}return new ic}}class Kc{async initialize(t,e){this.Ac||(this.Ac=t.Ac,this.Gh=t.Gh,this.Rc=this.l_(e),this.jh=this.__(e),this.Lu=this.f_(e),this.d_=this.w_(e),this.Lu.subscribe({Xa:function(t,e){const n=Nr(t);let r=!1;for(const t of e){const e=t.query,s=n._u.get(e);if(s){for(const e of s.listeners)e.du(t)&&(r=!0);s.lu=t}}r&&Hu(n)}.bind(null,this.d_),hl:function(t,e,n){const r=Nr(t),s=r._u.get(e);if(s)for(const t of s.listeners)t.onError(n);r._u.delete(e)}.bind(null,this.d_),ul:function(t,e){const n=Nr(t);n.onlineState=e;let r=!1;n._u.forEach((t,n)=>{for(const t of n.listeners)t.wu(e)&&(r=!0)}),r&&Hu(n)}.bind(null,this.d_)}),this.Gh.lc=(t=>pc(this.Lu,t,1)),this.jh.pc.uu=async function(t,e){const n=Nr(t);if(!n.currentUser.isEqual(e)){vr("SyncEngine","User change. New user:",e.s());const t=await Du(n.Ac,e);n.currentUser=e,function(t,e){t.sl.forEach(t=>{t.forEach(t=>{t.reject(new Sr(Ar.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.sl.clear()}(n),n.Gh.dh(e,t.va,t.Sa),await _c(n,t.ba)}}.bind(null,this.Lu),await this.jh.start(),await this.jh.hu(this.Lu.ol))}w_(t){return new zu}l_(t){const e=Gc(t.Kl.nt),n=jc(t.Kl);return ju(t.credentials,n,e)}__(t){return new $u(this.Ac,this.Rc,t.ai,t=>pc(this.Lu,t,0),qc.qs()?new qc:new Fc)}f_(t){return function(t,e,n,r,s,i){const o=new lc(t,e,n,r,s);return i&&(o.rl=!0),o}(this.Ac,this.jh,this.Gh,t.a_,t.zh,!t.u_.c_||!t.u_.synchronizeTabs)}terminate(){return this.jh.ra()}}function Wc(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class Xc{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.E_(this.observer.next,t)}error(t){this.observer.error?this.E_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}T_(){this.muted=!0}E_(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}function Qc(t,e,n){if(e.length!==n)throw new Sr(Ar.INVALID_ARGUMENT,`Function ${t}() requires `+ih(n,"argument")+", but was called with "+ih(e.length,"argument")+".")}function Jc(t,e,n){if(e.length<n)throw new Sr(Ar.INVALID_ARGUMENT,`Function ${t}() requires at least `+ih(n,"argument")+", but was called with "+ih(e.length,"argument")+".")}function Yc(t,e,n,r){!function(t,e,n,r){let s=!1;if(!(s="object"===e?eh(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){const s=nh(r);throw new Sr(Ar.INVALID_ARGUMENT,`Function ${t}() requires its ${n} to be of type ${e}, but it was: ${s}`)}}(t,e,sh(n)+" argument",r)}function Zc(t){if(!jr.tt(t))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function th(t){if(jr.tt(t))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function eh(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function nh(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":_r()}function rh(t,e,n){if(n<=0)throw new Sr(Ar.INVALID_ARGUMENT,`Function ${t}() requires its ${sh(e)} argument to be a positive number, but it was: ${n}.`)}function sh(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function ih(t,e){return`${t} ${e}`+(1===t?"":"s")}class oh{constructor(t){!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new Sr(Ar.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+ih(1,"element")+".")}(0,t);for(let e=0;e<t.length;++e)if(Yc("FieldPath","string",e,t[e]),0===t[e].length)throw new Sr(Ar.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.I_=new Fr(t)}}class ah extends oh{constructor(...t){super(t)}static documentId(){return new ah(Fr.H().U())}isEqual(t){if(!(t instanceof ah))throw function(t,e,n,r){const s=nh(r);return new Sr(Ar.INVALID_ARGUMENT,`Function isEqual() requires its ${sh(1)} argument to be a FieldPath, but it was: ${s}`)}(0,0,0,t);return this.I_.isEqual(t.I_)}}const uh=new RegExp("[~\\*/\\[\\]]");class ch{constructor(){this.m_=this}}class hh extends ch{constructor(t){super(),this.A_=t}R_(t){if(2!==t.P_)throw 1===t.P_?t.V_(this.A_+"() can only appear at the top level of your update data"):t.V_(this.A_+"() cannot be used with set() unless you pass {merge:true}");return t.Je.push(t.path),null}isEqual(t){return t instanceof hh}}function lh(t,e,n){return new _h({P_:3,g_:e.settings.g_,methodName:t.A_,y_:n},e.nt,e.serializer,e.ignoreUndefinedProperties)}class fh extends ch{constructor(t){super(),this.A_=t}R_(t){return new Fi(t.path,new Ci)}isEqual(t){return t instanceof fh}}class dh extends ch{constructor(t,e){super(),this.A_=t,this.p_=e}R_(t){const e=lh(this,t,!0),n=this.p_.map(t=>Dh(t,e)),r=new ki(n);return new Fi(t.path,r)}isEqual(t){return this===t}}class ph extends ch{constructor(t,e){super(),this.A_=t,this.p_=e}R_(t){const e=lh(this,t,!0),n=this.p_.map(t=>Dh(t,e)),r=new Li(n);return new Fi(t.path,r)}isEqual(t){return this===t}}class gh extends ch{constructor(t,e){super(),this.A_=t,this.b_=e}R_(t){const e=new Vi(t.serializer,si(t.serializer,this.b_));return new Fi(t.path,e)}isEqual(t){return this===t}}class mh{constructor(t,e){if(Qc("GeoPoint",arguments,2),Yc("GeoPoint","number",1,t),Yc("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new Sr(Ar.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Sr(Ar.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.v_=t,this.S_=e}get latitude(){return this.v_}get longitude(){return this.S_}isEqual(t){return this.v_===t.v_&&this.S_===t.S_}toJSON(){return{latitude:this.v_,longitude:this.S_}}V(t){return kr(this.v_,t.v_)||kr(this.S_,t.S_)}}class yh{constructor(t){this.D_=t}static fromBase64String(t){try{return new yh(Yr.fromBase64String(t))}catch(t){throw new Sr(Ar.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+t)}}static fromUint8Array(t){return new yh(Yr.fromUint8Array(t))}toBase64(){return this.D_.toBase64()}toUint8Array(){return this.D_.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this.D_.isEqual(t.D_)}}const wh=/^__.*__$/;class vh{constructor(t,e,n){this.C_=t,this.N_=e,this.x_=n}}class bh{constructor(t,e,n){this.data=t,this.Je=e,this.fieldTransforms=n}O_(t,e){const n=[];return null!==this.Je?n.push(new Ji(t,this.data,this.Je,e)):n.push(new Qi(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Zi(t,this.fieldTransforms)),n}}class Eh{constructor(t,e,n){this.data=t,this.Je=e,this.fieldTransforms=n}O_(t,e){const n=[new Ji(t,this.data,this.Je,e)];return this.fieldTransforms.length>0&&n.push(new Zi(t,this.fieldTransforms)),n}}function Ih(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw _r()}}class _h{constructor(t,e,n,r,s,i){this.settings=t,this.nt=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.k_(),this.fieldTransforms=s||[],this.Je=i||[]}get path(){return this.settings.path}get P_(){return this.settings.P_}F_(t){return new _h(Object.assign(Object.assign({},this.settings),t),this.nt,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Je)}M_(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.F_({path:n,y_:!1});return r.L_(t),r}q_(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.F_({path:n,y_:!1});return r.k_(),r}B_(t){return this.F_({path:void 0,y_:!0})}V_(t){return Ph(t,this.settings.methodName,this.settings.U_||!1,this.path,this.settings.g_)}contains(t){return void 0!==this.Je.find(e=>t.L(e))||void 0!==this.fieldTransforms.find(e=>t.L(e.field))}k_(){if(this.path)for(let t=0;t<this.path.length;t++)this.L_(this.path.get(t))}L_(t){if(0===t.length)throw this.V_("Document fields must not be empty");if(Ih(this.P_)&&wh.test(t))throw this.V_('Document fields cannot begin and end with "__"')}}class Th{constructor(t,e,n){this.nt=t,this.ignoreUndefinedProperties=e,this.serializer=n||Gc(t)}W_(t,e,n,r=!1){return new _h({P_:t,methodName:e,g_:n,path:Fr.K(),y_:!1,U_:r},this.nt,this.serializer,this.ignoreUndefinedProperties)}}function Nh(t,e,n,r,s,i={}){const o=t.W_(i.merge||i.mergeFields?2:0,e,n,s);kh("Data must be an object, but it was:",o,r);const a=Oh(r,o);let u,c;if(i.merge)u=new qi(o.Je),c=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){let s;if(r instanceof oh)s=r.I_;else{if("string"!=typeof r)throw _r();s=Lh(e,r,n)}if(!o.contains(s))throw new Sr(Ar.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Vh(t,s)||t.push(s)}u=new qi(t),c=o.fieldTransforms.filter(t=>u.nn(t.field))}else u=null,c=o.fieldTransforms;return new bh(new so(a),u,c)}function Ah(t,e,n,r){const s=t.W_(1,e,n);kh("Data must be an object, but it was:",s,r);const i=[],o=new io;Rs(r,(t,r)=>{const a=Lh(e,t,n),u=s.q_(a);if(r instanceof ch&&r.m_ instanceof hh)i.push(a);else{const t=Dh(r,u);null!=t&&(i.push(a),o.set(a,t))}});const a=new qi(i);return new Eh(o.rn(),a,s.fieldTransforms)}function Sh(t,e,n,r,s,i){const o=t.W_(1,e,n),a=[Rh(e,r,n)],u=[s];if(i.length%2!=0)throw new Sr(Ar.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<i.length;t+=2)a.push(Rh(e,i[t])),u.push(i[t+1]);const c=[],h=new io;for(let t=a.length-1;t>=0;--t)if(!Vh(c,a[t])){const e=a[t],n=u[t],r=o.q_(e);if(n instanceof ch&&n.m_ instanceof hh)c.push(e);else{const t=Dh(n,r);null!=t&&(c.push(e),h.set(e,t))}}const l=new qi(c);return new Eh(h.rn(),l,o.fieldTransforms)}function xh(t,e,n,r=!1){return Dh(n,t.W_(r?4:3,e))}function Dh(t,e){if(Ch(t))return kh("Unsupported field value:",e,t),Oh(t,e);if(t instanceof ch)return function(t,e){if(!Ih(e.P_))throw e.V_(t.A_+"() can only be used with update() and set()");if(!e.path)throw e.V_(t.A_+"() is not currently supported inside arrays");const n=t.R_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Je.push(e.path),t instanceof Array){if(e.settings.y_&&4!==e.P_)throw e.V_("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=Dh(s,e.B_(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return si(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Pr.fromDate(t);return{timestampValue:ii(e.serializer,n)}}if(t instanceof Pr){const n=new Pr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ii(e.serializer,n)}}if(t instanceof mh)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof yh)return{bytesValue:oi(e.serializer,t.D_)};if(t instanceof vh){const n=e.nt,r=t.C_;if(!r.isEqual(n))throw e.V_(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ui(t.C_||e.nt,t.N_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.V_("Unsupported field value: "+nh(t))}(t,e)}function Oh(t,e){const n={};return Ls(t)?e.path&&e.path.length>0&&e.Je.push(e.path):Rs(t,(t,r)=>{const s=Dh(r,e.M_(t));null!=s&&(n[t]=s)}),{mapValue:{fields:n}}}function Ch(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Pr||t instanceof mh||t instanceof yh||t instanceof vh||t instanceof ch)}function kh(t,e,n){if(!Ch(n)||!eh(n)){const r=nh(n);throw"an object"===r?e.V_(t+" a custom object"):e.V_(t+" "+r)}}function Rh(t,e,n){if(e instanceof oh)return e.I_;if("string"==typeof e)return Lh(t,e);throw Ph("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Lh(t,e,n){try{return function(t){if(t.search(uh)>=0)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`);try{return new ah(...t.split("."))}catch(e){throw new Sr(Ar.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`)}}(e).I_}catch(e){throw Ph((r=e)instanceof Error?r.message:r.toString(),t,!1,void 0,n)}var r}function Ph(t,e,n,r,s){const i=r&&!r.$(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(i||o)&&(u+=" (found",i&&(u+=" in field "+r),o&&(u+=" in document "+s),u+=")"),new Sr(Ar.INVALID_ARGUMENT,a+t+u)}function Vh(t,e){return t.some(t=>t.isEqual(e))}class Uh{constructor(t){this.Rc=t,this.K_=new Map,this.mutations=[],this.Q_=!1,this.j_=null,this.G_=new Set}async z_(t){if(this.H_(),this.mutations.length>0)throw new Sr(Ar.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=Nr(t),r=pi(n.serializer)+"/documents",s={documents:e.map(t=>hi(n.serializer,t))},i=await n.hc("BatchGetDocuments",r,s),o=new Map;i.forEach(t=>{const e=function(t,e){return"found"in e?function(t,e){Tr(!!e.found),e.found.name,e.found.updateTime;const n=li(t,e.found.name),r=ai(e.found.updateTime),s=new so({mapValue:{fields:e.found.fields}});return new uo(n,r,s,{})}(t,e):"missing"in e?function(t,e){Tr(!!e.missing),Tr(!!e.readTime);const n=li(t,e.missing),r=ai(e.readTime);return new co(n,r)}(t,e):_r()}(n.serializer,t);o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{const e=o.get(t.toString());Tr(!!e),a.push(e)}),a}(this.Rc,t);return e.forEach(t=>{t instanceof co||t instanceof uo?this.J_(t):_r()}),e}set(t,e){this.write(e.O_(t,this.Ze(t))),this.G_.add(t.toString())}update(t,e){try{this.write(e.O_(t,this.Y_(t)))}catch(t){this.j_=t}this.G_.add(t.toString())}delete(t){this.write([new no(t,this.Ze(t))]),this.G_.add(t.toString())}async commit(){if(this.H_(),this.j_)throw this.j_;const t=this.K_;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,e)=>{const n=jr.Y(e);this.mutations.push(new ro(n,this.Ze(n)))}),await async function(t,e){const n=Nr(t),r=pi(n.serializer)+"/documents",s={writes:e.map(t=>yi(n.serializer,t))};await n.uc("Commit",r,s)}(this.Rc,this.mutations),this.Q_=!0}J_(t){let e;if(t instanceof uo)e=t.version;else{if(!(t instanceof co))throw _r();e=Vr.min()}const n=this.K_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Sr(Ar.ABORTED,"Document version changed between two reads.")}else this.K_.set(t.key.toString(),e)}Ze(t){const e=this.K_.get(t.toString());return!this.G_.has(t.toString())&&e?Gi.updateTime(e):Gi.tn()}Y_(t){const e=this.K_.get(t.toString());if(!this.G_.has(t.toString())&&e){if(e.isEqual(Vr.min()))throw new Sr(Ar.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Gi.updateTime(e)}return Gi.exists(!0)}write(t){this.H_(),this.mutations=this.mutations.concat(t)}H_(){}}class Mh{constructor(t,e,n,r){this.ai=t,this.Rc=e,this.updateFunction=n,this.hi=r,this.X_=5,this.Pi=new ea(this.ai,"transaction_retry")}run(){this.Z_()}Z_(){this.Pi.xs(async()=>{const t=new Uh(this.Rc),e=this.tf(t);e&&e.then(e=>{this.ai.di(()=>t.commit().then(()=>{this.hi.resolve(e)}).catch(t=>{this.ef(t)}))}).catch(t=>{this.ef(t)})})}tf(t){try{const e=this.updateFunction(t);return!Br(e)&&e.catch&&e.then?e:(this.hi.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.hi.reject(t),null}}ef(t){this.X_>0&&this.nf(t)?(this.X_-=1,this.ai.di(()=>(this.Z_(),Promise.resolve()))):this.hi.reject(t)}nf(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!rs(e)}return!1}}function qh(t,e,n){const r=new ta;return t.di(()=>(async function(t,e,n){const r=xc(t);r.al("write()");try{const s=await function(t,e){const n=Nr(t),r=Pr.now(),s=e.reduce((t,e)=>t.add(e.key),ys());let i;return n.persistence.runTransaction("Locally write mutations","readwrite",t=>n.ya.os(t,s).next(s=>{i=s;const o=[];for(const t of e){const e=Ki(t,i.get(t.key));null!=e&&o.push(new Ji(t.key,e,oo(e.proto.mapValue),Gi.exists(!0)))}return n.Zn.gr(t,r,o,e)})).then(t=>{const e=t.Vn(i);return{batchId:t.batchId,Ln:e}})}(r.Ac,e);r.Gh.nh(s.batchId),function(t,e,n){let r=t.nl[t.currentUser.s()];r||(r=new is(kr)),r=r.ft(e,n),t.nl[t.currentUser.s()]=r}(r,s.batchId,n),await _c(r,s.Ln),await r.jh.Wc()}catch(t){const e=ga(t,"Failed to persist write");n.reject(e)}})(e,n,r)),r.promise}function Fh(t,e,n,r){return t.enqueue(()=>(n.Go(r),r?e.enableNetwork():e.disableNetwork()))}function jh(t,e,n,r,s){const i=new Xc(s),o=new Ku(n,i,r);return t.di(()=>(async function(t,e){const n=Nr(t),r=e.query;let s=!1,i=n._u.get(r);if(i||(s=!0,i=new Bu),s)try{i.lu=await n.sf(r)}catch(t){const n=ga(t,`Initialization of query '${No(e.query)}' failed`);return void e.onError(n)}n._u.set(r,i),i.listeners.push(e),e.wu(n.onlineState),i.lu&&e.du(i.lu)&&Hu(n)})(e,o)),()=>{i.T_(),t.di(()=>(async function(t,e){const n=Nr(t),r=e.query;let s=!1;const i=n._u.get(r);if(i){const t=i.listeners.indexOf(e);t>=0&&(i.listeners.splice(t,1),s=0===i.listeners.length)}if(s)return n._u.delete(r),n.if(r)})(e,o))}}function Gh(t,e,n,r){const s=new ta,i=jh(t,e,go(n.path),{includeMetadataChanges:!0,Pu:!0},{next:t=>{i();const e=t.docs.has(n);!e&&t.fromCache?s.reject(new Sr(Ar.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&r&&"server"===r.source?s.reject(new Sr(Ar.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(t)},error:t=>s.reject(t)});return s.promise}function $h(t,e,n,r){const s=new ta,i=jh(t,e,n,{includeMetadataChanges:!0,Pu:!0},{next:t=>{i(),t.fromCache&&r&&"server"===r.source?s.reject(new Sr(Ar.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(t)},error:t=>s.reject(t)});return s.promise}const Bh=new Map;class zh{constructor(t,e){this.app=t,this.rf="(lite)",this.af=!1,this.INTERNAL={delete:()=>this._delete()},this.C_=zh.cf(t),this.uf=new Dr(e)}get hf(){return this.af}get lf(){return void 0!==this._f}ff(t){if(this.af)throw new Sr(Ar.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. initializeFirestore() cannot be called after calling getFirestore().");this.df=t}wf(){return this.df||(this.df={}),this.af=!0,this.df}static cf(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Sr(Ar.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $r(t.options.projectId)}_delete(){return this._f||(this._f=this.Ef()),this._f}Ef(){return function(t){const e=Bh.get(t);e&&(vr("ComponentProvider","Removing Datastore"),Bh.delete(t),e.terminate())}(this),Promise.resolve()}}class Hh{constructor(t,e,n,r,s){this.nt=t,this.timestampsInSnapshots=e,this.Tf=n,this.If=r,this.mf=s}Af(t){switch(Ms(t)){case 0:return null;case 1:return t.booleanValue;case 2:return zs(t.integerValue||t.doubleValue);case 3:return this.Rf(t.timestampValue);case 4:return this.Pf(t);case 5:return t.stringValue;case 6:return this.mf(Hs(t.bytesValue));case 7:return this.Vf(t.referenceValue);case 8:return this.gf(t.geoPointValue);case 9:return this.yf(t.arrayValue);case 10:return this.pf(t.mapValue);default:throw _r()}}pf(t){const e={};return Rs(t.fields||{},(t,n)=>{e[t]=this.Af(n)}),e}gf(t){return new mh(zs(t.latitude),zs(t.longitude))}yf(t){return(t.values||[]).map(t=>this.Af(t))}Pf(t){switch(this.Tf){case"previous":const e=function t(e){const n=e.mapValue.fields.__previous_value__;return Ps(n)?t(n):n}(t);return null==e?null:this.Af(e);case"estimate":return this.Rf(Vs(t));default:return null}}Rf(t){const e=Bs(t),n=new Pr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()}Vf(t){const e=Mr.W(t);Tr(Ai(e));const n=new $r(e.get(1),e.get(3)),r=new jr(e.O(5));return n.isEqual(this.nt)||br(`Document ${r} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${this.nt.projectId}/${this.nt.database}) instead.`),this.If(r)}}const Kh=va.Yi;class Wh{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}function Xh(t,e,n){if("string"==typeof n){if(""===n)throw new Sr(Ar.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!bo(e)&&-1!==n.indexOf("/"))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(Mr.W(n));if(!jr.tt(r))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ks(t,new jr(r))}if(n instanceof vh)return Ks(t,n.N_);throw new Sr(Ar.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+nh(n)+".")}function Qh(t,e){if(!Array.isArray(t)||0===t.length)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`);if("in"===e||"array-contains-any"===e){if(t.indexOf(null)>=0)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters cannot contain 'null' in the value array.`);if(t.filter(t=>Number.isNaN(t)).length>0)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters cannot contain 'NaN' in the value array.`)}}function Jh(t,e,n){if(!n.isEqual(e))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function Yh(t){if(yo(t)&&0===t._n.length)throw new Sr(Ar.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function Zh(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}const tl=new Map,el=new Map;async function nl(t,e,n){const r=new ta;tl.set(t,r.promise);const s=await t.bf();s.u_=e,vr("ComponentProvider","Initializing OfflineComponentProvider"),await n.initialize(s),t.vf(e=>t.Sf.di(()=>Du(n.Ac,e))),n.persistence.jo(()=>t._delete()),r.resolve(n)}async function rl(t,e){const n=new ta;el.set(t,n.promise);const r=await t.bf(),s=await sl(t);vr("ComponentProvider","Initializing OnlineComponentProvider"),await e.initialize(s,r),t.vf(n=>t.Sf.di(()=>e.jh.uu(n))),n.resolve(e)}function sl(t){return ol(t),tl.has(t)||(vr("ComponentProvider","Using default OfflineComponentProvider"),nl(t,{c_:!1},new Bc)),tl.get(t)}function il(t){return ol(t),el.has(t)||(vr("ComponentProvider","Using default OnlineComponentProvider"),rl(t,new Kc)),el.get(t)}function ol(t){if(t.lf)throw new Sr(Ar.FAILED_PRECONDITION,"The client has already been terminated.")}function al(t){return il(t).then(t=>t.Lu)}function ul(t){return il(t).then(t=>t.jh)}function cl(t){return il(t).then(t=>{const e=t.d_;return e.sf=async function(t,e){const n=Sc(t);let r,s;n.al("listen()");const i=n.Jh.get(e);if(i)r=i.targetId,n.Gh.oh(r),s=i.view.Kh();else{const t=await ku(n.Ac,Io(e)),i=n.Gh.oh(t.targetId);r=t.targetId,s=await fc(n,e,r,"current"===i),n.ol&&n.jh.listen(t)}return s}.bind(null,t.Lu),e.if=async function(t,e){const n=Nr(t);n.al("unlisten()");const r=n.Jh.get(e),s=n.Yh.get(r.targetId);if(s.length>1)return n.Yh.set(r.targetId,s.filter(t=>!_o(t,e))),void n.Jh.delete(e);n.ol?(n.Gh.uh(r.targetId),n.Gh.eh(r.targetId)||await Ru(n.Ac,r.targetId,!1).then(()=>{n.Gh.lh(r.targetId),n.jh.Gc(r.targetId),wc(n,r.targetId)}).catch(Vu)):(wc(n,r.targetId),await Ru(n.Ac,r.targetId,!0))}.bind(null,t.Lu),e})}function hl(t){return sl(t).then(t=>t.persistence)}function ll(t){return sl(t).then(t=>t.Ac)}class fl extends zh{constructor(t,e){super(t,e),this.Sf=new pa,this.Df=Cr.P(),this.Cf=new ta,this.Nf=mr.UNAUTHENTICATED,this.xf=(()=>{}),this.rf=t.name,this.uf.A(t=>{this.Nf=t,this.Cf.resolve()})}vf(t){vr("Firestore","Registering credential change listener"),this.xf=t,this.Cf.promise.then(()=>this.xf(this.Nf))}async bf(){var t,e;const n=this.wf();await this.Cf.promise;const r=new Gr(this.C_,this.rf,null!==(t=n.host)&&void 0!==t?t:"firestore.googleapis.com",null===(e=n.ssl)||void 0===e||e,!1);return{ai:this.Sf,Kl:r,clientId:this.Df,credentials:this.uf,a_:this.Nf,zh:100,u_:{c_:!1}}}wf(){return super.wf()}Ef(){this.Sf.vi();const t=new ta;return this.Sf.yi(async()=>{try{await super.Ef(),await async function(t){const e=el.get(t);e&&(vr("ComponentProvider","Removing OnlineComponentProvider"),el.delete(t),await(await e).terminate());const n=tl.get(t);n&&(vr("ComponentProvider","Removing OfflineComponentProvider"),tl.delete(t),await(await n).terminate())}(this),this.uf.R(),t.resolve()}catch(e){const n=ga(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}}function dl(t){if(t.hf)throw new Sr(Ar.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class pl extends oh{constructor(...t){super(t)}isEqual(t){const e=lo(t,pl);return this.I_.isEqual(e.I_)}}class gl extends vh{constructor(t,e,n){super(t.C_,new jr(n),e),this.firestore=t,this.converter=e,this.Of=n,this.type="document"}get id(){return this.Of.M()}get path(){return this.Of.U()}get parent(){return new Tl(this.firestore,this.x_,this.N_.path.k())}collection(t){xl("DocumentReference.collection","path",t);const e=Mr.W(this.path).child(Mr.W(t));return th(e),new Tl(this.firestore,null,e)}withConverter(t){return new gl(this.firestore,t,this.Of)}}class ml{constructor(t,e,n){this.firestore=t,this.converter=e,this.kf=n,this.type="query"}withConverter(t){return new ml(this.firestore,t,this.kf)}}class yl{}class wl extends yl{constructor(t,e,n){super(),this.Ff=t,this.Mf=e,this.$f=n,this.type="where"}apply(t){const e=Sl(t.firestore),n=function(t,e,n,r,s,i,o){let a;if(s.G()){if("array-contains"===i||"array-contains-any"===i)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on FieldPath.documentId().`);if("in"===i||"not-in"===i){Qh(o,i);const e=[];for(const n of o)e.push(Xh(r,t,n));a={arrayValue:{values:e}}}else a=Xh(r,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Qh(o,i),a=xh(n,e,o,"in"===i||"not-in"===i);const u=xo.create(s,i,a);return function(t,e){if(e.En()){const n=vo(t);if(null!==n&&!n.isEqual(e.field))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const r=wo(t);null!==r&&Jh(0,e.field,r)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==n)throw n===e.op?new Sr(Ar.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Sr(Ar.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,u),u}(t.kf,"where",e,t.firestore.C_,this.Ff,this.Mf,this.$f);return new ml(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new fo(t.path,t.collectionGroup,t._n.slice(),n,t.limit,t.fn,t.startAt,t.endAt)}(t.kf,n))}}class vl extends yl{constructor(t,e){super(),this.Ff=t,this.Lf=e,this.type="orderBy"}apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new Sr(Ar.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Sr(Ar.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new jo(e,n);return function(t,e){if(null===wo(t)){const n=vo(t);null!==n&&Jh(0,n,e.field)}}(t,r),r}(t.kf,this.Ff,this.Lf);return new ml(t.firestore,t.converter,function(t,e){const n=t._n.concat([e]);return new fo(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.fn,t.startAt,t.endAt)}(t.kf,e))}}class bl extends yl{constructor(t,e,n){super(),this.type=t,this.qf=e,this.Bf=n}apply(t){return new ml(t.firestore,t.converter,function(t,e,n){return new fo(t.path,t.collectionGroup,t._n.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}(t.kf,this.qf,this.Bf))}}class El extends yl{constructor(t,e,n){super(),this.type=t,this.Uf=e,this.Wf=n}apply(t){const e=_l(t,this.type,this.Uf,this.Wf);return new ml(t.firestore,t.converter,function(t,e){return new fo(t.path,t.collectionGroup,t._n.slice(),t.filters.slice(),t.limit,t.fn,e,t.endAt)}(t.kf,e))}}class Il extends yl{constructor(t,e,n){super(),this.type=t,this.Uf=e,this.Wf=n}apply(t){const e=_l(t,this.type,this.Uf,this.Wf);return new ml(t.firestore,t.converter,function(t,e){return new fo(t.path,t.collectionGroup,t._n.slice(),t.filters.slice(),t.limit,t.fn,t.startAt,e)}(t.kf,e))}}function _l(t,e,n,r){if(n[0]instanceof Dl)return Qc(e,n,1),function(t,e,n,r,s){if(!r)throw new Sr(Ar.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");const i=[];for(const n of Eo(t))if(n.field.G())i.push(Ks(e,r.key));else{const t=r.field(n.field);if(Ps(t))throw new Sr(Ar.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.U();throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}i.push(t)}return new Uo(i,s)}(t.kf,t.firestore.C_,e,n[0].Kf,r);{const s=Sl(t.firestore);return function(t,e,n,r,s,i){const o=t._n;if(s.length>o.length)throw new Sr(Ar.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<s.length;i++){const u=s[i];if(o[i].field.G()){if("string"!=typeof u)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof u}`);if(!bo(t)&&-1!==u.indexOf("/"))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${r}() must be a plain document ID, but '${u}' contains a slash.`);const n=t.path.child(Mr.W(u));if(!jr.tt(n))throw new Sr(Ar.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const s=new jr(n);a.push(Ks(e,s))}else{const t=xh(n,r,u);a.push(t)}}return new Uo(a,i)}(t.kf,t.firestore.C_,s,e,n,r)}}class Tl extends ml{constructor(t,e,n){super(t,e,go(n)),this.firestore=t,this.Of=n,this.type="collection"}get id(){return this.kf.path.M()}get path(){return this.kf.path.U()}get parent(){const t=this.Of.k();return t.$()?null:new gl(this.firestore,null,t)}doc(t){0===arguments.length&&(t=Cr.P()),xl("CollectionReference.doc","path",t);const e=this.Of.child(Mr.W(t));return Zc(e),new gl(this.firestore,this.converter,e)}withConverter(t){return new Tl(this.firestore,t,this.Of)}}function Nl(t,e){if(1===arguments.length&&(e=Cr.P()),xl("doc","path",e),t instanceof zh){const n=Mr.W(e);return Zc(n),new gl(t,null,n)}{if(!(t instanceof gl||t instanceof Tl))throw new Sr(Ar.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t.Of.child(Mr.W(e));return Zc(n),new gl(t.firestore,t instanceof Tl?t.converter:null,n)}}function Al(t,e){return t instanceof ml&&e instanceof ml&&t.firestore===e.firestore&&_o(t.kf,e.kf)&&t.converter===e.converter}function Sl(t){const e=t.wf(),n=Gc(t.C_);return new Th(t.C_,!!e.ignoreUndefinedProperties,n)}function xl(t,e,n){if(!n)throw new Sr(Ar.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}class Dl{constructor(t,e,n,r){this.Qf=t,this.N_=e,this.Kf=n,this.x_=r}get id(){return this.N_.path.M()}get ref(){return new gl(this.Qf,this.x_,this.N_.path)}exists(){return null!==this.Kf}data(){if(this.Kf){if(this.x_){const t=new Ol(this.Qf,this.N_,this.Kf,null);return this.x_.fromFirestore(t)}return new Hh(this.Qf.C_,!0,"none",t=>new gl(this.Qf,null,t.path),t=>new yh(t)).Af(this.Kf.ln())}}get(t){if(this.Kf){const e=this.Kf.data().field(Cl("DocumentSnapshot.get",t));if(null!==e)return new Hh(this.Qf.C_,!0,"none",t=>new gl(this.Qf,this.x_,t.path),t=>new yh(t)).Af(e)}}}class Ol extends Dl{data(){return super.data()}}function Cl(t,e){return"string"==typeof e?Lh(t,e):lo(e,pl).I_}class kl extends Dl{constructor(t,e,n,r,s){super(t,e,n,s),this.Qf=t,this.metadata=r,this.jf=lo(t,fl)}exists(){return super.exists()}data(t){if(this.Kf){if(this.x_){const e=new Rl(this.Qf,this.N_,this.Kf,this.metadata,null);return this.x_.fromFirestore(e,t)}return new Hh(this.jf.C_,!0,(null==t?void 0:t.serverTimestamps)||"none",t=>new gl(this.Qf,null,t.path),t=>new yh(t)).Af(this.Kf.ln())}}get(t,e={}){if(this.Kf){const n=this.Kf.data().field(Cl("DocumentSnapshot.get",t));if(null!==n)return new Hh(this.jf.C_,!0,e.serverTimestamps||"none",t=>new gl(this.Qf,this.x_,t.path),t=>new yh(t)).Af(n)}}}class Rl extends kl{data(t={}){return super.data(t)}}class Ll{constructor(t,e,n){this.Qf=t,this.query=e,this.Gf=n,this.metadata=new Wh(n.hasPendingWrites,n.fromCache)}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this.Gf.docs.size}get empty(){return 0===this.size}forEach(t,e){this.Gf.docs.forEach(n=>{t.call(e,this.zf(n,this.Gf.fromCache,this.Gf.Jt.has(n.key)))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this.Gf.Xt)throw new Sr(Ar.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Hf&&this.Jf===e||(this.Hf=function(t,e,n){if(t.Ht.$()){let e,r=0;return t.docChanges.map(s=>{const i=n(s.doc,t.fromCache,t.Jt.has(s.doc.key));return e=s.doc,{type:"added",doc:i,oldIndex:-1,newIndex:r++}})}{let r=t.Ht;return t.docChanges.filter(t=>e||3!==t.type).map(e=>{const s=n(e.doc,t.fromCache,t.Jt.has(e.doc.key));let i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _r()}}(e.type),doc:s,oldIndex:i,newIndex:o}})}}(this.Gf,e,this.zf.bind(this)),this.Jf=e),this.Hf}zf(t,e,n){return new Rl(this.Qf,t.key,t,new Wh(n,e),this.query.converter)}}class Pl{constructor(t,e){this.Qf=t,this.Yf=e,this.Xf=[],this.Zf=!1,this.td=Sl(t)}set(t,e,n){this.ed();const r=Vl(t,this.Qf),s=Zh(r.x_,e,n),i=Nh(this.td,"WriteBatch.set",r.N_,s,null!==r.x_,n);return this.Xf=this.Xf.concat(i.O_(r.N_,Gi.tn())),this}update(t,e,n,...r){this.ed();const s=Vl(t,this.Qf);let i;return i="string"==typeof e||e instanceof pl?Sh(this.td,"WriteBatch.update",s.N_,e,n,r):Ah(this.td,"WriteBatch.update",s.N_,e),this.Xf=this.Xf.concat(i.O_(s.N_,Gi.exists(!0))),this}delete(t){this.ed();const e=Vl(t,this.Qf);return this.Xf=this.Xf.concat(new no(e.N_,Gi.tn())),this}commit(){return this.ed(),this.Zf=!0,this.Xf.length>0?this.Yf(this.Xf):Promise.resolve()}ed(){if(this.Zf)throw new Sr(Ar.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Vl(t,e){if(t.firestore!==e)throw new Sr(Ar.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return lo(t,gl)}class Ul extends class{constructor(t,e){this.Qf=t,this.nd=e,this.td=Sl(t)}get(t){const e=Vl(t,this.Qf);return this.nd.z_([e.N_]).then(t=>{if(!t||1!==t.length)return _r();const n=t[0];if(n instanceof co)return new Dl(this.Qf,e.N_,null,e.x_);if(n instanceof uo)return new Dl(this.Qf,n.key,n,e.x_);throw _r()})}set(t,e,n){const r=Vl(t,this.Qf),s=Zh(r.x_,e,n),i=Nh(this.td,"Transaction.set",r.N_,s,null!==r.x_,n);return this.nd.set(r.N_,i),this}update(t,e,n,...r){const s=Vl(t,this.Qf);let i;return i="string"==typeof e||e instanceof pl?Sh(this.td,"Transaction.update",s.N_,e,n,r):Ah(this.td,"Transaction.update",s.N_,e),this.nd.update(s.N_,i),this}delete(t){const e=Vl(t,this.Qf);return this.nd.delete(e.N_),this}}{constructor(t,e){super(t,e),this.Qf=t}get(t){const e=Vl(t,this.Qf);return super.get(t).then(t=>new kl(this.Qf,e.N_,t.Kf,new Wh(!1,!1),e.x_))}}function Ml(t,e,n){const r=n.docs.get(e.N_);return new kl(t,e.N_,r,new Wh(n.hasPendingWrites,n.fromCache),e.x_)}class ql extends ch{}class Fl extends ql{constructor(t){super(),this.m_=t,this.A_=t.A_}R_(t){return this.m_.R_(t)}isEqual(t){return t instanceof Fl&&this.m_.isEqual(t.m_)}}e._registerComponent(new h("firestore-exp",t=>((t,e)=>new fl(t,e))(t.getProvider("app-exp").getImmediate(),t.getProvider("auth-internal")),"PUBLIC")),e.registerVersion("firestore-exp","0.0.800","node"),t.Bytes=yh,t.CollectionReference=Tl,t.DocumentReference=gl,t.DocumentSnapshot=kl,t.FieldPath=pl,t.FieldValue=ql,t.FirebaseFirestore=fl,t.GeoPoint=mh,t.Query=ml,t.QueryConstraint=yl,t.QueryDocumentSnapshot=Rl,t.QuerySnapshot=Ll,t.SnapshotMetadata=Wh,t.Timestamp=Pr,t.Transaction=Ul,t.WriteBatch=Pl,t.addDoc=function(t,e){const n=lo(t,Tl),r=lo(n.firestore,fl),s=Nl(n),i=Zh(n.converter,e),o=Nh(Sl(n.firestore),"addDoc",s.N_,i,null!==n.converter,{});return al(r).then(t=>qh(r.Sf,t,o.O_(s.N_,Gi.exists(!1)))).then(()=>s)},t.arrayRemove=function(...t){return Jc("arrayRemove()",arguments,1),new Fl(new ph("arrayRemove",t))},t.arrayUnion=function(...t){return Jc("arrayUnion()",arguments,1),new Fl(new dh("arrayUnion",t))},t.clearIndexedDbPersistence=function(t){const e=lo(t,fl);if(e.hf&&!e.lf)throw new Sr(Ar.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const n=new ta;return e.Sf.yi(async()=>{try{await Su(Au(e.C_,e.rf)),n.resolve()}catch(t){n.reject(t)}}),n.promise},t.collection=function(t,e){if(xl("collection","path",e),t instanceof zh){const n=Mr.W(e);return th(n),new Tl(t,null,n)}{if(!(t instanceof gl||t instanceof Tl))throw new Sr(Ar.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=Mr.W(t.path).child(Mr.W(e));return th(n),new Tl(t.firestore,null,n)}},t.collectionGroup=function(t,e){const n=lo(t,zh);if(xl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Sr(Ar.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ml(n,null,function(t){return new fo(Mr.K(),t)}(e))},t.deleteDoc=function(t){const e=lo(t,gl),n=lo(e.firestore,fl);return al(n).then(t=>qh(n.Sf,t,[new no(e.N_,Gi.tn())]))},t.deleteField=function(){return new Fl(new hh("deleteField"))},t.disableNetwork=function(t){const e=lo(t,fl);return Promise.all([ul(e),hl(e)]).then(([t,n])=>Fh(e.Sf,t,n,!1))},t.doc=Nl,t.documentId=function(){return new pl("__name__")},t.enableIndexedDbPersistence=function(t){const e=lo(t,fl);return dl(e),nl(e,{c_:!0,synchronizeTabs:!1,cacheSizeBytes:e.wf().cacheSizeBytes||va.Zi,So:!1},new zc)},t.enableMultiTabIndexedDbPersistence=function(t){const e=lo(t,fl);dl(e);const n=e.wf(),r=new Kc,s=new Hc(r);return nl(e,{c_:!0,synchronizeTabs:!0,cacheSizeBytes:n.cacheSizeBytes||va.Zi,So:!1},s).then(()=>rl(e,r))},t.enableNetwork=function(t){const e=lo(t,fl);return Promise.all([ul(e),hl(e)]).then(([t,n])=>Fh(e.Sf,t,n,!0))},t.endAt=function(...t){return new Il("endAt",t,!1)},t.endBefore=function(...t){return new Il("endBefore",t,!0)},t.getDoc=function(t){const e=lo(t,gl),n=lo(e.firestore,fl);return cl(n).then(t=>Gh(n.Sf,t,e.N_).then(t=>Ml(n,e,t)))},t.getDocFromCache=function(t){const e=lo(t,gl),n=lo(e.firestore,fl);return ll(n).then(t=>(async function(t,e,n){const r=new ta;return await t.enqueue(async()=>{try{const t=await function(t,e){const n=Nr(t);return n.persistence.runTransaction("read document","readonly",t=>n.ya.es(t,e))}(e,n);t instanceof uo?r.resolve(t):t instanceof co?r.resolve(null):r.reject(new Sr(Ar.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const e=ga(t,`Failed to get document '${n} from cache`);r.reject(e)}}),r.promise})(n.Sf,t,e.N_).then(t=>new kl(n,e.N_,t,new Wh(t instanceof uo&&t.sn,!0),e.x_)))},t.getDocFromServer=function(t){const e=lo(t,gl),n=lo(e.firestore,fl);return cl(n).then(t=>Gh(n.Sf,t,e.N_,{source:"server"}).then(t=>Ml(n,e,t)))},t.getDocs=function(t){const e=lo(t,ml),n=lo(t.firestore,fl);return Yh(e.kf),cl(n).then(t=>$h(n.Sf,t,e.kf).then(t=>new Ll(n,e,t)))},t.getDocsFromCache=function(t){const e=lo(t,ml),n=lo(t.firestore,fl);return ll(n).then(t=>(async function(t,e,n){const r=new ta;return await t.enqueue(async()=>{try{const t=await Lu(e,n,!0),s=new uc(n,t.Da),i=s.kh(t.documents),o=s.zn(i,!1);r.resolve(o.snapshot)}catch(t){const e=ga(t,`Failed to execute query '${n} against cache`);r.reject(e)}}),r.promise})(n.Sf,t,e.kf).then(t=>new Ll(n,e,t)))},t.getDocsFromServer=function(t){const e=lo(t,ml),n=lo(t.firestore,fl);return cl(n).then(t=>$h(n.Sf,t,e.kf,{source:"server"}).then(t=>new Ll(n,e,t)))},t.getFirestore=function(t){return e._getProvider(t,"firestore-exp").getImmediate()},t.increment=function(t){return new Fl(new gh("increment",t))},t.initializeFirestore=function(t,n){const r=e._getProvider(t,"firestore-exp").getImmediate();if(void 0!==n.cacheSizeBytes&&n.cacheSizeBytes!==Kh&&n.cacheSizeBytes<va.Xi)throw new Sr(Ar.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+va.Xi);return r.ff(n),r},t.limit=function(t){return rh("limit",1,t),new bl("limit",t,"F")},t.limitToLast=function(t){return rh("limitToLast",1,t),new bl("limitToLast",t,"L")},t.onSnapshot=function(t,...e){var n,r,s;let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Wc(e[o])||(i=e[o],o++);const a={includeMetadataChanges:i.includeMetadataChanges};if(Wc(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(s=t.complete)||void 0===s?void 0:s.bind(t)}let u;if(t instanceof gl){const n=lo(t.firestore,fl),r={next:r=>{e[o]&&e[o](Ml(n,t,r))},error:e[o+1],complete:e[o+2]};u=cl(n).then(e=>jh(n.Sf,e,go(t.N_.path),a,r))}else{const n=lo(t,ml),r=lo(n.firestore,fl),s={next:t=>{e[o]&&e[o](new Ll(r,n,t))},error:e[o+1],complete:e[o+2]};Yh(n.kf),u=cl(r).then(t=>jh(r.Sf,t,n.kf,a,s))}return()=>{u.then(t=>t())}},t.onSnapshotsInSync=function(t,e){const n=lo(t,fl),r=Wc(e)?e:{next:e},s=cl(n).then(t=>(function(t,e,n){const r=new Xc(n);return t.di(async()=>(function(t,e){Nr(t).fu.add(e),e.next()})(e,r)),()=>{r.T_(),t.di(async()=>(function(t,e){Nr(t).fu.delete(e)})(e,r))}})(n.Sf,t,r));return()=>{s.then(t=>t())}},t.orderBy=function(t,e="asc"){const n=e,r=Cl("orderBy",t);return new vl(r,n)},t.query=function(t,...e){let n=lo(t,ml);for(const t of e)n=t.apply(n);return n},t.queryEqual=Al,t.refEqual=function(t,e){return(t instanceof gl||t instanceof Tl)&&(e instanceof gl||e instanceof Tl)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter},t.runTransaction=function(t,e){const n=lo(t,fl),r=function(t){var e,n;if(t.lf)throw new Sr(Ar.FAILED_PRECONDITION,"The client has already been terminated.");if(!Bh.has(t)){vr("ComponentProvider","Initializing Datastore");const r=t.wf(),s=new Gr(t.C_,t.rf,null!==(e=r.host)&&void 0!==e?e:"firestore.googleapis.com",null===(n=r.ssl)||void 0===n||n,!1),i=jc(s),o=Gc(s.nt),a=ju(t.uf,i,o);Bh.set(t,a)}return Bh.get(t)}(n),s=new ta;return new Mh(new pa,r,t=>e(new Ul(n,t)),s).run(),s.promise},t.serverTimestamp=function(){return new Fl(new fh("serverTimestamp"))},t.setDoc=function(t,e,n){const r=lo(t,gl),s=lo(r.firestore,fl),i=Zh(r.x_,e,n),o=Nh(Sl(s),"setDoc",r.N_,i,null!==r.x_,n);return al(s).then(t=>qh(s.Sf,t,o.O_(r.N_,Gi.tn())))},t.setLogLevel=function(t){yr.setLogLevel(t)},t.snapshotEqual=function(t,e){return t instanceof kl&&e instanceof kl?t.Qf===e.Qf&&t.N_.isEqual(e.N_)&&(null===t.Kf?null===e.Kf:t.Kf.isEqual(e.Kf))&&t.x_===e.x_:t instanceof Ll&&e instanceof Ll&&t.Qf===e.Qf&&Al(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.Gf.isEqual(e.Gf)},t.startAfter=function(...t){return new El("startAfter",t,!1)},t.startAt=function(...t){return new El("startAt",t,!0)},t.terminate=function(t){return e._removeServiceInstance(t.app,"firestore-exp"),lo(t,fl)._delete()},t.updateDoc=function(t,e,n,...r){const s=lo(t,gl),i=lo(s.firestore,fl),o=Sl(i);let a;return a="string"==typeof e||e instanceof pl?Sh(o,"updateDoc",s.N_,e,n,r):Ah(o,"updateDoc",s.N_,e),al(i).then(t=>qh(i.Sf,t,a.O_(s.N_,Gi.exists(!0))))},t.waitForPendingWrites=function(t){const e=lo(t,fl);return al(e).then(t=>(function(t,e){const n=new ta;return t.di(()=>(async function(t,e){const n=Nr(t);n.jh.Sc()||vr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(t){const e=Nr(n.Ac);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.Zn.Sr(t))}();if(-1===r)return void e.resolve();const s=n.sl.get(r)||[];s.push(e),n.sl.set(r,s)}catch(t){const n=ga(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}})(e,n)),n.promise})(e.Sf,t))},t.where=function(t,e,n){const r=e,s=Cl("where",t);return new wl(s,r,n)},t.writeBatch=function(t){const e=lo(t,fl);return new Pl(e,t=>al(e).then(n=>qh(e.Sf,n,t)))},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}}),function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase["firestore-lite"]=t.firebase["firestore-lite"]||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};var r="FirebaseError",s=function(t){function e(n,s){var o=t.call(this,s)||this;return o.code=n,o.name=r,Object.setPrototypeOf(o,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,i.prototype.create),o}return function(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}(e,t),e}(Error),i=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(u,function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"})}(o,r):"Error",c=this.serviceName+": "+a+" ("+i+").",h=new s(i,c),l=0,f=Object.keys(r);l<f.length;l++){var d=f[l];"_"!==d.slice(-1)&&(d in h&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),h[d]=r[d])}return h},t}();var o,a,u=/\{\$([^}]+)}/g,c=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}();function h(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),s=0;for(e=0;e<n;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,s++)r[s]=i[o];return r}!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(a||(a={}));var l={debug:a.DEBUG,verbose:a.VERBOSE,info:a.INFO,warn:a.WARN,error:a.ERROR,silent:a.SILENT},f=a.INFO,d=((o={})[a.DEBUG]="log",o[a.VERBOSE]="log",o[a.INFO]="info",o[a.WARN]="warn",o[a.ERROR]="error",o),p=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var s=(new Date).toISOString(),i=d[e];if(!i)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[i].apply(console,h(["["+s+"]  "+t.name+":"],n))}},g=function(){function t(t){this.name=t,this._logLevel=f,this._logHandler=p,this._userLogHandler=null}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in a))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?l[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,h([this,a.DEBUG],t)),this._logHandler.apply(this,h([this,a.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,h([this,a.VERBOSE],t)),this._logHandler.apply(this,h([this,a.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,h([this,a.INFO],t)),this._logHandler.apply(this,h([this,a.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,h([this,a.WARN],t)),this._logHandler.apply(this,h([this,a.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,h([this,a.ERROR],t)),this._logHandler.apply(this,h([this,a.ERROR],t))},t}();const m="ok",y="cancelled",w="unknown",v="invalid-argument",b="deadline-exceeded",E="not-found",I="already-exists",_="permission-denied",T="unauthenticated",N="resource-exhausted",A="failed-precondition",S="aborted",x="out-of-range",D="unimplemented",O="internal",C="unavailable",k="data-loss";class R extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=(()=>`${this.name}: [code=${this.code}]: ${this.message}`)}}const L=new g("@firebase/firestore");function P(t,...e){if(L.logLevel<=a.DEBUG){const n=e.map(U);L.debug("Firestore (7.19.1): "+t,...n)}}function V(t,...e){if(L.logLevel<=a.ERROR){const n=e.map(U);L.error("Firestore (7.19.1): "+t,...n)}}function U(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function M(t="Unexpected state"){const e="FIRESTORE (7.19.1) INTERNAL ASSERTION FAILED: "+t;throw V(e),new Error(e)}function q(t,e){t||M()}function F(t,e){return t}function j(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class G{static t(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const r=j(40);for(let s=0;s<r.length;++s)n.length<20&&r[s]<e&&(n+=t.charAt(r[s]%t.length))}return n}}function $(t,e){return t<e?-1:t>e?1:0}function B(t,e,n){return t.length===e.length&&t.every((t,r)=>n(t,e[r]))}class z{constructor(t,e,n,r,s){this.s=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=s}}class H{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get i(){return"(default)"===this.database}isEqual(t){return t instanceof H&&t.projectId===this.projectId&&t.database===this.database}o(t){return $(this.projectId,t.projectId)||$(this.database,t.database)}}class K{constructor(t){this.uid=t}u(){return null!=this.uid}h(){return this.u()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}K.UNAUTHENTICATED=new K(null),K.l=new K("google-credentials-uid"),K._=new K("first-party-uid");class W{constructor(t,e){this.user=e,this.type="OAuth",this.m={},this.m.Authorization="Bearer "+t}}class X{constructor(t){this.p=null,this.currentUser=K.UNAUTHENTICATED,this.I=!1,this.A=0,this.T=null,this.forceRefresh=!1,this.p=(()=>{this.A++,this.currentUser=this.P(),this.I=!0,this.T&&this.T(this.currentUser)}),this.A=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.p):(this.p(null),t.get().then(t=>{this.auth=t,this.p&&this.auth.addAuthTokenListener(this.p)},()=>{}))}getToken(){const t=this.A,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.A!==t?(P("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(q("string"==typeof e.accessToken),new W(e.accessToken,this.currentUser)):null):Promise.resolve(null)}R(){this.forceRefresh=!0}V(t){this.T=t,this.I&&t(this.currentUser)}g(){this.auth&&this.auth.removeAuthTokenListener(this.p),this.p=null,this.T=null}P(){const t=this.auth&&this.auth.getUid();return q(null===t||"string"==typeof t),new K(t)}}function Q(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new R(v,`Type does not match the expected instance. Did you pass '${e.name}' from a different Firestore SDK?`):new R(v,`Expected type '${e.name}', but was '${t.constructor.name}'`);return t}class J{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new R(v,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new R(v,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new R(v,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new R(v,"Timestamp seconds out of range: "+t)}static now(){return J.fromMillis(Date.now())}static fromDate(t){return J.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3);return new J(e,1e6*(t-1e3*e))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}v(t){return this.seconds===t.seconds?$(this.nanoseconds,t.nanoseconds):$(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Y{constructor(t){this.timestamp=t}static N(t){return new Y(t)}static min(){return new Y(new J(0,0))}o(t){return this.timestamp.v(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}$(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}F(){return this.timestamp}}class Z{constructor(t,e,n){void 0===e?e=0:e>t.length&&M(),void 0===n?n=t.length-e:n>t.length-e&&M(),this.segments=t,this.offset=e,this.D=n}get length(){return this.D}isEqual(t){return 0===Z.q(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Z?t.forEach(t=>{e.push(t)}):e.push(t),this.S(e)}limit(){return this.offset+this.length}O(t){return t=void 0===t?1:t,this.S(this.segments,this.offset+t,this.length-t)}C(){return this.S(this.segments,this.offset,this.length-1)}L(){return this.segments[this.offset]}U(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}M(){return 0===this.length}j(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}B(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}k(){return this.segments.slice(this.offset,this.limit())}static q(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class tt extends Z{S(t,e,n){return new tt(t,e,n)}G(){return this.k().join("/")}toString(){return this.G()}static W(t){if(t.indexOf("//")>=0)throw new R(v,`Invalid path (${t}). Paths must not contain // in them.`);const e=t.split("/").filter(t=>t.length>0);return new tt(e)}static Y(){return new tt([])}}const et=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class nt extends Z{S(t,e,n){return new nt(t,e,n)}static H(t){return et.test(t)}G(){return this.k().map(t=>(t=t.replace("\\","\\\\").replace("`","\\`"),nt.H(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.G()}K(){return 1===this.length&&"__name__"===this.get(0)}static J(){return new nt(["__name__"])}static Z(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new R(v,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new R(v,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new R(v,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new R(v,"Unterminated ` in path: "+t);return new nt(e)}static Y(){return new nt([])}}class rt{constructor(t){this.path=t}static X(t){return new rt(tt.W(t))}static tt(t){return new rt(tt.W(t).O(5))}nt(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===tt.q(this.path,t.path)}toString(){return this.path.toString()}static q(t,e){return tt.q(t.path,e.path)}static et(t){return t.length%2==0}static rt(t){return new rt(new tt(t.slice()))}}function st(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function it(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}class ot{constructor(t){this.st=t}static fromBase64String(t){const e=atob(t);return new ot(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new ot(e)}toBase64(){return t=this.st,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.st)}it(){return 2*this.st.length}o(t){return $(this.st,t.st)}isEqual(t){return this.st===t.st}}function at(t){return null==t}function ut(t){return-0===t&&1/t==-1/0}function ct(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ht(t){const e=yt(t.mapValue.fields.__local_write_time__.timestampValue);return new J(e.seconds,e.nanos)}ot.ot=new ot("");const lt=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ft(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?ct(t)?4:10:M()}function dt(t,e){const n=ft(t);if(n!==ft(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ht(t).isEqual(ht(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=yt(t.timestampValue),r=yt(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return vt(t.bytesValue).isEqual(vt(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return wt(t.geoPointValue.latitude)===wt(e.geoPointValue.latitude)&&wt(t.geoPointValue.longitude)===wt(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return wt(t.integerValue)===wt(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=wt(t.doubleValue),r=wt(e.doubleValue);return n===r?ut(n)===ut(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return B(t.arrayValue.values||[],e.arrayValue.values||[],dt);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(st(n)!==st(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!dt(n[t],r[t])))return!1;return!0}(t,e);default:return M()}}function pt(t,e){return void 0!==(t.values||[]).find(t=>dt(t,e))}function gt(t,e){const n=ft(t),r=ft(e);if(n!==r)return $(n,r);switch(n){case 0:return 0;case 1:return $(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=wt(t.integerValue||t.doubleValue),r=wt(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return mt(t.timestampValue,e.timestampValue);case 4:return mt(ht(t),ht(e));case 5:return $(t.stringValue,e.stringValue);case 6:return function(t,e){const n=vt(t),r=vt(e);return n.o(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=$(n[t],r[t]);if(0!==e)return e}return $(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=$(wt(t.latitude),wt(e.latitude));return 0!==n?n:$(wt(t.longitude),wt(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=gt(n[t],r[t]);if(e)return e}return $(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=$(r[t],i[t]);if(0!==e)return e;const o=gt(n[r[t]],s[i[t]]);if(0!==o)return o}return $(r.length,i.length)}(t.mapValue,e.mapValue);default:throw M()}}function mt(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return $(t,e);const n=yt(t),r=yt(e),s=$(n.seconds,r.seconds);return 0!==s?s:$(n.nanos,r.nanos)}function yt(t){if(q(!!t),"string"==typeof t){let e=0;const n=lt.exec(t);if(q(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:wt(t.seconds),nanos:wt(t.nanos)}}function wt(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function vt(t){return"string"==typeof t?ot.fromBase64String(t):ot.fromUint8Array(t)}function bt(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.G()}`}}function Et(t){return!!t&&"arrayValue"in t}function It(t){return!!t&&"nullValue"in t}function _t(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Tt(t){return!!t&&"mapValue"in t}class Nt{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.ut=null}}function At(t,e=null,n=[],r=[],s=null,i=null,o=null){return new Nt(t,e,n,r,s,i,o)}class St{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.ct=n,this.filters=r,this.limit=s,this.at=i,this.startAt=o,this.endAt=a,this.ht=null,this.lt=null,this.startAt,this.endAt}}function xt(t){return!at(t.limit)&&"L"===t.at}function Dt(t){return t.ct.length>0?t.ct[0].field:null}function Ot(t){for(const e of t.filters)if(e.ft())return e.field;return null}function Ct(t){return null!==t.collectionGroup}function kt(t){const e=Q(t,St);if(null===e.ht){e.ht=[];const t=Ot(e),n=Dt(e);if(null!==t&&null===n)t.K()||e.ht.push(new zt(t)),e.ht.push(new zt(nt.J(),"asc"));else{let t=!1;for(const n of e.ct)e.ht.push(n),n.field.K()&&(t=!0);if(!t){const t=e.ct.length>0?e.ct[e.ct.length-1].dir:"asc";e.ht.push(new zt(nt.J(),t))}}}return e.ht}function Rt(t){const e=Q(t,St);if(!e.lt)if("F"===e.at)e.lt=At(e.path,e.collectionGroup,kt(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of kt(e)){const e="desc"===n.dir?"asc":"desc";t.push(new zt(n.field,e))}const n=e.endAt?new $t(e.endAt.position,!e.endAt.before):null,r=e.startAt?new $t(e.startAt.position,!e.startAt.before):null;e.lt=At(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}return e.lt}class Lt extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){if(t.K())return"in"===e||"not-in"===e?this.dt(t,e,n):new Pt(t,e,n);if(It(n)){if("=="!==e&&"!="!==e)throw new R(v,"Invalid query. Null supports only equality comparisons.");return new Lt(t,e,n)}if(_t(n)){if("=="!==e&&"!="!==e)throw new R(v,"Invalid query. NaN supports only equality comparisons.");return new Lt(t,e,n)}return"array-contains"===e?new qt(t,n):"in"===e?new Ft(t,n):"not-in"===e?new jt(t,n):"array-contains-any"===e?new Gt(t,n):new Lt(t,e,n)}static dt(t,e,n){return"in"===e?new Vt(t,n):new Ut(t,n)}matches(t){const e=t.field(this.field);return"!="===this.op?null!==e&&this._t(gt(e,this.value)):null!==e&&ft(this.value)===ft(e)&&this._t(gt(e,this.value))}_t(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return M()}}ft(){return["<","<=",">",">=","!="].indexOf(this.op)>=0}}class Pt extends Lt{constructor(t,e,n){super(t,e,n),this.key=rt.tt(n.referenceValue)}matches(t){const e=rt.q(t.key,this.key);return this._t(e)}}class Vt extends Lt{constructor(t,e){super(t,"in",e),this.keys=Mt("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Ut extends Lt{constructor(t,e){super(t,"not-in",e),this.keys=Mt("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Mt(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>rt.tt(t.referenceValue))}class qt extends Lt{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.field(this.field);return Et(e)&&pt(e.arrayValue,this.value)}}class Ft extends Lt{constructor(t,e){super(t,"in",e)}matches(t){const e=t.field(this.field);return null!==e&&pt(this.value.arrayValue,e)}}class jt extends Lt{constructor(t,e){super(t,"not-in",e)}matches(t){const e=t.field(this.field);return null!==e&&!pt(this.value.arrayValue,e)}}class Gt extends Lt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.field(this.field);return!(!Et(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>pt(this.value.arrayValue,t))}}class $t{constructor(t,e){this.position=t,this.before=e}}function Bt(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!dt(t.position[n],e.position[n]))return!1;return!0}class zt{constructor(t,e="asc"){this.field=t,this.dir=e}}function Ht(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}var Kt,Wt;function Xt(t){if(void 0===t)return V("RPC_ERROR","HTTP error has no status"),w;switch(t){case 200:return m;case 400:return A;case 401:return T;case 403:return _;case 404:return E;case 409:return S;case 416:return x;case 429:return N;case 499:return y;case 500:return w;case 501:return D;case 503:return C;case 504:return b;default:return t>=200&&t<300?m:t>=400&&t<500?A:t>=500&&t<600?O:w}}(Wt=Kt||(Kt={}))[Wt.OK=0]="OK",Wt[Wt.CANCELLED=1]="CANCELLED",Wt[Wt.UNKNOWN=2]="UNKNOWN",Wt[Wt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Wt[Wt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Wt[Wt.NOT_FOUND=5]="NOT_FOUND",Wt[Wt.ALREADY_EXISTS=6]="ALREADY_EXISTS",Wt[Wt.PERMISSION_DENIED=7]="PERMISSION_DENIED",Wt[Wt.UNAUTHENTICATED=16]="UNAUTHENTICATED",Wt[Wt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Wt[Wt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Wt[Wt.ABORTED=10]="ABORTED",Wt[Wt.OUT_OF_RANGE=11]="OUT_OF_RANGE",Wt[Wt.UNIMPLEMENTED=12]="UNIMPLEMENTED",Wt[Wt.INTERNAL=13]="INTERNAL",Wt[Wt.UNAVAILABLE=14]="UNAVAILABLE",Wt[Wt.DATA_LOSS=15]="DATA_LOSS";const Qt={asc:"ASCENDING",desc:"DESCENDING"},Jt={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Yt{constructor(t,e){this.s=t,this.wt=e}}function Zt(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!ut(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?{integerValue:""+e}:function(t,e){if(t.wt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ut(e)?"-0":e}}(t,e)}function te(t,e){return t.wt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function ee(t){return q(!!t),Y.N(function(t){const e=yt(t);return new J(e.seconds,e.nanos)}(t))}function ne(t,e){return function(t){return new tt(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).G()}function re(t,e){return ne(t.s,e.path)}function se(t,e){const n=function(t){const e=tt.W(t);return q(fe(e)),e}(e);return q(n.get(1)===t.s.projectId),q(!n.get(3)&&!t.s.database||n.get(3)===t.s.database),new rt((q((r=n).length>4&&"documents"===r.get(4)),r.O(5)));var r}function ie(t,e){return ne(t.s,e)}function oe(t){return new tt(["projects",t.s.projectId,"databases",t.s.database]).G()}function ae(t,e,n){return{name:re(t,e),fields:n.proto.mapValue.fields}}function ue(t,e){let n;if(e instanceof Ie)n={update:ae(t,e.key,e.value)};else if(e instanceof Ne)n={delete:re(t,e.key)};else if(e instanceof _e)n={update:ae(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.G())),{fieldPaths:e}}(e.pt)};else if(e instanceof Te)n={transform:{document:re(t,e.key),fieldTransforms:e.fieldTransforms.map(t=>(function(t,e){const n=e.transform;if(n instanceof pe)return{fieldPath:e.field.G(),setToServerValue:"REQUEST_TIME"};if(n instanceof ge)return{fieldPath:e.field.G(),appendMissingElements:{values:n.elements}};if(n instanceof me)return{fieldPath:e.field.G(),removeAllFromArray:{values:n.elements}};if(n instanceof ye)return{fieldPath:e.field.G(),increment:n.yt};throw M()})(0,t))}};else{if(!(e instanceof Ae))return M();n={verify:re(t,e.key)}}return e.It.Et||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:function(t,e){return te(t,e.F())}(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:M()}(t,e.It)),n}function ce(t,e){const n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=ie(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=ie(t,r.C()),n.structuredQuery.from=[{collectionId:r.U()}]);const s=function(t){if(0===t.length)return;const e=t.map(t=>(function(t){if("=="===t.op){if(_t(t.value))return{unaryFilter:{field:le(t.field),op:"IS_NAN"}};if(It(t.value))return{unaryFilter:{field:le(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(_t(t.value))return{unaryFilter:{field:le(t.field),op:"IS_NOT_NAN"}};if(It(t.value))return{unaryFilter:{field:le(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:le(t.field),op:function(t){return Jt[t]}(t.op),value:t.value}}})(t));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);s&&(n.structuredQuery.where=s);const i=function(t){if(0!==t.length)return t.map(t=>(function(t){return{field:le(t.field),direction:function(t){return Qt[t]}(t.dir)}})(t))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=function(t,e){return t.wt||at(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=he(e.startAt)),e.endAt&&(n.structuredQuery.endAt=he(e.endAt)),n}function he(t){return{before:t.before,values:t.position}}function le(t){return{fieldPath:t.G()}}function fe(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class de{constructor(){this.At=void 0}}class pe extends de{}class ge extends de{constructor(t){super(),this.elements=t}}class me extends de{constructor(t){super(),this.elements=t}}class ye extends de{constructor(t,e){super(),this.serializer=t,this.yt=e}}class we{constructor(t){this.fields=t,t.sort(nt.q)}Tt(t){for(const e of this.fields)if(e.j(t))return!0;return!1}isEqual(t){return B(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class ve{constructor(t,e){this.field=t,this.transform=e}}class be{constructor(t,e){this.updateTime=t,this.exists=e}static Pt(){return new be}static exists(t){return new be(void 0,t)}static updateTime(t){return new be(t)}get Et(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}class Ee{}class Ie extends Ee{constructor(t,e,n){super(),this.key=t,this.value=e,this.It=n,this.type=0}}class _e extends Ee{constructor(t,e,n,r){super(),this.key=t,this.data=e,this.pt=n,this.It=r,this.type=1}}class Te extends Ee{constructor(t,e){super(),this.key=t,this.fieldTransforms=e,this.type=2,this.It=be.exists(!0)}}class Ne extends Ee{constructor(t,e){super(),this.key=t,this.It=e,this.type=3}}class Ae extends Ee{constructor(t,e){super(),this.key=t,this.It=e,this.type=4}}class Se{constructor(t){this.proto=t}static empty(){return new Se({mapValue:{}})}field(t){if(t.M())return this.proto;{let e=this.proto;for(let n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Tt(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.U()])||null}}isEqual(t){return dt(this.proto,t.proto)}}class xe{constructor(t=Se.empty()){this.Rt=t,this.Vt=new Map}set(t,e){return this.gt(t,e),this}delete(t){return this.gt(t,null),this}gt(t,e){let n=this.Vt;for(let e=0;e<t.length-1;++e){const r=t.get(e);let s=n.get(r);s instanceof Map?n=s:s&&10===ft(s)?(s=new Map(Object.entries(s.mapValue.fields||{})),n.set(r,s),n=s):(s=new Map,n.set(r,s),n=s)}n.set(t.U(),e)}bt(){const t=this.vt(nt.Y(),this.Vt);return null!=t?new Se(t):this.Rt}vt(t,e){let n=!1;const r=this.Rt.field(t),s=Tt(r)?Object.assign({},r.mapValue.fields):{};return e.forEach((e,r)=>{if(e instanceof Map){const i=this.vt(t.child(r),e);null!=i&&(s[r]=i,n=!0)}else null!==e?(s[r]=e,n=!0):s.hasOwnProperty(r)&&(delete s[r],n=!0)}),n?{mapValue:{fields:s}}:null}}class De{constructor(t,e){this.key=t,this.version=e}}class Oe extends De{constructor(t,e,n,r){super(t,e),this.Nt=n,this.$t=!!r.$t,this.hasCommittedMutations=!!r.hasCommittedMutations}field(t){return this.Nt.field(t)}data(){return this.Nt}Ft(){return this.Nt.proto}isEqual(t){return t instanceof Oe&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.$t===t.$t&&this.hasCommittedMutations===t.hasCommittedMutations&&this.Nt.isEqual(t.Nt)}toString(){return`Document(${this.key}, ${this.version}, ${this.Nt.toString()}, {hasLocalMutations: ${this.$t}}), {hasCommittedMutations: ${this.hasCommittedMutations}})`}get hasPendingWrites(){return this.$t||this.hasCommittedMutations}}class Ce extends De{constructor(t,e,n){super(t,e),this.hasCommittedMutations=!(!n||!n.hasCommittedMutations)}toString(){return`NoDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return this.hasCommittedMutations}isEqual(t){return t instanceof Ce&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class ke{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class Re{constructor(t,e,n=1e3,r=1.5,s=6e4){this.Dt=t,this.qt=e,this.xt=n,this.St=r,this.Ot=s,this.Ct=0,this.Lt=null,this.Ut=Date.now(),this.reset()}reset(){this.Ct=0}Mt(){this.Ct=this.Ot}jt(t){this.cancel();const e=Math.floor(this.Ct+this.Bt()),n=Math.max(0,Date.now()-this.Ut),r=Math.max(0,e-n);r>0&&P("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Ct} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Lt=this.Dt.kt(this.qt,r,()=>(this.Ut=Date.now(),t())),this.Ct*=this.St,this.Ct<this.xt&&(this.Ct=this.xt),this.Ct>this.Ot&&(this.Ct=this.Ot)}Qt(){null!==this.Lt&&(this.Lt.Gt(),this.Lt=null)}cancel(){null!==this.Lt&&(this.Lt.cancel(),this.Lt=null)}Bt(){return(Math.random()-.5)*this.Ct}}function Le(){return"undefined"!=typeof document?document:null}class Pe{constructor(t,e,n,r,s){this.Wt=t,this.qt=e,this.Yt=n,this.op=r,this.zt=s,this.Ht=new ke,this.then=this.Ht.promise.then.bind(this.Ht.promise),this.Ht.promise.catch(t=>{})}static Kt(t,e,n,r,s){const i=Date.now()+n,o=new Pe(t,e,i,r,s);return o.start(n),o}start(t){this.Jt=setTimeout(()=>this.Zt(),t)}Gt(){return this.Zt()}cancel(t){null!==this.Jt&&(this.clearTimeout(),this.Ht.reject(new R(y,"Operation cancelled"+(t?": "+t:""))))}Zt(){this.Wt.Xt(()=>null!==this.Jt?(this.clearTimeout(),this.op().then(t=>this.Ht.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.Jt&&(this.zt(this),clearTimeout(this.Jt),this.Jt=null)}}class Ve{constructor(){this.tn=Promise.resolve(),this.nn=[],this.en=!1,this.rn=[],this.sn=null,this.on=!1,this.un=[],this.cn=new Re(this,"async_queue_retry"),this.an=(()=>{const t=Le();t&&P("AsyncQueue","Visibility state changed to  ",t.visibilityState),this.cn.Qt()});const t=Le();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.an)}get hn(){return this.en}Xt(t){this.enqueue(t)}ln(t){this.fn(),this.dn(t)}_n(){if(!this.en){this.en=!0;const t=Le();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.an)}}enqueue(t){return this.fn(),this.en?new Promise(t=>{}):this.dn(t)}wn(t){this.nn.push(t),this.Xt(()=>this.mn())}async mn(){if(0!==this.nn.length){try{await this.nn[0](),this.nn.shift(),this.cn.reset()}catch(t){if(!function(t){return"IndexedDbTransactionError"===t.name}(t))throw t;P("AsyncQueue","Operation failed with retryable error: "+t)}this.nn.length>0&&this.cn.jt(()=>this.mn())}}dn(t){const e=this.tn.then(()=>(this.on=!0,t().catch(t=>{throw this.sn=t,this.on=!1,V("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.on=!1,t))));return this.tn=e,e}kt(t,e,n){this.fn(),this.un.indexOf(t)>-1&&(e=0);const r=Pe.Kt(this,t,e,n,t=>this.pn(t));return this.rn.push(r),r}fn(){this.sn&&M()}yn(){}async En(){let t;do{t=this.tn,await t}while(t!==this.tn)}In(t){for(const e of this.rn)if(e.qt===t)return!0;return!1}An(t){return this.En().then(()=>{this.rn.sort((t,e)=>t.Yt-e.Yt);for(const e of this.rn)if(e.Gt(),"all"!==t&&e.qt===t)break;return this.En()})}Tn(t){this.un.push(t)}pn(t){const e=this.rn.indexOf(t);this.rn.splice(e,1)}}class Ue extends class{}{constructor(t,e,n){super(),this.credentials=t,this.Pn=e,this.serializer=n,this.Rn=!1}Vn(){if(this.Rn)throw new R(A,"The client has already been terminated.")}gn(t,e,n){return this.Vn(),this.credentials.getToken().then(r=>this.Pn.gn(t,e,n,r)).catch(t=>{throw t.code===T&&this.credentials.R(),t})}bn(t,e,n){return this.Vn(),this.credentials.getToken().then(r=>this.Pn.bn(t,e,n,r)).catch(t=>{throw t.code===T&&this.credentials.R(),t})}terminate(){this.Rn=!1}}async function Me(t,e){const n=F(t),r=oe(n.serializer)+"/documents",s={writes:e.map(t=>ue(n.serializer,t))};await n.gn("Commit",r,s)}async function qe(t,e){const n=F(t),r=oe(n.serializer)+"/documents",s={documents:e.map(t=>re(n.serializer,t))},i=await n.bn("BatchGetDocuments",r,s),o=new Map;i.forEach(t=>{const e=function(t,e){return"found"in e?function(t,e){q(!!e.found),e.found.name,e.found.updateTime;const n=se(t,e.found.name),r=ee(e.found.updateTime),s=new Se({mapValue:{fields:e.found.fields}});return new Oe(n,r,s,{})}(t,e):"missing"in e?function(t,e){q(!!e.missing),q(!!e.readTime);const n=se(t,e.missing),r=ee(e.readTime);return new Ce(n,r)}(t,e):M()}(n.serializer,t);o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{const e=o.get(t.toString());q(!!e),a.push(e)}),a}const Fe={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class je extends class{constructor(t){this.vn=t,this.s=t.s;const e=t.ssl?"https":"http";this.Nn=e+"://"+t.host,this.$n="projects/"+this.s.projectId+"/databases/"+this.s.database+"/documents"}gn(t,e,n,r){const s=this.Fn(t,e);P("RestConnection","Sending: ",s,n);const i={};return this.Dn(i,r),this.qn(t,s,i,n).then(t=>(P("RestConnection","Received: ",t),t),e=>{throw function(t,...e){if(L.logLevel<=a.WARN){const t=e.map(U);L.warn("Firestore (7.19.1): RestConnection",...t)}}(0,t+" failed with error: ",e,"url: ",s,"request:",n),e})}bn(t,e,n,r){return this.gn(t,e,n,r)}Dn(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.19.1",t["Content-Type"]="text/plain",e)for(const n in e.m)e.m.hasOwnProperty(n)&&(t[n]=e.m[n])}Fn(t,e){const n=Fe[t];return`${this.Nn}/v1/${e}:${n}`}}{constructor(t,e){super(t),this.xn=e}Sn(t,e){throw new Error("Not supported by FetchConnection")}async qn(t,e,n,r){const s=JSON.stringify(r);let i;try{i=await this.xn(e,{method:"POST",headers:n,body:s})}catch(t){throw new R(Xt(t.status),"Request failed with error: "+t.statusText)}if(!i.ok)throw new R(Xt(i.status),"Request failed with error: "+i.statusText);return i.json()}}function Ge(t){return new Yt(t,!0)}const $e=new Map;function Be(t){var e,n;if(t.On)throw new R(A,"The client has already been terminated.");if(!$e.has(t)){P("ComponentProvider","Initializing Datastore");const r=t.Cn(),s=new z(t.Ln,t.Un,null!==(e=r.host)&&void 0!==e?e:"firestore.googleapis.com",null===(n=r.ssl)||void 0===n||n,!1),i=new je(s,fetch.bind(null)),o=Ge(s.s),a=function(t,e,n){return new Ue(t,i,o)}(t.Mn);$e.set(t,a)}return $e.get(t)}class ze{constructor(t,e){this.app=t,this.Un="(lite)",this.jn=!1,this.INTERNAL={delete:()=>this._delete()},this.Ln=ze.Bn(t),this.Mn=new X(e)}get kn(){return this.jn}get On(){return void 0!==this.Qn}Gn(t){if(this.jn)throw new R(A,"Firestore has already been started and its settings can no longer be changed. initializeFirestore() cannot be called after calling getFirestore().");this.Wn=t}Cn(){return this.Wn||(this.Wn={}),this.jn=!0,this.Wn}static Bn(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new R(v,'"projectId" not provided in firebase.initializeApp.');return new H(t.options.projectId)}_delete(){return this.Qn||(this.Qn=this.Yn()),this.Qn}Yn(){return function(t){const e=$e.get(t);e&&(P("ComponentProvider","Removing Datastore"),$e.delete(t),e.terminate())}(this),Promise.resolve()}}function He(t,e,n){if(e.length!==n)throw new R(v,`Function ${t}() requires `+en(n,"argument")+", but was called with "+en(e.length,"argument")+".")}function Ke(t,e,n){if(e.length<n)throw new R(v,`Function ${t}() requires at least `+en(n,"argument")+", but was called with "+en(e.length,"argument")+".")}function We(t,e,n,r){!function(t,e,n,r){let s=!1;if(!(s="object"===e?Je(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){const s=Ye(r);throw new R(v,`Function ${t}() requires its ${n} to be of type ${e}, but it was: ${s}`)}}(t,e,tn(n)+" argument",r)}function Xe(t){if(!rt.et(t))throw new R(v,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Qe(t){if(rt.et(t))throw new R(v,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Je(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Ye(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":M()}function Ze(t,e,n){if(n<=0)throw new R(v,`Function ${t}() requires its ${tn(e)} argument to be a positive number, but it was: ${n}.`)}function tn(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function en(t,e){return`${t} ${e}`+(1===t?"":"s")}class nn{constructor(t){!function(t,e,n,r){if(!(e instanceof Array)||e.length<1)throw new R(v,"Function FieldPath() requires its fieldNames argument to be an array with at least "+en(1,"element")+".")}(0,t);for(let e=0;e<t.length;++e)if(We("FieldPath","string",e,t[e]),0===t[e].length)throw new R(v,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.zn=new nt(t)}}class rn extends nn{constructor(...t){super(t)}static documentId(){return new rn(nt.J().G())}isEqual(t){if(!(t instanceof rn))throw function(t,e,n,r){const s=Ye(r);return new R(v,`Function isEqual() requires its ${tn(1)} argument to be a FieldPath, but it was: ${s}`)}(0,0,0,t);return this.zn.isEqual(t.zn)}}const sn=new RegExp("[~\\*/\\[\\]]");class on{constructor(){this.Hn=this}}class an extends on{constructor(t){super(),this.Kn=t}Jn(t){if(2!==t.Zn)throw 1===t.Zn?t.Xn(this.Kn+"() can only appear at the top level of your update data"):t.Xn(this.Kn+"() cannot be used with set() unless you pass {merge:true}");return t.pt.push(t.path),null}isEqual(t){return t instanceof an}}function un(t,e,n){return new bn({Zn:3,te:e.settings.te,methodName:t.Kn,ne:n},e.s,e.serializer,e.ignoreUndefinedProperties)}class cn extends on{constructor(t){super(),this.Kn=t}Jn(t){return new ve(t.path,new pe)}isEqual(t){return t instanceof cn}}class hn extends on{constructor(t,e){super(),this.Kn=t,this.ee=e}Jn(t){const e=un(this,t,!0),n=this.ee.map(t=>An(t,e)),r=new ge(n);return new ve(t.path,r)}isEqual(t){return this===t}}class ln extends on{constructor(t,e){super(),this.Kn=t,this.ee=e}Jn(t){const e=un(this,t,!0),n=this.ee.map(t=>An(t,e)),r=new me(n);return new ve(t.path,r)}isEqual(t){return this===t}}class fn extends on{constructor(t,e){super(),this.Kn=t,this.re=e}Jn(t){const e=new ye(t.serializer,Zt(t.serializer,this.re));return new ve(t.path,e)}isEqual(t){return this===t}}class dn{constructor(t,e){if(He("GeoPoint",arguments,2),We("GeoPoint","number",1,t),We("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new R(v,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new R(v,"Longitude must be a number between -180 and 180, but was: "+e);this.se=t,this.ie=e}get latitude(){return this.se}get longitude(){return this.ie}isEqual(t){return this.se===t.se&&this.ie===t.ie}toJSON(){return{latitude:this.se,longitude:this.ie}}v(t){return $(this.se,t.se)||$(this.ie,t.ie)}}class pn{constructor(t){this.oe=t}static fromBase64String(t){try{return new pn(ot.fromBase64String(t))}catch(t){throw new R(v,"Failed to construct Bytes from Base64 string: "+t)}}static fromUint8Array(t){return new pn(ot.fromUint8Array(t))}toBase64(){return this.oe.toBase64()}toUint8Array(){return this.oe.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this.oe.isEqual(t.oe)}}const gn=/^__.*__$/;class mn{constructor(t,e,n){this.Ln=t,this.ue=e,this.ce=n}}class yn{constructor(t,e,n){this.data=t,this.pt=e,this.fieldTransforms=n}ae(t,e){const n=[];return null!==this.pt?n.push(new _e(t,this.data,this.pt,e)):n.push(new Ie(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Te(t,this.fieldTransforms)),n}}class wn{constructor(t,e,n){this.data=t,this.pt=e,this.fieldTransforms=n}ae(t,e){const n=[new _e(t,this.data,this.pt,e)];return this.fieldTransforms.length>0&&n.push(new Te(t,this.fieldTransforms)),n}}function vn(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw M()}}class bn{constructor(t,e,n,r,s,i){this.settings=t,this.s=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===s&&this.he(),this.fieldTransforms=s||[],this.pt=i||[]}get path(){return this.settings.path}get Zn(){return this.settings.Zn}le(t){return new bn(Object.assign(Object.assign({},this.settings),t),this.s,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.pt)}fe(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.le({path:n,ne:!1});return r.de(t),r}_e(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.le({path:n,ne:!1});return r.he(),r}we(t){return this.le({path:void 0,ne:!0})}Xn(t){return kn(t,this.settings.methodName,this.settings.me||!1,this.path,this.settings.te)}contains(t){return void 0!==this.pt.find(e=>t.j(e))||void 0!==this.fieldTransforms.find(e=>t.j(e.field))}he(){if(this.path)for(let t=0;t<this.path.length;t++)this.de(this.path.get(t))}de(t){if(0===t.length)throw this.Xn("Document fields must not be empty");if(vn(this.Zn)&&gn.test(t))throw this.Xn('Document fields cannot begin and end with "__"')}}class En{constructor(t,e,n){this.s=t,this.ignoreUndefinedProperties=e,this.serializer=n||Ge(t)}pe(t,e,n,r=!1){return new bn({Zn:t,methodName:e,te:n,path:nt.Y(),ne:!1,me:r},this.s,this.serializer,this.ignoreUndefinedProperties)}}function In(t,e,n,r,s,i={}){const o=t.pe(i.merge||i.mergeFields?2:0,e,n,s);Dn("Data must be an object, but it was:",o,r);const a=Sn(r,o);let u,c;if(i.merge)u=new we(o.pt),c=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const r of i.mergeFields){let s;if(r instanceof nn)s=r.zn;else{if("string"!=typeof r)throw M();s=Cn(e,r,n)}if(!o.contains(s))throw new R(v,`Field '${s}' is specified in your field mask but missing from your input data.`);Rn(t,s)||t.push(s)}u=new we(t),c=o.fieldTransforms.filter(t=>u.Tt(t.field))}else u=null,c=o.fieldTransforms;return new yn(new Se(a),u,c)}function _n(t,e,n,r){const s=t.pe(1,e,n);Dn("Data must be an object, but it was:",s,r);const i=[],o=new xe;it(r,(t,r)=>{const a=Cn(e,t,n),u=s._e(a);if(r instanceof on&&r.Hn instanceof an)i.push(a);else{const t=An(r,u);null!=t&&(i.push(a),o.set(a,t))}});const a=new we(i);return new wn(o.bt(),a,s.fieldTransforms)}function Tn(t,e,n,r,s,i){const o=t.pe(1,e,n),a=[On(e,r,n)],u=[s];if(i.length%2!=0)throw new R(v,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<i.length;t+=2)a.push(On(e,i[t])),u.push(i[t+1]);const c=[],h=new xe;for(let t=a.length-1;t>=0;--t)if(!Rn(c,a[t])){const e=a[t],n=u[t],r=o._e(e);if(n instanceof on&&n.Hn instanceof an)c.push(e);else{const t=An(n,r);null!=t&&(c.push(e),h.set(e,t))}}const l=new we(c);return new wn(h.bt(),l,o.fieldTransforms)}function Nn(t,e,n,r=!1){return An(n,t.pe(r?4:3,e))}function An(t,e){if(xn(t))return Dn("Unsupported field value:",e,t),Sn(t,e);if(t instanceof on)return function(t,e){if(!vn(e.Zn))throw e.Xn(t.Kn+"() can only be used with update() and set()");if(!e.path)throw e.Xn(t.Kn+"() is not currently supported inside arrays");const n=t.Jn(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.pt.push(e.path),t instanceof Array){if(e.settings.ne&&4!==e.Zn)throw e.Xn("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const s of t){let t=An(s,e.we(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Zt(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=J.fromDate(t);return{timestampValue:te(e.serializer,n)}}if(t instanceof J){const n=new J(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:te(e.serializer,n)}}if(t instanceof dn)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof pn)return{bytesValue:function(t,e){return t.wt?e.toBase64():e.toUint8Array()}(e.serializer,t.oe)};if(t instanceof mn){const n=e.s,r=t.Ln;if(!r.isEqual(n))throw e.Xn(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ne(t.Ln||e.s,t.ue.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.Xn("Unsupported field value: "+Ye(t))}(t,e)}function Sn(t,e){const n={};return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(t)?e.path&&e.path.length>0&&e.pt.push(e.path):it(t,(t,r)=>{const s=An(r,e.fe(t));null!=s&&(n[t]=s)}),{mapValue:{fields:n}}}function xn(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof J||t instanceof dn||t instanceof pn||t instanceof mn||t instanceof on)}function Dn(t,e,n){if(!xn(n)||!Je(n)){const r=Ye(n);throw"an object"===r?e.Xn(t+" a custom object"):e.Xn(t+" "+r)}}function On(t,e,n){if(e instanceof nn)return e.zn;if("string"==typeof e)return Cn(t,e);throw kn("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Cn(t,e,n){try{return function(t){if(t.search(sn)>=0)throw new R(v,`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`);try{return new rn(...t.split("."))}catch(e){throw new R(v,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`)}}(e).zn}catch(e){throw kn((r=e)instanceof Error?r.message:r.toString(),t,!1,void 0,n)}var r}function kn(t,e,n,r,s){const i=r&&!r.M(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)");let u="";return(i||o)&&(u+=" (found",i&&(u+=" in field "+r),o&&(u+=" in document "+s),u+=")"),new R(v,(a+=". ")+t+u)}function Rn(t,e){return t.some(t=>t.isEqual(e))}class Ln extends nn{constructor(...t){super(t)}isEqual(t){const e=Q(t,Ln);return this.zn.isEqual(e.zn)}}class Pn{constructor(t,e,n,r,s){this.s=t,this.timestampsInSnapshots=e,this.ye=n,this.Ee=r,this.Ie=s}Ae(t){switch(ft(t)){case 0:return null;case 1:return t.booleanValue;case 2:return wt(t.integerValue||t.doubleValue);case 3:return this.Te(t.timestampValue);case 4:return this.Pe(t);case 5:return t.stringValue;case 6:return this.Ie(vt(t.bytesValue));case 7:return this.Re(t.referenceValue);case 8:return this.Ve(t.geoPointValue);case 9:return this.ge(t.arrayValue);case 10:return this.be(t.mapValue);default:throw M()}}be(t){const e={};return it(t.fields||{},(t,n)=>{e[t]=this.Ae(n)}),e}Ve(t){return new dn(wt(t.latitude),wt(t.longitude))}ge(t){return(t.values||[]).map(t=>this.Ae(t))}Pe(t){switch(this.ye){case"previous":const e=function t(e){const n=e.mapValue.fields.__previous_value__;return ct(n)?t(n):n}(t);return null==e?null:this.Ae(e);case"estimate":return this.Te(ht(t));default:return null}}Te(t){const e=yt(t),n=new J(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()}Re(t){const e=tt.W(t);q(fe(e));const n=new H(e.get(1),e.get(3)),r=new rt(e.O(5));return n.isEqual(this.s)||V(`Document ${r} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${this.s.projectId}/${this.s.database}) instead.`),this.Ee(r)}}class Vn{constructor(t,e,n,r){this.ve=t,this.ue=e,this.Ne=n,this.ce=r}get id(){return this.ue.path.U()}get ref(){return new Hn(this.ve,this.ce,this.ue.path)}exists(){return null!==this.Ne}data(){if(this.Ne){if(this.ce){const t=new Un(this.ve,this.ue,this.Ne,null);return this.ce.fromFirestore(t)}return new Pn(this.ve.Ln,!0,"none",t=>new Hn(this.ve,null,t.path),t=>new pn(t)).Ae(this.Ne.Ft())}}get(t){if(this.Ne){const e=this.Ne.data().field(qn("DocumentSnapshot.get",t));if(null!==e)return new Pn(this.ve.Ln,!0,"none",t=>new Hn(this.ve,this.ce,t.path),t=>new pn(t)).Ae(e)}}}class Un extends Vn{data(){return super.data()}}class Mn{constructor(t,e){this.query=t,this.$e=e}get docs(){return[...this.$e]}get size(){return this.docs.length}get empty(){return 0===this.docs.length}forEach(t,e){this.$e.forEach(t,e)}}function qn(t,e){return"string"==typeof e?Cn(t,e):Q(e,Ln).zn}class Fn{constructor(t){this.Fe=t,this.De=new Map,this.mutations=[],this.qe=!1,this.xe=null,this.Se=new Set}async Oe(t){if(this.Ce(),this.mutations.length>0)throw new R(v,"Firestore transactions require all reads to be executed before all writes.");const e=await qe(this.Fe,t);return e.forEach(t=>{t instanceof Ce||t instanceof Oe?this.Le(t):M()}),e}set(t,e){this.write(e.ae(t,this.It(t))),this.Se.add(t.toString())}update(t,e){try{this.write(e.ae(t,this.Ue(t)))}catch(t){this.xe=t}this.Se.add(t.toString())}delete(t){this.write([new Ne(t,this.It(t))]),this.Se.add(t.toString())}async commit(){if(this.Ce(),this.xe)throw this.xe;const t=this.De;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,e)=>{const n=rt.X(e);this.mutations.push(new Ae(n,this.It(n)))}),await Me(this.Fe,this.mutations),this.qe=!0}Le(t){let e;if(t instanceof Oe)e=t.version;else{if(!(t instanceof Ce))throw M();e=Y.min()}const n=this.De.get(t.key.toString());if(n){if(!e.isEqual(n))throw new R(S,"Document version changed between two reads.")}else this.De.set(t.key.toString(),e)}It(t){const e=this.De.get(t.toString());return!this.Se.has(t.toString())&&e?be.updateTime(e):be.Pt()}Ue(t){const e=this.De.get(t.toString());if(!this.Se.has(t.toString())&&e){if(e.isEqual(Y.min()))throw new R(v,"Can't update a document that doesn't exist.");return be.updateTime(e)}return be.exists(!0)}write(t){this.Ce(),this.mutations=this.mutations.concat(t)}Ce(){}}class jn{constructor(t,e,n,r){this.Wt=t,this.Fe=e,this.updateFunction=n,this.Ht=r,this.Me=5,this.cn=new Re(this.Wt,"transaction_retry")}run(){this.je()}je(){this.cn.jt(async()=>{const t=new Fn(this.Fe),e=this.Be(t);e&&e.then(e=>{this.Wt.Xt(()=>t.commit().then(()=>{this.Ht.resolve(e)}).catch(t=>{this.ke(t)}))}).catch(t=>{this.ke(t)})})}Be(t){try{const e=this.updateFunction(t);return!at(e)&&e.catch&&e.then?e:(this.Ht.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Ht.reject(t),null}}ke(t){this.Me>0&&this.Qe(t)?(this.Me-=1,this.Wt.Xt(()=>(this.je(),Promise.resolve()))):this.Ht.reject(t)}Qe(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!function(t){switch(e){case m:return M();case y:case w:case b:case N:case O:case C:case T:return!1;case v:case E:case I:case _:case A:case S:case x:case D:case k:return!0;default:return M()}}()}return!1}}function Gn(t,e,n){if("string"==typeof n){if(""===n)throw new R(v,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!Ct(e)&&-1!==n.indexOf("/"))throw new R(v,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(tt.W(n));if(!rt.et(r))throw new R(v,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return bt(t,new rt(r))}if(n instanceof mn)return bt(t,n.ue);throw new R(v,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Ye(n)+".")}function $n(t,e){if(!Array.isArray(t)||0===t.length)throw new R(v,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new R(v,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`);if("in"===e||"array-contains-any"===e){if(t.indexOf(null)>=0)throw new R(v,`Invalid Query. '${e.toString()}' filters cannot contain 'null' in the value array.`);if(t.filter(t=>Number.isNaN(t)).length>0)throw new R(v,`Invalid Query. '${e.toString()}' filters cannot contain 'NaN' in the value array.`)}}function Bn(t,e,n){if(!n.isEqual(e))throw new R(v,`Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function zn(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}class Hn extends mn{constructor(t,e,n){super(t.Ln,new rt(n),e),this.firestore=t,this.converter=e,this.Ge=n,this.type="document"}get id(){return this.Ge.U()}get path(){return this.Ge.G()}get parent(){return new er(this.firestore,this.ce,this.ue.path.C())}collection(t){ir("DocumentReference.collection","path",t);const e=tt.W(this.path).child(tt.W(t));return Qe(e),new er(this.firestore,null,e)}withConverter(t){return new Hn(this.firestore,t,this.Ge)}}class Kn{constructor(t,e,n){this.firestore=t,this.converter=e,this.We=n,this.type="query"}withConverter(t){return new Kn(this.firestore,t,this.We)}}class Wn{}class Xn extends Wn{constructor(t,e,n){super(),this.Ye=t,this.ze=e,this.He=n,this.type="where"}apply(t){const e=sr(t.firestore),n=function(t,e,n,r,s,i,o){let a;if(s.K()){if("array-contains"===i||"array-contains-any"===i)throw new R(v,`Invalid Query. You can't perform '${i}' queries on FieldPath.documentId().`);if("in"===i||"not-in"===i){$n(o,i);const e=[];for(const n of o)e.push(Gn(r,t,n));a={arrayValue:{values:e}}}else a=Gn(r,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||$n(o,i),a=Nn(n,e,o,"in"===i||"not-in"===i);const u=Lt.create(s,i,a);return function(t,e){if(e.ft()){const n=Ot(t);if(null!==n&&!n.isEqual(e.field))throw new R(v,`Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const r=Dt(t);null!==r&&Bn(0,e.field,r)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==n)throw n===e.op?new R(v,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new R(v,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,u),u}(t.We,"where",e,t.firestore.Ln,this.Ye,this.ze,this.He);return new Kn(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new St(t.path,t.collectionGroup,t.ct.slice(),n,t.limit,t.at,t.startAt,t.endAt)}(t.We,n))}}class Qn extends Wn{constructor(t,e){super(),this.Ye=t,this.Ke=e,this.type="orderBy"}apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new R(v,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new R(v,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const r=new zt(e,n);return function(t,e){if(null===Dt(t)){const n=Ot(t);null!==n&&Bn(0,n,e.field)}}(t,r),r}(t.We,this.Ye,this.Ke);return new Kn(t.firestore,t.converter,function(t,e){const n=t.ct.concat([e]);return new St(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.at,t.startAt,t.endAt)}(t.We,e))}}class Jn extends Wn{constructor(t,e,n){super(),this.type=t,this.Je=e,this.Ze=n}apply(t){return new Kn(t.firestore,t.converter,function(t,e,n){return new St(t.path,t.collectionGroup,t.ct.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}(t.We,this.Je,this.Ze))}}class Yn extends Wn{constructor(t,e,n){super(),this.type=t,this.Xe=e,this.tr=n}apply(t){const e=tr(t,this.type,this.Xe,this.tr);return new Kn(t.firestore,t.converter,function(t,e){return new St(t.path,t.collectionGroup,t.ct.slice(),t.filters.slice(),t.limit,t.at,e,t.endAt)}(t.We,e))}}class Zn extends Wn{constructor(t,e,n){super(),this.type=t,this.Xe=e,this.tr=n}apply(t){const e=tr(t,this.type,this.Xe,this.tr);return new Kn(t.firestore,t.converter,function(t,e){return new St(t.path,t.collectionGroup,t.ct.slice(),t.filters.slice(),t.limit,t.at,t.startAt,e)}(t.We,e))}}function tr(t,e,n,r){if(n[0]instanceof Vn)return He(e,n,1),function(t,e,n,r,s){if(!r)throw new R(E,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");const i=[];for(const n of kt(t))if(n.field.K())i.push(bt(e,r.key));else{const t=r.field(n.field);if(ct(t))throw new R(v,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.G();throw new R(v,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}i.push(t)}return new $t(i,s)}(t.We,t.firestore.Ln,e,n[0].Ne,r);{const s=sr(t.firestore);return function(t,e,n,r,s,i){const o=t.ct;if(s.length>o.length)throw new R(v,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<s.length;i++){const u=s[i];if(o[i].field.K()){if("string"!=typeof u)throw new R(v,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof u}`);if(!Ct(t)&&-1!==u.indexOf("/"))throw new R(v,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${r}() must be a plain document ID, but '${u}' contains a slash.`);const n=t.path.child(tt.W(u));if(!rt.et(n))throw new R(v,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${r}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const s=new rt(n);a.push(bt(e,s))}else{const t=Nn(n,r,u);a.push(t)}}return new $t(a,i)}(t.We,t.firestore.Ln,s,e,n,r)}}class er extends Kn{constructor(t,e,n){super(t,e,new St(n)),this.firestore=t,this.Ge=n,this.type="collection"}get id(){return this.We.path.U()}get path(){return this.We.path.G()}get parent(){const t=this.Ge.C();return t.M()?null:new Hn(this.firestore,null,t)}doc(t){0===arguments.length&&(t=G.t()),ir("CollectionReference.doc","path",t);const e=this.Ge.child(tt.W(t));return Xe(e),new Hn(this.firestore,this.converter,e)}withConverter(t){return new er(this.firestore,t,this.Ge)}}function nr(t,e){if(1===arguments.length&&(e=G.t()),ir("doc","path",e),t instanceof ze){const n=tt.W(e);return Xe(n),new Hn(t,null,n)}{if(!(t instanceof Hn||t instanceof er))throw new R(v,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t.Ge.child(tt.W(e));return Xe(n),new Hn(t.firestore,t instanceof er?t.converter:null,n)}}function rr(t,e){return t instanceof Kn&&e instanceof Kn&&t.firestore===e.firestore&&function(t,e){return function(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!Ht(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let s=0;s<t.filters.length;s++)if(n=t.filters[s],r=e.filters[s],n.op!==r.op||!n.field.isEqual(r.field)||!dt(n.value,r.value))return!1;var n,r;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Bt(t.startAt,e.startAt)&&Bt(t.endAt,e.endAt)}(Rt(t),Rt(e))&&t.at===e.at}(t.We,e.We)&&t.converter===e.converter}function sr(t){const e=t.Cn(),n=Ge(t.Ln);return new En(t.Ln,!!e.ignoreUndefinedProperties,n)}function ir(t,e,n){if(!n)throw new R(v,`Function ${t}() cannot be called with an empty ${e}.`)}class or extends on{}class ar extends or{constructor(t){super(),this.Hn=t,this.Kn=t.Kn}Jn(t){return this.Hn.Jn(t)}isEqual(t){return t instanceof ar&&this.Hn.isEqual(t.Hn)}}class ur{constructor(t,e){this.ve=t,this.nr=e,this.er=[],this.rr=!1,this.sr=sr(t)}set(t,e,n){this.ir();const r=cr(t,this.ve),s=zn(r.ce,e,n),i=In(this.sr,"WriteBatch.set",r.ue,s,null!==r.ce,n);return this.er=this.er.concat(i.ae(r.ue,be.Pt())),this}update(t,e,n,...r){this.ir();const s=cr(t,this.ve);let i;return i="string"==typeof e||e instanceof Ln?Tn(this.sr,"WriteBatch.update",s.ue,e,n,r):_n(this.sr,"WriteBatch.update",s.ue,e),this.er=this.er.concat(i.ae(s.ue,be.exists(!0))),this}delete(t){this.ir();const e=cr(t,this.ve);return this.er=this.er.concat(new Ne(e.ue,be.Pt())),this}commit(){return this.ir(),this.rr=!0,this.er.length>0?this.nr(this.er):Promise.resolve()}ir(){if(this.rr)throw new R(A,"A write batch can no longer be used after commit() has been called.")}}function cr(t,e){if(t.firestore!==e)throw new R(v,"Provided document reference is from a different Firestore instance.");return Q(t,Hn)}class hr{constructor(t,e){this.ve=t,this.or=e,this.sr=sr(t)}get(t){const e=cr(t,this.ve);return this.or.Oe([e.ue]).then(t=>{if(!t||1!==t.length)return M();const n=t[0];if(n instanceof Ce)return new Vn(this.ve,e.ue,null,e.ce);if(n instanceof Oe)return new Vn(this.ve,n.key,n,e.ce);throw M()})}set(t,e,n){const r=cr(t,this.ve),s=zn(r.ce,e,n),i=In(this.sr,"Transaction.set",r.ue,s,null!==r.ce,n);return this.or.set(r.ue,i),this}update(t,e,n,...r){const s=cr(t,this.ve);let i;return i="string"==typeof e||e instanceof Ln?Tn(this.sr,"Transaction.update",s.ue,e,n,r):_n(this.sr,"Transaction.update",s.ue,e),this.or.update(s.ue,i),this}delete(t){const e=cr(t,this.ve);return this.or.delete(e.ue),this}}e._registerComponent(new c("firestore/lite",t=>((t,e)=>new ze(t,e))(t.getProvider("app-exp").getImmediate(),t.getProvider("auth-internal")),"PUBLIC")),e.registerVersion("firestore-lite","0.0.800","node"),t.Bytes=pn,t.CollectionReference=er,t.DocumentReference=Hn,t.DocumentSnapshot=Vn,t.FieldPath=Ln,t.FieldValue=or,t.FirebaseFirestore=ze,t.GeoPoint=dn,t.Query=Kn,t.QueryConstraint=Wn,t.QueryDocumentSnapshot=Un,t.QuerySnapshot=Mn,t.Timestamp=J,t.Transaction=hr,t.WriteBatch=ur,t.addDoc=function(t,e){const n=Q(t,er),r=nr(n),s=zn(n.converter,e),i=In(sr(n.firestore),"addDoc",r.ue,s,null!==r.ce,{});return Me(Be(n.firestore),i.ae(r.ue,be.exists(!1))).then(()=>r)},t.arrayRemove=function(...t){return Ke("arrayRemove()",arguments,1),new ar(new ln("arrayRemove",t))},t.arrayUnion=function(...t){return Ke("arrayUnion()",arguments,1),new ar(new hn("arrayUnion",t))},t.collection=function(t,e){if(ir("collection","path",e),t instanceof ze){const n=tt.W(e);return Qe(n),new er(t,null,n)}{if(!(t instanceof Hn||t instanceof er))throw new R(v,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=tt.W(t.path).child(tt.W(e));return Qe(n),new er(t.firestore,null,n)}},t.collectionGroup=function(t,e){const n=Q(t,ze);if(ir("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new R(v,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Kn(n,null,function(t){return new St(tt.Y(),t)}(e))},t.deleteDoc=function(t){const e=Q(t,Hn);return Me(Be(e.firestore),[new Ne(e.ue,be.Pt())])},t.deleteField=function(){return new ar(new an("deleteField"))},t.doc=nr,t.documentId=function(){return new Ln("__name__")},t.endAt=function(...t){return new Zn("endAt",t,!1)},t.endBefore=function(...t){return new Zn("endBefore",t,!0)},t.getDoc=function(t){const e=Q(t,Hn);return qe(Be(e.firestore),[e.ue]).then(t=>{q(1===t.length);const n=t[0];return new Vn(e.firestore,e.ue,n instanceof Oe?n:null,e.ce)})},t.getDocs=function(t){const e=Q(t,Kn);return function(t){if(xt(t)&&0===t.ct.length)throw new R(D,"limitToLast() queries require specifying at least one orderBy() clause")}(e.We),async function(t,e){const n=F(t),r=ce(n.serializer,Rt(e));return(await n.bn("RunQuery",r.parent,{structuredQuery:r.structuredQuery})).filter(t=>!!t.document).map(t=>(function(t,e,n){const r=se(t,e.name),s=ee(e.updateTime),i=new Se({mapValue:{fields:e.fields}});return new Oe(r,s,i,{hasCommittedMutations:!1})})(n.serializer,t.document))}(Be(e.firestore),e.We).then(n=>{const r=n.map(t=>new Un(e.firestore,t.key,t,e.converter));return xt(e.We)&&r.reverse(),new Mn(t,r)})},t.getFirestore=function(t){return e._getProvider(t,"firestore/lite").getImmediate()},t.increment=function(t){return new ar(new fn("increment",t))},t.initializeFirestore=function(t,n){const r=e._getProvider(t,"firestore/lite").getImmediate();return r.Gn(n),r},t.limit=function(t){return Ze("limit",1,t),new Jn("limit",t,"F")},t.limitToLast=function(t){return Ze("limitToLast",1,t),new Jn("limitToLast",t,"L")},t.orderBy=function(t,e="asc"){const n=e,r=qn("orderBy",t);return new Qn(r,n)},t.query=function(t,...e){let n=Q(t,Kn);for(const t of e)n=t.apply(n);return n},t.queryEqual=rr,t.refEqual=function(t,e){return(t instanceof Hn||t instanceof er)&&(e instanceof Hn||e instanceof er)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter},t.runTransaction=function(t,e){const n=Q(t,ze),r=Be(n),s=new ke;return new jn(new Ve,r,t=>e(new hr(n,t)),s).run(),s.promise},t.serverTimestamp=function(){return new ar(new cn("serverTimestamp"))},t.setDoc=function(t,e,n){const r=Q(t,Hn),s=zn(r.ce,e,n),i=In(sr(r.firestore),"setDoc",r.ue,s,null!==r.ce,n);return Me(Be(r.firestore),i.ae(r.ue,be.Pt()))},t.setLogLevel=function(t){L.setLogLevel(t)},t.snapshotEqual=function t(e,n){return e instanceof Vn&&n instanceof Vn?e.ve===n.ve&&e.ue.isEqual(n.ue)&&(null===e.Ne?null===n.Ne:e.Ne.isEqual(n.Ne))&&e.ce===n.ce:e instanceof Mn&&n instanceof Mn&&rr(e.query,n.query)&&B(e.docs,n.docs,t)},t.startAfter=function(...t){return new Yn("startAfter",t,!1)},t.startAt=function(...t){return new Yn("startAt",t,!0)},t.terminate=function(t){return e._removeServiceInstance(t.app,"firestore/lite"),Q(t,ze)._delete()},t.updateDoc=function(t,e,n,...r){const s=Q(t,Hn),i=sr(s.firestore);let o;return o="string"==typeof e||e instanceof Ln?Tn(i,"updateDoc",s.ue,e,n,r):_n(i,"updateDoc",s.ue,e),Me(Be(s.firestore),o.ae(s.ue,be.exists(!0)))},t.where=function(t,e,n){const r=e,s=qn("where",t);return new Xn(s,r,n)},t.writeBatch=function(t){const e=Q(t,ze),n=Be(e);return new ur(e,t=>Me(n,t))},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore-lite.js - be sure to load firebase-app.js first.")}});