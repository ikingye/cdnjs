!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@firebase/app")):"function"==typeof define&&define.amd?define(["exports","@firebase/app"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).firebase=t.firebase||{},t.firebase.firestore=t.firebase.firestore||{}),t.firebase.app)}(this,function(t,e){"use strict";try{(function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var i="FirebaseError",r=function(t){function e(n,s){var r=t.call(this,s)||this;return r.code=n,r.name=i,Object.setPrototypeOf(r,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(r,o.prototype.create),r}return function(t,e){function s(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)}(e,t),e}(Error),o=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var s=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(c,function(t,n){var s=e[n];return null!=s?String(s):"<"+n+"?>"})}(o,s):"Error",h=this.serviceName+": "+a+" ("+i+").",u=new r(i,h),l=0,f=Object.keys(s);l<f.length;l++){var d=f[l];"_"!==d.slice(-1)&&(d in u&&console.warn('Overwriting FirebaseError base field "'+d+'" can cause unexpected behavior.'),u[d]=s[d])}return u},t}();var a,h,c=/\{\$([^}]+)}/g,u=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t}();function l(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var s=Array(t),i=0;for(e=0;e<n;e++)for(var r=arguments[e],o=0,a=r.length;o<a;o++,i++)s[i]=r[o];return s}!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(h||(h={}));var f={debug:h.DEBUG,verbose:h.VERBOSE,info:h.INFO,warn:h.WARN,error:h.ERROR,silent:h.SILENT},d=h.INFO,p=((a={})[h.DEBUG]="log",a[h.VERBOSE]="log",a[h.INFO]="info",a[h.WARN]="warn",a[h.ERROR]="error",a),g=function(t,e){for(var n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];if(!(e<t.logLevel)){var i=(new Date).toISOString(),r=p[e];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[r].apply(console,l(["["+i+"]  "+t.name+":"],n))}},m=function(){function t(t){this.name=t,this._logLevel=d,this._logHandler=g,this._userLogHandler=null}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in h))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?f[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.DEBUG],t)),this._logHandler.apply(this,l([this,h.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.VERBOSE],t)),this._logHandler.apply(this,l([this,h.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.INFO],t)),this._logHandler.apply(this,l([this,h.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.WARN],t)),this._logHandler.apply(this,l([this,h.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,l([this,h.ERROR],t)),this._logHandler.apply(this,l([this,h.ERROR],t))},t}(),y=function(t,e){return(y=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function w(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],s=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&s>=t.length&&(t=void 0),{value:t&&t[s++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var v,b="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},E=E||{},I=b||self;function _(){}function T(t){var e=typeof t;return"object"!=e?e:t?Array.isArray(t)?"array":e:"null"}function N(t){var e=T(t);return"array"==e||"object"==e&&"number"==typeof t.length}function A(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var x="closure_uid_"+(1e9*Math.random()>>>0),S=0;function k(t,e,n){return t.call.apply(t.bind,arguments)}function D(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function C(t,e,n){return(C=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?k:D).apply(null,arguments)}function R(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var L=Date.now;function O(t,e){function n(){}n.prototype=e.prototype,t.S=e.prototype,t.prototype=new n,t.prototype.constructor=t}function P(){this.j=this.j,this.i=this.i}P.prototype.j=!1,P.prototype.ja=function(){if(!this.j&&(this.j=!0,this.G(),0))(function(t){Object.prototype.hasOwnProperty.call(t,x)&&t[x]||(t[x]=++S)})(this)},P.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var V=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},U=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var s=t.length,i="string"==typeof t?t.split(""):t,r=0;r<s;r++)r in i&&e.call(n,i[r],r,t)};function M(t){return Array.prototype.concat.apply([],arguments)}function q(t){var e=t.length;if(0<e){for(var n=Array(e),s=0;s<e;s++)n[s]=t[s];return n}return[]}function F(t){return/^[\s\xa0]*$/.test(t)}var G,j=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function $(t,e){return-1!=t.indexOf(e)}function B(t,e){return t<e?-1:t>e?1:0}t:{var z=I.navigator;if(z){var K=z.userAgent;if(K){G=K;break t}}G=""}function H(t,e,n){for(var s in t)e.call(n,t[s],s,t)}function W(t){var e={};for(var n in t)e[n]=t[n];return e}var X="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function J(t,e){for(var n,s,i=1;i<arguments.length;i++){for(n in s=arguments[i])t[n]=s[n];for(var r=0;r<X.length;r++)n=X[r],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function Q(t){return Q[" "](t),t}Q[" "]=_;var Y,Z,tt=$(G,"Opera"),et=$(G,"Trident")||$(G,"MSIE"),nt=$(G,"Edge"),st=nt||et,it=$(G,"Gecko")&&!($(G.toLowerCase(),"webkit")&&!$(G,"Edge"))&&!($(G,"Trident")||$(G,"MSIE"))&&!$(G,"Edge"),rt=$(G.toLowerCase(),"webkit")&&!$(G,"Edge");function ot(){var t=I.document;return t?t.documentMode:void 0}t:{var at="",ht=(Z=G,it?/rv:([^\);]+)(\)|;)/.exec(Z):nt?/Edge\/([\d\.]+)/.exec(Z):et?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Z):rt?/WebKit\/(\S+)/.exec(Z):tt?/(?:Version)[ \/]?(\S+)/.exec(Z):void 0);if(ht&&(at=ht?ht[1]:""),et){var ct=ot();if(null!=ct&&ct>parseFloat(at)){Y=String(ct);break t}}Y=at}var ut,lt={};function ft(t){return function(t,e){var n=lt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=j(String(Y)).split("."),s=j(String(t)).split("."),i=Math.max(n.length,s.length),r=0;0==e&&r<i;r++){var o=n[r]||"",a=s[r]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==o[0].length&&0==a[0].length)break;e=B(0==o[1].length?0:parseInt(o[1],10),0==a[1].length?0:parseInt(a[1],10))||B(0==o[2].length,0==a[2].length)||B(o[2],a[2]),o=o[3],a=a[3]}while(0==e)}return 0<=e})}if(I.document&&et){var dt=ot();ut=dt||(parseInt(Y,10)||void 0)}else ut=void 0;var pt=ut,gt=!et||9<=Number(pt),mt=et&&!ft("9"),yt=function(){if(!I.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{I.addEventListener("test",_,e),I.removeEventListener("test",_,e)}catch(t){}return t}();function wt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function vt(t,e){if(wt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(it){t:{try{Q(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:bt[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}wt.prototype.b=function(){this.defaultPrevented=!0},O(vt,wt);var bt={2:"touch",3:"pen",4:"mouse"};vt.prototype.b=function(){vt.S.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,mt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var Et="closure_listenable_"+(1e6*Math.random()|0),It=0;function _t(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.ca=null}function Tt(t){this.src=t,this.a={},this.b=0}function Nt(t,e){var n=e.type;if(n in t.a){var s,i=t.a[n],r=V(i,e);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(_t(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function At(t,e,n,s){for(var i=0;i<t.length;++i){var r=t[i];if(!r.Y&&r.listener==e&&r.capture==!!n&&r.ca==s)return i}return-1}Tt.prototype.add=function(t,e,n,s,i){var r=t.toString();(t=this.a[r])||(t=this.a[r]=[],this.b++);var o=At(t,e,s,i);return-1<o?(e=t[o],n||(e.Z=!1)):((e=new function(t,e,n,s,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.ca=i,this.key=++It,this.Y=this.Z=!1}(e,this.src,r,!!s,i)).Z=n,t.push(e)),e};var xt="closure_lm_"+(1e6*Math.random()|0),St={};function kt(t,e,n,s,i){if(s&&s.once)return function t(e,n,s,i,r){if(Array.isArray(n)){for(var o=0;o<n.length;o++)t(e,n[o],s,i,r);return null}s=Ut(s);return e&&e[Et]?e.wa(n,s,A(i)?!!i.capture:!!i,r):Dt(e,n,s,!0,i,r)}(t,e,n,s,i);if(Array.isArray(e)){for(var r=0;r<e.length;r++)kt(t,e[r],n,s,i);return null}return n=Ut(n),t&&t[Et]?t.va(e,n,A(s)?!!s.capture:!!s,i):Dt(t,e,n,!1,s,i)}function Dt(t,e,n,s,i,r){if(!e)throw Error("Invalid event type");var o=A(i)?!!i.capture:!!i;if(o&&!gt)return null;var a=Pt(t);if(a||(t[xt]=a=new Tt(t)),(n=a.add(e,n,s,o,r)).proxy)return n;if(s=function(){var t=Ot,e=gt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)yt||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),s,i);else if(t.attachEvent)t.attachEvent(Rt(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function Ct(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[Et])Nt(e.c,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(Rt(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=Pt(e))?(Nt(n,t),0==n.b&&(n.src=null,e[xt]=null)):_t(t)}}}function Rt(t){return t in St?St[t]:St[t]="on"+t}function Lt(t,e){var n=t.listener,s=t.ca||t.src;return t.Z&&Ct(t),n.call(s,e)}function Ot(t,e){if(t.Y)return!0;if(!gt){if(!e)t:{e=["window","event"];for(var n=I,s=0;s<e.length;s++)if(null==(n=n[e[s]])){e=null;break t}e=n}return Lt(t,e=new vt(e,this))}return Lt(t,new vt(e,this))}function Pt(t){return(t=t[xt])instanceof Tt?t:null}var Vt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ut(t){return"function"==T(t)?t:(t[Vt]||(t[Vt]=function(e){return t.handleEvent(e)}),t[Vt])}function Mt(){P.call(this),this.c=new Tt(this),this.J=this,this.C=null}function qt(t,e,n,s){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,r=0;r<e.length;++r){var o=e[r];if(o&&!o.Y&&o.capture==n){var a=o.listener,h=o.ca||o.src;o.Z&&Nt(t.c,o),i=!1!==a.call(h,s)&&i}}return i&&!s.defaultPrevented}O(Mt,P),Mt.prototype[Et]=!0,(v=Mt.prototype).addEventListener=function(t,e,n,s){kt(this,t,e,n,s)},v.removeEventListener=function(t,e,n,s){!function t(e,n,s,i,r){if(Array.isArray(n))for(var o=0;o<n.length;o++)t(e,n[o],s,i,r);else i=A(i)?!!i.capture:!!i,s=Ut(s),e&&e[Et]?(e=e.c,(n=String(n).toString())in e.a&&-1<(s=At(o=e.a[n],s,i,r))&&(_t(o[s]),Array.prototype.splice.call(o,s,1),0==o.length&&(delete e.a[n],e.b--))):e&&(e=Pt(e))&&(n=e.a[n.toString()],e=-1,n&&(e=At(n,s,i,r)),(s=-1<e?n[e]:null)&&Ct(s))}(this,t,e,n,s)},v.dispatchEvent=function(t){var e,n=this.C;if(n)for(e=[];n;n=n.C)e.push(n);n=this.J;var s=t.type||t;if("string"==typeof t)t=new wt(t,n);else if(t instanceof wt)t.target=t.target||n;else{var i=t;J(t=new wt(s,n),i)}if(i=!0,e)for(var r=e.length-1;0<=r;r--){var o=t.a=e[r];i=qt(o,s,!0,t)&&i}if(i=qt(o=t.a=n,s,!0,t)&&i,i=qt(o,s,!1,t)&&i,e)for(r=0;r<e.length;r++)i=qt(o=t.a=e[r],s,!1,t)&&i;return i},v.G=function(){if(Mt.S.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],s=0;s<n.length;s++)_t(n[s]);delete e.a[t],e.b--}}this.C=null},v.va=function(t,e,n,s){return this.c.add(String(t),e,!1,n,s)},v.wa=function(t,e,n,s){return this.c.add(String(t),e,!0,n,s)};var Ft=I.JSON.stringify;function Gt(){this.b=this.a=null}var jt,$t=new(function(){function t(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},t}())(function(){return new zt},function(t){t.reset()},100);function Bt(){var t=Xt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function zt(){this.next=this.b=this.a=null}function Kt(t){I.setTimeout(function(){throw t},0)}function Ht(t,e){jt||function(){var t=I.Promise.resolve(void 0);jt=function(){t.then(Jt)}}(),Wt||(jt(),Wt=!0),Xt.add(t,e)}Gt.prototype.add=function(t,e){var n=$t.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},zt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},zt.prototype.reset=function(){this.next=this.b=this.a=null};var Wt=!1,Xt=new Gt;function Jt(){for(var t;t=Bt();){try{t.a.call(t.b)}catch(t){Kt(t)}var e=$t;e.g(t),e.b<e.f&&(e.b++,t.next=e.a,e.a=t)}Wt=!1}function Qt(t,e){Mt.call(this),this.b=t||1,this.a=e||I,this.f=C(this.Ya,this),this.g=L()}function Yt(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function Zt(t,e,n){if("function"==T(t))n&&(t=C(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=C(t.handleEvent,t)}return 2147483647<Number(e)?-1:I.setTimeout(t,e||0)}O(Qt,Mt),(v=Qt.prototype).aa=!1,v.M=null,v.Ya=function(){if(this.aa){var t=L()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),this.dispatchEvent("tick"),this.aa&&(Yt(this),this.start()))}},v.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=L())},v.G=function(){Qt.S.G.call(this),Yt(this),delete this.a};var te=function(t){function e(e,n,s){var i=t.call(this)||this;return i.g=null!=s?e.bind(s):e,i.h=n,i.b=null,i.c=!1,i.a=null,i}return function(t,e){function n(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:function t(e){e.a=Zt(function(){e.a=null,e.c&&(e.c=!1,t(e))},e.h);var n=e.b;e.b=null,e.g.apply(null,n)}(this)},e.prototype.G=function(){t.prototype.G.call(this),this.a&&(I.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(P);function ee(t){P.call(this),this.b=t,this.a={}}O(ee,P);var ne=[];function se(t,e,n,s){Array.isArray(n)||(n&&(ne[0]=n.toString()),n=ne);for(var i=0;i<n.length;i++){var r=kt(e,n[i],s||t.handleEvent,!1,t.b||t);if(!r)break;t.a[r.key]=r}}function ie(t){H(t.a,function(t,e){this.a.hasOwnProperty(e)&&Ct(t)},t),t.a={}}function re(){this.a=!0}function oe(t,e,n,s){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var i=s[1];if(Array.isArray(i)&&!(1>i.length)){var r=i[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<i.length;o++)i[o]=""}}}return Ft(n)}catch(t){return e}}(t,n)+(s?" "+s:"")})}ee.prototype.G=function(){ee.S.G.call(this),ie(this)},ee.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},re.prototype.info=function(){};var ae=null;function he(){return ae=ae||new Mt}function ce(t){wt.call(this,"serverreachability",t)}function ue(t){var e=he();e.dispatchEvent(new ce(e,t))}function le(t){wt.call(this,"statevent",t)}function fe(t){var e=he();e.dispatchEvent(new le(e,t))}function de(t){wt.call(this,"timingevent",t)}function pe(t,e){if("function"!=T(t))throw Error("Fn must not be null and must be a function");return I.setTimeout(function(){t()},e)}O(ce,wt),O(le,wt),O(de,wt);var ge={NO_ERROR:0,Za:1,gb:2,fb:3,bb:4,eb:5,hb:6,Da:7,TIMEOUT:8,kb:9},me={ab:"complete",ob:"success",Ea:"error",Da:"abort",mb:"ready",nb:"readystatechange",TIMEOUT:"timeout",ib:"incrementaldata",lb:"progress",cb:"downloadprogress",pb:"uploadprogress"};function ye(){}function we(t){var e;return(e=t.a)||(e=t.a={}),e}function ve(){}ye.prototype.a=null;var be,Ee={OPEN:"a",$a:"b",Ea:"c",jb:"d"};function Ie(){wt.call(this,"d")}function _e(){wt.call(this,"c")}function Te(){}function Ne(t,e,n,s){this.g=t,this.c=e,this.f=n,this.T=s||1,this.J=new ee(this),this.P=Ae,t=st?125:void 0,this.R=new Qt(t),this.B=null,this.b=!1,this.j=this.l=this.i=this.H=this.u=this.U=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.W=this.C=this.V=this.I=!1}O(Ie,wt),O(_e,wt),O(Te,ye),be=new Te;var Ae=45e3,xe={},Se={};function ke(t,e,n){t.H=1,t.i=Qe(ze(e)),t.j=n,t.I=!0,De(t,null)}function De(t,e){t.u=L(),Le(t),t.l=ze(t.i);var n=t.l,s=t.T;Array.isArray(s)||(s=[String(s)]),ln(n.b,"t",s),t.D=0,t.a=ss(t.g,t.g.C?e:null),0<t.O&&(t.F=new te(C(t.Ca,t,t.a),t.O)),se(t.J,t.a,"readystatechange",t.Wa),e=t.B?W(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),ue(1),function(t,e,n,s,i,r){t.info(function(){if(t.a)if(r)for(var o="",a=r.split("&"),h=0;h<a.length;h++){var c=a[h].split("=");if(1<c.length){var u=c[0];c=c[1];var l=u.split("_");o=2<=l.length&&"type"==l[1]?o+(u+"=")+c+"&":o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+s+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o})}(t.c,t.m,t.l,t.f,t.T,t.j)}function Ce(t,e,n){for(var s=!0;!t.A&&t.D<n.length;){var i=Re(t,n);if(i==Se){4==e&&(t.h=4,fe(14),s=!1),oe(t.c,t.f,null,"[Incomplete Response]");break}if(i==xe){t.h=4,fe(15),oe(t.c,t.f,n,"[Invalid Chunk]"),s=!1;break}oe(t.c,t.f,i,null),Me(t,i)}4==e&&0==n.length&&(t.h=1,fe(16),s=!1),t.b=t.b&&s,s?0<n.length&&!t.W&&(t.W=!0,(e=t.g).a==t&&e.V&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),Xn(e),e.F=!0)):(oe(t.c,t.f,n,"[Invalid Chunked Response]"),Ue(t),Ve(t))}function Re(t,e){var n=t.D,s=e.indexOf("\n",n);return-1==s?Se:(n=Number(e.substring(n,s)),isNaN(n)?xe:(s+=1)+n>e.length?Se:(e=e.substr(s,n),t.D=s+n,e))}function Le(t){t.U=L()+t.P,Oe(t,t.P)}function Oe(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=pe(C(t.Ua,t),e)}function Pe(t){t.o&&(I.clearTimeout(t.o),t.o=null)}function Ve(t){0==t.g.v||t.A||Yn(t.g,t)}function Ue(t){Pe(t);var e=t.F;e&&"function"==typeof e.ja&&e.ja(),t.F=null,Yt(t.R),ie(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ja())}function Me(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||yn(n.b,t)))if(n.I=t.N,!t.C&&yn(n.b,t)&&3==n.v){try{var s=n.ka.a.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var i=s;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;Qn(n),Fn(n)}Wn(n),fe(18)}}else n.oa=i[1],0<n.oa-n.P&&37500>i[2]&&n.H&&0==n.o&&!n.m&&(n.m=pe(C(n.Ra,n),6e3));if(1>=mn(n.b)&&n.ea){try{n.ea()}catch(t){}n.ea=void 0}}else ts(n,11)}else if((t.C||n.a==t)&&Qn(n),!F(e))for(e=s=n.ka.a.parse(e),s=0;s<e.length;s++)if(i=e[s],n.P=i[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ga=i[2];var r=i[3];null!=r&&(n.ha=r,n.c.info("VER="+n.ha));var o=i[4];null!=o&&(n.pa=o,n.c.info("SVER="+n.pa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var h=1.5*a;n.D=h,n.c.info("backChannelRequestTimeoutMs_="+h)}h=n;var c=t.a;if(c){var u=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(u){var l=h.b;!l.a&&($(u,"spdy")||$(u,"quic")||$(u,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(wn(l,l.b),l.b=null))}if(h.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(h.na=f,Je(h.B,h.A,f))}}n.v=3,n.f&&n.f.ta(),n.V&&(n.N=L()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((h=n).la=ns(h,h.C?h.ga:null,h.fa),d.C){vn(h.b,d);var p=d,g=h.D;g&&p.setTimeout(g),p.o&&(Pe(p),Le(p)),h.a=d}else Hn(h);0<n.g.length&&$n(n)}else"stop"!=i[0]&&"close"!=i[0]||ts(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?ts(n,7):qn(n):"noop"!=i[0]&&n.f&&n.f.sa(i),n.o=0);ue(4)}catch(t){}}function qe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(N(t)||"string"==typeof t)U(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(N(t)||"string"==typeof t){n=[];for(var s=t.length,i=0;i<s;i++)n.push(i)}else for(i in n=[],s=0,t)n[s++]=i;i=(s=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(N(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}for(s in e=[],n=0,t)e[n++]=t[s];return e}(t)).length;for(var r=0;r<i;r++)e.call(void 0,s[r],n&&n[r],t)}}function Fe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var s=0;s<n;s+=2)this.set(arguments[s],arguments[s+1])}else if(t)if(t instanceof Fe)for(n=t.L(),s=0;s<n.length;s++)this.set(n[s],t.get(n[s]));else for(s in t)this.set(s,t[s])}function Ge(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var s=t.a[e];je(t.b,s)&&(t.a[n++]=s),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)je(i,s=t.a[e])||(t.a[n++]=s,i[s]=1),e++;t.a.length=n}}function je(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(v=Ne.prototype).setTimeout=function(t){this.P=t},v.Wa=function(t){t=t.target;var e=this.F;e&&3==Pn(t)?e.f():this.Ca(t)},v.Ca=function(t){try{if(t==this.a)t:{var e=Pn(this.a),n=this.a.ua(),s=this.a.X();if(!(3>e||3==e&&!st&&!this.a.$())){this.A||4!=e||7==n||ue(8==n||0>=s?3:2),Pe(this);var i=this.a.X();this.N=i;var r=this.a.$();if(this.b=200==i,function(t,e,n,s,i,r,o){t.info(function(){return"XMLHTTP RESP ("+s+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+r+" "+o})}(this.c,this.m,this.l,this.f,this.T,e,i),this.b){if(this.V&&!this.C){e:{if(this.a){var o,a=this.a;if((o=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!F(o)){var h=o;break e}}h=null}if(!h){this.b=!1,this.h=3,fe(12),Ue(this),Ve(this);break t}oe(this.c,this.f,h,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,Me(this,h)}this.I?(Ce(this,e,r),st&&this.b&&3==e&&(se(this.J,this.R,"tick",this.Va),this.R.start())):(oe(this.c,this.f,r,null),Me(this,r)),4==e&&Ue(this),this.b&&!this.A&&(4==e?Yn(this.g,this):(this.b=!1,Le(this)))}else 400==i&&0<r.indexOf("Unknown SID")?(this.h=3,fe(12)):(this.h=0,fe(13)),Ue(this),Ve(this)}}}catch(t){}},v.Va=function(){if(this.a){var t=Pn(this.a),e=this.a.$();this.D<e.length&&(Pe(this),Ce(this,t,e),this.b&&4!=t&&Le(this))}},v.cancel=function(){this.A=!0,Ue(this)},v.Ua=function(){this.o=null;var t=L();0<=t-this.U?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.H&&(ue(3),fe(17)),Ue(this),this.h=2,Ve(this)):Oe(this,this.U-t)},(v=Fe.prototype).K=function(){Ge(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},v.L=function(){return Ge(this),this.a.concat()},v.get=function(t,e){return je(this.b,t)?this.b[t]:e},v.set=function(t,e){je(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},v.forEach=function(t,e){for(var n=this.L(),s=0;s<n.length;s++){var i=n[s],r=this.get(i);t.call(e,r,i,this)}};var $e=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Be(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Be){this.a=void 0!==e?e:t.a,Ke(this,t.f),this.j=t.j,He(this,t.c),We(this,t.h),this.g=t.g,e=t.b;var n=new an;n.c=e.c,e.a&&(n.a=new Fe(e.a),n.b=e.b),Xe(this,n),this.i=t.i}else t&&(n=String(t).match($e))?(this.a=!!e,Ke(this,n[1]||"",!0),this.j=Ye(n[2]||""),He(this,n[3]||"",!0),We(this,n[4]),this.g=Ye(n[5]||"",!0),Xe(this,n[6]||"",!0),this.i=Ye(n[7]||"")):(this.a=!!e,this.b=new an(null,this.a))}function ze(t){return new Be(t)}function Ke(t,e,n){t.f=n?Ye(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function He(t,e,n){t.c=n?Ye(e,!0):e}function We(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function Xe(t,e,n){e instanceof an?(t.b=e,function(t,e){e&&!t.f&&(hn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(cn(this,e),ln(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=Ze(e,rn)),t.b=new an(e,t.a))}function Je(t,e,n){t.b.set(e,n)}function Qe(t){return Je(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^L()).toString(36)),t}function Ye(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Ze(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,tn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function tn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Be.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Ze(e,en,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Ze(e,en,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(Ze(n,"/"==n.charAt(0)?sn:nn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",Ze(n,on)),t.join("")};var en=/[#\/\?@]/g,nn=/[#\?:]/g,sn=/[#\?]/g,rn=/[#\?@]/g,on=/#/g;function an(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function hn(t){t.a||(t.a=new Fe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),i=null;if(0<=s){var r=t[n].substring(0,s);i=t[n].substring(s+1)}else r=t[n];e(r,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function cn(t,e){hn(t),e=fn(t,e),je(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,je((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Ge(t)))}function un(t,e){return hn(t),e=fn(t,e),je(t.a.b,e)}function ln(t,e,n){cn(t,e),0<n.length&&(t.c=null,t.a.set(fn(t,e),q(n)),t.b+=n.length)}function fn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function dn(t){this.g=t||pn,I.PerformanceNavigationTiming?t=0<(t=I.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(I.ia&&I.ia.ya&&I.ia.ya()&&I.ia.ya().qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(v=an.prototype).add=function(t,e){hn(this),this.c=null,t=fn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},v.forEach=function(t,e){hn(this),this.a.forEach(function(n,s){U(n,function(n){t.call(e,n,s,this)},this)},this)},v.L=function(){hn(this);for(var t=this.a.K(),e=this.a.L(),n=[],s=0;s<e.length;s++)for(var i=t[s],r=0;r<i.length;r++)n.push(e[s]);return n},v.K=function(t){hn(this);var e=[];if("string"==typeof t)un(this,t)&&(e=M(e,this.a.get(fn(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=M(e,t[n])}return e},v.set=function(t,e){return hn(this),this.c=null,un(this,t=fn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},v.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},v.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var s=e[n],i=encodeURIComponent(String(s));s=this.K(s);for(var r=0;r<s.length;r++){var o=i;""!==s[r]&&(o+="="+encodeURIComponent(String(s[r]))),t.push(o)}}return this.c=t.join("&")};var pn=10;function gn(t){return!!t.b||!!t.a&&t.a.size>=t.f}function mn(t){return t.b?1:t.a?t.a.size:0}function yn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function wn(t,e){t.a?t.a.add(e):t.b=e}function vn(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function bn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var s=t.c;try{for(var i=w(t.a.values()),r=i.next();!r.done;r=i.next()){var o=r.value;s=s.concat(o.s)}}catch(t){e={error:t}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return s}return q(t.c)}function En(){}function In(t,e,n){var s=n||"";try{qe(t,function(t,n){var i=t;A(t)&&(i=Ft(t)),e.push(s+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}function _n(t,e,n,s,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(s)}catch(t){}}dn.prototype.cancel=function(){var t,e;if(this.c=bn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=w(this.a.values()),s=n.next();!s.done;s=n.next()){s.value.cancel()}}catch(e){t={error:e}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},En.prototype.stringify=function(t){return I.JSON.stringify(t,void 0)},En.prototype.parse=function(t){return I.JSON.parse(t,void 0)};var Tn=I.JSON.parse;function Nn(t){Mt.call(this),this.headers=new Fe,this.H=t||null,this.b=!1,this.s=this.a=null,this.B="",this.h=0,this.f="",this.g=this.A=this.l=this.u=!1,this.o=0,this.m=null,this.I=An,this.D=this.F=!1}O(Nn,Mt);var An="",xn=/^https?$/i,Sn=["POST","PUT"];function kn(t){return"content-type"==t.toLowerCase()}function Dn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Cn(t),Ln(t)}function Cn(t){t.u||(t.u=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Rn(t){if(t.b&&void 0!==E&&(!t.s[1]||4!=Pn(t)||2!=t.X()))if(t.l&&4==Pn(t))Zt(t.za,0,t);else if(t.dispatchEvent("readystatechange"),4==Pn(t)){t.b=!1;try{var e,n=t.X();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var s=!0;break t;default:s=!1}if(!(e=s)){var i;if(i=0===n){var r=String(t.B).match($e)[1]||null;if(!r&&I.self&&I.self.location){var o=I.self.location.protocol;r=o.substr(0,o.length-1)}i=!xn.test(r?r.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var a=2<Pn(t)?t.a.statusText:""}catch(t){a=""}t.f=a+" ["+t.X()+"]",Cn(t)}}finally{Ln(t)}}}function Ln(t,e){if(t.a){On(t);var n=t.a,s=t.s[0]?_:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=s}catch(t){}}}function On(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(I.clearTimeout(t.m),t.m=null)}function Pn(t){return t.a?t.a.readyState:0}function Vn(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=function(t){var e="";return H(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Je(t,e,n))}function Un(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Mn(t){this.pa=0,this.g=[],this.c=new re,this.ga=this.la=this.B=this.fa=this.a=this.na=this.A=this.W=this.i=this.O=this.l=null,this.La=this.R=0,this.Ia=Un("failFast",!1,t),this.H=this.m=this.j=this.h=this.f=null,this.T=!0,this.I=this.oa=this.P=-1,this.U=this.o=this.u=0,this.Fa=Un("baseRetryDelayMs",5e3,t),this.Ma=Un("retryDelaySeedMs",1e4,t),this.Ja=Un("forwardChannelMaxRetries",2,t),this.ma=Un("forwardChannelRequestTimeoutMs",2e4,t),this.Ka=t&&t.g||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new dn(t&&t.concurrentRequestLimit),this.ka=new function(){this.a=new En},this.da=t&&t.fastHandshake||!1,this.Ga=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.T=!1),this.V=!this.da&&this.T&&t&&t.c||!1,this.ea=void 0,this.N=0,this.F=!1,this.s=null}function qn(t){if(Gn(t),3==t.v){var e=t.R++,n=ze(t.B);Je(n,"SID",t.J),Je(n,"RID",e),Je(n,"TYPE","terminate"),zn(t,n),(e=new Ne(t,t.c,e,void 0)).H=2,e.i=Qe(ze(n)),n=!1,I.navigator&&I.navigator.sendBeacon&&(n=I.navigator.sendBeacon(e.i.toString(),"")),!n&&I.Image&&((new Image).src=e.i,n=!0),n||(e.a=ss(e.g,null),e.a.ba(e.i)),e.u=L(),Le(e)}es(t)}function Fn(t){t.a&&(Xn(t),t.a.cancel(),t.a=null)}function Gn(t){Fn(t),t.j&&(I.clearTimeout(t.j),t.j=null),Qn(t),t.b.cancel(),t.h&&("number"==typeof t.h&&I.clearTimeout(t.h),t.h=null)}function jn(t,e){t.g.push(new function(t,e){this.b=t,this.a=e}(t.La++,e)),3==t.v&&$n(t)}function $n(t){gn(t.b)||t.h||(t.h=!0,Ht(t.Ba,t),t.u=0)}function Bn(t,e){var n;n=e?e.f:t.R++;var s=ze(t.B);Je(s,"SID",t.J),Je(s,"RID",n),Je(s,"AID",t.P),zn(t,s),t.i&&t.l&&Vn(s,t.i,t.l),n=new Ne(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=Kn(t,n,1e3),n.setTimeout(Math.round(.5*t.ma)+Math.round(.5*t.ma*Math.random())),wn(t.b,n),ke(n,s,e)}function zn(t,e){t.f&&qe({},function(t,n){Je(e,n,t)})}function Kn(t,e,n){n=Math.min(t.g.length,n);var s=t.f?C(t.f.Ha,t.f,t):null;t:for(var i=t.g,r=-1;;){var o=["count="+n];-1==r?0<n?(r=i[0].b,o.push("ofs="+r)):r=0:o.push("ofs="+r);for(var a=!0,h=0;h<n;h++){var c=i[h].b,u=i[h].a;if(0>(c-=r))r=Math.max(0,i[h].b-100),a=!1;else try{In(u,o,"req"+c+"_")}catch(t){s&&s(u)}}if(a){s=o.join("&");break t}}return t=t.g.splice(0,n),e.s=t,s}function Hn(t){t.a||t.j||(t.U=1,Ht(t.Aa,t),t.o=0)}function Wn(t){return!(t.a||t.j||3<=t.o)&&(t.U++,t.j=pe(C(t.Aa,t),Zn(t,t.o)),t.o++,!0)}function Xn(t){null!=t.s&&(I.clearTimeout(t.s),t.s=null)}function Jn(t){t.a=new Ne(t,t.c,"rpc",t.U),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=ze(t.la);Je(e,"RID","rpc"),Je(e,"SID",t.J),Je(e,"CI",t.H?"0":"1"),Je(e,"AID",t.P),zn(t,e),Je(e,"TYPE","xmlhttp"),t.i&&t.l&&Vn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ga,n.H=1,n.i=Qe(ze(e)),n.j=null,n.I=!0,De(n,t)}function Qn(t){null!=t.m&&(I.clearTimeout(t.m),t.m=null)}function Yn(t,e){var n=null;if(t.a==e){Qn(t),Xn(t),t.a=null;var s=2}else{if(!yn(t.b,e))return;n=e.s,vn(t.b,e),s=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==s){n=e.j?e.j.length:0,e=L()-e.u;var i=t.u;(s=he()).dispatchEvent(new de(s,n,e,i)),$n(t)}else Hn(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==s&&function(t,e){return!(mn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.Ia?0:t.Ja)||(t.h=pe(C(t.Ba,t,e),Zn(t,t.u)),t.u++,0)))}(t,e)||2==s&&Wn(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:ts(t,5);break;case 4:ts(t,10);break;case 3:ts(t,6);break;default:ts(t,2)}}function Zn(t,e){var n=t.Fa+Math.floor(Math.random()*t.Ma);return t.f||(n*=2),n*e}function ts(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var s=C(t.Xa,t);n||(n=new Be("//www.google.com/images/cleardot.gif"),I.location&&"http"==I.location.protocol||Ke(n,"https"),Qe(n)),function(t,e){var n=new re;if(I.Image){var s=new Image;s.onload=R(_n,n,s,"TestLoadImage: loaded",!0,e),s.onerror=R(_n,n,s,"TestLoadImage: error",!1,e),s.onabort=R(_n,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=R(_n,n,s,"TestLoadImage: timeout",!1,e),I.setTimeout(function(){s.ontimeout&&s.ontimeout()},1e4),s.src=t}else e(!1)}(n.toString(),s)}else fe(2);t.v=0,t.f&&t.f.ra(e),es(t),Gn(t)}function es(t){t.v=0,t.I=-1,t.f&&(0==bn(t.b).length&&0==t.g.length||(t.b.c.length=0,q(t.g),t.g.length=0),t.f.qa())}function ns(t,e,n){var s=function(t){return t instanceof Be?ze(t):new Be(t,void 0)}(n);if(""!=s.c)e&&He(s,e+"."+s.c),We(s,s.h);else{var i=I.location;s=function(t,e,n,s){var i=new Be(null,void 0);return t&&Ke(i,t),e&&He(i,e),n&&We(i,n),s&&(i.g=s),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.W&&H(t.W,function(t,e){Je(s,e,t)}),e=t.A,n=t.na,e&&n&&Je(s,e,n),Je(s,"VER",t.ha),zn(t,s),s}function ss(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Nn(t.Ka)).F=t.C,e}function is(){}function rs(){if(et&&!(10<=Number(pt)))throw Error("Environmental error: no available transport.")}function os(t,e){Mt.call(this),this.a=new Mn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!F(t)&&(this.a.i=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!F(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new cs(this)}function as(t){Ie.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function hs(){_e.call(this),this.status=1}function cs(t){this.a=t}(v=Nn.prototype).ba=function(t,e,n,s){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.B+"; newUri="+t);e=e?e.toUpperCase():"GET",this.B=t,this.f="",this.h=0,this.u=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?we(this.H):we(be),this.a.onreadystatechange=C(this.za,this);try{this.A=!0,this.a.open(e,String(t),!0),this.A=!1}catch(t){return void Dn(this,t)}t=n||"";var i=new Fe(this.headers);s&&qe(s,function(t,e){i.set(e,t)}),s=function(t){t:{for(var e=kn,n=t.length,s="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in s&&e.call(void 0,s[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=I.FormData&&t instanceof I.FormData,!(0<=V(Sn,e))||s||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{On(this),0<this.o&&((this.D=function(t){return et&&ft(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=C(this.xa,this)):this.m=Zt(this.xa,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){Dn(this,t)}},v.xa=function(){void 0!==E&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},v.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Ln(this))},v.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Ln(this,!0)),Nn.S.G.call(this)},v.za=function(){this.j||(this.A||this.l||this.g?Rn(this):this.Ta())},v.Ta=function(){Rn(this)},v.X=function(){try{return 2<Pn(this)?this.a.status:-1}catch(t){return-1}},v.$=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},v.Na=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Tn(e)}},v.ua=function(){return this.h},v.Qa=function(){return"string"==typeof this.f?this.f:String(this.f)},(v=Mn.prototype).ha=8,v.v=1,v.Ba=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Ne(this,this.c,t,void 0),s=this.l;if(this.O&&(s?J(s=W(s),this.O):s=this.O),null===this.i&&(n.B=s),this.da)t:{for(var i=e=0;i<this.g.length;i++){var r=this.g[i];if(void 0===(r="__data__"in r.a&&"string"==typeof(r=r.a.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Kn(this,n,e),Je(i=ze(this.B),"RID",t),Je(i,"CVER",22),this.A&&Je(i,"X-HTTP-Session-Id",this.A),zn(this,i),this.i&&s&&Vn(i,this.i,s),wn(this.b,n),this.Ga&&Je(i,"TYPE","init"),this.da?(Je(i,"$req",e),Je(i,"SID","null"),n.V=!0,ke(n,i,null)):ke(n,i,e),this.v=2}}else 3==this.v&&(t?Bn(this,t):0==this.g.length||gn(this.b)||Bn(this))},v.Aa=function(){if(this.j=null,Jn(this),this.V&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=pe(C(this.Sa,this),t)}},v.Sa=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.H=!1,this.F=!0,Fn(this),Jn(this))},v.Ra=function(){null!=this.m&&(this.m=null,Fn(this),Wn(this),fe(19))},v.Xa=function(t){t?(this.c.info("Successfully pinged google.com"),fe(2)):(this.c.info("Failed to ping google.com"),fe(1))},(v=is.prototype).ta=function(){},v.sa=function(){},v.ra=function(){},v.qa=function(){},v.Ha=function(){},rs.prototype.a=function(t,e){return new os(t,e)},O(os,Mt),(v=os.prototype).addEventListener=function(t,e,n,s){os.S.addEventListener.call(this,t,e,n,s)},v.removeEventListener=function(t,e,n,s){os.S.removeEventListener.call(this,t,e,n,s)},v.Oa=function(){this.a.f=this.f,this.h&&(this.a.C=!0);var t=this.a,e=this.l,n=this.b||void 0;fe(0),t.fa=e,t.W=n||{},t.H=t.T,t.B=ns(t,null,t.fa),$n(t)},v.close=function(){qn(this.a)},v.Pa=function(t){if("string"==typeof t){var e={};e.__data__=t,jn(this.a,e)}else this.g?((e={}).__data__=Ft(t),jn(this.a,e)):jn(this.a,t)},v.G=function(){this.a.f=null,delete this.f,qn(this.a),delete this.a,os.S.G.call(this)},O(as,Ie),O(hs,_e),O(cs,is),cs.prototype.ta=function(){this.a.dispatchEvent("a")},cs.prototype.sa=function(t){this.a.dispatchEvent(new as(t))},cs.prototype.ra=function(t){this.a.dispatchEvent(new hs(t))},cs.prototype.qa=function(){this.a.dispatchEvent("b")},rs.prototype.createWebChannel=rs.prototype.a,os.prototype.send=os.prototype.Pa,os.prototype.open=os.prototype.Oa,os.prototype.close=os.prototype.close,ge.NO_ERROR=0,ge.TIMEOUT=8,ge.HTTP_ERROR=6,me.COMPLETE="complete",ve.EventType=Ee,Ee.OPEN="a",Ee.CLOSE="b",Ee.ERROR="c",Ee.MESSAGE="d",Mt.prototype.listen=Mt.prototype.va,Nn.prototype.listenOnce=Nn.prototype.wa,Nn.prototype.getLastError=Nn.prototype.Qa,Nn.prototype.getLastErrorCode=Nn.prototype.ua,Nn.prototype.getStatus=Nn.prototype.X,Nn.prototype.getResponseJson=Nn.prototype.Na,Nn.prototype.getResponseText=Nn.prototype.$,Nn.prototype.send=Nn.prototype.ba;var us={createWebChannelTransport:function(){return new rs},ErrorCode:ge,EventType:me,WebChannel:ve,XhrIo:Nn},ls=us.createWebChannelTransport,fs=us.ErrorCode,ds=us.EventType,ps=us.WebChannel,gs=us.XhrIo;class ms{constructor(t){this.uid=t}t(){return null!=this.uid}s(){return this.t()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}ms.UNAUTHENTICATED=new ms(null),ms.i=new ms("google-credentials-uid"),ms.o=new ms("first-party-uid");const ys=new m("@firebase/firestore");function ws(){return ys.logLevel}function vs(t,...e){if(ys.logLevel<=h.DEBUG){const n=e.map(Is);ys.debug("Firestore (7.19.1): "+t,...n)}}function bs(t,...e){if(ys.logLevel<=h.ERROR){const n=e.map(Is);ys.error("Firestore (7.19.1): "+t,...n)}}function Es(t,...e){if(ys.logLevel<=h.WARN){const n=e.map(Is);ys.warn("Firestore (7.19.1): "+t,...n)}}function Is(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function _s(t="Unexpected state"){const e="FIRESTORE (7.19.1) INTERNAL ASSERTION FAILED: "+t;throw bs(e),new Error(e)}function Ts(t,e){t||_s()}function Ns(t,e){return t}const As={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class xs extends Error{constructor(t,e){super(e),this.code=t,this.message=e,this.name="FirebaseError",this.toString=(()=>`${this.name}: [code=${this.code}]: ${this.message}`)}}class Ss{constructor(t,e){this.user=e,this.type="OAuth",this.u={},this.u.Authorization="Bearer "+t}}class ks{constructor(t){this.h=null,this.currentUser=ms.UNAUTHENTICATED,this.l=!1,this._=0,this.T=null,this.forceRefresh=!1,this.h=(()=>{this._++,this.currentUser=this.I(),this.l=!0,this.T&&this.T(this.currentUser)}),this._=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.h):(this.h(null),t.get().then(t=>{this.auth=t,this.h&&this.auth.addAuthTokenListener(this.h)},()=>{}))}getToken(){const t=this._,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this._!==t?(vs("FirebaseCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Ts("string"==typeof e.accessToken),new Ss(e.accessToken,this.currentUser)):null):Promise.resolve(null)}m(){this.forceRefresh=!0}A(t){this.T=t,this.l&&t(this.currentUser)}R(){this.auth&&this.auth.removeAuthTokenListener(this.h),this.h=null,this.T=null}I(){const t=this.auth&&this.auth.getUid();return Ts(null===t||"string"==typeof t),new ms(t)}}function Ds(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class Cs{static P(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=Ds(40);for(let i=0;i<s.length;++i)n.length<20&&s[i]<e&&(n+=t.charAt(s[i]%t.length))}return n}}function Rs(t,e){return t<e?-1:t>e?1:0}function Ls(t,e,n){return t.length===e.length&&t.every((t,s)=>n(t,e[s]))}function Os(t){return t+"\0"}class Ps{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new xs(As.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new xs(As.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new xs(As.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new xs(As.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Ps.fromMillis(Date.now())}static fromDate(t){return Ps.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3);return new Ps(e,1e6*(t-1e3*e))}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}V(t){return this.seconds===t.seconds?Rs(this.nanoseconds,t.nanoseconds):Rs(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Vs{constructor(t){this.timestamp=t}static g(t){return new Vs(t)}static min(){return new Vs(new Ps(0,0))}p(t){return this.timestamp.V(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}v(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}S(){return this.timestamp}}class Us{constructor(t,e,n){void 0===e?e=0:e>t.length&&_s(),void 0===n?n=t.length-e:n>t.length-e&&_s(),this.segments=t,this.offset=e,this.D=n}get length(){return this.D}isEqual(t){return 0===Us.C(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Us?t.forEach(t=>{e.push(t)}):e.push(t),this.N(e)}limit(){return this.offset+this.length}O(t){return t=void 0===t?1:t,this.N(this.segments,this.offset+t,this.length-t)}k(){return this.N(this.segments,this.offset,this.length-1)}F(){return this.segments[this.offset]}M(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}$(){return 0===this.length}L(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}q(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}B(){return this.segments.slice(this.offset,this.limit())}static C(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),i=e.get(s);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class Ms extends Us{N(t,e,n){return new Ms(t,e,n)}U(){return this.B().join("/")}toString(){return this.U()}static W(t){if(t.indexOf("//")>=0)throw new xs(As.INVALID_ARGUMENT,`Invalid path (${t}). Paths must not contain // in them.`);const e=t.split("/").filter(t=>t.length>0);return new Ms(e)}static K(){return new Ms([])}}const qs=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Fs extends Us{N(t,e,n){return new Fs(t,e,n)}static j(t){return qs.test(t)}U(){return this.B().map(t=>(t=t.replace("\\","\\\\").replace("`","\\`"),Fs.j(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.U()}G(){return 1===this.length&&"__name__"===this.get(0)}static H(){return new Fs(["__name__"])}static J(t){const e=[];let n="",s=0;const i=()=>{if(0===n.length)throw new xs(As.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let r=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new xs(As.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new xs(As.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(r=!r,s++):"."!==e||r?(n+=e,s++):(i(),s++)}if(i(),r)throw new xs(As.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Fs(e)}static K(){return new Fs([])}}class Gs{constructor(t){this.path=t}static Y(t){return new Gs(Ms.W(t))}static X(t){return new Gs(Ms.W(t).O(5))}Z(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}isEqual(t){return null!==t&&0===Ms.C(this.path,t.path)}toString(){return this.path.toString()}static C(t,e){return Ms.C(t.path,e.path)}static tt(t){return t.length%2==0}static et(t){return new Gs(new Ms(t.slice()))}}class js{constructor(t,e,n,s,i){this.nt=t,this.persistenceKey=e,this.host=n,this.ssl=s,this.forceLongPolling=i}}class $s{constructor(t,e){this.projectId=t,this.database=e||"(default)"}get st(){return"(default)"===this.database}isEqual(t){return t instanceof $s&&t.projectId===this.projectId&&t.database===this.database}p(t){return Rs(this.projectId,t.projectId)||Rs(this.database,t.database)}}function Bs(t){return null==t}function zs(t){return-0===t&&1/t==-1/0}function Ks(t){return"number"==typeof t&&Number.isInteger(t)&&!zs(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class Hs{constructor(t,e=null,n=[],s=[],i=null,r=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=i,this.startAt=r,this.endAt=o,this.it=null}}function Ws(t,e=null,n=[],s=[],i=null,r=null,o=null){return new Hs(t,e,n,s,i,r,o)}function Xs(t){const e=Ns(t);if(null===e.it){let t=e.path.U();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>(function(t){return t.field.U()+t.op.toString()+$i(t.value)})(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>(function(t){return t.field.U()+t.dir})(t)).join(","),Bs(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=Mo(e.startAt)),e.endAt&&(t+="|ub:",t+=Mo(e.endAt)),e.it=t}return e.it}function Js(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!$o(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let i=0;i<t.filters.length;i++)if(n=t.filters[i],s=e.filters[i],n.op!==s.op||!n.field.isEqual(s.field)||!qi(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Fo(t.startAt,e.startAt)&&Fo(t.endAt,e.endAt)}function Qs(t){return Gs.tt(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Ys{constructor(t){this.rt=t}static fromBase64String(t){const e=atob(t);return new Ys(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Ys(e)}toBase64(){return t=this.rt,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.rt)}ot(){return 2*this.rt.length}p(t){return Rs(this.rt,t.rt)}isEqual(t){return this.rt===t.rt}}Ys.at=new Ys("");class Zs{constructor(t,e,n,s,i=Vs.min(),r=Vs.min(),o=Ys.at){this.target=t,this.targetId=e,this.ct=n,this.sequenceNumber=s,this.ut=i,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o}ht(t){return new Zs(this.target,this.targetId,this.ct,t,this.ut,this.lastLimboFreeSnapshotVersion,this.resumeToken)}lt(t,e){return new Zs(this.target,this.targetId,this.ct,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}_t(t){return new Zs(this.target,this.targetId,this.ct,this.sequenceNumber,this.ut,t,this.resumeToken)}}class ti{constructor(t){this.count=t}}var ei,ni;function si(t){switch(t){case As.OK:return _s();case As.CANCELLED:case As.UNKNOWN:case As.DEADLINE_EXCEEDED:case As.RESOURCE_EXHAUSTED:case As.INTERNAL:case As.UNAVAILABLE:case As.UNAUTHENTICATED:return!1;case As.INVALID_ARGUMENT:case As.NOT_FOUND:case As.ALREADY_EXISTS:case As.PERMISSION_DENIED:case As.FAILED_PRECONDITION:case As.ABORTED:case As.OUT_OF_RANGE:case As.UNIMPLEMENTED:case As.DATA_LOSS:return!0;default:return _s()}}function ii(t){if(void 0===t)return bs("GRPC error has no .code"),As.UNKNOWN;switch(t){case ei.OK:return As.OK;case ei.CANCELLED:return As.CANCELLED;case ei.UNKNOWN:return As.UNKNOWN;case ei.DEADLINE_EXCEEDED:return As.DEADLINE_EXCEEDED;case ei.RESOURCE_EXHAUSTED:return As.RESOURCE_EXHAUSTED;case ei.INTERNAL:return As.INTERNAL;case ei.UNAVAILABLE:return As.UNAVAILABLE;case ei.UNAUTHENTICATED:return As.UNAUTHENTICATED;case ei.INVALID_ARGUMENT:return As.INVALID_ARGUMENT;case ei.NOT_FOUND:return As.NOT_FOUND;case ei.ALREADY_EXISTS:return As.ALREADY_EXISTS;case ei.PERMISSION_DENIED:return As.PERMISSION_DENIED;case ei.FAILED_PRECONDITION:return As.FAILED_PRECONDITION;case ei.ABORTED:return As.ABORTED;case ei.OUT_OF_RANGE:return As.OUT_OF_RANGE;case ei.UNIMPLEMENTED:return As.UNIMPLEMENTED;case ei.DATA_LOSS:return As.DATA_LOSS;default:return _s()}}(ni=ei||(ei={}))[ni.OK=0]="OK",ni[ni.CANCELLED=1]="CANCELLED",ni[ni.UNKNOWN=2]="UNKNOWN",ni[ni.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ni[ni.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ni[ni.NOT_FOUND=5]="NOT_FOUND",ni[ni.ALREADY_EXISTS=6]="ALREADY_EXISTS",ni[ni.PERMISSION_DENIED=7]="PERMISSION_DENIED",ni[ni.UNAUTHENTICATED=16]="UNAUTHENTICATED",ni[ni.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ni[ni.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ni[ni.ABORTED=10]="ABORTED",ni[ni.OUT_OF_RANGE=11]="OUT_OF_RANGE",ni[ni.UNIMPLEMENTED=12]="UNIMPLEMENTED",ni[ni.INTERNAL=13]="INTERNAL",ni[ni.UNAVAILABLE=14]="UNAVAILABLE",ni[ni.DATA_LOSS=15]="DATA_LOSS";class ri{constructor(t,e){this.C=t,this.root=e||ai.EMPTY}ft(t,e){return new ri(this.C,this.root.ft(t,e,this.C).copy(null,null,ai.dt,null,null))}remove(t){return new ri(this.C,this.root.remove(t,this.C).copy(null,null,ai.dt,null,null))}get(t){let e=this.root;for(;!e.$();){const n=this.C(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.$();){const s=this.C(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}$(){return this.root.$()}get size(){return this.root.size}wt(){return this.root.wt()}Et(){return this.root.Et()}Tt(t){return this.root.Tt(t)}forEach(t){this.Tt((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.Tt((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}It(t){return this.root.It(t)}At(){return new oi(this.root,null,this.C,!1)}Rt(t){return new oi(this.root,t,this.C,!1)}Pt(){return new oi(this.root,null,this.C,!0)}Vt(t){return new oi(this.root,t,this.C,!0)}}class oi{constructor(t,e,n,s){this.gt=s,this.yt=[];let i=1;for(;!t.$();)if(i=e?n(t.key,e):1,s&&(i*=-1),i<0)t=this.gt?t.left:t.right;else{if(0===i){this.yt.push(t);break}this.yt.push(t),t=this.gt?t.right:t.left}}pt(){let t=this.yt.pop();const e={key:t.key,value:t.value};if(this.gt)for(t=t.left;!t.$();)this.yt.push(t),t=t.right;else for(t=t.right;!t.$();)this.yt.push(t),t=t.left;return e}bt(){return this.yt.length>0}vt(){if(0===this.yt.length)return null;const t=this.yt[this.yt.length-1];return{key:t.key,value:t.value}}}class ai{constructor(t,e,n,s,i){this.key=t,this.value=e,this.color=null!=n?n:ai.RED,this.left=null!=s?s:ai.EMPTY,this.right=null!=i?i:ai.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,i){return new ai(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=i?i:this.right)}$(){return!1}Tt(t){return this.left.Tt(t)||t(this.key,this.value)||this.right.Tt(t)}It(t){return this.right.It(t)||t(this.key,this.value)||this.left.It(t)}min(){return this.left.$()?this:this.left.min()}wt(){return this.min().key}Et(){return this.right.$()?this.key:this.right.Et()}ft(t,e,n){let s=this;const i=n(t,s.key);return(s=i<0?s.copy(null,null,null,s.left.ft(t,e,n),null):0===i?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.ft(t,e,n))).St()}Dt(){if(this.left.$())return ai.EMPTY;let t=this;return t.left.Ct()||t.left.left.Ct()||(t=t.Nt()),(t=t.copy(null,null,null,t.left.Dt(),null)).St()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.$()||s.left.Ct()||s.left.left.Ct()||(s=s.Nt()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.Ct()&&(s=s.xt()),s.right.$()||s.right.Ct()||s.right.left.Ct()||(s=s.Ot()),0===e(t,s.key)){if(s.right.$())return ai.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.Dt())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.St()}Ct(){return this.color}St(){let t=this;return t.right.Ct()&&!t.left.Ct()&&(t=t.kt()),t.left.Ct()&&t.left.left.Ct()&&(t=t.xt()),t.left.Ct()&&t.right.Ct()&&(t=t.Ft()),t}Nt(){let t=this.Ft();return t.right.left.Ct()&&(t=(t=(t=t.copy(null,null,null,null,t.right.xt())).kt()).Ft()),t}Ot(){let t=this.Ft();return t.left.left.Ct()&&(t=(t=t.xt()).Ft()),t}kt(){const t=this.copy(null,null,ai.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}xt(){const t=this.copy(null,null,ai.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}Ft(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}Mt(){const t=this.$t();return Math.pow(2,t)<=this.size+1}$t(){if(this.Ct()&&this.left.Ct())throw _s();if(this.right.Ct())throw _s();const t=this.left.$t();if(t!==this.right.$t())throw _s();return t+(this.Ct()?0:1)}}ai.EMPTY=null,ai.RED=!0,ai.dt=!1,ai.EMPTY=new class{constructor(){this.size=0}get key(){throw _s()}get value(){throw _s()}get color(){throw _s()}get left(){throw _s()}get right(){throw _s()}copy(t,e,n,s,i){return this}ft(t,e,n){return new ai(t,e)}remove(t,e){return this}$(){return!0}Tt(t){return!1}It(t){return!1}wt(){return null}Et(){return null}Ct(){return!1}Mt(){return!0}$t(){return 0}};class hi{constructor(t){this.C=t,this.data=new ri(this.C)}has(t){return null!==this.data.get(t)}first(){return this.data.wt()}last(){return this.data.Et()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.Tt((e,n)=>(t(e),!1))}Lt(t,e){const n=this.data.Rt(t[0]);for(;n.bt();){const s=n.pt();if(this.C(s.key,t[1])>=0)return;e(s.key)}}qt(t,e){let n;for(n=void 0!==e?this.data.Rt(e):this.data.At();n.bt();)if(!t(n.pt().key))return}Bt(t){const e=this.data.Rt(t);return e.bt()?e.pt().key:null}At(){return new ci(this.data.At())}Rt(t){return new ci(this.data.Rt(t))}add(t){return this.copy(this.data.remove(t).ft(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}$(){return this.data.$()}Ut(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof hi))return!1;if(this.size!==t.size)return!1;const e=this.data.At(),n=t.data.At();for(;e.bt();){const t=e.pt().key,s=n.pt().key;if(0!==this.C(t,s))return!1}return!0}B(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new hi(this.C);return e.data=t,e}}class ci{constructor(t){this.Wt=t}pt(){return this.Wt.pt().key}bt(){return this.Wt.bt()}}const ui=new ri(Gs.C);function li(){return ui}function fi(){return li()}const di=new ri(Gs.C);function pi(){return di}const gi=new ri(Gs.C),mi=new hi(Gs.C);function yi(...t){let e=mi;for(const n of t)e=e.add(n);return e}const wi=new hi(Rs);function vi(){return wi}class bi{constructor(t){this.C=t?(e,n)=>t(e,n)||Gs.C(e.key,n.key):(t,e)=>Gs.C(t.key,e.key),this.Kt=pi(),this.Qt=new ri(this.C)}static jt(t){return new bi(t.C)}has(t){return null!=this.Kt.get(t)}get(t){return this.Kt.get(t)}first(){return this.Qt.wt()}last(){return this.Qt.Et()}$(){return this.Qt.$()}indexOf(t){const e=this.Kt.get(t);return e?this.Qt.indexOf(e):-1}get size(){return this.Qt.size}forEach(t){this.Qt.Tt((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.Kt.ft(t.key,t),e.Qt.ft(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.Kt.remove(t),this.Qt.remove(e)):this}isEqual(t){if(!(t instanceof bi))return!1;if(this.size!==t.size)return!1;const e=this.Qt.At(),n=t.Qt.At();for(;e.bt();){const t=e.pt().key,s=n.pt().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new bi;return n.C=this.C,n.Kt=t,n.Qt=e,n}}class Ei{constructor(){this.Gt=new ri(Gs.C)}track(t){const e=t.doc.key,n=this.Gt.get(e);n?0!==t.type&&3===n.type?this.Gt=this.Gt.ft(e,t):3===t.type&&1!==n.type?this.Gt=this.Gt.ft(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Gt=this.Gt.ft(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Gt=this.Gt.ft(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Gt=this.Gt.remove(e):1===t.type&&2===n.type?this.Gt=this.Gt.ft(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Gt=this.Gt.ft(e,{type:2,doc:t.doc}):_s():this.Gt=this.Gt.ft(e,t)}zt(){const t=[];return this.Gt.Tt((e,n)=>{t.push(n)}),t}}class Ii{constructor(t,e,n,s,i,r,o,a){this.query=t,this.docs=e,this.Ht=n,this.docChanges=s,this.Jt=i,this.fromCache=r,this.Yt=o,this.Xt=a}static Zt(t,e,n,s){const i=[];return e.forEach(t=>{i.push({type:0,doc:t})}),new Ii(t,e,bi.jt(e),i,n,s,!0,!1)}get hasPendingWrites(){return!this.Jt.$()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.Yt===t.Yt&&this.Jt.isEqual(t.Jt)&&_o(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.Ht.isEqual(t.Ht)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class _i{constructor(t,e,n,s,i){this.ut=t,this.te=e,this.ee=n,this.ne=s,this.se=i}static ie(t,e){const n=new Map;return n.set(t,Ti.re(t,e)),new _i(Vs.min(),n,vi(),li(),yi())}}class Ti{constructor(t,e,n,s,i){this.resumeToken=t,this.oe=e,this.ae=n,this.ce=s,this.ue=i}static re(t,e){return new Ti(Ys.at,e,yi(),yi(),yi())}}class Ni{constructor(t,e,n,s){this.he=t,this.removedTargetIds=e,this.key=n,this.le=s}}class Ai{constructor(t,e){this.targetId=t,this._e=e}}class xi{constructor(t,e,n=Ys.at,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class Si{constructor(){this.fe=0,this.de=Ci(),this.we=Ys.at,this.Ee=!1,this.Te=!0}get oe(){return this.Ee}get resumeToken(){return this.we}get Ie(){return 0!==this.fe}get me(){return this.Te}Ae(t){t.ot()>0&&(this.Te=!0,this.we=t)}Re(){let t=yi(),e=yi(),n=yi();return this.de.forEach((s,i)=>{switch(i){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:_s()}}),new Ti(this.we,this.Ee,t,e,n)}Pe(){this.Te=!1,this.de=Ci()}Ve(t,e){this.Te=!0,this.de=this.de.ft(t,e)}ge(t){this.Te=!0,this.de=this.de.remove(t)}ye(){this.fe+=1}pe(){this.fe-=1}be(){this.Te=!0,this.Ee=!0}}class ki{constructor(t){this.ve=t,this.Se=new Map,this.De=li(),this.Ce=Di(),this.Ne=new hi(Rs)}xe(t){for(const e of t.he)t.le instanceof ho?this.Oe(e,t.le):t.le instanceof co&&this.ke(e,t.key,t.le);for(const e of t.removedTargetIds)this.ke(e,t.key,t.le)}Fe(t){this.Me(t,e=>{const n=this.$e(e);switch(t.state){case 0:this.Le(e)&&n.Ae(t.resumeToken);break;case 1:n.pe(),n.Ie||n.Pe(),n.Ae(t.resumeToken);break;case 2:n.pe(),n.Ie||this.removeTarget(e);break;case 3:this.Le(e)&&(n.be(),n.Ae(t.resumeToken));break;case 4:this.Le(e)&&(this.qe(e),n.Ae(t.resumeToken));break;default:_s()}})}Me(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.Se.forEach((t,n)=>{this.Le(n)&&e(n)})}Be(t){const e=t.targetId,n=t._e.count,s=this.Ue(e);if(s){const t=s.target;if(Qs(t))if(0===n){const n=new Gs(t.path);this.ke(e,n,new co(n,Vs.min()))}else Ts(1===n);else this.We(e)!==n&&(this.qe(e),this.Ne=this.Ne.add(e))}}Ke(t){const e=new Map;this.Se.forEach((n,s)=>{const i=this.Ue(s);if(i){if(n.oe&&Qs(i.target)){const e=new Gs(i.target.path);null!==this.De.get(e)||this.Qe(s,e)||this.ke(s,e,new co(e,t))}n.me&&(e.set(s,n.Re()),n.Pe())}});let n=yi();this.Ce.forEach((t,e)=>{let s=!0;e.qt(t=>{const e=this.Ue(t);return!e||2===e.ct||(s=!1,!1)}),s&&(n=n.add(t))});const s=new _i(t,e,this.Ne,this.De,n);return this.De=li(),this.Ce=Di(),this.Ne=new hi(Rs),s}Oe(t,e){if(!this.Le(t))return;const n=this.Qe(t,e.key)?2:0;this.$e(t).Ve(e.key,n),this.De=this.De.ft(e.key,e),this.Ce=this.Ce.ft(e.key,this.je(e.key).add(t))}ke(t,e,n){if(!this.Le(t))return;const s=this.$e(t);this.Qe(t,e)?s.Ve(e,1):s.ge(e),this.Ce=this.Ce.ft(e,this.je(e).delete(t)),n&&(this.De=this.De.ft(e,n))}removeTarget(t){this.Se.delete(t)}We(t){const e=this.$e(t).Re();return this.ve.Ge(t).size+e.ae.size-e.ue.size}ye(t){this.$e(t).ye()}$e(t){let e=this.Se.get(t);return e||(e=new Si,this.Se.set(t,e)),e}je(t){let e=this.Ce.get(t);return e||(e=new hi(Rs),this.Ce=this.Ce.ft(t,e)),e}Le(t){const e=null!==this.Ue(t);return e||vs("WatchChangeAggregator","Detected inactive target",t),e}Ue(t){const e=this.Se.get(t);return e&&e.Ie?null:this.ve.ze(t)}qe(t){this.Se.set(t,new Si),this.ve.Ge(t).forEach(e=>{this.ke(t,e,null)})}Qe(t,e){return this.ve.Ge(t).has(e)}}function Di(){return new ri(Gs.C)}function Ci(){return new ri(Gs.C)}function Ri(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Li(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Oi(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Pi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Vi(t){const e=Bi(t.mapValue.fields.__local_write_time__.timestampValue);return new Ps(e.seconds,e.nanos)}const Ui=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Mi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Pi(t)?4:10:_s()}function qi(t,e){const n=Mi(t);if(n!==Mi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Vi(t).isEqual(Vi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Bi(t.timestampValue),s=Bi(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ki(t.bytesValue).isEqual(Ki(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return zi(t.geoPointValue.latitude)===zi(e.geoPointValue.latitude)&&zi(t.geoPointValue.longitude)===zi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return zi(t.integerValue)===zi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=zi(t.doubleValue),s=zi(e.doubleValue);return n===s?zs(n)===zs(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return Ls(t.arrayValue.values||[],e.arrayValue.values||[],qi);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(Ri(n)!==Ri(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!qi(n[t],s[t])))return!1;return!0}(t,e);default:return _s()}}function Fi(t,e){return void 0!==(t.values||[]).find(t=>qi(t,e))}function Gi(t,e){const n=Mi(t),s=Mi(e);if(n!==s)return Rs(n,s);switch(n){case 0:return 0;case 1:return Rs(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=zi(t.integerValue||t.doubleValue),s=zi(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return ji(t.timestampValue,e.timestampValue);case 4:return ji(Vi(t),Vi(e));case 5:return Rs(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Ki(t),s=Ki(e);return n.p(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=Rs(n[t],s[t]);if(0!==e)return e}return Rs(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Rs(zi(t.latitude),zi(e.latitude));return 0!==n?n:Rs(zi(t.longitude),zi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=Gi(n[t],s[t]);if(e)return e}return Rs(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=Object.keys(n),i=e.fields||{},r=Object.keys(i);s.sort(),r.sort();for(let t=0;t<s.length&&t<r.length;++t){const e=Rs(s[t],r[t]);if(0!==e)return e;const o=Gi(n[s[t]],i[r[t]]);if(0!==o)return o}return Rs(s.length,r.length)}(t.mapValue,e.mapValue);default:throw _s()}}function ji(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Rs(t,e);const n=Bi(t),s=Bi(e),i=Rs(n.seconds,s.seconds);return 0!==i?i:Rs(n.nanos,s.nanos)}function $i(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(t){const e=Bi(t);return`time(${e.seconds},${e.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Ki(e.bytesValue).toBase64():"referenceValue"in e?(s=e.referenceValue,Gs.X(s).toString()):"geoPointValue"in e?`geo(${(n=e.geoPointValue).latitude},${n.longitude})`:"arrayValue"in e?function(e){let n="[",s=!0;for(const i of e.values||[])s?s=!1:n+=",",n+=t(i);return n+"]"}(e.arrayValue):"mapValue"in e?function(e){const n=Object.keys(e.fields||{}).sort();let s="{",i=!0;for(const r of n)i?i=!1:s+=",",s+=`${r}:${t(e.fields[r])}`;return s+"}"}(e.mapValue):_s();var n,s}(t)}function Bi(t){if(Ts(!!t),"string"==typeof t){let e=0;const n=Ui.exec(t);if(Ts(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:zi(t.seconds),nanos:zi(t.nanos)}}function zi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ki(t){return"string"==typeof t?Ys.fromBase64String(t):Ys.fromUint8Array(t)}function Hi(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.U()}`}}function Wi(t){return!!t&&"integerValue"in t}function Xi(t){return!!t&&"arrayValue"in t}function Ji(t){return!!t&&"nullValue"in t}function Qi(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Yi(t){return!!t&&"mapValue"in t}const Zi={asc:"ASCENDING",desc:"DESCENDING"},tr={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class er{constructor(t,e){this.nt=t,this.He=e}}function nr(t){return{integerValue:""+t}}function sr(t,e){if(t.He){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zs(e)?"-0":e}}function ir(t,e){return Ks(e)?nr(e):sr(t,e)}function rr(t,e){return t.He?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function or(t,e){return t.He?e.toBase64():e.toUint8Array()}function ar(t){return Ts(!!t),Vs.g(function(t){const e=Bi(t);return new Ps(e.seconds,e.nanos)}(t))}function hr(t,e){return function(t){return new Ms(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).U()}function cr(t){const e=Ms.W(t);return Ts(Ar(e)),e}function ur(t,e){return hr(t.nt,e.path)}function lr(t,e){const n=cr(e);return Ts(n.get(1)===t.nt.projectId),Ts(!n.get(3)&&!t.nt.database||n.get(3)===t.nt.database),new Gs(gr(n))}function fr(t,e){return hr(t.nt,e)}function dr(t){const e=cr(t);return 4===e.length?Ms.K():gr(e)}function pr(t){return new Ms(["projects",t.nt.projectId,"databases",t.nt.database]).U()}function gr(t){return Ts(t.length>4&&"documents"===t.get(4)),t.O(5)}function mr(t,e,n){return{name:ur(t,e),fields:n.proto.mapValue.fields}}function yr(t,e){let n;if(e instanceof Jr)n={update:mr(t,e.key,e.value)};else if(e instanceof no)n={delete:ur(t,e.key)};else if(e instanceof Qr)n={update:mr(t,e.key,e.data),updateMask:function(t){const e=[];return t.fields.forEach(t=>e.push(t.U())),{fieldPaths:e}}(e.Je)};else if(e instanceof Zr)n={transform:{document:ur(t,e.key),fieldTransforms:e.fieldTransforms.map(t=>(function(t,e){const n=e.transform;if(n instanceof Cr)return{fieldPath:e.field.U(),setToServerValue:"REQUEST_TIME"};if(n instanceof Rr)return{fieldPath:e.field.U(),appendMissingElements:{values:n.elements}};if(n instanceof Or)return{fieldPath:e.field.U(),removeAllFromArray:{values:n.elements}};if(n instanceof Vr)return{fieldPath:e.field.U(),increment:n.Ye};throw _s()})(0,t))}};else{if(!(e instanceof so))return _s();n={verify:ur(t,e.key)}}return e.Ze.Xe||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:function(t,e){return rr(t,e.S())}(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:_s()}(t,e.Ze)),n}function wr(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?jr.updateTime(ar(t.updateTime)):void 0!==t.exists?jr.exists(t.exists):jr.tn()}(e.currentDocument):jr.tn();if(e.update){e.update.name;const s=lr(t,e.update.name),i=new io({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new qr(e.map(t=>Fs.J(t)))}(e.updateMask);return new Qr(s,i,t,n)}return new Jr(s,i,n)}if(e.delete){const s=lr(t,e.delete);return new no(s,n)}if(e.transform){const s=lr(t,e.transform.document),i=e.transform.fieldTransforms.map(e=>(function(t,e){let n=null;if("setToServerValue"in e)Ts("REQUEST_TIME"===e.setToServerValue),n=new Cr;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Rr(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Or(t)}else"increment"in e?n=new Vr(t,e.increment):_s();const s=Fs.J(e.fieldPath);return new Fr(s,n)})(t,e));return Ts(!0===n.exists),new Zr(s,i)}if(e.verify){const s=lr(t,e.verify);return new so(s,n)}return _s()}function vr(t,e){return{documents:[fr(t,e.path)]}}function br(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=fr(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=fr(t,s.k()),n.structuredQuery.from=[{collectionId:s.M()}]);const i=function(t){if(0===t.length)return;const e=t.map(t=>(function(t){if("=="===t.op){if(Qi(t.value))return{unaryFilter:{field:Tr(t.field),op:"IS_NAN"}};if(Ji(t.value))return{unaryFilter:{field:Tr(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Qi(t.value))return{unaryFilter:{field:Tr(t.field),op:"IS_NOT_NAN"}};if(Ji(t.value))return{unaryFilter:{field:Tr(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Tr(t.field),op:function(t){return tr[t]}(t.op),value:t.value}}})(t));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);i&&(n.structuredQuery.where=i);const r=function(t){if(0!==t.length)return t.map(t=>(function(t){return{field:Tr(t.field),direction:function(t){return Zi[t]}(t.dir)}})(t))}(e.orderBy);r&&(n.structuredQuery.orderBy=r);const o=function(t,e){return t.He||Bs(e)?e:{value:e}}(t,e.limit);return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt=Ir(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Ir(e.endAt)),n}function Er(t){let e=dr(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let i=null;if(s>0){Ts(1===s);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let r=[];n.where&&(r=function t(e){return e?void 0!==e.unaryFilter?[function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Nr(t.unaryFilter.field);return So.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Nr(t.unaryFilter.field);return So.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=Nr(t.unaryFilter.field);return So.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Nr(t.unaryFilter.field);return So.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return _s()}}(e)]:void 0!==e.fieldFilter?[function(t){return So.create(Nr(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return _s()}}(t.fieldFilter.op),t.fieldFilter.value)}(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map(e=>t(e)).reduce((t,e)=>t.concat(e)):_s():[]}(n.where));let o=[];n.orderBy&&(o=n.orderBy.map(t=>(function(t){return new Go(Nr(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))})(t)));let a=null;n.limit&&(a=function(t){let e;return Bs(e="object"==typeof t?t.value:t)?null:e}(n.limit));let h=null;n.startAt&&(h=_r(n.startAt));let c=null;return n.endAt&&(c=_r(n.endAt)),Io(po(e,i,o,r,a,"F",h,c))}function Ir(t){return{before:t.before,values:t.position}}function _r(t){const e=!!t.before,n=t.values||[];return new Uo(n,e)}function Tr(t){return{fieldPath:t.U()}}function Nr(t){return Fs.J(t.fieldPath)}function Ar(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class xr{constructor(){this.en=void 0}}function Sr(t,e,n){return t instanceof Cr?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Rr?Lr(t,e):t instanceof Or?Pr(t,e):function(t,e){const n=Dr(t,e),s=Ur(n)+Ur(t.Ye);return Wi(n)&&Wi(t.Ye)?nr(s):sr(t.serializer,s)}(t,e)}function kr(t,e,n){return t instanceof Rr?Lr(t,e):t instanceof Or?Pr(t,e):n}function Dr(t,e){return t instanceof Vr?Wi(n=e)||n&&"doubleValue"in n?e:{integerValue:0}:null;var n}class Cr extends xr{}class Rr extends xr{constructor(t){super(),this.elements=t}}function Lr(t,e){const n=Mr(e);for(const e of t.elements)n.some(t=>qi(t,e))||n.push(e);return{arrayValue:{values:n}}}class Or extends xr{constructor(t){super(),this.elements=t}}function Pr(t,e){let n=Mr(e);for(const e of t.elements)n=n.filter(t=>!qi(t,e));return{arrayValue:{values:n}}}class Vr extends xr{constructor(t,e){super(),this.serializer=t,this.Ye=e}}function Ur(t){return zi(t.integerValue||t.doubleValue)}function Mr(t){return Xi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class qr{constructor(t){this.fields=t,t.sort(Fs.C)}nn(t){for(const e of this.fields)if(e.L(t))return!0;return!1}isEqual(t){return Ls(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class Fr{constructor(t,e){this.field=t,this.transform=e}}class Gr{constructor(t,e){this.version=t,this.transformResults=e}}class jr{constructor(t,e){this.updateTime=t,this.exists=e}static tn(){return new jr}static exists(t){return new jr(void 0,t)}static updateTime(t){return new jr(t)}get Xe(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function $r(t,e){return void 0!==t.updateTime?e instanceof ho&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e instanceof ho}class Br{}function zr(t,e,n){return t instanceof Jr?function(t,e,n){return new ho(t.key,n.version,t.value,{hasCommittedMutations:!0})}(t,0,n):t instanceof Qr?function(t,e,n){if(!$r(t.Ze,e))return new uo(t.key,n.version);const s=Yr(t,e);return new ho(t.key,n.version,s,{hasCommittedMutations:!0})}(t,e,n):t instanceof Zr?function(t,e,n){if(Ts(null!=n.transformResults),!$r(t.Ze,e))return new uo(t.key,n.version);const s=to(t,e),i=function(t,e,n){const s=[];Ts(t.length===n.length);for(let i=0;i<n.length;i++){const r=t[i],o=r.transform;let a=null;e instanceof ho&&(a=e.field(r.field)),s.push(kr(o,a,n[i]))}return s}(t.fieldTransforms,e,n.transformResults),r=n.version,o=eo(t,s.data(),i);return new ho(t.key,r,o,{hasCommittedMutations:!0})}(t,e,n):function(t,e,n){return new co(t.key,n.version,{hasCommittedMutations:!0})}(t,0,n)}function Kr(t,e,n,s){return t instanceof Jr?function(t,e){if(!$r(t.Ze,e))return e;const n=Xr(e);return new ho(t.key,n,t.value,{sn:!0})}(t,e):t instanceof Qr?function(t,e){if(!$r(t.Ze,e))return e;const n=Xr(e),s=Yr(t,e);return new ho(t.key,n,s,{sn:!0})}(t,e):t instanceof Zr?function(t,e,n,s){if(!$r(t.Ze,e))return e;const i=to(t,e),r=function(t,e,n,s){const i=[];for(const r of t){const t=r.transform;let o=null;n instanceof ho&&(o=n.field(r.field)),null===o&&s instanceof ho&&(o=s.field(r.field)),i.push(Sr(t,o,e))}return i}(t.fieldTransforms,n,e,s),o=eo(t,i.data(),r);return new ho(t.key,i.version,o,{sn:!0})}(t,e,s,n):function(t,e){return $r(t.Ze,e)?new co(t.key,Vs.min()):e}(t,e)}function Hr(t,e){return t instanceof Zr?function(t,e){let n=null;for(const s of t.fieldTransforms){const t=e instanceof ho?e.field(s.field):void 0,i=Dr(s.transform,t||null);null!=i&&(n=null==n?(new ro).set(s.field,i):n.set(s.field,i))}return n?n.rn():null}(t,e):null}function Wr(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.Ze.isEqual(e.Ze)&&(0===t.type?t.value.isEqual(e.value):1===t.type?t.data.isEqual(e.data)&&t.Je.isEqual(e.Je):2!==t.type||Ls(t.fieldTransforms,t.fieldTransforms,(t,e)=>(function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Rr&&e instanceof Rr||t instanceof Or&&e instanceof Or?Ls(t.elements,e.elements,qi):t instanceof Vr&&e instanceof Vr?qi(t.Ye,e.Ye):t instanceof Cr&&e instanceof Cr}(t.transform,e.transform)})(t,e)))}function Xr(t){return t instanceof ho?t.version:Vs.min()}class Jr extends Br{constructor(t,e,n){super(),this.key=t,this.value=e,this.Ze=n,this.type=0}}class Qr extends Br{constructor(t,e,n,s){super(),this.key=t,this.data=e,this.Je=n,this.Ze=s,this.type=1}}function Yr(t,e){let n;return function(t,e){const n=new ro(e);return t.Je.fields.forEach(e=>{if(!e.$()){const s=t.data.field(e);null!==s?n.set(e,s):n.delete(e)}}),n.rn()}(t,n=e instanceof ho?e.data():io.empty())}class Zr extends Br{constructor(t,e){super(),this.key=t,this.fieldTransforms=e,this.type=2,this.Ze=jr.exists(!0)}}function to(t,e){return e}function eo(t,e,n){const s=new ro(e);for(let e=0;e<t.fieldTransforms.length;e++){const i=t.fieldTransforms[e];s.set(i.field,n[e])}return s.rn()}class no extends Br{constructor(t,e){super(),this.key=t,this.Ze=e,this.type=3}}class so extends Br{constructor(t,e){super(),this.key=t,this.Ze=e,this.type=4}}class io{constructor(t){this.proto=t}static empty(){return new io({mapValue:{}})}field(t){if(t.$())return this.proto;{let e=this.proto;for(let n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Yi(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.M()])||null}}isEqual(t){return qi(this.proto,t.proto)}}class ro{constructor(t=io.empty()){this.on=t,this.an=new Map}set(t,e){return this.cn(t,e),this}delete(t){return this.cn(t,null),this}cn(t,e){let n=this.an;for(let e=0;e<t.length-1;++e){const s=t.get(e);let i=n.get(s);i instanceof Map?n=i:i&&10===Mi(i)?(i=new Map(Object.entries(i.mapValue.fields||{})),n.set(s,i),n=i):(i=new Map,n.set(s,i),n=i)}n.set(t.M(),e)}rn(){const t=this.un(Fs.K(),this.an);return null!=t?new io(t):this.on}un(t,e){let n=!1;const s=this.on.field(t),i=Yi(s)?Object.assign({},s.mapValue.fields):{};return e.forEach((e,s)=>{if(e instanceof Map){const r=this.un(t.child(s),e);null!=r&&(i[s]=r,n=!0)}else null!==e?(i[s]=e,n=!0):i.hasOwnProperty(s)&&(delete i[s],n=!0)}),n?{mapValue:{fields:i}}:null}}function oo(t){const e=[];return Li(t.fields||{},(t,n)=>{const s=new Fs([t]);if(Yi(n)){const t=oo(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)}),new qr(e)}class ao{constructor(t,e){this.key=t,this.version=e}}class ho extends ao{constructor(t,e,n,s){super(t,e),this.hn=n,this.sn=!!s.sn,this.hasCommittedMutations=!!s.hasCommittedMutations}field(t){return this.hn.field(t)}data(){return this.hn}ln(){return this.hn.proto}isEqual(t){return t instanceof ho&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.sn===t.sn&&this.hasCommittedMutations===t.hasCommittedMutations&&this.hn.isEqual(t.hn)}toString(){return`Document(${this.key}, ${this.version}, ${this.hn.toString()}, {hasLocalMutations: ${this.sn}}), {hasCommittedMutations: ${this.hasCommittedMutations}})`}get hasPendingWrites(){return this.sn||this.hasCommittedMutations}}class co extends ao{constructor(t,e,n){super(t,e),this.hasCommittedMutations=!(!n||!n.hasCommittedMutations)}toString(){return`NoDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return this.hasCommittedMutations}isEqual(t){return t instanceof co&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}class uo extends ao{toString(){return`UnknownDocument(${this.key}, ${this.version})`}get hasPendingWrites(){return!0}isEqual(t){return t instanceof uo&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)}}function lo(t,e){if(!(t instanceof e))throw e.name===t.constructor.name?new xs(As.INVALID_ARGUMENT,`Type does not match the expected instance. Did you pass '${e.name}' from a different Firestore SDK?`):new xs(As.INVALID_ARGUMENT,`Expected type '${e.name}', but was '${t.constructor.name}'`);return t}class fo{constructor(t,e=null,n=[],s=[],i=null,r="F",o=null,a=null){this.path=t,this.collectionGroup=e,this._n=n,this.filters=s,this.limit=i,this.fn=r,this.startAt=o,this.endAt=a,this.dn=null,this.wn=null,this.startAt,this.endAt}}function po(t,e,n,s,i,r,o,a){return new fo(t,e,n,s,i,r,o,a)}function go(t){return new fo(t)}function mo(t){return!Bs(t.limit)&&"F"===t.fn}function yo(t){return!Bs(t.limit)&&"L"===t.fn}function wo(t){return t._n.length>0?t._n[0].field:null}function vo(t){for(const e of t.filters)if(e.En())return e.field;return null}function bo(t){return null!==t.collectionGroup}function Eo(t){const e=lo(t,fo);if(null===e.dn){e.dn=[];const t=vo(e),n=wo(e);if(null!==t&&null===n)t.G()||e.dn.push(new Go(t)),e.dn.push(new Go(Fs.H(),"asc"));else{let t=!1;for(const n of e._n)e.dn.push(n),n.field.G()&&(t=!0);if(!t){const t=e._n.length>0?e._n[e._n.length-1].dir:"asc";e.dn.push(new Go(Fs.H(),t))}}}return e.dn}function Io(t){const e=lo(t,fo);if(!e.wn)if("F"===e.fn)e.wn=Ws(e.path,e.collectionGroup,Eo(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of Eo(e)){const e="desc"===n.dir?"asc":"desc";t.push(new Go(n.field,e))}const n=e.endAt?new Uo(e.endAt.position,!e.endAt.before):null,s=e.startAt?new Uo(e.startAt.position,!e.startAt.before):null;e.wn=Ws(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.wn}function _o(t,e){return Js(Io(t),Io(e))&&t.fn===e.fn}function To(t){return`${Xs(Io(t))}|lt:${t.fn}`}function No(t){return`Query(target=${function(t){let e=t.path.U();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>{return`${(e=t).field.U()} ${e.op} ${$i(e.value)}`;var e}).join(", ")}]`),Bs(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>(function(t){return`${t.field.U()} (${t.dir})`})(t)).join(", ")}]`),t.startAt&&(e+=", startAt: "+Mo(t.startAt)),t.endAt&&(e+=", endAt: "+Mo(t.endAt)),`Target(${e})`}(Io(t))}; limitType=${t.fn})`}function Ao(t,e){return function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.Z(t.collectionGroup)&&t.path.L(n):Gs.tt(t.path)?t.path.isEqual(n):t.path.q(n)}(t,e)&&function(t,e){for(const n of t._n)if(!n.field.G()&&null===e.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!qo(t.startAt,Eo(t),e))&&(!t.endAt||!qo(t.endAt,Eo(t),e))}(t,e)}function xo(t){return(e,n)=>{let s=!1;for(const i of Eo(t)){const t=jo(i,e,n);if(0!==t)return t;s=s||i.field.G()}return 0}}class So extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){if(t.G())return"in"===e||"not-in"===e?this.Tn(t,e,n):new ko(t,e,n);if(Ji(n)){if("=="!==e&&"!="!==e)throw new xs(As.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new So(t,e,n)}if(Qi(n)){if("=="!==e&&"!="!==e)throw new xs(As.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new So(t,e,n)}return"array-contains"===e?new Lo(t,n):"in"===e?new Oo(t,n):"not-in"===e?new Po(t,n):"array-contains-any"===e?new Vo(t,n):new So(t,e,n)}static Tn(t,e,n){return"in"===e?new Do(t,n):new Co(t,n)}matches(t){const e=t.field(this.field);return"!="===this.op?null!==e&&this.In(Gi(e,this.value)):null!==e&&Mi(this.value)===Mi(e)&&this.In(Gi(e,this.value))}In(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return _s()}}En(){return["<","<=",">",">=","!="].indexOf(this.op)>=0}}class ko extends So{constructor(t,e,n){super(t,e,n),this.key=Gs.X(n.referenceValue)}matches(t){const e=Gs.C(t.key,this.key);return this.In(e)}}class Do extends So{constructor(t,e){super(t,"in",e),this.keys=Ro("in",e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Co extends So{constructor(t,e){super(t,"not-in",e),this.keys=Ro("not-in",e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Ro(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>Gs.X(t.referenceValue))}class Lo extends So{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.field(this.field);return Xi(e)&&Fi(e.arrayValue,this.value)}}class Oo extends So{constructor(t,e){super(t,"in",e)}matches(t){const e=t.field(this.field);return null!==e&&Fi(this.value.arrayValue,e)}}class Po extends So{constructor(t,e){super(t,"not-in",e)}matches(t){const e=t.field(this.field);return null!==e&&!Fi(this.value.arrayValue,e)}}class Vo extends So{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.field(this.field);return!(!Xi(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>Fi(this.value.arrayValue,t))}}class Uo{constructor(t,e){this.position=t,this.before=e}}function Mo(t){return`${t.before?"b":"a"}:${t.position.map(t=>$i(t)).join(",")}`}function qo(t,e,n){let s=0;for(let i=0;i<t.position.length;i++){const r=e[i],o=t.position[i];if(s=r.field.G()?Gs.C(Gs.X(o.referenceValue),n.key):Gi(o,n.field(r.field)),"desc"===r.dir&&(s*=-1),0!==s)break}return t.before?s<=0:s<0}function Fo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!qi(t.position[n],e.position[n]))return!1;return!0}class Go{constructor(t,e="asc"){this.field=t,this.dir=e}}function jo(t,e,n){const s=t.field.G()?Gs.C(e.key,n.key):function(t,e,n){const s=e.field(t),i=n.field(t);return null!==s&&null!==i?Gi(s,i):_s()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return _s()}}function $o(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Bo{constructor(t,e,n,s){this.batchId=t,this.mn=e,this.baseMutations=n,this.mutations=s}An(t,e,n){const s=n.Rn;for(let n=0;n<this.mutations.length;n++){const i=this.mutations[n];i.key.isEqual(t)&&(e=zr(i,e,s[n]))}return e}Pn(t,e){for(const n of this.baseMutations)n.key.isEqual(t)&&(e=Kr(n,e,e,this.mn));const n=e;for(const s of this.mutations)s.key.isEqual(t)&&(e=Kr(s,e,n,this.mn));return e}Vn(t){let e=t;return this.mutations.forEach(n=>{const s=this.Pn(n.key,t.get(n.key));s&&(e=e.ft(n.key,s))}),e}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),yi())}isEqual(t){return this.batchId===t.batchId&&Ls(this.mutations,t.mutations,(t,e)=>Wr(t,e))&&Ls(this.baseMutations,t.baseMutations,(t,e)=>Wr(t,e))}}class zo{constructor(t,e,n,s){this.batch=t,this.gn=e,this.Rn=n,this.yn=s}static from(t,e,n){Ts(t.mutations.length===n.length);let s=gi;const i=t.mutations;for(let t=0;t<i.length;t++)s=s.ft(i[t].key,n[t].version);return new zo(t,e,n,s)}}class Ko{constructor(t,e){this.pn=t,this.bn=e,this.vn={}}get(t){const e=this.pn(t),n=this.vn[e];if(void 0!==n)for(const[e,s]of n)if(this.bn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.pn(t),s=this.vn[n];if(void 0!==s){for(let n=0;n<s.length;n++)if(this.bn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e])}else this.vn[n]=[[t,e]]}delete(t){const e=this.pn(t),n=this.vn[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.bn(n[s][0],t))return 1===n.length?delete this.vn[e]:n.splice(s,1),!0;return!1}forEach(t){Li(this.vn,(e,n)=>{for(const[e,s]of n)t(e,s)})}$(){return Oi(this.vn)}}class Ho{constructor(t){this.Sn=null,this.Dn=null,this.result=void 0,this.error=void 0,this.Cn=!1,this.Nn=!1,t(t=>{this.Cn=!0,this.result=t,this.Sn&&this.Sn(t)},t=>{this.Cn=!0,this.error=t,this.Dn&&this.Dn(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.Nn&&_s(),this.Nn=!0,this.Cn?this.error?this.xn(e,this.error):this.On(t,this.result):new Ho((n,s)=>{this.Sn=(e=>{this.On(t,e).next(n,s)}),this.Dn=(t=>{this.xn(e,t).next(n,s)})})}kn(){return new Promise((t,e)=>{this.next(t,e)})}Fn(t){try{const e=t();return e instanceof Ho?e:Ho.resolve(e)}catch(t){return Ho.reject(t)}}On(t,e){return t?this.Fn(()=>t(e)):Ho.resolve(e)}xn(t,e){return t?this.Fn(()=>t(e)):Ho.reject(e)}static resolve(t){return new Ho((e,n)=>{e(t)})}static reject(t){return new Ho((e,n)=>{n(t)})}static Mn(t){return new Ho((e,n)=>{let s=0,i=0,r=!1;t.forEach(t=>{++s,t.next(()=>{++i,r&&i===s&&e()},t=>n(t))}),r=!0,i===s&&e()})}static $n(t){let e=Ho.resolve(!1);for(const n of t)e=e.next(t=>t?Ho.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,s)=>{n.push(e.call(this,t,s))}),this.Mn(n)}}class Wo{constructor(){this.Ln=new Ko(t=>t.toString(),(t,e)=>t.isEqual(e)),this.qn=!1}set readTime(t){this.Bn=t}get readTime(){return this.Bn}Un(t,e){this.Wn(),this.readTime=e,this.Ln.set(t.key,t)}Kn(t,e){this.Wn(),e&&(this.readTime=e),this.Ln.set(t,null)}Qn(t,e){this.Wn();const n=this.Ln.get(e);return void 0!==n?Ho.resolve(n):this.jn(t,e)}getEntries(t,e){return this.Gn(t,e)}apply(t){return this.Wn(),this.qn=!0,this.zn(t)}Wn(){}}const Xo="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Jo{constructor(){this.Hn=[]}Jn(t){this.Hn.push(t)}Yn(){this.Hn.forEach(t=>t())}}class Qo{constructor(t,e,n){this.Xn=t,this.Zn=e,this.ts=n}es(t,e){return this.Zn.ns(t,e).next(n=>this.ss(t,e,n))}ss(t,e,n){return this.Xn.Qn(t,e).next(t=>{for(const s of n)t=s.Pn(e,t);return t})}rs(t,e,n){let s=fi();return e.forEach((t,e)=>{for(const s of n)e=s.Pn(t,e);s=s.ft(t,e)}),s}os(t,e){return this.Xn.getEntries(t,e).next(e=>this.as(t,e))}as(t,e){return this.Zn.cs(t,e).next(n=>{const s=this.rs(t,e,n);let i=li();return s.forEach((t,e)=>{e||(e=new co(t,Vs.min())),i=i.ft(t,e)}),i})}us(t,e,n){return function(t){return Gs.tt(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.hs(t,e.path):bo(e)?this.ls(t,e,n):this._s(t,e,n)}hs(t,e){return this.es(t,new Gs(e)).next(t=>{let e=pi();return t instanceof ho&&(e=e.ft(t.key,t)),e})}ls(t,e,n){const s=e.collectionGroup;let i=pi();return this.ts.fs(t,s).next(r=>Ho.forEach(r,r=>{const o=function(t,e){return new fo(e,null,t._n.slice(),t.filters.slice(),t.limit,t.fn,t.startAt,t.endAt)}(e,r.child(s));return this._s(t,o,n).next(t=>{t.forEach((t,e)=>{i=i.ft(t,e)})})}).next(()=>i))}_s(t,e,n){let s,i;return this.Xn.us(t,e,n).next(n=>(s=n,this.Zn.ds(t,e))).next(e=>(i=e,this.ws(t,i,s).next(t=>{s=t;for(const t of i)for(const e of t.mutations){const n=e.key,i=s.get(n),r=Kr(e,i,i,t.mn);s=r instanceof ho?s.ft(n,r):s.remove(n)}}))).next(()=>(s.forEach((t,n)=>{Ao(e,n)||(s=s.remove(t))}),s))}ws(t,e,n){let s=yi();for(const t of e)for(const e of t.mutations)e instanceof Qr&&null===n.get(e.key)&&(s=s.add(e.key));let i=n;return this.Xn.getEntries(t,s).next(t=>(t.forEach((t,e)=>{null!==e&&e instanceof ho&&(i=i.ft(t,e))}),i))}}class Yo{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.Es=n,this.Ts=s}static Is(t,e){let n=yi(),s=yi();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new Yo(t,e.fromCache,n,s)}}class Zo{constructor(t,e){this.previousValue=t,e&&(e.ms=(t=>this.As(t)),this.Rs=(t=>e.Ps(t)))}As(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.Rs&&this.Rs(t),t}}Zo.Vs=-1;class ta{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class ea{constructor(t,e,n=1e3,s=1.5,i=6e4){this.gs=t,this.ys=e,this.ps=n,this.bs=s,this.vs=i,this.Ss=0,this.Ds=null,this.Cs=Date.now(),this.reset()}reset(){this.Ss=0}Ns(){this.Ss=this.vs}xs(t){this.cancel();const e=Math.floor(this.Ss+this.Os()),n=Math.max(0,Date.now()-this.Cs),s=Math.max(0,e-n);s>0&&vs("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.Ss} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Ds=this.gs.ks(this.ys,s,()=>(this.Cs=Date.now(),t())),this.Ss*=this.bs,this.Ss<this.ps&&(this.Ss=this.ps),this.Ss>this.vs&&(this.Ss=this.vs)}Fs(){null!==this.Ds&&(this.Ds.Ms(),this.Ds=null)}cancel(){null!==this.Ds&&(this.Ds.cancel(),this.Ds=null)}Os(){return(Math.random()-.5)*this.Ss}}class na{constructor(t,e,n){this.name=t,this.version=e,this.$s=n,12.2===na.Ls(s())&&bs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return vs("SimpleDb","Removing database:",t),ha(window.indexedDB.deleteDatabase(t)).kn()}static qs(){if("undefined"==typeof indexedDB)return!1;if(na.Bs())return!0;const t=s(),e=na.Ls(t),n=0<e&&e<10,i=na.Us(t),r=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||r)}static Bs(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Ws)}static Ks(t,e){return t.store(e)}static Ls(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Us(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async Qs(){return this.db||(vs("SimpleDb","Opening database:",this.name),this.db=await new Promise((t,e)=>{const n=indexedDB.open(this.name,this.version);n.onsuccess=(e=>{const n=e.target.result;t(n)}),n.onblocked=(()=>{e(new ia("Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))}),n.onerror=(t=>{const n=t.target.error;"VersionError"===n.name?e(new xs(As.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):e(new ia(n))}),n.onupgradeneeded=(t=>{vs("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.$s.createOrUpgrade(e,n.transaction,t.oldVersion,this.version).next(()=>{vs("SimpleDb","Database upgrade to version "+this.version+" complete")})})})),this.js&&(this.db.onversionchange=(t=>this.js(t))),this.db}Gs(t){this.js=t,this.db&&(this.db.onversionchange=(e=>t(e)))}async runTransaction(t,e,n){const s="readonly"===t;for(;;){0;try{this.db=await this.Qs();const i=oa.open(this.db,s?"readonly":"readwrite",e),r=n(i).catch(t=>(i.abort(t),Ho.reject(t))).kn();return r.catch(()=>{}),await i.zs,r}catch(t){const e="FirebaseError"!==t.name&&r<3;if(vs("SimpleDb","Transaction failed with error: %s. Retrying: %s.",t.message,e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class sa{constructor(t){this.Hs=t,this.Js=!1,this.Ys=null}get Cn(){return this.Js}get Xs(){return this.Ys}set cursor(t){this.Hs=t}done(){this.Js=!0}Zs(t){this.Ys=t}delete(){return ha(this.Hs.delete())}}class ia extends xs{constructor(t){super(As.UNAVAILABLE,"IndexedDB transaction failed: "+t),this.name="IndexedDbTransactionError"}}function ra(t){return"IndexedDbTransactionError"===t.name}class oa{constructor(t){this.transaction=t,this.aborted=!1,this.ti=new ta,this.transaction.oncomplete=(()=>{this.ti.resolve()}),this.transaction.onabort=(()=>{t.error?this.ti.reject(new ia(t.error)):this.ti.resolve()}),this.transaction.onerror=(t=>{const e=ua(t.target.error);this.ti.reject(new ia(e))})}static open(t,e,n){try{return new oa(t.transaction(n,e))}catch(t){throw new ia(t)}}get zs(){return this.ti.promise}abort(t){t&&this.ti.reject(t),this.aborted||(vs("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}store(t){const e=this.transaction.objectStore(t);return new aa(e)}}class aa{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(vs("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(vs("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ha(n)}add(t){return vs("SimpleDb","ADD",this.store.name,t,t),ha(this.store.add(t))}get(t){return ha(this.store.get(t)).next(e=>(void 0===e&&(e=null),vs("SimpleDb","GET",this.store.name,t,e),e))}delete(t){return vs("SimpleDb","DELETE",this.store.name,t),ha(this.store.delete(t))}count(){return vs("SimpleDb","COUNT",this.store.name),ha(this.store.count())}ei(t,e){const n=this.cursor(this.options(t,e)),s=[];return this.ni(n,(t,e)=>{s.push(e)}).next(()=>s)}si(t,e){vs("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.ii=!1;const s=this.cursor(n);return this.ni(s,(t,e,n)=>n.delete())}ri(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.ni(s,e)}oi(t){const e=this.cursor({});return new Ho((n,s)=>{e.onerror=(t=>{const e=ua(t.target.error);s(e)}),e.onsuccess=(e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next(t=>{t?s.continue():n()}):n()})})}ni(t,e){const n=[];return new Ho((s,i)=>{t.onerror=(t=>{i(t.target.error)}),t.onsuccess=(t=>{const i=t.target.result;if(!i)return void s();const r=new sa(i),o=e(i.primaryKey,i.value,r);if(o instanceof Ho){const t=o.catch(t=>(r.done(),Ho.reject(t)));n.push(t)}r.Cn?s():null===r.Xs?i.continue():i.continue(r.Xs)})}).next(()=>Ho.Mn(n))}options(t,e){let n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.ii?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function ha(t){return new Ho((e,n)=>{t.onsuccess=(t=>{const n=t.target.result;e(n)}),t.onerror=(t=>{const e=ua(t.target.error);n(e)})})}let ca=!1;function ua(t){const e=na.Ls(s());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new xs("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ca||(ca=!0,setTimeout(()=>{throw t},0)),t}}return t}function la(){return"undefined"!=typeof window?window:null}function fa(){return"undefined"!=typeof document?document:null}class da{constructor(t,e,n,s,i){this.ai=t,this.ys=e,this.ci=n,this.op=s,this.ui=i,this.hi=new ta,this.then=this.hi.promise.then.bind(this.hi.promise),this.hi.promise.catch(t=>{})}static li(t,e,n,s,i){const r=Date.now()+n,o=new da(t,e,r,s,i);return o.start(n),o}start(t){this._i=setTimeout(()=>this.fi(),t)}Ms(){return this.fi()}cancel(t){null!==this._i&&(this.clearTimeout(),this.hi.reject(new xs(As.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}fi(){this.ai.di(()=>null!==this._i?(this.clearTimeout(),this.op().then(t=>this.hi.resolve(t))):Promise.resolve())}clearTimeout(){null!==this._i&&(this.ui(this),clearTimeout(this._i),this._i=null)}}class pa{constructor(){this.wi=Promise.resolve(),this.Ei=[],this.Ti=!1,this.Ii=[],this.mi=null,this.Ai=!1,this.Ri=[],this.Pi=new ea(this,"async_queue_retry"),this.Vi=(()=>{const t=fa();t&&vs("AsyncQueue","Visibility state changed to  ",t.visibilityState),this.Pi.Fs()});const t=fa();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.Vi)}get gi(){return this.Ti}di(t){this.enqueue(t)}yi(t){this.pi(),this.bi(t)}vi(){if(!this.Ti){this.Ti=!0;const t=fa();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Vi)}}enqueue(t){return this.pi(),this.Ti?new Promise(t=>{}):this.bi(t)}Si(t){this.Ei.push(t),this.di(()=>this.Di())}async Di(){if(0!==this.Ei.length){try{await this.Ei[0](),this.Ei.shift(),this.Pi.reset()}catch(t){if(!ra(t))throw t;vs("AsyncQueue","Operation failed with retryable error: "+t)}this.Ei.length>0&&this.Pi.xs(()=>this.Di())}}bi(t){const e=this.wi.then(()=>(this.Ai=!0,t().catch(t=>{throw this.mi=t,this.Ai=!1,bs("INTERNAL UNHANDLED ERROR: ",function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(t=>(this.Ai=!1,t))));return this.wi=e,e}ks(t,e,n){this.pi(),this.Ri.indexOf(t)>-1&&(e=0);const s=da.li(this,t,e,n,t=>this.Ci(t));return this.Ii.push(s),s}pi(){this.mi&&_s()}Ni(){}async xi(){let t;do{t=this.wi,await t}while(t!==this.wi)}Oi(t){for(const e of this.Ii)if(e.ys===t)return!0;return!1}ki(t){return this.xi().then(()=>{this.Ii.sort((t,e)=>t.ci-e.ci);for(const e of this.Ii)if(e.Ms(),"all"!==t&&e.ys===t)break;return this.xi()})}Fi(t){this.Ri.push(t)}Ci(t){const e=this.Ii.indexOf(t);this.Ii.splice(e,1)}}function ga(t,e){if(bs("AsyncQueue",`${e}: ${t}`),ra(t))return new xs(As.UNAVAILABLE,`${e}: ${t}`);throw t}function ma([t,e],[n,s]){const i=Rs(t,n);return 0===i?Rs(e,s):i}class ya{constructor(t){this.Mi=t,this.buffer=new hi(ma),this.$i=0}Li(){return++this.$i}qi(t){const e=[t,this.Li()];if(this.buffer.size<this.Mi)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();ma(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}const wa={Bi:!1,Ui:0,Wi:0,Ki:0};class va{constructor(t,e,n){this.Qi=t,this.ji=e,this.Gi=n}static zi(t){return new va(t,va.Hi,va.Ji)}}va.Yi=-1,va.Xi=1048576,va.Zi=41943040,va.Hi=10,va.Ji=1e3,va.tr=new va(va.Zi,va.Hi,va.Ji),va.er=new va(va.Yi,0,0);class ba{constructor(t,e){this.nr=t,this.ai=e,this.sr=!1,this.ir=null}start(t){this.nr.params.Qi!==va.Yi&&this.rr(t)}stop(){this.ir&&(this.ir.cancel(),this.ir=null)}get or(){return null!==this.ir}rr(t){const e=this.sr?3e5:6e4;vs("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.ir=this.ai.ks("lru_garbage_collection",e,async()=>{this.ir=null,this.sr=!0;try{await t.ar(this.nr)}catch(t){ra(t)?vs("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Vh(t)}await this.rr(t)})}}class Ea{constructor(t,e){this.cr=t,this.params=e}ur(t,e){return this.cr.hr(t).next(t=>Math.floor(e/100*t))}lr(t,e){if(0===e)return Ho.resolve(Zo.Vs);const n=new ya(e);return this.cr.Me(t,t=>n.qi(t.sequenceNumber)).next(()=>this.cr._r(t,t=>n.qi(t))).next(()=>n.maxValue)}dr(t,e,n){return this.cr.dr(t,e,n)}wr(t,e){return this.cr.wr(t,e)}Er(t,e){return this.params.Qi===va.Yi?(vs("LruGarbageCollector","Garbage collection skipped; disabled"),Ho.resolve(wa)):this.Tr(t).next(n=>n<this.params.Qi?(vs("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold `+this.params.Qi),wa):this.Ir(t,e))}Tr(t){return this.cr.Tr(t)}Ir(t,e){let n,s,i,r,o,a,c;const u=Date.now();return this.ur(t,this.params.ji).next(e=>(e>this.params.Gi?(vs("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.Gi} from `+e),s=this.params.Gi):s=e,r=Date.now(),this.lr(t,s))).next(s=>(n=s,o=Date.now(),this.dr(t,n,e))).next(e=>(i=e,a=Date.now(),this.wr(t,n))).next(t=>(c=Date.now(),ws()<=h.DEBUG&&vs("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-u}ms\n\tDetermined least recently used ${s} in `+(o-r)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Ho.resolve({Bi:!0,Ui:s,Wi:i,Ki:t})))}}function Ia(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Ta(e)),e=_a(t.get(n),e);return Ta(e)}function _a(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function Ta(t){return t+""}function Na(t){const e=t.length;if(Ts(e>=2),2===e)return Ts(""===t.charAt(0)&&""===t.charAt(1)),Ms.K();const n=e-2,s=[];let i="";for(let n=0;n<e;){const e=t.indexOf("",n);switch((e<0||e>r)&&_s(),t.charAt(e+1)){case"":const r=t.substring(n,e);let o;0===i.length?o=r:(o=i+=r,i=""),s.push(o);break;case"":i+=t.substring(n,e),i+="\0";break;case"":i+=t.substring(n,e+1);break;default:_s()}n=e+2}return new Ms(s)}class Aa{constructor(t){this.mr=t}}function xa(t,e){if(e.document)return function(t,e,n){const s=lr(t,e.name),i=ar(e.updateTime),r=new io({mapValue:{fields:e.fields}});return new ho(s,i,r,{hasCommittedMutations:!!n})}(t.mr,e.document,!!e.hasCommittedMutations);if(e.noDocument){const t=Gs.et(e.noDocument.path),n=Ra(e.noDocument.readTime);return new co(t,n,{hasCommittedMutations:!!e.hasCommittedMutations})}if(e.unknownDocument){const t=Gs.et(e.unknownDocument.path),n=Ra(e.unknownDocument.version);return new uo(t,n)}return _s()}function Sa(t,e,n){const s=ka(n),i=e.key.path.k().B();if(e instanceof ho){const n=function(t,e){return{name:ur(t,e.key),fields:e.ln().mapValue.fields,updateTime:rr(t,e.version.S())}}(t.mr,e),r=e.hasCommittedMutations;return new sh(null,null,n,r,s,i)}if(e instanceof co){const t=e.key.path.B(),n=Ca(e.version),r=e.hasCommittedMutations;return new sh(null,new eh(t,n),null,r,s,i)}if(e instanceof uo){const t=e.key.path.B(),n=Ca(e.version);return new sh(new nh(t,n),null,null,!0,s,i)}return _s()}function ka(t){const e=t.S();return[e.seconds,e.nanoseconds]}function Da(t){const e=new Ps(t[0],t[1]);return Vs.g(e)}function Ca(t){const e=t.S();return new Ja(e.seconds,e.nanoseconds)}function Ra(t){const e=new Ps(t.seconds,t.nanoseconds);return Vs.g(e)}function La(t,e){const n=(e.baseMutations||[]).map(e=>wr(t.mr,e)),s=e.mutations.map(e=>wr(t.mr,e)),i=Ps.fromMillis(e.localWriteTimeMs);return new Bo(e.batchId,i,n,s)}function Oa(t){const e=Ra(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?Ra(t.lastLimboFreeSnapshotVersion):Vs.min();let s;var i;return void 0!==t.query.documents?(Ts(1===(i=t.query).documents.length),s=Io(go(dr(i.documents[0])))):s=Er(t.query),new Zs(s,t.targetId,0,t.lastListenSequenceNumber,e,n,Ys.fromBase64String(t.resumeToken))}function Pa(t,e){const n=Ca(e.ut),s=Ca(e.lastLimboFreeSnapshotVersion);let i;i=Qs(e.target)?vr(t.mr,e.target):br(t.mr,e.target);const r=e.resumeToken.toBase64();return new rh(e.targetId,Xs(e.target),n,r,e.sequenceNumber,s,i)}class Va{constructor(t,e,n,s){this.userId=t,this.serializer=e,this.ts=n,this.Ar=s,this.Rr={}}static Pr(t,e,n,s){Ts(""!==t.uid);const i=t.t()?t.uid:"";return new Va(i,e,n,s)}Vr(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return qa(t).ri({index:Za.userMutationsIndex,range:n},(t,n,s)=>{e=!1,s.done()}).next(()=>e)}gr(t,e,n,s){const i=Fa(t),r=qa(t);return r.add({}).next(o=>{Ts("number"==typeof o);const a=new Bo(o,e,n,s),h=function(t,e,n){const s=n.baseMutations.map(e=>yr(t.mr,e)),i=n.mutations.map(e=>yr(t.mr,e));return new Za(e,n.batchId,n.mn.toMillis(),s,i)}(this.serializer,this.userId,a),c=[];let u=new hi((t,e)=>Rs(t.U(),e.U()));for(const t of s){const e=th.key(this.userId,t.key.path,o);u=u.add(t.key.path.k()),c.push(r.put(h)),c.push(i.put(e,th.PLACEHOLDER))}return u.forEach(e=>{c.push(this.ts.yr(t,e))}),t.Jn(()=>{this.Rr[o]=a.keys()}),Ho.Mn(c).next(()=>a)})}pr(t,e){return qa(t).get(e).next(t=>t?(Ts(t.userId===this.userId),La(this.serializer,t)):null)}br(t,e){return this.Rr[e]?Ho.resolve(this.Rr[e]):this.pr(t,e).next(t=>{if(t){const n=t.keys();return this.Rr[e]=n,n}return null})}vr(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let i=null;return qa(t).ri({index:Za.userMutationsIndex,range:s},(t,e,s)=>{e.userId===this.userId&&(Ts(e.batchId>=n),i=La(this.serializer,e)),s.done()}).next(()=>i)}Sr(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return qa(t).ri({index:Za.userMutationsIndex,range:e,reverse:!0},(t,e,s)=>{n=e.batchId,s.done()}).next(()=>n)}Dr(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return qa(t).ei(Za.userMutationsIndex,e).next(t=>t.map(t=>La(this.serializer,t)))}ns(t,e){const n=th.prefixForPath(this.userId,e.path),s=IDBKeyRange.lowerBound(n),i=[];return Fa(t).ri({range:s},(n,s,r)=>{const[o,a,h]=n,c=Na(a);if(o===this.userId&&e.path.isEqual(c))return qa(t).get(h).next(t=>{if(!t)throw _s();Ts(t.userId===this.userId),i.push(La(this.serializer,t))});r.done()}).next(()=>i)}cs(t,e){let n=new hi(Rs);const s=[];return e.forEach(e=>{const i=th.prefixForPath(this.userId,e.path),r=IDBKeyRange.lowerBound(i),o=Fa(t).ri({range:r},(t,s,i)=>{const[r,o,a]=t,h=Na(o);r===this.userId&&e.path.isEqual(h)?n=n.add(a):i.done()});s.push(o)}),Ho.Mn(s).next(()=>this.Cr(t,n))}ds(t,e){const n=e.path,s=n.length+1,i=th.prefixForPath(this.userId,n),r=IDBKeyRange.lowerBound(i);let o=new hi(Rs);return Fa(t).ri({range:r},(t,e,i)=>{const[r,a,h]=t,c=Na(a);r===this.userId&&n.L(c)?c.length===s&&(o=o.add(h)):i.done()}).next(()=>this.Cr(t,o))}Cr(t,e){const n=[],s=[];return e.forEach(e=>{s.push(qa(t).get(e).next(t=>{if(null===t)throw _s();Ts(t.userId===this.userId),n.push(La(this.serializer,t))}))}),Ho.Mn(s).next(()=>n)}Nr(t,e){return Ma(t.xr,this.userId,e).next(n=>(t.Jn(()=>{this.Or(e.batchId)}),Ho.forEach(n,e=>this.Ar.kr(t,e))))}Or(t){delete this.Rr[t]}Fr(t){return this.Vr(t).next(e=>{if(!e)return Ho.resolve();const n=IDBKeyRange.lowerBound(th.prefixForUser(this.userId)),s=[];return Fa(t).ri({range:n},(t,e,n)=>{if(t[0]===this.userId){const e=Na(t[1]);s.push(e)}else n.done()}).next(()=>{Ts(0===s.length)})})}Mr(t,e){return Ua(t,this.userId,e)}$r(t){return Ga(t).get(this.userId).next(t=>t||new Ya(this.userId,-1,""))}}function Ua(t,e,n){const s=th.prefixForPath(e,n.path),i=s[1],r=IDBKeyRange.lowerBound(s);let o=!1;return Fa(t).ri({range:r,ii:!0},(t,n,s)=>{const[r,a,h]=t;r===e&&a===i&&(o=!0),s.done()}).next(()=>o)}function Ma(t,e,n){const s=t.store(Za.store),i=t.store(th.store),r=[],o=IDBKeyRange.only(n.batchId);let a=0;const h=s.ri({range:o},(t,e,n)=>(a++,n.delete()));r.push(h.next(()=>{Ts(1===a)}));const c=[];for(const t of n.mutations){const s=th.key(e,t.key.path,n.batchId);r.push(i.delete(s)),c.push(t.key)}return Ho.Mn(r).next(()=>c)}function qa(t){return Eh.Ks(t,Za.store)}function Fa(t){return Eh.Ks(t,th.store)}function Ga(t){return Eh.Ks(t,Ya.store)}class ja{constructor(t,e){this.serializer=t,this.ts=e}Un(t,e,n){return Ba(t).put(za(e),n)}Kn(t,e){const n=Ba(t),s=za(e);return n.delete(s)}updateMetadata(t,e){return this.getMetadata(t).next(n=>(n.byteSize+=e,this.Lr(t,n)))}Qn(t,e){return Ba(t).get(za(e)).next(t=>this.qr(t))}Br(t,e){return Ba(t).get(za(e)).next(t=>{const e=this.qr(t);return e?{Ur:e,size:Ka(t)}:null})}getEntries(t,e){let n=fi();return this.Wr(t,e,(t,e)=>{const s=this.qr(e);n=n.ft(t,s)}).next(()=>n)}Kr(t,e){let n=fi(),s=new ri(Gs.C);return this.Wr(t,e,(t,e)=>{const i=this.qr(e);i?(n=n.ft(t,i),s=s.ft(t,Ka(e))):(n=n.ft(t,null),s=s.ft(t,0))}).next(()=>({Qr:n,jr:s}))}Wr(t,e,n){if(e.$())return Ho.resolve();const s=IDBKeyRange.bound(e.first().path.B(),e.last().path.B()),i=e.At();let r=i.pt();return Ba(t).ri({range:s},(t,e,s)=>{const o=Gs.et(t);for(;r&&Gs.C(r,o)<0;)n(r,null),r=i.pt();r&&r.isEqual(o)&&(n(r,e),r=i.bt()?i.pt():null),r?s.Zs(r.path.B()):s.done()}).next(()=>{for(;r;)n(r,null),r=i.bt()?i.pt():null})}us(t,e,n){let s=pi();const i=e.path.length+1,r={};if(n.isEqual(Vs.min())){const t=e.path.B();r.range=IDBKeyRange.lowerBound(t)}else{const t=e.path.B(),s=ka(n);r.range=IDBKeyRange.lowerBound([t,s],!0),r.index=sh.collectionReadTimeIndex}return Ba(t).ri(r,(t,n,r)=>{if(t.length!==i)return;const o=xa(this.serializer,n);e.path.L(o.key.path)?o instanceof ho&&Ao(e,o)&&(s=s.ft(o.key,o)):r.done()}).next(()=>s)}Gr(t,e){let n=li(),s=ka(e);const i=Ba(t),r=IDBKeyRange.lowerBound(s,!0);return i.ri({index:sh.readTimeIndex,range:r},(t,e)=>{const i=xa(this.serializer,e);n=n.ft(i.key,i),s=e.readTime}).next(()=>({zr:n,readTime:Da(s)}))}Hr(t){const e=Ba(t);let n=Vs.min();return e.ri({index:sh.readTimeIndex,reverse:!0},(t,e,s)=>{e.readTime&&(n=Da(e.readTime)),s.done()}).next(()=>n)}Jr(t){return new ja.Yr(this,!!t&&t.Xr)}Zr(t){return this.getMetadata(t).next(t=>t.byteSize)}getMetadata(t){return $a(t).get(ih.key).next(t=>(Ts(!!t),t))}Lr(t,e){return $a(t).put(ih.key,e)}qr(t){if(t){const e=xa(this.serializer,t);return e instanceof co&&e.version.isEqual(Vs.min())?null:e}return null}}function $a(t){return Eh.Ks(t,ih.store)}function Ba(t){return Eh.Ks(t,sh.store)}function za(t){return t.path.B()}function Ka(t){let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw _s();e=t.noDocument}return JSON.stringify(e).length}ja.Yr=class extends Wo{constructor(t,e){super(),this.to=t,this.Xr=e,this.eo=new Ko(t=>t.toString(),(t,e)=>t.isEqual(e))}zn(t){const e=[];let n=0,s=new hi((t,e)=>Rs(t.U(),e.U()));return this.Ln.forEach((i,r)=>{const o=this.eo.get(i);if(r){const a=Sa(this.to.serializer,r,this.readTime);s=s.add(i.path.k());const h=Ka(a);n+=h-o,e.push(this.to.Un(t,i,a))}else if(n-=o,this.Xr){const n=Sa(this.to.serializer,new co(i,Vs.min()),this.readTime);e.push(this.to.Un(t,i,n))}else e.push(this.to.Kn(t,i))}),s.forEach(n=>{e.push(this.to.ts.yr(t,n))}),e.push(this.to.updateMetadata(t,n)),Ho.Mn(e)}jn(t,e){return this.to.Br(t,e).next(t=>null===t?(this.eo.set(e,0),null):(this.eo.set(e,t.size),t.Ur))}Gn(t,e){return this.to.Kr(t,e).next(({Qr:t,jr:e})=>(e.forEach((t,e)=>{this.eo.set(t,e)}),t))}};class Ha{constructor(){this.no=new Wa}yr(t,e){return this.no.add(e),Ho.resolve()}fs(t,e){return Ho.resolve(this.no.getEntries(e))}}class Wa{constructor(){this.index={}}add(t){const e=t.M(),n=t.k(),s=this.index[e]||new hi(Ms.C),i=!s.has(n);return this.index[e]=s.add(n),i}has(t){const e=t.M(),n=t.k(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new hi(Ms.C)).B()}}class Xa{constructor(t){this.serializer=t}createOrUpgrade(t,e,n,s){Ts(n<s&&n>=0&&s<=10);const i=new oa(e);n<1&&s>=1&&(function(t){t.createObjectStore(Qa.store)}(t),function(t){t.createObjectStore(Ya.store,{keyPath:Ya.keyPath}),t.createObjectStore(Za.store,{keyPath:Za.keyPath,autoIncrement:!0}).createIndex(Za.userMutationsIndex,Za.userMutationsKeyPath,{unique:!0}),t.createObjectStore(th.store)}(t),ch(t),function(t){t.createObjectStore(sh.store)}(t));let r=Ho.resolve();return n<3&&s>=3&&(0!==n&&(function(t){t.deleteObjectStore(oh.store),t.deleteObjectStore(rh.store),t.deleteObjectStore(ah.store)}(t),ch(t)),r=r.next(()=>(function(t){const e=i.store(ah.store),n=new ah(0,0,Vs.min().S(),0);return e.put(ah.key,n)})())),n<4&&s>=4&&(0!==n&&(r=r.next(()=>(function(t,e){return e.store(Za.store).ei().next(n=>{t.deleteObjectStore(Za.store),t.createObjectStore(Za.store,{keyPath:Za.keyPath,autoIncrement:!0}).createIndex(Za.userMutationsIndex,Za.userMutationsKeyPath,{unique:!0});const s=e.store(Za.store),i=n.map(t=>s.put(t));return Ho.Mn(i)})})(t,i))),r=r.next(()=>{!function(t){t.createObjectStore(uh.store,{keyPath:uh.keyPath})}(t)})),n<5&&s>=5&&(r=r.next(()=>this.removeAcknowledgedMutations(i))),n<6&&s>=6&&(r=r.next(()=>((function(t){t.createObjectStore(ih.store)})(t),this.addDocumentGlobal(i)))),n<7&&s>=7&&(r=r.next(()=>this.ensureSequenceNumbers(i))),n<8&&s>=8&&(r=r.next(()=>this.createCollectionParentIndex(t,i))),n<9&&s>=9&&(r=r.next(()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(sh.store);e.createIndex(sh.readTimeIndex,sh.readTimeIndexPath,{unique:!1}),e.createIndex(sh.collectionReadTimeIndex,sh.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&s>=10&&(r=r.next(()=>this.rewriteCanonicalIds(i))),r}addDocumentGlobal(t){let e=0;return t.store(sh.store).ri((t,n)=>{e+=Ka(n)}).next(()=>{const n=new ih(e);return t.store(ih.store).put(ih.key,n)})}removeAcknowledgedMutations(t){const e=t.store(Ya.store),n=t.store(Za.store);return e.ei().next(e=>Ho.forEach(e,e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.ei(Za.userMutationsIndex,s).next(n=>Ho.forEach(n,n=>{Ts(n.userId===e.userId);const s=La(this.serializer,n);return Ma(t,e.userId,s).next(()=>{})}))}))}ensureSequenceNumbers(t){const e=t.store(oh.store),n=t.store(sh.store);return t.store(ah.store).get(ah.key).next(t=>{const s=[];return n.ri((n,i)=>{const r=new Ms(n),o=function(t){return[0,Ia(r)]}();s.push(e.get(o).next(n=>n?Ho.resolve():(n=>e.put(new oh(0,Ia(n),t.highestListenSequenceNumber)))(r)))}).next(()=>Ho.Mn(s))})}createCollectionParentIndex(t,e){t.createObjectStore(hh.store,{keyPath:hh.keyPath});const n=e.store(hh.store),s=new Wa,i=t=>{if(s.add(t)){const e=t.M(),s=t.k();return n.put({collectionId:e,parent:Ia(s)})}};return e.store(sh.store).ri({ii:!0},(t,e)=>{const n=new Ms(t);return i(n.k())}).next(()=>e.store(th.store).ri({ii:!0},([t,e,n],s)=>{const r=Na(e);return i(r.k())}))}rewriteCanonicalIds(t){const e=t.store(rh.store);return e.ri((t,n)=>{const s=Oa(n),i=Pa(this.serializer,s);return e.put(i)})}}class Ja{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class Qa{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}Qa.store="owner",Qa.key="owner";class Ya{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}Ya.store="mutationQueues",Ya.keyPath="userId";class Za{constructor(t,e,n,s,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=s,this.mutations=i}}Za.store="mutations",Za.keyPath="batchId",Za.userMutationsIndex="userMutationsIndex",Za.userMutationsKeyPath=["userId","batchId"];class th{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,Ia(e)]}static key(t,e,n){return[t,Ia(e),n]}}th.store="documentMutations",th.PLACEHOLDER=new th;class eh{constructor(t,e){this.path=t,this.readTime=e}}class nh{constructor(t,e){this.path=t,this.version=e}}class sh{constructor(t,e,n,s,i,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=s,this.readTime=i,this.parentPath=r}}sh.store="remoteDocuments",sh.readTimeIndex="readTimeIndex",sh.readTimeIndexPath="readTime",sh.collectionReadTimeIndex="collectionReadTimeIndex",sh.collectionReadTimeIndexPath=["parentPath","readTime"];class ih{constructor(t){this.byteSize=t}}ih.store="remoteDocumentGlobal",ih.key="remoteDocumentGlobalKey";class rh{constructor(t,e,n,s,i,r,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=s,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=r,this.query=o}}rh.store="targets",rh.keyPath="targetId",rh.queryTargetsIndexName="queryTargetsIndex",rh.queryTargetsKeyPath=["canonicalId","targetId"];class oh{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}oh.store="targetDocuments",oh.keyPath=["targetId","path"],oh.documentTargetsIndex="documentTargetsIndex",oh.documentTargetsKeyPath=["path","targetId"];class ah{constructor(t,e,n,s){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=s}}ah.key="targetGlobalKey",ah.store="targetGlobal";class hh{constructor(t,e){this.collectionId=t,this.parent=e}}function ch(t){t.createObjectStore(oh.store,{keyPath:oh.keyPath}).createIndex(oh.documentTargetsIndex,oh.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(rh.store,{keyPath:rh.keyPath}).createIndex(rh.queryTargetsIndexName,rh.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ah.store)}hh.store="collectionParents",hh.keyPath=["collectionId","parent"];class uh{constructor(t,e,n,s){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=s}}uh.store="clientMetadata",uh.keyPath="clientId";const lh=[...[...[...[Ya.store,Za.store,th.store,sh.store,rh.store,Qa.store,ah.store,oh.store],uh.store],ih.store],hh.store];class fh{constructor(){this.so=new Wa}yr(t,e){if(!this.so.has(e)){const n=e.M(),s=e.k();t.Jn(()=>{this.so.add(e)});const i={collectionId:n,parent:Ia(s)};return dh(t).put(i)}return Ho.resolve()}fs(t,e){const n=[],s=IDBKeyRange.bound([e,""],[Os(e),""],!1,!0);return dh(t).ei(s).next(t=>{for(const s of t){if(s.collectionId!==e)break;n.push(Na(s.parent))}return n})}}function dh(t){return Eh.Ks(t,hh.store)}class ph{constructor(t){this.io=t}next(){return this.io+=2,this.io}static ro(){return new ph(0)}static oo(){return new ph(-1)}}class gh{constructor(t,e){this.Ar=t,this.serializer=e}ao(t){return this.co(t).next(e=>{const n=new ph(e.highestTargetId);return e.highestTargetId=n.next(),this.uo(t,e).next(()=>e.highestTargetId)})}ho(t){return this.co(t).next(t=>Vs.g(new Ps(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}lo(t){return this.co(t).next(t=>t.highestListenSequenceNumber)}_o(t,e,n){return this.co(t).next(s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.S()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.uo(t,s)))}fo(t,e){return this.do(t,e).next(()=>this.co(t).next(n=>(n.targetCount+=1,this.wo(e,n),this.uo(t,n))))}Eo(t,e){return this.do(t,e)}To(t,e){return this.Io(t,e.targetId).next(()=>mh(t).delete(e.targetId)).next(()=>this.co(t)).next(e=>(Ts(e.targetCount>0),e.targetCount-=1,this.uo(t,e)))}dr(t,e,n){let s=0;const i=[];return mh(t).ri((r,o)=>{const a=Oa(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(s++,i.push(this.To(t,a)))}).next(()=>Ho.Mn(i)).next(()=>s)}Me(t,e){return mh(t).ri((t,n)=>{const s=Oa(n);e(s)})}co(t){return yh(t).get(ah.key).next(t=>(Ts(null!==t),t))}uo(t,e){return yh(t).put(ah.key,e)}do(t,e){return mh(t).put(Pa(this.serializer,e))}wo(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}mo(t){return this.co(t).next(t=>t.targetCount)}Ao(t,e){const n=Xs(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let i=null;return mh(t).ri({range:s,index:rh.queryTargetsIndexName},(t,n,s)=>{const r=Oa(n);Js(e,r.target)&&(i=r,s.done())}).next(()=>i)}Ro(t,e,n){const s=[],i=wh(t);return e.forEach(e=>{const r=Ia(e.path);s.push(i.put(new oh(n,r))),s.push(this.Ar.Po(t,n,e))}),Ho.Mn(s)}Vo(t,e,n){const s=wh(t);return Ho.forEach(e,e=>{const i=Ia(e.path);return Ho.Mn([s.delete([n,i]),this.Ar.yo(t,n,e)])})}Io(t,e){const n=wh(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}po(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=wh(t);let i=yi();return s.ri({range:n,ii:!0},(t,e,n)=>{const s=Na(t[1]),r=new Gs(s);i=i.add(r)}).next(()=>i)}Mr(t,e){const n=Ia(e.path),s=IDBKeyRange.bound([n],[Os(n)],!1,!0);let i=0;return wh(t).ri({index:oh.documentTargetsIndex,ii:!0,range:s},([t,e],n,s)=>{0!==t&&(i++,s.done())}).next(()=>i>0)}ze(t,e){return mh(t).get(e).next(t=>t?Oa(t):null)}}function mh(t){return Eh.Ks(t,rh.store)}function yh(t){return Eh.Ks(t,ah.store)}function wh(t){return Eh.Ks(t,oh.store)}const vh="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class bh extends Jo{constructor(t,e){super(),this.xr=t,this.bo=e}}class Eh{constructor(t,e,n,s,i,r,o,a,h,c){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.gs=i,this.window=r,this.document=o,this.vo=h,this.So=c,this.Do=null,this.Co=!1,this.isPrimary=!1,this.networkEnabled=!0,this.No=null,this.inForeground=!1,this.xo=null,this.Oo=null,this.ko=Number.NEGATIVE_INFINITY,this.Fo=(t=>Promise.resolve()),!Eh.qs())throw new xs(As.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.Ar=new Th(this,s),this.Mo=e+"main",this.serializer=new Aa(a),this.$o=new na(this.Mo,10,new Xa(this.serializer)),this.Lo=new gh(this.Ar,this.serializer),this.ts=new fh,this.Xn=new ja(this.serializer,this.ts),this.window&&this.window.localStorage?this.qo=this.window.localStorage:(this.qo=null,!1===c&&bs("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}static Ks(t,e){if(t instanceof bh)return na.Ks(t.xr,e);throw _s()}start(){return this.Bo().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new xs(As.FAILED_PRECONDITION,vh);return this.Uo(),this.Wo(),this.Ko(),this.runTransaction("getHighestListenSequenceNumber","readonly",t=>this.Lo.lo(t))}).then(t=>{this.Do=new Zo(t,this.vo)}).then(()=>{this.Co=!0}).catch(t=>(this.$o&&this.$o.close(),Promise.reject(t)))}Qo(t){return this.Fo=(async e=>{if(this.or)return t(e)}),t(this.isPrimary)}jo(t){this.$o.Gs(async e=>{null===e.newVersion&&await t()})}Go(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.gs.di(async()=>{this.or&&await this.Bo()}))}Bo(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",t=>_h(t).put(new uh(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next(()=>{if(this.isPrimary)return this.zo(t).next(t=>{t||(this.isPrimary=!1,this.gs.Si(()=>this.Fo(!1)))})}).next(()=>this.Ho(t)).next(e=>this.isPrimary&&!e?this.Jo(t).next(()=>!1):!!e&&this.Yo(t).next(()=>!0))).catch(t=>{if(ra(t))return vs("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return vs("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1}).then(t=>{this.isPrimary!==t&&this.gs.Si(()=>this.Fo(t)),this.isPrimary=t})}zo(t){return Ih(t).get(Qa.key).next(t=>Ho.resolve(this.Xo(t)))}Zo(t){return _h(t).delete(this.clientId)}async ta(){if(this.isPrimary&&!this.ea(this.ko,18e5)){this.ko=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{const e=Eh.Ks(t,uh.store);return e.ei().next(t=>{const n=this.na(t,18e5),s=t.filter(t=>-1===n.indexOf(t));return Ho.forEach(s,t=>e.delete(t.clientId)).next(()=>s)})}).catch(()=>[]);if(this.qo)for(const e of t)this.qo.removeItem(this.sa(e.clientId))}}Ko(){this.Oo=this.gs.ks("client_metadata_refresh",4e3,()=>this.Bo().then(()=>this.ta()).then(()=>this.Ko()))}Xo(t){return!!t&&t.ownerId===this.clientId}Ho(t){return this.So?Ho.resolve(!0):Ih(t).get(Qa.key).next(e=>{if(null!==e&&this.ea(e.leaseTimestampMs,5e3)&&!this.ia(e.ownerId)){if(this.Xo(e)&&this.networkEnabled)return!0;if(!this.Xo(e)){if(!e.allowTabSynchronization)throw new xs(As.FAILED_PRECONDITION,vh);return!1}}return!(!this.networkEnabled||!this.inForeground)||_h(t).ei().next(t=>void 0===this.na(t,5e3).find(t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&vs("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}async ra(){this.Co=!1,this.oa(),this.Oo&&(this.Oo.cancel(),this.Oo=null),this.aa(),this.ca(),await this.$o.runTransaction("readwrite",[Qa.store,uh.store],t=>{const e=new bh(t,Zo.Vs);return this.Jo(e).next(()=>this.Zo(e))}),this.$o.close(),this.ua()}na(t,e){return t.filter(t=>this.ea(t.updateTimeMs,e)&&!this.ia(t.clientId))}ha(){return this.runTransaction("getActiveClients","readonly",t=>_h(t).ei().next(t=>this.na(t,18e5).map(t=>t.clientId)))}get or(){return this.Co}la(t){return Va.Pr(t,this.serializer,this.ts,this.Ar)}_a(){return this.Lo}fa(){return this.Xn}da(){return this.ts}runTransaction(t,e,n){vs("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite";let i;return this.$o.runTransaction(s,lh,s=>(i=new bh(s,this.Do?this.Do.next():Zo.Vs),"readwrite-primary"===e?this.zo(i).next(t=>!!t||this.Ho(i)).next(e=>{if(!e)throw bs(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.gs.Si(()=>this.Fo(!1)),new xs(As.FAILED_PRECONDITION,Xo);return n(i)}).next(t=>this.Yo(i).next(()=>t)):this.wa(i).next(()=>n(i)))).then(t=>(i.Yn(),t))}wa(t){return Ih(t).get(Qa.key).next(t=>{if(null!==t&&this.ea(t.leaseTimestampMs,5e3)&&!this.ia(t.ownerId)&&!this.Xo(t)&&!(this.So||this.allowTabSynchronization&&t.allowTabSynchronization))throw new xs(As.FAILED_PRECONDITION,vh)})}Yo(t){const e=new Qa(this.clientId,this.allowTabSynchronization,Date.now());return Ih(t).put(Qa.key,e)}static qs(){return na.qs()}Jo(t){const e=Ih(t);return e.get(Qa.key).next(t=>this.Xo(t)?(vs("IndexedDbPersistence","Releasing primary lease."),e.delete(Qa.key)):Ho.resolve())}ea(t,e){const n=Date.now();return!(t<n-e||t>n&&(bs(`Detected an update time that is in the future: ${t} > ${n}`),1))}Uo(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.xo=(()=>{this.gs.di(()=>(this.inForeground="visible"===this.document.visibilityState,this.Bo()))}),this.document.addEventListener("visibilitychange",this.xo),this.inForeground="visible"===this.document.visibilityState)}aa(){this.xo&&(this.document.removeEventListener("visibilitychange",this.xo),this.xo=null)}Wo(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.No=(()=>{this.oa(),this.gs.di(()=>this.ra())}),this.window.addEventListener("unload",this.No))}ca(){this.No&&(this.window.removeEventListener("unload",this.No),this.No=null)}ia(t){var e;try{const n=null!==(null===(e=this.qo)||void 0===e?void 0:e.getItem(this.sa(t)));return vs("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return bs("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}oa(){if(this.qo)try{this.qo.setItem(this.sa(this.clientId),String(Date.now()))}catch(t){bs("Failed to set zombie client id.",t)}}ua(){if(this.qo)try{this.qo.removeItem(this.sa(this.clientId))}catch(t){}}sa(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function Ih(t){return Eh.Ks(t,Qa.store)}function _h(t){return Eh.Ks(t,uh.store)}class Th{constructor(t,e){this.db=t,this.nr=new Ea(this,e)}hr(t){const e=this.Ea(t);return this.db._a().mo(t).next(t=>e.next(e=>t+e))}Ea(t){let e=0;return this._r(t,t=>{e++}).next(()=>e)}Me(t,e){return this.db._a().Me(t,e)}_r(t,e){return this.Ta(t,(t,n)=>e(n))}Po(t,e,n){return Nh(t,n)}yo(t,e,n){return Nh(t,n)}dr(t,e,n){return this.db._a().dr(t,e,n)}kr(t,e){return Nh(t,e)}Ia(t,e){return function(t,e){let n=!1;return Ga(t).oi(s=>Ua(t,s,e).next(t=>(t&&(n=!0),Ho.resolve(!t)))).next(()=>n)}(t,e)}wr(t,e){const n=this.db.fa().Jr(),s=[];let i=0;return this.Ta(t,(r,o)=>{if(o<=e){const e=this.Ia(t,r).next(e=>{if(!e)return i++,n.Qn(t,r).next(()=>(n.Kn(r),wh(t).delete([0,Ia(r.path)])))});s.push(e)}}).next(()=>Ho.Mn(s)).next(()=>n.apply(t)).next(()=>i)}removeTarget(t,e){const n=e.ht(t.bo);return this.db._a().Eo(t,n)}ma(t,e){return Nh(t,e)}Ta(t,e){const n=wh(t);let s,i=Zo.Vs;return n.ri({index:oh.documentTargetsIndex},([t,n],{path:r,sequenceNumber:o})=>{0===t?(i!==Zo.Vs&&e(new Gs(Na(s)),i),i=o,s=r):i=Zo.Vs}).next(()=>{i!==Zo.Vs&&e(new Gs(Na(s)),i)})}Tr(t){return this.db.fa().Zr(t)}}function Nh(t,e){return wh(t).put(function(t,e){return new oh(0,Ia(t.path),e)}(e,t.bo))}function Ah(t,e){let n=t.projectId;return t.st||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}async function xh(t){if(!na.qs())return Promise.resolve();const e=t+"main";await na.delete(e)}class Sh{constructor(t,e,n){this.persistence=t,this.Aa=e,this.Ra=new ri(Rs),this.Pa=new Ko(t=>Xs(t),Js),this.Va=Vs.min(),this.Zn=t.la(n),this.ga=t.fa(),this.Lo=t._a(),this.ya=new Qo(this.ga,this.Zn,this.persistence.da()),this.Aa.pa(this.ya)}ar(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.Er(e,this.Ra))}}async function kh(t,e){const n=Ns(t);let s=n.Zn,i=n.ya;const r=await n.persistence.runTransaction("Handle user change","readonly",t=>{let r;return n.Zn.Dr(t).next(o=>(r=o,s=n.persistence.la(e),i=new Qo(n.ga,s,n.persistence.da()),s.Dr(t))).next(e=>{const n=[],s=[];let o=yi();for(const t of r){n.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return i.os(t,o).next(t=>({ba:t,va:n,Sa:s}))})});return n.Zn=s,n.ya=i,n.Aa.pa(n.ya),r}function Dh(t){const e=Ns(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Lo.ho(t))}function Ch(t,e){const n=Ns(t);return n.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===e&&(e=-1),n.Zn.vr(t,e)))}function Rh(t,e){const n=Ns(t);return n.persistence.runTransaction("Allocate target","readwrite",t=>{let s;return n.Lo.Ao(t,e).next(i=>i?(s=i,Ho.resolve(s)):n.Lo.ao(t).next(i=>(s=new Zs(e,i,0,t.bo),n.Lo.fo(t,s).next(()=>s))))}).then(t=>{const s=n.Ra.get(t.targetId);return(null===s||t.ut.p(s.ut)>0)&&(n.Ra=n.Ra.ft(t.targetId,t),n.Pa.set(e,t.targetId)),t})}async function Lh(t,e,n){const s=Ns(t),i=s.Ra.get(e),r=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",r,t=>s.persistence.Ar.removeTarget(t,i))}catch(t){if(!ra(t))throw t;vs("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.Ra=s.Ra.remove(e),s.Pa.delete(i.target)}function Oh(t,e,n){const s=Ns(t);let i=Vs.min(),r=yi();return s.persistence.runTransaction("Execute query","readonly",t=>(function(t,e,n){const s=Ns(t),i=s.Pa.get(n);return void 0!==i?Ho.resolve(s.Ra.get(i)):s.Lo.Ao(e,n)})(s,t,Io(e)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,s.Lo.po(t,e.targetId).next(t=>{r=t})}).next(()=>s.Aa.us(t,e,n?i:Vs.min(),n?r:yi())).next(t=>({documents:t,Da:r})))}function Ph(t,e){const n=Ns(t),s=Ns(n.Lo),i=n.Ra.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",t=>s.ze(t,e).next(t=>t?t.target:null))}async function Vh(t){if(t.code!==As.FAILED_PRECONDITION||t.message!==Xo)throw t;vs("LocalStore","Unexpectedly lost primary lease")}class Uh{constructor(t,e,n,s,i,r){this.gs=t,this.Ca=n,this.Na=s,this.xa=i,this.listener=r,this.state=0,this.Oa=0,this.ka=null,this.stream=null,this.Pi=new ea(t,e)}Fa(){return 1===this.state||2===this.state||4===this.state}Ma(){return 2===this.state}start(){3!==this.state?this.auth():this.$a()}async stop(){this.Fa()&&await this.close(0)}La(){this.state=0,this.Pi.reset()}qa(){this.Ma()&&null===this.ka&&(this.ka=this.gs.ks(this.Ca,6e4,()=>this.Ba()))}Ua(t){this.Wa(),this.stream.send(t)}async Ba(){if(this.Ma())return this.close(0)}Wa(){this.ka&&(this.ka.cancel(),this.ka=null)}async close(t,e){this.Wa(),this.Pi.cancel(),this.Oa++,3!==t?this.Pi.reset():e&&e.code===As.RESOURCE_EXHAUSTED?(bs(e.toString()),bs("Using maximum backoff delay to prevent overloading the backend."),this.Pi.Ns()):e&&e.code===As.UNAUTHENTICATED&&this.xa.m(),null!==this.stream&&(this.Ka(),this.stream.close(),this.stream=null),this.state=t,await this.listener.Qa(e)}Ka(){}auth(){this.state=1;const t=this.ja(this.Oa),e=this.Oa;this.xa.getToken().then(t=>{this.Oa===e&&this.Ga(t)},e=>{t(()=>{const t=new xs(As.UNKNOWN,"Fetching auth token failed: "+e.message);return this.za(t)})})}Ga(t){const e=this.ja(this.Oa);this.stream=this.Ha(t),this.stream.Ja(()=>{e(()=>(this.state=2,this.listener.Ja()))}),this.stream.Qa(t=>{e(()=>this.za(t))}),this.stream.onMessage(t=>{e(()=>this.onMessage(t))})}$a(){this.state=4,this.Pi.xs(async()=>{this.state=0,this.start()})}za(t){return vs("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)}ja(t){return e=>{this.gs.di(()=>this.Oa===t?e():(vs("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Mh extends Uh{constructor(t,e,n,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i),this.serializer=s}Ha(t){return this.Na.Ya("Listen",t)}onMessage(t){this.Pi.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:_s()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],r=function(t,e){return t.He?(Ts(void 0===e||"string"==typeof e),Ys.fromBase64String(e||"")):(Ts(void 0===e||e instanceof Uint8Array),Ys.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?As.UNKNOWN:ii(t.code);return new xs(e,t.message||"")}(o);n=new xi(s,i,r,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const i=lr(t,s.document.name),r=ar(s.document.updateTime),o=new io({mapValue:{fields:s.document.fields}}),a=new ho(i,r,o,{}),h=s.targetIds||[],c=s.removedTargetIds||[];n=new Ni(h,c,a.key,a)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const i=lr(t,s.document),r=s.readTime?ar(s.readTime):Vs.min(),o=new co(i,r),a=s.removedTargetIds||[];n=new Ni([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const i=lr(t,s.document),r=s.removedTargetIds||[];n=new Ni([],r,i,null)}else{if(!("filter"in e))return _s();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,i=new ti(s),r=t.targetId;n=new Ai(r,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Vs.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Vs.min():e.readTime?ar(e.readTime):Vs.min()}(t);return this.listener.Xa(e,n)}Za(t){const e={};e.database=pr(this.serializer),e.addTarget=function(t,e){let n;const s=e.target;return(n=Qs(s)?{documents:vr(t,s)}:{query:br(t,s)}).targetId=e.targetId,e.resumeToken.ot()>0&&(n.resumeToken=or(t,e.resumeToken)),n}(this.serializer,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return _s()}}(0,e.ct);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Ua(e)}tc(t){const e={};e.database=pr(this.serializer),e.removeTarget=t,this.Ua(e)}}class qh extends Uh{constructor(t,e,n,s,i){super(t,"write_stream_connection_backoff","write_stream_idle",e,n,i),this.serializer=s,this.ec=!1}get nc(){return this.ec}start(){this.ec=!1,this.lastStreamToken=void 0,super.start()}Ka(){this.ec&&this.sc([])}Ha(t){return this.Na.Ya("Write",t)}onMessage(t){if(Ts(!!t.streamToken),this.lastStreamToken=t.streamToken,this.ec){this.Pi.reset();const e=function(t,e){return t&&t.length>0?(Ts(void 0!==e),t.map(t=>(function(t,e){let n=t.updateTime?ar(t.updateTime):ar(e);n.isEqual(Vs.min())&&(n=ar(e));let s=null;return t.transformResults&&t.transformResults.length>0&&(s=t.transformResults),new Gr(n,s)})(t,e))):[]}(t.writeResults,t.commitTime),n=ar(t.commitTime);return this.listener.ic(n,e)}return Ts(!t.writeResults||0===t.writeResults.length),this.ec=!0,this.listener.rc()}oc(){const t={};t.database=pr(this.serializer),this.Ua(t)}sc(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>yr(this.serializer,t))};this.Ua(e)}}class Fh extends class{}{constructor(t,e,n){super(),this.credentials=t,this.Na=e,this.serializer=n,this.ac=!1}cc(){if(this.ac)throw new xs(As.FAILED_PRECONDITION,"The client has already been terminated.")}uc(t,e,n){return this.cc(),this.credentials.getToken().then(s=>this.Na.uc(t,e,n,s)).catch(t=>{throw t.code===As.UNAUTHENTICATED&&this.credentials.m(),t})}hc(t,e,n){return this.cc(),this.credentials.getToken().then(s=>this.Na.hc(t,e,n,s)).catch(t=>{throw t.code===As.UNAUTHENTICATED&&this.credentials.m(),t})}terminate(){this.ac=!1}}function Gh(t,e,n){return new Fh(t,e,n)}class jh{constructor(t,e){this.ai=t,this.lc=e,this.state="Unknown",this._c=0,this.fc=null,this.dc=!0}wc(){0===this._c&&(this.Ec("Unknown"),this.fc=this.ai.ks("online_state_timeout",1e4,()=>(this.fc=null,this.Tc("Backend didn't respond within 10 seconds."),this.Ec("Offline"),Promise.resolve())))}Ic(t){"Online"===this.state?this.Ec("Unknown"):(this._c++,this._c>=1&&(this.mc(),this.Tc("Connection failed 1 times. Most recent error: "+t.toString()),this.Ec("Offline")))}set(t){this.mc(),this._c=0,"Online"===t&&(this.dc=!1),this.Ec(t)}Ec(t){t!==this.state&&(this.state=t,this.lc(t))}Tc(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.dc?(bs(e),this.dc=!1):vs("OnlineStateTracker",e)}mc(){null!==this.fc&&(this.fc.cancel(),this.fc=null)}}class $h{constructor(t,e,n,s,i){this.Ac=t,this.Rc=e,this.ai=n,this.Pc=[],this.Vc=new Map,this.gc=null,this.yc=new Set,this.pc={},this.bc=i,this.bc.vc(t=>{n.di(async()=>{this.Sc()&&(vs("RemoteStore","Restarting streams for network reachability change."),await this.Dc())})}),this.Cc=new jh(n,s),this.Nc=function(t,e,n){const s=Ns(t);return s.cc(),new Mh(e,s.Na,s.credentials,s.serializer,n)}(this.Rc,n,{Ja:this.xc.bind(this),Qa:this.Oc.bind(this),Xa:this.kc.bind(this)}),this.Fc=function(t,e,n){const s=Ns(t);return s.cc(),new qh(e,s.Na,s.credentials,s.serializer,n)}(this.Rc,n,{Ja:this.Mc.bind(this),Qa:this.$c.bind(this),rc:this.Lc.bind(this),ic:this.ic.bind(this)})}start(){return this.enableNetwork()}enableNetwork(){return this.yc.delete(0),this.qc()}async qc(){this.Sc()&&(this.Bc()?this.Uc():this.Cc.set("Unknown"),await this.Wc())}async disableNetwork(){this.yc.add(0),await this.Kc(),this.Cc.set("Offline")}async Kc(){await this.Fc.stop(),await this.Nc.stop(),this.Pc.length>0&&(vs("RemoteStore",`Stopping write stream with ${this.Pc.length} pending writes`),this.Pc=[]),this.Qc()}async ra(){vs("RemoteStore","RemoteStore shutting down."),this.yc.add(5),await this.Kc(),this.bc.ra(),this.Cc.set("Unknown")}listen(t){this.Vc.has(t.targetId)||(this.Vc.set(t.targetId,t),this.Bc()?this.Uc():this.Nc.Ma()&&this.jc(t))}Gc(t){this.Vc.delete(t),this.Nc.Ma()&&this.zc(t),0===this.Vc.size&&(this.Nc.Ma()?this.Nc.qa():this.Sc()&&this.Cc.set("Unknown"))}ze(t){return this.Vc.get(t)||null}Ge(t){return this.pc.Ge(t)}jc(t){this.gc.ye(t.targetId),this.Nc.Za(t)}zc(t){this.gc.ye(t),this.Nc.tc(t)}Uc(){this.gc=new ki(this),this.Nc.start(),this.Cc.wc()}Bc(){return this.Sc()&&!this.Nc.Fa()&&this.Vc.size>0}Sc(){return 0===this.yc.size}Qc(){this.gc=null}async xc(){this.Vc.forEach((t,e)=>{this.jc(t)})}async Oc(t){this.Qc(),this.Bc()?(this.Cc.Ic(t),this.Uc()):this.Cc.set("Unknown")}async kc(t,e){if(this.Cc.set("Online"),t instanceof xi&&2===t.state&&t.cause)try{await this.Hc(t)}catch(e){vs("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),e),await this.Jc(e)}else if(t instanceof Ni?this.gc.xe(t):t instanceof Ai?this.gc.Be(t):this.gc.Fe(t),!e.isEqual(Vs.min()))try{const n=await Dh(this.Ac);e.p(n)>=0&&await this.Yc(e)}catch(t){vs("RemoteStore","Failed to raise snapshot:",t),await this.Jc(t)}}async Jc(t,e){if(!ra(t))throw t;this.yc.add(1),await this.Kc(),this.Cc.set("Offline"),e||(e=(()=>Dh(this.Ac))),this.ai.Si(async()=>{vs("RemoteStore","Retrying IndexedDB access"),await e(),this.yc.delete(1),await this.qc()})}Xc(t){return t().catch(e=>this.Jc(e,t))}Yc(t){const e=this.gc.Ke(t);return e.te.forEach((e,n)=>{if(e.resumeToken.ot()>0){const s=this.Vc.get(n);s&&this.Vc.set(n,s.lt(e.resumeToken,t))}}),e.ee.forEach(t=>{const e=this.Vc.get(t);if(!e)return;this.Vc.set(t,e.lt(Ys.at,e.ut)),this.zc(t);const n=new Zs(e.target,t,1,e.sequenceNumber);this.jc(n)}),this.pc.Zc(e)}async Hc(t){const e=t.cause;for(const n of t.targetIds)this.Vc.has(n)&&(await this.pc.tu(n,e),this.Vc.delete(n),this.gc.removeTarget(n))}async Wc(){let t=this.Pc.length>0?this.Pc[this.Pc.length-1].batchId:-1;for(;this.eu();)try{const e=await Ch(this.Ac,t);if(null===e){0===this.Pc.length&&this.Fc.qa();break}t=e.batchId,this.nu(e)}catch(t){await this.Jc(t)}this.su()&&this.iu()}eu(){return this.Sc()&&this.Pc.length<10}ru(){return this.Pc.length}nu(t){this.Pc.push(t),this.Fc.Ma()&&this.Fc.nc&&this.Fc.sc(t.mutations)}su(){return this.Sc()&&!this.Fc.Fa()&&this.Pc.length>0}iu(){this.Fc.start()}async Mc(){this.Fc.oc()}async Lc(){for(const t of this.Pc)this.Fc.sc(t.mutations)}async ic(t,e){const n=this.Pc.shift(),s=zo.from(n,t,e);await this.Xc(()=>this.pc.ou(s)),await this.Wc()}async $c(t){t&&this.Fc.nc&&await this.au(t),this.su()&&this.iu()}async au(t){if(si(e=t.code)&&e!==As.ABORTED){const e=this.Pc.shift();this.Fc.La(),await this.Xc(()=>this.pc.cu(e.batchId,t)),await this.Wc()}var e}async Dc(){this.yc.add(4),await this.Kc(),this.Cc.set("Unknown"),this.Fc.La(),this.Nc.La(),this.yc.delete(4),await this.qc()}async uu(t){this.ai.Ni(),vs("RemoteStore","RemoteStore received new credentials");const e=this.Sc();this.yc.add(3),await this.Kc(),e&&this.Cc.set("Unknown"),await this.pc.uu(t),this.yc.delete(3),await this.qc()}async hu(t){t?(this.yc.delete(2),await this.qc()):t||(this.yc.add(2),await this.Kc(),this.Cc.set("Unknown"))}}class Bh{constructor(){this.lu=void 0,this.listeners=[]}}class zh{constructor(){this._u=new Ko(t=>To(t),_o),this.onlineState="Unknown",this.fu=new Set}}function Kh(t){t.fu.forEach(t=>{t.next()})}class Hh{constructor(t,e,n){this.query=t,this.Eu=e,this.Tu=!1,this.Iu=null,this.onlineState="Unknown",this.options=n||{}}du(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Ii(t.query,t.docs,t.Ht,e,t.Jt,t.fromCache,t.Yt,!0)}let e=!1;return this.Tu?this.mu(t)&&(this.Eu.next(t),e=!0):this.Au(t,this.onlineState)&&(this.Ru(t),e=!0),this.Iu=t,e}onError(t){this.Eu.error(t)}wu(t){this.onlineState=t;let e=!1;return this.Iu&&!this.Tu&&this.Au(this.Iu,t)&&(this.Ru(this.Iu),e=!0),e}Au(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.Pu&&n||t.docs.$()&&"Offline"!==e)}mu(t){if(t.docChanges.length>0)return!0;const e=this.Iu&&this.Iu.hasPendingWrites!==t.hasPendingWrites;return!(!t.Yt&&!e)&&!0===this.options.includeMetadataChanges}Ru(t){t=Ii.Zt(t.query,t.docs,t.Jt,t.fromCache),this.Tu=!0,this.Eu.next(t)}}class Wh{constructor(){this.Vu=new hi(Xh.gu),this.yu=new hi(Xh.pu)}$(){return this.Vu.$()}Po(t,e){const n=new Xh(t,e);this.Vu=this.Vu.add(n),this.yu=this.yu.add(n)}bu(t,e){t.forEach(t=>this.Po(t,e))}yo(t,e){this.vu(new Xh(t,e))}Su(t,e){t.forEach(t=>this.yo(t,e))}Du(t){const e=new Gs(new Ms([])),n=new Xh(e,t),s=new Xh(e,t+1),i=[];return this.yu.Lt([n,s],t=>{this.vu(t),i.push(t.key)}),i}Cu(){this.Vu.forEach(t=>this.vu(t))}vu(t){this.Vu=this.Vu.delete(t),this.yu=this.yu.delete(t)}Nu(t){const e=new Gs(new Ms([])),n=new Xh(e,t),s=new Xh(e,t+1);let i=yi();return this.yu.Lt([n,s],t=>{i=i.add(t.key)}),i}Mr(t){const e=new Xh(t,0),n=this.Vu.Bt(e);return null!==n&&t.isEqual(n.key)}}class Xh{constructor(t,e){this.key=t,this.xu=e}static gu(t,e){return Gs.C(t.key,e.key)||Rs(t.xu,e.xu)}static pu(t,e){return Rs(t.xu,e.xu)||Gs.C(t.key,e.key)}}function Jh(t,e){return`firestore_clients_${t}_${e}`}function Qh(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.t()&&(s+="_"+e.uid),s}function Yh(t,e){return`firestore_targets_${t}_${e}`}class Zh{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static Ou(t,e,n){const s=JSON.parse(n);let i="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error),r=void 0;return i&&s.error&&((i="string"==typeof s.error.message&&"string"==typeof s.error.code)&&(r=new xs(s.error.code,s.error.message))),i?new Zh(t,e,s.state,r):(bs("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}ku(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class tc{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Ou(t,e){const n=JSON.parse(e);let s="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return s&&n.error&&((s="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new xs(n.error.code,n.error.message))),s?new tc(t,n.state,i):(bs("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}ku(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class ec{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Ou(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,i=vi();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=Ks(n.activeTargetIds[t]),i=i.add(n.activeTargetIds[t]);return s?new ec(t,i):(bs("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class nc{constructor(t,e){this.clientId=t,this.onlineState=e}static Ou(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new nc(e.clientId,e.onlineState):(bs("SharedClientState","Failed to parse online state: "+t),null)}}class sc{constructor(){this.activeTargetIds=vi()}Fu(t){this.activeTargetIds=this.activeTargetIds.add(t)}Mu(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ku(){const t={activeTargetIds:this.activeTargetIds.B(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class ic{constructor(t,e,n,s,i){this.window=t,this.gs=e,this.persistenceKey=n,this.$u=s,this.Lu=null,this.lc=null,this.ms=null,this.qu=this.Bu.bind(this),this.Uu=new ri(Rs),this.or=!1,this.Wu=[];const r=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Ku=Jh(this.persistenceKey,this.$u),this.Qu=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Uu=this.Uu.ft(this.$u,new sc),this.ju=new RegExp(`^firestore_clients_${r}_([^_]*)$`),this.Gu=new RegExp(`^firestore_mutations_${r}_(\\d+)(?:_(.*))?$`),this.zu=new RegExp(`^firestore_targets_${r}_(\\d+)$`),this.Hu=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.qu)}static qs(t){return!(!t||!t.localStorage)}async start(){const t=await this.Lu.ha();for(const e of t){if(e===this.$u)continue;const t=this.getItem(Jh(this.persistenceKey,e));if(t){const n=ec.Ou(e,t);n&&(this.Uu=this.Uu.ft(n.clientId,n))}}this.Ju();const e=this.storage.getItem(this.Hu);if(e){const t=this.Yu(e);t&&this.Xu(t)}for(const t of this.Wu)this.Bu(t);this.Wu=[],this.window.addEventListener("unload",()=>this.ra()),this.or=!0}Ps(t){this.setItem(this.Qu,JSON.stringify(t))}Zu(){return this.th(this.Uu)}eh(t){let e=!1;return this.Uu.forEach((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)}),e}nh(t){this.sh(t,"pending")}ih(t,e,n){this.sh(t,e,n),this.rh(t)}oh(t){let e="not-current";if(this.eh(t)){const n=this.storage.getItem(Yh(this.persistenceKey,t));if(n){const s=tc.Ou(t,n);s&&(e=s.state)}}return this.ah.Fu(t),this.Ju(),e}uh(t){this.ah.Mu(t),this.Ju()}hh(t){return this.ah.activeTargetIds.has(t)}lh(t){this.removeItem(Yh(this.persistenceKey,t))}_h(t,e,n){this.fh(t,e,n)}dh(t,e,n){e.forEach(t=>{this.rh(t)}),this.currentUser=t,n.forEach(t=>{this.nh(t)})}wh(t){this.Eh(t)}ra(){this.or&&(this.window.removeEventListener("storage",this.qu),this.removeItem(this.Ku),this.or=!1)}getItem(t){const e=this.storage.getItem(t);return vs("SharedClientState","READ",t,e),e}setItem(t,e){vs("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){vs("SharedClientState","REMOVE",t),this.storage.removeItem(t)}Bu(t){const e=t;if(e.storageArea===this.storage){if(vs("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Ku)return void bs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.gs.Si(async()=>{if(this.or){if(null!==e.key)if(this.ju.test(e.key)){if(null==e.newValue){const t=this.Th(e.key);return this.Ih(t,null)}{const t=this.mh(e.key,e.newValue);if(t)return this.Ih(t.clientId,t)}}else if(this.Gu.test(e.key)){if(null!==e.newValue){const t=this.Ah(e.key,e.newValue);if(t)return this.Rh(t)}}else if(this.zu.test(e.key)){if(null!==e.newValue){const t=this.Ph(e.key,e.newValue);if(t)return this.Vh(t)}}else if(e.key===this.Hu){if(null!==e.newValue){const t=this.Yu(e.newValue);if(t)return this.Xu(t)}}else if(e.key===this.Qu){const t=function(t){let e=Zo.Vs;if(null!=t)try{const n=JSON.parse(t);Ts("number"==typeof n),e=n}catch(t){bs("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==Zo.Vs&&this.ms(t)}}else this.Wu.push(e)})}}get ah(){return this.Uu.get(this.$u)}Ju(){this.setItem(this.Ku,this.ah.ku())}sh(t,e,n){const s=new Zh(this.currentUser,t,e,n),i=Qh(this.persistenceKey,this.currentUser,t);this.setItem(i,s.ku())}rh(t){const e=Qh(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Eh(t){const e={clientId:this.$u,onlineState:t};this.storage.setItem(this.Hu,JSON.stringify(e))}fh(t,e,n){const s=Yh(this.persistenceKey,t),i=new tc(t,e,n);this.setItem(s,i.ku())}Th(t){const e=this.ju.exec(t);return e?e[1]:null}mh(t,e){const n=this.Th(t);return ec.Ou(n,e)}Ah(t,e){const n=this.Gu.exec(t),s=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Zh.Ou(new ms(i),s,e)}Ph(t,e){const n=this.zu.exec(t),s=Number(n[1]);return tc.Ou(s,e)}Yu(t){return nc.Ou(t)}async Rh(t){if(t.user.uid===this.currentUser.uid)return this.Lu.gh(t.batchId,t.state,t.error);vs("SharedClientState","Ignoring mutation for non-active user "+t.user.uid)}Vh(t){return this.Lu.yh(t.targetId,t.state,t.error)}Ih(t,e){const n=e?this.Uu.ft(t,e):this.Uu.remove(t),s=this.th(this.Uu),i=this.th(n),r=[],o=[];return i.forEach(t=>{s.has(t)||r.push(t)}),s.forEach(t=>{i.has(t)||o.push(t)}),this.Lu.ph(r,o).then(()=>{this.Uu=n})}Xu(t){this.Uu.get(t.clientId)&&this.lc(t.onlineState)}th(t){let e=vi();return t.forEach((t,n)=>{e=e.Ut(n.activeTargetIds)}),e}}class rc{constructor(){this.bh=new sc,this.vh={},this.lc=null,this.ms=null}nh(t){}ih(t,e,n){}oh(t){return this.bh.Fu(t),this.vh[t]||"not-current"}_h(t,e,n){this.vh[t]=e}uh(t){this.bh.Mu(t)}hh(t){return this.bh.activeTargetIds.has(t)}lh(t){delete this.vh[t]}Zu(){return this.bh.activeTargetIds}eh(t){return this.bh.activeTargetIds.has(t)}start(){return this.bh=new sc,Promise.resolve()}dh(t,e,n){}wh(t){}ra(){}Ps(t){}}class oc{constructor(t){this.key=t}}class ac{constructor(t){this.key=t}}class hc{constructor(t,e){this.query=t,this.Sh=e,this.Dh=null,this.oe=!1,this.Ch=yi(),this.Jt=yi(),this.Nh=xo(t),this.xh=new bi(this.Nh)}get Oh(){return this.Sh}kh(t,e){const n=e?e.Fh:new Ei,s=e?e.xh:this.xh;let i=e?e.Jt:this.Jt,r=s,o=!1;const a=mo(this.query)&&s.size===this.query.limit?s.last():null,h=yo(this.query)&&s.size===this.query.limit?s.first():null;if(t.Tt((t,e)=>{const c=s.get(t);let u=e instanceof ho?e:null;u&&(u=Ao(this.query,u)?u:null);const l=!!c&&this.Jt.has(c.key),f=!!u&&(u.sn||this.Jt.has(u.key)&&u.hasCommittedMutations);let d=!1;c&&u?c.data().isEqual(u.data())?l!==f&&(n.track({type:3,doc:u}),d=!0):this.Mh(c,u)||(n.track({type:2,doc:u}),d=!0,(a&&this.Nh(u,a)>0||h&&this.Nh(u,h)<0)&&(o=!0)):!c&&u?(n.track({type:0,doc:u}),d=!0):c&&!u&&(n.track({type:1,doc:c}),d=!0,(a||h)&&(o=!0)),d&&(u?(r=r.add(u),i=f?i.add(t):i.delete(t)):(r=r.delete(t),i=i.delete(t)))}),mo(this.query)||yo(this.query))for(;r.size>this.query.limit;){const t=mo(this.query)?r.last():r.first();r=r.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{xh:r,Fh:n,$h:o,Jt:i}}Mh(t,e){return t.sn&&e.hasCommittedMutations&&!e.sn}zn(t,e,n){const s=this.xh;this.xh=t.xh,this.Jt=t.Jt;const i=t.Fh.zt();i.sort((t,e)=>(function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return _s()}};return n(t)-n(e)})(t.type,e.type)||this.Nh(t.doc,e.doc)),this.Lh(n);const r=e?this.qh():[],o=0===this.Ch.size&&this.oe?1:0,a=o!==this.Dh;return this.Dh=o,0!==i.length||a?{snapshot:new Ii(this.query,t.xh,s,i,t.Jt,0===o,a,!1),Bh:r}:{Bh:r}}wu(t){return this.oe&&"Offline"===t?(this.oe=!1,this.zn({xh:this.xh,Fh:new Ei,Jt:this.Jt,$h:!1},!1)):{Bh:[]}}Uh(t){return!this.Sh.has(t)&&!!this.xh.has(t)&&!this.xh.get(t).sn}Lh(t){t&&(t.ae.forEach(t=>this.Sh=this.Sh.add(t)),t.ce.forEach(t=>{}),t.ue.forEach(t=>this.Sh=this.Sh.delete(t)),this.oe=t.oe)}qh(){if(!this.oe)return[];const t=this.Ch;this.Ch=yi(),this.xh.forEach(t=>{this.Uh(t.key)&&(this.Ch=this.Ch.add(t.key))});const e=[];return t.forEach(t=>{this.Ch.has(t)||e.push(new ac(t))}),this.Ch.forEach(n=>{t.has(n)||e.push(new oc(n))}),e}Wh(t){this.Sh=t.Da,this.Ch=yi();const e=this.kh(t.documents);return this.zn(e,!0)}Kh(){return Ii.Zt(this.query,this.xh,this.Jt,0===this.Dh)}}class cc{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class uc{constructor(t){this.key=t,this.Qh=!1}}class lc{constructor(t,e,n,s,i){this.Ac=t,this.jh=e,this.Gh=n,this.currentUser=s,this.zh=i,this.Hh=null,this.Jh=new Ko(t=>To(t),_o),this.Yh=new Map,this.Xh=[],this.Zh=new ri(Gs.C),this.tl=new Map,this.el=new Wh,this.nl={},this.sl=new Map,this.il=ph.oo(),this.onlineState="Unknown",this.rl=void 0}get ol(){return!0===this.rl}subscribe(t){this.Hh=t}al(t){}}async function fc(t,e,n,s){t.cl=((e,n,s)=>(async function(t,e,n,s){let i=e.view.kh(n);i.$h&&(i=await Oh(t.Ac,e.query,!1).then(({documents:t})=>e.view.kh(t,i)));const r=s&&s.te.get(e.targetId),o=e.view.zn(i,t.ol,r);return bc(t,e.targetId,o.Bh),o.snapshot})(t,e,n,s));const i=await Oh(t.Ac,e,!0),r=new hc(e,i.Da),o=r.kh(i.documents),a=Ti.re(n,s&&"Offline"!==t.onlineState),h=r.zn(o,t.ol,a);bc(t,n,h.Bh);const c=new cc(e,n,r);return t.Jh.set(e,c),t.Yh.has(n)?t.Yh.get(n).push(e):t.Yh.set(n,[e]),h.snapshot}async function dc(t,e){const n=Ns(t);n.al("applyRemoteEvent()");try{const s=await function(t,e){const n=Ns(t),s=e.ut;let i=n.Ra;return n.persistence.runTransaction("Apply remote event","readwrite-primary",t=>{const r=n.ga.Jr({Xr:!0});i=n.Ra;const o=[];e.te.forEach((e,r)=>{const a=i.get(r);if(!a)return;o.push(n.Lo.Vo(t,e.ue,r).next(()=>n.Lo.Ro(t,e.ae,r)));const h=e.resumeToken;if(h.ot()>0){const c=a.lt(h,s).ht(t.bo);i=i.ft(r,c),function(t,e,n){return Ts(e.resumeToken.ot()>0),0===t.resumeToken.ot()||e.ut.v()-t.ut.v()>=3e8||n.ae.size+n.ce.size+n.ue.size>0}(a,c,e)&&o.push(n.Lo.Eo(t,c))}});let a=li(),h=yi();if(e.ne.forEach((t,e)=>{h=h.add(t)}),o.push(r.getEntries(t,h).next(i=>{e.ne.forEach((h,c)=>{const u=i.get(h);c instanceof co&&c.version.isEqual(Vs.min())?(r.Kn(h,s),a=a.ft(h,c)):null==u||c.version.p(u.version)>0||0===c.version.p(u.version)&&u.hasPendingWrites?(r.Un(c,s),a=a.ft(h,c)):vs("LocalStore","Ignoring outdated watch update for ",h,". Current version:",u.version," Watch version:",c.version),e.se.has(h)&&o.push(n.persistence.Ar.ma(t,h))})})),!s.isEqual(Vs.min())){const e=n.Lo.ho(t).next(e=>n.Lo._o(t,t.bo,s));o.push(e)}return Ho.Mn(o).next(()=>r.apply(t)).next(()=>n.ya.as(t,a))}).then(t=>(n.Ra=i,t))}(n.Ac,e);e.te.forEach((t,e)=>{const s=n.tl.get(e);s&&(Ts(t.ae.size+t.ce.size+t.ue.size<=1),t.ae.size>0?s.Qh=!0:t.ce.size>0?Ts(s.Qh):t.ue.size>0&&(Ts(s.Qh),s.Qh=!1))}),await _c(n,s,e)}catch(t){await Vh(t)}}function pc(t,e,n){const s=Ns(t);if(s.ol&&0===n||!s.ol&&1===n){s.al("applyOnlineStateChange()");const t=[];s.Jh.forEach((n,s)=>{const i=s.view.wu(e);i.snapshot&&t.push(i.snapshot)}),s.Hh.ul(e),s.Hh.Xa(t),s.onlineState=e,s.ol&&s.Gh.wh(e)}}async function gc(t,e){const n=Ns(t);n.al("applySuccessfulWrite()");const s=e.batch.batchId;try{const i=await function(t,e){const n=Ns(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",t=>{const s=e.batch.keys(),i=n.ga.Jr({Xr:!0});return function(t,e,n,s){const i=n.batch,r=i.keys();let o=Ho.resolve();return r.forEach(t=>{o=o.next(()=>s.Qn(e,t)).next(e=>{let r=e;const o=n.yn.get(t);Ts(null!==o),(!r||r.version.p(o)<0)&&(r=i.An(t,r,n))&&s.Un(r,n.gn)})}),o.next(()=>t.Zn.Nr(e,i))}(n,t,e,i).next(()=>i.apply(t)).next(()=>n.Zn.Fr(t)).next(()=>n.ya.os(t,s))})}(n.Ac,e);yc(n,s,null),mc(n,s),n.Gh.ih(s,"acknowledged"),await _c(n,i)}catch(t){await Vh(t)}}function mc(t,e){(t.sl.get(e)||[]).forEach(t=>{t.resolve()}),t.sl.delete(e)}function yc(t,e,n){const s=Ns(t);let i=s.nl[s.currentUser.s()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),s.nl[s.currentUser.s()]=i}}function wc(t,e,n=null){t.Gh.uh(e);for(const s of t.Yh.get(e))t.Jh.delete(s),n&&t.Hh.hl(s,n);t.Yh.delete(e),t.ol&&t.el.Du(e).forEach(e=>{t.el.Mr(e)||vc(t,e)})}function vc(t,e){const n=t.Zh.get(e);null!==n&&(t.jh.Gc(n),t.Zh=t.Zh.remove(e),t.tl.delete(n),Ic(t))}function bc(t,e,n){for(const s of n)s instanceof oc?(t.el.Po(s.key,e),Ec(t,s)):s instanceof ac?(vs("SyncEngine","Document no longer in limbo: "+s.key),t.el.yo(s.key,e),t.el.Mr(s.key)||vc(t,s.key)):_s()}function Ec(t,e){const n=e.key;t.Zh.get(n)||(vs("SyncEngine","New document in limbo: "+n),t.Xh.push(n),Ic(t))}function Ic(t){for(;t.Xh.length>0&&t.Zh.size<t.zh;){const e=t.Xh.shift(),n=t.il.next();t.tl.set(n,new uc(e)),t.Zh=t.Zh.ft(e,n),t.jh.listen(new Zs(Io(go(e.path)),n,2,Zo.Vs))}}async function _c(t,e,n){const s=Ns(t),i=[],r=[],o=[];s.Jh.forEach((t,a)=>{o.push(s.cl(a,e,n).then(t=>{if(t){s.ol&&s.Gh._h(a.targetId,t.fromCache?"not-current":"current"),i.push(t);const e=Yo.Is(a.targetId,t);r.push(e)}}))}),await Promise.all(o),s.Hh.Xa(i),await async function(t,e){const n=Ns(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>Ho.forEach(e,e=>Ho.forEach(e.Es,s=>n.persistence.Ar.Po(t,e.targetId,s)).next(()=>Ho.forEach(e.Ts,s=>n.persistence.Ar.yo(t,e.targetId,s)))))}catch(t){if(!ra(t))throw t;vs("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ra.get(e),s=t.ut,i=t._t(s);n.Ra=n.Ra.ft(e,i)}}}(s.Ac,r)}async function Tc(t,e){const n=Ns(t),s=await Oh(n.Ac,e.query,!0),i=e.view.Wh(s);return n.ol&&bc(n,e.targetId,i.Bh),i}async function Nc(t,e,n){const s=Ns(t),i=[],r=[];for(const t of e){let e;const n=s.Yh.get(t);if(n&&0!==n.length){e=await Rh(s.Ac,Io(n[0]));for(const t of n){const e=s.Jh.get(t),n=await Tc(s,e);n.snapshot&&r.push(n.snapshot)}}else{const n=await Ph(s.Ac,t);e=await Rh(s.Ac,n),await fc(s,Ac(n),t,!1)}i.push(e)}return s.Hh.Xa(r),i}function Ac(t){return po(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function xc(t){const e=Ns(t);return e.jh.pc.Zc=dc.bind(null,e),e.jh.pc.Ge=function(t,e){const n=Ns(t),s=n.tl.get(e);if(s&&s.Qh)return yi().add(s.key);{let t=yi();const s=n.Yh.get(e);if(!s)return t;for(const e of s){const s=n.Jh.get(e);t=t.Ut(s.view.Oh)}return t}}.bind(null,e),e.jh.pc.tu=async function(t,e,n){const s=Ns(t);s.al("rejectListens()"),s.Gh._h(e,"rejected",n);const i=s.tl.get(e),r=i&&i.key;if(r){let t=new ri(Gs.C);t=t.ft(r,new co(r,Vs.min()));const n=yi().add(r),i=new _i(Vs.min(),new Map,new hi(Rs),t,n);await dc(s,i),s.Zh=s.Zh.remove(r),s.tl.delete(e),Ic(s)}else await Lh(s.Ac,e,!1).then(()=>wc(s,e,n)).catch(Vh)}.bind(null,e),e}function Sc(t){const e=Ns(t);return e.jh.pc.ou=gc.bind(null,e),e.jh.pc.cu=async function(t,e,n){const s=Ns(t);s.al("rejectFailedWrite()");try{const t=await function(t,e){const n=Ns(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let s;return n.Zn.pr(t,e).next(e=>(Ts(null!==e),s=e.keys(),n.Zn.Nr(t,e))).next(()=>n.Zn.Fr(t)).next(()=>n.ya.os(t,s))})}(s.Ac,e);yc(s,e,n),mc(s,e),s.Gh.ih(e,"rejected",n),await _c(s,t)}catch(n){await Vh(n)}}.bind(null,e),e}class kc{pa(t){this.ll=t}us(t,e,n,s){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t._n.length||1===t._n.length&&t._n[0].field.G())}(e)||n.isEqual(Vs.min())?this._l(t,e):this.ll.os(t,s).next(i=>{const r=this.fl(e,i);return(mo(e)||yo(e))&&this.$h(e.fn,r,s,n)?this._l(t,e):(ws()<=h.DEBUG&&vs("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),No(e)),this.ll.us(t,e,n).next(t=>(r.forEach(e=>{t=t.ft(e.key,e)}),t)))})}fl(t,e){let n=new hi(xo(t));return e.forEach((e,s)=>{s instanceof ho&&Ao(t,s)&&(n=n.add(s))}),n}$h(t,e,n,s){if(n.size!==e.size)return!0;const i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.p(s)>0)}_l(t,e){return ws()<=h.DEBUG&&vs("IndexFreeQueryEngine","Using full collection scan to execute query:",No(e)),this.ll.us(t,e,Vs.min())}}class Dc{constructor(t,e){this.ts=t,this.Ar=e,this.Zn=[],this.dl=1,this.wl=new hi(Xh.gu)}Vr(t){return Ho.resolve(0===this.Zn.length)}gr(t,e,n,s){const i=this.dl;this.dl++,this.Zn.length>0&&this.Zn[this.Zn.length-1];const r=new Bo(i,e,n,s);this.Zn.push(r);for(const e of s)this.wl=this.wl.add(new Xh(e.key,i)),this.ts.yr(t,e.key.path.k());return Ho.resolve(r)}pr(t,e){return Ho.resolve(this.El(e))}vr(t,e){const n=e+1,s=this.Tl(n),i=s<0?0:s;return Ho.resolve(this.Zn.length>i?this.Zn[i]:null)}Sr(){return Ho.resolve(0===this.Zn.length?-1:this.dl-1)}Dr(t){return Ho.resolve(this.Zn.slice())}ns(t,e){const n=new Xh(e,0),s=new Xh(e,Number.POSITIVE_INFINITY),i=[];return this.wl.Lt([n,s],t=>{const e=this.El(t.xu);i.push(e)}),Ho.resolve(i)}cs(t,e){let n=new hi(Rs);return e.forEach(t=>{const e=new Xh(t,0),s=new Xh(t,Number.POSITIVE_INFINITY);this.wl.Lt([e,s],t=>{n=n.add(t.xu)})}),Ho.resolve(this.Il(n))}ds(t,e){const n=e.path,s=n.length+1;let i=n;Gs.tt(i)||(i=i.child(""));const r=new Xh(new Gs(i),0);let o=new hi(Rs);return this.wl.qt(t=>{const e=t.key.path;return!!n.L(e)&&(e.length===s&&(o=o.add(t.xu)),!0)},r),Ho.resolve(this.Il(o))}Il(t){const e=[];return t.forEach(t=>{const n=this.El(t);null!==n&&e.push(n)}),e}Nr(t,e){Ts(0===this.ml(e.batchId,"removed")),this.Zn.shift();let n=this.wl;return Ho.forEach(e.mutations,s=>{const i=new Xh(s.key,e.batchId);return n=n.delete(i),this.Ar.kr(t,s.key)}).next(()=>{this.wl=n})}Or(t){}Mr(t,e){const n=new Xh(e,0),s=this.wl.Bt(n);return Ho.resolve(e.isEqual(s&&s.key))}Fr(t){return this.Zn.length,Ho.resolve()}ml(t,e){return this.Tl(t)}Tl(t){return 0===this.Zn.length?0:t-this.Zn[0].batchId}El(t){const e=this.Tl(t);return e<0||e>=this.Zn.length?null:this.Zn[e]}}class Cc{constructor(t,e){this.ts=t,this.Al=e,this.docs=new ri(Gs.C),this.size=0}Un(t,e,n){const s=e.key,i=this.docs.get(s),r=i?i.size:0,o=this.Al(e);return this.docs=this.docs.ft(s,{Ur:e,size:o,readTime:n}),this.size+=o-r,this.ts.yr(t,s.path.k())}Kn(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}Qn(t,e){const n=this.docs.get(e);return Ho.resolve(n?n.Ur:null)}getEntries(t,e){let n=fi();return e.forEach(t=>{const e=this.docs.get(t);n=n.ft(t,e?e.Ur:null)}),Ho.resolve(n)}us(t,e,n){let s=pi();const i=new Gs(e.path.child("")),r=this.docs.Rt(i);for(;r.bt();){const{key:t,value:{Ur:i,readTime:o}}=r.pt();if(!e.path.L(t.path))break;o.p(n)<=0||i instanceof ho&&Ao(e,i)&&(s=s.ft(i.key,i))}return Ho.resolve(s)}Rl(t,e){return Ho.forEach(this.docs,t=>e(t))}Jr(t){return new Cc.Yr(this)}Zr(t){return Ho.resolve(this.size)}}Cc.Yr=class extends Wo{constructor(t){super(),this.to=t}zn(t){const e=[];return this.Ln.forEach((n,s)=>{s?e.push(this.to.Un(t,s,this.readTime)):this.to.Kn(n)}),Ho.Mn(e)}jn(t,e){return this.to.Qn(t,e)}Gn(t,e){return this.to.getEntries(t,e)}};class Rc{constructor(t){this.persistence=t,this.Pl=new Ko(t=>Xs(t),Js),this.lastRemoteSnapshotVersion=Vs.min(),this.highestTargetId=0,this.Vl=0,this.gl=new Wh,this.targetCount=0,this.yl=ph.ro()}Me(t,e){return this.Pl.forEach((t,n)=>e(n)),Ho.resolve()}ho(t){return Ho.resolve(this.lastRemoteSnapshotVersion)}lo(t){return Ho.resolve(this.Vl)}ao(t){return this.highestTargetId=this.yl.next(),Ho.resolve(this.highestTargetId)}_o(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Vl&&(this.Vl=e),Ho.resolve()}do(t){this.Pl.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.yl=new ph(e),this.highestTargetId=e),t.sequenceNumber>this.Vl&&(this.Vl=t.sequenceNumber)}fo(t,e){return this.do(e),this.targetCount+=1,Ho.resolve()}Eo(t,e){return this.do(e),Ho.resolve()}To(t,e){return this.Pl.delete(e.target),this.gl.Du(e.targetId),this.targetCount-=1,Ho.resolve()}dr(t,e,n){let s=0;const i=[];return this.Pl.forEach((r,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Pl.delete(r),i.push(this.Io(t,o.targetId)),s++)}),Ho.Mn(i).next(()=>s)}mo(t){return Ho.resolve(this.targetCount)}Ao(t,e){const n=this.Pl.get(e)||null;return Ho.resolve(n)}Ro(t,e,n){return this.gl.bu(e,n),Ho.resolve()}Vo(t,e,n){this.gl.Su(e,n);const s=this.persistence.Ar,i=[];return s&&e.forEach(e=>{i.push(s.kr(t,e))}),Ho.Mn(i)}Io(t,e){return this.gl.Du(e),Ho.resolve()}po(t,e){const n=this.gl.Nu(e);return Ho.resolve(n)}Mr(t,e){return Ho.resolve(this.gl.Mr(e))}}class Lc{constructor(t){this.pl={},this.Do=new Zo(0),this.Co=!1,this.Co=!0,this.Ar=t(this),this.Lo=new Rc(this),this.ts=new Ha,this.Xn=new Cc(this.ts,t=>this.Ar.bl(t))}start(){return Promise.resolve()}ra(){return this.Co=!1,Promise.resolve()}get or(){return this.Co}jo(){}Go(){}da(){return this.ts}la(t){let e=this.pl[t.s()];return e||(e=new Dc(this.ts,this.Ar),this.pl[t.s()]=e),e}_a(){return this.Lo}fa(){return this.Xn}runTransaction(t,e,n){vs("MemoryPersistence","Starting transaction:",t);const s=new Oc(this.Do.next());return this.Ar.vl(),n(s).next(t=>this.Ar.Sl(s).next(()=>t)).kn().then(t=>(s.Yn(),t))}Dl(t,e){return Ho.$n(Object.values(this.pl).map(n=>()=>n.Mr(t,e)))}}class Oc extends Jo{constructor(t){super(),this.bo=t}}class Pc{constructor(t){this.persistence=t,this.Cl=new Wh,this.Nl=null}static xl(t){return new Pc(t)}get Ol(){if(this.Nl)return this.Nl;throw _s()}Po(t,e,n){return this.Cl.Po(n,e),this.Ol.delete(n.toString()),Ho.resolve()}yo(t,e,n){return this.Cl.yo(n,e),this.Ol.add(n.toString()),Ho.resolve()}kr(t,e){return this.Ol.add(e.toString()),Ho.resolve()}removeTarget(t,e){this.Cl.Du(e.targetId).forEach(t=>this.Ol.add(t.toString()));const n=this.persistence._a();return n.po(t,e.targetId).next(t=>{t.forEach(t=>this.Ol.add(t.toString()))}).next(()=>n.To(t,e))}vl(){this.Nl=new Set}Sl(t){const e=this.persistence.fa().Jr();return Ho.forEach(this.Ol,n=>{const s=Gs.Y(n);return this.kl(t,s).next(t=>{t||e.Kn(s)})}).next(()=>(this.Nl=null,e.apply(t)))}ma(t,e){return this.kl(t,e).next(t=>{t?this.Ol.delete(e.toString()):this.Ol.add(e.toString())})}bl(t){return 0}kl(t,e){return Ho.$n([()=>Ho.resolve(this.Cl.Mr(e)),()=>this.persistence._a().Mr(t,e),()=>this.persistence.Dl(t,e)])}}class Vc{constructor(t){this.Fl=t.Fl,this.Ml=t.Ml}Ja(t){this.$l=t}Qa(t){this.Ll=t}onMessage(t){this.ql=t}close(){this.Ml()}send(t){this.Fl(t)}Bl(){this.$l()}Ul(t){this.Ll(t)}Wl(t){this.ql(t)}}const Uc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class Mc extends class{constructor(t){this.Kl=t,this.nt=t.nt;const e=t.ssl?"https":"http";this.Ql=e+"://"+t.host,this.jl="projects/"+this.nt.projectId+"/databases/"+this.nt.database+"/documents"}uc(t,e,n,s){const i=this.Gl(t,e);vs("RestConnection","Sending: ",i,n);const r={};return this.zl(r,s),this.Hl(t,i,r,n).then(t=>(vs("RestConnection","Received: ",t),t),e=>{throw Es("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})}hc(t,e,n,s){return this.uc(t,e,n,s)}zl(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/7.19.1",t["Content-Type"]="text/plain",e)for(const n in e.u)e.u.hasOwnProperty(n)&&(t[n]=e.u[n])}Gl(t,e){const n=Uc[t];return`${this.Ql}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling}Hl(t,e,n,s){return new Promise((i,r)=>{const o=new gs;o.listenOnce(ds.COMPLETE,()=>{try{switch(o.getLastErrorCode()){case fs.NO_ERROR:const e=o.getResponseJson();vs("Connection","XHR received:",JSON.stringify(e)),i(e);break;case fs.TIMEOUT:vs("Connection",'RPC "'+t+'" timed out'),r(new xs(As.DEADLINE_EXCEEDED,"Request time out"));break;case fs.HTTP_ERROR:const n=o.getStatus();if(vs("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace("_","-");return Object.values(As).indexOf(e)>=0?e:As.UNKNOWN}(t.status);r(new xs(e,t.message))}else r(new xs(As.UNKNOWN,"Server responded with status "+o.getStatus()))}else r(new xs(As.UNAVAILABLE,"Connection failed."));break;default:_s()}}finally{vs("Connection",'RPC "'+t+'" completed.')}});const a=JSON.stringify(s);o.send(e,"POST",a,n,15)})}Ya(t,e){const n=[this.Ql,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=ls(),r={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.nt.projectId}/databases/${this.nt.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};var o,a;this.zl(r.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(s())||"object"==typeof navigator&&"ReactNative"===navigator.product||s().indexOf("Electron/")>=0||((a=s()).indexOf("MSIE ")>=0||a.indexOf("Trident/")>=0)||s().indexOf("MSAppHost/")>=0||"object"==typeof(o="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==o.id||(r.httpHeadersOverwriteParam="$httpHeaders");const h=n.join("");vs("Connection","Creating WebChannel: "+h,r);const c=i.createWebChannel(h,r);let u=!1,l=!1;const f=new Vc({Fl:t=>{l?vs("Connection","Not sending because WebChannel is closed:",t):(u||(vs("Connection","Opening WebChannel transport."),c.open(),u=!0),vs("Connection","WebChannel sending:",t),c.send(t))},Ml:()=>c.close()}),d=(t,e)=>{c.listen(t,t=>{try{e(t)}catch(t){setTimeout(()=>{throw t},0)}})};return d(ps.EventType.OPEN,()=>{l||vs("Connection","WebChannel transport opened.")}),d(ps.EventType.CLOSE,()=>{l||(l=!0,vs("Connection","WebChannel transport closed"),f.Ul())}),d(ps.EventType.ERROR,t=>{l||(l=!0,Es("Connection","WebChannel transport errored:",t),f.Ul(new xs(As.UNAVAILABLE,"The operation could not be completed")))}),d(ps.EventType.MESSAGE,t=>{var e;if(!l){const n=t.data[0];Ts(!!n);const s=n,i=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(i){vs("Connection","WebChannel received error:",i);const t=i.status;let e=function(t){const e=ei[t];if(void 0!==e)return ii(e)}(t),n=i.message;void 0===e&&(e=As.INTERNAL,n="Unknown error status: "+t+" with message "+i.message),l=!0,f.Ul(new xs(e,n)),c.close()}else vs("Connection","WebChannel received:",n),f.Wl(n)}}),setTimeout(()=>{f.Bl()},0),f}}class qc{constructor(){this.Jl=(()=>this.Yl()),this.Xl=(()=>this.Zl()),this.t_=[],this.e_()}vc(t){this.t_.push(t)}ra(){window.removeEventListener("online",this.Jl),window.removeEventListener("offline",this.Xl)}e_(){window.addEventListener("online",this.Jl),window.addEventListener("offline",this.Xl)}Yl(){vs("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.t_)t(0)}Zl(){vs("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.t_)t(1)}static qs(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}class Fc{vc(t){}ra(){}}function Gc(t){return new Mc(t)}function jc(t){return new er(t,!0)}const $c="You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.";class Bc{async initialize(t){this.Gh=this.n_(t),this.persistence=this.s_(t),await this.persistence.start(),this.i_=this.r_(t),this.Ac=this.o_(t)}r_(t){return null}o_(t){return e=this.persistence,n=new kc,s=t.a_,new Sh(e,n,s);var e,n,s}s_(t){if(t.u_.c_)throw new xs(As.FAILED_PRECONDITION,$c);return new Lc(Pc.xl)}n_(t){return new rc}async terminate(){this.i_&&this.i_.stop(),await this.Gh.ra(),await this.persistence.ra()}clearPersistence(t,e){throw new xs(As.FAILED_PRECONDITION,$c)}}class zc extends Bc{async initialize(t){await super.initialize(t),await async function(t){const e=Ns(t),n=Ns(e.ga);return e.persistence.runTransaction("Synchronize last document change read time","readonly",t=>n.Hr(t)).then(t=>{e.Va=t})}(this.Ac)}r_(t){const e=this.persistence.Ar.nr;return new ba(e,t.ai)}s_(t){const e=Ah(t.Kl.nt,t.Kl.persistenceKey),n=jc(t.Kl.nt);return new Eh(t.u_.synchronizeTabs,e,t.clientId,va.zi(t.u_.cacheSizeBytes),t.ai,la(),fa(),n,this.Gh,t.u_.So)}n_(t){return new rc}clearPersistence(t,e){return xh(Ah(t,e))}}class Kc extends zc{constructor(t){super(),this.h_=t}async initialize(t){await super.initialize(t),await this.h_.initialize(this,t);const e=this.h_.Lu;this.Gh instanceof ic&&(this.Gh.Lu={gh:async function(t,e,n,s){const i=Ns(t);i.al("applyBatchState()");const r=await function(t,e){const n=Ns(t),s=Ns(n.Zn);return n.persistence.runTransaction("Lookup mutation documents","readonly",t=>s.br(t,e).next(e=>e?n.ya.os(t,e):Ho.resolve(null)))}(i.Ac,e);null!==r?("pending"===n?await i.jh.Wc():"acknowledged"===n||"rejected"===n?(yc(i,e,s||null),function(t,e){Ns(Ns(t).Zn).Or(e)}(i.Ac,e)):_s(),await _c(i,r)):vs("SyncEngine","Cannot apply mutation batch with id: "+e)}.bind(null,e),yh:async function(t,e,n,s){const i=Ns(t);if(i.rl)vs("SyncEngine","Ignoring unexpected query state notification.");else if(i.Yh.has(e))switch(n){case"current":case"not-current":{const t=await function(t){const e=Ns(i.Ac),n=Ns(e.ga);return e.persistence.runTransaction("Get new document changes","readonly",t=>n.Gr(t,e.Va)).then(({zr:t,readTime:n})=>(e.Va=n,t))}(),s=_i.ie(e,"current"===n);await _c(i,t,s);break}case"rejected":await Lh(i.Ac,e,!0),wc(i,e,s);break;default:_s()}}.bind(null,e),ph:async function(t,e,n){const s=xc(t);if(s.rl){for(const t of e){if(s.Yh.has(t)){vs("SyncEngine","Adding an already active target "+t);continue}const e=await Ph(s.Ac,t),n=await Rh(s.Ac,e);await fc(s,Ac(e),n.targetId,!1),s.jh.listen(n)}for(const t of n)s.Yh.has(t)&&await Lh(s.Ac,t,!1).then(()=>{s.jh.Gc(t),wc(s,t)}).catch(Vh)}}.bind(null,e),ha:function(t){return Ns(Ns(Ns(t).Ac).persistence).ha()}.bind(null,e)},await this.Gh.start()),await this.persistence.Qo(async t=>{await async function(t,e){const n=Ns(t);if(xc(n),Sc(n),!0===e&&!0!==n.rl){const t=n.Gh.Zu(),e=await Nc(n,t.B());n.rl=!0,await n.jh.hu(!0);for(const t of e)n.jh.listen(t)}else if(!1===e&&!1!==n.rl){const t=[];let e=Promise.resolve();n.Yh.forEach((s,i)=>{n.Gh.hh(i)?t.push(i):e=e.then(()=>(wc(n,i),Lh(n.Ac,i,!0))),n.jh.Gc(i)}),await e,await Nc(n,t),function(t){const e=Ns(n);e.tl.forEach((t,n)=>{e.jh.Gc(n)}),e.el.Cu(),e.tl=new Map,e.Zh=new ri(Gs.C)}(),n.rl=!1,await n.jh.hu(!1)}}(this.h_.Lu,t),this.i_&&(t&&!this.i_.or?this.i_.start(this.Ac):t||this.i_.stop())})}n_(t){if(t.u_.c_&&t.u_.synchronizeTabs){const e=la();if(!ic.qs(e))throw new xs(As.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=Ah(t.Kl.nt,t.Kl.persistenceKey);return new ic(e,t.ai,n,t.clientId,t.a_)}return new rc}}class Hc{async initialize(t,e){this.Ac||(this.Ac=t.Ac,this.Gh=t.Gh,this.Rc=this.l_(e),this.jh=this.__(e),this.Lu=this.f_(e),this.d_=this.w_(e),this.Lu.subscribe({Xa:function(t,e){const n=Ns(t);let s=!1;for(const t of e){const e=t.query,i=n._u.get(e);if(i){for(const e of i.listeners)e.du(t)&&(s=!0);i.lu=t}}s&&Kh(n)}.bind(null,this.d_),hl:function(t,e,n){const s=Ns(t),i=s._u.get(e);if(i)for(const t of i.listeners)t.onError(n);s._u.delete(e)}.bind(null,this.d_),ul:function(t,e){const n=Ns(t);n.onlineState=e;let s=!1;n._u.forEach((t,n)=>{for(const t of n.listeners)t.wu(e)&&(s=!0)}),s&&Kh(n)}.bind(null,this.d_)}),this.Gh.lc=(t=>pc(this.Lu,t,1)),this.jh.pc.uu=async function(t,e){const n=Ns(t);if(!n.currentUser.isEqual(e)){vs("SyncEngine","User change. New user:",e.s());const t=await kh(n.Ac,e);n.currentUser=e,function(t,e){t.sl.forEach(t=>{t.forEach(t=>{t.reject(new xs(As.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.sl.clear()}(n),n.Gh.dh(e,t.va,t.Sa),await _c(n,t.ba)}}.bind(null,this.Lu),await this.jh.start(),await this.jh.hu(this.Lu.ol))}w_(t){return new zh}l_(t){const e=jc(t.Kl.nt),n=Gc(t.Kl);return Gh(t.credentials,n,e)}__(t){return new $h(this.Ac,this.Rc,t.ai,t=>pc(this.Lu,t,0),qc.qs()?new qc:new Fc)}f_(t){return function(t,e,n,s,i,r){const o=new lc(t,e,n,s,i);return r&&(o.rl=!0),o}(this.Ac,this.jh,this.Gh,t.a_,t.zh,!t.u_.c_||!t.u_.synchronizeTabs)}terminate(){return this.jh.ra()}}function Wc(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class Xc{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.E_(this.observer.next,t)}error(t){this.observer.error?this.E_(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}T_(){this.muted=!0}E_(t,e){this.muted||setTimeout(()=>{this.muted||t(e)},0)}}function Jc(t,e,n){if(e.length!==n)throw new xs(As.INVALID_ARGUMENT,`Function ${t}() requires `+ru(n,"argument")+", but was called with "+ru(e.length,"argument")+".")}function Qc(t,e,n){if(e.length<n)throw new xs(As.INVALID_ARGUMENT,`Function ${t}() requires at least `+ru(n,"argument")+", but was called with "+ru(e.length,"argument")+".")}function Yc(t,e,n,s){!function(t,e,n,s){let i=!1;if(!(i="object"===e?eu(s):"non-empty string"===e?"string"==typeof s&&""!==s:typeof s===e)){const i=nu(s);throw new xs(As.INVALID_ARGUMENT,`Function ${t}() requires its ${n} to be of type ${e}, but it was: ${i}`)}}(t,e,iu(n)+" argument",s)}function Zc(t){if(!Gs.tt(t))throw new xs(As.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function tu(t){if(Gs.tt(t))throw new xs(As.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function eu(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function nu(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){if(t.constructor){const e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":_s()}function su(t,e,n){if(n<=0)throw new xs(As.INVALID_ARGUMENT,`Function ${t}() requires its ${iu(e)} argument to be a positive number, but it was: ${n}.`)}function iu(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function ru(t,e){return`${t} ${e}`+(1===t?"":"s")}class ou{constructor(t){!function(t,e,n,s){if(!(e instanceof Array)||e.length<1)throw new xs(As.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least "+ru(1,"element")+".")}(0,t);for(let e=0;e<t.length;++e)if(Yc("FieldPath","string",e,t[e]),0===t[e].length)throw new xs(As.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.I_=new Fs(t)}}class au extends ou{constructor(...t){super(t)}static documentId(){return new au(Fs.H().U())}isEqual(t){if(!(t instanceof au))throw function(t,e,n,s){const i=nu(s);return new xs(As.INVALID_ARGUMENT,`Function isEqual() requires its ${iu(1)} argument to be a FieldPath, but it was: ${i}`)}(0,0,0,t);return this.I_.isEqual(t.I_)}}const hu=new RegExp("[~\\*/\\[\\]]");class cu{constructor(){this.m_=this}}class uu extends cu{constructor(t){super(),this.A_=t}R_(t){if(2!==t.P_)throw 1===t.P_?t.V_(this.A_+"() can only appear at the top level of your update data"):t.V_(this.A_+"() cannot be used with set() unless you pass {merge:true}");return t.Je.push(t.path),null}isEqual(t){return t instanceof uu}}function lu(t,e,n){return new _u({P_:3,g_:e.settings.g_,methodName:t.A_,y_:n},e.nt,e.serializer,e.ignoreUndefinedProperties)}class fu extends cu{constructor(t){super(),this.A_=t}R_(t){return new Fr(t.path,new Cr)}isEqual(t){return t instanceof fu}}class du extends cu{constructor(t,e){super(),this.A_=t,this.p_=e}R_(t){const e=lu(this,t,!0),n=this.p_.map(t=>ku(t,e)),s=new Rr(n);return new Fr(t.path,s)}isEqual(t){return this===t}}class pu extends cu{constructor(t,e){super(),this.A_=t,this.p_=e}R_(t){const e=lu(this,t,!0),n=this.p_.map(t=>ku(t,e)),s=new Or(n);return new Fr(t.path,s)}isEqual(t){return this===t}}class gu extends cu{constructor(t,e){super(),this.A_=t,this.b_=e}R_(t){const e=new Vr(t.serializer,ir(t.serializer,this.b_));return new Fr(t.path,e)}isEqual(t){return this===t}}class mu{constructor(t,e){if(Jc("GeoPoint",arguments,2),Yc("GeoPoint","number",1,t),Yc("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new xs(As.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new xs(As.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.v_=t,this.S_=e}get latitude(){return this.v_}get longitude(){return this.S_}isEqual(t){return this.v_===t.v_&&this.S_===t.S_}toJSON(){return{latitude:this.v_,longitude:this.S_}}V(t){return Rs(this.v_,t.v_)||Rs(this.S_,t.S_)}}class yu{constructor(t){this.D_=t}static fromBase64String(t){try{return new yu(Ys.fromBase64String(t))}catch(t){throw new xs(As.INVALID_ARGUMENT,"Failed to construct Bytes from Base64 string: "+t)}}static fromUint8Array(t){return new yu(Ys.fromUint8Array(t))}toBase64(){return this.D_.toBase64()}toUint8Array(){return this.D_.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this.D_.isEqual(t.D_)}}const wu=/^__.*__$/;class vu{constructor(t,e,n){this.C_=t,this.N_=e,this.x_=n}}class bu{constructor(t,e,n){this.data=t,this.Je=e,this.fieldTransforms=n}O_(t,e){const n=[];return null!==this.Je?n.push(new Qr(t,this.data,this.Je,e)):n.push(new Jr(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Zr(t,this.fieldTransforms)),n}}class Eu{constructor(t,e,n){this.data=t,this.Je=e,this.fieldTransforms=n}O_(t,e){const n=[new Qr(t,this.data,this.Je,e)];return this.fieldTransforms.length>0&&n.push(new Zr(t,this.fieldTransforms)),n}}function Iu(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw _s()}}class _u{constructor(t,e,n,s,i,r){this.settings=t,this.nt=e,this.serializer=n,this.ignoreUndefinedProperties=s,void 0===i&&this.k_(),this.fieldTransforms=i||[],this.Je=r||[]}get path(){return this.settings.path}get P_(){return this.settings.P_}F_(t){return new _u(Object.assign(Object.assign({},this.settings),t),this.nt,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.Je)}M_(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.F_({path:n,y_:!1});return s.L_(t),s}q_(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.F_({path:n,y_:!1});return s.k_(),s}B_(t){return this.F_({path:void 0,y_:!0})}V_(t){return Pu(t,this.settings.methodName,this.settings.U_||!1,this.path,this.settings.g_)}contains(t){return void 0!==this.Je.find(e=>t.L(e))||void 0!==this.fieldTransforms.find(e=>t.L(e.field))}k_(){if(this.path)for(let t=0;t<this.path.length;t++)this.L_(this.path.get(t))}L_(t){if(0===t.length)throw this.V_("Document fields must not be empty");if(Iu(this.P_)&&wu.test(t))throw this.V_('Document fields cannot begin and end with "__"')}}class Tu{constructor(t,e,n){this.nt=t,this.ignoreUndefinedProperties=e,this.serializer=n||jc(t)}W_(t,e,n,s=!1){return new _u({P_:t,methodName:e,g_:n,path:Fs.K(),y_:!1,U_:s},this.nt,this.serializer,this.ignoreUndefinedProperties)}}function Nu(t,e,n,s,i,r={}){const o=t.W_(r.merge||r.mergeFields?2:0,e,n,i);Ru("Data must be an object, but it was:",o,s);const a=Du(s,o);let h,c;if(r.merge)h=new qr(o.Je),c=o.fieldTransforms;else if(r.mergeFields){const t=[];for(const s of r.mergeFields){let i;if(s instanceof ou)i=s.I_;else{if("string"!=typeof s)throw _s();i=Ou(e,s,n)}if(!o.contains(i))throw new xs(As.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);Vu(t,i)||t.push(i)}h=new qr(t),c=o.fieldTransforms.filter(t=>h.nn(t.field))}else h=null,c=o.fieldTransforms;return new bu(new io(a),h,c)}function Au(t,e,n,s){const i=t.W_(1,e,n);Ru("Data must be an object, but it was:",i,s);const r=[],o=new ro;Li(s,(t,s)=>{const a=Ou(e,t,n),h=i.q_(a);if(s instanceof cu&&s.m_ instanceof uu)r.push(a);else{const t=ku(s,h);null!=t&&(r.push(a),o.set(a,t))}});const a=new qr(r);return new Eu(o.rn(),a,i.fieldTransforms)}function xu(t,e,n,s,i,r){const o=t.W_(1,e,n),a=[Lu(e,s,n)],h=[i];if(r.length%2!=0)throw new xs(As.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<r.length;t+=2)a.push(Lu(e,r[t])),h.push(r[t+1]);const c=[],u=new ro;for(let t=a.length-1;t>=0;--t)if(!Vu(c,a[t])){const e=a[t],n=h[t],s=o.q_(e);if(n instanceof cu&&n.m_ instanceof uu)c.push(e);else{const t=ku(n,s);null!=t&&(c.push(e),u.set(e,t))}}const l=new qr(c);return new Eu(u.rn(),l,o.fieldTransforms)}function Su(t,e,n,s=!1){return ku(n,t.W_(s?4:3,e))}function ku(t,e){if(Cu(t))return Ru("Unsupported field value:",e,t),Du(t,e);if(t instanceof cu)return function(t,e){if(!Iu(e.P_))throw e.V_(t.A_+"() can only be used with update() and set()");if(!e.path)throw e.V_(t.A_+"() is not currently supported inside arrays");const n=t.R_(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Je.push(e.path),t instanceof Array){if(e.settings.y_&&4!==e.P_)throw e.V_("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const i of t){let t=ku(i,e.B_(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ir(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Ps.fromDate(t);return{timestampValue:rr(e.serializer,n)}}if(t instanceof Ps){const n=new Ps(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:rr(e.serializer,n)}}if(t instanceof mu)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof yu)return{bytesValue:or(e.serializer,t.D_)};if(t instanceof vu){const n=e.nt,s=t.C_;if(!s.isEqual(n))throw e.V_(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:hr(t.C_||e.nt,t.N_.path)}}if(void 0===t&&e.ignoreUndefinedProperties)return null;throw e.V_("Unsupported field value: "+nu(t))}(t,e)}function Du(t,e){const n={};return Oi(t)?e.path&&e.path.length>0&&e.Je.push(e.path):Li(t,(t,s)=>{const i=ku(s,e.M_(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Cu(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ps||t instanceof mu||t instanceof yu||t instanceof vu||t instanceof cu)}function Ru(t,e,n){if(!Cu(n)||!eu(n)){const s=nu(n);throw"an object"===s?e.V_(t+" a custom object"):e.V_(t+" "+s)}}function Lu(t,e,n){if(e instanceof ou)return e.I_;if("string"==typeof e)return Ou(t,e);throw Pu("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}function Ou(t,e,n){try{return function(t){if(t.search(hu)>=0)throw new xs(As.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`);try{return new au(...t.split("."))}catch(e){throw new xs(As.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`)}}(e).I_}catch(e){throw Pu((s=e)instanceof Error?s.message:s.toString(),t,!1,void 0,n)}var s}function Pu(t,e,n,s,i){const r=s&&!s.$(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let h="";return(r||o)&&(h+=" (found",r&&(h+=" in field "+s),o&&(h+=" in document "+i),h+=")"),new xs(As.INVALID_ARGUMENT,a+t+h)}function Vu(t,e){return t.some(t=>t.isEqual(e))}class Uu{constructor(t){this.Rc=t,this.K_=new Map,this.mutations=[],this.Q_=!1,this.j_=null,this.G_=new Set}async z_(t){if(this.H_(),this.mutations.length>0)throw new xs(As.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=Ns(t),s=pr(n.serializer)+"/documents",i={documents:e.map(t=>ur(n.serializer,t))},r=await n.hc("BatchGetDocuments",s,i),o=new Map;r.forEach(t=>{const e=function(t,e){return"found"in e?function(t,e){Ts(!!e.found),e.found.name,e.found.updateTime;const n=lr(t,e.found.name),s=ar(e.found.updateTime),i=new io({mapValue:{fields:e.found.fields}});return new ho(n,s,i,{})}(t,e):"missing"in e?function(t,e){Ts(!!e.missing),Ts(!!e.readTime);const n=lr(t,e.missing),s=ar(e.readTime);return new co(n,s)}(t,e):_s()}(n.serializer,t);o.set(e.key.toString(),e)});const a=[];return e.forEach(t=>{const e=o.get(t.toString());Ts(!!e),a.push(e)}),a}(this.Rc,t);return e.forEach(t=>{t instanceof co||t instanceof ho?this.J_(t):_s()}),e}set(t,e){this.write(e.O_(t,this.Ze(t))),this.G_.add(t.toString())}update(t,e){try{this.write(e.O_(t,this.Y_(t)))}catch(t){this.j_=t}this.G_.add(t.toString())}delete(t){this.write([new no(t,this.Ze(t))]),this.G_.add(t.toString())}async commit(){if(this.H_(),this.j_)throw this.j_;const t=this.K_;this.mutations.forEach(e=>{t.delete(e.key.toString())}),t.forEach((t,e)=>{const n=Gs.Y(e);this.mutations.push(new so(n,this.Ze(n)))}),await async function(t,e){const n=Ns(t),s=pr(n.serializer)+"/documents",i={writes:e.map(t=>yr(n.serializer,t))};await n.uc("Commit",s,i)}(this.Rc,this.mutations),this.Q_=!0}J_(t){let e;if(t instanceof ho)e=t.version;else{if(!(t instanceof co))throw _s();e=Vs.min()}const n=this.K_.get(t.key.toString());if(n){if(!e.isEqual(n))throw new xs(As.ABORTED,"Document version changed between two reads.")}else this.K_.set(t.key.toString(),e)}Ze(t){const e=this.K_.get(t.toString());return!this.G_.has(t.toString())&&e?jr.updateTime(e):jr.tn()}Y_(t){const e=this.K_.get(t.toString());if(!this.G_.has(t.toString())&&e){if(e.isEqual(Vs.min()))throw new xs(As.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return jr.updateTime(e)}return jr.exists(!0)}write(t){this.H_(),this.mutations=this.mutations.concat(t)}H_(){}}class Mu{constructor(t,e,n,s){this.ai=t,this.Rc=e,this.updateFunction=n,this.hi=s,this.X_=5,this.Pi=new ea(this.ai,"transaction_retry")}run(){this.Z_()}Z_(){this.Pi.xs(async()=>{const t=new Uu(this.Rc),e=this.tf(t);e&&e.then(e=>{this.ai.di(()=>t.commit().then(()=>{this.hi.resolve(e)}).catch(t=>{this.ef(t)}))}).catch(t=>{this.ef(t)})})}tf(t){try{const e=this.updateFunction(t);return!Bs(e)&&e.catch&&e.then?e:(this.hi.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.hi.reject(t),null}}ef(t){this.X_>0&&this.nf(t)?(this.X_-=1,this.ai.di(()=>(this.Z_(),Promise.resolve()))):this.hi.reject(t)}nf(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!si(e)}return!1}}function qu(t,e,n){const s=new ta;return t.di(()=>(async function(t,e,n){const s=Sc(t);s.al("write()");try{const i=await function(t,e){const n=Ns(t),s=Ps.now(),i=e.reduce((t,e)=>t.add(e.key),yi());let r;return n.persistence.runTransaction("Locally write mutations","readwrite",t=>n.ya.os(t,i).next(i=>{r=i;const o=[];for(const t of e){const e=Hr(t,r.get(t.key));null!=e&&o.push(new Qr(t.key,e,oo(e.proto.mapValue),jr.exists(!0)))}return n.Zn.gr(t,s,o,e)})).then(t=>{const e=t.Vn(r);return{batchId:t.batchId,Ln:e}})}(s.Ac,e);s.Gh.nh(i.batchId),function(t,e,n){let s=t.nl[t.currentUser.s()];s||(s=new ri(Rs)),s=s.ft(e,n),t.nl[t.currentUser.s()]=s}(s,i.batchId,n),await _c(s,i.Ln),await s.jh.Wc()}catch(t){const e=ga(t,"Failed to persist write");n.reject(e)}})(e,n,s)),s.promise}function Fu(t,e,n,s){return t.enqueue(()=>(n.Go(s),s?e.enableNetwork():e.disableNetwork()))}function Gu(t,e,n,s,i){const r=new Xc(i),o=new Hh(n,r,s);return t.di(()=>(async function(t,e){const n=Ns(t),s=e.query;let i=!1,r=n._u.get(s);if(r||(i=!0,r=new Bh),i)try{r.lu=await n.sf(s)}catch(t){const n=ga(t,`Initialization of query '${No(e.query)}' failed`);return void e.onError(n)}n._u.set(s,r),r.listeners.push(e),e.wu(n.onlineState),r.lu&&e.du(r.lu)&&Kh(n)})(e,o)),()=>{r.T_(),t.di(()=>(async function(t,e){const n=Ns(t),s=e.query;let i=!1;const r=n._u.get(s);if(r){const t=r.listeners.indexOf(e);t>=0&&(r.listeners.splice(t,1),i=0===r.listeners.length)}if(i)return n._u.delete(s),n.if(s)})(e,o))}}function ju(t,e,n,s){const i=new ta,r=Gu(t,e,go(n.path),{includeMetadataChanges:!0,Pu:!0},{next:t=>{r();const e=t.docs.has(n);!e&&t.fromCache?i.reject(new xs(As.UNAVAILABLE,"Failed to get document because the client is offline.")):e&&t.fromCache&&s&&"server"===s.source?i.reject(new xs(As.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(t)},error:t=>i.reject(t)});return i.promise}function $u(t,e,n,s){const i=new ta,r=Gu(t,e,n,{includeMetadataChanges:!0,Pu:!0},{next:t=>{r(),t.fromCache&&s&&"server"===s.source?i.reject(new xs(As.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(t)},error:t=>i.reject(t)});return i.promise}const Bu=new Map;class zu{constructor(t,e){this.app=t,this.rf="(lite)",this.af=!1,this.INTERNAL={delete:()=>this._delete()},this.C_=zu.cf(t),this.uf=new ks(e)}get hf(){return this.af}get lf(){return void 0!==this._f}ff(t){if(this.af)throw new xs(As.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. initializeFirestore() cannot be called after calling getFirestore().");this.df=t}wf(){return this.df||(this.df={}),this.af=!0,this.df}static cf(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new xs(As.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new $s(t.options.projectId)}_delete(){return this._f||(this._f=this.Ef()),this._f}Ef(){return function(t){const e=Bu.get(t);e&&(vs("ComponentProvider","Removing Datastore"),Bu.delete(t),e.terminate())}(this),Promise.resolve()}}class Ku{constructor(t,e,n,s,i){this.nt=t,this.timestampsInSnapshots=e,this.Tf=n,this.If=s,this.mf=i}Af(t){switch(Mi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return zi(t.integerValue||t.doubleValue);case 3:return this.Rf(t.timestampValue);case 4:return this.Pf(t);case 5:return t.stringValue;case 6:return this.mf(Ki(t.bytesValue));case 7:return this.Vf(t.referenceValue);case 8:return this.gf(t.geoPointValue);case 9:return this.yf(t.arrayValue);case 10:return this.pf(t.mapValue);default:throw _s()}}pf(t){const e={};return Li(t.fields||{},(t,n)=>{e[t]=this.Af(n)}),e}gf(t){return new mu(zi(t.latitude),zi(t.longitude))}yf(t){return(t.values||[]).map(t=>this.Af(t))}Pf(t){switch(this.Tf){case"previous":const e=function t(e){const n=e.mapValue.fields.__previous_value__;return Pi(n)?t(n):n}(t);return null==e?null:this.Af(e);case"estimate":return this.Rf(Vi(t));default:return null}}Rf(t){const e=Bi(t),n=new Ps(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()}Vf(t){const e=Ms.W(t);Ts(Ar(e));const n=new $s(e.get(1),e.get(3)),s=new Gs(e.O(5));return n.isEqual(this.nt)||bs(`Document ${s} contains a document reference within a different database (${n.projectId}/${n.database}) which is not supported. It will be treated as a reference in the current database (${this.nt.projectId}/${this.nt.database}) instead.`),this.If(s)}}const Hu=va.Yi;class Wu{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}function Xu(t,e,n){if("string"==typeof n){if(""===n)throw new xs(As.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!bo(e)&&-1!==n.indexOf("/"))throw new xs(As.INVALID_ARGUMENT,`Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(Ms.W(n));if(!Gs.tt(s))throw new xs(As.INVALID_ARGUMENT,`Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Hi(t,new Gs(s))}if(n instanceof vu)return Hi(t,n.N_);throw new xs(As.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+nu(n)+".")}function Ju(t,e){if(!Array.isArray(t)||0===t.length)throw new xs(As.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new xs(As.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`);if("in"===e||"array-contains-any"===e){if(t.indexOf(null)>=0)throw new xs(As.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters cannot contain 'null' in the value array.`);if(t.filter(t=>Number.isNaN(t)).length>0)throw new xs(As.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters cannot contain 'NaN' in the value array.`)}}function Qu(t,e,n){if(!n.isEqual(e))throw new xs(As.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}function Yu(t){if(yo(t)&&0===t._n.length)throw new xs(As.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}function Zu(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}const tl=new Map,el=new Map;async function nl(t,e,n){const s=new ta;tl.set(t,s.promise);const i=await t.bf();i.u_=e,vs("ComponentProvider","Initializing OfflineComponentProvider"),await n.initialize(i),t.vf(e=>t.Sf.di(()=>kh(n.Ac,e))),n.persistence.jo(()=>t._delete()),s.resolve(n)}async function sl(t,e){const n=new ta;el.set(t,n.promise);const s=await t.bf(),i=await il(t);vs("ComponentProvider","Initializing OnlineComponentProvider"),await e.initialize(i,s),t.vf(n=>t.Sf.di(()=>e.jh.uu(n))),n.resolve(e)}function il(t){return ol(t),tl.has(t)||(vs("ComponentProvider","Using default OfflineComponentProvider"),nl(t,{c_:!1},new Bc)),tl.get(t)}function rl(t){return ol(t),el.has(t)||(vs("ComponentProvider","Using default OnlineComponentProvider"),sl(t,new Hc)),el.get(t)}function ol(t){if(t.lf)throw new xs(As.FAILED_PRECONDITION,"The client has already been terminated.")}function al(t){return rl(t).then(t=>t.Lu)}function hl(t){return rl(t).then(t=>t.jh)}function cl(t){return rl(t).then(t=>{const e=t.d_;return e.sf=async function(t,e){const n=xc(t);let s,i;n.al("listen()");const r=n.Jh.get(e);if(r)s=r.targetId,n.Gh.oh(s),i=r.view.Kh();else{const t=await Rh(n.Ac,Io(e)),r=n.Gh.oh(t.targetId);s=t.targetId,i=await fc(n,e,s,"current"===r),n.ol&&n.jh.listen(t)}return i}.bind(null,t.Lu),e.if=async function(t,e){const n=Ns(t);n.al("unlisten()");const s=n.Jh.get(e),i=n.Yh.get(s.targetId);if(i.length>1)return n.Yh.set(s.targetId,i.filter(t=>!_o(t,e))),void n.Jh.delete(e);n.ol?(n.Gh.uh(s.targetId),n.Gh.eh(s.targetId)||await Lh(n.Ac,s.targetId,!1).then(()=>{n.Gh.lh(s.targetId),n.jh.Gc(s.targetId),wc(n,s.targetId)}).catch(Vh)):(wc(n,s.targetId),await Lh(n.Ac,s.targetId,!0))}.bind(null,t.Lu),e})}function ul(t){return il(t).then(t=>t.persistence)}function ll(t){return il(t).then(t=>t.Ac)}class fl extends zu{constructor(t,e){super(t,e),this.Sf=new pa,this.Df=Cs.P(),this.Cf=new ta,this.Nf=ms.UNAUTHENTICATED,this.xf=(()=>{}),this.rf=t.name,this.uf.A(t=>{this.Nf=t,this.Cf.resolve()})}vf(t){vs("Firestore","Registering credential change listener"),this.xf=t,this.Cf.promise.then(()=>this.xf(this.Nf))}async bf(){var t,e;const n=this.wf();await this.Cf.promise;const s=new js(this.C_,this.rf,null!==(t=n.host)&&void 0!==t?t:"firestore.googleapis.com",null===(e=n.ssl)||void 0===e||e,!1);return{ai:this.Sf,Kl:s,clientId:this.Df,credentials:this.uf,a_:this.Nf,zh:100,u_:{c_:!1}}}wf(){return super.wf()}Ef(){this.Sf.vi();const t=new ta;return this.Sf.yi(async()=>{try{await super.Ef(),await async function(t){const e=el.get(t);e&&(vs("ComponentProvider","Removing OnlineComponentProvider"),el.delete(t),await(await e).terminate());const n=tl.get(t);n&&(vs("ComponentProvider","Removing OfflineComponentProvider"),tl.delete(t),await(await n).terminate())}(this),this.uf.R(),t.resolve()}catch(e){const n=ga(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}}function dl(t){if(t.hf)throw new xs(As.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class pl extends ou{constructor(...t){super(t)}isEqual(t){const e=lo(t,pl);return this.I_.isEqual(e.I_)}}class gl extends vu{constructor(t,e,n){super(t.C_,new Gs(n),e),this.firestore=t,this.converter=e,this.Of=n,this.type="document"}get id(){return this.Of.M()}get path(){return this.Of.U()}get parent(){return new Tl(this.firestore,this.x_,this.N_.path.k())}collection(t){Sl("DocumentReference.collection","path",t);const e=Ms.W(this.path).child(Ms.W(t));return tu(e),new Tl(this.firestore,null,e)}withConverter(t){return new gl(this.firestore,t,this.Of)}}class ml{constructor(t,e,n){this.firestore=t,this.converter=e,this.kf=n,this.type="query"}withConverter(t){return new ml(this.firestore,t,this.kf)}}class yl{}class wl extends yl{constructor(t,e,n){super(),this.Ff=t,this.Mf=e,this.$f=n,this.type="where"}apply(t){const e=xl(t.firestore),n=function(t,e,n,s,i,r,o){let a;if(i.G()){if("array-contains"===r||"array-contains-any"===r)throw new xs(As.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on FieldPath.documentId().`);if("in"===r||"not-in"===r){Ju(o,r);const e=[];for(const n of o)e.push(Xu(s,t,n));a={arrayValue:{values:e}}}else a=Xu(s,t,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||Ju(o,r),a=Su(n,e,o,"in"===r||"not-in"===r);const h=So.create(i,r,a);return function(t,e){if(e.En()){const n=vo(t);if(null!==n&&!n.isEqual(e.field))throw new xs(As.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=wo(t);null!==s&&Qu(0,e.field,s)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(e.op){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}());if(null!==n)throw n===e.op?new xs(As.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new xs(As.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,h),h}(t.kf,"where",e,t.firestore.C_,this.Ff,this.Mf,this.$f);return new ml(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new fo(t.path,t.collectionGroup,t._n.slice(),n,t.limit,t.fn,t.startAt,t.endAt)}(t.kf,n))}}class vl extends yl{constructor(t,e){super(),this.Ff=t,this.Lf=e,this.type="orderBy"}apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new xs(As.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new xs(As.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new Go(e,n);return function(t,e){if(null===wo(t)){const n=vo(t);null!==n&&Qu(0,n,e.field)}}(t,s),s}(t.kf,this.Ff,this.Lf);return new ml(t.firestore,t.converter,function(t,e){const n=t._n.concat([e]);return new fo(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.fn,t.startAt,t.endAt)}(t.kf,e))}}class bl extends yl{constructor(t,e,n){super(),this.type=t,this.qf=e,this.Bf=n}apply(t){return new ml(t.firestore,t.converter,function(t,e,n){return new fo(t.path,t.collectionGroup,t._n.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}(t.kf,this.qf,this.Bf))}}class El extends yl{constructor(t,e,n){super(),this.type=t,this.Uf=e,this.Wf=n}apply(t){const e=_l(t,this.type,this.Uf,this.Wf);return new ml(t.firestore,t.converter,function(t,e){return new fo(t.path,t.collectionGroup,t._n.slice(),t.filters.slice(),t.limit,t.fn,e,t.endAt)}(t.kf,e))}}class Il extends yl{constructor(t,e,n){super(),this.type=t,this.Uf=e,this.Wf=n}apply(t){const e=_l(t,this.type,this.Uf,this.Wf);return new ml(t.firestore,t.converter,function(t,e){return new fo(t.path,t.collectionGroup,t._n.slice(),t.filters.slice(),t.limit,t.fn,t.startAt,e)}(t.kf,e))}}function _l(t,e,n,s){if(n[0]instanceof kl)return Jc(e,n,1),function(t,e,n,s,i){if(!s)throw new xs(As.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");const r=[];for(const n of Eo(t))if(n.field.G())r.push(Hi(e,s.key));else{const t=s.field(n.field);if(Pi(t))throw new xs(As.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.U();throw new xs(As.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}r.push(t)}return new Uo(r,i)}(t.kf,t.firestore.C_,e,n[0].Kf,s);{const i=xl(t.firestore);return function(t,e,n,s,i,r){const o=t._n;if(i.length>o.length)throw new xs(As.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let r=0;r<i.length;r++){const h=i[r];if(o[r].field.G()){if("string"!=typeof h)throw new xs(As.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof h}`);if(!bo(t)&&-1!==h.indexOf("/"))throw new xs(As.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ${s}() must be a plain document ID, but '${h}' contains a slash.`);const n=t.path.child(Ms.W(h));if(!Gs.tt(n))throw new xs(As.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const i=new Gs(n);a.push(Hi(e,i))}else{const t=Su(n,s,h);a.push(t)}}return new Uo(a,r)}(t.kf,t.firestore.C_,i,e,n,s)}}class Tl extends ml{constructor(t,e,n){super(t,e,go(n)),this.firestore=t,this.Of=n,this.type="collection"}get id(){return this.kf.path.M()}get path(){return this.kf.path.U()}get parent(){const t=this.Of.k();return t.$()?null:new gl(this.firestore,null,t)}doc(t){0===arguments.length&&(t=Cs.P()),Sl("CollectionReference.doc","path",t);const e=this.Of.child(Ms.W(t));return Zc(e),new gl(this.firestore,this.converter,e)}withConverter(t){return new Tl(this.firestore,t,this.Of)}}function Nl(t,e){if(1===arguments.length&&(e=Cs.P()),Sl("doc","path",e),t instanceof zu){const n=Ms.W(e);return Zc(n),new gl(t,null,n)}{if(!(t instanceof gl||t instanceof Tl))throw new xs(As.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=t.Of.child(Ms.W(e));return Zc(n),new gl(t.firestore,t instanceof Tl?t.converter:null,n)}}function Al(t,e){return t instanceof ml&&e instanceof ml&&t.firestore===e.firestore&&_o(t.kf,e.kf)&&t.converter===e.converter}function xl(t){const e=t.wf(),n=jc(t.C_);return new Tu(t.C_,!!e.ignoreUndefinedProperties,n)}function Sl(t,e,n){if(!n)throw new xs(As.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}class kl{constructor(t,e,n,s){this.Qf=t,this.N_=e,this.Kf=n,this.x_=s}get id(){return this.N_.path.M()}get ref(){return new gl(this.Qf,this.x_,this.N_.path)}exists(){return null!==this.Kf}data(){if(this.Kf){if(this.x_){const t=new Dl(this.Qf,this.N_,this.Kf,null);return this.x_.fromFirestore(t)}return new Ku(this.Qf.C_,!0,"none",t=>new gl(this.Qf,null,t.path),t=>new yu(t)).Af(this.Kf.ln())}}get(t){if(this.Kf){const e=this.Kf.data().field(Cl("DocumentSnapshot.get",t));if(null!==e)return new Ku(this.Qf.C_,!0,"none",t=>new gl(this.Qf,this.x_,t.path),t=>new yu(t)).Af(e)}}}class Dl extends kl{data(){return super.data()}}function Cl(t,e){return"string"==typeof e?Ou(t,e):lo(e,pl).I_}class Rl extends kl{constructor(t,e,n,s,i){super(t,e,n,i),this.Qf=t,this.metadata=s,this.jf=lo(t,fl)}exists(){return super.exists()}data(t){if(this.Kf){if(this.x_){const e=new Ll(this.Qf,this.N_,this.Kf,this.metadata,null);return this.x_.fromFirestore(e,t)}return new Ku(this.jf.C_,!0,(null==t?void 0:t.serverTimestamps)||"none",t=>new gl(this.Qf,null,t.path),t=>new yu(t)).Af(this.Kf.ln())}}get(t,e={}){if(this.Kf){const n=this.Kf.data().field(Cl("DocumentSnapshot.get",t));if(null!==n)return new Ku(this.jf.C_,!0,e.serverTimestamps||"none",t=>new gl(this.Qf,this.x_,t.path),t=>new yu(t)).Af(n)}}}class Ll extends Rl{data(t={}){return super.data(t)}}class Ol{constructor(t,e,n){this.Qf=t,this.query=e,this.Gf=n,this.metadata=new Wu(n.hasPendingWrites,n.fromCache)}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this.Gf.docs.size}get empty(){return 0===this.size}forEach(t,e){this.Gf.docs.forEach(n=>{t.call(e,this.zf(n,this.Gf.fromCache,this.Gf.Jt.has(n.key)))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this.Gf.Xt)throw new xs(As.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.Hf&&this.Jf===e||(this.Hf=function(t,e,n){if(t.Ht.$()){let e,s=0;return t.docChanges.map(i=>{const r=n(i.doc,t.fromCache,t.Jt.has(i.doc.key));return e=i.doc,{type:"added",doc:r,oldIndex:-1,newIndex:s++}})}{let s=t.Ht;return t.docChanges.filter(t=>e||3!==t.type).map(e=>{const i=n(e.doc,t.fromCache,t.Jt.has(e.doc.key));let r=-1,o=-1;return 0!==e.type&&(r=s.indexOf(e.doc.key),s=s.delete(e.doc.key)),1!==e.type&&(o=(s=s.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return _s()}}(e.type),doc:i,oldIndex:r,newIndex:o}})}}(this.Gf,e,this.zf.bind(this)),this.Jf=e),this.Hf}zf(t,e,n){return new Ll(this.Qf,t.key,t,new Wu(n,e),this.query.converter)}}class Pl{constructor(t,e){this.Qf=t,this.Yf=e,this.Xf=[],this.Zf=!1,this.td=xl(t)}set(t,e,n){this.ed();const s=Vl(t,this.Qf),i=Zu(s.x_,e,n),r=Nu(this.td,"WriteBatch.set",s.N_,i,null!==s.x_,n);return this.Xf=this.Xf.concat(r.O_(s.N_,jr.tn())),this}update(t,e,n,...s){this.ed();const i=Vl(t,this.Qf);let r;return r="string"==typeof e||e instanceof pl?xu(this.td,"WriteBatch.update",i.N_,e,n,s):Au(this.td,"WriteBatch.update",i.N_,e),this.Xf=this.Xf.concat(r.O_(i.N_,jr.exists(!0))),this}delete(t){this.ed();const e=Vl(t,this.Qf);return this.Xf=this.Xf.concat(new no(e.N_,jr.tn())),this}commit(){return this.ed(),this.Zf=!0,this.Xf.length>0?this.Yf(this.Xf):Promise.resolve()}ed(){if(this.Zf)throw new xs(As.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Vl(t,e){if(t.firestore!==e)throw new xs(As.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return lo(t,gl)}class Ul extends class{constructor(t,e){this.Qf=t,this.nd=e,this.td=xl(t)}get(t){const e=Vl(t,this.Qf);return this.nd.z_([e.N_]).then(t=>{if(!t||1!==t.length)return _s();const n=t[0];if(n instanceof co)return new kl(this.Qf,e.N_,null,e.x_);if(n instanceof ho)return new kl(this.Qf,n.key,n,e.x_);throw _s()})}set(t,e,n){const s=Vl(t,this.Qf),i=Zu(s.x_,e,n),r=Nu(this.td,"Transaction.set",s.N_,i,null!==s.x_,n);return this.nd.set(s.N_,r),this}update(t,e,n,...s){const i=Vl(t,this.Qf);let r;return r="string"==typeof e||e instanceof pl?xu(this.td,"Transaction.update",i.N_,e,n,s):Au(this.td,"Transaction.update",i.N_,e),this.nd.update(i.N_,r),this}delete(t){const e=Vl(t,this.Qf);return this.nd.delete(e.N_),this}}{constructor(t,e){super(t,e),this.Qf=t}get(t){const e=Vl(t,this.Qf);return super.get(t).then(t=>new Rl(this.Qf,e.N_,t.Kf,new Wu(!1,!1),e.x_))}}function Ml(t,e,n){const s=n.docs.get(e.N_);return new Rl(t,e.N_,s,new Wu(n.hasPendingWrites,n.fromCache),e.x_)}class ql extends cu{}class Fl extends ql{constructor(t){super(),this.m_=t,this.A_=t.A_}R_(t){return this.m_.R_(t)}isEqual(t){return t instanceof Fl&&this.m_.isEqual(t.m_)}}e._registerComponent(new u("firestore-exp",t=>((t,e)=>new fl(t,e))(t.getProvider("app-exp").getImmediate(),t.getProvider("auth-internal")),"PUBLIC")),e.registerVersion("firestore-exp","0.0.800","node"),t.Bytes=yu,t.CollectionReference=Tl,t.DocumentReference=gl,t.DocumentSnapshot=Rl,t.FieldPath=pl,t.FieldValue=ql,t.FirebaseFirestore=fl,t.GeoPoint=mu,t.Query=ml,t.QueryConstraint=yl,t.QueryDocumentSnapshot=Ll,t.QuerySnapshot=Ol,t.SnapshotMetadata=Wu,t.Timestamp=Ps,t.Transaction=Ul,t.WriteBatch=Pl,t.addDoc=function(t,e){const n=lo(t,Tl),s=lo(n.firestore,fl),i=Nl(n),r=Zu(n.converter,e),o=Nu(xl(n.firestore),"addDoc",i.N_,r,null!==n.converter,{});return al(s).then(t=>qu(s.Sf,t,o.O_(i.N_,jr.exists(!1)))).then(()=>i)},t.arrayRemove=function(...t){return Qc("arrayRemove()",arguments,1),new Fl(new pu("arrayRemove",t))},t.arrayUnion=function(...t){return Qc("arrayUnion()",arguments,1),new Fl(new du("arrayUnion",t))},t.clearIndexedDbPersistence=function(t){const e=lo(t,fl);if(e.hf&&!e.lf)throw new xs(As.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const n=new ta;return e.Sf.yi(async()=>{try{await xh(Ah(e.C_,e.rf)),n.resolve()}catch(t){n.reject(t)}}),n.promise},t.collection=function(t,e){if(Sl("collection","path",e),t instanceof zu){const n=Ms.W(e);return tu(n),new Tl(t,null,n)}{if(!(t instanceof gl||t instanceof Tl))throw new xs(As.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const n=Ms.W(t.path).child(Ms.W(e));return tu(n),new Tl(t.firestore,null,n)}},t.collectionGroup=function(t,e){const n=lo(t,zu);if(Sl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new xs(As.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ml(n,null,function(t){return new fo(Ms.K(),t)}(e))},t.deleteDoc=function(t){const e=lo(t,gl),n=lo(e.firestore,fl);return al(n).then(t=>qu(n.Sf,t,[new no(e.N_,jr.tn())]))},t.deleteField=function(){return new Fl(new uu("deleteField"))},t.disableNetwork=function(t){const e=lo(t,fl);return Promise.all([hl(e),ul(e)]).then(([t,n])=>Fu(e.Sf,t,n,!1))},t.doc=Nl,t.documentId=function(){return new pl("__name__")},t.enableIndexedDbPersistence=function(t){const e=lo(t,fl);return dl(e),nl(e,{c_:!0,synchronizeTabs:!1,cacheSizeBytes:e.wf().cacheSizeBytes||va.Zi,So:!1},new zc)},t.enableMultiTabIndexedDbPersistence=function(t){const e=lo(t,fl);dl(e);const n=e.wf(),s=new Hc,i=new Kc(s);return nl(e,{c_:!0,synchronizeTabs:!0,cacheSizeBytes:n.cacheSizeBytes||va.Zi,So:!1},i).then(()=>sl(e,s))},t.enableNetwork=function(t){const e=lo(t,fl);return Promise.all([hl(e),ul(e)]).then(([t,n])=>Fu(e.Sf,t,n,!0))},t.endAt=function(...t){return new Il("endAt",t,!1)},t.endBefore=function(...t){return new Il("endBefore",t,!0)},t.getDoc=function(t){const e=lo(t,gl),n=lo(e.firestore,fl);return cl(n).then(t=>ju(n.Sf,t,e.N_).then(t=>Ml(n,e,t)))},t.getDocFromCache=function(t){const e=lo(t,gl),n=lo(e.firestore,fl);return ll(n).then(t=>(async function(t,e,n){const s=new ta;return await t.enqueue(async()=>{try{const t=await function(t,e){const n=Ns(t);return n.persistence.runTransaction("read document","readonly",t=>n.ya.es(t,e))}(e,n);t instanceof ho?s.resolve(t):t instanceof co?s.resolve(null):s.reject(new xs(As.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const e=ga(t,`Failed to get document '${n} from cache`);s.reject(e)}}),s.promise})(n.Sf,t,e.N_).then(t=>new Rl(n,e.N_,t,new Wu(t instanceof ho&&t.sn,!0),e.x_)))},t.getDocFromServer=function(t){const e=lo(t,gl),n=lo(e.firestore,fl);return cl(n).then(t=>ju(n.Sf,t,e.N_,{source:"server"}).then(t=>Ml(n,e,t)))},t.getDocs=function(t){const e=lo(t,ml),n=lo(t.firestore,fl);return Yu(e.kf),cl(n).then(t=>$u(n.Sf,t,e.kf).then(t=>new Ol(n,e,t)))},t.getDocsFromCache=function(t){const e=lo(t,ml),n=lo(t.firestore,fl);return ll(n).then(t=>(async function(t,e,n){const s=new ta;return await t.enqueue(async()=>{try{const t=await Oh(e,n,!0),i=new hc(n,t.Da),r=i.kh(t.documents),o=i.zn(r,!1);s.resolve(o.snapshot)}catch(t){const e=ga(t,`Failed to execute query '${n} against cache`);s.reject(e)}}),s.promise})(n.Sf,t,e.kf).then(t=>new Ol(n,e,t)))},t.getDocsFromServer=function(t){const e=lo(t,ml),n=lo(t.firestore,fl);return cl(n).then(t=>$u(n.Sf,t,e.kf,{source:"server"}).then(t=>new Ol(n,e,t)))},t.getFirestore=function(t){return e._getProvider(t,"firestore-exp").getImmediate()},t.increment=function(t){return new Fl(new gu("increment",t))},t.initializeFirestore=function(t,n){const s=e._getProvider(t,"firestore-exp").getImmediate();if(void 0!==n.cacheSizeBytes&&n.cacheSizeBytes!==Hu&&n.cacheSizeBytes<va.Xi)throw new xs(As.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+va.Xi);return s.ff(n),s},t.limit=function(t){return su("limit",1,t),new bl("limit",t,"F")},t.limitToLast=function(t){return su("limitToLast",1,t),new bl("limitToLast",t,"L")},t.onSnapshot=function(t,...e){var n,s,i;let r={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Wc(e[o])||(r=e[o],o++);const a={includeMetadataChanges:r.includeMetadataChanges};if(Wc(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let h;if(t instanceof gl){const n=lo(t.firestore,fl),s={next:s=>{e[o]&&e[o](Ml(n,t,s))},error:e[o+1],complete:e[o+2]};h=cl(n).then(e=>Gu(n.Sf,e,go(t.N_.path),a,s))}else{const n=lo(t,ml),s=lo(n.firestore,fl),i={next:t=>{e[o]&&e[o](new Ol(s,n,t))},error:e[o+1],complete:e[o+2]};Yu(n.kf),h=cl(s).then(t=>Gu(s.Sf,t,n.kf,a,i))}return()=>{h.then(t=>t())}},t.onSnapshotsInSync=function(t,e){const n=lo(t,fl),s=Wc(e)?e:{next:e},i=cl(n).then(t=>(function(t,e,n){const s=new Xc(n);return t.di(async()=>(function(t,e){Ns(t).fu.add(e),e.next()})(e,s)),()=>{s.T_(),t.di(async()=>(function(t,e){Ns(t).fu.delete(e)})(e,s))}})(n.Sf,t,s));return()=>{i.then(t=>t())}},t.orderBy=function(t,e="asc"){const n=e,s=Cl("orderBy",t);return new vl(s,n)},t.query=function(t,...e){let n=lo(t,ml);for(const t of e)n=t.apply(n);return n},t.queryEqual=Al,t.refEqual=function(t,e){return(t instanceof gl||t instanceof Tl)&&(e instanceof gl||e instanceof Tl)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter},t.runTransaction=function(t,e){const n=lo(t,fl),s=function(t){var e,n;if(t.lf)throw new xs(As.FAILED_PRECONDITION,"The client has already been terminated.");if(!Bu.has(t)){vs("ComponentProvider","Initializing Datastore");const s=t.wf(),i=new js(t.C_,t.rf,null!==(e=s.host)&&void 0!==e?e:"firestore.googleapis.com",null===(n=s.ssl)||void 0===n||n,!1),r=Gc(i),o=jc(i.nt),a=Gh(t.uf,r,o);Bu.set(t,a)}return Bu.get(t)}(n),i=new ta;return new Mu(new pa,s,t=>e(new Ul(n,t)),i).run(),i.promise},t.serverTimestamp=function(){return new Fl(new fu("serverTimestamp"))},t.setDoc=function(t,e,n){const s=lo(t,gl),i=lo(s.firestore,fl),r=Zu(s.x_,e,n),o=Nu(xl(i),"setDoc",s.N_,r,null!==s.x_,n);return al(i).then(t=>qu(i.Sf,t,o.O_(s.N_,jr.tn())))},t.setLogLevel=function(t){ys.setLogLevel(t)},t.snapshotEqual=function(t,e){return t instanceof Rl&&e instanceof Rl?t.Qf===e.Qf&&t.N_.isEqual(e.N_)&&(null===t.Kf?null===e.Kf:t.Kf.isEqual(e.Kf))&&t.x_===e.x_:t instanceof Ol&&e instanceof Ol&&t.Qf===e.Qf&&Al(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t.Gf.isEqual(e.Gf)},t.startAfter=function(...t){return new El("startAfter",t,!1)},t.startAt=function(...t){return new El("startAt",t,!0)},t.terminate=function(t){return e._removeServiceInstance(t.app,"firestore-exp"),lo(t,fl)._delete()},t.updateDoc=function(t,e,n,...s){const i=lo(t,gl),r=lo(i.firestore,fl),o=xl(r);let a;return a="string"==typeof e||e instanceof pl?xu(o,"updateDoc",i.N_,e,n,s):Au(o,"updateDoc",i.N_,e),al(r).then(t=>qu(r.Sf,t,a.O_(i.N_,jr.exists(!0))))},t.waitForPendingWrites=function(t){const e=lo(t,fl);return al(e).then(t=>(function(t,e){const n=new ta;return t.di(()=>(async function(t,e){const n=Ns(t);n.jh.Sc()||vs("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const s=await function(t){const e=Ns(n.Ac);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.Zn.Sr(t))}();if(-1===s)return void e.resolve();const i=n.sl.get(s)||[];i.push(e),n.sl.set(s,i)}catch(t){const n=ga(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}})(e,n)),n.promise})(e.Sf,t))},t.where=function(t,e,n){const s=e,i=Cl("where",t);return new wl(i,s,n)},t.writeBatch=function(t){const e=lo(t,fl);return new Pl(e,t=>al(e).then(n=>qu(e.Sf,n,t)))},Object.defineProperty(t,"__esModule",{value:!0})}).apply(this,arguments)}catch(t){throw console.error(t),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}});