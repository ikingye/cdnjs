!function(A){A.extend(A.jqx._jqxGrid.prototype,{_handledblclick:function(e,t){var i,l;if(null!=e.target&&!(t.disabled||A(e.target).ischildof(this.columnsheader)||(e.which?i=3==e.which:e.button&&(i=2==e.button),i||(e.which?l=2==e.which:e.button&&(l=1==e.button),l)))){var o=this.showheader?this.columnsheader.height()+2:0,d=this._groupsheader()?this.groupsheader.height():0;d+=this.showtoolbar?this.toolbarheight:0;var s=this.host.offset(),a=e.pageX-s.left,r=e.pageY-o-s.top-d,n=this._hittestrow(a,r);if(n){var c=n.row,h=n.index,u=e.target.className,p=this.table[0].rows[h];if(null!=p){t.mousecaptured=!0,t.mousecaptureposition={left:e.pageX,top:e.pageY-d};for(var f=this.hScrollInstance.value,m=0,v=(this.groupable&&this.groups.length,0);v<p.cells.length;v++){var x,w=parseInt(A(this.columnsrow[0].cells[v]).css("left")),g=w-f;if(t.columns.records[v].pinned&&(g=w),null==(x=this._getcolumnat(v))||!x.hidden)if(a<=g+A(this.columnsrow[0].cells[v]).width()&&g<=a){m=v;break}}null!=c&&(x=this._getcolumnat(m),-1==u.indexOf("jqx-grid-group-expand")&&-1==u.indexOf("jqx-grid-group-collapse")&&-1!=c.boundindex&&t.begincelledit(t.getboundindex(c),x.datafield,x.defaulteditorvalue))}}}},_getpreveditablecolumn:function(e){for(;0<e;){e--;var t=this.getcolumnat(e);if(!t)return null;if(t.editable&&!t.hidden)return t}return null},_getnexteditablecolumn:function(e){for(;e<this.columns.records.length;){e++;var t=this.getcolumnat(e);if(!t)return null;if(t.editable&&!t.hidden)return t}return null},_handleeditkeydown:function(e,t){if(t.handlekeyboardnavigation&&1==t.handlekeyboardnavigation(e))return!0;var i,l,o=e.charCode?e.charCode:e.keyCode?e.keyCode:0;if(t.editEvent=e,t.showfilterrow&&t.filterable&&this.filterrow&&A(e.target).ischildof(this.filterrow))return!0;if(e.target.className&&0<=e.target.className.indexOf("jqx-grid-widget"))return!0;if(t.pageable&&A(e.target).ischildof(this.pager))return!0;if(this.showtoolbar&&A(e.target).ischildof(this.toolbar))return!0;if(this.showeverpresentrow){if(this.addnewrowtop&&A(e.target).ischildof(this.addnewrowtop))return!0;if(this.addnewrowbottom&&A(e.target).ischildof(this.addnewrowbottom))return!0}if(this.showstatusbar&&A(e.target).ischildof(this.statusbar))return!0;if(this.rowdetails&&A(e.target).ischildof(this.content.find("[role='rowgroup']")))return!0;if(this.editcell){if("selectedrow"===this.editmode){if(13===o)return this.endrowedit(this.editcell.row,!1),!1;if(27===o)return this.endrowedit(this.editcell.row,!0),!1;if(32==o)if(this._currentColumn&&"checkbox"==this.getcolumn(this._currentColumn).columntype)if((f=this.getcolumn(this._currentColumn)).editable){var d=!this.getcellvalue(this.editcell.row,f.datafield),s=this.getrowdata(this.editcell.row),a=this.editcell.row,s=t.getrowdata(t.editcell.row);this.setcellvalue(this.editcell.row,f.datafield,d,!1);var r,n=this._focusedColumn,c=this._currentColumn,h=this._currentEditableColumn;return this.endrowedit(this.editcell.row,!1),this.beginrowedit(a,!1),this._currentColumn=c,this._focusedColumn=n,this._currentEditableColumn=h,this._renderrows(),this.selectcell(a,f.datafield),this._oldselectedcell=this.selectedcell,n&&(r=this,setTimeout(function(){r.selectcell(a,f.datafield),r._oldselectedcell=r.selectedcell,A(r._checkboxCells[f.datafield].checkbox).jqxCheckBox("focus")},25)),!1}if(9!==o)return!0;var u=this.editcell.datafield,p=this._getcolumnindex(u);this._currentEditableColumn?p=this._currentEditableColumn:this._currentEditableColumn=p;var f=this._getnexteditablecolumn(p);if((e.shiftKey||this.rtl)&&(f=this._getpreveditablecolumn(p)),f){var m,p=this._getcolumnindex(f.datafield);if(this.editcell[f.datafield])this._currentEditableColumn=p,(m=this.editcell[f.datafield].editor)&&(m.data().jqxWidget&&m.data().jqxWidget.focus?m.data().jqxWidget.focus():(m.focus(),m[0].onkeyup=function(){0!=t.gridcontent[0].scrollTop&&(t.scrolltop(Math.abs(t.gridcontent[0].scrollTop)),t.gridcontent[0].scrollTop=0),0!=t.gridcontent[0].scrollLeft&&(t.gridcontent[0].scrollLeft=0)})),this._focusedColumn=f.datafield,this._currentColumn=f.datafield,0!=this.gridcontent[0].scrollTop&&(this.scrolltop(Math.abs(this.gridcontent[0].scrollTop)),this.gridcontent[0].scrollTop=0),0!=this.gridcontent[0].scrollLeft&&(this.gridcontent[0].scrollLeft=0);else if("checkbox"==f.columntype)return this._currentColumn=f.datafield,this._currentEditableColumn=p,this.selectcell(this.editcell.row,f.datafield),this._oldselectedcell=this.selectedcell,this._checkboxCells[f.datafield]&&A(this._checkboxCells[f.datafield].checkbox).jqxCheckBox("focus"),!1}return!1}if(null==this.editcell.columntype||"textbox"==this.editcell.columntype||"numberinput"==this.editcell.columntype||"combobox"==this.editcell.columntype||"datetimeinput"==this.editcell.columntype?33<=o&&o<=40&&"multiplecellsadvanced"==t.selectionmode&&(m="textbox"==this.editcell.columntype||null==this.editcell.columntype?this.editcell.editor:this.editcell.editor.find("input"),i=t._selection(m),l=m.val().length,0<i.length&&"datetimeinput"!=this.editcell.columntype&&(t._cancelkeydown=!0),0<i.start&&37==o&&(t._cancelkeydown=!0),i.start<l&&39==o&&"datetimeinput"!=this.editcell.columntype&&(t._cancelkeydown=!0),"datetimeinput"==this.editcell.columntype&&39==o&&i.start+i.length<l&&(t._cancelkeydown=!0)):"dropdownlist"==this.editcell.columntype?(37==o||39==o&&"multiplecellsadvanced"==t.selectionmode)&&(t._cancelkeydown=!1):"multiplecellsadvanced"==this.selectionmode&&"textbox"!=this.editcell.columntype&&"numberinput"!=this.editcell.columntype&&(t._cancelkeydown=!0),32==o)if("checkbox"==t.editcell.columntype)if((f=t.getcolumn(t.editcell.datafield)).editable){d=!t.getcellvalue(t.editcell.row,t.editcell.column);if(f.cellbeginedit)if(0==f.cellbeginedit(t.editcell.row,f.datafield,f.columntype,!d))return!1;s=t.getrowdata(t.editcell.row);return t.setcellvalue(t.editcell.row,t.editcell.column,d,!0),t._raiseEvent(18,{rowindex:t.editcell.row,row:s,datafield:t.editcell.column,oldvalue:!d,value:d,columntype:"checkbox"}),!1}if(9==o){var v=this.editcell.row,x=u=this.editcell.column,p=t._getcolumnindex(u),w=!1,g=t.getrowvisibleindex(v),b=v;this.editchar="";var y,_,q,j,I=this.editcell.validated;if(this.editcell.validated||(I=this.endcelledit(this.editcell.row,this.editcell.column,!1,!0,!1)),0!=I){if(e.shiftKey||this.rtl?(f=t._getpreveditablecolumn(p))?(u=f.datafield,w=!0,-1!=t.selectionmode.indexOf("cell")&&(t.selectprevcell(v,x),t._oldselectedcell=t.selectedcell,setTimeout(function(){t.ensurecellvisible(g,u)},10))):(y=t._getlastvisiblecolumn(),w=!0,u=y.displayfield,(q=t.getdisplayrows()[g-1])&&(void 0===(v=q.dataindex)&&(v=q.boundindex),g=t.getrowvisibleindex(v)),j=!0,t.pageable&&(D=Math.floor(g/this.pagesize),this.dataview.pagenum!=D&&(j=!1)),j&&-1!=t.selectionmode.indexOf("cell")&&(t.clearselection(),t.selectcell(v,u),t._oldselectedcell=t.selectedcell,setTimeout(function(){t.ensurecellvisible(g,u)},10))):(f=t._getnexteditablecolumn(p))?(u=f.datafield,w=!0,-1!=t.selectionmode.indexOf("cell")&&(t.selectnextcell(v,x),t._oldselectedcell=t.selectedcell,setTimeout(function(){t.ensurecellvisible(g,u)},10))):(_=t._getfirstvisiblecolumn(),w=!0,u=_.displayfield,(q=t.getdisplayrows()[g+1])&&(void 0===(v=q.dataindex)&&(v=q.boundindex),g=t.getrowvisibleindex(v)),j=!0,t.pageable&&(D=Math.floor(g/this.pagesize),this.dataview.pagenum!=D&&(j=!1)),-1!=t.selectionmode.indexOf("cell")&&j&&(t.clearselection(),t.selectcell(v,u),t._oldselectedcell=t.selectedcell,setTimeout(function(){t.ensurecellvisible(g,u)},10))),!w)return null!=this.editcell&&(t.endcelledit(v,u,!1),this._renderrows(this.virtualsizeinfo)),!0;if(t.pageable){var D=Math.floor(g/this.pagesize);if(this.dataview.pagenum!=D)return this._renderrows(this.virtualsizeinfo),-1!=t.selectionmode.indexOf("cell")&&(t.clearselection(),t.selectcell(b,x),t._oldselectedcell=t.selectedcell),void(D>this.dataview.pagenum&&setTimeout(function(){t.pagerpageinput.focus()},25))}t.begincelledit(v,u),null!=this.editcell&&"checkbox"==this.editcell.columntype&&this._renderrows(this.virtualsizeinfo)}return!1}if(13==o){var C,T,k=this.selectedcell;return k&&(C=this.getrowvisibleindex(k.rowindex)),this.endcelledit(this.editcell.row,this.editcell.column,!1,!0),"multiplecellsadvanced"==this.selectionmode&&null!=(H=t.getselectedcell())&&t.selectcell&&null==this.editcell&&H.rowindex+1<this.dataview.totalrecords&&(this.sortcolumn!=H.datafield?(g=this.getrowvisibleindex(H.rowindex),(N=this.dataview.loadedrecords[g+1])&&(!this.pageable||this.pageable&&g+1<(this.dataview.pagenum+1)*this.pagesize)&&(this.clearselection(!1),this.selectcell(this.getboundindex(N),H.datafield),H=this.getselectedcell(),this.ensurecellvisible(N.visibleindex,H.datafield))):null==k||(T=this.dataview.loadedrecords[C+1])&&(!this.pageable||this.pageable&&C+1<this.pagesize?(this.clearselection(!1),this.selectcell(this.getboundindex(T),H.datafield)):this.pageable&&C+1>=this.pagesize&&(this.clearselection(!1),T=this.dataview.loadedrecords[C],this.selectcell(this.getboundindex(T),H.datafield)))),!1}if(27==o)return this.endcelledit(this.editcell.row,this.editcell.column,!0,!0),!1}else{var z,S=113==o?!0:!1;if(!e.ctrlKey&&!e.altKey&&!e.metaKey){48<=o&&o<=57&&(this.editchar=String.fromCharCode(o),S=!0),189===o&&(S=!0),65<=o&&o<=90?(this.editchar=String.fromCharCode(o),z=!1,e.shiftKey?z=e.shiftKey:e.modifiers&&(z=!!(4&e.modifiers)),this._capsLock&&(z=!z),z||(this.editchar=this.editchar.toLowerCase()),S=!0):96<=o&&o<=105&&(this.editchar=o-96,this.editchar=this.editchar.toString(),S=!0);var O=A(".jqx-grid").length,S=S&&(1==O||1<O&&t.focused),B=A.data(document.body,"jqxgrid.edit");if(void 0!==B&&""!==B&&(13===o||S)&&B!=t.element.id)return!0}if((13==o||S)&&t.getselectedrowindex){var N,v=t.getselectedrowindex();if("selectedrow"===t.editmode){if(!(0<=v))return null!=(H=t.getselectedcell())&&(f=t._getcolumnbydatafield(H.datafield),t.beginrowedit(H.rowindex)),!1;t.beginrowedit(v)}switch(t.selectionmode){case"singlerow":case"multiplerows":case"multiplerowsextended":if(0<=v){for(var u="",L=0;L<t.columns.records.length;L++){if((f=t.getcolumnat(L)).editable){u=f.datafield;break}}"selectedrow"===t.editmode?t.beginrowedit(v):t.begincelledit(v,u)}break;case"singlecell":case"multiplecells":case"multiplecellsextended":null!=(H=t.getselectedcell())&&(f=t._getcolumnbydatafield(H.datafield),"selectedrow"===t.editmode?t.beginrowedit(H.rowindex):"checkbox"!=f.columntype&&t.begincelledit(H.rowindex,H.datafield));break;case"multiplecellsadvanced":null!=(H=t.getselectedcell())&&(13==o?t.selectcell&&(g=this.getrowvisibleindex(H.rowindex))+1<t.dataview.totalrecords&&(N=this.dataview.loadedrecords[g+1])&&(this.clearselection(!1),this.selectcell(this.getboundindex(N),H.datafield),H=this.getselectedcell(),this.ensurecellvisible(N.visibleindex,H.datafield)):"selectedrow"!==t.editmode&&t.begincelledit(H.rowindex,H.datafield))}return!1}if(46==o){var E=t.getselectedcells();if(-1==t.selectionmode.indexOf("cell")&&t._getcellsforcopypaste&&(E=t._getcellsforcopypaste()),null!=E&&0<E.length){for(var H,M=0;M<E.length;M++){if((H=E[M]).datafield){var f=t.getcolumn(H.datafield),P=t.getcellvalue(H.rowindex,H.datafield);if(""!==P&&f.editable&&t.enablekeyboarddelete){var R=null;if("checkbox"==f.columntype&&(f.threestatecheckbox||(R=!1)),f.cellbeginedit)if(0==f.cellbeginedit(H.rowindex,f.datafield,f.columntype,R))return!1;s=t.getrowdata(H.rowindex);t._raiseEvent(17,{rowindex:H.rowindex,row:s,datafield:H.datafield,value:P}),M==E.length-1?t.setcellvalue(H.rowindex,H.datafield,R,!0):t.setcellvalue(H.rowindex,H.datafield,R,!1),f.displayfield!=f.datafield&&t.setcellvalue(H.rowindex,f.displayfield,R,!0),f.cellendedit&&f.cellendedit(H.rowindex,f.datafield,f.columntype,R),t._raiseEvent(18,{rowindex:H.rowindex,row:s,datafield:H.datafield,oldvalue:P,value:R})}}}return this.dataview.updateview(),this._renderrows(this.virtualsizeinfo),!1}}if(32==o)if(null!=(H=t.getselectedcell()))if("checkbox"==(f=t.getcolumn(H.datafield)).columntype&&f.editable){d=!t.getcellvalue(H.rowindex,H.datafield);if(f.cellbeginedit)if(0==f.cellbeginedit(H.rowindex,f.datafield,f.columntype,!d))return!1;s=t.getrowdata(H.rowindex);return t._raiseEvent(17,{rowindex:H.rowindex,row:s,datafield:H.datafield,value:!d,columntype:"checkbox"}),t.setcellvalue(H.rowindex,H.datafield,d,!0),t._raiseEvent(18,{rowindex:H.rowindex,row:s,datafield:H.datafield,oldvalue:!d,value:d,columntype:"checkbox"}),!1}}return!0},begincelledit:function(e,t,i,l,o){var d=this.getcolumn(t);if(this._cellscache=new Array,null!=t&&"number"!=d.columntype&&"button"!=d.columntype&&!d.createwidget){if(this.groupable){if(0<=this.groups.indexOf(t))return;if(0<=this.groups.indexOf(d.displayfield))return}if(null==this.editrow){if(this.editcell){if(this.editcell.row==e&&this.editcell.column==t)return!0;if("selectedrow"===this.editmode&&this.editcell.row==e)return;if(0==this.endcelledit(this.editcell.row,this.editcell.column,!1,!0,!1))return}var s="checkbox"==d.columntype||"button"==d.columntype||d.createwidget;if(this.host.removeClass("jqx-disableselect"),this.content.removeClass("jqx-disableselect"),d.editable){if(d.cellbeginedit){var a=this.getcell(e,t);if(0==d.cellbeginedit(e,t,d.columntype,null!=a?a.value:null))return}var r,n,c=this.getrowvisibleindex(e);if(this.editcell=this.getcell(e,t),this.editcell)if(this.editcell.visiblerowindex=c,!this.editcell.editing)if(s||(this.editcell.editing=!0),this.editcell.columntype=d.columntype,this.editcell.defaultvalue=i,null!=d.defaultvalue&&(this.editcell.defaultvalue=d.defaultvalue),this.editcell.init=!0,"checkbox"!=d.columntype&&"selectedrow"!=this.editmode&&(r=this.getrowdata(e),this._raiseEvent(17,{rowindex:e,row:r,datafield:d.datafield,value:this.editcell.value,columntype:d.columntype})),A.data(document.body,"jqxgrid.edit",this.element.id),s||(n=this.getrowvisibleindex(e),!1!==l&&(this.autorowheight||0!==this.groups.length||this.ensurecellvisible(n,d.datafield)),!1!==o&&this._renderrows(this.virtualsizeinfo)),this.editcell)return!(this.editcell.init=!1)}else{if(!this.editcell)return void(this.editchar="");this.editchar="",this.editcell.editor=null,(this.editcell.editing=!1)!==o&&this._renderrows(this.virtualsizeinfo),this.editcell=null}}}},getScrollTop:function(){if(this._py)return this._py;if(this._py="undefined"!=typeof pageYOffset,this._py)return pageYOffset;var e=document.body,t=document.documentElement;return(t=t.clientHeight?t:e).scrollTop},getScrollLeft:function(){if("undefined"!=typeof pageXOffset)return pageXOffset;var e=document.body,t=document.documentElement;return(t=t.clientHeight?t:e).scrollLeft},endcelledit:function(l,o,e,d,i){if(null!=l&&null!=o||(this.editcell&&(l=this.editcell.row,o=this.editcell.column),null==e&&(e=!0)),this.editcell){var s=this.getcolumn(o),a=this;if("selectedrow"!==a.editmode){function r(){if(0!=i){if(a.isTouchDevice())return;if(!a.isNestedGrid){var e=a.getScrollTop(),t=a.getScrollLeft();try{a.element.focus(),a.content.focus(),e!=a.getScrollTop()&&window.scrollTo(t,e),setTimeout(function(){a.element.focus(),a.content.focus(),e!=a.getScrollTop()&&window.scrollTo(t,e)},10)}catch(e){}}}}if("checkbox"==s.columntype||"button"==s.columntype||s.createwidget)return this.editcell&&(this.editcell.editor=null,this.editcell.editing=!1,this.editcell=null),!0;function t(e){var t;e._hidecelleditor(),s.cellendedit&&s.cellendedit(l,o,s.columntype,e.editcell.value,u),e.editchar=null,s.displayfield!=s.datafield&&(t=e.getcellvalue(e.editcell.row,s.displayfield)),e.editcell.value;var i=e.getrowdata(l);e._raiseEvent(18,{rowindex:l,row:i,datafield:o,displayfield:s.displayfield,oldvalue:u,value:u,columntype:s.columntype}),e.editcell.editor=null,e.editcell.editing=!1,e.editcell=null,!d&&null!=d||e._renderrows(e.virtualsizeinfo),r(),e.enablebrowserselection||(e.host.addClass("jqx-disableselect"),e.content.addClass("jqx-disableselect"))}var n,c,h,u=this._geteditorvalue(s);if(e)return t(this),!1;if(this.validationpopup&&(this.validationpopup.hide(),this.validationpopuparrow.hide()),!s.cellvaluechanging||null!=(n=s.cellvaluechanging(l,o,s.columntype,this.editcell.value,u))&&(u=n),s.validation){var p=this.getcell(l,o);try{var f=s.validation(p,u),m=this.gridlocalization.validationstring;if(null!=f.message&&(m=f.message),!("boolean"==typeof f?f:f.result))return null!=f.showmessage&&1!=f.showmessage||this._showvalidationpopup(l,o,m),this.editcell.validated=!1}catch(e){return this._showvalidationpopup(l,o,this.gridlocalization.validationstring),this.editcell.validated=!1}}h=s.displayfield!=s.datafield?(c=this.getcellvalue(this.editcell.row,s.displayfield),{value:this.editcell.value,label:c}):this.editcell.value;var v=this.getrowdata(l);if(s.cellendedit)if(0==s.cellendedit(l,o,s.columntype,this.editcell.value,u))return this._raiseEvent(18,{rowindex:l,row:v,datafield:o,displayfield:s.displayfield,oldvalue:h,value:h,columntype:s.columntype}),t(this),!1;return this._raiseEvent(18,{rowindex:l,row:v,datafield:o,displayfield:s.displayfield,oldvalue:h,value:u,columntype:s.columntype}),this._hidecelleditor(!1),null!=this.editcell&&(this.editcell.editor=null,this.editcell.editing=!1),this.editcell=null,this.editchar=null,this.setcellvalue(l,o,u,d),this.enablebrowserselection||(this.host.addClass("jqx-disableselect"),this.content.addClass("jqx-disableselect")),A.jqx.browser.msie||r(),A.data(document.body,"jqxgrid.edit",""),!0}this.endrowedit(l,e)}},beginrowedit:function(o){var e,t,d,s=this;null!=o&&(s._oldselectedrow=o,this._cellscache=new Array,e=!1,"selectedrow"!=this.editmode&&(e=!0),e&&(t=this.editmode,this.editmode="selectedrow"),d=null,this._currentEditableColumn&&(d=this.getcolumnat(this._currentEditableColumn).datafield),A.each(this.columns.records,function(e,t){if(s.editable&&this.editable){if("checkbox"===this.columntype||"custom"===this.columntype||"widget"===this.columntype||"template"===this.columntype||"button"===this.columntype)return!0;d=d||this.datafield;var i=s.getcell(o,this.datafield);s.begincelledit(o,this.datafield,null,!1,!1);var l=s.getrowdata(o);s._raiseEvent(17,{rowindex:o,row:l,datafield:this.datafield,value:i.value,columntype:this.columntype})}}),s.editcell&&(s.editcell.init=!0),this._renderrows(this.virtualsizeinfo),e&&(this.editmode=t),d&&s.editcell&&setTimeout(function(){var e;s.editcell&&s.editcell[d]&&((e=s.editcell[d].editor)&&(e.data().jqxWidget&&e.data().jqxWidget.focus?e.data().jqxWidget.focus():e.focus()))},25))},endrowedit:function(o,e){var d=this;if(this._currentEditableColumn=0,this._focusedColumn=null,this._currentColumn=null,this._checkboxCells=[],!this.editcell)return!1;if(null==this.editcell.editor&&"checkbox"!==this.editcell.columntype)return!1;var t,i=!1;"selectedrow"!=this.editmode&&(i=!0),i&&(t=this.editmode,this.editmode="selectedrow");var l=!1,s={};this.validationpopup&&(this.validationpopup.hide(),this.validationpopuparrow.hide());for(var a=0;a<this.columns.records.length;a++){if((w=this.columns.records[a]).editable&&(!w.hidden&&"checkbox"!=w.columntype&&!w.createwidget)){var r,n=this._geteditorvalue(w),c=function(e){e._hidecelleditor();var t=e.getcellvalue(e.editcell.row,w.displayfield);w.cellendedit&&w.cellendedit(o,u,w.columntype,t,n),e.editchar=null,w.displayfield!=w.datafield&&e.getcellvalue(e.editcell.row,w.displayfield);var i=e.getrowdata(o);e._raiseEvent(18,{rowindex:o,row:i,datafield:u,displayfield:w.displayfield,oldvalue:t,value:t,columntype:w.columntype}),e.editcell.editing=!1};if(e)c(this);else{w.cellvaluechanging&&(b=this.getcellvalue(this.editcell.row,w.displayfield),null!=(r=w.cellvaluechanging(o,u,w.columntype,b,n))&&(n=r));var h,u=w.datafield;if(w.validation){var p=this.getcell(o,w.datafield);try{var f=w.validation(p,n),m=this.gridlocalization.validationstring;if(null!=f.message&&(m=f.message),!(_="boolean"==typeof f?f:f.result)){null!=f.showmessage&&1!=f.showmessage||this._showvalidationpopup(o,u,m),l=!0,this.editcell[w.datafield].validated=!1;continue}}catch(e){this._showvalidationpopup(o,u,this.gridlocalization.validationstring),l=!(this.editcell[w.datafield].validated=!1);continue}}b=w.displayfield!=w.datafield?(h=this.getcellvalue(this.editcell.row,w.displayfield),{value:this.editcell.value,label:h}):this.getcellvalue(this.editcell.row,w.displayfield),s[w.datafield]={newvalue:n,oldvalue:b}}}}var v={},x={};if(!l){this._hidecelleditor(!1);for(a=0;a<this.columns.records.length;a++){var w,u=(w=this.columns.records[a]).datafield;if(!w.hidden&&w.editable){var g=this.getrowdata(o);if(!w.createwidget)if("checkbox"!=w.columntype){if(s[w.datafield]){var n=s[w.datafield].newvalue,b=s[w.datafield].oldvalue;if(w.cellendedit)if(0==w.cellendedit(o,u,w.columntype,b,n)){this._raiseEvent(18,{rowindex:o,row:g,datafield:u,displayfield:w.displayfield,oldvalue:b,value:b,columntype:w.columntype}),c(this);continue}this.source.updaterow||this._raiseEvent(18,{rowindex:o,row:g,datafield:w.datafield,displayfield:w.displayfield,oldvalue:b,value:n,columntype:w.columntype}),v[w.datafield]=n,x[w.datafield]=b}}else{n=this.getcellvalue(o,w.displayfield);this._raiseEvent(18,{rowindex:o,row:g,datafield:w.datafield,displayfield:w.displayfield,oldvalue:n,value:n,columntype:w.columntype})}}}var y=this.getrowid(o),g=this.getrowdata(o);if(A.each(v,function(e,t){var i;t&&null!=t.label?(i=d.getcolumn(e),g[i.displayfield]=t.label,g[i.datafield]=t.value):g[e]=t}),this.enablebrowserselection||(this.host.addClass("jqx-disableselect"),this.content.addClass("jqx-disableselect")),A.data(document.body,"jqxgrid.edit",""),this.editcell=null,this.editchar=null,this.source.updaterow&&!e){var d=this,_=function(e){var t=d.source.updaterow;d.source.updaterow=null,0==e&&A.each(x,function(e,t){var i;t&&null!=t.label?(i=d.getcolumn(e),g[i.displayfield]=t.label,g[i.datafield]=t.value):g[e]=t}),d.updaterow(y,g);for(var i=0;i<d.columns.records.length;i++){var l=d.columns.records[i];l.datafield;d._raiseEvent(18,{rowindex:o,datafield:l.datafield,row:g,displayfield:l.displayfield,oldvalue:x[l.datafield],value:g[l.displayfield],columntype:l.columntype})}d.source.updaterow=t};try{null==this.source.updaterow(y,g,_)&&0}catch(e){return void 0}}else e||this.updaterow(y,g),this._renderrows(this.virtualsizeinfo)}return i&&(this.editmode=t),l},_selection:function(e){if("selectionStart"in e[0]){var t=e[0],i=t.selectionEnd-t.selectionStart;return{start:t.selectionStart,end:t.selectionEnd,length:i,text:t.value}}var l=document.selection.createRange();if(null==l)return{start:0,end:t.value.length,length:0};var o=e[0].createTextRange(),d=o.duplicate();o.moveToBookmark(l.getBookmark()),d.setEndPoint("EndToStart",o);i=l.text.length;return{start:d.text.length,end:d.text.length+l.text.length,length:i,text:l.text}},_setSelection:function(e,t,i){try{var l;"selectionStart"in e?e.setSelectionRange(t,i):((l=e.createTextRange()).collapse(!0),l.moveEnd("character",i),l.moveStart("character",t),l.select())}catch(e){}},findRecordIndex:function(e,t,i){i=i;if(t)for(var l=i.length,o=0;o<l;o++){if(e==i[o].label)return o}return-1},_destroyeditors:function(){var c=this;this.columns.records&&(A.each(this.columns.records,function(e,t){var i=A.trim(this.datafield).split(" ").join("");switch(this.columntype){case"dropdownlist":var l=c.editors["dropdownlist_"+i];l&&(l.jqxDropDownList("destroy"),c.editors["dropdownlist_"+i]=null);break;case"combobox":var o=c.editors["combobox_"+i];o&&(o.jqxComboBox("destroy"),c.editors["combobox_"+i]=null);break;case"datetimeinput":var d=c.editors["datetimeinput_"+this.datafield];d&&(d.jqxDateTimeInput("destroy"),c.editors["datetimeinput_"+i]=null);break;case"numberinput":var s=c.editors["numberinput_"+i];s&&(s.jqxNumberInput("destroy"),c.editors["numberinput_"+i]=null);break;case"custom":case"template":if(c.destroyeditor&&c.editors["templateeditor_"+i]&&(c.destroyeditor(c.editors["templateeditor_"+i]),c.editors["templateeditor_"+i]=null),c.destroyeditor)for(var a=c.getrows.length(),r=0;r<a;r++)c.editors["customeditor_"+i+"_"+r]&&(c.destroyeditor(c.editors["customeditor_"+i+"_"+r],r),c.editors["customeditor_"+i+"_"+r]=null);break;case"textbox":default:var n=c.editors["textboxeditor_"+i];n&&(c.removeHandler(n,"keydown"),c.editors["textbox_"+i]=null)}}),c.editors=new Array)},_showcelleditor:function(e,n,t,i,l){if(null!=t&&null!=this.editcell)if("checkbox"==n.columntype&&n.editable)"selectedrow"==this.editmode&&(this._checkboxCells||(this._checkboxCells=[]),this._checkboxCells[n.datafield]=t);else{null==l&&(l=!0),"selectedrow"==this.editmode&&(this.editchar="",l=!1);var o,d=n.datafield,s=A(t),c=this,h=this.editcell.editor,a=this.getcellvalue(e,d),r=this.getcelltext(e,d),u=this.hScrollInstance.value,p=parseInt(u);this.columns.records.indexOf(n);this.editcell.element=t,0==this.editcell.validated&&(o="",this.validationpopup&&(o=this.validationpopup.text()),this._showvalidationpopup(e,d,o));function f(e){c.hScrollInstance.isScrolling()||c.vScrollInstance.isScrolling()||l&&(c.isTouchDevice()||(e&&e.focus(),0!=c.gridcontent[0].scrollTop&&(c.scrolltop(Math.abs(c.gridcontent[0].scrollTop)),c.gridcontent[0].scrollTop=0),0!=c.gridcontent[0].scrollLeft&&(c.gridcontent[0].scrollLeft=0)))}var m,v,x,w,g,b,y,_,q,j,I;switch(n.columntype){case"dropdownlist":if(this.host.jqxDropDownList){t.innerHTML="";var D=A.trim(n.datafield).split(" ").join(""),C=A.trim(n.displayfield).split(" ").join("");-1!=D.indexOf(".")&&(D=D.replace(".","")),-1!=C.indexOf(".")&&(C=C.replace(".",""));var T=this.editors["dropdownlist_"+D];(h=null==T?A("<div style='border: none; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='dropdownlisteditor'></div>"):T).css("top",A(t).parent().position().top),this.oldhscroll?h.css("left",-p+parseInt(A(t).position().left)):h.css("left",parseInt(A(t).position().left)),n.pinned&&h.css("left",p+parseInt(A(t).position().left)),null==T&&(h.prependTo(this.table),h[0].id="dropdownlisteditor"+this.element.id+D,S=null,S=!!this.source._source?(O={localdata:JSON.parse(JSON.stringify(this.source.records)),datatype:this.source.datatype,async:!1},new A.jqx.dataAdapter(O,{autoBind:!1,async:!1,uniqueDataFields:[C],autoSort:!0,autoSortField:C})):new A.jqx.dataAdapter(this.source,{autoBind:!1,uniqueDataFields:[C],async:!1,autoSort:!0,autoSortField:C}),B=!n.createeditor,h.jqxDropDownList({hint:!1,enableBrowserBoundsDetection:!0,keyboardSelection:!1,source:S,rtl:this.rtl,autoDropDownHeight:B,theme:this.theme,width:s.width(),height:s.height(),displayMember:C,valueMember:d}),this.editors["dropdownlist_"+D]=h,n.createeditor&&n.createeditor(e,a,h)),n._requirewidthupdate&&h.jqxDropDownList({width:s.width()});var k=h.jqxDropDownList("listBox").visibleItems;n.createeditor||(k.length<8?h.jqxDropDownList("autoDropDownHeight",!0):h.jqxDropDownList("autoDropDownHeight",!1));var a=this.getcellvalue(e,C),z=this.findRecordIndex(a,C,k);if(i&&(""!=a?h.jqxDropDownList("selectIndex",z,!0):h.jqxDropDownList("selectIndex",-1)),!this.editcell)return;null!=this.editcell.defaultvalue&&h.jqxDropDownList("selectIndex",this.editcell.defaultvalue,!0),l&&h.jqxDropDownList("focus")}break;case"combobox":if(this.host.jqxComboBox){t.innerHTML="";var D=A.trim(n.datafield).split(" ").join(""),C=A.trim(n.displayfield).split(" ").join("");-1!=D.indexOf(".")&&(D=D.replace(".","")),-1!=C.indexOf(".")&&(C=C.replace(".",""));var S,O,B,N=this.editors["combobox_"+D];(h=null==N?A("<div style='border: none; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='comboboxeditor'></div>"):N).css("top",A(t).parent().position().top),this.oldhscroll?h.css("left",-p+parseInt(A(t).position().left)):h.css("left",parseInt(A(t).position().left)),n.pinned&&h.css("left",p+parseInt(A(t).position().left)),null==N&&(h.prependTo(this.table),h[0].id="comboboxeditor"+this.element.id+D,S=null,S=!!this.source._source?(O={localdata:JSON.parse(JSON.stringify(this.source.records)),datatype:this.source.datatype,async:!1},new A.jqx.dataAdapter(O,{autoBind:!1,async:!1,uniqueDataFields:[C],autoSort:!0,autoSortField:C})):new A.jqx.dataAdapter(this.source,{autoBind:!1,uniqueDataFields:[C],async:!1,autoSort:!0,autoSortField:C}),B=!n.createeditor,h.jqxComboBox({hint:!1,enableBrowserBoundsDetection:!0,keyboardSelection:!1,source:S,rtl:this.rtl,autoDropDownHeight:B,theme:this.theme,width:s.width(),height:s.height(),displayMember:C,valueMember:d}),h.removeAttr("tabindex"),h.find("div").removeAttr("tabindex"),this.editors["combobox_"+D]=h,n.createeditor&&n.createeditor(e,a,h)),n._requirewidthupdate&&h.jqxComboBox({width:s.width()-2});k=h.jqxComboBox("listBox").visibleItems;n.createeditor||(k.length<8?h.jqxComboBox("autoDropDownHeight",!0):h.jqxComboBox("autoDropDownHeight",!1));a=this.getcellvalue(e,C),z=this.findRecordIndex(a,C,k);if(i&&(""!=a?h.jqxComboBox("selectIndex",z,!0):h.jqxComboBox("selectIndex",-1),h.jqxComboBox("val",a)),!this.editcell)return;null!=this.editcell.defaultvalue&&h.jqxComboBox("selectIndex",this.editcell.defaultvalue,!0),this.editchar&&0<this.editchar.length&&h.jqxComboBox("input").val(this.editchar),l&&setTimeout(function(){var e;f(h.jqxComboBox("input")),h&&(h.jqxComboBox("_setSelection",0,0),c.editchar?(h.jqxComboBox("_setSelection",1,1),c.editchar=null):h.jqxComboBox("input")&&(e=h.jqxComboBox("input").val(),h.jqxComboBox("_setSelection",0,e.length)))},10)}break;case"datetimeinput":this.host.jqxDateTimeInput&&(t.innerHTML="",-1!=(D=A.trim(n.datafield).split(" ").join("")).indexOf(".")&&(D=D.replace(".","")),m=this.editors["datetimeinput_"+D],(h=null==m?A("<div style='border: none; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='datetimeeditor'></div>"):m).show(),h.css("top",A(t).parent().position().top),this.oldhscroll?h.css("left",-p+parseInt(A(t).position().left)):h.css("left",parseInt(A(t).position().left)),n.pinned&&h.css("left",p+parseInt(A(t).position().left)),null==m&&(h.prependTo(this.table),h[0].id="datetimeeditor"+this.element.id+D,v={calendar:this.gridlocalization},h.jqxDateTimeInput({hint:!1,firstDayOfWeek:this.gridlocalization.firstDay,enableBrowserBoundsDetection:!0,localization:v,_editor:!0,theme:this.theme,rtl:this.rtl,width:s.width(),height:s.height(),formatString:n.cellsformat}),this.editors["datetimeinput_"+D]=h,n.createeditor&&n.createeditor(e,a,h)),n._requirewidthupdate&&h.jqxDateTimeInput({width:s.width()}),i&&(""!=a&&null!=a?("Invalid Date"==(x=new Date(a))&&this.source.getvaluebytype&&(x=this.source.getvaluebytype(a,{name:n.datafield,type:"date"})),h.jqxDateTimeInput("setDate",x)):h.jqxDateTimeInput("setDate",null),null!=this.editcell.defaultvalue&&h.jqxDateTimeInput("setDate",this.editcell.defaultvalue)),l&&(w=this.editEvent,setTimeout(function(){f(h.jqxDateTimeInput("dateTimeInput")),setTimeout(function(){var e,t;h.jqxDateTimeInput("_selectGroup",0),c.editchar&&0<c.editchar.length&&(e=parseInt(c.editchar),isNaN(e)||w&&(t=w.charCode?w.charCode:w.keyCode?w.keyCode:0,h.jqxDateTimeInput("_handleKeyPress",w,t)))},25)},10)));break;case"numberinput":this.host.jqxNumberInput&&(t.innerHTML="",-1!=(D=A.trim(n.datafield).split(" ").join("")).indexOf(".")&&(D=D.replace(".","")),g=this.editors["numberinput_"+D],(h=null==g?A("<div style='border:none; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='numbereditor'></div>"):g).show(),h.css("top",A(t).parent().position().top),this.oldhscroll?h.css("left",-p+parseInt(A(t).position().left)):h.css("left",parseInt(A(t).position().left)),n.pinned&&h.css("left",p+parseInt(A(t).position().left)),null==g&&(h.prependTo(this.table),h[0].id="numbereditor"+this.element.id+D,b="",y="left",_=2,n.cellsformat?-1!=n.cellsformat.indexOf("c")?(b=this.gridlocalization.currencysymbol,y="before"==(y=this.gridlocalization.currencysymbolposition)?"left":"right",1<n.cellsformat.length&&(_=parseInt(n.cellsformat.substring(1),10))):-1!=n.cellsformat.indexOf("p")&&(b=this.gridlocalization.percentsymbol,y="right",1<n.cellsformat.length&&(_=parseInt(n.cellsformat.substring(1),10))):_=0,h.jqxNumberInput({decimalSeparator:this.gridlocalization.decimalseparator,decimalDigits:_,inputMode:"simple",theme:this.theme,rtl:this.rtl,width:s.width(),height:s.height(),spinButtons:!0,symbol:b,symbolPosition:y}),this.editors["numberinput_"+D]=h,n.createeditor&&n.createeditor(e,a,h)),n._requirewidthupdate&&h.jqxNumberInput({width:s.width()}),i&&(""!=a&&null!=a?(I=a,h.jqxNumberInput("setDecimal",I)):h.jqxNumberInput("setDecimal",0),null!=this.editcell.defaultvalue&&h.jqxNumberInput("setDecimal",this.editcell.defaultvalue),this.editchar&&0<this.editchar.length&&(q=parseInt(this.editchar),isNaN(q)||h.jqxNumberInput("setDecimal",q)),l&&setTimeout(function(){var e;f(h.jqxNumberInput("numberInput")),h.jqxNumberInput("_setSelectionStart",0),c.editchar?(0<n.cellsformat.length&&0<=n.cellsformat.indexOf("c")?h.jqxNumberInput("_setSelectionStart",2):h.jqxNumberInput("_setSelectionStart",1),c.editchar=null):(h.jqxNumberInput("spinButtons")?(e=h.jqxNumberInput("numberInput").val(),c._setSelection(h.jqxNumberInput("numberInput")[0],e.length,e.length)):(e=h.jqxNumberInput("numberInput").val(),c._setSelection(h.jqxNumberInput("numberInput")[0],0,e.length)),h.jqxNumberInput("selectAll"))},10)));break;case"rating":this.host.jqxRating&&(t.innerHTML="",-1!=(D=A.trim(n.datafield).split(" ").join("")).indexOf(".")&&(D=D.replace(".","")),j=this.editors["rating_"+D],(h=null==j?A("<div style='margin: 5px;white-space: nowrap; overflow: auto; border:none; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='ratingEditor'></div>"):j).show(),h.css("top",A(t).parent().position().top),this.oldhscroll?h.css("left",-p+parseInt(A(t).position().left)):h.css("left",parseInt(A(t).position().left)),n.pinned&&h.css("left",p+parseInt(A(t).position().left)),null==j&&(h.prependTo(this.table),h[0].id="ratingEditor"+this.element.id+D,h.jqxRating({theme:this.theme,width:s.width(),height:s.height()}),this.editors["numberinput_"+D]=h,n.createeditor&&n.createeditor(e,a,h)),n._requirewidthupdate&&h.jqxRating({width:s.width()}),i&&(""!=a&&null!=a?(I=a,h.jqxRating("val",I)):h.jqxRating("val",0),null!=this.editcell.defaultvalue&&h.jqxRating("val",this.editcell.defaultvalue)));break;case"custom":t.innerHTML="",-1!=(D=A.trim(n.datafield).split(" ").join("")).indexOf(".")&&(D=D.replace(".",""));var L=this.editors["customeditor_"+D+"_"+e];(h=null==L?A("<div style='overflow: hidden; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='customeditor'></div>"):L).show(),h.css("top",A(t).parent().position().top),this.oldhscroll?h.css("left",-p+parseInt(A(t).position().left)):h.css("left",parseInt(A(t).position().left)),n.pinned&&h.css("left",p+parseInt(A(t).position().left)),null==L&&(h.prependTo(this.table),h[0].id="customeditor"+this.element.id+D+"_"+e,this.editors["customeditor_"+D+"_"+e]=h,E=s.width()-1,H=s.height()-1,h.width(E),h.height(H),n.createeditor&&n.createeditor(e,a,h,r,E,H,this.editchar)),n._requirewidthupdate&&h.width(s.width());break;case"template":t.innerHTML="",-1!=(D=A.trim(n.datafield).split(" ").join("")).indexOf(".")&&(D=D.replace(".",""));var E,H,M=this.editors["templateeditor_"+D];(h=null==M?A("<div style='overflow: hidden; border-radius: 0px; -moz-border-radius: 0px; -webkit-border-radius: 0px; z-index: 799; top: 0px; left: 0px; position: absolute;' id='templateeditor'></div>"):M).show(),h.css("top",A(t).parent().position().top),this.oldhscroll?h.css("left",-p+parseInt(A(t).position().left)):h.css("left",parseInt(A(t).position().left)),n.pinned&&h.css("left",p+parseInt(A(t).position().left)),null==M&&(h.prependTo(this.table),h[0].id="templateeditor"+this.element.id+D,this.editors["templateeditor_"+D]=h,E=s.width()-1,H=s.height()-1,h.width(E),h.height(H),n.createeditor&&n.createeditor(e,a,h,r,E,H,this.editchar)),n._requirewidthupdate&&h.width(s.width());break;case"textbox":default:t.innerHTML="",(h=this.editors["textboxeditor_"+n.datafield]||A("<input autocomplete='off' style='padding-left: 4px; padding-right:4px; border: none; border-color: transparent;' autocorrect='off' autocapitalize='off' spellcheck='false' type='textbox' id='textboxeditor'/>"))[0].id="textboxeditor"+this.element.id+n.datafield,h.appendTo(s),this.rtl&&h.css("direction","rtl"),!i&&""!=h[0].className||(h.addClass(this.toThemeProperty("jqx-input")),h.addClass(this.toThemeProperty("jqx-widget-content")),this.editchar&&0<this.editchar.length?h.val(this.editchar):(""!=n.cellsformat&&(a=this.getcelltext(e,d)),null==a&&(a=""),h.val(a)),null!=this.editcell.defaultvalue&&h.val(this.editcell.defaultvalue),h.width(s.width()+1),h.height(s.height()+1),n.createeditor&&n.createeditor(e,a,h),""!=n.cellsformat&&(-1==n.cellsformat.indexOf("p")&&-1==n.cellsformat.indexOf("c")&&-1==n.cellsformat.indexOf("n")&&-1==n.cellsformat.indexOf("f")||this.editors["textboxeditor_"+n.datafield]||h.keydown(function(e){var t=e.charCode?e.charCode:e.keyCode?e.keyCode:0,i=String.fromCharCode(t),l=parseInt(i);if(isNaN(l))return!0;if(0<c._selection(h).length)return!0;var o,d="",s=h.val();if(1<n.cellsformat.length?(o=parseInt(n.cellsformat.substring(1)),isNaN(o)&&(o=0)):o=0,0<o&&-1!=s.indexOf(c.gridlocalization.decimalseparator)&&c._selection(h).start>s.indexOf(c.gridlocalization.decimalseparator))return!0;for(var a=0;a<s.length-o;a++){var r=s.substring(a,a+1);null!=r.match(/^[0-9]+$/)&&(d+=r)}return!(11<=d.length)&&void 0}))),this.editors["textboxeditor_"+n.datafield]=h,i&&l&&setTimeout(function(){f(h),c.editchar?(c._setSelection(h[0],1,1),c.editchar=null):c._setSelection(h[0],0,h.val().length)},25)}h&&(h.addClass("jqx-grid-cell-edit"),h[0].style.zIndex=1+parseInt(t.style.zIndex),A.jqx.browser.msie&&A.jqx.browser.version<8&&(h[0].style.zIndex=1+this.columns.records.length+t.style.zIndex),h.css("display","block"),this.editcell.editor=h,this.editcell[d]||(this.editcell[d]={}),this.editcell[d].editor=h),i&&n.initeditor&&n.initeditor(e,a,h,r,this.editchar),c.isTouchDevice()||setTimeout(function(){c.content&&(c.content[0].scrollTop=0,c.content[0].scrollLeft=0),c.gridcontent&&(c.gridcontent[0].scrollLeft=0,c.gridcontent[0].scrollTop=0)},10)}},_hideeditors:function(){if(null!=this.editcells){for(var e in this.editcells)this.editcell=this.editcells[e],this._hidecelleditor()}},_hidecelleditor:function(e){if(this.editcell)if("selectedrow"!==this.editmode){if("checkbox"!=this.editcell.columntype){if(this.editcell.editor)switch(this.editcell.editor.hide(),this.editcell.columntype){case"dropdownlist":this.editcell.editor.jqxDropDownList({closeDelay:0}),this.editcell.editor.jqxDropDownList("hideListBox"),this.editcell.editor.jqxDropDownList({closeDelay:300});break;case"combobox":this.editcell.editor.jqxComboBox({closeDelay:0}),this.editcell.editor.jqxComboBox("hideListBox"),this.editcell.editor.jqxComboBox({closeDelay:300});break;case"datetimeinput":var t=this.editcell.editor;t.jqxDateTimeInput("isOpened")&&(t.jqxDateTimeInput({closeDelay:0}),t.jqxDateTimeInput("hideCalendar"),t.jqxDateTimeInput({closeDelay:300}))}this.validationpopup&&(this.validationpopup.hide(),this.validationpopuparrow.hide()),this.isNestedGrid||0!=e&&this.element.focus()}}else{for(var i=0;i<this.columns.records.length;i++){var l=this.columns.records[i];if(this.editcell[l.datafield]&&this.editcell[l.datafield].editor){this.editcell[l.datafield].editor.hide();var o=this.editcell[l.datafield].editor;switch(l.columntype){case"dropdownlist":o.jqxDropDownList({closeDelay:0}),o.jqxDropDownList("hideListBox"),o.jqxDropDownList({closeDelay:300});break;case"combobox":o.jqxComboBox({closeDelay:0}),o.jqxComboBox("hideListBox"),o.jqxComboBox({closeDelay:300});break;case"datetimeinput":o.jqxDateTimeInput("isOpened")&&(o.jqxDateTimeInput({closeDelay:0}),o.jqxDateTimeInput("hideCalendar"),o.jqxDateTimeInput({closeDelay:300}))}}}this.validationpopup&&(this.validationpopup.hide(),this.validationpopuparrow.hide())}},_geteditorvalue:function(e){var t=new String;if(!this.editcell)return null;var i,l,o,d=this.editcell.editor;if("selectedrow"==this.editmode&&this.editcell[e.datafield]&&(d=this.editcell[e.datafield].editor),d){switch(e.columntype){case"textbox":default:if(t=d.val(),""!=e.cellsformat){var s,a="string",r=this.source.datafields||(this.source._source?this.source._source.datafields:null);r&&(s="",A.each(r,function(){if(this.name==e.displayfield)return this.type&&(s=this.type),!1}),s&&(a=s));var n="date"===a||"time"===a;if("number"===a||"float"===a||"int"===a||"integer"===a||"string"===a&&(-1!=e.cellsformat.indexOf("p")||-1!=e.cellsformat.indexOf("c")||-1!=e.cellsformat.indexOf("n")||-1!=e.cellsformat.indexOf("f"))){if(""===t&&e.nullable)return"";t.indexOf&&-1<t.indexOf(this.gridlocalization.currencysymbol)&&(t=t.replace(this.gridlocalization.currencysymbol,""));var c=t,c=new Number(c);if(!isNaN(c))return c;-1<(t=(t=function(e,t,i){var l=e;if(t==i)return e;for(var o=l.indexOf(t);-1!=o;)o=(l=l.replace(t,i)).indexOf(t);return l}(t,this.gridlocalization.thousandsseparator,"")).replace(this.gridlocalization.decimalseparator,".")).indexOf(this.gridlocalization.percentsymbol)&&(t=t.replace(this.gridlocalization.percentsymbol,""));for(var h="",u=0;u<t.length;u++){var p=t.substring(u,u+1);"-"===p&&(h+="-"),"."===p&&(h+="."),null!=p.match(/^[0-9]+$/)&&(h+=p)}t=(t=h).replace(/ /g,""),t=new Number(t),isNaN(t)&&(t="")}if(n||"string"===a&&(-1!=e.cellsformat.indexOf("H")||-1!=e.cellsformat.indexOf("m")||-1!=e.cellsformat.indexOf("M")||-1!=e.cellsformat.indexOf("y")||-1!=e.cellsformat.indexOf("h")||-1!=e.cellsformat.indexOf("d"))){if(""===t&&e.nullable)return"";A.jqx.dataFormat&&(t=A.jqx.dataFormat.tryparsedate(t,this.gridlocalization)),"Invalid Date"!=t&&null!=t||(t="")}}e.displayfield!=e.datafield&&(t={label:t,value:t});break;case"checkbox":d.jqxCheckBox&&(t=d.jqxCheckBox("checked"));break;case"datetimeinput":if(d.jqxDateTimeInput){if(d.jqxDateTimeInput({isEditing:!1}),"none"!==d.jqxDateTimeInput("container").css("display")&&d.jqxDateTimeInput("close"),d.jqxDateTimeInput("_validateValue"),null==(t=d.jqxDateTimeInput("getDate")))return null;t=new Date(t.toString()),e.displayfield!=e.datafield&&(t={label:t,value:t})}break;case"dropdownlist":d.jqxDropDownList&&(i=d.jqxDropDownList("selectedIndex"),l=d.jqxDropDownList("listBox").getVisibleItem(i),null==(t=e.displayfield!=e.datafield?l?{label:l.label,value:l.value}:"":l?l.label:"")&&(t=""));break;case"combobox":d.jqxComboBox&&(t=d.jqxComboBox("val"),e.displayfield!=e.datafield&&null!=(l=d.jqxComboBox("getSelectedItem"))&&(t={label:l.label,value:l.value}),null==t&&(t=""));break;case"numberinput":d.jqxNumberInput&&(this.touchdevice&&d.jqxNumberInput("_doTouchHandling"),o=d.jqxNumberInput("getDecimal"),t=new Number(o),t=parseFloat(t),isNaN(t)&&(t=0),null===o&&(t=null),e.displayfield!=e.datafield&&(t={label:t,value:t}))}e.geteditorvalue&&(t="selectedrow"==this.editmode?e.geteditorvalue(this.editcell.row,this.getcellvalue(this.editcell.row,e.datafield),d):e.geteditorvalue(this.editcell.row,this.editcell.value,d))}return t},hidevalidationpopups:function(){this.popups&&(A.each(this.popups,function(){this.validation.remove(),this.validationrow.remove()}),this.popups=new Array),this.validationpopup&&(this.validationpopuparrow.hide(),this.validationpopup.hide())},showvalidationpopup:function(i,l,o){null==o&&(o=this.gridlocalization.validationstring);var e=A("<div style='z-index: 99999; top: 0px; left: 0px; position: absolute;'></div>"),t=A("<div style='width: 20px; height: 20px; z-index: 999999; top: 0px; left: 0px; position: absolute;'></div>");e.html(o),t.addClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),e.addClass(this.toThemeProperty("jqx-grid-validation")),e.addClass(this.toThemeProperty("jqx-rc-all")),e.prependTo(this.table),t.prependTo(this.table);for(var d=this.hScrollInstance.value,s=parseInt(d),a=this.getcolumn(l).uielement,r=null,n=0;n<this.hittestinfo.length;n++)i===this.hittestinfo[n].row.visibleindex&&(r=this.hittestinfo[n]);if(!r){this.ensurerowvisible(i);var c=this;return e.remove(),t.remove(),void setTimeout(function(){for(var e=null,t=0;t<c.hittestinfo.length;t++)i===c.hittestinfo[t].row.visibleindex&&(e=c.hittestinfo[t]);e&&c.showvalidationpopup(i,l,o)},25)}var h=A(r.visualrow);e.css("top",parseInt(h.position().top)+30+"px");var u=parseInt(e.css("top"));t.css("top",u-12),t.removeClass(),t.addClass(this.toThemeProperty("jqx-grid-validation-arrow-up"));var p=!1;u>=this._gettableheight()-this.rowsheight&&(t.removeClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),t.addClass(this.toThemeProperty("jqx-grid-validation-arrow-down")),(u=parseInt(h.position().top)-this.rowsheight)<0&&(u=0,this.validationpopuparrow.removeClass(this.toThemeProperty("jqx-grid-validation-arrow-down")),p=!0),e.css("top",u+"px"),t.css("top",u+e.outerHeight()-9));var f=-s+parseInt(A(a).position().left);0===a[0].offsetHeight&&(f=-s+parseInt(a[0].style.left)),t.css("left",s+f+30);var m=e.width();m+f>this.host.width()-20&&(f-=m+f-this.host.width()+40),p?e.css("left",s+parseInt(A(a).position().left)-e.outerWidth()):e.css("left",s+f),e.show(),t.show(),this.popups||(this.popups=new Array),this.popups[this.popups.length]={validation:e,validationrow:t}},_showvalidationpopup:function(e,t,i){var l,o,d,s,a,r,n,c,h=this.editcell,u=this.editcell.editor;"selectedrow"==this.editmode&&(h=this.editcell[t])&&h.editor&&(u=h.editor,h.element=u),u&&(this.validationpopup&&A.jqx.isHidden(this.validationpopup)&&(this.validationpopup.remove&&(this.validationpopup.remove(),this.validationpopuparrow.remove()),this.validationpopup=null,this.validationpopuparrow=null,void 0===t&&void 0===i&&this.editors&&0===this.editors.length)||(this.validationpopup?this.validationpopup.html(i):(l=A("<div style='z-index: 99999; top: 0px; left: 0px; position: absolute;'></div>"),o=A("<div style='width: 20px; height: 20px; z-index: 999999; top: 0px; left: 0px; position: absolute;'></div>"),l.html(i),o.addClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),l.addClass(this.toThemeProperty("jqx-grid-validation")),l.addClass(this.toThemeProperty("jqx-rc-all")),l.prependTo(this.table),o.prependTo(this.table),this.validationpopup=l,this.validationpopuparrow=o),d=this.hScrollInstance.value,s=parseInt(d),"selectedrow"==this.editmode?this.visiblerows&&this.visiblerows[this.editcell.visiblerowindex]?this.validationpopup.css("top",this.visiblerows[this.editcell.visiblerowindex].top+(this.rowsheight+5)+"px"):this.validationpopup.css("top",parseInt(A(h.editor).position().top)+(this.rowsheight+5)+"px"):this.validationpopup.css("top",parseInt(A(h.element).parent().position().top)+(this.rowsheight+5)+"px"),a=parseInt(this.validationpopup.css("top")),this.validationpopuparrow.css("top",a-11),this.validationpopuparrow.removeClass(),this.validationpopuparrow.addClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),r=!1,this._gettableheight()<=a&&(this.validationpopuparrow.removeClass(this.toThemeProperty("jqx-grid-validation-arrow-up")),this.validationpopuparrow.addClass(this.toThemeProperty("jqx-grid-validation-arrow-down")),a=parseInt(A(h.element).parent().position().top)-this.rowsheight-5,"selectedrow"==this.editmode&&(a=this.visiblerows&&this.visiblerows[this.editcell.visiblerowindex]?this.visiblerows[this.editcell.visiblerowindex].top-this.rowsheight-5:parseInt(A(h.editor).position().top)-this.rowsheight-5),a<0&&(a=0,this.validationpopuparrow.removeClass(this.toThemeProperty("jqx-grid-validation-arrow-down")),r=!0),this.validationpopup.css("top",a+"px"),this.validationpopuparrow.css("top",a+this.validationpopup.outerHeight()-9)),n=-s+parseInt(A(h.element).position().left),this.validationpopuparrow.css("left",s+n+30),(c=this.validationpopup.width())+n>this.host.width()-20&&(n-=c+n-this.host.width()+40),r?this.validationpopup.css("left",s+parseInt(A(h.element).position().left)-this.validationpopup.outerWidth()):this.validationpopup.css("left",s+n),"none"==this.editcell.editor.css("display")?(this.validationpopup.hide(),this.validationpopuparrow.hide()):(this.validationpopup.show(),this.validationpopuparrow.show())))}})}(jqxBaseFramework);