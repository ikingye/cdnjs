!function(T){T.extend(T.jqx._jqxChart.prototype,{_moduleRangeSelector:!0,_renderXAxisRangeSelector:function(e,t){var s=this;s._isTouchDevice=T.jqx.mobile.isTouchDevice();var i=s.seriesGroups[e],r=s._getXAxis(e),o=r?r.rangeSelector:void 0;if(s._isSelectorRefresh||(o&&o.renderTo?o.renderTo:s.host).find(".rangeSelector").remove(),!r||0==r.visible||"spider"==i.type)return!1;if(!s._isGroupVisible(e))return!1;if(!o)return!1;var a="horizontal"==i.orientation;o.renderTo&&(a=!1),s.rtl&&(r.flip=!0);var n=a?this.host.height():this.host.width();n-=4;var l,d,h,c,g=this._getXAxisStats(e,r,n),p=r.position;return o.renderTo&&o.position&&(p=o.position),this._isSelectorRefresh||(l=o.renderTo,d=T("<div class='rangeSelector jqx-disableselect' style='position: absolute; background-color: transparent;' onselectstart='return false;'></div>").appendTo(l||this.renderer.getContainer()),l?(d.css({width:l.width(),height:l.height()}),t.width=l.width(),t.height=l.height()):((h=this.host.coord()).top=0,h.left=0,c=this._selectorGetSize(r),a?(d.css("left",h.left+1+t.x+("right"!=p?-c:t.width)),d.css("top",h.top),d.css("height",n),d.css("width",c),t.height=c):(d.css("left",h.left+1),d.css("top",h.top+t.y+("top"!=p?t.height:-c)),d.css("height",c),d.css("width",n))),this._refreshSelector(e,r,g,d,t,a)),!(this._isSelectorRefresh=!1)},_refreshSelector:function(e,t,s,i,r,o){var a={},n=t.rangeSelector;this.seriesGroups[e];for(var l in n)a[l]=n[l];delete a.padding;var d=a.minValue,h=a.maxValue;null==d&&(d=Math.min(s.min.valueOf(),s.dsRange.min.valueOf())),null==h&&(h=Math.max(s.max.valueOf(),s.dsRange.max.valueOf())),this._isDate(s.min)&&(d=new Date(d)),this._isDate(s.max)&&(h=new Date(h));var c=t.position;n.renderTo&&n.position&&(c=n.position),a.dataField=t.dataField,delete a.rangeSelector,a.type=t.type,a.baseUnit=n.baseUnit||t.baseUnit,a.minValue=d,a.maxValue=h,a.flip=t.flip,a.position=c;var g=2,p=2,u=2,f=2;n.renderTo||(g=o?0:r.x,p=o?0:this._rect.width-r.x-r.width,u=o?r.y:5,f=o?this._paddedRect.height-this._plotRect.height:5);for(var _=null!=(_=n.padding)||n.renderTo?{left:_&&_.left?_.left:g,top:_&&_.top?_.top:u,right:_&&_.right?_.right:p,bottom:_&&_.bottom?_.bottom:f}:{left:g,top:u,right:p,bottom:f},v=t.rangeSelector.dataField,l=0;null==v&&l<this.seriesGroups.length;l++)for(var m=0;null==v&&m<this.seriesGroups[l].series.length;m++)v=this.seriesGroups[l].series[m].dataField;var x={padding:_,_isRangeSelectorInstance:!0,title:n.title||"",description:n.description||"",titlePadding:n.titlePadding,colorScheme:n.colorScheme||this.colorScheme,backgroundColor:n.backgroundColor||this.backgroundColor||"transparent",backgroundImage:n.backgroundImage||"",showBorderLine:n.showBorderLine||!!n.renderTo,borderLineWidth:n.borderLineWidth||this.borderLineWidth,borderLineColor:n.borderLineColor||this.borderLineColor,rtl:n.rtl||this.rtl,greyScale:n.greyScale||this.greyScale,renderEngine:this.renderEngine,showLegend:!1,enableAnimations:!1,enableEvents:!1,showToolTips:!1,source:this.source,xAxis:a,seriesGroups:[{orientation:o?"horizontal":"vertical",valueAxis:{visible:!1},type:t.rangeSelector.serieType||"area",skipOverlappingPoints:T.jqx.getByPriority([t.rangeSelector.skipOverlappingPoints,!0]),columnSeriesOverlap:T.jqx.getByPriority([t.rangeSelector.columnSeriesOverlap,!1]),columnsGapPercent:T.jqx.getByPriority([t.rangeSelector.columnsGapPercent,25]),seriesGapPercent:T.jqx.getByPriority([t.rangeSelector.seriesGapPercent,25]),series:[{dataField:v,opacity:.8,lineWidth:1}]}]};t.rangeSelector.seriesGroups&&(x.seriesGroups=t.rangeSelector.seriesGroups),t.rangeSelector.valueAxis&&(x.valueAxis=t.rangeSelector.valueAxis),x.showBorderLine||(x.borderLineWidth=1,x.borderLineColor=T.jqx.getByPriority([this.backgroundColor,this.background,"#FFFFFF"]),x.showBorderLine=!0);var S=this;S._supressBindingRefresh=!0,i.empty(),i.jqxChart(x),S._rangeSelectorInstances[e]=i,S._supressBindingRefresh=!1,i.on(S._getEvent("mousemove"),function(){S._unselect(),S._hideToolTip()});var w,y,b=i.jqxChart("getInstance");b._plotRect&&((w=b._paddedRect).height=b._plotRect.height,o||"top"!=c?o&&(y=b._renderData[0].xAxis.rect.width,w.width-=y,"right"!=c&&(w.x+=y)):w.y+=b._renderData[0].xAxis.rect.height,S._createSliderElements(e,i,w,n),S.removeHandler(T(document),S._getEvent("mousemove")+"."+this.element.id,S._onSliderMouseMove),S.removeHandler(T(document),S._getEvent("mousedown"),S._onSliderMouseDown),S.removeHandler(T(document),S._getEvent("mouseup")+"."+this.element.id,S._onSliderMouseUp),S.addHandler(T(document),S._getEvent("mousemove")+"."+this.element.id,S._onSliderMouseMove,{self:this,groupIndex:e,renderTo:i,swapXY:o}),S.addHandler(T(i),S._getEvent("mousedown"),this._onSliderMouseDown,{self:this,groupIndex:e,renderTo:i,swapXY:o}),S.addHandler(T(document),S._getEvent("mouseup")+"."+this.element.id,S._onSliderMouseUp,{element:this.element.id,self:this,groupIndex:e,renderTo:i,swapXY:o}))},_createSliderElements:function(e,t,s,i){t.find(".slider").remove();var r=i.selectedRangeColor||"blue",o=T.jqx.getByPriority([i.selectedRangeOpacity,.1]),a=T.jqx.getByPriority([i.unselectedRangeOpacity,.5]),n=i.unselectedRangeColor||"white",l=i.rangeLineColor||"grey",d=T("<div class='slider' style='position: absolute;'></div>");for(d.css({background:r,opacity:o,left:s.x,top:s.y,width:s.width,height:s.height}),d.appendTo(t);this._sliders.length<e+1;)this._sliders.push({});var h="<div class='slider' style='position: absolute;  background: "+n+"; opacity: "+a+";'></div>",c="<div class='slider' style='position: absolute; background:"+l+"; opacity: "+a+";'></div>",g="<div class='slider jqx-rc-all' style='position: absolute; background: white; border-style: solid; border-width: 1px; border-color: "+l+";'></div>";this._sliders[e]={element:d,host:t,_sliderInitialAbsoluteRect:{x:d.coord().left,y:d.coord().top,width:s.width,height:s.height},_hostInitialAbsolutePos:{x:t.coord().left,y:t.coord().top},getRect:function(){return{x:this.host.coord().left-this._hostInitialAbsolutePos.x+this._sliderInitialAbsoluteRect.x,y:this.host.coord().top-this._hostInitialAbsolutePos.y+this._sliderInitialAbsoluteRect.y,width:this._sliderInitialAbsoluteRect.width,height:this._sliderInitialAbsoluteRect.height}},rect:s,left:T(h),right:T(h),leftTop:T(c),rightTop:T(c),leftBorder:T(c),leftBar:T(g),rightBorder:T(c),rightBar:T(g)},this._sliders[e].left.appendTo(t),this._sliders[e].right.appendTo(t),this._sliders[e].leftTop.appendTo(t),this._sliders[e].rightTop.appendTo(t),this._sliders[e].leftBorder.appendTo(t),this._sliders[e].rightBorder.appendTo(t),this._sliders[e].leftBar.appendTo(t),this._sliders[e].rightBar.appendTo(t);var p,u=this._renderData[e].xAxis.data.axisStats,f=u.min.valueOf(),_=u.max.valueOf(),v=this._valueToOffset(e,f),m=this._valueToOffset(e,_);m<v&&(p=m,m=v,v=p),"horizontal"!=this.seriesGroups[e].orientation?d.css({left:Math.round(s.x+v),top:s.y,width:Math.round(m-v),height:s.height}):d.css({top:Math.round(s.y+v),left:s.x,height:Math.round(m-v),width:s.width}),this._setSliderPositions(e,v,m)},_setSliderPositions:function(e,t,s){var i=this.seriesGroups[e],r=this._getXAxis(e),o=r.rangeSelector,a="horizontal"==i.orientation;r.rangeSelector.renderTo&&(a=!1);var n=r.position;o.renderTo&&o.position&&(n=o.position);var l=this._sliders[e],d=a?"top":"left",h=a?"left":"top",c=a?"height":"width",g=a?"width":"height",p=a?"y":"x",u=a?"x":"y",f=l.rect;l.startOffset=t,l.endOffset=s,l.left.css(d,f[p]),l.left.css(h,f[u]),l.left.css(c,t),l.left.css(g,f[g]),l.right.css(d,f[p]+s),l.right.css(h,f[u]),l.right.css(c,f[c]-s+1),l.right.css(g,f[g]),l.leftTop.css(d,f[p]),l.leftTop.css(h,f[u]+(a&&"right"==n||!a&&"top"!=n?0:f[g])),l.leftTop.css(c,t),l.leftTop.css(g,1),l.rightTop.css(d,f[p]+s),l.rightTop.css(h,f[u]+(a&&"right"==n||!a&&"top"!=n?0:f[g])),l.rightTop.css(c,f[c]-s+1),l.rightTop.css(g,1),l.leftBorder.css(d,f[p]+t),l.leftBorder.css(h,f[u]),l.leftBorder.css(c,1),l.leftBorder.css(g,f[g]);var _=f[g]/4;20<_&&(_=20),_<3&&(_=3),l.leftBar.css(d,f[p]+t-3),l.leftBar.css(h,f[u]+f[g]/2-_/2),l.leftBar.css(c,5),l.leftBar.css(g,_),l.rightBorder.css(d,f[p]+s),l.rightBorder.css(h,f[u]),l.rightBorder.css(c,1),l.rightBorder.css(g,f[g]),l.rightBar.css(d,f[p]+s-3),l.rightBar.css(h,f[u]+f[g]/2-_/2),l.rightBar.css(c,5),l.rightBar.css(g,_)},_resizeState:{},_onSliderMouseDown:function(e){e.stopImmediatePropagation(),e.stopPropagation();var t=e.data.self;t._sliders[e.data.groupIndex]&&(null==t._resizeState.state&&t._testAndSetReadyResize(e),"ready"==t._resizeState.state&&((T.jqx._rangeSelectorTarget=t)._resizeState.state="resizing"))},_valueToOffset:function(e,t){var s=this.seriesGroups[e],i=this._sliders[e],r=i.host.jqxChart("getInstance")._renderData[0].xAxis.data.axisStats,o=r.min.valueOf(),a=r.max.valueOf()-o;0==a&&(a=1);var n=this._getXAxis(e),l="horizontal"==s.orientation?"height":"width",d=(t.valueOf()-o)/a;return i.getRect()[l]*(n.flip?1-d:d)},_offsetToValue:function(e,t){var s=this._sliders[e],i=this.seriesGroups[e],r=this._getXAxis(e),o="horizontal"==i.orientation?"height":"width",a=s.getRect()[o];0==a&&(a=1);var n=s.host.jqxChart("getInstance")._renderData[0].xAxis.data.axisStats,l=n.min.valueOf(),d=n.max.valueOf(),h=t/a*(d-l)+l;return 1==r.flip&&(h=d-t/a*(d-l)),this._isDate(n.min)||this._isDate(n.max)?h=new Date(h):(null!=r.dataField&&!n.useIndeces||(h=Math.round(h)),h<n.min&&(h=n.min),h>n.max&&(h=n.max)),h},_onSliderMouseUp:function(e){var t=T.jqx._rangeSelectorTarget;if(t){var s=e.data.groupIndex,i=e.data.swapXY,r=t._sliders[s];if(r&&"resizing"==t._resizeState.state){e.stopImmediatePropagation(),e.stopPropagation(),t._resizeState={},t.host.css("cursor","default");var o=i?"top":"left",a=i?"y":"x",n=r.element.coord()[o],l=n+(i?r.element.height():r.element.width()),d=r.getRect(),h=t._offsetToValue(s,n-d[a]),c=t._offsetToValue(s,l-d[a]);!r.host.jqxChart("getInstance")._renderData[0].xAxis.data.axisStats.isTimeUnit&&864e5<c.valueOf()-h.valueOf()&&(h.setHours(0,0,0,0),c.setDate(c.getDate()+1),c.setHours(0,0,0,0));var g,p=t._getXAxis(s);p.flip&&(g=h,h=c,c=g);for(var u=0;u<t.seriesGroups.length;u++){t._getXAxis(u)==p&&(t._selectorRange[u]={min:h,max:c})}t._isSelectorRefresh=!0;var f=t.enableAnimations;t._raiseEvent("rangeSelectionChanging",{instance:t,minValue:h,maxValue:c}),t.enableAnimations=!1,t.update(),t.enableAnimations=f,t._raiseEvent("rangeSelectionChanged",{instance:t,minValue:h,maxValue:c})}}},_onSliderMouseMove:function(e){var t,s,i,r,o,a,n,l,d,h,c,g,p,u,f=e.data.self,_=(e.data.renderTo,e.data.groupIndex),v=f._sliders[_],m=e.data.swapXY;v&&(t=v.getRect(),s=v.element,i=T.jqx.position(e),r=s.coord(),o=m?"top":"left",a=m?"height":"width",n=m?"y":"x","resizing"==f._resizeState.state?(e.stopImmediatePropagation(),e.stopPropagation(),"left"==f._resizeState.side?(g=Math.round(i[o]-r[o]),l=t[n],r[o]+g>=l&&r[o]+g<=l+t[a]&&(c=parseInt(s.css(o)),d=Math.max(2,(m?s.height():s.width())-g),s.css(a,d),s.css(o,c+g))):"right"==f._resizeState.side?(h=m?s.height():s.width(),g=Math.round(i[o]-r[o]-h),l=t[n],r[o]+h+g>=l&&r[o]+g+h<=l+t[a]&&(d=Math.max(2,h+g),s.css(a,d))):"move"==f._resizeState.side&&(h=m?s.height():s.width(),c=parseInt(s.css(o)),g=Math.round(i[o]-f._resizeState.startPos),r[o]+g>=t[n]&&r[o]+g+h<=t[n]+t[a]&&(f._resizeState.startPos=i[o],s.css(o,c+g))),u=(p=parseInt(s.css(o))-v.rect[n])+(m?s.height():s.width()),f._setSliderPositions(_,p,u)):f._testAndSetReadyResize(e))},_testAndSetReadyResize:function(e){var t=e.data.self,s=e.data.renderTo,i=e.data.groupIndex,r=t._sliders[i],o=e.data.swapXY,a=r.getRect(),n=r.element,l=T.jqx.position(e),d=n.coord(),h=o?"left":"top",c=o?"top":"left",g=o?"width":"height",p=t._isTouchDevice?30:5;l[h]>=d[h]&&l[h]<=d[h]+a[g]?Math.abs(l[c]-d[c])<=p?(s.css("cursor",o?"row-resize":"col-resize"),t._resizeState={state:"ready",side:"left"}):Math.abs(l[c]-d[c]-(o?n.height():n.width()))<=p?(s.css("cursor",o?"row-resize":"col-resize"),t._resizeState={state:"ready",side:"right"}):l[c]+p>d[c]&&l[c]-p<d[c]+(o?n.height():n.width())?(s.css("cursor","pointer"),t._resizeState={state:"ready",side:"move",startPos:l[c]}):(s.css("cursor","default"),t._resizeState={}):(s.css("cursor","default"),t._resizeState={})},_selectorGetSize:function(e){return e.rangeSelector.renderTo?0:e.rangeSelector.size||this._paddedRect.height/3}})}(jqxBaseFramework);