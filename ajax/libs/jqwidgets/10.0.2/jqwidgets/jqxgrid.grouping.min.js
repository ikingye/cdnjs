!function(z){z.jqx.dataview.grouping=function(){this.loadgrouprecords=function(n,r,e,t,s,o,i,a,l){for(var u=n,d=this,p=new Array,g=0;g<d.groups.length;g++)p[g]=d.generatekey();var h=new Array,c=0,p=p,v=new Array,m=r,f=d.groups.length;this.loadedrecords=new Array,this.bounditems=new Array,this.loadedrecords=new Array,this.loadedrootgroups=new Array,this.loadedgroups=new Array,this.loadedgroupsByKey=new Array,this.sortedgroups=new Array;var b=null!=this.sortdata,x=b?this.sortdata:this.records;if(this.pageable&&(w=new Array,y=0,x[r]||(z.each(x,function(e,t){w[r+e++]=this}),x=w)),this.virtualmode){for(var w=new Array,y=0,m=0;m<e-r;m++)x[m]?w[r+y++]=x[m]:x[r+y]&&(w[r+y]=x[r+y],y++);m=0,x=w}for(var I=r;I<e;I++){var _={},q=(_=b?z.extend({},x[I].value):z.extend({},x[I]))[d.uniqueId];(a<=s||q!=i[s][d.uniqueId]||o&&o[q])&&(l[l.length]=s);for(var j=new Array,T=0,g=0;g<f;g++){var G=_[M=d.groups[g]];null==G&&(G=""),j[T++]={value:G,hash:p[g]}}if(j.length!=f)break;for(var P=null,A="",C=0;C<j.length;C++){0;var S,H=j[C].value;null==v[A=A+"_"+j[C].hash+"_"+H]||null==v[A]?(null==P?(P={group:H,subItems:new Array,subGroups:new Array,level:0},(h[c++]=P).uniqueid=d.generatekey(),d.loadedgroupsByKey[H]=P):(S={group:H,subItems:new Array,subGroups:new Array,parentItem:P,level:P.level+1},(d.loadedgroupsByKey[P.uniqueid+"_"+H]=S).uniqueid=d.generatekey(),P.subGroups[P.subGroups.length++]=S,P=S),v[A]=P):P=v[A]}null!=P?(null==_.uid&&(_.uid=this.getid(this.source.id,_,m)),b?(_.boundindex=x[I].index,this.recordsbyid["id"+_.uid]=x[I].value):(_.boundindex=m,this.recordsbyid["id"+_.uid]=x[I]),this.bounditems[_.boundindex]=_,(this.sortedgroups[m]=_).uniqueid=d.generatekey(),_.parentItem=P,_.level=P.level+1,P.subItems[P.subItems.length++]=_):(null==_.uid&&(_.uid=this.getid(this.source.id,_,m)),b?(_.boundindex=x[I].index,this.recordsbyid["id"+_.uid]=x[I].value):(_.boundindex=m,this.recordsbyid["id"+_.uid]=x[I]),this.sortedgroups[m]=_,(this.bounditems[_.boundindex]=_).uniqueid=d.generatekey()),s++,m++,0}function B(e,t,r){for(var s=0;s<t.subItems.length;s++)t.subItems[s].visibleindex=n+r,e.rows[r]=t.subItems[s],e.loadedrecords[r]=t.subItems[s],r++;return r}var D=function(d,e,i){var r=1,p=d.grid.columns.records?d.grid.columns.records:d.grid.columns;if(1==d.aggregates)for(var t=0;t<p.length;t++)p[t].aggregates&&(r=Math.max(r,p[t].aggregates.length));for(var s in e.subGroups){var o=e.subGroups[s];o.subGroups&&((d.loadedgroups[d.loadedgroups.length]=o).visibleindex=n+i,d.rows[i]=o,d.loadedrecords[i]=o,i++,0<o.subGroups.length?i=D(d,o,i):0<o.subItems.length&&(i=B(d,o,i)))}return 0<e.subItems.length&&(i=B(d,e,i)),function(o){if(1==d.aggregates){function e(l){function e(e){for(var t=0;t<p.length;t++)if(p[t].aggregates)for(var r,s,o,i,n=d.grid.getcolumnaggregateddata(p[t].datafield,p[t].aggregates,!0,e),a=0;a<p[t].aggregates.length;a++){p[t].aggregates[l]&&(r=p[t],o=s=p[t].aggregates[l],i=(o=d.grid._getaggregatename(o))+":"+n[s],n[s]?u[r.datafield]=i:u[r.datafield]=o+":"+n[o])}}var r,s,t=o,u={};null!=t&&(u.level=t.level,u.visibleindex=n+i,u.uniqueid=d.generatekey(),d.rows[i]=u,(d.loadedrecords[i++]=u).totalsrow=!0,0<o.subItems.length?(t=o.subItems[o.subItems.length-1],u.parentItem=t.parentItem,u.parentItem.subItems&&(u.parentItem.subItems[u.parentItem.subItems.length]=u),r=[],(s=function(){for(var e=0;e<o.subItems.length;e++)o.subItems[e].totalsrow||(r[r.length]=o.subItems[e])})(o),e(r)):0<o.subGroups.length&&(t=o.subGroups[o.subGroups.length-1],u.level=t.level,(u.parentItem=o).subGroups[o.subGroups.length]=u,r=[],(s=function(e){if(!e.totalsrow){for(var t=0;t<e.subItems.length;t++)e.subItems[t].totalsrow||(r[r.length]=e.subItems[t]);for(t=0;t<e.subGroups.length;t++)s(e.subGroups[t])}})(o),e(r)))}for(var t=0;t<r;t++)e(t)}}(e),i},E=h.length;this.loadedgroups=new Array,this.rows=new Array;for(u=0,m=0;m<E;m++){var M=h[m];this.loadedrootgroups[m]=M,(this.loadedgroups[this.loadedgroups.length]=M).visibleindex=n+u,this.rows[u]=M,this.loadedrecords[u]=M,u=D(this,M,++u)}return u},this._updategroupsinpage=function(e,t,r,s,o,i,n){var p=new Array,a=[];if(this.groupable&&0<this.groups.length){for(var l=0,u=new Array,d=new Array,g=0;g<e.groups.length;g++)d[g]=e.generatekey();var h=0,c=new Array,v=0;n>this.totalrecords&&(n=this.totalrecords);for(var m=i;m<n;m++){var f=z.extend({},e.sortedgroups[m]),b=f[e.uniqueId];if(!e.pagesize||r>=e.pagesize*e.pagenum&&r<e.pagesize*(e.pagenum+1)){(o<=s||b!=p[s][e.uniqueId]||updated&&updated[b])&&(a[a.length]=s);for(var x=new Array,w=0,g=0;g<e.groups.length;g++){var y=f[S=e.groups[g]];null==y&&(y=""),x[w++]={value:y,hash:d[g]}}if(x.length!=e.groups.length)break;for(var I=null,_="",q=0;q<x.length;q++){0;var j,T,G=x[q].value;null==u[_=_+"_"+x[q].hash+"_"+G]||null==u[_]?(null==I?(I={group:G,subItems:new Array,subGroups:new Array,level:0},c[v++]=I,null!=(T=e.loadedgroupsByKey[G])&&(I.visibleindex=T.visibleindex,I.uniqueid=T.uniqueid)):(j={group:G,subItems:new Array,subGroups:new Array,parentItem:I,level:I.level+1},T=e.loadedgroupsByKey[I.uniqueid+"_"+G],j.visibleindex=T.visibleindex,j.uniqueid=T.uniqueid,I.subGroups[I.subGroups.length++]=j,I=j),u[_]=I):I=u[_]}null!=I&&(f.parentItem=I,f.level=I.level+1,I.subItems[I.subItems.length++]=f),s++}h++,r++}function P(e,t,r){for(var s=0;s<t.subItems.length;s++)p[r]=z.extend({},t.subItems[s]),r++;return r}for(var A=function(e){var t=!1;for(var r in e.subGroups){var s=e.subGroups[r];if(s.subGroups){if(0<s.subGroups.length)if(A(s))return t=!0;if(0<s.subItems.length)return t=!0}}return 0<e.subItems.length?t=!0:t},C=function(u,e,i){var r=1,d=u.grid.columns.records?u.grid.columns.records:u.grid.columns;if(1==u.aggregates)for(var t=0;t<d.length;t++)d[t].aggregates&&(r=Math.max(r,d[t].aggregates.length));for(var s in e.subGroups){var o=e.subGroups[s];o.subGroups&&A(o)&&(p[i]=o,i++,0<o.subGroups.length?i=C(u,o,i):0<o.subItems.length&&(i=P(0,o,i)))}return 0<e.subItems.length&&(i=P(0,e,i)),function(o){if(1==u.aggregates){function e(a){function e(e){for(var t=0;t<d.length;t++)if(d[t].aggregates)for(var r,s,o,i=u.grid.getcolumnaggregateddata(d[t].datafield,d[t].aggregates,!0,e),n=0;n<d[t].aggregates.length;n++){d[t].aggregates[a]&&(r=d[t],s=d[t].aggregates[a],o=u.grid._getaggregatename(s)+":"+i[s],l[r.datafield]=o)}}var r,s,t=o,l={};null!=t&&(l.level=t.level,l.visibleindex=i,l.uniqueid=u.generatekey(),p[i]=l,(u.loadedrecords[i++]=l).totalsrow=!0,0<o.subItems.length?(t=o.subItems[o.subItems.length-1],l.parentItem=t.parentItem,l.parentItem.subItems&&(l.parentItem.subItems[l.parentItem.subItems.length]=l),r=[],(s=function(){for(var e=0;e<o.subItems.length;e++)o.subItems[e].totalsrow||(r[r.length]=o.subItems[e])})(o),e(r)):0<o.subGroups.length&&(t=o.subGroups[o.subGroups.length-1],l.level=t.level,(l.parentItem=o).subGroups[o.subGroups.length]=l,r=[],(s=function(e){if(!e.totalsrow){for(var t=0;t<e.subItems.length;t++)e.subItems[t].totalsrow||(r[r.length]=e.subItems[t]);for(t=0;t<e.subGroups.length;t++)s(e.subGroups[t])}})(o),e(r)))}for(var t=0;t<r;t++)e(t)}}(e),i},h=0;h<c.length;h++){var S=c[h];A(S)&&(p[l]=S,l=C(this,S,++l))}}return p}},z.extend(z.jqx._jqxGrid.prototype,{_initgroupsheader:function(){var a,e,l,u,t;this.groupsheader.css("visibility","hidden"),this._groupsheader()&&(this.groupsheader.css("visibility","inherit"),e=(a=this).gridlocalization.groupsheaderstring,this.groupsheaderdiv=this.groupsheaderdiv||z('<div style="width: 100%; position: relative;"></div>'),this.groupsheaderdiv.height(this.groupsheaderheight),this.groupsheaderdiv.css("top",0),this.groupsheader.append(this.groupsheaderdiv),this.groupheadersbounds=new Array,l=this.groups.length,this.groupsheaderdiv.children().remove(),this.groupsheaderdiv[0].innerHTML="",u=new Array,0<l?z.each(this.groups,function(e){var t,r,s,o=this,i=a._getColumnText(this).label,n=a._rendergroupcolumn(i,o);n.addClass(a.toThemeProperty("jqx-grid-group-column")),a.groupsheaderdiv.append(n),a.closeablegroups&&(t=z(n.find(".jqx-icon-close")),a.isTouchDevice()&&!0!==a.touchmode?a.addHandler(t,"touchstart",function(){return a.removegroupat(e),!1}):a.addHandler(t,"click",function(){return a.removegroupat(e),!1})),a.sortable&&a.addHandler(n,"click",function(){var e=a.getcolumn(o);return null!=e&&a._togglesort(e),!1}),u[u.length]=n,a._handlegroupstocolumnsdragdrop(this,n),e<l-1&&(r=n.height(),s=z('<div style="float: left; position: relative;"></div>'),a.rtl&&s.css("float","right"),s.width(a.groupindentwidth/3),s.height(1),s.css("top",r/2),s.addClass(a.toThemeProperty("jqx-grid-group-column-line")),a.groupsheaderdiv.append(s))}):(t=z('<div style="position: relative;">'+e+"</div>"),this.groupsheaderdiv.append(t),this.rtl&&t.addClass(this.toThemeProperty("jqx-rtl"))),this._groupheaders=u,this._updategroupheadersbounds())},_updategroupheadersbounds:function(){var r=this,e=this.groupsheaderdiv.children().outerHeight(),t=(this.groupsheader.height()-e)/2;this.groupsheaderdiv.css("top",t),this.rtl?(this.groupsheaderdiv.css("left",""),this.groupsheaderdiv.css("right",t)):(this.groupsheaderdiv.css("left",t),this.groupsheaderdiv.css("right","")),this.rtl&&this._groupheaders.reverse(),z.each(this._groupheaders,function(e){var t=this.coord();r.groupheadersbounds[e]={left:t.left,top:t.top,width:this.outerWidth(),height:this.outerHeight(),index:e}})},addgroup:function(e){var t;e&&((t=this).groups!==t.dataview.groups&&(t.dataview.groups=t.groups),t.groups[t.groups.length]=e,t.refreshgroups(),this._raiseEvent(12,{type:"Add",index:t.groups[t.groups.length],groups:t.groups}))},insertgroup:function(e,t){var r;null!=e&&null!=e&&0<=e&&e<=this.groups.length&&t&&((r=this).groups!==r.dataview.groups&&(r.dataview.groups=r.groups),r.groups.splice(e,0,t.toString()),r.refreshgroups(),this._raiseEvent(12,{type:"Insert",index:e,groups:r.groups}))},refreshgroups:function(){this._refreshdataview(),this._render(!0,!0,!0,!1),this._postrender("group")},_insertaftergroup:function(e,t){var r=this._getGroupIndexByDataField(e);this.insertgroup(r+1,t)},_insertbeforegroup:function(e,t){var r=this._getGroupIndexByDataField(e);this.insertgroup(r,t)},removegroupat:function(e){if(0<=e&&null!=e&&null!=e){var t=this;return t.groups!==t.dataview.groups&&(t.dataview.groups=t.groups),t.groups.splice(e,1),t.refreshgroups(),t.virtualmode&&t.updatebounddata(),this._raiseEvent(12,{type:"Remove",index:e,groups:t.groups}),!0}return!1},cleargroups:function(){var e=this;return e.groups=[],e.dataview.groups=e.groups,e.refreshgroups(),this._raiseEvent(12,{type:"Clear",index:-1,groups:e.groups}),!0},removegroup:function(e){if(null==e)return!1;var t=this.groups.indexOf(e.toString());return this.removegroupat(t)},getrootgroupscount:function(){return this.dataview.loadedrootgroups.length},collapsegroup:function(e){if(0<=e&&-1===e.toString().indexOf("."))return this._setrootgroupstate(e,!1);var t=e.toString().split("."),r=null;this.groupsVisibility||(this.groupsVisibility=new Array);for(var s=0;s<t.length;s++){var o,e=parseInt(t[s]);0==s?(r=this.dataview.loadedrootgroups[e],this.groupsVisibility[r.group]=null):(o=r.subGroups[e])&&(r=o,s==t.length-1&&(this._setgroupstate(r,!1,!0),this.groupsVisibility[r.group]=null))}},expandgroup:function(e){if(0<=e&&-1===e.toString().indexOf("."))return this._setrootgroupstate(e,!0);for(var t=e.toString().split("."),r=null,s=0;s<t.length;s++){var o,e=parseInt(t[s]);0==s?(r=this.dataview.loadedrootgroups[e],this._setrootgroupstate(e,!0),this.groupsVisibility||(this.groupsVisibility=new Array),this.groupsVisibility[r.group]=r):(o=r.subGroups[e])&&(r=o,this._setgroupstate(r,!0,!0),this.groupsVisibility||(this.groupsVisibility=new Array),this.groupsVisibility[r.group]=r)}},collapseallgroups:function(e){this._setbatchgroupstate(!1,e)},expandallgroups:function(e){this._setbatchgroupstate(!0,e)},isgroupexpanded:function(e){var t=this.dataview.loadedrootgroups[e];return null==t?null:this.expandedgroups[t.uniqueid].expanded},jsonParser:function(){var f="~",b="\\x"+("0"+f.charCodeAt(0).toString(16)).slice(-2),x="\\"+b,w=new RegExp(b,"g"),o=new RegExp(x,"g"),i=new RegExp("(?:^|([^\\\\]))"+x),y=[].indexOf||function(e){for(var t=this.length;t--&&this[t]!==e;);return t},n=String;function a(e,t,r){return t instanceof Array?function(e,t,r){for(var s=0,o=t.length;s<o;s++)t[s]=a(e,t[s],r);return t}(e,t,r):t instanceof n?t.length?r.hasOwnProperty(t)?r[t]:r[t]=function(e,t){for(var r=0,s=t.length;r<s;e=e[t[r++].replace(o,f)]);return e}(e,t.split(f)):e:t instanceof Object?function(e,t,r){for(var s in t)t.hasOwnProperty(s)&&(t[s]=a(e,t[s],r));return t}(e,t,r):t}var I={stringify:function(e,t,r,s){return I.parser.stringify(e,(u=!1,p=[],g=[o=e],h=[o],c=[(n=!s)?f:"[Circular]"],v=o,m=1,(d=!!(i=t))&&(l="object"==typeof i?function(e,t){return""!==e&&y.call(i,e)<0?void 0:t}:i),function(e,t){return d&&(t=l.call(this,e,t)),u?(v!==this&&(a=m-y.call(g,this)-1,m-=a,g.splice(m,g.length),p.splice(m-1,p.length),v=this),"object"==typeof t&&t?(y.call(g,t)<0&&g.push(v=t),m=g.length,(a=y.call(h,t))<0?(a=h.push(t)-1,n?(p.push((""+e).replace(w,b)),c[a]=f+p.join(f)):c[a]=c[0]):t=c[a]):"string"==typeof t&&n&&(t=t.replace(b,x).replace(f,b))):u=!0,t}),r);var o,i,n,a,l,u,d,p,g,h,c,v,m},parse:function(e,t){return I.parser.parse(e,(s=t,function(e,t){var r="string"==typeof t;return r&&t.charAt(0)===f?new n(t.slice(1)):(""===e&&(t=a(t,t,{})),r&&(t=t.replace(i,"$1"+f).replace(x,b)),s?s.call(this,e,t):t)}));var s},parser:JSON};return I},getgroup:function(e){var t=this.dataview.loadedrootgroups[e];if(null==t)return null;var r=this.expandedgroups[t.uniqueid].expanded,s=t.group,o=t.level,i=new Array;this._getsubgroups(i,t);var n,a=this,l={group:s,level:o,expanded:r,subgroups:i};t.subItems&&(n=new Array,z.each(t.subItems,function(){var e=this.boundindex;n[n.length]=a.getrowdata(e)}),0<n.length&&(l.subrows=n));var u=this.jsonParser().stringify(t);return u=(u=u.replace(/subItems/gi,"subrows")).replace(/subGroups/gi,"subgroups"),l=this.jsonParser().parse(u)},getrootgroups:function(){for(var e=this.dataview.loadedrootgroups.length,t=new Array,r=0;r<e;r++)t[r]=this.getgroup(r);return t},_getsubgroups:function(e,t){var r=this;for(var s in t.subGroups){var o,i,n=t.subGroups[s],a=r.expandedgroups[n.uniqueid].expanded,l=n.group,u=n.level;e[e.length]={group:l,level:u,expanded:a},n.subItems&&(o=new Array,z.each(n.subItems,function(){var e=this.boundindex;o[o.length]=r.getrowdata(e)}),e[e.length-1].subrows=o),n.subGroups&&(i=new Array,r._getsubgroups(i,n))}return e},_setbatchgroupstate:function(e,t){for(var r in this.dataview.loadedrootgroups)this._setrootgroupstate(r,e,!1,!0);if(0==t)return this._requiresupdate=!0,this._renderrows(this.virtualsizeinfo),!0;var s=this.vScrollBar[0].style.visibility;return this.rendergridcontent(!0,!1),s==this.vScrollBar[0].style.visibility&&!this._hiddencolumns||(this._updatecolumnwidths(),this._updatecellwidths(),this._renderrows(this.virtualsizeinfo)),!0},_setrootgroupstate:function(e,t,r,s){if(null==e||null==e||e<0)return!1;if(!this.groupable||0==this.groups.length)return!1;var o=null==r||r;if(0<=e&&e<this.dataview.loadedrootgroups.length){var i=this.dataview.loadedrootgroups[e];if(this.pageable){for(var n=new Array,a=0;a<this.dataview.rows.length;a++)null!=this.dataview.rows[a].group&&0===this.dataview.rows[a].level&&n.push(this.dataview.rows[a]);if(!(i=n[e]))return}return this._setgroupstate(i,t,o,s)}return!1},_togglegroupstate:function(e,t){if(null==e||null==e)return!1;var r=this.vScrollInstance.value,s=this.expandedgroups[e.uniqueid];s=!(s=null!=s&&s.expanded),this.groupsVisibility||(this.groupsVisibility=new Array),this.groupsVisibility[e.group]=s?e:null;var o=this._setgroupstate(e,s,t);return this._newmax=null,0!==r&&"hidden"!==this.vScrollBar.css("visibility")&&(r<=this.vScrollInstance.max?this.vScrollInstance.setPosition(r):this.vScrollInstance.setPosition(this.vScrollInstance.max)),o},_setgroupstate:function(e,t,r,s){if(null==e||null==e)return!1;var o=!1;this.editable&&this.editcell&&this.endcelledit(this.editcell.row,this.editcell.column,!1,!1);var i,n=this.expandedgroups[e.uniqueid];return null==n&&(n={expanded:!1},o=!0),n.expanded!=t&&(o=!0),!!o&&(this.expandedgroups[e.uniqueid]={expanded:t,group:e},this._setsubgroupsvisibility(this,e,!t,s),r&&(i=this.vScrollBar[0].style.visibility,this.rendergridcontent(!0,!1),i==this.vScrollBar[0].style.visibility&&!this._hiddencolumns||(this._updatecolumnwidths(),this._updatecellwidths(),this._renderrows(this.virtualsizeinfo))),null!=this.suspendgroupevents&&0!=this.suspendgroupevents||(t?this._raiseEvent(4,{group:e.group,parentgroup:e.parentItem?e.parentItem.group:null,level:e.level,visibleindex:e.visibleindex}):this._raiseEvent(5,{group:e.group,parentgroup:e.parentItem?e.parentItem.group:null,level:e.level,visibleindex:e.visibleindex})),!0)},_setgroupitemsvisibility:function(e,t,r){for(var s=0;s<t.subItems.length;s++)e._setrowvisibility(t.subItems[s].visibleindex,r,!1)},_setsubgroupsvisibility:function(e,t,r,s){if(null!=t.parentItem){if(this.hiddens[t.parentItem.visibleindex])return}else if(null==t.parentItem&&this.hiddens[t.visibleindex])return;for(var o in t.subGroups){var i=t.subGroups[o];r||e._setrowvisibility(i.visibleindex,r,!1);var n=!r;s?this.expandedgroups[i.uniqueid]={expanded:n,group:i}:n=null!=e.expandedgroups[i.uniqueid]&&e.expandedgroups[i.uniqueid].expanded,i.subGroups&&(0<i.subGroups.length?e._setsubgroupsvisibility(e,i,!n||r,s):0<i.subItems.length&&e._setgroupitemsvisibility(e,i,!n||r)),r&&e._setrowvisibility(i.visibleindex,r,!1)}t.subItems&&0<t.subItems.length&&e._setgroupitemsvisibility(e,t,r)},_handlecolumnsdragdrop:function(){var e,t,c,v=this,m=-1,f=!1;v.groupable&&(e="mousemove.grouping"+this.element.id,this.element.id,t="mouseup.grouping"+this.element.id,c=!1,this.isTouchDevice()&&!0!==this.touchmode&&(c=!0,e=z.jqx.mobile.getTouchEventName("touchmove")+".grouping"+this.element.id,z.jqx.mobile.getTouchEventName("touchstart"),this.element.id,t=z.jqx.mobile.getTouchEventName("touchend")+".grouping"+this.element.id),this.removeHandler(z(document),e),this.addHandler(z(document),e,function(e){if(!v.showgroupsheader)return!0;if(null!=v.dragcolumn){var t,r=parseInt(e.pageX),s=parseInt(e.pageY);c&&(t=v.getTouches(e)[0],r=parseInt(t.pageX),s=parseInt(t.pageY));var o=v.host.coord(),i=parseInt(o.left),n=parseInt(o.top);null!=v.dragmousedownoffset&&null!=v.dragmousedownoffset||(v.dragmousedownoffset={left:0,top:0});var a,l,u,d,p,g=parseInt(r)-parseInt(v.dragmousedownoffset.left),h=parseInt(s)-parseInt(v.dragmousedownoffset.top);if(v.dragcolumn.css({left:g+"px",top:h+"px"}),f=!1,i<=r&&r<=i+v.host.width()&&n<=s&&s<=n+v.host.height()&&(f=!0),m=-1,f?(v.dragcolumnicon.removeClass(v.toThemeProperty("jqx-grid-dragcancel-icon")),v.dragcolumnicon.addClass(v.toThemeProperty("jqx-grid-drag-icon")),l=(a=v.groupsheader.coord()).top+v.groupsheader.height(),p=-1==(d=(u=z.data(v.dragcolumn[0],"datarecord"))?v.groups.indexOf(u.toString()):-1)||1<v.groups.length&&-1<d,null!=v.dropline&&(s>=a.top&&s<=l?p&&(m=v._handlegroupdroplines(r)):v.dropline.fadeOut("slow"))):(null!=v.dropline&&v.dropline.fadeOut("slow"),v.dragcolumnicon.removeClass(v.toThemeProperty("jqx-grid-drag-icon")),v.dragcolumnicon.addClass(v.toThemeProperty("jqx-grid-dragcancel-icon"))),c)return e.preventDefault(),e.stopPropagation(),!1}},{passive:!1}),this.removeHandler(z(document),t),this.addHandler(z(document),t,function(e){if(!v.showgroupsheader)return!0;v.__drag=!1,z(document.body).removeClass("jqx-disableselect");parseInt(e.pageX);var t,r=parseInt(e.pageY);c&&(t=v.getTouches(e)[0],parseInt(t.pageX),r=parseInt(t.pageY));var s=v.host.coord(),o=(parseInt(s.left),parseInt(s.top)),i=v.groupsheader.height();if(v.showtoolbar&&(o+=v.toolbarheight),v.dragstarted=!1,(v.dragmousedown=null)!=v.dragcolumn){var n,a,l,u=z.data(v.dragcolumn[0],"datarecord");if(v.dragcolumn.remove(),(v.dragcolumn=null)!=u){if(!v.getcolumn(u).groupable)return void(null!=v.dropline&&(v.dropline.remove(),v.dropline=null));f&&(-1!=m?(n=m.index,a=v.groups[n],(l=v._getGroupIndexByDataField(u))!=n&&(null!=l&&0<=l&&v.groups.splice(l,1),"before"==m.position?v.rtl?v._insertaftergroup(a,u):v._insertbeforegroup(a,u):v.rtl?v._insertbeforegroup(a,u):v._insertaftergroup(a,u))):0==v.groups.length?o<r&&r<=o+i&&v.addgroup(u):o+i<r&&(l=v._getGroupIndexByDataField(u),v.removegroupat(l))),null!=v.dropline&&(v.dropline.remove(),v.dropline=null)}}}))},_getGroupIndexByDataField:function(e){for(var t=0;t<this.groups.length;t++)if(this.groups[t]==e)return t;return-1},_isColumnInGroups:function(e){for(var t=0;t<this.groups.length;t++)if(this.groups[t]==e)return!0;return!1},_handlegroupdroplines:function(r){var s=this,o=-1;return z.each(s.groupheadersbounds,function(e){if(r<=this.left+this.width/2){var t=this.left-3;return 0<e&&(t=this.left-1-s.groupindentwidth/6),s.dropline.css("left",t),s.dropline.css("top",this.top),s.dropline.height(this.height),s.dropline.fadeIn("slow"),o={index:e,position:"before"},s.rtl&&(o={index:s.groupheadersbounds.length-1-e,position:"before"}),!1}r>=this.left+this.width/2&&(s.dropline.css("left",1+this.left+this.width),s.dropline.css("top",this.top),s.dropline.height(this.height),s.dropline.fadeIn("slow"),o={index:e,position:"after"},s.rtl&&(o={index:s.groupheadersbounds.length-1-e,position:"after"}))}),o},_handlegroupstocolumnsdragdrop:function(o,i){this.dragmousedown=null,this.dragmousedownoffset=null,this.dragstarted=!1,this.dragcolumn=null;var n,a=this,e="mousedown",t="mousemove",l=!1;this.isTouchDevice()&&!0!==this.touchmode&&(l=!0,e=z.jqx.mobile.getTouchEventName("touchstart"),t=z.jqx.mobile.getTouchEventName("touchmove")),this.addHandler(i,"dragstart",function(e){return!1}),this.addHandler(i,e,function(e){if(!a.showgroupsheader)return!0;var t,r=e.pageX,s=e.pageY;a.__drag=!0,a.dragmousedown={left:r,top:s},l&&(r=(t=a.getTouches(e)[0]).pageX,s=t.pageY,a.dragmousedown={left:r,top:s},e.preventDefault&&e.preventDefault());var o=z(e.target).coord();a.dragmousedownoffset={left:parseInt(r)-parseInt(o.left),top:parseInt(s-o.top)}}),this.addHandler(i,t,function(e){if(!a.showgroupsheader)return!0;var t,r,s;a.dragmousedown&&(n={left:e.pageX,top:e.pageY},l&&(t=a.getTouches(e)[0],n={left:t.pageX,top:t.pageY}),a.dragstarted||null!=a.dragcolumn||(r=Math.abs(n.left-a.dragmousedown.left),s=Math.abs(n.top-a.dragmousedown.top),(3<r||3<s)&&(a._createdragcolumn(i,n,!0),z(document.body).addClass("jqx-disableselect"),z.data(a.dragcolumn[0],"datarecord",o),e.preventDefault&&e.preventDefault())))},{passive:!1})},_createdragcolumn:function(e,t,r){var s=this,o=t;s.dragcolumn=z("<div></div>");var i=e.clone();s.dragcolumn.css("z-index",999999),i.css("border-width","1px"),i.css("opacity","0.4");var n=z(i.find("."+s.toThemeProperty("jqx-grid-column-menubutton")));0<n.length&&n.css("display","none");var a=z(i.find(".jqx-icon-close"));0<a.length&&a.css("display","none"),s.dragcolumnicon=z('<div style="z-index: 9999; position: absolute; left: 100%; top: 50%; margin-left: -18px; margin-top: -7px;"></div>'),s.dragcolumnicon.addClass(s.toThemeProperty("jqx-grid-drag-icon")),s.dragcolumn.css("float","left"),s.dragcolumn.css("position","absolute");s.host.coord();i.width(e.width()+16),s.dragcolumn.append(i),s.dragcolumn.height(e.height()),s.dragcolumn.width(i.width()),s.dragcolumn.append(s.dragcolumnicon),z(document.body).append(s.dragcolumn),i.css("margin-left",0),i.css("left",0),i.css("top",0),s.dragcolumn.css("left",o.left+s.dragmousedown.left),s.dragcolumn.css("top",o.top+s.dragmousedown.top),null!=r&&r&&(s.dropline=z('<div style="display: none; position: absolute;"></div>'),s.dropline.width(2),s.dropline.addClass(s.toThemeProperty("jqx-grid-group-drag-line")),z(document.body).append(s.dropline))},iscolumngroupable:function(e){return this._getcolumnproperty(e,"groupable")},_handlecolumnstogroupsdragdrop:function(n,a){this.dragmousedown=null,this.dragmousedownoffset=null,this.dragstarted=!1,this.dragcolumn=null;var l=this,u=!1;this.isTouchDevice()&&!0!==this.touchmode&&(u=!0);var e="mousedown.drag",d="mousemove.drag";u?(e=z.jqx.mobile.getTouchEventName("touchstart")+".drag",d=z.jqx.mobile.getTouchEventName("touchmove")+".drag"):this.addHandler(a,"dragstart",function(e){return!1}),this.addHandler(a,e,function(e){if(!l.showgroupsheader)return!0;if(l.__drag=!0,l._isColumnInGroups(n.displayfield))return a.css("cursor"),!0;if(0==n.groupable)return!0;var t,r=e.pageX,s=e.pageY;u&&(r=(t=l.getTouches(e)[0]).pageX,s=t.pageY),l.dragmousedown={left:r,top:s},u&&e.preventDefault&&e.preventDefault();var o=z(e.target).coord();l.dragmousedownoffset={left:parseInt(r)-parseInt(o.left),top:parseInt(s-o.top)}}),this.addHandler(a,d,function(e){return!l.showgroupsheader||(l._isColumnInGroups(n.displayfield)?(a.css("cursor"),!0):void(l.dragmousedown&&(r=e.pageX,s=e.pageY,u&&(r=(t=l.getTouches(e)[0]).pageX,s=t.pageY),d={left:r,top:s},l.dragstarted||null!=l.dragcolumn||(o=Math.abs(d.left-l.dragmousedown.left),i=Math.abs(d.top-l.dragmousedown.top),(3<o||3<i)&&(l._createdragcolumn(a,d,!0),z.data(l.dragcolumn[0],"datarecord",n.displayfield),e.preventDefault&&e.preventDefault())))));var t,r,s,o,i})},_rendergroupcolumn:function(e,t){var r,s,o,i,n=z('<div style="float: left; position: relative;"></div>');return this.rtl&&n.css("float","right"),null!=this.groupcolumnrenderer&&(n[0].innerHTML=this.groupcolumnrenderer(e),n.addClass(this.toThemeProperty("jqx-grid-group-column")),n.addClass(this.toThemeProperty("jqx-fill-state-normal"))),this.closeablegroups?(""==n[0].innerHTML&&(n[0].innerHTML='<a style="float: left;" href="#">'+e+"</a>"),this.rtl&&(n[0].innerHTML='<a style="float: right;" href="#">'+e+"</a>"),s='<div style="float: '+(r=this.rtl?"left":"right")+'; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -18px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-icon-close")+'"></div></div>',z.jqx.browser.msie&&z.jqx.browser.version<8&&(s='<div style="float: left; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -18px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-icon-close")+'"></div></div>'),this.rtl&&(s='<div style="float: '+r+'; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-icon-close")+'"></div></div>',z.jqx.browser.msie&&z.jqx.browser.version<8&&(s='<div style="float: left; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-icon-close")+'"></div></div>')),n[0].innerHTML+=s):""==n[0].innerHTML&&(n[0].innerHTML='<a href="#">'+e+"</a>"),this.sortable&&(o=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),i=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>'),this.closeablegroups&&(o=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -32px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),i=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 100%; top: 50%; margin-left: -32px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>')),this.rtl&&(o=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 0px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),i=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 0px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>'),this.closeablegroups&&(o=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortascbutton")+'"></div></div>'),i=z('<div style="float: right; min-height: 16px; min-width: 18px;"><div style="position: absolute; left: 0px; top: 50%; margin-left: 16px; margin-top: -8px; float: none; width: 16px; height: 16px;" class="'+this.toThemeProperty("jqx-grid-column-sortdescbutton")+'"></div></div>'))),o.css("display","none"),i.css("display","none"),z.jqx.browser.msie&&z.jqx.browser.version<8&&(o.css("float","left"),i.css("float","left")),n.append(o),n.append(i),z.data(document.body,"groupsortelements"+t,{sortasc:o,sortdesc:i})),n.addClass(this.toThemeProperty("jqx-fill-state-normal")),n.addClass(this.toThemeProperty("jqx-grid-group-column")),n},_rendergroup:function(e,t,r,s,o,i,n){var a=t,l=t.cells[r.level];this.rtl&&(l=t.cells[t.cells.length-1-r.level]);var u,d,p=this._findgroupstate(r.uniqueid);(0<r.bounddata.subGroups.length||0<r.bounddata.subItems.length)&&(u=this.rtl?"-rtl":"",d=this.toThemeProperty("jqx-icon-arrow-right"),u&&(d=this.toThemeProperty("jqx-icon-arrow-left")),l.className+=p?" "+this.toThemeProperty("jqx-grid-group-expand"+u)+" "+this.toThemeProperty("jqx-icon-arrow-down"):" "+this.toThemeProperty("jqx-grid-group-collapse"+u)+" "+d);var g=this._getColumnText(this.groups[r.level]).label,h=this.groupindentwidth,c=this.rowdetails&&this.showrowdetailscolumn?(1+e)*h:e*h,v=n-c,m=r.level+1;this.rtl&&(m=0);for(var f=a.cells[m],b=2;null!=f&&"none"==f.style.display&&b<a.cells.length-1;)f=a.cells[m+b-1],b++;var x,w,y,I,_,q=z(f);if(f){if(f.style.width=parseInt(v)+"px",-1!=f.className.indexOf("jqx-grid-cell-filter")&&q.removeClass(this.toThemeProperty("jqx-grid-cell-filter")),-1!=f.className.indexOf("jqx-grid-cell-sort")&&q.removeClass(this.toThemeProperty("jqx-grid-cell-sort")),-1!=f.className.indexOf("jqx-grid-cell-pinned")&&q.removeClass(this.toThemeProperty("jqx-grid-cell-pinned")),null!=this.groupsrenderer){var j={group:r.group,level:r.level,parent:r.bounddata.parentItem,subGroups:r.bounddata.subGroups,subItems:r.bounddata.subItems,groupcolumn:this._getColumnText(this.groups[r.level]).column},T=this.groupsrenderer(g+": "+r.group,r.group,p,j);if(T)f.innerHTML=T;else{var G=0<r.bounddata.subItems.length?r.bounddata.subItems.length:r.bounddata.subGroups.length;if(this.showgroupaggregates)for(var P=0<r.bounddata.subItems.length?r.bounddata.subItems:r.bounddata.subGroups,A=G=0;A<P.length;A++)P[A].totalsrow||G++;f.innerHTML='<div class="'+this.toThemeProperty("jqx-grid-groups-row")+'" style="position: absolute;"><span>'+g+': </span><span class="'+this.toThemeProperty("jqx-grid-groups-row-details")+'">'+r.group+" ("+G+")</span></div>"}}else{var C=this._getcolumnbydatafield(this.groups[r.level]),S=r.group;if(null==C)throw new Error("jqxGrid: Unable to find '"+this.groups[r.level]+"' group in the Grid's columns collection.");C.cellsformat&&z.jqx.dataFormat&&(z.jqx.dataFormat.isDate(S)?S=z.jqx.dataFormat.formatdate(S,C.cellsformat,this.gridlocalization):z.jqx.dataFormat.isNumber(S)&&(S=z.jqx.dataFormat.formatnumber(S,C.cellsformat,this.gridlocalization)));G=0<r.bounddata.subItems.length?r.bounddata.subItems.length:r.bounddata.subGroups.length;if(this.showgroupaggregates)for(P=0<r.bounddata.subItems.length?r.bounddata.subItems:r.bounddata.subGroups,A=G=0;A<P.length;A++)P[A].totalsrow||G++;f.innerHTML='<div class="'+this.toThemeProperty("jqx-grid-groups-row")+'" style="position: absolute;"><span>'+g+': </span><span class="'+this.toThemeProperty("jqx-grid-groups-row-details")+'">'+S+" ("+G+")</span></div>"}this.rtl&&(C=C||this._getcolumnbydatafield(this.groups[r.level]),_="hidden"==this.hScrollBar.css("visibility")?0:this.hScrollInstance.max-this.hScrollInstance.value,x="hidden"==this.vScrollBar.css("visibility")?0:this.scrollbarsize+6,c=this.rowdetails&&this.showrowdetailscolumn?(2+r.level)*h:(1+r.level)*h,f.style.width=n+parseInt(_)-c-x+"px",q.addClass(this.toThemeProperty("jqx-rtl")),w=z(t.cells[t.cells.length-1]).css("z-index"),q.css("z-index",w),v=(y=q.find("div")).width(),y.css("left","100%"),I=null!=this.columns.records[t.cells.length-2-r.level]&&this.columns.records[t.cells.length-2-r.level].pinned,this.table.width()<n&&(n=this.table.width(),"hidden"!=this.vScrollBar.css("visibility")&&(n+=this.vScrollBar.outerWidth())),C.pinned||I?(this.rowdetails&&this.showrowdetailscolumn&&(n+=30),y.css("margin-left",-v),f.style.width=n+_-c-x+"px"):(_="hidden"==this.hScrollBar.css("visibility")?0:this.hScrollInstance.max,f.style.width=n+_-c-x+"px",v=y.width(),y.css("margin-left",-v)))}}})}(jqxBaseFramework);