!function(l){l.jqx.jqxWidget("jqxDragDrop","",{}),l.extend(l.jqx._jqxDragDrop.prototype,{defineInstance:function(){var e={restricter:"document",handle:!1,feedback:"clone",opacity:.6,revert:!1,revertDuration:400,distance:5,disabled:!1,tolerance:"intersect",data:null,dropAction:"default",dragZIndex:999999,appendTo:"parent",cursor:"move",onDragEnd:null,onDrag:null,onDragStart:null,onTargetDrop:null,onDropTargetEnter:null,onDropTargetLeave:null,initFeedback:null,dropTarget:null,isDestroyed:!1,triggerEvents:!0,_touchEvents:{mousedown:l.jqx.mobile.getTouchEventName("touchstart"),click:l.jqx.mobile.getTouchEventName("touchstart"),mouseup:l.jqx.mobile.getTouchEventName("touchend"),mousemove:l.jqx.mobile.getTouchEventName("touchmove"),mouseenter:"mouseenter",mouseleave:"mouseleave"},_restricter:null,_zIndexBackup:0,_targetEnterFired:!1,_oldOpacity:1,_feedbackType:void 0,_isTouchDevice:!1,_events:["dragStart","dragEnd","dragging","dropTargetEnter","dropTargetLeave"]};return this===l.jqx._jqxDragDrop.prototype||l.extend(!0,this,e),e},createInstance:function(){this._createDragDrop()},_createDragDrop:function(){var e,t,i=l.data(document.body,"jqx-draggables")||1;this.appendTo=this._getParent(),this._isTouchDevice=l.jqx.mobile.isTouchDevice(),/(static|relative)/.test(this.host.css("position"))&&(this.feedback&&"original"!==this.feedback||(e=this._getRelativeOffset(this.host),t=this.appendTo.offset(),"static"!=this.appendTo.css("position")&&(t={left:0,top:0}),this.element.style.position="absolute",this.element.style.left=t.left+e.left+"px",this.element.style.top=t.top+e.top+"px")),this._validateProperties(),this._idHandler(i),this.disabled&&this.disable(),"string"==typeof this.dropTarget&&(this.dropTarget=l(this.dropTarget)),this._refresh(),i+=1,l.data(document.body,"jqx-draggables",i),this.host.addClass("jqx-draggable"),this.disabled||this.host.css("cursor",this.cursor)},_getParent:function(){var e=this.appendTo;if("string"==typeof this.appendTo)switch(this.appendTo){case"parent":e=this.host.parent();break;case"document":e=l(document);break;case"body":e=l(document.body);break;default:e=l(this.appendTo)}return e},_idHandler:function(e){var t;this.element.id||(t="jqx-draggable-"+e,this.element.id=t)},_refresh:function(){this._removeEventHandlers(),this._addEventHandlers()},_getEvent:function(e){return this._isTouchDevice?this._touchEvents[e]:e},_validateProperties:function(){"clone"===this.feedback?this._feedbackType="clone":this._feedbackType="original","default"!==this.dropAction&&(this.dropAction="nothing")},_removeEventHandlers:function(){this.removeHandler(this.host,"dragstart"),this.removeHandler(this.host,this._getEvent("mousedown")+".draggable."+this.element.id,this._mouseDown),this.removeHandler(l(document),this._getEvent("mousemove")+".draggable."+this.element.id,this._mouseMove),this.removeHandler(l(document),this._getEvent("mouseup")+".draggable."+this.element.id,this._mouseUp)},_addEventHandlers:function(){var e,t=this;this.addHandler(this.host,"dragstart",function(e){return!!t.disabled||(l.jqx.mobile.isTouchDevice()?void 0:(e.preventDefault(),!1))}),this.addHandler(this.host,this._getEvent("mousedown")+".draggable."+this.element.id,this._mouseDown,{self:this}),this.addHandler(l(document),this._getEvent("mousemove")+".draggable."+this.element.id,this._mouseMove,{self:this}),this.addHandler(l(document),this._getEvent("mouseup")+".draggable."+this.element.id,function(e){t._mouseUp(e)},{self:this});try{""==document.referrer&&!window.frameElement||null==window.top||window.top==window.self||(e="",window.parent&&document.referrer&&(e=document.referrer),-1!=e.indexOf(document.location.host)&&(window.top.document.addEventListener?window.top.document.addEventListener("mouseup",function(){t._mouseUp(t)},!1):window.top.document.attachEvent&&window.top.document.attachEvent("onmouseup",function(){t._mouseUp(t)})))}catch(e){}},_mouseDown:function(e){var t=e.data.self,i=t._getMouseCoordinates(e),r=t._mouseCapture(e);if(t._originalPageX=i.left,t._originalPageY=i.top,t.disabled)return!0;return t._mouseStarted||(t._clear(e),0),r&&(t._mouseDownEvent=e),!!t._isTouchDevice||(1!==e.which||!r||void e.preventDefault())},_mouseMove:function(e){var t=e.data.self;return!!t.disabled||(t._mouseStarted?(t._mouseDrag(e),e.preventDefault&&e.preventDefault(),!1):(t._mouseDownEvent&&t._isMovedDistance(e)&&(t._mouseStart(t._mouseDownEvent,e)?t._mouseStarted=!0:t._mouseStarted=!1,t._mouseStarted?t._mouseDrag(e):t._mouseUp(e)),!t._mouseStarted))},_mouseUp:function(e){this._clear(e)},_clear:function(e){var t=e.data&&e.data.self?e.data.self:this;return!!t.disabled||(t._mouseDownEvent=!1,t._movedDistance=!1,t._mouseStarted&&(t._mouseStarted=!1,t._mouseStop(e)),t.feedback&&t.feedback[0]&&"original"!==t._feedbackType&&"function"==typeof t.feedback.remove&&!t.revert&&t.feedback.remove(),!!t._isTouchDevice&&void 0)},cancelDrag:function(){var e=this.revertDuration;this.revertDuration=0,this._mouseDownEvent=!1,this._movedDistance=!1,this._mouseStarted=!1,this._mouseStop(),this.feedback.remove(),this.revertDuration=e},_isMovedDistance:function(e){var t=this._getMouseCoordinates(e);return!!this._movedDistance||(t.left>=this._originalPageX+this.distance||t.left<=this._originalPageX-this.distance||t.top>=this._originalPageY+this.distance||t.top<=this._originalPageY-this.distance)&&(this._movedDistance=!0)},_getMouseCoordinates:function(e){if(this._isTouchDevice){var t=l.jqx.position(e);return{left:t.left,top:t.top}}return{left:e.pageX,top:e.pageY}},destroy:function(){return this._enableSelection(this.host),this.host.removeData("draggable").off(".draggable").removeClass("jqx-draggable jqx-draggable-dragging jqx-draggable-disabled"),this._removeEventHandlers(),this.isDestroyed=!0,this},_disableSelection:function(e){e.each(function(){l(this).attr("unselectable","on").css({"-ms-user-select":"none","-moz-user-select":"none","-webkit-user-select":"none","user-select":"none"}).each(function(){this.onselectstart=function(){return!1}})})},_enableSelection:function(e){e.each(function(){l(this).attr("unselectable","off").css({"-ms-user-select":"text","-moz-user-select":"text","-webkit-user-select":"text","user-select":"text"}).each(function(){this.onselectstart=null})})},_mouseCapture:function(e){return!this.disabled&&(!!this._getHandle(e)&&(this._disableSelection(this.host),!0))},_getScrollParent:function(e){var t=l.jqx.browser.msie&&/(static|relative)/.test(e.css("position"))||/absolute/.test(e.css("position"))?e.parents().filter(function(){return/(relative|absolute|fixed)/.test(l.css(this,"position",1))&&/(auto|scroll)/.test(l.css(this,"overflow",1)+l.css(this,"overflow-y",1)+l.css(this,"overflow-x",1))}).eq(0):e.parents().filter(function(){return/(auto|scroll)/.test(l.css(this,"overflow",1)+l.css(this,"overflow-y",1)+l.css(this,"overflow-x",1))}).eq(0);return/fixed/.test(e.css("position"))||!t.length?l(document):t},_mouseStart:function(e){var t=this._getMouseCoordinates(e);this._getParentOffset(this.host);this.feedback=this._createFeedback(e),this._zIndexBackup=this.feedback.css("z-index"),this.feedback[0].style.zIndex=this.dragZIndex,this._backupFeedbackProportions(),this._backupeMargins(),this._positionType=this.feedback.css("position"),this._scrollParent=this._getScrollParent(this.feedback),this._offset=this.positionAbs=this.host.offset(),this._offset={top:this._offset.top-this.margins.top,left:this._offset.left-this.margins.left},l.extend(this._offset,{click:{left:t.left-this._offset.left,top:t.top-this._offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset(),hostRelative:this._getRelativeOffset(this.host)}),this.position=this._generatePosition(e),this.originalPosition=this._fixPosition(),this.restricter&&this._setRestricter(),this.feedback.addClass(this.toThemeProperty("jqx-draggable-dragging"));this._raiseEvent(0,e);return this.onDragStart&&"function"==typeof this.onDragStart&&this.onDragStart(this.position),this._mouseDrag(e,!0),!0},_fixPosition:function(){var e=this._getRelativeOffset(this.host);this.position;return{left:this.position.left+e.left,top:this.position.top+e.top}},_mouseDrag:function(e,t){return this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.feedback[0].style.left=this.position.left+"px",this.feedback[0].style.top=this.position.top+"px",this._raiseEvent(2,e),this.onDrag&&"function"==typeof this.onDrag&&this.onDrag(this.data,this.position),this._handleTarget(),!1},_over:function(i,r,s){var o,n;return this.dropTarget&&(o=!1,n=this,l.each(this.dropTarget,function(e,t){if((o=n._overItem(t,i,r,s)).over)return!1})),o},_overItem:function(e,t,i,r){var s=(e=l(e)).offset(),o=e.outerHeight(),n=e.outerWidth();if(e&&e[0]!==this.element){var a=!1;switch(this.tolerance){case"intersect":t.left+i>s.left&&t.left<s.left+n&&t.top+r>s.top&&t.top<s.top+o&&(a=!0);break;case"fit":i+t.left<=s.left+n&&t.left>=s.left&&r+t.top<=s.top+o&&t.top>=s.top&&(a=!0)}return{over:a,target:e}}},_handleTarget:function(){var e,t,i,r;this.dropTarget&&(e=this.feedback.offset(),t=this.feedback.outerWidth(),i=this.feedback.outerHeight(),(r=this._over(e,t,i)).over?(this._targetEnterFired&&0<r.target.length&&this._oldtarget&&0<this._oldtarget.length&&r.target[0]!=this._oldtarget[0]&&(this._raiseEvent(4,{target:this._oldtarget}),this.onDropTargetLeave&&"function"==typeof this.onDropTargetLeave&&this.onDropTargetLeave(this._oldtarget)),(!this._targetEnterFired||0<r.target.length&&this._oldtarget&&0<this._oldtarget.length&&r.target[0]!=this._oldtarget[0])&&(this._targetEnterFired=!0,this._raiseEvent(3,{target:r.target}),this.onDropTargetEnter&&"function"==typeof this.onDropTargetEnter&&this.onDropTargetEnter(r.target)),this._oldtarget=r.target):this._targetEnterFired&&(this._targetEnterFired=!1,this._raiseEvent(4,{target:this._oldtarget||r.target}),this.onDropTargetLeave&&"function"==typeof this.onDropTargetLeave&&this.onDropTargetLeave(this._oldtarget||r.target)))},_mouseStop:function(e){var t=this._fixPosition(),i={width:this.host.outerWidth(),height:this.host.outerHeight()};return this.feedback[0].style.opacity=this._oldOpacity,this.revert||(this.feedback[0].style.zIndex=this._zIndexBackup),this._enableSelection(this.host),this.dropped&&(this.dropped,this.dropped=!1),(this.element&&this.element.parentNode||"original"!==this.feedback)&&(this._dropElement(t),this.feedback.removeClass(this.toThemeProperty("jqx-draggable-dragging")),this._raiseEvent(1,e),this.onDragEnd&&"function"==typeof this.onDragEnd&&this.onDragEnd(this.data),this.onTargetDrop&&"function"==typeof this.onTargetDrop&&this._over(t,i.width,i.height).over&&this.onTargetDrop(this._over(t,i.width,i.height).target),this._revertHandler()),!1},_dropElement:function(e){var t;"default"===this.dropAction&&this.feedback&&this.feedback[0]!==this.element&&"original"!==this.feedback&&(this.revert||/(fixed|absolute)/.test(this.host.css("position"))||(this.host.css("position","relative"),t=this._getRelativeOffset(this.host),(e=this.position).left-=t.left,e.top-=t.top,this.element.style.left=e.left+"px",this.element.style.top=e.top+"px"))},_revertHandler:function(){var e;(this.revert||l.isFunction(this.revert)&&this.revert())&&("original"!=(e=this)._feedbackType?null!=this.feedback&&("none"!=this.dropAction?l(this.feedback).animate({left:e.originalPosition.left-e._offset.hostRelative.left,top:e.originalPosition.top-e._offset.hostRelative.top},parseInt(this.revertDuration,10),function(){e.feedback&&e.feedback[0]&&"original"!==e._feedbackType&&"function"==typeof e.feedback.remove&&e.feedback.remove()}):e.feedback&&e.feedback[0]&&"original"!==e._feedbackType&&"function"==typeof e.feedback.remove&&e.feedback.remove()):(this.element.style.zIndex=this.dragZIndex,l(this.host).animate({left:e.originalPosition.left-e._offset.hostRelative.left,top:e.originalPosition.top-e._offset.hostRelative.top},parseInt(this.revertDuration,10),function(){e.element.style.zIndex=e._zIndexBackup})))},_getHandle:function(e){var t;return this.handle?l(this.handle,this.host).find("*").andSelf().each(function(){this==e.target&&(t=!0)}):t=!0,t},_createFeedback:function(e){var t="function"==typeof this._feedbackType?this._feedbackType():"clone"===this._feedbackType?this.host.clone().removeAttr("id"):this.host;return/(absolute|fixed)/.test(t.css("position"))||t.css("position","absolute"),this.appendTo[0]===this.host.parent()[0]&&t[0]===this.element||(t.css({left:this.host.offset().left-this._getParentOffset(this.host).left+this._getParentOffset(t).left,top:this.host.offset().top-this._getParentOffset(this.host).top+this._getParentOffset(t).top}),t.appendTo(this.appendTo)),"function"==typeof this.initFeedback&&this.initFeedback(t),t},_getParentOffset:function(e){e=e||this.feedback;this._offsetParent=e.offsetParent();var t=this._offsetParent.offset();return"absolute"==this._positionType&&this._scrollParent[0]!==document&&l.contains(this._scrollParent[0],this._offsetParent[0])&&(t.left+=this._scrollParent.scrollLeft(),t.top+=this._scrollParent.scrollTop()),(this._offsetParent[0]==document.body||this._offsetParent[0].tagName&&"html"==this._offsetParent[0].tagName.toLowerCase()&&l.jqx.browser.msie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this._offsetParent.css("border-top-width"),10)||0),left:t.left+(parseInt(this._offsetParent.css("border-left-width"),10)||0)}},_getRelativeOffset:function(e){this._scrollParent||e.parent();if("relative"!==(e=e||this.feedback).css("position"))return{top:0,left:0};var t=this.host.position();return{top:t.top-(parseInt(e.css("top"),10)||0),left:t.left-(parseInt(e.css("left"),10)||0)}},_backupeMargins:function(){this.margins={left:parseInt(this.host.css("margin-left"),10)||0,top:parseInt(this.host.css("margin-top"),10)||0,right:parseInt(this.host.css("margin-right"),10)||0,bottom:parseInt(this.host.css("margin-bottom"),10)||0}},_backupFeedbackProportions:function(){this.feedback[0].style.opacity=this.opacity,this._feedbackProportions={width:this.feedback.outerWidth(),height:this.feedback.outerHeight()}},_setRestricter:function(){"parent"==this.restricter&&(this.restricter=this.feedback[0].parentNode),"document"!=this.restricter&&"window"!=this.restricter||this._handleNativeRestricter(),void 0!==this.restricter.left&&void 0!==this.restricter.top&&void 0!==this.restricter.height&&void 0!==this.restricter.width?this._restricter=[this.restricter.left,this.restricter.top,this.restricter.width,this.restricter.height]:/^(document|window|parent)$/.test(this.restricter)||this.restricter.constructor==Array?this.restricter.constructor==Array&&(this._restricter=this.restricter):this._handleDOMParentRestricter()},_handleNativeRestricter:function(){this._restricter=["document"===this.restricter?0:l(window).scrollLeft()-this._offset.relative.left-this._offset.parent.left,"document"===this.restricter?0:l(window).scrollTop()-this._offset.relative.top-this._offset.parent.top,("document"===this.restricter?0:l(window).scrollLeft())+l("document"===this.restricter?document:window).width()-this._feedbackProportions.width-this.margins.left,("document"===this.restricter?0:l(window).scrollTop())+(l("document"===this.restricter?document:window).height()||document.body.parentNode.scrollHeight)-this._feedbackProportions.height-this.margins.top]},_handleDOMParentRestricter:function(){var e,t=l(this.restricter),i=t[0];i&&(e="hidden"!==l(i).css("overflow"),this._restricter=[(parseInt(l(i).css("borderLeftWidth"),10)||0)+(parseInt(l(i).css("paddingLeft"),10)||0),(parseInt(l(i).css("borderTopWidth"),10)||0)+(parseInt(l(i).css("paddingTop"),10)||0),(e?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(l(i).css("borderLeftWidth"),10)||0)-(parseInt(l(i).css("paddingRight"),10)||0)-this._feedbackProportions.width-this.margins.left-this.margins.right,(e?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(l(i).css("borderTopWidth"),10)||0)-(parseInt(l(i).css("paddingBottom"),10)||0)-this._feedbackProportions.height-this.margins.top-this.margins.bottom],this._restrictiveContainer=t)},_convertPositionTo:function(e,t){var i,r,s;return t=t||this.position,i="absolute"===e?1:-1,r="absolute"!==this._positionType||this._scrollParent[0]!=document&&l.contains(this._scrollParent[0],this._offsetParent[0])?this._scrollParent:this._offsetParent,s=/(html|body)/i.test(r[0].tagName),this._getPosition(t,i,s,r)},_getPosition:function(e,t,i,r){return{top:e.top+this._offset.relative.top*t+this._offset.parent.top*t-(l.jqx.browser.safari&&l.jqx.browser.version<526&&"fixed"==this._positionType?0:("fixed"==this._positionType?-this._scrollParent.scrollTop():i?0:r.scrollTop())*t),left:e.left+this._offset.relative.left*t+this._offset.parent.left*t-(l.jqx.browser.safari&&l.jqx.browser.version<526&&"fixed"==this._positionType?0:("fixed"==this._positionType?-this._scrollParent.scrollLeft():i?0:r.scrollLeft())*t)}},_generatePosition:function(e){var t,i,r="absolute"!=this._positionType||this._scrollParent[0]!=document&&l.contains(this._scrollParent[0],this._offsetParent[0])?this._scrollParent:this._offsetParent,s=/(html|body)/i.test(r[0].tagName),o=this._getMouseCoordinates(e),n=o.left,a=o.top;return this.originalPosition&&this.restricter&&(i=this._restrictiveContainer?(t=this._restrictiveContainer.offset(),[this._restricter[0]+t.left,this._restricter[1]+t.top,this._restricter[2]+t.left,this._restricter[3]+t.top]):this._restricter,o.left-this._offset.click.left<i[0]&&(n=i[0]+this._offset.click.left),o.top-this._offset.click.top<i[1]&&(a=i[1]+this._offset.click.top),o.left-this._offset.click.left>i[2]&&(n=i[2]+this._offset.click.left),o.top-this._offset.click.top>i[3]&&(a=i[3]+this._offset.click.top)),{top:a-this._offset.click.top-this._offset.relative.top-this._offset.parent.top+(l.jqx.browser.safari&&l.jqx.browser.version<526&&"fixed"==this._positionType?0:"fixed"==this._positionType?-this._scrollParent.scrollTop():s?0:r.scrollTop()),left:n-this._offset.click.left-this._offset.relative.left-this._offset.parent.left+(l.jqx.browser.safari&&l.jqx.browser.version<526&&"fixed"==this._positionType?0:"fixed"==this._positionType?-this._scrollParent.scrollLeft():s?0:r.scrollLeft())}},_raiseEvent:function(e,t){if(null==this.triggerEvents||0!=this.triggerEvents){var i=this._events[e],r=l.Event(i);return(t=t||{}).position=this.position,t.element=this.element,l.extend(t,this.data),t.feedback=this.feedback,r.args=t,this.host.trigger(r)}},disable:function(){this.disabled=!0,this.host.addClass(this.toThemeProperty("jqx-draggable-disabled")),this._enableSelection(this.host)},enable:function(){this.disabled=!1,this.host.removeClass(this.toThemeProperty("jqx-draggable-disabled"))},propertyChangedHandler:function(e,t,i,r){"dropTarget"===t?"string"==typeof r&&(e.dropTarget=l(r)):"disabled"==t?r&&e._enableSelection(e.host):"cursor"==t&&e.host.css("cursor",e.cursor)}})}(jqxBaseFramework),function(u){window.jqxListBoxDragDrop=function(){u.extend(u.jqx._jqxListBox.prototype,{_hitTestBounds:function(e,t,i){var r=e.host.offset(),s=i-parseInt(r.top),o=t-parseInt(r.left),n=e._hitTest(o,s);if(s<0)return null;if(null!=n){var a=parseInt(r.left),l=a+e.host.width();return a<=t+n.width/2&&t<=l?n:null}if(e.items&&0<e.items.length){var d=e.items[e.items.length-1];if(e.groups.length<2&&d.top+d.height+15>=s)return d}return null},_handleDragStart:function(e,o){u.jqx.mobile.isTouchDevice()&&o.allowDrag&&e.on(u.jqx.mobile.getTouchEventName("touchstart"),function(){u.jqx.mobile.setTouchScroll(!1,o.element.id)}),e.off("dragStart"),e.on("dragStart",function(e){if(o.allowDrag&&!o.disabled){o.feedbackElement=u("<div style='z-index: 99999; position: absolute;'></div>"),o.feedbackElement.addClass(o.toThemeProperty("jqx-listbox-feedback")),o.feedbackElement.appendTo(u(document.body)),o.feedbackElement.hide(),o.isDragging=!0,o._dragCancel=!1;var t=o._getMouseCoordinates(e),i=o._hitTestBounds(o,t.left,t.top),r=u.find(".jqx-listbox");o._listBoxes=r,u.each(o._listBoxes,function(){var e;u.jqx.isHidden(u(this))||((e=u.data(this,"jqxListBox").instance)._enableHover=e.enableHover,e.enableHover=!1,u.jqx.mobile.setTouchScroll(!1,o.element.id))});function s(){o._dragCancel=!0,u(e.args.element).jqxDragDrop({triggerEvents:!1}),u(e.args.element).jqxDragDrop("cancelDrag"),clearInterval(o._autoScrollTimer),u(e.args.element).jqxDragDrop({triggerEvents:!0}),u.each(o._listBoxes,function(){var e;u.jqx.isHidden(u(this))||null!=(e=u.data(this,"jqxListBox").instance)._enableHover&&(e.enableHover=e._enableHover,u.jqx.mobile.setTouchScroll(!0,o.element.id))})}if(null==i||i.isGroup)null==i&&s();else{if(o._dragItem=i,o.dragStart)if(0==o.dragStart(i))return s(),!1;i.disabled&&s(),o._raiseEvent(4,{label:i.label,value:i.value,dragSourceElement:o.element,originalEvent:e.args})}}return!1})},_handleDragging:function(e,f){var t=this;e.off("dragging"),e.on("dragging",function(e){var d,h,c=e.args;f._dragCancel||(d=f._getMouseCoordinates(e),f._lastDraggingPosition=d,f._dragOverItem=null,f.feedbackElement.hide(),h=t._getBestMatchItem(f,d),u.each(f._listBoxes,function(){if(u.jqx.isHidden(u(this)))return!0;var e,t=u(this).offset(),i=t.top+20,r=u(this).height()+i-40,s=t.left,o=s+u(this).width(),n=u.data(this,"jqxListBox").instance,a=n._hitTestBounds(n,d.left,d.top),l=n.vScrollInstance;a&&n.allowDrop&&!n.disabled&&a.element&&h&&h.item&&u(this)[0]==h.item[0]&&(f._dragOverItem=a,f.feedbackElement.show(),e=u(a.element).offset().top+1,d.top>e+a.height/2&&(e+=a.height),f.feedbackElement.css("top",e),f.feedbackElement.css("left",s),"visible"!=n.vScrollBar.css("visibility")?f.feedbackElement.width(u(this).width()):f.feedbackElement.width(u(this).width()-20),d.left>=s&&d.left<o?c.position.top<i&&c.position.top>=i-30?(clearInterval(n._autoScrollTimer),0!=l.value&&f.feedbackElement.hide(),n._autoScrollTimer=setInterval(function(){n.scrollUp()||clearInterval(n._autoScrollTimer)},100)):c.position.top>r&&c.position.top<30+r?(clearInterval(n._autoScrollTimer),"hidden"!=n.vScrollBar.css("visibility")&&l.value!=l.max&&f.feedbackElement.hide(),n._autoScrollTimer=setInterval(function(){n.scrollDown()||clearInterval(n._autoScrollTimer)},100)):clearInterval(n._autoScrollTimer):(null==f._dragOverItem&&f.feedbackElement.hide(),clearInterval(n._autoScrollTimer)))}))})},_getBestMatchItem:function(e,t){for(var i={},r=u.find(".jqx-listbox"),s=0;s<r.length;s++){var o,n,a,l,d,h,c,f,g,p=u(r[s]);u.jqx.isHidden(p)||(n=(o=parseInt(p.offset().left))+p.width(),a=p.jqxListBox("getInstance"),clearInterval(a._autoScrollTimer),null!=a._enableHover&&(a.enableHover=a._enableHover,u.jqx.mobile.setTouchScroll(!0,e.element.id)),null!=e._dragItem&&(l=t.left>=o&&t.left<=n,d=t.left-e._dragItem.width/2>=o&&t.left-e._dragItem.width/2<=n,h=t.left-e._dragItem.width/2>=o&&t.left-e._dragItem.width/2<=n,(l||d||h)&&(f=(c=parseInt(p.offset().top))+p.height(),t.top>=c&&t.top<=f&&(g=t.left+e._dragItem.width/2-(o+n)/2,(isNaN(i.distance)||i.distance>g)&&(i={distance:g,item:p})))))}return i},_handleDragEnd:function(e,c){var f=this;u.find(".jqx-listbox");e.off("dragEnd"),e.on("dragEnd",function(e){clearInterval(c._autoScrollTimer);var t=u.jqx.mobile.isTouchDevice()?c._lastDraggingPosition:c._getMouseCoordinates(e);u.find(".jqx-listbox");if(c.feedbackElement.remove(),!c._dragCancel){var i=f._getBestMatchItem(c,t).item,r=c._dragItem,s=null;if(null!=i&&0<i.length){var o=(n=u.data(i[0],"jqxListBox").instance).allowDrop,s=n.element;if(o&&!n.disabled){var n,a=(n=u.data(i[0],"jqxListBox").instance)._hitTestBounds(n,t.left,t.top);if(null==(a=c._dragOverItem)||a.isGroup){if("none"!=n.dropAction){if(0<n.content.find(".draggable").length&&n.content.find(".draggable").jqxDragDrop("destroy"),c.dragEnd){if(0==(h=c.dragEnd(c._dragItem,null,e.args)))return u(e.args.element).jqxDragDrop({triggerEvents:!1}),u(e.args.element).jqxDragDrop("cancelDrag"),clearInterval(c._autoScrollTimer),u(e.args.element).jqxDragDrop({triggerEvents:!0}),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1;null==h&&(h=!0)}n.addItem(c._dragItem),"default"==n.dropAction&&(0<r.visibleIndex&&c.selectIndex(r.visibleIndex-1),c.removeItem(r,!0)),n.clearSelection(),n.selectIndex(n.items.length-1)}}else{var l,d,h=!0;if(c.dragEnd){if(0==(h=c.dragEnd(r,a,e.args)))return u(e.args.element).jqxDragDrop({triggerEvents:!1}),u(e.args.element).jqxDragDrop("cancelDrag"),clearInterval(c._autoScrollTimer),u(e.args.element).jqxDragDrop({triggerEvents:!0}),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1;null==h&&(h=!0)}h&&(a.visibleIndex,"none"!=n.dropAction&&(l=a.element?u(a.element).offset().top+1:u(n.element).offset().top+1,0<n.content.find(".draggable").length&&n.content.find(".draggable").jqxDragDrop("destroy"),t.top>l+a.height/2?n.insertAt(c._dragItem,a.index+1):n.insertAt(c._dragItem,a.index),"default"==c.dropAction&&(0<r.visibleIndex&&(c.clearSelection(),c.selectIndex(r.visibleIndex-1)),c.removeItem(r,!0)),d=function(){for(var e=a.visibleIndex,t=e-2;t<=e+2;t++)if(n.items&&n.items.length>t){var i=n.items[t];if(null!=i&&i.value==r.value)return i.visibleIndex}return e}(),n.clearSelection(),n.selectIndex(d)))}}}else{if(c.dragEnd)if(0==c.dragEnd(r,e.args))return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}return null!=r&&c._raiseEvent(5,{label:r.label,value:r.value,index:r.index,dropTargetElement:s,originalEvent:e.args}),!1}e.stopPropagation()})},_enableDragDrop:function(){var e,r;this.allowDrag&&this.host.jqxDragDrop&&(0<(e=this.content.find(".draggable")).length&&(r=this,e.jqxDragDrop({cursor:"arrow",revertDuration:0,appendTo:"body",dragZIndex:99999,revert:!0,initFeedback:function(e){var t=u('<span style="white-space: nowrap;" class="'+r.toThemeProperty("jqx-fill-state-normal")+'">'+e.text()+"</span>");u(document.body).append(t);var i=t.width();t.remove(),e.width(i+5),e.addClass(r.toThemeProperty("jqx-fill-state-pressed"))}}),this._autoScrollTimer=null,r._dragItem=null,r._handleDragStart(e,r),r._handleDragging(e,r),r._handleDragEnd(e,r)))},_getMouseCoordinates:function(e){if(this._isTouchDevice=u.jqx.mobile.isTouchDevice(),this._isTouchDevice){var t=u.jqx.position(e.args);return{left:t.left,top:t.top}}return{left:e.args.pageX,top:e.args.pageY}}})},window.jqxTreeDragDrop=function(){u.extend(u.jqx._jqxTree.prototype,{_hitTestBounds:function(i,r,s){var o,n,a=null;return i._visibleItems&&(o=parseInt(i.host.offset().left),n=i.host.outerWidth(),u.each(i._visibleItems,function(e){if(o<=r&&r<o+n&&this.top+5<s&&s<this.top+this.height){var t=u(this.element).parents("li:first");if(0<t.length&&null!=(a=i.getItem(t[0])))return a.height=this.height,a.top=this.top,!1}})),a},_handleDragStart:function(e,o){o._dragOverItem&&o._dragOverItem.titleElement.removeClass(o.toThemeProperty("jqx-fill-state-hover")),u.jqx.mobile.isTouchDevice()&&o.allowDrag&&e.on(u.jqx.mobile.getTouchEventName("touchstart"),function(){u.jqx.mobile.setTouchScroll(!1,"panel"+o.element.id)}),e.off("dragStart"),e.on("dragStart",function(s){o.feedbackElement=u("<div style='z-index: 99999; position: absolute;'></div>"),o.feedbackElement.addClass(o.toThemeProperty("jqx-listbox-feedback")),o.feedbackElement.appendTo(u(document.body)),o.feedbackElement.hide(),o._dragCancel=!1;s.args.position;var e=u.find(".jqx-tree");return o._trees=e,u.each(e,function(){var e=u.data(this,"jqxTree").instance,t=e.host.find(".draggable");if(e._syncItems(t),e.allowDrag&&!e.disabled){var i=u(s.target).parents("li:first");if(0<i.length){var r=e.getItem(i[0]);if(r){if(o._dragItem=r,e.dragStart)if(0==e.dragStart(r))return o._dragCancel=!0,u(s.args.element).jqxDragDrop({triggerEvents:!1}),u(s.args.element).jqxDragDrop("cancelDrag"),clearInterval(o._autoScrollTimer),u(s.args.element).jqxDragDrop({triggerEvents:e}),!1;e._raiseEvent(8,{label:r.label,value:r.value,originalEvent:s.args})}}}}),!1})},_getMouseCoordinates:function(e){if(this._isTouchDevice=u.jqx.mobile.isTouchDevice(),this._isTouchDevice){var t=u.jqx.position(e.args);return{left:t.left,top:t.top}}return{left:e.args.pageX,top:e.args.pageY}},_handleDragging:function(e,f){(e=this.host.find(".draggable")).off("dragging"),e.on("dragging",function(e){e.args.position;var h,c,t=f._trees;f._dragCancel||(f._dragOverItem&&f._dragOverItem.titleElement.removeClass(f.toThemeProperty("jqx-fill-state-hover")),h=!0,c=f._getMouseCoordinates(e),f._lastDraggingPosition=c,u.each(t,function(){if(u.jqx.isHidden(u(this)))return!0;var e,t,i,r,s=u(this).offset(),o=s.top+20,n=u(this).height()+o-40,a=s.left,l=a+u(this).width(),d=u.data(this,"jqxTree").instance;!d.disabled&&d.allowDrop&&(e=d.vScrollInstance,null!=(t=d._hitTestBounds(d,c.left,c.top))&&(f._dragOverItem&&f._dragOverItem.titleElement.removeClass(d.toThemeProperty("jqx-fill-state-hover")),(f._dragOverItem=t).element&&(f.feedbackElement.show(),i=t.top,r=c.top,f._dropPosition="before",r>i+t.height/3&&(i=t.top+t.height/2,f._dragOverItem.titleElement.addClass(f.toThemeProperty("jqx-fill-state-hover")),f.feedbackElement.hide(),f._dropPosition="inside"),r>t.top+t.height-t.height/3&&(i=t.top+t.height,f._dragOverItem.titleElement.removeClass(f.toThemeProperty("jqx-fill-state-hover")),f.feedbackElement.show(),f._dropPosition="after"),f.feedbackElement.css("top",i),a=-2+parseInt(t.titleElement.offset().left),f.feedbackElement.css("left",a),f.feedbackElement.width(u(t.titleElement).width()+12))),c.left>=a&&c.left<l?(c.top+20>=o&&c.top<=o+d.host.height()&&(h=!1),c.top<o&&c.top>=o-30?(clearInterval(d._autoScrollTimer),0!=e.value&&f.feedbackElement.hide(),d._autoScrollTimer=setInterval(function(){var e=d.panelInstance.scrollUp(),t=d.host.find(".draggable");d._syncItems(t),e||clearInterval(d._autoScrollTimer)},100)):c.top>n&&c.top<30+n?(clearInterval(d._autoScrollTimer),e.value!=e.max&&f.feedbackElement.hide(),d._autoScrollTimer=setInterval(function(){var e=d.panelInstance.scrollDown(),t=d.host.find(".draggable");d._syncItems(t),e||clearInterval(d._autoScrollTimer)},100)):clearInterval(d._autoScrollTimer)):clearInterval(d._autoScrollTimer))}),h&&f.feedbackElement&&f.feedbackElement.hide())})},_handleDragEnd:function(e,f){e.off("dragEnd"),e.on("dragEnd",function(e){f.host.find(".draggable");clearInterval(f._autoScrollTimer);e.args.position;var t=f._trees,o=null,n=u.jqx.mobile.isTouchDevice()?f._lastDraggingPosition:f._getMouseCoordinates(e);if(f.feedbackElement.remove(),f._dragCancel)return!1;f._dragOverItem&&f._dragOverItem.titleElement.removeClass(f.toThemeProperty("jqx-fill-state-hover")),u.each(t,function(){if(u.jqx.isHidden(u(this)))return!0;var e,t,i=parseInt(u(this).offset().left),r=i+u(this).width(),s=u.data(this,"jqxTree").instance;clearInterval(s._autoScrollTimer),null!=f._dragItem&&n.left>=i&&n.left<r&&(t=(e=parseInt(u(this).offset().top))+u(this).height(),n.top>=e&&n.top<=t&&(o=u(this)))});var i,r,s,a,l,d,h,c=f._dragItem;if(null!=o&&0<o.length)o.jqxTree("allowDrop")&&(i=u.data(o[0],"jqxTree").instance,null!=(r=f._dragOverItem)&&f._dragOverItem.treeInstance.element.id==i.element.id?(l=!0,f.dragEnd&&(0==(l=f.dragEnd(c,r,e.args,f._dropPosition,o))&&(u(e.args.element).jqxDragDrop({triggerEvents:!1}),u(e.args.element).jqxDragDrop("cancelDrag"),clearInterval(f._autoScrollTimer),u(e.args.element).jqxDragDrop({triggerEvents:!0})),null==l&&(l=!0)),l&&(s=function(){var e=f._dragItem.treeInstance;e._refreshMapping(),e._updateItemsNavigation(),e._render(!0,!1),e.checkboxes&&e._updateCheckStates(),f._dragItem.treeInstance=i,f._syncItems(f._dragItem.treeInstance.host.find(".draggable"))},"none"!=i.dropAction&&f._dragItem.id!=f._dragOverItem.id&&("inside"==f._dropPosition?i._drop(f._dragItem.element,f._dragOverItem.element,-1,i):(a=0,"after"==f._dropPosition&&a++,i._drop(f._dragItem.element,f._dragOverItem.parentElement,a+u(f._dragOverItem.element).index(),i)),s()),i._render(!0,!1),h=i.host.find(".draggable"),f._syncItems(h),f._dragOverItem=null,f._dragItem=null,i._refreshMapping(),i._updateItemsNavigation(),i.selectedItem=null,i.selectItem(c.element),i.checkboxes&&i._updateCheckStates(),i._render(!0,!1))):"none"!=i.dropAction&&i.allowDrop&&(l=!0,f.dragEnd&&(0==(l=f.dragEnd(c,r,e.args,f._dropPosition,o))&&(u(e.args.element).jqxDragDrop({triggerEvents:!1}),u(e.args.element).jqxDragDrop("cancelDrag"),clearInterval(f._autoScrollTimer),u(e.args.element).jqxDragDrop({triggerEvents:!0})),null==l&&(l=!0)),l&&(f._dragItem.parentElement=null,i._drop(f._dragItem.element,null,-1,i),(d=f._dragItem.treeInstance)._refreshMapping(),d._updateItemsNavigation(),d.checkboxes&&d._updateCheckStates(),h=d.host.find(".draggable"),f._syncItems(h),(f._dragItem.treeInstance=i).items[i.items.length]=f._dragItem,i._render(!0,!1),i._refreshMapping(),i.selectItem(c.element),i._updateItemsNavigation(),h=i.host.find(".draggable"),i._syncItems(h),i.checkboxes&&i._updateCheckStates(),f._dragOverItem=null,f._dragItem=null)));else if(f.dragEnd&&0==f.dragEnd(c,e.args))return!1;return null!=c&&f._raiseEvent(7,{label:c.label,value:c.value,originalEvent:e.args}),!1})},_drop:function(e,t,i,r){var s,o,n,a;0<u(t).parents("#"+e.id).length||null!=t&&t.id==e.id||(r.element.innerHTML.indexOf("UL")&&(s=r.host.find("ul:first")),null==t&&null==t?null==i||-1==i?s.append(e):0==s.children("li").eq(i).length?s.children("li").eq(i-1).after(e):s.children("li").eq(i)[0].id!=e.id&&s.children("li").eq(i).before(e):null==i||-1==i?0==(o=(t=u(t)).find("ul:first")).length?(n=u("<ul></ul>"),u(t).append(n),o=t.find("ul:first"),(a=r.itemMapping["id"+t[0].id].item).subtreeElement=o[0],a.hasItems=!0,o.addClass(r.toThemeProperty("jqx-tree-dropdown")),o.append(e),e=o.find("li:first"),a.parentElement=e):o.append(e):0==(o=(t=u(t)).find("ul:first")).length?(n=u("<ul></ul>"),u(t).append(n),o=t.find("ul:first"),t&&((a=r.itemMapping["id"+t[0].id].item).subtreeElement=o[0],a.hasItems=!0),o.addClass(r.toThemeProperty("jqx-tree-dropdown")),o.append(e),e=o.find("li:first"),a.parentElement=e):0==o.children("li").eq(i).length?o.children("li").eq(i-1).after(e):o.children("li").eq(i)[0].id!=e.id&&o.children("li").eq(i).before(e))},_enableDragDrop:function(){var e,r;this.allowDrag&&this.host.jqxDragDrop&&(e=this.host.find(".draggable"),r=this,0<e.length&&(e.jqxDragDrop({cursor:"arrow",revertDuration:0,appendTo:"body",dragZIndex:99999,revert:!0,initFeedback:function(e){var t=u('<span style="white-space: nowrap;" class="'+r.toThemeProperty("jqx-fill-state-normal")+'">'+e.text()+"</span>");u(document.body).append(t);var i=t.width();t.remove(),e.width(i+5),e.addClass(r.toThemeProperty("jqx-fill-state-pressed"))}}),!0===e.jqxDragDrop("isDestroyed")&&e.jqxDragDrop("_createDragDrop"),this._autoScrollTimer=null,r._dragItem=null,r._handleDragStart(e,r),r._handleDragging(e,r),r._handleDragEnd(e,r)))}})}}(jqxBaseFramework);