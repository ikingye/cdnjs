!function(u){u.jqx.jqxWidget("jqxPivotGrid","",{}),u.extend(u.jqx._jqxPivotGrid.prototype,{defineInstance:function(){var t={scrollBarsEnabled:!0,source:null,groupingColumns:[],isGroupingEnabled:!1,_offsetX:0,_offsetY:0,_currentPosition:{},_selectStartPosition:{},_isMouseLeftButtonDown:!1,_timeLastUp:new Date,_timeLastDown:new Date,resizeTooltipEnabled:!1,isHorizontalResize:!0,_colResizeState:"NO_RESIZE",activeEditor:{Editor:null},_id:0,_colItemRangeSelectionBeg:null,_colItemRangeSelectionEnd:null,_rowItemRangeSelectionBeg:null,_rowItemRangeSelectionEnd:null,_isCTRLPressed:!1,_internalSelectMode:"CELLS_SELECT",_mostRightItemBounds:{x:0,y:0,width:0,height:0},_mostLeftItemBounds:{x:0,y:0,width:0,height:0},_adjSelectedItemsSave:{},multipleSelectionEnabled:!0,selectionEnabled:!0,selectionMode:"CELLS_SELECT",treeStyleRows:!0,autoResize:!1,cellsRenderer:null,itemsRenderer:null,localization:null};return u.extend(!0,this,t),this._createPivotAreas(),t},_createPivotAreas:function(){this._pivotRows&&(this._pivotRows.clear(),delete this._pivotRows),this._pivotColumns&&(this._pivotColumns.clear(),delete this._pivotColumns),this._pivotCells&&(this._pivotCells._resetCanvas(),this._pivotCells.clear(),delete this._pivotCells),this._pivotRows=new u.jqx.jqxPivotGrid.pivotRows(this),this._pivotColumns=new u.jqx.jqxPivotGrid.pivotColumns(this),this._pivotCells=new u.jqx.jqxPivotGrid.pivotCells,this._pivotCells.parentPivotGrid=this},_instanceId:0,createInstance:function(t){this.element;var e=this.host,i=this;i.localizeStrings(i.localization);var s="jqx-pivotgrid jqx-rc-all jqx-widget "+this.toThemeProperty("jqx-widget-content"),n="";this._isTouchDevice()&&(n="class='jqx-grid-menu-item-touch'"),e.append("<div class='"+s+"' style='width:100%; height: 100%; overflow:hidden; position:relative; onselectstart='return false;' oncontextmenu='return false;''><div id='divContent' style='width:100px; height:100%;'></div><div id='divHScroll' style='width:100%; height:17px;'></div><div id='divVScroll' style='width:17px; height:100%;'></div><div id='divContextMenu'><ul><li "+n+"><div id='sortasc' class='jqx-pivotgrid-sortasc-icon'></div><span>"+i._localizedStrings.sortascendingstring+"</span></li><li "+n+"><div id='sortdesc' class='jqx-pivotgrid-sortdesc-icon'></div><span>"+i._localizedStrings.sortdescendingstring+"</span></li><li "+n+"><div id='sortremove' class='jqx-pivotgrid-sortremove-icon'></div><span>"+i._localizedStrings.sortremovestring+"</span></li></ul></div></div>");var o=e.find("#divContent"),r=(o[0],document.createElement("div"));r.style.position="relative",r.style.left="0px",r.style.top="0px",r.style.width="100%",r.style.height="100%",r.style.overflow="hidden",o.append(r),this.contentCanvas=this.Canvas=r,this.hostVScroll=e.find("#divVScroll"),this.hostHScroll=e.find("#divHScroll"),this.hScroll=e.find("#divHScroll").jqxScrollBar({vertical:!1,theme:this.theme}),this.vScroll=e.find("#divVScroll").jqxScrollBar({vertical:!0,theme:this.theme}),i._createContextMenu(),i.id=i._instanceId++,i._resizeLineId="divResizeLine"+i.id,u(document.body).append("<div id='"+i._resizeLineId+"' style='position: absolute; display: none;'></div>");try{i.dataBind()}catch(t){throw"Databinding exception: "+t.toString()}i._installEventHandlers(),u.jqx.utilities.resize(i.host,function(){i.refresh()},!1),i._isInitialized||(i._isInitialized=!0)},destroy:function(){this._isInitialized=!1,this.host.find("#divHScroll").off(),this.host.find("#divVScroll").off(),this._contextMenu.off(),this.removeHandler(this.host),u.jqx.utilities.resize(this.host,null,!0)},_installEventHandlers:function(){var i=this;i.hostVScroll.on("valueChanged",function(t){t.currentTarget==i.hostVScroll[0]&&i.onVScroll(t.currentValue)}),i.hostHScroll.on("valueChanged",function(t){t.currentTarget==i.hostHScroll[0]&&i.onHScroll(t.currentValue)}),i.addHandler(i.host,"mousewheel DOMMouseScroll",function(t){var e;i._isContextMenuOpen||i._pivotDesigner&&i._pivotDesigner._isWindowOpen()||(e=u.jqx.position(t),i.isPtInRect({x:e.left,y:e.top},i._rect)&&(t.preventDefault(),i._scrollBarPositions.vertical.visible&&i.onMouseWheel(t)))}),i.addHandler(i.host,"mouseenter",function(t){t.currentTarget==i.element&&i._onMouseEnter(t)}),i.addHandler(i.host,"mouseleave",function(t){t.currentTarget==i.element&&i._onMouseLeave(t)}),i.addHandler(i.host,"mousedown",function(t){i._isContextMenuOpen||i._pivotDesigner&&i._pivotDesigner._isWindowOpen()||(t.preventDefault(),i._onMouseDown(t),this.focus())}),i.addHandler(u(document),"mouseup",function(t){var e;i._isContextMenuOpen||i._pivotDesigner&&i._pivotDesigner._isWindowOpen()||(t.preventDefault(),i._onMouseUp(t),t.cancel||(e=u.jqx.position(t),!i.isPtInRect({x:e.left,y:e.top},i._rect)&&"RESIZING"!=i._colResizeState||i._onMouseClick(t)))}),i.addHandler(u(document),"mousemove",function(t){i._isContextMenuOpen||i._pivotDesigner&&i._pivotDesigner._isWindowOpen()||i._onMouseMove(t)}),i.addHandler(u(document),"keydown",function(t){i._isContextMenuOpen||i._pivotDesigner&&i._pivotDesigner._isWindowOpen()||i._isContextMenuOpen||(17==t.keyCode?i._isCTRLPressed=!0:16==t.keyCode?i._isSHIFTPressed=!0:i._handleKeyboardNavigation&&i._handleKeyboardNavigation(t))}),i.addHandler(u(document),"keyup",function(t){i._isContextMenuOpen||i._pivotDesigner&&i._pivotDesigner._isWindowOpen()||i._isContextMenuOpen||(17==t.keyCode?i._isCTRLPressed=!1:16==t.keyCode&&(i._isSHIFTPressed=!1))})},_createContextMenu:function(){var n=this,t=this.host.find("#divContextMenu");n._contextMenu=t.jqxMenu({width:"120px",autoCloseOnClick:!0,autoOpenPopup:!1,animationShowDuration:0,animationHideDuration:0,animationShowDelay:0,theme:this.theme,keyboardNavigation:!1,mode:"popup"});for(var e=t.find("li"),i="",s=0;s<e.length;s++){var o=u(e[s]).text();o.length>i.length&&(i=o)}var r=u('<span style="white-space:nowrap;">'+i+"</span>");r.addClass(this.toThemeProperty("jqx-menu-item")),this.host.append(r);var l=r.outerWidth()+30;r.remove(),n._contextMenu=t.jqxMenu({width:l}),n._contextMenu.on("shown",function(){n._isContextMenuOpen=!0}),n._contextMenu.on("closed",function(){n._isContextMenuOpen=!1,n._hideItemMenuElement()}),n._contextMenu.on("itemclick",function(t){t.stopImmediatePropagation(),t.stopPropagation();var e,i,s=n._menuElement._itemMouseOver;s&&(e=s.hierarchy==n._pivotColumns?n._pivotRows:n._pivotColumns,-1!=(i=t.args.innerHTML).indexOf("sortasc")?e.sortBy(s,"asc"):-1!=i.indexOf("sortdesc")?e.sortBy(s,"desc"):-1!=i.indexOf("sortremove")&&e.removeSort())})},_isTouchDevice:function(){if(null!=this.touchDevice)return this.touchDevice;var t=u.jqx.mobile.isTouchDevice();if(this.touchDevice=t,1==this.touchmode){if(u.jqx.browser.msie&&u.jqx.browser.version<9)return this.enablehover=!1;t=!0,u.jqx.mobile.setMobileSimulator(this.element),this.touchDevice=t}else 0==this.touchmode&&(t=!1);return t&&0!=this.touchModeStyle&&(this.touchDevice=!0,this.host.addClass(this.toThemeProperty("jqx-touch")),this.host.find("jqx-widget-content").addClass(this.toThemeProperty("jqx-touch")),this.host.find("jqx-widget-header").addClass(this.toThemeProperty("jqx-touch")),this.scrollbarsize=this.touchscrollbarsize),t},propertyChangedHandler:function(t,e,i,s){null!=this._isInitialized&&0!=this._isInitialized&&("source"==e?this.dataBind():"theme"==e&&(this.hostVScrollBar.jqxScrollBar("theme",this.theme),this.hostHScrollBar.jqxScrollBar("theme",this.theme)),this._internalRefresh())},genId:function(){return this._id++},getCellId:function(t,e){return t.id+"_"+e.id},_scrollTimer:void 0,_renderOnTimeout:function(t){clearTimeout(this._scrollTimer);var e=this;0==t?(this._pivotColumns._refreshRequired=this._pivotRows._refreshRequired=!0,e._internalRefresh()):this._scrollTimer=setTimeout(function(){e._render()},t)},onVScroll:function(t){(t=Math.round(t))!=this._offsetY&&(this._offsetY=t,this._renderOnTimeout(0))},onHScroll:function(t){(t=Math.round(t))!=this._offsetX&&(this._offsetX=t,this._renderOnTimeout(0))},onMouseWheel:function(t){var e,i,s,n=0;(t=t||window.event).wheelDelta?n=t.wheelDelta/120:t.detail&&(n=-t.detail/3),n&&(t.preventDefault&&t.preventDefault(),t.returnValue=!1,e=this.vScroll.jqxScrollBar("min"),i=this.vScroll.jqxScrollBar("max"),s=this.vScroll.jqxScrollBar("value"),i<(s-=n*=10)&&(s=i),s<e&&(s=e),this.vScroll.jqxScrollBar("value",s))},_onMouseMove:function(t){var e=u.jqx.position(t),i=e.left,s=e.top;if(this.isPtInRect({x:i,y:s},this._rect)||"RESIZING"==this._colResizeState){var n=this.host.offset();if(i-=Math.round(n.left),s-=Math.round(n.top),i=Math.max(i,0),s=Math.max(s,0),this._currentPosition.x!=i||this._currentPosition.y!=s){for(var o in this._currentPosition.x=i,this._currentPosition.y=s,this._scrollBarPositions)if(this._scrollBarPositions[o].visible&&this.isPtInRect({x:i,y:s},this._scrollBarPositions[o].rect))return;this._handleMouseMove(t),this.activeEditor&&this.activeEditor.Editor}}},_onMouseEnter:function(t){},_onMouseLeave:function(t){this._hideItemMenuElement()},_onMouseDown:function(t){var e=this._itemHitTest(this._currentPosition,{isOnItemButton:!1});if(null!=e&&this._raisePivotItemMouseEvent(e,"pivotitemmousedown",0==t.button?"left":"right"))return void(t.cancel=!0);0==t.button?this.onMouseLeftButtonDown(t):2==t.button&&this.onMouseRightButtonDown(t)},_onMouseUp:function(t){var e=this._itemHitTest(this._currentPosition,{isOnItemButton:!1});if(null!=e&&this._raisePivotItemMouseEvent(e,"pivotitemmouseup",0==t.button?"left":"right"))return void(t.cancel=!0);0==t.button?this.onMouseLeftButtonUp(t):2==t.button&&this.onMouseRightButtonUp(t)},_onMouseClick:function(t){var e=this;if(e._handleMouseClick(t),!t.cancel){if(e._dtLastMouseClick)if(new Date-e._dtLastMouseClick<500)return this._handleMouseDoubleClick(t),void(e._dtLastMouseClick=void 0);e._dtLastMouseClick=new Date}},setDivContent:function(t,e,i,s,n){var o=this.getChild(t,"innerDiv");o.style.padding=i.top+"px "+i.right+"px "+i.bottom+"px "+i.left+"px",s&&(o.style["text-align"]=s),this.setElementSize(t,parseFloat(t.style.width),parseFloat(t.style.height)),n&&(o.style.width=parseFloat(t.style.width)-i.left+"px"),o.innerHTML=e},setElementPosition:function(t,e,i){t.style.position="absolute",t.style.left=e+"px",t.style.top=i+"px"},_getFloat:function(t){for(var e,i=0;i<t.length;i++)if(e=parseFloat(t[i]),!isNaN(e))return e;return NaN},setElementSize:function(t,e,i){t.style.width=e+"px",t.style.height=i+"px";var s,n,o,r,l=this.getChild(t,"innerDiv");l&&(s=this._getFloat([l.style.padding.left,l.style.padding,0]),n=this._getFloat([l.style.padding.right,l.style.padding,0]),o=this._getFloat([l.style.padding.top,l.style.padding,0]),r=this._getFloat([l.style.padding.bottom,l.style.padding,0]),l.style.width=e-s-n+"px",l.style.height=i-o-r+"px")},createCanvas:function(t){var e=document.createElement("div");return e.style["background-color"]="transparent",e.style.overflow="hidden",t.appendChild(e),e},createDiv:function(t,e,i,s){var n=document.createElement("div");n.id=e,n.style.height=s+"px",n.style.width=i+"px";var o=document.createElement("div");return o.id="innerDiv",o.style.height=s+"px",o.style.width=i+"px",n.appendChild(o),t.appendChild(n),n},getPivotRows:function(){return this._pivotRows},getPivotColumns:function(){return this._pivotColumns},getPivotCells:function(){return this._pivotCells},_layout:function(){this.host.find("#divContent"),this.host.find("#divVScroll"),this.host.find("#divHScroll"),this.host.width(),this.host.height();this._pivotCells.Canvas||(this._pivotCells.Canvas=this.createCanvas(this.Canvas,"divCells",100,100)),this._pivotRows.Canvas||(this._pivotRows.Canvas=this.createCanvas(this.Canvas,"divRowsHierarchy",100,100)),this._pivotColumns.Canvas||(this._pivotColumns.Canvas=this.createCanvas(this.Canvas,"divColumnsHierarchy",100,100)),this._pivotRows.isHidden?this._pivotRows.Canvas.style.display="none":(this._pivotRows.Canvas.style.display="block",this.setElementPosition(this._pivotRows.Canvas,this._pivotRows.x,this._pivotRows.y),this.setElementSize(this._pivotRows.Canvas,this._pivotRows.getWidth()+1,this._pivotRows.getHeight()),null==this._pivotRows.renderCanvas&&(this._pivotRows.renderCanvas=this.createCanvas(this._pivotRows.Canvas,"divRowsRender",100,100)),this.setElementSize(this._pivotRows.renderCanvas,this._pivotRows.getWidth()+1,this._pivotRows.getHeight())),this._pivotColumns.isHidden?this._pivotColumns.Canvas.style.display="none":(this._pivotColumns.Canvas.style.display="block",this.setElementPosition(this._pivotColumns.Canvas,this._pivotColumns.x,this._pivotColumns.y),this.setElementSize(this._pivotColumns.Canvas,this._pivotColumns.getWidth(),this._pivotColumns.getHeight()+1),null==this._pivotColumns.renderCanvas&&(this._pivotColumns.renderCanvas=this.createCanvas(this._pivotColumns.Canvas,"divColumnsRender",100,100)),this.setElementSize(this._pivotColumns.renderCanvas,this._pivotColumns.getWidth(),this._pivotColumns.getHeight()+1)),this.setElementPosition(this._pivotCells.Canvas,this._pivotColumns.x,this._pivotRows.y),this.setElementSize(this._pivotCells.Canvas,this._pivotCells.viewPort.width,this._pivotCells.viewPort.height),null==this._pivotCells.renderCanvas&&(this._pivotCells.renderCanvas=this.createCanvas(this._pivotCells.Canvas,"divCellsRender",100,100)),this.setElementSize(this._pivotCells.renderCanvas,this._pivotColumns.getWidth()+1,this._pivotRows.getHeight()+1)},refresh:function(){this._pivotColumns._renderRequired=!0,this._pivotRows._renderRequired=!0,this._pivotCells.clear(),this._internalRefresh()},_internalRefresh:function(){var t,e,i,s,n,o=this.host.offset();this.autoResize&&(t=this._pivotColumns.isHidden?0:this._pivotColumns.getHeight(),e=this._pivotColumns.isHidden?0:this._pivotColumns.getWidth(),i=this._pivotRows.isHidden?0:this._pivotRows.getHeight(),s=this._pivotRows.isHidden?0:this._pivotRows.getWidth(),(n={}).width=e+s+1,n.height=t+i+1,n.width==this.host.width()&&n.height==this.host.height()||(this._pivotColumns._renderRequired=this._pivotRows._renderRequired=!0,this.host.css({width:n.width+"px",height:n.height+"px"}))),this._rect={x:o.left,y:o.top,width:this.host.width(),height:this.host.height()},this._render(),this.host.find("#divHScroll").jqxScrollBar("refresh")},_render:function(){var t=this._pivotColumns._renderRequired||this._pivotRows._renderRequired;this._pivotRows.compactStyleRenderingEnabled!=this.treeStyleRows&&(this._pivotRows.compactStyleRenderingEnabled=this.treeStyleRows,t=!0),t&&(this._pivotRows._renderRequired=this._pivotColumns._renderRequired=!0,this.RenderGridContent(),this._layout()),this._pivotRows.viewPort.y=this._offsetY+(this._pivotColumns.isVisible()?this._pivotColumns.viewPort.height:0),this._pivotColumns.viewPort.x=this._offsetX+(this._pivotRows.isVisible()?this._pivotRows.viewPort.width:0),this._pivotColumns.refresh(),this._pivotRows.refresh(),this._pivotCells.render(),this._updateMenuElement()},_updateMenuElement:function(){var t=this.host.find("#divContent")[0];this._menuElement&&(u(this._menuElement).off(),t.removeChild(this._menuElement));var e=document.createElement("div");e.style.height="16px",e.style.width="16px",e.style.id="menu_element",e.style.align="left",e.style.valign="top",e.style.display="none",t.appendChild(e),this._menuElement=e;var i=this;u(i._menuElement).on("click",function(){i._showItemContextMenu()})},dataBind:function(){var t=this.source;function h(t,e,i,s,n){for(var o in t.items){var r=t.items[o];(l=new u.jqx.jqxPivotGrid.pivotItem(i,s)).text=r.text,l.adapterItem=r,l.isColumn=n,e.items.push(l),h(r,l,l,s,n)}for(var o in t.valueItems){var l,r=t.valueItems[o];(l=new u.jqx.jqxPivotGrid.pivotItem(i,s)).adapterItem=r,l.text=r.text,l.isColumn=n,l._isValueItem=!0,e.valueItems.push(l),h(r,l,l,s,n)}}this.localization&&!t.localization&&(t.localization=this.localization),t.dataBind(),this._createPivotAreas(),h(t._rowsHierarchy,this._pivotRows,null,this._pivotRows,!1),h(t._columnsHierarchy,this._pivotColumns,null,this._pivotColumns,!0),this.bindingState="DataBoundPivot",this._pivotRows.autoResize("default"),this._pivotColumns.autoResize("default"),this._internalRefresh()},getChild:function(t,e){for(var i=t.childNodes,s=0;s<i.length;s++)if(i[s].id==e)return i[s];return null},scrollToOffset:function(t,e){for(var i=this.gridcells,s=0;s<i.length;s++)i[s].style.top=e+parseInt(i[s].originalY)+"px",this.setDivContent(i[s],"cell "+s)},getWidth:function(){return this.host.width()},getHeight:function(){return this.host.height()},RenderGridContent:function(){if(!this._pivotColumns._renderRequired&&!this._pivotRows._renderRequired)return this._pivotRows.viewPort.y=this._offsetY,void(this._pivotColumns.viewPort.x=this._offsetX);var t,e,i,s,n,o,r,l,h,a,d;this.PaintSuspended||"RESIZING"!=this._colResizeState&&((t={}).x=this._offsetX,t.y=this._offsetY,t.width=this.getWidth(),t.height=this.getHeight(),0!=t.width&&0!=t.height&&(this.PaintSuspended=!0,this._pivotColumns._isColumnsCountRequresUpdate&&(this._pivotColumns._updateVisibleLeaves(),this._pivotColumns._updateColumnsCount(),this._pivotColumns._updateColumnsIndexes()),this._pivotRows._isColumnsCountRequresUpdate&&(this._pivotRows._updateColumnsCount(),this._pivotRows._updateColumnsIndexes()),0!=this.getWidth()&&0!=this.getHeight()&&(this.GroupingEnabled&&0<this.groupingColumns.length&&(this._pivotRows.isHidden=!0),this._pivotColumns._renderRequired&&this._pivotColumns.render(),this._pivotRows._renderRequired&&this._pivotRows.render(),e=this._pivotColumns.isVisible()?this._pivotColumns.getHeight():0,i=this._pivotRows.isVisible()?this._pivotRows.getWidth():0,s={width:this._pivotColumns.getWidth()+i,height:this._pivotRows.getHeight()+e},this.scrollableAreaSize==s&&!this.isSyncScrollRequired||(this.scrollableAreaSize=s,this.SynchronizeScrollBars()),n=this.host.find("#divContent"),o=this.host.find("#divVScroll"),l="none"!=(r=this.host.find("#divHScroll")).css("display"),h="none"!=o.css("display"),n.css({height:t.height-(l?r.height()+4:0)+"px"}),n.css({width:t.width-(h?o.width()+4:0)+"px"}),a=t.height,t.height==this.getHeight()&&(a=t.height-e-(l?r.height()+4:0))<0&&(a=t.height),this._pivotRows.x=0,this._pivotRows.y=e,this._pivotRows.viewPort={x:this._pivotRows.x,y:t.y,width:this._pivotRows.getWidth(),height:a},d=t.width,t.width==this.getWidth()&&(d=t.width-i-(h?o.width()+4:0))<0&&(d=t.width),this._pivotColumns.x=i,this._pivotColumns.y=0,this._pivotColumns.viewPort={x:t.x,y:this._pivotColumns.y,width:d,height:this._pivotColumns.getHeight()},this._pivotCells.Bounds={x:this._pivotColumns.x,y:this._pivotRows.y,width:this._pivotColumns.getWidth(),height:a},this._pivotCells.viewPort={x:t.x,y:t.y,width:d,height:a},null!=this.draggingItem&&"visible"==this.dragElement.visibility&&this.dragElement.setValue(this.Canvas.ZIndexProperty,1e4),this._pivotRows._renderRequired=!1,this._pivotColumns._renderRequired=!1),this.PaintSuspended=!1))},SynchronizeScrollBars:function(){var t,e,i,s,n,o,r=!1,l=!1,h=this.host.find("#divVScroll"),a=this.host.find("#divHScroll"),d="none"!=a.css("display"),u="none"!=h.css("display"),c=a.height();this.scrollableAreaSize.height>this.getHeight()&&(r=!0),this.scrollableAreaSize.width>this.getWidth()&&(l=!0),this.scrollableAreaSize.height<=this.getHeight()&&this.scrollableAreaSize.width<=this.getWidth()&&(l=r=!1),r&&(l=l||this.scrollableAreaSize.width>this.getWidth()-c),l&&(r=r||this.scrollableAreaSize.height>this.getHeight()-c),r?(h[0].style.display="block",(t=this.getHeight()-(l?c+5:0))<0&&(t=0),this.setElementPosition(h[0],this.getWidth()-c-4,0),this.setElementSize(h[0],c,t),h.jqxScrollBar("min",0),(e=this.scrollableAreaSize.height-(this.getHeight()-(l?c:0))+4)!=h.jqxScrollBar("max")&&h.jqxScrollBar("max",e),null!=this.VerticalScrollBarSmallChange?h.jqxScrollBar("step",this.VerticalScrollBarSmallChange):h.jqxScrollBar("step",10),(i=this.scrollableAreaSize.height/10)<10&&(i=10),null!=this.VerticalScrollBarLargeChange&&(i=verticalScrollBarLargeChange),h.jqxScrollBar("largestep")!=i&&h.jqxScrollBar("largestep",i),h.jqxScrollBar("largestep")<h.jqxScrollBar("step")&&h.jqxScrollBar("largestep",h.jqxScrollBar("step")),this.rtl):(h.jqxScrollBar("value",0),h[0].style.display="none"),l?(a[0].style.display="block",((s=this.getWidth()-(r?c+5:0))<0||null==s)&&(s=0),this.setElementPosition(a[0],0,this.getHeight()-c-4),this.setElementSize(a[0],s,c),0!=a.jqxScrollBar("min")&&a.jqxScrollBar("min",0),n=this.scrollableAreaSize.width-(this.getWidth()-(r?c:0))+4,a.jqxScrollBar("max")!=n&&a.jqxScrollBar("max",n),null!=this.HorizontalScrollBarSmallChange?a.jqxScrollBar("step",this.HorizontalScrollBarSmallChange):a.jqxScrollBar("step",10),(o=this.getWidth()/2)<25&&(o=25),null!=this.HorizontalScrollBarLargeChange&&(o=this.HorizontalScrollBarSmallChange),a.jqxScrollBar("largestep",o),a.jqxScrollBar("largestep")<a.jqxScrollBar("largestep")&&a.jqxScrollBar("largestep",a.jqxScrollBar("step"))):(a.jqxScrollBar("value",0),a[0].style.display="none"),l=l&&this.scrollBarsEnabled,r=r&&this.scrollBarsEnabled,l!=("block"==a[0].display)&&(a[0].display=l?"block":"none"),r!=("block"==h[0].display)&&(h[0].display=r?"block":"none"),this._scrollBarPositions={vertical:{visible:r,rect:{x:h.position().left,y:h.position().top,width:h.width(),height:h.height()}},horizontal:{visible:l,rect:{x:a.position().left,y:a.position().top,width:a.width(),height:a.height()}}},a.jqxScrollBar("refresh"),h.jqxScrollBar("refresh")},isPtInRect:function(t,e){return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height},onMouseLeftButtonUp:function(t){var e=this;for(var i in e._scrollBarPositions)if(this._scrollBarPositions[i].visible&&this.isPtInRect(e._currentPosition,e._scrollBarPositions[i].rect))return e._isMouseCaptured()&&e._releaseMouseCapture(),void(e._isMouseLeftButtonDown=!1);if(e._isMouseCaptured())e._releaseMouseCapture();else if(!e._itemMenuButtonMouseOver&&!e._isContextMenuOpen){e.canDrag=!1;var s=u.jqx.position(t),n=e.isPtInRect({x:s.left,y:s.top},e._rect),o=e._pivotCells._hitTest(e._currentPosition);if(o&&n)if(e._raisePivotCellMouseEvent(o.pivotRow,o.pivotColumn,"pivotcellmouseup","left"))return;if("RESIZING"==e._colResizeState){e._colResizeState="NO_RESIZE",e._updateCursor("ARROW"),e._pivotColumns._renderRequired=!0,e._pivotRows._renderRequired=!0;var r=e.resizingItem.x+e.resizingItem.hierarchy.x-e._offsetX,l=e.resizingItem.y+e.resizingItem.hierarchy.y-e._offsetY;return this.isHorizontalResize?e.resizingItem.setWidth(Math.max(e.resizingItem.minimumWidth,Math.abs(e._currentPosition.x-r))):e.resizingItem.setHeight(Math.max(e.resizingItem.minimumHeight,Math.abs(e._currentPosition.y-l))),u("body").find("#"+e._resizeLineId).hide(),e.resizingItem=null,e.resizeTooltipEnabled,e._isMouseLeftButtonDown=!1,void e._internalRefresh()}var h={isOnItemButton:!1},a=e._itemHitTest(e._currentPosition,h);if(null==a||!h.isOnItemButton&&!h.isOnMenuButton){var d=!1;if(e._canDrop(a)?(e._endDrag(a),d=!0):e.dragElement&&"block"==e.dragElement.style.display&&(e._endDrag(draggingItem),d=!0),d)return e._isMouseLeftButtonDown=!1,void e._internalRefresh();e._isMouseLeftButtonDown=!1,n&&null==e.activeEditor.Editor&&e._updateSelection()}}},onMouseLeftButtonDown:function(t){for(var e in this._scrollBarPositions)if(this._scrollBarPositions[e].visible&&this.isPtInRect(this._currentPosition,this._scrollBarPositions[e].rect))return void this._captureMouse();var i={isOnItemButton:!1},s=this._itemHitTest(this._currentPosition,i);this._timeLastDown=new Date;if(this.isShiftPressed||(this._selectStartPosition={x:this._currentPosition.x,y:this._currentPosition.y}),!this._itemMenuButtonMouseOver&&!this._isContextMenuOpen){if(this._isMouseLeftButtonDown=!0,"READY_RESIZE"==this._colResizeState)return this._colResizeState="RESIZING",this._updateCursor(this.isHorizontalResize?"COLUMN_RESIZE":"ROW_RESIZE"),void this._refreshMouseCursor();if("RESIZING"!=this._colResizeState){if(null!=s){if(i.isOnItemButton){if(this._lastToggle&&this._lastToggle.item==s&&new Date-this._lastToggle.time<500)return;return this._isMouseLeftButtonDown=!1,s.isExpanded?s.collapse():s.expand(),this._lastToggle={time:new Date,item:s},void this._internalRefresh()}this.canDrag=!0,i.isOnItemButton?this._updateCursor("ARROW"):this._updateCursor("CROSS"),s.isColumn?this._internalSelectMode="COL_SELECT":this._internalSelectMode="ROW_SELECT"}else this._internalSelectMode="CELLS_SELECT";var n=this._pivotCells._hitTest(this._currentPosition);if(n)if(this._raisePivotCellMouseEvent(n.pivotRow,n.pivotColumn,"pivotcellmousedown","left"))return;null==this.activeEditor.Editor&&this._updateSelection(),this._refreshMouseCursor()}}},onMouseRightButtonDown:function(t){this._timeLastDown=new Date;var e,i=this._itemHitTest(this._currentPosition,{isOnItemButton:!1});null==i?(e=this._pivotCells._hitTest(this._currentPosition))&&this._raisePivotCellMouseEvent(e.pivotRow,e.pivotColumn,"pivotcellmousedown","right"):this._raisePivotItemMouseEvent(i,"pivotitemmousedown","right")},onMouseRightButtonUp:function(t){var e=u.jqx.position(t),i=this.isPtInRect({x:e.left,y:e.top},this._rect),s=this._pivotCells._hitTest(this._currentPosition);s&&i&&this._raisePivotCellMouseEvent(s.pivotRow,s.pivotColumn,"pivotcellmouseup","right"),this._timeLastUp=new Date},_itemMouseMove:function(t,e){if(this.resizingItem)this.isHorizontalResize?this._updateCursor("COLUMN_RESIZE"):this._updateCursor("ROW_RESIZE");else{this._menuElement._itemMouseOver!=e&&this._hideItemMenuElement(),this._updateCursor("CROSS");var i={x:e.x,y:e.y,width:e.getDisplayWidth(),height:e.getDisplayHeight()};if(e.isColumn?i.x+=e.hierarchy.x-this._offsetX:i.y+=e.hierarchy.y-this._offsetY,e.IsRowsHierarchyItem&&this._pivotRows.compactStyleRenderingEnabled&&(i.height=e.height),i.right=i.x+i.width,i.bottom=i.y+i.height,Math.abs(i.right-t.x)<=4&&t.y>=i.y&&t.y<=i.bottom){if(this.isHorizontalResize=!0,e.hierarchy.resizable&&!this._pivotColumns.isGroupingColumn(e)){if(this._updateCursor("COLUMN_RESIZE"),this.resizingItem=e.isColumn?e._getLastVisibleLeaf(e):e,!this.resizingItem.isColumn&&!this.resizingItem.isExpanded){var s=this._pivotRows._getVisibleLeafLevelItems();for(var n in s){var o=s[n];o.ItemLevel>this.resizingItem.ItemLevel&&(this.resizingItem=o)}}this._colResizeState="READY_RESIZE"}}else{if(!e.isColumn&&Math.abs(i.bottom-t.y)<=3)return this.isHorizontalResize=!1,e.IsRowsHierarchyItem&&this._pivotRows.compactStyleRenderingEnabled||(e=e._getLastVisibleLeaf(e)),void(e.hierarchy.resizable&&(this._updateCursor("ROW_RESIZE"),this.resizingItem=e,this._colResizeState="READY_RESIZE"));var r=e.hierarchy.getOtherHierarchy();e.hierarchy.sortable&&0<r.items.length&&this._hitTestShowItemMenuElement(t,e,i)}}},isInHierarchyViewPort:function(t,e){return e.isColumnsHierarchy?this.isPtInRect({x:t.x+this._offsetX,y:t.y},e.viewPort):this.isPtInRect({x:t.x,y:t.y+this._offsetY},e.viewPort)},_hitTestShowItemMenuElement:function(t,e,i){var s,n,o,r;this._menuElement&&this._menuElement._itemMouseOver&&this._menuElement._itemMouseOver._element&&u(this._menuElement._itemMouseOver._element).find("#sortElement").show(),this._menuElement.style.display="none",!(this._isContextMenuOpen||0<e.valueItems.length)&&t.x<i.right&&t.x>i.x&&t.y>=i.y&&t.y<=i.bottom&&((s=u.extend({},this._rect)).x=s.y=0,"block"==this.vScroll[0].display&&(s.width-=this.vScroll.width()),"block"==this.hScroll[0].display&&(s.height-=this.hScroll.height()),(n={x:this._currentPosition.x,y:this._currentPosition.y}).x-=e.hierarchy.x-(e.hierarchy.viewPort.x-e.hierarchy.x),n.y-=e.hierarchy.y-(e.hierarchy.viewPort.y-e.hierarchy.y),o={x:e.x+i.width-18,y:e.y+(i.height-16)/2+1,width:16,height:16},this._menuElement.style.height=o.height+"px",this._menuElement.className=this.toThemeProperty("jqx-pivotgrid-menu-button"),e.isColumn?o.x+=e.hierarchy.x-this._offsetX:o.y+=e.hierarchy.y-this._offsetY,this.setElementPosition(this._menuElement,o.x,o.y),this.isPtInRect({x:o.x,y:o.y},s)&&this.isPtInRect({x:o.x,y:o.y+o.height},s)&&this.isPtInRect({x:o.x+o.width,y:o.y},s)&&this.isPtInRect({x:o.x+o.width,y:o.y+o.height},s)&&(this._menuElement.style.display="block",this._menuElement._itemMouseOver=e,u(this._menuElement._itemMouseOver._element).find("#sortElement").hide(),e._currentCustomContent||(r=u(e._element).css("background-color"),this._menuElement.style["background-color"]=r),e.isColumn?o.x+=this._offsetX-e.hierarchy.x:o.y+=this._offsetY-e.hierarchy.y,this.isPtInRect({x:n.x,y:n.y},o)&&(this._itemMenuButtonMouseOver=!0)))},_hideItemMenuElement:function(){this._menuElement&&!this._isContextMenuOpen&&"block"==this._menuElement.style.display&&(this._menuElement.style.display="none",u(this._menuElement._itemMouseOver._element).find("#sortElement").show())},_hideItemContextMenu:function(){this._contextMenu.jqxMenu("close"),this._hideItemMenuElement()},_showItemContextMenu:function(){var t,e,i,s,n=this._menuElement._itemMouseOver;n&&(t=this._contextMenu.width(),e=this._contextMenu.height(),this._contextMenu.find("#sortasc")[0].className="jqx-pivotgrid-sortasc-icon "+this.toThemeProperty("jqx-pivotgrid-sortasc-icon"),this._contextMenu.find("#sortdesc")[0].className="jqx-pivotgrid-sortdesc-icon "+this.toThemeProperty("jqx-pivotgrid-sortdesc-icon"),this._contextMenu.find("#sortremove")[0].className="jqx-pivotgrid-sortremove-icon "+this.toThemeProperty("jqx-pivotgrid-sortremove-icon"),i=-t+n.displayWidth+n.x+(n.hierarchy.viewPort.x-this._offsetX)-this._offsetX,n.isColumn||(i=n.x+n.displayWidth),s=n.y+n.getDisplayHeight(),n.isColumn||(s=n.y-this._offsetY+n.hierarchy.y),i<=1&&(i=1),s<this._pivotColumns.y+this._pivotColumns.getHeight()&&(s=this._pivotColumns.y+this._pivotColumns.getHeight()),s+e>this._rect.height&&(s=this._rect.height-e),this._contextMenu.jqxMenu("open",i+this._rect.x,s+this._rect.y),this._contextMenu.focus())},_handleMouseMove:function(t){if("RESIZING"==this._colResizeState)return this._doResize({x:this._currentPosition.x,y:this._currentPosition.y}),void this._refreshMouseCursor();this._colResizeState="NO_RESIZE",this.resizingItem=null;var e=this._currentPosition,i=null;this.isInHierarchyViewPort({x:e.x,y:e.y},this._pivotColumns)&&(i=this._pivotColumns.hitTest(e));var s=null;if(this.isInHierarchyViewPort({x:e.x,y:e.y},this._pivotRows)&&(s=this._pivotRows.hitTest(e)),this._itemMenuButtonMouseOver=!1,null!=i||null!=s){var n=null==i?s:i;this.gridCellMouseOver=null,this._itemMouseMove(e,n),this._focusedItem!=n&&(this._focusedItem=n,this._isMouseLeftButtonDown&&this._updateSelection());var o={};return this.CellsHighlightOnHierarchyItemMoveEnabled&&(n.IsRowsHierarchyItem&&"CELLS_HIGHLIGHT_ROW"==this.CellsHighlightMode||n.isColumn&&"CELLS_HIGHLIGHT_COLUMN"==this.CellsHighlightMode)&&(o=n.isColumn?{x:n.x,y:0,width:n.DisplayWidth,height:this._pivotRows.getHeight()}:{x:0,y:n.y,width:this._pivotColumns.getWidth(),height:n.getDisplayHeight()},(n.isColumn&&this.isGroupingEnabled&&0<this.groupingColumns.length||n.IsRowsHierarchyItem&&this._pivotRows.isOnRowDetails(this._currentPosition,n))&&(o={x:0,y:0,width:0,height:0})),void this._refreshMouseCursor()}this._hideItemMenuElement();this.gridCellMouseOver;this.resizingItem=null,this._focusedItem=null,this._colResizeState="NO_RESIZE",this._updateCursor("ARROW");var r=null;this.gridCellMouseOver&&((r={}).pivotColumn=this.gridCellMouseOver.pivotColumn,r.pivotRow=this.gridCellMouseOver.pivotRow);var l=this._pivotCells._hitTest(e);this._isMouseLeftButtonDown&&l?(null!=this.gridCellMouseOver&&this.gridCellMouseOver.pivotRow==s&&this.gridCellMouseOver.pivotColumn==i||(this.gridCellMouseOver={pivotRow:l.pivotRow,pivotColumn:l.pivotColumn,pivotCells:this._pivotCells}),o={x:0,y:0,width:0,height:0},"CELLS_HIGHLIGHT_COLUMN"==this.cellsHighlightMode?o={x:this.gridCellMouseOver.pivotColumn.x,y:0,width:this.gridCellMouseOver.pivotColumn.getDisplayWidth(),height:this._pivotRows.getHeight()}:"CELLS_HIGHLIGHT_ROW"==this.cellsHighlightMode?o={x:0,y:this.gridCellMouseOver.pivotRow.y,width:this._pivotColumns.getWidth(),height:this.gridCellMouseOver.pivotRow.getDisplayHeight()}:"CELLS_HIGHLIGHT_SINGLE_CELL"==this.cellsHighlightMode&&(o={x:this.gridCellMouseOver.pivotColumn.x,y:this.gridCellMouseOver.pivotRow.y,width:this._pivotColumns.getWidth(),height:this.gridCellMouseOver.pivotRow.getDisplayHeight()},this.isGroupingEnabled&&0<this.groupingColumns.length&&0<this.gridCellMouseOver.pivotRow.items.length&&(o={x:0,y:0,width:0,height:0}),this.gridCellMouseOver.pivotRow.RowDetailsVisible&&(o.height-=this.gridCellMouseOver.pivotRow.GetRowDetailsHeight())),(this._pivotColumns.isGroupingColumn(this.gridCellMouseOver.pivotColumn)||this._pivotRows.isOnRowDetails(this._currentPosition,this.gridCellMouseOver.pivotRow))&&(o={x:0,y:0,width:0,height:0})):this.gridCellMouseOver=null,null==this.gridCellMouseOver||this.gridCellMouseOver==r&&r.pivotRow==this.gridCellMouseOver.pivotRow&&r.pivotColumn==this.gridCellMouseOver.pivotColumn||this._isMouseLeftButtonDown&&!this._itemMenuButtonMouseOver&&(this._updateSelection(),this._internalRefresh())},_handleMouseClick:function(t){var e,i={isOnItemButton:!1},s=this._itemHitTest(this._currentPosition,i);if(null!=s){if(this._raisePivotItemMouseEvent(s,"pivotitemclick",0==t.button?"left":"right"))return void(t.cancel=!0);if(this._itemMenuButtonMouseOver||this._isContextMenuOpen)return;this._isMouseLeftButtonDown&&!i.isOnItemButton&&"Automatic"==s.sortMode&&0==s.valueItems.length&&(e=this.cursor,this.cursor="Wait",this.cursor=e)}else{var n=this._pivotCells._hitTest(this._currentPosition);if(n)if(this._raisePivotCellMouseEvent(n.pivotRow,n.pivotColumn,"pivotcellclick",0==t.button?"left":"right"))return void(t.cancel=!0)}},_handleMouseDoubleClick:function(t){if(null!=this.activeEditor.Editor){if(0==this.hideEditor("MOUSE_DBLCLICK",null,!0))return}if(!this._itemMenuButtonMouseOver&&!this._isContextMenuOpen){var e={isOnItemButton:!1},i=this._itemHitTest(this._currentPosition,e);if(null!=i){if(e.isOnMenuButton)return;if(this._raisePivotItemMouseEvent(i,"pivotitemdblclick",0==t.button?"left":"right"))return;if(this._lastToggle&&this._lastToggle.item==i&&new Date-this._lastToggle.time<500)return;0==t.button&&(i.isExpanded?i.collapse():i.expand(),i.hierarchy.selectItem(i),this._internalRefresh()),this._lastToggle={time:new Date,item:i}}else{var s=this._pivotCells._hitTest(this._currentPosition);if(s)if(this._raisePivotCellMouseEvent(s.pivotRow,s.pivotColumn,"pivotcelldblclick",0==t.button?"left":"right"))return}this._refreshMouseCursor()}},_isMouseCaptured:function(){return!0===this._captured},_releaseMouseCapture:function(){this._captured=!1},_captureMouse:function(){this._captured=!0},_updateCursor:function(t){"ARROW"==t?this.element.style.cursor="default":"CROSS"==t?this.element.style.cursor="pointer":"COLUMN_RESIZE"==t?this.element.style.cursor="col-resize":"ROW_RESIZE"==t&&(this.element.style.cursor="row-resize")},_refreshMouseCursor:function(){},_ensureEditorFocus:function(){},focus:function(){},_itemHitTest:function(t,e){e.isOnItemButton=!1;var i,s,n,o,r=null;return!this._pivotRows.isHidden&&this.isInHierarchyViewPort(t,this._pivotRows)&&(r=this._pivotRows.hitTest(t)),null==r&&!this._pivotColumns.isHidden&&this.isInHierarchyViewPort(t,this._pivotColumns)&&(r=this._pivotColumns.hitTest(t)),null!=r&&((i={x:this._currentPosition.x,y:this._currentPosition.y}).x-=r.hierarchy.x-(r.hierarchy.viewPort.x-r.hierarchy.x),i.y-=r.hierarchy.y-(r.hierarchy.viewPort.y-r.hierarchy.y),0!=r.items.length&&0!=r.expandCollapseEnabled&&r.hierarchy.showExpandCollapseButtons&&(s=0,!r.hierarchy.isColumnsHierarchy&&r.hierarchy.compactStyleRenderingEnabled&&(s=24*r.itemLevel),i.x>r.x+9+s&&i.x<r.x+20+s&&i.y>r.y+9&&i.y<r.y+20&&(e.isOnItemButton=!0)),n={x:r.x,y:r.y,width:r.getDisplayWidth(),height:r.getDisplayHeight()},o={x:r.x+n.width-16,y:r.y,width:16,height:n.height},this.isPtInRect(i,o)&&r.hierarchy.sortable&&(e.isOnMenuButton=!0)),r},_raisePivotCellMouseEvent:function(t,e,i,s){var n=new u.Event(i);return n.owner=this,n.args={pivotRow:t,pivotColumn:e,mousebutton:s,cancel:!1},this.host.trigger(n),!!n.args.cancel},_raisePivotItemMouseEvent:function(t,e,i){var s=new u.Event(e);return s.owner=this,s.args={pivotItem:t,mousebutton:i,cancel:!1},this.host.trigger(s),!!s.args.cancel},_beginDrag:function(t){},_endDrag:function(t){},_canDrop:function(t){},_doResize:function(t){if(null!=this.resizingItem&&this.resizingItem.hierarchy.resizable&&!this._pivotColumns.isGroupingColumn(this.resizingItem)){this.isHorizontalResize?this._updateCursor("COLUMN_RESIZE"):this._updateCursor("ROW_RESIZE"),this._focusedItem=this.resizingItem;var e=this.resizingItem.x+2*this.resizingItem.hierarchy.x-this.resizingItem.hierarchy.viewPort.x,i=this.resizingItem.y+2*this.resizingItem.hierarchy.y-this.resizingItem.hierarchy.viewPort.y,s=!1,n=(this.resizingItem.hierarchy,u("body").find("#"+this._resizeLineId));if(this.isHorizontalResize){var o=t.x-e;if(o<this.resizingItem.minimumWidth)return;var r={x:t.x+this._rect.x,y:this._pivotRows.y+this._rect.y};n.css({"border-right":"1px dotted #555","border-bottom":"",width:"1px",height:this._pivotCells.viewPort.height,top:r.y,left:r.x,display:"block"}),o>=this.resizingItem.minimumWidth&&o<=this.resizingItem.maximumWidth&&(this.resizeTooltipEnabled&&(this._resizeTooltip.Content="width: "+o+" pixels"),s=!0)}else{var l=t.y-i;if(l<this.resizingItem.minimumHeight)return;r={x:this._pivotColumns.x+this._rect.x,y:t.y+this._rect.y};n.css({"border-bottom":"1px dotted #555","border-right":"",height:"1px",width:this._pivotCells.viewPort.width,left:r.x,top:r.y,display:"block",zIndex:5e4}),l>=this.resizingItem.minimumHeight&&l<=this.resizingItem.maximumHeight&&(this.resizeTooltipEnabled&&(this._resizeTooltip.Content="height: "+l+" pixels"),s=!0)}s&&this.resizeTooltipEnabled&&("visible"!=this._resizeTooltip.visibility&&(this._resizeTooltip.visibility="visible"),this._resizeTooltip.setValue(this.Canvas.LeftProperty,t.x),this._resizeTooltip.setValue(this.Canvas.TopProperty,t.y),this._resizeTooltip.setValue(this.Canvas.ZIndexProperty,10002))}},_internalClearSelection:function(){this._pivotColumns._internalClearSelection(),this._pivotRows._internalClearSelection(),this._pivotCells._internalClearSelection()},_beginSelectionUpdate:function(){this._isCTRLPressed&&this.multipleSelectionEnabled||(this._pivotCells._beginSelectionUpdate(),this._pivotColumns._beginSelectionUpdate(),this._pivotRows._beginSelectionUpdate())},_endSelectionUpdate:function(){this._pivotColumns._endSelectionUpdate(),this._pivotRows._endSelectionUpdate(),this._pivotCells._endSelectionUpdate()},_updateSelection:function(){if(this.selectionEnabled){this._colItemRangeSelectionBeg=null,this._rowItemRangeSelectionBeg=null,this._beginSelectionUpdate();var t=!1;if(this._isCTRLPressed&&0!=this.multipleSelectionEnabled||(this._internalClearSelection(),t=!0),null!=this.activeEditor.Editor)return this._internalClearSelection(),void this._endSelectionUpdate();var e=-1,i=-1,s={x:this._selectStartPosition.x,y:this._selectStartPosition.y};s.y-=this._offsetY,s.x-=this._offsetX;var n=this._itemHitTest(this._selectStartPosition,{isOnItemButton:!1});if(null!=n)if(!n.isColumn&&this._pivotRows.compactStyleRenderingEnabled||(n=n._getFirstVisibleLeaf(n)),n.isColumn){if("FULL_ROW_SELECT"==this.selectionMode)return this._internalSelectMode="NO_SELECT",void this._endSelectionUpdate();this._internalSelectMode="COL_SELECT",this._colItemRangeSelectionBeg=n}else{if("FULL_COLUMN_SELECT"==this.selectionMode)return this._internalSelectMode="NO_SELECT",this._endSelectionUpdate(),void this._internalRefresh();this._internalSelectMode="ROW_SELECT",this._rowItemRangeSelectionBeg=n}else{if(!(h=this._pivotCells._hitTest(this._selectStartPosition)))return this._internalSelectMode="NO_SELECT",this._endSelectionUpdate(),void this._internalRefresh();this._internalSelectMode="CELLS_SELECT","FULL_ROW_SELECT"==this.selectionMode?this._internalSelectMode="ROW_SELECT":"FULL_COLUMN_SELECT"==this._SelectionMode&&(this._internalSelectMode="COL_SELECT")}var o={x:this._currentPosition.x,y:this._currentPosition.y};"COL_SELECT"==this._internalSelectMode?(o.y>=this._pivotColumns.y+this._pivotColumns.getHeight()&&(o.y=this._pivotColumns.y+this._pivotColumns.getHeight()-1),o.y<=this._pivotColumns.y&&(o.y=this._selectStartPosition.y),o.x<=this._pivotColumns.x&&(o.x=this._pivotColumns.x+1),o.x>=this._pivotColumns.x+this._pivotColumns.getWidth()&&(o.x=this._pivotColumns.x+this._pivotColumns.getWidth()-1)):"ROW_SELECT"==this._internalSelectMode?(o.y>=this._pivotRows.y+this._pivotRows.getHeight()&&(o.y=this._pivotRows.y+this._pivotRows.getHeight()-1),o.y<=this._pivotRows.y&&(o.y=this._pivotRows.y+1),o.x<=this._pivotRows.x&&(o.x=this._pivotRows.x+this._pivotRows.getWidth()-1),o.x>=this._pivotRows.x+this._pivotRows.getWidth()&&(o.x=this._pivotRows.x+this._pivotRows.getWidth()-1)):"CELLS_SELECT"==this._internalSelectMode&&(o.x<this._pivotColumns.x&&(o.x=this._pivotColumns.x+1),o.y<this._pivotRows.y&&(o.y=this._pivotRows.y+1)),this._colItemRangeSelectionEnd=null,this._rowItemRangeSelectionEnd=null;var r=-1,l=-1;if("COL_SELECT"==this._internalSelectMode||"ROW_SELECT"==this._internalSelectMode)if(null!=n){var h={},a=this._itemHitTest(o,h);if(null==a)return void this._endSelectionUpdate();!a.isColumn&&this._pivotRows.compactStyleRenderingEnabled||(a=a._getLastVisibleLeaf(a)),a.isColumn?this._colItemRangeSelectionEnd=a:this._rowItemRangeSelectionEnd=a}else this._pivotCells.hitTest(o,h),null!=h?(this._colItemRangeSelectionEnd=h.pivotColumn,this._rowItemRangeSelectionEnd=h.pivotRow):(this._colItemRangeSelectionEnd=null,this._rowItemRangeSelectionEnd=null);if("CELLS_SELECT"==this._internalSelectMode){h=this._pivotCells._hitTest(this._selectStartPosition);if(this._colItemRangeSelectionBeg=h.pivotColumn,this._rowItemRangeSelectionBeg=h.pivotRow,!h)return this._endSelectionUpdate(),void this._internalRefresh();if(s.x==o.x&&s.y==o.y||(this._pivotCells.hitTest(o,h),this._colItemRangeSelectionEnd=h.pivotColumn,this._rowItemRangeSelectionEnd=h.pivotRow),!h.pivotRow||!h.pivotColumn)return this._internalSelectMode="CELLS_SELECT",this._pivotCells._internalSelectCell(this._rowItemRangeSelectionBeg,this._colItemRangeSelectionBeg),this._cellKBRangeSelectionStart=this._cellKBRangeSelectionEnd={pivotRow:this._rowItemRangeSelectionBeg,pivotColumn:this._colItemRangeSelectionBeg,pivotCells:this._pivotCells},this._endSelectionUpdate(),void this._internalRefresh()}if(this._saveSelectedItemsRangeOrder(),this._adjustSelectedItemsOrder(t),"CELLS_SELECT"==this._internalSelectMode){var d,u=this._pivotRows._getVisibleLeafLevelItems(),c=this._pivotColumns._getVisibleLeafLevelItems(),i=this._pivotRows._pointToLeafItemIndexAbsolute(this._selectStartPosition),l=this._pivotRows._pointToLeafItemIndexAbsolute(o),e=this._pivotColumns._pointToLeafItemIndexAbsolute(this._selectStartPosition),r=this._pivotColumns._pointToLeafItemIndexAbsolute(o);if(-1==e&&-1==r||-1==i&&-1==l)return this._endSelectionUpdate(),void this._internalRefresh();-1==e&&(e=r),-1==r&&(r=e),-1==i&&(i=l),-1==l&&(l=i),r<e&&(d=e,e=r,r=d),l<i&&(d=i,i=l,l=d);for(var v=i;v<=l&&v<u.length;v++)for(var m=u[v],p=e;p<=r&&p<c.length;p++){var _=c[p];this._pivotCells._internalSelectCell(m,_)}return this._cellKBRangeSelectionStart={pivotRow:this._rowItemRangeSelectionBeg,pivotColumn:this._colItemRangeSelectionBeg,pivotCells:this._pivotCells},this._cellKBRangeSelectionEnd={pivotRow:this._rowItemRangeSelectionEnd,pivotColumn:this._colItemRangeSelectionEnd,pivotCells:this._pivotCells},this._endSelectionUpdate(),void this._internalRefresh()}this._restoreSelectedItemsRangeOrder(),this._applyItemsMultiSelect(t),this._endSelectionUpdate(),this._internalRefresh()}},_saveSelectedItemsRangeOrder:function(){this._adjSelectedItemsSave.colBeg=this._colItemRangeSelectionBeg,this._adjSelectedItemsSave.colEnd=this._colItemRangeSelectionEnd,this._adjSelectedItemsSave.rowBeg=this._rowItemRangeSelectionBeg,this._adjSelectedItemsSave.rowEnd=this._rowItemRangeSelectionEnd},_restoreSelectedItemsRangeOrder:function(){this._colItemRangeSelectionBeg=this._adjSelectedItemsSave.colBeg,this._colItemRangeSelectionEnd=this._adjSelectedItemsSave.colEnd,this._rowItemRangeSelectionBeg=this._adjSelectedItemsSave.rowBeg,this._rowItemRangeSelectionEnd=this._adjSelectedItemsSave.rowEnd},_adjustSelectedItemsOrder:function(t){var e;null!=this._colItemRangeSelectionBeg&&null!=this._colItemRangeSelectionEnd&&this._colItemRangeSelectionBeg.x>this._colItemRangeSelectionEnd.x&&(e=this._colItemRangeSelectionBeg,this._colItemRangeSelectionBeg=this._colItemRangeSelectionEnd,this._colItemRangeSelectionEnd=e),null!=this._rowItemRangeSelectionBeg&&null!=this._rowItemRangeSelectionEnd&&this._rowItemRangeSelectionBeg.y>this._rowItemRangeSelectionEnd.y&&(e=this._rowItemRangeSelectionBeg,this._rowItemRangeSelectionBeg=this._rowItemRangeSelectionEnd,this._rowItemRangeSelectionEnd=e),(0!=this.multipleSelectionEnabled||t)&&null!=this._rowItemRangeSelectionEnd||(this._rowItemRangeSelectionEnd=this._rowItemRangeSelectionBeg),(0!=this.multipleSelectionEnabled||t)&&null!=this._colItemRangeSelectionEnd||(this._colItemRangeSelectionEnd=this._colItemRangeSelectionBeg)},_applyItemsMultiSelect:function(t){this._saveSelectedItemsRangeOrder(),this._adjustSelectedItemsOrder(t);for(var e=0;e<2;e++)if(!("COL_SELECT"==this._internalSelectMode&&0!=e||"ROW_SELECT"==this._internalSelectMode&&1!=e)){var i=0==e?this._colItemRangeSelectionBeg:this._rowItemRangeSelectionBeg,s=0==e?this._colItemRangeSelectionEnd:this._rowItemRangeSelectionEnd,n=0==e?this._pivotColumns:this._pivotRows,o=n._getVisibleLeafLevelItems();if(null==o)return this._internalRefresh(),void this._restoreSelectedItemsRangeOrder();var r=!1;for(var l in o){var h=o[l];if((h==i||r)&&(h.getWidthWithChildren()+h.x>this._mostRightItemBounds.x+this._mostRightItemBounds.width&&(this._mostRightItemBounds={x:h.x,y:h.y,width:h.getWidthWithChildren(),height:h.getHeightWithChildren()}),h.getWidthWithChildren()+h.x<this._mostLeftItemBounds.x+this._mostLeftItemBounds.width&&(this._mostLeftItemBounds={x:h.x,y:h.y,width:h.getWidthWithChildren(),height:h.getHeightWithChildren()}),r=!0,n._internalSelectItem(h),h==s))break}!n.isColumnsHierarchy&&n.compactStyleRenderingEnabled||n._applySelectionToParentItems()}this._restoreSelectedItemsRangeOrder()},localizeStrings:function(t,e){var i=this;u.jqx.dataFormat&&u.jqx.dataFormat.cleardatescache(),i._localizedStrings={decimalseparator:".",thousandsseparator:",",sortascendingstring:"Sort Ascending",sortdescendingstring:"Sort Descending",sortremovestring:"Remove Sort",alignment:"Text alignment",cellalignment:"Number alignment",numberformat:"Number format",prefix:"Number prefix",decimalplacestext:"Decimal places",thousandsseparatortext:"Thousands separator",decimalseparatortext:"Decimal separator",nagativebracketstext:"Negatives in brackets",fieldsettings:"Field settings",ok:"Ok",cancel:"Cancel"};var s=u.extend({},t);for(var n in i._localizedStrings=u.extend(i._localizedStrings,s),s)n&&n.toLowerCase()!==n&&(s[n.toLowerCase()]=s[n]);for(var o in i._localizedStrings)void 0!==s[o]&&(i._localizedStrings[o]=s[o])}})}(jqxBaseFramework),$.jqx.jqxPivotGrid=$.jqx.jqxPivotGrid||{},$.jqx.define($.jqx.jqxPivotGrid,"propertyBag",""),$.extend($.jqx.jqxPivotGrid.propertyBag.prototype,{defineInstance:function(){this.namedPropertyTables={},this._tableSizes={},this.enablePropertyChangeNotifications=!1},getPropertyTable:function(t){return null==this.namedPropertyTables[t]&&(this.namedPropertyTables[t]={},this._tableSizes[t]=0),this.namedPropertyTables[t]},getPropertyCount:function(t){return null==this.getPropertyTable(t)?0:this._tableSizes[t]},getPropertyValue:function(t,e){var i=this.getPropertyTable(t);return null!=i&&null!=i[e]?i[e]:null},containsPropertyValue:function(t,e){var i=this.getPropertyTable(t);return null!=i&&null!=i[e]},removePropertyValue:function(t,e){var i=this.getPropertyTable(t);null!=i&&(delete i[e],this._tableSizes[t]--)},setPropertyValue:function(t,e,i){var s=this.getPropertyTable(t);null!=s&&(null==i||null==i?s[e]&&(this._tableSizes[t]--,delete s[e]):(s[e]||this._tableSizes[t]++,s[e]=i),this.enablePropertyChangeNotifications&&this.onPropertyChanged(t))},clear:function(t){""!=t&&null!=t&&null!=t?(this.getPropertyTable(t),this._tableSizes[t]=0):this.namedPropertyTables={}},onPropertyChanged:function(t){$.event.trigger("propertychanged",t)}}),function(b){b.jqx.jqxPivotGrid=b.jqx.jqxPivotGrid||{},b.jqx.define(b.jqx.jqxPivotGrid,"pivotCells",""),b.extend(b.jqx.jqxPivotGrid.pivotCells.prototype,{defineInstance:function(){this.parentPivotGrid=null,this.IsDataBoundPivotCellsEditable=!1,this.cellProperties=new b.jqx.jqxPivotGrid.propertyBag,this.hashCellAutoSize={},this.hashCellInSpan={},this.hashCellSpan={},this._selectedCells=new Object},hitTest:function(t){var e=this._hitTest(t);if(e)return{pivotRow:e.pivotRow,pivotColumn:e.pivotColumn,pivotCells:this}},_hitTest:function(t){var e={};if(e.pivotColumn=this.parentPivotGrid._pivotColumns._pointToLeafItemAbsolute(t),e.pivotRow=this.parentPivotGrid._pivotRows._pointToLeafItemAbsolute(t),!this.parentPivotGrid._pivotColumns.isGroupingColumn(e.pivotColumn)&&null!=e.pivotColumn&&null!=e.pivotRow)return e},clear:function(){this._reset()},_reset:function(){this.cellProperties.clear(),this._selectedCells=new Object,this.hashCellAutoSize={},this.hashCellInSpan={},this.hashCellSpan={},this._clearElementsAndCellsCache()},_resetCanvas:function(){var t=b.jqx.get(this,"renderCanvas");if(t)for(;t.hasChildNodes();)t.removeChild(t.firstChild)},_clearElementsAndCellsCache:function(){this._clearCellsCache()},setCellValue:function(t,e,i){if(null!=t&&null!=e){var s=this.parentPivotGrid.getCellId(e,t),n=(this.getCellDataSource(t,e),-1!=t.BoundFieldIndex&&-1!=e.BoundFieldIndex),o=this.getCellDataSource(t,e);if("DataBound"==o&&n){if(this.parentPivotGrid.OnCellValueChanging(t,e,i))return;try{this.parentPivotGrid.setCellValueFromDataSourceNonPivot(t,e,i)}catch(t){return}return this.cellProperties.setPropertyValue("CellValue",s,null),void this.parentPivotGrid.OnCellValueChanged(t,e)}if("DataBoundPivot"==o){if(this.IsDataBoundPivotCellsEditable)return;throw"The cell's value is derived from the data source and aggregated. It is not editable in this mode. Use the SetCellDataSource method to change the cell's data source first"}this.parentPivotGrid.OnCellValueChanging(t,e,i)||(this.SetCellDataSource(t,e,"Static"),this.cellProperties.setPropertyValue("CellValue",s,i),this.onPropertyChanged("CellValue"),this.parentPivotGrid.OnCellValueChanged(t,e))}},_clearCellsCache:function(){this.cellProperties.clear("CellValue")},_clearCachedCell:function(t,e){var i=this.parentPivotGrid.getCellId(e,t);this.cellProperties.containsPropertyValue("CellValue",i)&&this.cellProperties.removePropertyValue("CellValue",i)},drillThroughCell:function(t,e){if(!t||t.isColumn)throw"Invalid pivotRow parameter";if(!e||!e.isColumn)throw"Invalid pivotColumn parameter";return this.parentPivotGrid.source.drillThroughPivotCell(t.adapterItem,e.adapterItem)},getCellValue:function(t,e){var i=null;if(this.parentPivotGrid._pivotColumns.isGroupingColumn(e))return null;var s=this.parentPivotGrid.getCellId(e,t),n=this.getCellDataSource(t,e);switch((t.isTotal||e.isTotal)&&(n="Virtual"),n){case"Virtual":i=this.parentPivotGrid.onCellValueNeeded(t,e),this.cellProperties.setDirty(s),null==i&&"BoundPivot"==this.parentPivotGrid.bindingState&&(t.isTotal||e.isTotal)&&(i=this.parentPivotGrid.getCellValueFromDataSource(t,e));break;case"DataBoundPivot":null==(i=this.cellProperties.getPropertyValue("CellValue",s))&&(i=this.parentPivotGrid.source.getCellValue(t.adapterItem,e.adapterItem),this.cellProperties.getPropertyCount("CellValue")<4e6&&this.cellProperties.setPropertyValue("CellValue",s,i));break;case"DataBound":if(null==(i=this.cellProperties.getPropertyValue("CellValue",s))){try{i=this.parentPivotGrid.getCellValueFromDataSourceNonPivot(t,e)}catch(t){return null}this.cellProperties.getPropertyCount("CellValue")<4e6&&this.cellProperties.setPropertyValue("CellValue",s,i)}break;case"NotSet":case"Static":default:i=this.cellProperties.getPropertyValue("CellValue",s)}return i},setCellDataSource:function(t,e,i){var s;null!=t&&null!=e&&(s=this.parentPivotGrid.getCellId(e,t),this.cellProperties.setPropertyValue("cellDataSource",s,i))},getCellDataSource:function(t,e){var i=this.parentPivotGrid.getCellId(e,t),s=this.cellProperties.getPropertyValue("cellDataSource",i);return null==s&&(s=e.cellDataSource),null!=s&&"NotSet"!=s||(s=t.cellDataSource),null!=s&&"NotSet"!=s?s:this.parentPivotGrid.UseVirtualCellsByDefault?"Virtual":"DataBound"==this.parentPivotGrid.bindingState||"DataBoundPivot"==this.parentPivotGrid.bindingState?this.parentPivotGrid.bindingState:"NotSet"},render:function(){var t=this.renderCanvas;if(t){var e=this.parentPivotGrid;e.setElementPosition(t,-this.parentPivotGrid._offsetX,-this.parentPivotGrid._offsetY);var i=e._pivotRows,s=e._pivotColumns;if(this._refreshRequired||i._isVirtualMode||s._isVirtualMode){var n=i._getLeafItemsToRender(),o=s._getLeafItemsToRender();this._cellElements=this._cellElements||{};for(var r=new Array,l=new Date,h={first:i._isVirtualMode?n.first:0,last:i._isVirtualMode?n.last:n.items.length-1},a={first:s._isVirtualMode?o.first:0,last:s._isVirtualMode?o.last:o.items.length-1},d=h.last;h.first<=d;d--)for(var u,c,v,m,p,_,g,C,f,y,x,I,S,R,w=a.last;a.first<=w;w--){-1!=d&&-1!=w&&(u=n.items[d],c=o.items[w],v=e.getCellId(c,u),m=c.getDisplayWidth()-1,p=u.getDisplayHeight()-1,_=this.isCellSelected(u,c),P=void 0,(g=this._cellElements[v])&&g.isSelected==_&&(P=g.element),C={left:4,top:4,right:4,bottom:4},f=this.getCellValue(u,c),y="",P?P.style.width==m+"px"&&P.style.height==p+"px"||this.parentPivotGrid.setElementSize(P,m,p):((P=e.createDiv(t,y,m,p)).cellId=v,this._cellElements[v]={element:P,isSelected:_},e.setElementSize(P,m,p),x="right",e.cellsRenderer&&b.isFunction(e.cellsRenderer)?(y=e.cellsRenderer({value:f.value,formattedValue:f.formattedValue,isSelected:_,pivotRow:u,pivotColumn:c}),C={left:0,top:0,right:0,bottom:0}):(y=void 0!==f&&void 0!==f.formattedValue?f.formattedValue.toString():"",(I=this.parentPivotGrid.source.getCellFormatSettings(u.adapterItem,c.adapterItem))&&(x=I.align||"right")),this.parentPivotGrid.setDivContent(P,y,C,x),P.originalY=P.style.top,P.className=this.parentPivotGrid.toThemeProperty("jqx-grid-cell-normal")),P.tRender=l,"block"!=P.style.display&&(P.style.display="block"),P.style.left==c.x+"px"&&P.style.top==u.y+"px"||this.parentPivotGrid.setElementPosition(P,c.x,u.y),S="cellsClassName",this.isCellSelected(u,c)?(P.className=this.parentPivotGrid.toThemeProperty("jqx-grid-cell-selected jqx-fill-state-hover jqx-widget-content"),S="cellsClassNameSelected"):P.className=this.parentPivotGrid.toThemeProperty("jqx-grid-cell-normal jqx-widget-content"),(R=b.jqx.getByPriority([u[S],u.adapterItem&&u.adapterItem.boundField?u.adapterItem.boundField[S]:void 0,c[S],c.adapterItem&&c.adapterItem.boundField?c.adapterItem.boundField[S]:void 0]))&&(P.className+=" "+R),P.className+=" jqx-pivotgrid-content-wrapper")}for(var P,E=0;E<t.childNodes.length;E++)t.childNodes[E].cellId&&t.childNodes[E].tRender!=l&&r.push(t.childNodes[E]);for(;;){if(!(P=r.pop()))break;delete this._cellElements[P.cellId],P.style.display="none",t.removeChild(P)}this._refreshRequired=!1}}},_beginSelectionUpdate:function(){for(var t in this._selectedCells)this._selectedCells[t].OldIsSelected=this._selectedCells[t].isSelected},_endSelectionUpdate:function(){var t=new Array;for(var e in this._selectedCells){var i=this._selectedCells[e];i.isSelected||t.push(e),i.isSelected,i.OldIsSelected}if(0<t.length)for(var e in t)delete this._selectedCells[t[e]]},_internalClearSelection:function(){for(var t in this._selectedCells)this._internalUnselectCell(this._selectedCells[t].pivotRow,this._selectedCells[t].pivotColumn)},clearSelection:function(){this._beginSelectionUpdate(),this._internalClearSelection(),this._endSelectionUpdate(),this.render()},selectCell:function(t,e){this.parentPivotGrid.selectionEnabled&&(this._beginSelectionUpdate(),this._internalSelectCell(t,e),this.parentPivotGrid._cellKBRangeSelectionStart={pivotRow:t,pivotColumn:e,pivotCells:this},this.parentPivotGrid._cellKBRangeSelectionEnd={pivotRow:t,pivotColumn:e,pivotCells:this},this._endSelectionUpdate())},_internalSelectCell:function(t,e){if(null==e||!this.parentPivotGrid._pivotColumns.isGroupingColumn(e)){if("NO_SELECT"==this.parentPivotGrid._internalSelectMode)switch(this.parentPivotGrid.selectionMode){case"CELL_SELECT":this.parentPivotGrid._internalSelectMode="CELLS_SELECT";break;case"FULL_COLUMN_SELECT":this.parentPivotGrid._internalSelectMode="COL_SELECT";break;case"FULL_ROW_SELECT":this.parentPivotGrid._internalSelectMode="ROW_SELECT"}var i=this.parentPivotGrid.getCellId(e,t);delete this._cellElements[i],null==this._selectedCells[i]?this._selectedCells[i]={pivotRow:t,pivotColumn:e,isSelected:!0}:this._selectedCells[i].isSelected=!0,this._refreshRequired=!0}},unselectCell:function(t,e){this._beginSelectionUpdate(),this._internalUnselectCell(t,e),this._endSelectionUpdate()},_internalUnselectCell:function(t,e){var i=this.parentPivotGrid.getCellId(e,t);null!=this._selectedCells[i]&&(this._selectedCells[i].isSelected=!1),delete this._cellElements[i],this._refreshRequired=!0},isCellSelected:function(t,e){var i=this.parentPivotGrid.getCellId(e,t);return!(!e.isSelected&&!t.isSelected)||null!=this._selectedCells[i]&&this._selectedCells[i].isSelected},getSelectedCellsCount:function(){return this._selectedCells.length},getSelectedCells:function(){var t=new Array;for(var e in this._selectedCells){var i=this._selectedCells[e];i.isSelected&&t.push({pivotRow:i.pivotRow,pivotColumn:i.pivotColumn,pivotCells:this})}return t},getNextCell:function(t,e){var i={};switch(e){case"left":i={x:t.pivotColumn.x-1,y:t.pivotRow.y+1};break;case"right":i={x:t.pivotColumn.x+t.pivotColumn.getWidth()+1,y:t.pivotRow.y+1};break;case"top":i={x:t.pivotColumn.x+1,y:t.pivotRow.y-1};break;case"bottom":i={x:t.pivotColumn.x+1,y:t.pivotRow.y+t.pivotRow.getHeight()+1}}var s={x:i.x+2*this.parentPivotGrid._pivotColumns.x-this.parentPivotGrid._pivotColumns.viewPort.x,y:i.y+2*this.parentPivotGrid._pivotRows.y-this.parentPivotGrid._pivotRows.viewPort.y},n=this._hitTest(s);if(n)return n}})}(jqxBaseFramework),function(E){E.jqx.jqxPivotGrid=E.jqx.jqxPivotGrid||{},E.jqx.jqxPivotGrid.pivotItem=function(t,e){this.text="Item",this.isExpanded=!1,this.expandCollapseEnabled=!0,this.isHidden=!1,this.isFiltered=!1,this.isSelected=!1,this._height=26,this._width=18,this.isDirty=!0,this.parentItem=t||null,this.hierarchy=e||t.hierarchy,this.parentPivotGrid=this.hierarchy.parentPivotGrid,this.id=this.parentPivotGrid.genId(),this.itemLevel=0,this.itemColumn=0,this._itemOrdinal=NaN,this.x=0,this.y=0,this.hierarchyItemWidth=70,this.hierarchyItemHeight=26,this.widthWithChildrenCached=0,this.minimumWidth=18,this.maximumWidth=1e7,this.minimumHeight=8,this.maximumHeight=1/0,this.items=new Array,this.valueItems=new Array},E.extend(E.jqx.jqxPivotGrid.pivotItem.prototype,{_getChildItemsToRender:function(t){for(var e=0;e<this.items.length;e++){var i=this.items[e];i.isHidden||i.isFiltered||(t.push(i),i.isExpanded&&i._getChildItemsToRender(t))}},_calculateWidthWithChildren:function(){if(this.isHidden)this.widthWithChildrenCached=0;else{var t=!this.isColumn&&this.hierarchy.compactStyleRenderingEnabled;if(t)this.widthWithChildrenCached=this.hierarchy.getColumnWidth(0);else if(this.widthWithChildrenCached=this.getWidth(),null!=this.items&&null!=this.valueItems&&(0<this.getVisibleItemsCount()||!this.isColumn&&!t)){var e=0;if(this.isColumn){if(e=0,this.isExpanded)for(s=0;s<this.items.length;s++)this.items[s].isHidden||(e+=this.items[s].getWidthWithChildren());for(s=0;s<this.valueItems.length;s++)this.valueItems[s].isHidden||(e+=this.valueItems[s].getWidthWithChildren())}else for(var i=this.hierarchy.getMaxVisibleLevelDepth(),s=this.itemLevel;s<=i;s++)e+=this.hierarchy.getColumnWidth(s);this.widthWithChildrenCached=e}else this.widthWithChildrenCached=this.getWidth()}},getWidthWithChildren:function(){return this.hierarchy._renderRequired&&this._calculateWidthWithChildren(),this.widthWithChildrenCached},getDisplayWidth:function(){if(!this.isDirty&&!this.hierarchy._renderRequired)return this.displayWidth;var t=this.hasVisibleValueItems();return this.isColumn?this.displayWidth=this.isExpanded||t?this.getWidthWithChildren():this.getWidth():(this.displayWidth=!this.hierarchy.isColumnsHierarchy&&this.hierarchy.compactStyleRenderingEnabled?this.getWidthWithChildren():this.getWidth(),this.isExpanded||t||(this.displayWidth=this.hierarchy.getWidth()-this.x)),this.displayWidth<18&&(this.displayWidth=18),this.displayWidth},getWidth:function(){if(this.isHidden||this.isFiltered)return 0;if(null==this.hierarchy)return 0;var t=this.itemColumn;!this.hierarchy.isColumnsHierarchy&&this.hierarchy.compactStyleRenderingEnabled&&(t=0);var e=this.minimumWidth;return this.isColumn?(e=this.hierarchyItemWidth,this.parentItem&&e<this.parentItem.getWidth()&&this.parentItem.widthWithChildrenCached):e=this.hierarchy.getColumnWidth(t),e},_measureElement:function(t){var e=E("<span style='visibility: hidden; white-space: nowrap;'>"+t+"</span>");E(document.body).append(e);var i=this.hierarchy.sortable?16:0,s={width:e.width()+i+8,height:e.height()+8};return e.remove(),s},autoResize:function(t){t=t||"fitItemContent",this.isColumn?this.setWidth(this.minimumWidth):this.setHeight(this.minimumHeight),"default"!=t&&"fitAll"!=t&&"fitItemContent"!=t||this._autoResizeBestItemContent(t),"default"!=t&&"fitAll"!=t&&"fitItemContent"!=t||this.isColumn&&null!=this.parentItem&&this.getWidth()<this.parentItem.getWidth()&&this.setWidth(this.parentItem.getWidth())},_autoResizeBestItemContent:function(t){this._updateVisibleChildItemsCount();var e=this._measureElement(this.text);for(var i in"default"==t&&this.adapterItem.boundField&&(isNaN(this.adapterItem.boundField.width)||(e.width=this.adapterItem.boundField.width),isNaN(this.adapterItem.boundField.height)||(e.height=this.adapterItem.boundField.height)),this.itemColumn>=this.hierarchy._getColumnsCount()&&this.hierarchy._updateColumnsCount(),0<this._visibleChildItemsCount&&(e.width+=30),(this.getWidth()<e.width||"default"==t&&this.adapterItem.boundField&&!isNaN(this.adapterItem.boundField.width))&&this.setWidth(e.width),this.isColumn?this.parentPivotGrid._pivotColumns.getHeight()<e.height&&this.parentPivotGrid._pivotColumns.setRowHeight(this,e.height):this.getHeight()<e.height&&this.setHeight(e.height),this.items)this.items[i]._autoResizeBestItemContent(t);for(var i in this.valueItems)this.valueItems[i]._autoResizeBestItemContent(t);null!=this.hierarchy&&(this.hierarchy._renderRequired=!0)},_autoResizeBestCellFit:function(t){if(null!=this.hierarchy&&this.hierarchy._renderRequired&&this.hierarchy.render(),null!=this.hierarchy&&this.hierarchy.ColumnsCountRequresUpdate&&this.hierarchy._updateColumnsCount(),0==this.items.length&&0==this.valueItems.length){if(null!=this.hierarchy&&null!=this.parentPivotGrid&&null!=this.parentPivotGrid._pivotCells&&null!=this.parentPivotGrid._pivotRows&&null!=this.parentPivotGrid._pivotColumns){var e={width:1,height:1},i=(this.isColumn?this.parentPivotGrid._pivotRows:this.parentPivotGrid._pivotColumns,this._getVisibleLeafLevelItems());for(var s in i){i[s].isColumn||i[s],i[s].isColumn&&i[s];var n=10,o=10;e.width<n&&(e.width=n),e.height<o&&(e.height=o)}this.width<e.width&&this.setWidth(e.width),!this.isColumn&&this.getHeight()<e.height&&this.setHeight(e.height)}}else{for(var s in this.items)this.items[s]._autoResizeBestCellFit(t);for(var s in this.valueItems)this.valueItems[s]._autoResizeBestCellFit(t)}null!=this.hierarchy&&(this.hierarchy._renderRequired=!0)},setWidth:function(t){if(t<0)throw new Exception("Invalid pivotItem Width value. The value must greater than 0");var e;null!=this.hierarchy&&(e=this.itemColumn,!this.hierarchy.isColumnsHierarchy&&this.hierarchy.compactStyleRenderingEnabled&&(e=0),this.hierarchy._getColumnsCount()<e&&this.hierarchy._updateColumnsCount(),t<this.minimumWidth&&(t=this.minimumWidth),t>this.maximumWidth&&(t=this.maximumWidth),this.isColumn?this.hierarchyItemWidth=t:this.hierarchy.setColumnWidth(e,t),this.hierarchy._renderRequired=!0)},getHeight:function(){return this.isHidden||this.isFiltered?0:this.hierarchyItemHeight},setHeight:function(t){if(t<0||1e4<t)throw new Exception("Invalid pivotItem Height value. The value must be between 0 and 10000");t<this.minimumHeight&&(t=this.minimumHeight),t>this.maximumHeight&&(t=this.maximumHeight),this.hierarchyItemHeight=t,null!=this.hierarchy&&(this.hierarchy._renderRequired=!0)},_calculateHeightWithChildren:function(){if(this.isHidden||this.isFiltered)this.heightWithChildren=0;else{var t=!this.isColumn&&this.hierarchy.compactStyleRenderingEnabled;if(this.isExpanded||this.hasVisibleValueItems()){var e=0;if(this.isColumn){e=this.hierarchyItemHeight;var i=0;if(this.isExpanded)for(var s=0;s<this.items.length;s++){i<(n=this.items[s].getHeightWithChildren())&&(i=n)}for(var n,s=0;s<this.valueItems.length;s++){i<(n=this.valueItems[s].getHeightWithChildren())&&(i=n)}0<i&&(e+=i)}else{if(e=t?this.getHeight():0,this.isExpanded)for(s=0;s<this.items.length;s++)this.items[s].isHidden||this.items[s].isFiltered||(e+=this.items[s].getHeightWithChildren());for(s=0;s<this.valueItems.length;s++)this.valueItems[s].isHidden||this.valueItems[s].isFiltered||(e+=this.valueItems[s].getHeightWithChildren())}this.heightWithChildren=e}else this.heightWithChildren=this.hierarchyItemHeight;this.IsRowDetailsVisible&&(this.heightWithChildren+=this.RowDetailsHeight)}},getHeightWithChildren:function(){return(this.hierarchy._renderRequired||this.isDirty)&&this._calculateHeightWithChildren(),this.heightWithChildren},getDisplayHeight:function(){var t=this.hasVisibleValueItems(),e=0;return this.isColumn?e=this.isExpanded||t?this.getTotalHeight():this.hierarchy.getHeight()-this.y:this.hierarchy.compactStyleRenderingEnabled?(e=this.getHeight(),this.IsRowDetailsVisible&&(e+=this.RowDetailsHeight)):e=this.getHeightWithChildren(),e<this.minimumHeight&&(e=this.minimumHeight),e},getTotalHeight:function(){return this.isHidden||this.isFiltered?0:this.hierarchyItemHeight+(this.IsRowDetailsVisible?this.RowDetailsHeight:0)},ensureVisible:function(){var t,e,i,s=this;s.isVisible()||(t=s.hierarchy.parentPivotGrid.host,s.isColumn?(e=t.find("#divHScroll"),s.x+s.getWidth()>s.hierarchy.viewPort.width?e.val(s.x+s.getWidth()-s.hierarchy.viewPort.width):e.val(s.x)):(i=t.find("#divVScroll"),s.y+s.getHeight()>s.hierarchy.viewPort.height?i.val(s.y+s.getHeight()-s.hierarchy.viewPort.height):i.val(s.y)))},isVisible:function(){return!this.isHidden&&!(this.y<this.hierarchy.viewPort.y-this.hierarchy.y||this.y+this.getDisplayHeight()>this.hierarchy.viewPort.y-this.hierarchy.y+this.hierarchy.viewPort.height||this.x<this.hierarchy.viewPort.x-this.hierarchy.x||this.x+this.getDisplayWidth()>this.hierarchy.viewPort.x-this.hierarchy.x+this.hierarchy.viewPort.width)},_updateVisibleChildItemsCount:function(){for(var t=0,e=0;e<this.items.length;e++)this.items[e].isHidden||this.items[e].isFiltered||t++;this._visibleChildItemsCount=t},render:function(t,e){this._updateVisibleChildItemsCount();if(this.isHidden||this.isFiltered)return!0;this.x=t,this.y=e;var i=!this.isColumn&&this.hierarchy.compactStyleRenderingEnabled,s=i?this.getTotalHeight():0;if(this.isExpanded)for(var n=0;n<this.items.length;n++){if(!(r=this.items[n]).isHidden&&!r.isFiltered)if(this.isColumn){if(!r.render(this.x+s,e+this.getTotalHeight()))break;s+=r.getWidthWithChildren()}else{var o=t;if(o+=i?0:this.getWidth(),!r.render(o,this.y+s))break;s+=r.getHeightWithChildren()}}for(var r,n=0;n<this.valueItems.length;n++){if(!(r=this.valueItems[n]).isHidden&&!r.isFiltered)if(this.isColumn){if(!r.render(this.x+s,e+this.getTotalHeight()))break;s+=r.getWidthWithChildren()}else{o=t;if(o+=i?0:this.getWidth(),!r.render(o,this.y+s))break;s+=r.getHeightWithChildren()}}return this._calculateWidthWithChildren(),this._calculateHeightWithChildren(),!0},_getChildItemsDepth:function(){for(var t=0,e=0;e<this.items.length;e++){t<(i=this.items[e]._getChildItemsDepth())&&(t=i)}for(var i,e=0;e<this.valueItems.length;e++){t<(i=this.valueItems[e]._getChildItemsDepth())&&(t=i)}return t+1},getTotalItemsCount:function(){var t=0;if(0==this.items.length&&0==this.valueItems.length)t=1;else{for(var e=0;e<this.items.length;e++)t+=this.items[e].getTotalItemsCount();for(e=0;e<this.valueItems.length;e++)t+=this.valueItems[e].getTotalItemsCount()}return t},hasVisibleValueItems:function(){for(var t=0;t<this.valueItems.length;t++){var e=this.valueItems[t];if(0==e.isHidden&&0==e.isFiltered)return!0}return!1},getVisibleItemsCount:function(){if(this.isHidden||this.isFiltered)return 0;var t=0;if(!(this.isExpanded&&0!=this.items.length||0!=this.valueItems.length))return t;for(var e=t=0;e<this.items.length;e++)this.items[e].isHidden||this.items[e].isFiltered||t++;for(e=0;e<this.valueItems.length;e++)this.valueItems[e].isHidden||this.valueItems[e].isFiltered||t++;return t},hitTest:function(t){if(this.isHidden||this.isFiltered)return null;var e=this.getDisplayHeight()+1,i=this.getDisplayWidth()+1;return t.x>=this.x&&t.x<=this.x+i&&t.y>=this.y&&t.y<=this.y+e?this:null},_expandInternal:function(t,e,i){if(0!=this.items.length&&this.expandCollapseEnabled&&this.isExpanded!=t){var s=new E.Event(this.isExpanded?"pivotitemcollapsing":"pivotitemexpanding");s.owner=this.hierarchy.parentPivotGrid,s.args={pivotItem:this},s.cancel=!1;var n=this.hierarchy.parentPivotGrid.host;if(n.trigger(s),!s.cancel&&(this.isExpanded=t,0!=this.items.length||0!=this.valueItems.length)){if(i){for(var o=0;o<this.items.length;o++)this.items[o]._expandInternal(t,e,i);for(o=0;o<this.valueItems.length;o++)this.valueItems[o]._expandInternal(t,e,i)}this.hierarchy._renderRequired=!0,e&&this.hierarchy._updateVisibleLeaves(),(s=new E.Event(this.isExpanded?"pivotitemexpanded":"pivotitemcollapsed")).owner=this.hierarchy.parentPivotGrid,s.args={pivotItem:this},n.trigger(s)}}},expand:function(){this._expandInternal(!0,!0,!1)},collapse:function(){this._expandInternal(!1,!0,!1)},_getFirstVisibleLeaf:function(t){if(t.isExpanded){for(var e=!1,i=0;i<t.items.length;i++)if(0==t.items[i].isHidden&&0==t.items[i].isFiltered){t=t.items[i],t=this._getFirstVisibleLeaf(t),e=!0;break}if(e)return t}if(t.hasVisibleValueItems){for(e=!1,i=0;i<t.valueItems.length;i++)if(0==t.valueItems[i].isHidden&&0==t.valueItems[i].isFiltered){t=t.valueItems[i],t=this._getFirstVisibleLeaf(t),e=!0;break}if(e)return t}return t},_getLastVisibleLeaf:function(t){for(var e=!1,i=t.valueItems.length-1;0<=i;i--)if(0==t.valueItems[i].isHidden&&0==t.valueItems[i].isFiltered){t=t.valueItems[i],t=this._getLastVisibleLeaf(t),e=!0;break}if(e)return t;for(i=t.items.length-1;0<=i&&t.isExpanded;i--)if(0==t.items[i].isHidden&&0==t.items[i].isFiltered){t=t.items[i],t=this._getLastVisibleLeaf(t);break}return t}}),E.jqx.jqxPivotGrid.hierarchy=function(){this.parentPivotGrid=arguments[0],this._initDefaults()},E.extend(E.jqx.jqxPivotGrid.hierarchy.prototype,{_initDefaults:function(){this.columnWidths=new Array,this.rowHeights=new Array,this.items=new Array,this.valueItems=new Array,this.visibleLeafItems=new Array,this.viewPort=new Object,this.viewPort.x=0,this.viewPort.y=0,this.viewPort.width=1e4,this.viewPort.height=1e4,this.isFixed=!1,this.isHidden=!1,this.resizable=!0,this.sortable=!0,this._renderRequired=!0,this.maxVisibleLevelDepth=-1,this.showExpandCollapseButtons=!0,this.x=0,this.y=0,this._width=0,this._height=0,this.minColumnWidth=18,this._isColumnsCountRequresUpdate=!0,this._selectedItems=new Object,this.virtualModeThreshold=5e3,this._isVirtualMode=!0},isVisible:function(){return!this.isHidden},toggle:function(){this.isHidden?this.show():this.hide()},getOtherHierarchy:function(){return this.isColumnsHierarchy?this.parentPivotGrid._pivotRows:this.parentPivotGrid._pivotColumns},show:function(){this.isHidden=!1,this._renderRequired=!0,this.getOtherHierarchy()._renderRequired=!0},hide:function(){this.isHidden=!0,this._renderRequired=!0,this.getOtherHierarchy()._renderRequired=!0},refresh:function(){var t=this.parentPivotGrid,e=t.toThemeProperty("jqx-widget-content jqx-fill-state-pressed jqx-widget-header"),i=t.toThemeProperty("jqx-widget-content jqx-fill-state-normal jqx-widget-header"),s=E.jqx.get(this,"renderCanvas");if((this._renderRequired||this._refreshRequired)&&(this._renderRequired&&this.render(),!this.isHidden)){var n=new Array,o=new Date,r=this._getItemsToRender();if(r){for(var l=0;l<r.length;l++){var h,a,d,u,c,v,m,p,_,g=r[l],C=g.getDisplayWidth()-1,f=g.getDisplayHeight()-1,y=g._element;E.isFunction(t.itemsRenderer)&&(h=t.itemsRenderer(g),y&&g._currentCustomContent!=h&&(s.removeChild(y),y=g._element=null),g._currentCustomContent=h),y||(a={left:4,top:4,right:4,bottom:4},!this.isColumnsHierarchy&&this.compactStyleRenderingEnabled&&(a.left+=g.itemLevel*this.compactStyleRenderingItemsIndent),d=g.text,u="left",E.isFunction(t.itemsRenderer)?(d=g._currentCustomContent,a={left:0,top:0,right:0,bottom:0}):(c="",0!=g.items.length&&g.hierarchy.showExpandCollapseButtons&&(c=g.isExpanded?"<div style='position: relative; top: 3px; padding: 5px; width: 11px; height: 11px;' class='jqx-pivotgrid-collapse-button'></div>":"<div style='position: relative; top: 3px; padding: 5px; width: 11px; height: 11px;' class='jqx-pivotgrid-expand-button'></div>"),v="",g.hierarchy._sortItem==g&&(v="<div id='sortElement' class='"+("desc"==g.hierarchy._sortOrder?"sortdesc jqx-grid-column-sortdescbutton "+this.parentPivotGrid.toThemeProperty("jqx-icon-arrow-down"):"sortasc jqx-grid-column-sortascbutton "+this.parentPivotGrid.toThemeProperty("jqx-icon-arrow-up"))+"' style='position: relative; float: right; padding-right: 8px; width: 16px; height: 100%;'></div>"),m=g.text,g.adapterItem.boundField&&(u=g.adapterItem.boundField.align||"left"),"center"!=(u=u.toString().toLowerCase())&&"right"!=u&&(u="left"),d=""!=v?(p=0,_=24,""!=c&&(_+=p=23),c+"<div><div style='left: "+p+"px; top: 0; position: absolute; height: 100%; width: calc(100% - "+_+"px); text-overflow: ellipsis; overflow: hidden;  white-space: nowrap;padding-left:"+a.left+"px; padding-top:"+a.top+"px; '>"+m+"</div><div style='left: 0; top: 0; position: absolute; height: 100%; width: 100%;'>"+v+"</div></div>"):c+m+v),y=t.createDiv(s,"",C,f),t.setDivContent(y,d,a,u,!0),this.parentPivotGrid.getChild(y,"innerDiv").className="jqx-pivotgrid-item",t.setElementPosition(y,g.x,g.y),y.originalY=y.style.top),g.tRender=o;var x=g.isSelected?e:i,I=g.isSelected?"classNameSelected":"className",S=E.jqx.getByPriority([g[I],g.adapterItem&&g.adapterItem.boundField?g.adapterItem.boundField[I]:void 0,this.hierarchy?this.hierarchy[I]:void 0]);S&&(x+=" "+S),(x+=" jqx-pivotgrid-content-wrapper")!=y.className&&(y.className=x),y.style.display="block",(y.item=g)._element=y}for(l=0;l<s.childNodes.length;l++)s.childNodes[l].item&&s.childNodes[l].item.tRender!=o&&n.push(s.childNodes[l]);for(;;){var R=n.pop();if(!R)break;100<s.childNodes.length?(R.item._element=void 0,s.removeChild(R)):R.item._element.style.display="none"}var w=this.isColumnsHierarchy?0:-t._offsetY,P=this.isColumnsHierarchy?-t._offsetX:0;t.setElementPosition(s,P,w),this._refreshRequired=!1}}},clear:function(){this._initDefaults(),this._resetCanvas(),this.items=[],this.valueItems=[],this._renderRequired=!0},_resetCanvas:function(){var t=E.jqx.get(this,"renderCanvas");if(t)for(;t.hasChildNodes();)t.firstChild.item._element=void 0,t.removeChild(t.firstChild)},autoResize:function(t){for(var e=0;e<this.items.length;e++)this.items[e].autoResize(t);for(e=0;e<this.valueItems.length;e++)this.valueItems[e].autoResize(t)},getMaxVisibleLevelDepth:function(){if(-1==this.maxVisibleLevelDepth||this._renderRequired)for(var t=this._getVisibleLeafLevelItems(),e=this.maxVisibleLevelDepth=0;e<t.length;e++)t[e].itemLevel>this.maxVisibleLevelDepth&&(this.maxVisibleLevelDepth=t[e].itemLevel);return this.maxVisibleLevelDepth},getHierarchyDepth:function(){for(var t=0,e=0;e<this.items.length;e++){t<(i=this.items[e]._getChildItemsDepth())&&(t=i)}for(var i,e=0;e<this.valueItems.length;e++){t<(i=this.valueItems[e]._getChildItemsDepth())&&(t=i)}return t},getSortItem:function(){return this._sortItem},getSortOrder:function(){return this._sortOrder},_fnAscSortComparer:function(t,e){var i=t.hierarchy.parentPivotGrid,s=(t.isColumn?i._pivotRows:i._pivotColumns)._sortItem;if(!s)return 0;if(t.adapterItem&&t.adapterItem.isTotal)return 1;if(e.adapterItem&&e.adapterItem.isTotal)return-1;var n=i._pivotCells,o=t.isColumn?n.getCellValue(s,t):n.getCellValue(t,s),r=e.isColumn?n.getCellValue(s,e):n.getCellValue(e,s);return o.value-r.value},_fnDescSortComparer:function(t,e){return t.adapterItem&&t.adapterItem.isTotal?1:e.adapterItem&&e.adapterItem.isTotal?-1:-1*E.jqx.jqxPivotGrid.hierarchy.prototype._fnAscSortComparer(t,e)},_collectionSort:function(t,e,i){if(this.parentPivotGrid&&this.parentPivotGrid._pivotCells){var s=this.isColumnsHierarchy?this.parentPivotGrid._pivotRows:this.parentPivotGrid._pivotColumns;t=t||this.items,e=e||("asc"==s._sortOrder?this._fnAscSortComparer:this._fnDescSortComparer),this._isSorted&&!i&&this._collectionRemoveSort(t);for(var n=0;n<t.length;n++)t[n]._itemOrdinal=n,this._collectionSort(t[n].items,e,!0);t=t.sort(e),i||(this._isSorted=!0,this._renderRequired=!0,s._renderRequired=!0,this._updateVisibleLeaves())}},_collectionRemoveSort:function(t,e){if(this._isSorted){t=t||this.items;for(var i,s=new Array(t.length),n=0;n<t.length;n++)s[t[n]._itemOrdinal]=t[n],this._collectionRemoveSort(t[n].items,!0);this.items=s,e||(this._renderRequired=!0,this._updateVisibleLeaves(),this.isColumnsHierarchy&&(this._isColumnsCountRequresUpdate=!0),this._isSorted=!1,(i=this.isColumnsHierarchy?this.parentPivotGrid._pivotRows:this.parentPivotGrid._pivotColumns)._sortItem=void 0,i._sortOrder=void 0,i._renderRequired=!0)}},sortBy:function(t,e){var i,s;!t||t.isColumn==this.isColumnsHierarchy||0<t.valueItems.length||((i=new E.Event("sortchanging")).owner=this.parentPivotGrid,i.args={pivotItem:t,sortOrder:e},i.cancel=!1,this.parentPivotGrid.host.trigger(i),i.cancel||(this._collectionRemoveSort(this.items),(s=t.isColumn?this.parentPivotGrid._pivotColumns:this.parentPivotGrid._pivotRows)._sortItem=t,s._sortOrder=e,this._collectionSort(),this.parentPivotGrid._internalRefresh(),(i=new E.Event("sortchanged")).owner=this.parentPivotGrid,i.args={pivotItem:t,sortOrder:e},this.parentPivotGrid.host.trigger(i)))},removeSort:function(){var t=this==this.parentPivotGrid._pivotColumns?this.parentPivotGrid._pivotRows:this.parentPivotGrid._pivotColumns,e=t._sortItem,i=t._sortOrder,s=new E.Event("sortremoving");s.owner=this.parentPivotGrid,s.args={pivotItem:e,sortOrder:i},s.cancel=!1;var n=this.parentPivotGrid.host;n.trigger(s),s.cancel||(this._collectionRemoveSort(this.items),this.parentPivotGrid._internalRefresh(),(s=new E.Event("sortremoved")).owner=this.parentPivotGrid,s.args={pivotItem:e,sortOrder:i},n.trigger(s))},_binSearchItems:function(t,e){return this._binSearchItems2(t,e,0,t.length)},_binSearchItems2:function(t,e,i,s){var n=i,o=s;if(o==n)return-1;for(var r=t[0].isColumn;n<o;){var l=parseInt((n+o)/2),h=t[l];if(r)if(h.x>e.x)o=l;else{if(!((l+1<o?t[l+1].x:h.x+h.getWidth())<e.x))return l;n=l+1}else if(h.y>e.y)o=l;else{if(!((l+1<o?t[l+1].y:h.y+h.getTotalHeight())<e.y))return l;n=l+1}}return-1},_pointToLeafItemIndex:function(t){this._renderRequired&&this.render();var e={x:t.x,y:t.y};e.x+=-this.x+this.viewPort.x,e.y+=-this.y+this.viewPort.y;var i=this._getVisibleLeafLevelItems();return this._binSearchItems(i,e)},_pointToLeafItem:function(t){var e=this._getVisibleLeafLevelItems(),i=this._pointToLeafItemIndex(t);return-1==i||i<0||i>=e.length?null:(e[i].lfIdx=i,e[i])},_pointToLeafItemIndexAbsolute:function(t){this._renderRequired&&this.render();this.viewPort.x,this.x,this.viewPort.y,this.y;var e={x:t.x,y:t.y};e.x-=this.x-(this.viewPort.x-this.x),e.y-=this.y-(this.viewPort.y-this.y);var i=this._getVisibleLeafLevelItems();return this._binSearchItems(i,e)},_pointToLeafItemAbsolute:function(t){var e=this._getVisibleLeafLevelItems(),i=this._pointToLeafItemIndexAbsolute(t);return-1==i||i<0||i>=e.length?null:(e[i].lfIdx=i,e[i])},_pointInRect:function(t,e){return t.x>=e.x&&t.x<=e.x+e.width&&t.y>=e.y&&t.y<=e.y+e.height},hitTest:function(t){this._renderRequired&&this.render();var e=this.viewPort.x-this.x,i=this.viewPort.y-this.y;if(!this._pointInRect({x:t.x+e,y:t.y+i},this.viewPort)||this.isHidden)return null;var s={x:t.x,y:t.y};s.x-=this.x-(this.viewPort.x-this.x),s.y-=this.y-(this.viewPort.y-this.y);var n=this._getVisibleLeafLevelItems(),o=this._binSearchItems(n,s);if(-1==o)return null;var r=n[o],l=r.hitTest(s);if(null!=l)return l;for(;null!=r;)if(null!=(r=r.parentItem)&&null!=(l=r.hitTest(s)))return l;return null},_addColumn:function(t){return t<this.minColumnWidth&&(t=this.minColumnWidth),this.columnWidths.push(t),this.columnWidths.length-1},setColumnWidth:function(t,e){return t>=this.columnWidths.length&&this._updateColumnsCount(t+1),e<this.minColumnWidth&&(e=this.minColumnWidth),t<this.columnWidths.length&&(this.columnWidths[t]=e),this._renderRequired=!0},getColumnWidth:function(t){return t>=this.columnWidths.length?70:this.columnWidths[t]},_getVisibleLeaves:function(t,e,i){if(e.isHidden||e.isFiltered)return!0;if(0==e.items.length&&0==e.valueItems.length)return t.push(e),!0;if(i&&t.push(e),e.isExpanded)for(var s=0;s<e.items.length;s++){var n=e.items[s];n.isHidden||n.isFiltered||(0<e.items.length&&n.isExpanded||n.hasVisibleValueItems()?this._getVisibleLeaves(t,n,i):t.push(n))}for(s=0;s<e.valueItems.length;s++){var o=e.valueItems[s];o.isHidden||o.isFiltered||t.push(o)}return!0},_getVisibleLeafLevelItems:function(){return 0==this.visibleLeafItems.length&&this._updateVisibleLeaves(),this.visibleLeafItems},_updateVisibleLeaves:function(){if(this.visibleLeafItems=new Array,this.items.length+this.valueItems.length!=0){for(var t=!this.isColumnsHierarchy&&this.compactStyleRenderingEnabled,e=0;e<this.items.length;e++){(i=this.items[e]).isHidden||i.isFiltered||(i.isExpanded||i.hasVisibleValueItems()?this._getVisibleLeaves(this.visibleLeafItems,i,t):this.visibleLeafItems.push(i))}for(var i,e=0;e<this.valueItems.length;e++){(i=this.valueItems[e]).isHidden||i.isFiltered||(i.isExpanded||i.hasVisibleValueItems()?this._getVisibleLeaves(this.visibleLeafItems,i,t):this.visibleLeafItems.push(i))}for(e=0;e<this.visibleLeafItems.length;e++)this.visibleLeafItems[e]._lfIndex=e;this._updateItemsLevelAndColumn()}},_getFirstLeafIndexToRender:function(){var t={x:this.x,y:this.y},e={x:t.x,y:t.y};return e.x-=this.x-(this.viewPort.x-this.x),e.y-=this.y-(this.viewPort.y-this.y),this._binSearchItems(this._getVisibleLeafLevelItems(),e)},_getLastLeafIndexToRender:function(){var t={x:Math.min(this.viewPort.width,this.getWidth())-5,y:Math.min(this.viewPort.height,this.getHeight())-5};return this._pointToLeafItemIndex(t)},_getLeafItemsToRender:function(){var t={};return t.items=this._getVisibleLeafLevelItems(),t.first=this._getFirstLeafIndexToRender(),t.last=this._getLastLeafIndexToRender(),t},_getItemsToRender:function(){var t=this._getLeafItemsToRender(),e=t.first,i=t.last;if(-1!=e&&-1!=i){for(var s={},n=e;n<=i;n++){var o=t.items[n];for(s[o.id]=o;null!=o.parentItem;)s[(o=o.parentItem).id]=o}var r=new Array;for(var n in s)r.push(s[n]);return r}},_updateItemsLevelAndColumn2:function(t,e){t.itemColumn=e,t.itemLevel=e;for(var i=0;i<t.items.length;i++)this._updateItemsLevelAndColumn2(t.items[i],e+1);for(i=0;i<t.valueItems.length;i++)this._updateItemsLevelAndColumn2(t.valueItems[i],e+1)},_updateItemsLevelAndColumn:function(){for(var t=0;t<this.items.length;t++)this._updateItemsLevelAndColumn2(this.items[t],0);for(t=0;t<this.valueItems.length;t++)this._updateItemsLevelAndColumn2(this.valueItems[t],0)},updateColumnsCount:function(){this.updateColumnsCount(0)},getTotalItemsCount:function(){var t=0;if(0==this.items.length&&0==this.valueItems.length)t=1;else{for(var e=0;e<this.items.length;e++)t+=this.items[e].getTotalItemsCount();for(e=0;e<this.valueItems.length;e++)t+=this.valueItems[e].getTotalItemsCount()}return t},_updateColumnsCount:function(t){var e,i=this._getColumnsCount(),s=this.getTotalItemsCount();1024<t&&(t=1024),this.isColumnsHierarchy?s<t&&(s=t):s=(e=this.getHierarchyDepth())<t?t:e;for(var n=i;n<s;n++)this._addColumn(70);this._isColumnsCountRequresUpdate=!1},_updateColumnsIndexes:function(){for(var t in this.items)this._updateItemsLevelAndColumn2(this.items[t],0);for(var t in this.valueItems)this._updateItemsLevelAndColumn2(this.valueItems[t],0)},_getColumnsCount:function(){return this.columnWidths.length},_getRenderedItems:function(){var t=new Array;return this._getChildItemsToRender(t),t},_getChildItemsToRender:function(t){for(var e=0;e<this.items.length;e++){var i=this.items[e];i.isHidden||i.isFiltered||(t.push(i),i.isExpanded&&i._getChildItemsToRender(t))}},getWidth:function(){return this._renderRequired&&this.render(),this._width},getHeight:function(){return this._renderRequired&&this.render(),this._height},_beginSelectionUpdate:function(){for(var t in this._selectedItems)this._selectedItems[t].OldIsSelected=this._selectedItems[t].isSelected},_endSelectionUpdate:function(){var t=new Array;for(var e in this._selectedItems){var i,s=this._selectedItems[e];s.isSelected||t.push(this._selectedItems[e]),s.isSelected==s.OldIsSelected||null!=s.parentItem&&1!=s.parentItem.isExpanded&&!s._isValueItem||((i=new E.Event("pivotitemselectionchanged")).owner=this.parentPivotGrid,i.args={pivotItem:s,selected:s.isSelected},this.parentPivotGrid.host.trigger(i))}for(var e in t){var n=this._selectedItems[t[e].adapterItem.key];n.isSelected=n.OldIsSelected=!1,delete this._selectedItems[t[e].adapterItem.key]}},selectItem:function(t){this.parentPivotGrid.selectionEnabled&&(this._beginSelectionUpdate(),this._internalSelectItem(t),this._endSelectionUpdate())},_internalSelectItem:function(t){if(null!=t&&!(t.isColumn!=this.isColumnsHierarchy||this.isColumnsHierarchy&&this.isGroupingColumn(t))){var e=t.adapterItem.key;if(null==this._selectedItems[e]&&(this._selectedItems[e]=t),t.isSelected=!0,this._refreshRequired=!0,this.parentPivotGrid._pivotCells._refreshRequired=!0,this.isColumnsHierarchy||!t.hierarchy.compactStyleRenderingEnabled){for(var i in t.items)this._internalSelectItem(t.items[i]);for(var i in t.valueItems)this._internalSelectItem(t.valueItems[i])}}},unselectItem:function(t){this._beginSelectionUpdate(),this._internalUnselectItem(t),this._endSelectionUpdate()},_internalUnselectItem:function(t){if(null!=t&&t.isColumn==this.isColumnsHierarchy){var e=t.adapterItem.key;if(this._selectedItems[e]&&(this._selectedItems[e].isSelected=!1,this._refreshRequired=!0,this.parentPivotGrid._pivotCells._refreshRequired=!0),this.isColumnsHierarchy||!t.hierarchy.compactStyleRenderingEnabled){for(var i in t.items)this._internalUnselectItem(t.items[i]);for(var i in t.valueItems)this._internalUnselectItem(t.valueItems[i])}}},_internalClearSelection:function(){for(var t in this._selectedItems)this._internalUnselectItem(this._selectedItems[t])},clearSelection:function(){this._beginSelectionUpdate(),this._internalClearSelection(),this._endSelectionUpdate()},_applySelectionToParentItem:function(t){var e=t.parentItem;if(null!=e&&null!=e){var i,s,n=t.hierarchy,o=!0;if(e.isExpanded)for(var r in e.items){if(0==(i=e.items[r]).isSelected&&0==i.isHidden){o=!1;break}}if(o)for(var r in e.valueItems){if(0==(i=e.valueItems[r]).isSelected&&0==i.isHidden){o=!1;break}}o&&(s=e.adapterItem.key,null==n._selectedItems[s]&&(n._selectedItems[s]=e),e.isSelected=!0,this._applySelectionToParentItem(e))}},_applySelectionToParentItems:function(){for(var t in this._selectedItems)this._applySelectionToParentItem(this._selectedItems[t])},getSelectedItems:function(){var t=new Array;for(var e in this._selectedItems)this._selectedItems[e].isSelected&&t.push(e);return t}}),E.jqx.jqxPivotGrid.pivotRows=function(t){E.extend(this,new E.jqx.jqxPivotGrid.hierarchy),this.parentPivotGrid=t,this.isColumnsHierarchy=!1,this.compactStyleRenderingEnabled=!1,this.compactStyleRenderingItemsIndent=20},E.extend(E.jqx.jqxPivotGrid.pivotRows.prototype,E.jqx.jqxPivotGrid.hierarchy.prototype),E.extend(E.jqx.jqxPivotGrid.pivotRows.prototype,{setColumnWidth:function(t,e){return t>=this.columnWidths.Count&&this._updateColumnsCount(t+1),this.compactStyleRenderingEnabled&&(t=0),t<this.columnWidths.length&&(this.columnWidths[t]=e),this._renderRequired=!0},updateBounds:function(){for(var t=0,e=0,i=0;i<2;i++)for(var s=0==i?this.items:this.valueItems,n=0;n<s.length;n++){var o,r=s[n];r.isHidden||(t+=r.getHeightWithChildren(),e<(o=r.getWidthWithChildren())&&(e=o))}this._width=e,this._height=t+1},render:function(){if(!this._renderSuppressed){for(this._refreshRequired=!0,this.parentPivotGrid._pivotCells._refreshRequired=!0,this.isRendering=!0,this._isColumnsCountRequresUpdate&&this._updateColumnsCount();this._getColumnsCount()<this.getHierarchyDepth();)E.jqx.get(this,"columnWidths").push(70);var t,e;this._updateVisibleLeaves(),this.compactStyleRenderingEnabled&&(0==this.columnWidths.Count&&this._addColumn(70),(t=this.columnWidths[0])<(e=this.getHierarchyDepth())*this.compactStyleRenderingItemsIndent&&(t=e*this.compactStyleRenderingItemsIndent),this.columnWidths[0]=t),this.updateBounds();var i=0;if(this.items.length+this.valueItems.length==0)return null!=this.parentPivotGrid&&(this.parentPivotGrid.isSyncScrollRequired=!0),this.isRendering=!1,void(this._renderRequired=!1);for(var s=0;s<2;s++)for(var n=0==s?this.items:this.valueItems,o=0;o<n.length;o++){var r=n[o];if(null==r.hierarchy&&(r.hierarchy=this),!r.isHidden){var l=r.getHeightWithChildren();if(r.itemLevel<this.columnWidths.length&&r.getWidth()>this.columnWidths[r.itemLevel]&&(this.columnWidths[r.itemLevel]=r.getWidth()),!r.render(0,i))break;i+=l}}this.updateBounds(),null!=this.parentPivotGrid&&(this.parentPivotGrid.isSyncScrollRequired=!0),this._resetCanvas(),this._renderRequired=!1,this.isRendering=!1}},isOnRowDetails:function(t,e){if(!e.RowDetailsVisible)return!1;var i={x:t.x,y:t.y};return i.x+=-this.x+this.viewPort.x,i.y+=-this.y+this.viewPort.y,i.y<e.y+e.getDisplayHeight()&&i.y>e.y+e.getDisplayHeight()-e.RowDetailsHeight}}),E.jqx.jqxPivotGrid.pivotColumns=function(t){E.extend(this,new E.jqx.jqxPivotGrid.hierarchy),this.parentPivotGrid=t,this.isColumnsHierarchy=!0},E.extend(E.jqx.jqxPivotGrid.pivotColumns.prototype,E.jqx.jqxPivotGrid.hierarchy.prototype),E.extend(E.jqx.jqxPivotGrid.pivotColumns.prototype,{render:function(){if(!this._renderSuppressed){if(this._refreshRequired=!0,this.parentPivotGrid._pivotCells._refreshRequired=!0,this._updateVisibleLeaves(),this._updateColumnsIndexes(),this.items.length+this.valueItems.length==0)return null!=this.parentPivotGrid&&(this.parentPivotGrid.isSyncScrollRequired=!0),void this._updateVisibleLeaves();for(var t=0,e=0;e<2;e++)for(var i=0==e?this.items:this.valueItems,s=0;s<i.length;s++){var n=i[s];if(null==n.hierarchy&&(n.hierarchy=this),!n.isHidden){var o=n.getWidthWithChildren();if(!n.render(t,0))break;t+=o}}this._renderRequired=!1,null!=this.parentPivotGrid&&(this.parentPivotGrid.isSyncScrollRequired=!0),this._updateVisibleLeaves(),this.updateBounds(),this._resetCanvas()}},updateBounds:function(){for(var t=0,e=0,i=0;i<2;i++)for(var s=0==i?this.items:this.valueItems,n=0;n<s.length;n++){var o=s[n],r=o.getHeightWithChildren();t<r&&(t=r),e+=o.getWidthWithChildren()}this._height=t,this._width=e+1},_updateColumnsIndexes:function(){for(var t=this.visibleLeafItems.length,e=--t;0<=e;e--){var i=this.visibleLeafItems[e];i.itemColumn=e;for(var s=i.parentItem;null!=s;)s=s.hierarchy!=i.hierarchy?null:(s.itemColumn=e,(i=s).parentItem)}},setRowHeight:function(t,e){return!(e<15||500<e)&&(t.hierarchyItemHeight=e,this._renderRequired=!0)},isGroupingColumn:function(t){return null!=t&&(null!=this.parentPivotGrid&&!!(t.ItemIndex<this.parentPivotGrid.groupingColumns.length&&this.parentPivotGrid.isGroupingEnabled))}})}(jqxBaseFramework),function(t){t.extend(t.jqx._jqxPivotGrid.prototype,{_handleKeyboardNavigation:function(t){return"CELLS_SELECT"==this._internalSelectMode?this._handleCellsKeyboardNavigation(t):("ROW_SELECT"==this._internalSelectMode||this._internalSelectMode,!1)},_handleCellsKeyboardNavigation:function(t){var e=this._cellKBRangeSelectionEnd,i=void 0;if(!e)return!1;if(37==t.keyCode&&(i=this._pivotCells.getNextCell(e,"left")),38==t.keyCode?i=this._pivotCells.getNextCell(e,"top"):39==t.keyCode?i=this._pivotCells.getNextCell(e,"right"):40==t.keyCode&&(i=this._pivotCells.getNextCell(e,"bottom")),null!=i){this._pivotRows._refreshRequired=!0,this._pivotColumns._refreshRequired=!0,this._pivotCells._refreshRequired=!0,this._colItemRangeSelectionBeg=i.pivotColumn,this._rowItemRangeSelectionBeg=i.pivotRow,this._beginSelectionUpdate(),this._isCTRLPressed&&0!=this.multipleSelectionEnabled||this._internalClearSelection(),this._pivotCells._internalSelectCell(this._rowItemRangeSelectionBeg,this._colItemRangeSelectionBeg),this._cellKBRangeSelectionEnd={pivotRow:this._rowItemRangeSelectionBeg,pivotColumn:this._colItemRangeSelectionBeg,pivotCells:this._pivotCells},this._cellKBRangeSelectionStart&&this._isSHIFTPressed||(this._cellKBRangeSelectionStart={pivotRow:this._rowItemRangeSelectionBeg,pivotColumn:this._colItemRangeSelectionBeg,pivotCells:this._pivotCells});for(var s=Math.min(this._cellKBRangeSelectionStart.pivotColumn._lfIndex,this._cellKBRangeSelectionEnd.pivotColumn._lfIndex),n=Math.max(this._cellKBRangeSelectionStart.pivotColumn._lfIndex,this._cellKBRangeSelectionEnd.pivotColumn._lfIndex),o=Math.min(this._cellKBRangeSelectionStart.pivotRow._lfIndex,this._cellKBRangeSelectionEnd.pivotRow._lfIndex),r=Math.max(this._cellKBRangeSelectionStart.pivotRow._lfIndex,this._cellKBRangeSelectionEnd.pivotRow._lfIndex),l=s;l<=n;l++)for(var h=o;h<=r;h++){var a=this._pivotColumns.visibleLeafItems[l],d=this._pivotRows.visibleLeafItems[h];this._pivotCells._internalSelectCell(d,a)}this._endSelectionUpdate(),i.pivotRow.ensureVisible(),i.pivotColumn.ensureVisible(),this._internalRefresh()}return!1}})}(jqxBaseFramework);