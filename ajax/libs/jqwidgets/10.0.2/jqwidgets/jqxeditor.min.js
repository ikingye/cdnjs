!function(T){T.jqx.jqxWidget("jqxEditor","",{}),T.extend(T.jqx._jqxEditor.prototype,{defineInstance:function(){var e={width:null,height:null,disabled:!1,pasteMode:"html",editable:!0,lineBreak:"default",changeType:null,toolbarPosition:"top",fontFamily:"sans-serif",commands:{bold:{tooltip:"Bold",command:"bold",type:"toggleButton"},italic:{tooltip:"Italic",command:"italic",type:"toggleButton"},underline:{tooltip:"Underline",command:"underline",type:"toggleButton"},format:{placeHolder:"Format Block",tooltip:"Format Block",command:"formatblock",value:[{value:"p",label:"Paragraph"},{value:"h1",label:"Header 1"},{value:"h2",label:"Header 2"},{value:"h3",label:"Header 3"},{value:"h4",label:"Header 4"}],type:"list",width:120,dropDownWidth:190,height:25},font:{placeHolder:"Font",tooltip:"Font Name",command:"fontname",value:[{label:"Arial",value:"Arial, Helvetica, sans-serif"},{label:"Comic Sans MS",value:'"Comic Sans MS", cursive, sans-serif'},{label:"Courier New",value:'"Courier New", Courier, monospace'},{label:"Georgia",value:"Georgia,serif"},{label:"Impact",value:"Impact,Charcoal,sans-serif"},{label:"Lucida Console",value:"'Lucida Console',Monaco,monospace"},{label:"Tahoma",value:"Tahoma,Geneva,sans-serif"},{label:"Times New Roman",value:"'Times New Roman',Times,serif"},{label:"Trebuchet MS",value:'"Trebuchet MS",Helvetica,sans-serif'},{label:"Verdana",value:"Verdana,Geneva,sans-serif"}],type:"list",width:160,height:25,dropDownWidth:160},size:{placeHolder:"Size",tooltip:"Font Size",command:"fontsize",value:[{label:"1 (8pt)",value:"xx-small"},{label:"2 (10pt)",value:"x-small"},{label:"3 (12pt)",value:"small"},{label:"4 (14pt)",value:"medium"},{label:"5 (18pt)",value:"large"},{label:"6 (24pt)",value:"x-large"},{label:"7 (36pt)",value:"xx-large"}],type:"list",width:45,height:25,dropDownWidth:160},color:{tooltip:"Text Color",command:"forecolor",value:"#000",type:"colorPicker"},background:{tooltip:"Fill Color",command:"backcolor",value:"#fff",type:"colorPicker"},left:{tooltip:"Align Left",command:"justifyleft",type:"toggleButton"},center:{tooltip:"Align Center",command:"justifycenter",type:"toggleButton"},right:{tooltip:"Align Right",command:"justifyright",type:"toggleButton"},outdent:{tooltip:"Indent Less",command:"outdent",type:"button"},indent:{tooltip:"Indent More",command:"indent",type:"button"},ul:{tooltip:"Insert unordered list",command:"insertunorderedlist",type:"toggleButton"},ol:{tooltip:"Insert ordered list",command:"insertorderedlist",type:"toggleButton"},image:{tooltip:"Insert image",command:"insertimage",type:"button"},link:{tooltip:"Insert link",command:"createlink",type:"toggleButton"},html:{tooltip:"View source",command:"viewsource",type:"toggleButton"},clean:{tooltip:"Remove Formatting",command:"removeformat",type:"button"}},createCommand:null,defaultLocalization:{bold:"Bold",italic:"Italic",underline:"Underline",format:"Format Block",font:"Font Name",size:"Font Size",color:"Text Color",background:"Fill Color",left:"Align Left",center:"Align Center",right:"Align Right",outdent:"Indent Less",indent:"Indent More",ul:"Insert unordered list",ol:"Insert ordered list",image:"Insert image",link:"Insert link",html:"View source",clean:"Remove Formatting",Remove:"Remove",Ok:"Ok",Cancel:"Cancel",Change:"Change","Go to link":"Go to link","Open in a new window/tab":"Open in a new window/tab",Align:"Align",VSpace:"VSpace",HSpace:"HSpace",Width:"Width",Height:"Height",Title:"Title",URL:"URL","Insert Image":"Insert Image","Insert Link":"Insert Link","Alt Text":"Alt Text","not set":"&ltnot set&gt",Left:"Left",Right:"Right",Paragraph:"Paragraph",Header:"Header",Arial:"Arial","Comic Sans MS":"Comic Sans MS","Courier New":"Courier New",Georgia:"Georgia",Impact:"Impact","Lucida Console":"Lucida Console",Tahoma:"Tahoma","Times New Roman":"Times New Roman","Trebuchet MS":"Trebuchet MS",Verdana:"Verdana"},localization:null,tools:"bold italic underline | format font size | color background | left center right | outdent indent | ul ol | image | link | clean | html",readOnly:!1,stylesheets:new Array,rtl:!1,colorPickerTemplate:'<div class="jqx-editor-color-picker"><div role="grid"><table class="jqx-editor-color-picker-table" cellspacing="0" cellpadding="0"><tbody><tr><td aria-label="RGB (0, 0, 0)"><div title="RGB (0, 0, 0)" style="background-color: rgb(0, 0, 0);"></div></td><td aria-label="RGB (68, 68, 68)"><div title="RGB (68, 68, 68)" style="background-color: rgb(68, 68, 68);"></div></td><td aria-label="RGB (102, 102, 102)"><div title="RGB (102, 102, 102)" style="background-color: rgb(102, 102, 102);"></div></td><td aria-label="RGB (153, 153, 153)"><div title="RGB (153, 153, 153)" style="background-color: rgb(153, 153, 153);"></div></td><td aria-label="RGB (204, 204, 204)"><div title="RGB (204, 204, 204)" style="background-color: rgb(204, 204, 204);"></div></td><td aria-label="RGB (238, 238, 238)"><div title="RGB (238, 238, 238)" style="background-color: rgb(238, 238, 238);"></div></td><td aria-label="RGB (243, 243, 243)"><div title="RGB (243, 243, 243)" style="background-color: rgb(243, 243, 243);"></div></td><td aria-label="RGB (255, 255, 255)"><div title="RGB (255, 255, 255)" style="background-color: rgb(255, 255, 255);"></div></td></tr></tbody></table></div><div role="grid"><table class="jqx-editor-color-picker-table" cellspacing="0" cellpadding="0"><tbody><tr><td aria-label="RGB (255, 0, 0)"><div title="RGB (255, 0, 0)" style="background-color: rgb(255, 0, 0);"></div></td><td aria-label="RGB (255, 153, 0)"><div title="RGB (255, 153, 0)" style="background-color: rgb(255, 153, 0);"></div></td><td aria-label="RGB (255, 255, 0)"><div title="RGB (255, 255, 0)" style="background-color: rgb(255, 255, 0);"></div></td><td aria-label="RGB (0, 255, 0)"><div title="RGB (0, 255, 0)" style="background-color: rgb(0, 255, 0);"></div></td><td aria-label="RGB (0, 255, 255)"><div title="RGB (0, 255, 255)" style="background-color: rgb(0, 255, 255);"></div></td><td aria-label="RGB (0, 0, 255)"><div title="RGB (0, 0, 255)" style="background-color: rgb(0, 0, 255);"></div></td><td aria-label="RGB (153, 0, 255)"><div title="RGB (153, 0, 255)" style="background-color: rgb(153, 0, 255);"></div></td><td aria-label="RGB (255, 0, 255)"><div title="RGB (255, 0, 255)" style="background-color: rgb(255, 0, 255);"></div></td></tr></tbody></table></div><div role="grid"><table class="jqx-editor-color-picker-table" cellspacing="0" cellpadding="0"><tbody><tr><td aria-label="RGB (244, 204, 204)"><div title="RGB (244, 204, 204)" style="background-color: rgb(244, 204, 204);"></div></td><td aria-label="RGB (252, 229, 205)"><div title="RGB (252, 229, 205)" style="background-color: rgb(252, 229, 205);"></div></td><td aria-label="RGB (255, 242, 204)"><div title="RGB (255, 242, 204)" style="background-color: rgb(255, 242, 204);"></div></td><td aria-label="RGB (217, 234, 211)"><div title="RGB (217, 234, 211)" style="background-color: rgb(217, 234, 211);"></div></td><td aria-label="RGB (208, 224, 227)"><div title="RGB (208, 224, 227)" style="background-color: rgb(208, 224, 227);"></div></td><td aria-label="RGB (207, 226, 243)"><div title="RGB (207, 226, 243)" style="background-color: rgb(207, 226, 243);"></div></td><td aria-label="RGB (217, 210, 233)"><div title="RGB (217, 210, 233)" style="background-color: rgb(217, 210, 233);"></div></td><td aria-label="RGB (234, 209, 220)"><div title="RGB (234, 209, 220)" style="background-color: rgb(234, 209, 220);"></div></td></tr><tr><td id="T-Kw-Jn88" aria-label="RGB (234, 153, 153)"><div title="RGB (234, 153, 153)" style="background-color: rgb(234, 153, 153);"></div></td><td aria-label="RGB (249, 203, 156)"><div title="RGB (249, 203, 156)" style="background-color: rgb(249, 203, 156);"></div></td><td aria-label="RGB (255, 229, 153)"><div title="RGB (255, 229, 153)" style="background-color: rgb(255, 229, 153);"></div></td><td aria-label="RGB (182, 215, 168)"><div title="RGB (182, 215, 168)" style="background-color: rgb(182, 215, 168);"></div></td><td aria-label="RGB (162, 196, 201)"><div title="RGB (162, 196, 201)" style="background-color: rgb(162, 196, 201);"></div></td><td aria-label="RGB (159, 197, 232)"><div title="RGB (159, 197, 232)" style="background-color: rgb(159, 197, 232);"></div></td><td aria-label="RGB (180, 167, 214)"><div title="RGB (180, 167, 214)" style="background-color: rgb(180, 167, 214);"></div></td><td aria-label="RGB (213, 166, 189)"><div title="RGB (213, 166, 189)" style="background-color: rgb(213, 166, 189);"></div></td></tr><tr><td aria-label="RGB (224, 102, 102)"><div title="RGB (224, 102, 102)" style="background-color: rgb(224, 102, 102);"></div></td><td aria-label="RGB (246, 178, 107)"><div title="RGB (246, 178, 107)" style="background-color: rgb(246, 178, 107);"></div></td><td aria-label="RGB (255, 217, 102)"><div title="RGB (255, 217, 102)" style="background-color: rgb(255, 217, 102);"></div></td><td aria-label="RGB (147, 196, 125)"><div title="RGB (147, 196, 125)" style="background-color: rgb(147, 196, 125);"></div></td><td aria-label="RGB (118, 165, 175)"><div title="RGB (118, 165, 175)" style="background-color: rgb(118, 165, 175);"></div></td><td aria-label="RGB (111, 168, 220)"><div title="RGB (111, 168, 220)" style="background-color: rgb(111, 168, 220);"></div></td><td aria-label="RGB (142, 124, 195)"><div title="RGB (142, 124, 195)" style="background-color: rgb(142, 124, 195);"></div></td><td aria-label="RGB (194, 123, 160)"><div title="RGB (194, 123, 160)" style="background-color: rgb(194, 123, 160);"></div></td></tr><tr><td id="T-Kw-Jn104" aria-label="RGB (204, 0, 0)"><div title="RGB (204, 0, 0)" style="background-color: rgb(204, 0, 0);"></div></td><td aria-label="RGB (230, 145, 56)"><div title="RGB (230, 145, 56)" style="background-color: rgb(230, 145, 56);"></div></td><td aria-label="RGB (241, 194, 50)"><div title="RGB (241, 194, 50)" style="background-color: rgb(241, 194, 50);"></div></td><td aria-label="RGB (106, 168, 79)"><div title="RGB (106, 168, 79)" style="background-color: rgb(106, 168, 79);"></div></td><td aria-label="RGB (69, 129, 142)"><div title="RGB (69, 129, 142)" style="background-color: rgb(69, 129, 142);"></div></td><td aria-label="RGB (61, 133, 198)"><div title="RGB (61, 133, 198)" style="background-color: rgb(61, 133, 198);"></div></td><td aria-label="RGB (103, 78, 167)"><div title="RGB (103, 78, 167)" style="background-color: rgb(103, 78, 167);"></div></td><td aria-label="RGB (166, 77, 121)"><div title="RGB (166, 77, 121)" style="background-color: rgb(166, 77, 121);"></div></td></tr><tr><td aria-label="RGB (153, 0, 0)"><div title="RGB (153, 0, 0)" style="background-color: rgb(153, 0, 0);"></div></td><td aria-label="RGB (180, 95, 6)"><div title="RGB (180, 95, 6)" style="background-color: rgb(180, 95, 6);"></div></td><td aria-label="RGB (191, 144, 0)"><div title="RGB (191, 144, 0)" style="background-color: rgb(191, 144, 0);"></div></td><td aria-label="RGB (56, 118, 29)"><div title="RGB (56, 118, 29)" style="background-color: rgb(56, 118, 29);"></div></td><td aria-label="RGB (19, 79, 92)"><div title="RGB (19, 79, 92)" style="background-color: rgb(19, 79, 92);"></div></td><td aria-label="RGB (11, 83, 148)"><div title="RGB (11, 83, 148)" style="background-color: rgb(11, 83, 148);"></div></td><td aria-label="RGB (53, 28, 117)"><div title="RGB (53, 28, 117)" style="background-color: rgb(53, 28, 117);"></div></td><td aria-label="RGB (116, 27, 71)"><div title="RGB (116, 27, 71)" style="background-color: rgb(116, 27, 71);"></div></td></tr><tr><td aria-label="RGB (102, 0, 0)"><div title="RGB (102, 0, 0)" style="background-color: rgb(102, 0, 0);"></div></td><td aria-label="RGB (120, 63, 4)"><div title="RGB (120, 63, 4)" style="background-color: rgb(120, 63, 4);"></div></td><td aria-label="RGB (127, 96, 0)"><div title="RGB (127, 96, 0)" style="background-color: rgb(127, 96, 0);"></div></td><td aria-label="RGB (39, 78, 19)"><div title="RGB (39, 78, 19)" style="background-color: rgb(39, 78, 19);"></div></td><td aria-label="RGB (12, 52, 61)"><div title="RGB (12, 52, 61)" style="background-color: rgb(12, 52, 61);"></div></td><td aria-label="RGB (7, 55, 99)"><div title="RGB (7, 55, 99)" style="background-color: rgb(7, 55, 99);"></div></td><td aria-label="RGB (32, 18, 77)"><div title="RGB (32, 18, 77)" style="background-color: rgb(32, 18, 77);"></div></td><td aria-label="RGB (76, 17, 48)"><div title="RGB (76, 17, 48)" style="background-color: rgb(76, 17, 48);"></div></td></tr></tbody></table></div></div>',touchMode:!1,keyPressed:null,events:["change"]};return this===T.jqx._jqxEditor.prototype||(T.extend(!0,this,e),this.localization=this.defaultLocalization),e},createInstance:function(e){var n=this;n.textArea=n.host;var t=n.host.attr("contenteditable");if(n.host.addClass(n.toThemeProperty("jqx-widget")),1==t||"true"==t){n.inline=!0,n.widget=n.host,n.editorDocument=document,n.selection=new d(n.editorDocument);var o=T("<div class='jqx-editor-toolbar-container' unselectable='on' aria-label='Formatting options' role='toolbar'><div class='jqx-editor-toolbar'></div>");o.insertBefore(n.host),n.toolbarContainer=o,n.toolbar=o.find(".jqx-editor-toolbar"),n.editor=n.host,n.contentEditableElement=n.element}else{var r=T("<div class='jqx-editor'><div class='jqx-editor-container'><div class='jqx-editor-toolbar-container' aria-label='Formatting options' role='toolbar'><div class='jqx-editor-toolbar'></div></div><div class='jqx-editor-content'><iframe  src='javascript:\"<html></html>\"' allowtransparency='true' frameborder='0'></iframe></div></div></div>");n.widget=r,n.widget[0].className=n.widget[0].className+" "+n.element.className;try{n.widget[0].style=n.element.style}catch(e){}var a=T.trim(n.host.html())+"&#8203;";"default"==n.lineBreak||"div"==n.lineBreak?a="<div>"+a+"</div>":"p"==n.lineBreak&&(a="<p>"+a+"</p>"),a=(a=a.replace(/&lt;/gi,"<")).replace(/&gt;/gi,">"),n.host.css("display","none"),n.host.after(r),r.find("iframe").after(n.host),n.container=r.find(".jqx-editor-container"),n.toolbarContainer=r.find(".jqx-editor-toolbar-container"),n.toolbar=r.find(".jqx-editor-toolbar"),n.iframe=r.find("iframe"),n.content=r.find(".jqx-editor-content");var l=function(){n.editorDocument=n.iframe[0].contentWindow.document,n.selection=new d(n.editorDocument);var e=0;n.addHandler(n.iframe,"load",function(){1<++e&&(n.iframe.off("load"),n.content.find("iframe").remove(),T("<iframe  src='javascript:\"<html></html>\"' allowtransparency='true' frameborder='0'></iframe>").appendTo(n.content),n.iframe=r.find("iframe"),l())}),T.jqx.browser.mozilla||(n.editorDocument.designMode="On"),n.editorDocument.open();var t,o=n.rtl?"direction:rtl;":"",i=T.jqx.browser.msie?"::selection{color: #fff; background: #328EFD;};::-moz-selection{color: #fff; background: #328eD;};::selection:window-inactive {background: #c7c7c7; color: #000;}::-moz-selection:window-inactive {background: #c7c7c7; color: #000;}html{font-size:13px; height:100%;}body{padding-top:1px;margin-top:-1px; padding-right: 1px; overflow-x: hidden;word-wrap: break-word;-webkit-nbsp-mode: space;-webkit-line-break: after-white-space;":"";n.editorDocument.write("<!DOCTYPE html><html><head><meta charset='utf-8' /><style>html,body{padding:0; margin:0; font-size: 13px; font-family: "+n.fontFamily+"; background:#fff; min-height:100%; "+o+"}"+i+"}h1{font-size:2em;margin:.67em 0}h2{font-size: 1.5em; margin: .75em 0}h3{font-size: 1.17em; margin: .83em 0}h4{font-size:1em; margin: 1.12em 0 }h5{font-size: .83em; margin: 1.5em 0}h6{font-size: .75em; margin: 1.67em 0}p{margin: 0px;padding:0 .2em}ul,ol{padding-left:2.5em}a{color:#00a}code{font-size:1.23em}.jqx-editor-paste-element {position: absolute; left: -1000px; height: 1px; overflow: hidden; top: -1000px;}.jqx-editor-focus {border: 1px solid #aaa !important;}</style>"+T.map(n.stylesheets,function(e){return"<link rel='stylesheet' href='"+e+"'>"}).join("")+"</head><body autocorrect='off' contenteditable='true'></body></html>"),n.contentEditableElement=n.editorDocument.body,n.host.is("textarea")?(n._textArea=n.element,(t=n.host.data()).jqxEditor.host=r,t.jqxEditor.element=r[0],n.element=r[0],r[0].id=n._textArea.id,n._textArea.id=n._textArea.id+"TextArea",T(n.element).addClass(n.toThemeProperty("jqx-widget"))):((t=n.host.data()).jqxEditor.host=r,t.jqxEditor.element=r[0],n.element=r[0]),n.host=T(n.element),n.host.data(t);try{n.editorDocument.execCommand("useCSS",!1,!1),n.editorDocument.execCommand("enableInlineTableEditing",null,!1)}catch(e){}try{n.editorDocument.execCommand("styleWithCSS",0,!0)}catch(e){}n.editorDocument.close(),n.editor=T(n.editorDocument.body),n.editor.html(a).attr("spellcheck",!1).attr("autocorrect","off")};l(),T.jqx.utilities.resize(n.host,function(){n.widget.css("width",n.width),n.widget.css("height",n.height),n._arrange()})}},focus:function(){var e=this;T.jqx.browser.mozilla&&(e.focused||(e.iframe&&e.iframe.focus(),e.selection.selectNode(e.editor[0].firstChild,!0),e.selection.getRange().collapse(!0))),e.editor.focus();var t=null!=e.range?e.range:e.getRange();e.selectRange(t)},print:function(){var e=window.open("","_blank","width=450,height=470,left=400,top=100,menubar=yes,toolbar=no,location=no,scrollbars=yes");e.document.open(),e.document.write('<!doctype html><html><head><title>Print</title></head><body onload="print();">'+this.val()+"</body></html>"),e.document.close()},refresh:function(e){var _=this;T.each(this.defaultLocalization,function(e,t){_.localization[e]||(_.localization[e]=t)}),_._removeHandlers(),_.toolbar.addClass(_.toThemeProperty("jqx-widget-header")),_.content?(_.widget.css("width",_.width),_.widget.css("height",_.height),_.widget.addClass(_.toThemeProperty("jqx-editor")),_.widget.addClass(_.toThemeProperty("jqx-widget")),_.widget.addClass(_.toThemeProperty("jqx-rc-all")),_.widget.addClass(_.toThemeProperty("jqx-widget-header")),_.content.addClass(_.toThemeProperty("jqx-widget-content")),_.container.addClass(_.toThemeProperty("jqx-editor-container"))):(_.toolbarContainer.addClass(_.toThemeProperty("jqx-widget-header")),_.toolbarContainer.addClass(_.toThemeProperty("jqx-editor-toolbar-inline")),_.toolbarContainer.addClass(_.toThemeProperty("jqx-widget")),_.toolbarContainer.addClass(_.toThemeProperty("jqx-rc-all")),_.toolbarContainer.hide(),_.toolbarContainer.css("position","absolute"),_.editor.addClass(_.toThemeProperty("jqx-editor-inline")),_.toolbarContainer.css("width",_.host.outerWidth()+"px"));var t=_.toolbarContainer.index();if("top"==_.toolbarPosition&&0!=t||"bottom"==_.toolbarPosition&&1!=t)switch(_.toolbarPosition){case"bottom":_.toolbarContainer.insertAfter(_.content);break;case"top":default:_.toolbarContainer.insertBefore(_.content)}var o=_.tools;if(!1!==o){function i(w,k){T.each(k,function(e,t){var o,u=_.commands[this];if(u){_.createCommand&&(o=_.createCommand(this.toString()),u=T.extend(u,o))}else{if(!_.createCommand)return!0;if(!(u=_.createCommand(this.toString())))return!0;_.commands[this]||(_.commands[this]=u)}switch(_.localization[this]&&(u.tooltip=_.localization[this]),u.type){case"list":u.widget&&u.widget.jqxDropDownList("destroy");var i="formatblock"==u.command||"fontname"==u.command||"fontsize"==u.command,n=u.value||[],r=new Array,a=u.placeHolder||"Please Choose:";"fontname"==u.command?T.each(n,function(){var e=_.localization[this.label];r.push({label:e,value:this.value})}):"formatblock"==u.command?(a=_.localization.format,T.each(n,function(){var e;e=0<=this.label.indexOf("Header")?this.label.replace("Header",_.localization.Header):_.localization[this.label],r.push({label:e,value:this.value})})):r=n;var l={enableBrowserBoundsDetection:!0,touchMode:_.touchMode,width:u.width||100,height:u.height||25,dropDownWidth:u.dropDownWidth||"auto",autoDropDownHeight:(u.value&&u.value.length)<12,placeHolder:a,source:r,theme:_.theme,hint:!1,keyboardSelection:!1,focusable:!1,disabled:_.disabled,rtl:_.rtl,selectionRenderer:"fontsize"==u.command?function(){return"<div unselectable='on' style='margin-top: 0px; padding:0px;' class='"+(_.toThemeProperty("jqx-editor-toolbar-icon")+" "+_.toThemeProperty("jqx-editor-toolbar-icon-"+u.command))+"'></div>"}:null,renderer:i?function(e,t,o){return"formatblock"==u.command?"<"+o+' unselectable="on" style="padding: 0px; margin: 0px;">'+t+"</"+o+">":"fontname"==u.command?'<span unselectable="on" style="font-family: '+o+';">'+t+"<span>":"fontsize"==u.command?'<span unselectable="on" style="font-size: '+o+';">'+t+"<span>":void 0}:null},d="jqx-disableselect "+_.toThemeProperty("jqx-editor-dropdownlist")+" "+_.toThemeProperty("jqx-editor-toolbar-item");(y=T("<div unselectable='on' class='"+d+"'></div>")).appendTo(w),y.jqxDropDownList(l),u.init&&u.init(y);var t=null,s=null,c="";_.addHandler(y,"mousedown",function(e){var t;0<T(".jqx-editor-dropdownpicker").length&&T(".jqx-editor-dropdownpicker").jqxDropDownButton("close"),0<T(".jqx-editor-dropdownlist").length&&(t=T(".jqx-editor-dropdownlist"),T.each(t,function(e,t){t!=y[0]&&T(t).jqxDropDownList("close")}))}),_.addHandler(y,"open",function(e){_.focused||_.focus(),_.updating=!0,_.activeElement=y,t=y.val(),c=""}),_.addHandler(y,"change",function(e){_.updating=!1,_.activeElement=null,s=y.val(),c=e.args.type,T.jqx.browser.msie&&T.jqx.browser.version<9&&_.focus()}),_.addHandler(y,"close",function(e){_.updating=!1,_.activeElement=null,t!=s&&("mouse"!=c&&"keyboard"!=c||_._refreshTools())}),_._addCommandHandler(y,"change",u.command,null,u);break;case"colorPicker":u.widget&&(T(u.colorPicker).remove(),u.widget.jqxDropDownButton("destroy"));var g=T('<div unselectable="on" style="padding-top: 4px;"></div>').attr("id","picker-"+u.command),d="jqx-disableselect "+_.toThemeProperty("jqx-editor-dropdownpicker")+" "+_.toThemeProperty("jqx-editor-toolbar-item");(y=T("<div unselectable='on' class='"+d+"'></div>")).appendTo(w),y.append(g),y.jqxDropDownButton({hint:!1,touchMode:_.touchMode,disabled:_.disabled,enableBrowserBoundsDetection:!0,width:u.width||45,height:u.height||25,rtl:_.rtl,focusable:!1,theme:_.theme});var p=T('<div unselectable="on" style="z-index: 55;">'),h=_.toThemeProperty("jqx-editor-toolbar-icon")+" "+_.toThemeProperty("jqx-editor-toolbar-icon-"+u.command),m=T("<div unselectable='on' class='"+h+"'></div>");p.append(m);var f=T('<div unselectable="on" class="jqx-editor-color-bar">').attr("id","bar-"+u.command).css("background-color",u.value);p.append(f),y.jqxDropDownButton("setContent",p),g.append(T(_.colorPickerTemplate)),u.colorPicker=g,u.init&&u.init(y),g.find("tr").attr("role","row").attr("unselectable","on"),g.find("td").attr("role","gridcell").attr("unselectable","on").css("-webkit-user-select","none"),g.find("div").attr("unselectable","on"),_.addHandler(y,"mousedown",function(e){var t;0<T(".jqx-editor-dropdownlist").length&&T(".jqx-editor-dropdownlist").jqxDropDownList("close"),0<T(".jqx-editor-dropdownpicker").length&&(t=T(".jqx-editor-dropdownpicker"),T.each(t,function(e,t){t!=y[0]&&T(t).jqxDropDownButton("close")}))}),_.addHandler(y,"open",function(){_.focused||_.focus(),_.updating=!0,_.activeElement=g}),_.addHandler(y,"close",function(e){_.updating=!1,_.activeElement=null,t!=s&&("mouse"!=c&&"keyboard"!=c||_._refreshTools())}),_.addHandler(g,"keydown",function(e){var t,o,i=e.keyCode,n=T(g).find(".jqx-editor-color-picker-selected-cell"),r=g.find("tr"),a=r.length,l=n.parent().children().length,d=n.index(),s=-999,c=n.parent();switch(T.each(r,function(e,t){if(this==c[0])return s=e,!1}),i){case 27:y.jqxDropDownButton("close");break;case 13:T(n).trigger("mousedown");break;case 38:s--;break;case 40:s++;break;case 39:d++;break;case 37:d--}0<=s&&s<=a&&0<=d&&d<=l&&(c=g.find("tr")[s],t=T(c).children()[d],o=T(t).children().css("background-color"),u.val(o))});var b=T(g).find("td");u.val=function(e){var t=_._rgbToHex(e);T.each(b,function(){var e=T(this).children().css("background-color");if(_._rgbToHex(e)==t)return b.removeClass("jqx-editor-color-picker-selected-cell"),T(this).addClass("jqx-editor-color-picker-selected-cell"),T("#bar-"+u.command).css("background",e),!1})},u.val(u.value),_._addCommandHandler(b,"mousedown",u.command,null,u);break;case"button":case"toggleButton":default:u.widget&&("button"==u.type?u.widget.jqxButton("destroy"):u.widget.jqxToggleButton("destroy"));var v=u.command,x=u.action,h=_.toThemeProperty("jqx-editor-toolbar-icon")+" "+_.toThemeProperty("jqx-editor-toolbar-icon-"+v),m=T("<div unselectable='on' class='"+h+"'></div>"),y=T("<div unselectable='on'></div>").addClass("jqx-disableselect").addClass(_.toThemeProperty("jqx-editor-toolbar-button"));(!u.init||v)&&y.append(m),y.appendTo(w),"button"==u.type?y.jqxButton({disabled:_.disabled,rtl:_.rtl,theme:_.theme}):"toggleButton"==u.type&&y.jqxToggleButton({disabled:_.disabled,rtl:_.rtl,uiToggle:!1,theme:_.theme}),u.init&&u.init(y),u.toggled=!1,u.toggle=function(){u.toggled=!u.toggled},_.addHandler(y,"mousedown",function(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}),T.jqx.mobile.isTouchDevice()?_._addCommandHandler(y,"mousedown",v,x,u):_._addCommandHandler(y,"click",v,x,u)}if(u.widget=y){try{""!=u.tooltip&&(u.widget.attr("title",u.tooltip),u.widget.attr("data-tooltip",u.tooltip)),u.command&&u.widget.attr("data-command",u.command),u.widget.attr("aria-label",u.tooltip)}catch(e){}"button"!=u.type&&"toggleButton"!=u.type||(2<k.length&&(0==e?(y.css("border-right-radius","0px"),y.addClass(_.toThemeProperty("jqx-rc-l"))):e==k.length-1&&(y.css("border-left-radius","0px"),y.addClass(_.toThemeProperty("jqx-rc-r"))),y.removeClass(_.toThemeProperty("jqx-rc-all"))),0!=e&&e!=k.length-1&&2<k.length?(y.css("border-left-radius","0px"),y.css("border-right-radius","0px"),y.removeClass(_.toThemeProperty("jqx-rc-all"))):2==k.length?(0==e?(y.css("border-right-radius","0px"),y.addClass(_.toThemeProperty("jqx-rc-l"))):(y.css("border-left-radius","0px"),y.addClass(_.toThemeProperty("jqx-rc-r"))),y.removeClass(_.toThemeProperty("jqx-rc-all"))):1==k.length&&y.css("margin-right","0px"))}})}var n=o.split(" "),r=o.split(" | ");if(_.toolbar.css("direction",this.rtl?"rtl":"ltr"),0==r.length)i(_.toolbar,n);else{for(var a=0;a<r.length;a++){var n=r[a].split(" "),l=_.toThemeProperty("jqx-editor-toolbar-group")+" "+_.toThemeProperty("jqx-fill-state-normal"),d=T("<div class='"+l+"'></div>");d.addClass(_.toThemeProperty("jqx-rc-all")),_.toolbar.append(d),i(d,n)}for(var s=_.toolbar.find(".jqx-editor-toolbar-group"),c=s.length,a=0;a<c;a++)0==T(s[a]).children().length&&T(s[a]).remove()}T.jqx.browser.msie&&T.jqx.browser.version<8&&(T(".jqx-editor-toolbar-group").css("float","left"),T(".jqx-editor-toolbar-group").children().css("float","left"),T(".jqx-editor-toolbar-group").css("zoom","1"),T(".jqx-editor-toolbar-group").children().css("zoom","1"))}_._arrange(),_._addHandlers()},_arrange:function(){var e=this;e.content&&(""==e.tools||0==e.tools?(e.content.height(e.container.outerHeight()-parseInt(e.container.css("padding-top"))-parseInt(e.container.css("padding-bottom"))-6),e.content.css("margin-top","4px"),e.toolbar.hide()):(e.toolbar.show(),e.content.css("margin-top","0px"),e.content.height(e.container.outerHeight()-e.toolbar.outerHeight()-parseInt(e.container.css("padding-top"))-parseInt(e.container.css("padding-bottom"))-2),"top"!=e.toolbarPosition&&(e.content.css("margin-top","4px"),e.content.css("margin-bottom","0px"))),T.jqx.browser.msie&&T.jqx.browser.version<8&&(e.content.css("margin-top","4px"),e.content.height(e.container.height()-e.toolbar.outerHeight()-2*parseInt(e.container.css("padding-bottom"))-10),e.content.width(e.container.width()-2*parseInt(e.container.css("padding-left"))-2)),e.editor.height()<e.content.height()&&e.editor.height(e.content.height()))},propertyChangedHandler:function(e,t,o,i){null!=e.isInitialized&&0!=e.isInitialized&&"pasteMode"!=t&&"lineBreak"!=t&&"editable"!=t&&("disabled"==t&&e._refreshTools(),"width"!=t&&"height"!=t&&"toolbarPosition"!=t?("theme"==t&&T.jqx.utilities.setTheme(o,i,e.host),e.refresh()):e._arrange())},selectRange:function(e){e=e||this.getRange(),this.selection.selectRange(e)},getRange:function(){return this.selection.getRange()},getSelectedElement:function(){try{if(this.editorDocument.getSelection){var e,t=this.editorDocument.getSelection(),o=(e=t.getRangeAt(t.rangeCount-1)).startContainer,i=e.endContainer,n=e.commonAncestorContainer;return"#text"==o.nodeName&&(n=n.parentNode),"#text"==o.nodeName&&(o=o.parentNode),"body"==o.nodeName.toLowerCase()&&(o=o.firstChild),"#text"==i.nodeName&&(i=i.parentNode),"body"==i.nodeName.toLowerCase()&&(i=i.lastChild),o==i&&(n=o),i}if(this.editorDocument.selection){if(!(e=this.editorDocument.selection.createRange()).duplicate)return null;n=e.parentElement();var r=e.duplicate(),a=e.duplicate();return r.collapse(!0),a.moveToElementText(r.parentElement()),a.setEndPoint("EndToStart",r),o=r.parentElement(),r=e.duplicate(),(a=e.duplicate()).collapse(!1),r.moveToElementText(a.parentElement()),r.setEndPoint("StartToEnd",a),i=a.parentElement(),"body"==o.nodeName.toLowerCase()&&(o=o.firstChild),"body"==i.nodeName.toLowerCase()&&(i=i.lastChild),o==i&&(n=o),i}}catch(e){return null}return null},_addHandlers:function(){var g=this;g.addHandler(g.toolbar,"mousedown.editor"+g.element.id,function(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1});function t(){if(g._textArea&&(g.updating||(g._textArea.value=g.val())),g.changed&&(g._raiseEvent("change"),g.changed=!1),g.focused=!1,g.inline){if(g.host.removeClass(g.toThemeProperty("jqx-fill-state-focus")),g.host.removeClass(g.toThemeProperty("jqx-editor-inline-focus")),""==g.tools||null==g.tools)return;g.toolbarContainer.fadeOut("fast")}}function u(){if(g.focused=!0,g.inline){if(g.host.addClass(g.toThemeProperty("jqx-fill-state-focus")),g.host.addClass(g.toThemeProperty("jqx-editor-inline-focus")),g.host.addClass(g.toThemeProperty("jqx-rc-all")),""==g.tools||null==g.tools)return;g.toolbarContainer.fadeIn("fast");var e=g.host.coord();"bottom"!=g.toolbarPosition?g.toolbarContainer.offset({left:e.left,top:e.top-g.toolbarContainer.outerHeight()-5}):g.toolbarContainer.offset({left:e.left,top:e.top+5+g.host.height()})}}T.jqx.browser.mozilla&&this.addHandler(T(document),"mousedown.editor"+g.element.id,function(e){t()}),g.addHandler(g.editor,"blur.editor"+g.element.id,function(e){t()}),g.addHandler(g.editor,"focus.editor"+g.element.id,function(e){u()}),g.addHandler(g.editor,"beforedeactivate.editor"+g.element.id,function(e){g.range=g.getRange()}),g.addHandler(g.editor,"mousedown.editor"+g.element.id,function(e){e.target.href||g.linkPopup&&g.linkPopup.remove(),g.range=g.getRange(),T.jqx.browser.mozilla&&(u(),e.stopPropagation()),0<T(".jqx-editor-dropdownpicker").length&&T(".jqx-editor-dropdownpicker").jqxDropDownButton("close"),0<T(".jqx-editor-dropdownlist").length&&T(".jqx-editor-dropdownlist").jqxDropDownList("close"),g.inline&&g.editor.focus()}),T.jqx.mobile.isTouchDevice()&&(g.addHandler(T(g.editorDocument),"selectionchange.editor"+g.element.id,function(){g.editorDocument.activeElement!=g.editor[0]&&setTimeout(function(){g.iframe&&g.iframe[0].contentWindow.focus()},500)}),g.addHandler(T(g.editorDocument),"touchstart.editor"+g.element.id,function(){setTimeout(function(){g.iframe&&g.iframe[0].contentWindow.focus()},500)})),g.addHandler(g.editor,"mouseup.editor"+g.element.id,function(e){if("source"==g._documentMode)return!0;g.range=g.getRange(),g._refreshTools(null,!0)}),g.addHandler(g.editor,"keydown.editor"+g.element.id,function(e){if(g.keyPressed&&g.keyPressed(e),"source"==g._documentMode)return!0;if(T.jqx.browser.mozilla&&(g.focused||u()),g.changeType="keyboard",g.disabled)return e.preventDefault&&e.preventDefault(),!1;var t;if(g.updating)return g.activeElement&&(t=T.Event("keydown"),T.extend(t,e),g.activeElement.trigger(t)),e.preventDefault&&e.preventDefault(),!1;var o,i=e||window.event,n=i.keyCode,r=String.fromCharCode(n).toLowerCase();if(g.editable||(o=[9,33,34,35,36,37,38,39,40,40,45],-1!=T.inArray(i.keyCode,o)||i.ctrlKey&&"c"==r||i.ctrlKey&&"a"==r||e.preventDefault()),(0<g.selection.getText().length||g.linkPopup)&&(o=[8,9,13,33,34,35,36,37,38,39,40,40,45,46],-1==!T.inArray(i.keyCode,o)&&(65!=i.keyCode||!i.ctrlKey||i.altKey||i.shiftKey)||(g._refreshToolsTimer&&clearTimeout(g._refreshToolsTimer),g._refreshToolsTimer=setTimeout(function(){g._refreshTools(null,!0,i.keyCode)},10))),13==n&&"default"!=g.lineBreak){var a=g.getSelectedElement();if(a){switch(a.nodeName.toLowerCase()){case"pre":case"li":case"ul":case"ol":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return!0}for(var l=a;null!=l;){if("#document"==l.nodeName){l=g.editorDocument.body;break}if(l.parentNode==g.editorDocument.body||l==g.editorDocument.body)break;l=l.parentNode}}if(l){var d=g.getRange();"<div></div>"==g.editorDocument.body.innerHTML&&"br"!=g.lineBreak&&g.selection.insertContent("&#8203;"),"div"==g.lineBreak?l==g.editorDocument.body?T(l).append("<div>&#8203;</div><span id='INSERTION_MARKER'>&nbsp;</span>"):T("<div>&#8203;</div><span id='INSERTION_MARKER'>&nbsp;</span>").insertAfter(l):"p"==g.lineBreak?l==g.editorDocument.body?T(l).append("<p>&#8203;</p><span id='INSERTION_MARKER'>&nbsp;</span>"):T("<p>&#8203;</p><span id='INSERTION_MARKER'>&nbsp;</span>").insertAfter(l):g.execute("insertHTML","<br/>&#8203;<span id='INSERTION_MARKER'>&nbsp;</span>"),g.selectRange(d);var s=T(g.editorDocument).find("#INSERTION_MARKER");return"br"!=g.lineBreak?g.selection.selectNode(T(s).prev()[0],!0):(g.selection.selectNode(s[0],!0),g.getRange().setStartAfter&&g.getRange().setStartAfter(s[0])),s.remove(),g.selection.collapse(!1),l&&l.nodeName&&"br"==g.lineBreak&&"#text"!=l.nodeName.toLowerCase()&&(g.selection.selectNode(l,!0),g.getRange().setStartAfter&&g.getRange().setStartAfter(l),g.selection.collapse(!1)),"br"!=g.lineBreak&&(d=g.getRange()).select&&d.select(),e.preventDefault&&e.preventDefault(),!1}}if(i.ctrlKey&&("k"==r||"u"==r||"b"==r||"i"==r)){e.preventDefault&&e.preventDefault();var c=null;switch(r){case"k":c="link";break;case"u":c="underline";break;case"b":c="bold";break;case"i":c="italic"}return g.commands[c].widget&&g.commands[c].widget.trigger("click"),!1}}),g.addHandler(g.editor,"paste.editor"+g.element.id,function(e){if("source"==g._documentMode)return!0;if(g.readOnly)return!0;g.updating=!0,g.readOnly=!0;try{var u=g.getRange();"text"!=g.pasteMode||T.jqx.browser.mozilla?g.selection.insertContent('<div class="jqx-editor-paste-element">&nbsp;</div>'):g.selection.insertContent('<textarea cols="50" contenteditable="false" class="jqx-editor-paste-element"></textarea>');var t,o,i=T(window).scrollTop(),n=T(g.editorDocument).find(".jqx-editor-paste-element");n.css("top",i+"px"),g.editor[0].createTextRange?(e.preventDefault(),(t=g.editor[0].createTextRange()).moveToElementText(n[0]),t.execCommand("Paste")):((o=g.editorDocument.createRange()).selectNodeContents(n[0]),g.selectRange(o)),"text"!=g.pasteMode||T.jqx.browser.mozilla||n.select(),g.marker=n,setTimeout(function(){g.selectRange(u);function e(e){var t=g.editorDocument.createElement("div"),o=g.editorDocument.createDocumentFragment();for(t.innerHTML=e;t.firstChild;)o.appendChild(t.firstChild);return o}if("text"!=g.pasteMode){var t=e(g.marker.html());if(t.firstChild&&"jqx-editor-paste-element"===t.firstChild.className){for(var o=[],i=0,n=t.childNodes.length;i<n;i++)o.push(t.childNodes[i].innerHTML);t=e(o.join("<br />"))}var r=document.createElement("div");r.appendChild(t.cloneNode(!0));var a=r.innerHTML}else{a=g.marker.val();""!=g.marker.html()&&-1==g.marker.val().indexOf("\n")&&(a=(a=(a=(a=(a=(a=g.marker.html()).replace(/&nbsp;/gm,"")).replace(/\n\n/gm,"\n")).replace(/<br[^>]*>/gi,"\n")).replace(/<li[^>]*>/gi,"\n")).replace(/<p[^>]*>/gi,"\n"),g.marker.html(a),a=g.marker.text())}var l,d,s=(l=a,d="text"==g.pasteMode,l=d?g.paragraphise?(l=(l="<p>"+l+"</p>").replace(/\n/g,"</p><p>")).replace(/<p>\s<\/p>/gi,""):l.replace(/\n/g,"<br />"):((l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=l.replace(/<html[^>]*?>(.*)/gim,"$1")).replace(/<\/html>/gi,"")).replace(/<body[^>]*?>(.*)/gi,"$1")).replace(/<\/body>/gi,"")).replace(/<style[^>]*?>[\s\S]*?<\/style[^>]*>/gi,"")).replace(/<(?:meta|link)[^>]*>\s*/gi,"")).replace(/<\\?\?xml[^>]*>/gi,"")).replace(/<w:[^>]*>[\s\S]*?<\/w:[^>]*>/gi,"")).replace(/<o:p>\s*<\/o:p>/g,"")).replace(/<o:p>[\s\S]*?<\/o:p>/g,"&nbsp;")).replace(/<\/?\w+:[^>]*>/gi,"")).replace(/<\!--[\s\S]*?-->/g,"")).replace(/<\!\[[\s\S]*?\]>/g,"")).replace(/\s*mso-[^:]+:[^;"']+;?/gi,"")).replace(/<(\w[^>]*) style='([^\']*)'([^>]*)/gim,"<$1$3")).replace(/<(\w[^>]*) style="([^\"]*)"([^>]*)/gim,"<$1$3")).replace(/\s*margin: 0cm 0cm 0pt\s*;/gi,"")).replace(/\s*margin: 0cm 0cm 0pt\s*"/gi,'"')).replace(/\s*text-indent: 0cm\s*;/gi,"")).replace(/\s*text-indent: 0cm\s*"/gi,'"')).replace(/\s*text-align: [^\s;]+;?"/gi,'"')).replace(/\s*page-break-before: [^\s;]+;?"/gi,'"')).replace(/\s*font-variant: [^\s;]+;?"/gi,'"')).replace(/\s*tab-stops:[^;"']*;?/gi,"")).replace(/\s*tab-stops:[^"']*/gi,"")).replace(/\s*face="[^"']*"/gi,"")).replace(/\s*face=[^ >]*/gi,"")).replace(/\s*font-family:[^;"']*;?/gi,"")).replace(/\s*font-size:[^;"']*;?/gi,"")).replace(/<(\w[^>]*) class=([^ |>]*)([^>]*)/gi,"<$1$3")).replace(/<(\w+)[^>]*\sstyle="[^"']*display\s?:\s?none[\s \S]*?<\/\1>/gi,"")).replace(/\s*style='\s*'/gi,"")).replace(/\s*style="\s*"/gi,"")).replace(/<span\s*[^>]*>\s*&nbsp;\s*<\/span>/gi,"&nbsp;")).replace(/<span\s*[^>]*><\/span>/gi,"")).replace(/<(\w[^>]*) align=([^ |>]*)([^>]*)/gi,"<$1$3")).replace(/<(\w[^>]*) lang=([^ |>]*)([^>]*)/gi,"<$1$3")).replace(/<span([^>]*)>([\s\S]*?)<\/span>/gi,"$2")).replace(/<font\s*>([\s\S]*?)<\/font>/gi,"$1")).replace(/<(u|i|strike)>&nbsp;<\/\1>/gi,"&nbsp;")).replace(/<h\d>\s*<\/h\d>/gi,"")).replace(/<(\w[^>]*) language=([^ |>]*)([^>]*)/gi,"<$1$3")).replace(/<(\w[^>]*) onmouseover="([^\"']*)"([^>]*)/gi,"<$1$3")).replace(/<(\w[^>]*) onmouseout="([^\"']*)"([^>]*)/gi,"<$1$3")).replace(/<h(\d)([^>]*)>/gi,"<h$1>")).replace(/<(h\d)><font[^>]*>([\s\S]*?)<\/font><\/\1>/gi,"<$1>$2</$1>")).replace(/<(h\d)><em>([\s\S]*?)<\/em><\/\1>/gi,"<$1>$2</$1>")).replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>")).replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>")).replace(/<\s+[^>]*>/gi,"")).replace(/<span>([\s\S]*?)<\/span>/gi,"$1")).replace(/<span>([\s\S]*?)<\/span>/gi,"$1")).replace(/<div>([\s\S]*?)<\/div>/gi,"$1")).replace(/<div>([\s\S]*?)<\/div>/gi,"$1")).replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"")).replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"")).replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"")).trim&&(l=l.trim()),g.paragraphise?"<p"!==l.substr(0,2)&&(l=(l=(l="<p>"+l+"</p>").replace(/\n/g,"</p><p>")).replace(/<br[^>]*>/gi,"</p><p>")):(l.replace(/<p>/gi,"<br />"),l.replace(/<\/p>/gi,"")),(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=(l=l.replace(/<br>/gi,"<br />")).replace(/<br[^>]*><\/p>/gim,"</p>")).replace(/<p>&nbsp;<\/p>/gi,"")).replace(/<p>\s<\/p>/gi,"")).replace(/<([^\s>]+)(\s[^>]*)?>\s*<\/\1>/g,"")).replace(/MsoNormal/gi,"")).replace(/<\/?meta[^>]*>/gi,"")).replace(/<\/?xml[^>]*>/gi,"")).replace(/<\?xml[^>]*\/>/gi,"")).replace(/<!--(.*)-->/gi,"")).replace(/<!--(.*)>/gi,"")).replace(/<!(.*)-->/gi,"")).replace(/<w:[^>]*>(.*)<\/w:[^>]*>/gi,"")).replace(/<w:[^>]*\/>/gi,"")).replace(/<\/?w:[^>]*>/gi,"")).replace(/<m:[^>]*\/>/gi,"")).replace(/<m:[^>]>(.*)<\/m:[^>]*>/gi,"")).replace(/<o:[^>]*>(.*)<\/o:[^>]*>/gi,"")).replace(/<o:[^>]*\/>/gi,"")).replace(/<\/?m:[^>]*>/gi,"")).replace(/style=\"([^>]*)\"/gi,"")).replace(/style=\'([^>]*)\'/gi,"")).replace(/class=\"(.*)\"/gi,"")).replace(/class=\'(.*)\'/gi,"")).replace(/<b>/gi,"<strong>")).replace(/<\/b>/gi,"</strong>")).replace(/<p[^>]*>/gi,"<p>")).replace(/<\/p[^>]*>/gi,"</p>")).replace(/<span[^>]*>/gi,"")).replace(/<\/span[^>]*>/gi,"")).replace(/<st1:[^>]*>/gi,"")).replace(/<\/st1:[^>]*>/gi,"")).replace(/<font[^>]*>/gi,"")).replace(/<\/font[^>]*>/gi,"")).replace("  ","")).replace(/<strong><\/strong>/gi,"")).replace(/<p><\/p>/gi,"")).replace(/\/\*(.*)\*\//gi,"")).replace(/<!--/gi,"")).replace(/-->/gi,"")).replace(/<style[^>]*>[^<]*<\/style[^>]*>/gi,"")).trim()));g.getRange();g.selection.insertContent(s+"<span id='INSERTION_MARKER'>&nbsp;</span>"),g.marker.remove();var c=T(g.editorDocument).find("#INSERTION_MARKER");g.selection.selectNode(c[0],!0),g.getRange().setStartAfter&&g.getRange().setStartAfter(c[0]),c.remove(),g.selection.collapse(!1),c.removeAttr("id"),g._refreshTools(),g.changed=!0},100),g.updating=!1,g.readOnly=!1}catch(e){console&&console.log(e)}}),g.addHandler(g.editor,"keyup.editor"+g.element.id,function(e){if("source"==g._documentMode)return!0;if(g.updating||g.disabled||!g.editable)return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1;g.range=g.getRange(),g.changed=!0;var t=e||window.event;t.keyCode;-1==T.inArray(t.keyCode,[8,9,13,33,34,35,36,37,38,39,40,40,45,46])&&(65!=t.keyCode||!t.ctrlKey||t.altKey||t.shiftKey)||g._refreshTools(null,!0,t.keyCode)}),g.addHandler(g.editor,"click.editor"+g.element.id,function(e){if("source"==g._documentMode)return!0;var t;g.editImage&&(T(g.editImage).removeClass("jqx-editor-focus"),g.editImage=null),"img"==e.target.tagName.toLowerCase()&&(t=e.target,g.editImage=t,T(g.editImage).addClass("jqx-editor-focus"))}),g.addHandler(g.editor,"dblclick.editor"+g.element.id,function(e){if("source"==g._documentMode)return!0;var t;"img"==e.target.tagName.toLowerCase()&&(t=e.target,0<T("#imageWindow"+this.element.id).length&&(g.editImage=t,g._updateImageWindow()))})},_updateLinkWindow:function(){var e=this,t=T("#linkWindow"+this.element.id);t.jqxWindow({position:{center:e.widget}}),t.jqxWindow("open");var o,i=t.find("input"),n=t.find(".jqx-editor-link-checkbox"),r=t.find("button:first"),a=T(t.find("button")[1]);e.editLink&&e.editLink.href?(i[0].value=e.editLink.href||"",i[1].value=T(e.editLink).text()||e.editLink.href,n.val("_blank"==T(e.editLink).attr("target")),a.show()):(i[0].value="",i[1].value="",e.selection.isCollapsed()||((o=e.selection.getText()).match(/^(?!:\/\/)([a-zA-Z0-9]+\.)?[a-zA-Z0-9][a-zA-Z0-9-]+\.[a-zA-Z]{2,6}?$/i)?i[0].value=o:i[1].value=o),n.val(!1),a.hide()),0<i[0].value.length?r.jqxButton({disabled:!1}):r.jqxButton({disabled:!0})},_updateImageWindow:function(){var e=(e=this.editImage)||T("<img>")[0],t=T("#imageWindow"+this.element.id);t.jqxWindow({position:{center:this.widget}}),t.jqxWindow("open");var o=t.find("input"),i=T(t.find("button")[1]);this.editImage?i.show():i.hide(),o[0].value=e.src,""==o[0].value&&(o[0].value=""),o[1].value=e.alt,"auto"!=e.style.width?o[2].value=e.style.width:o[2].value="","auto"!=e.style.height?o[3].value=e.style.height:o[3].value="",e.style.marginLeft&&"0px"!=e.style.marginLeft?o[4].value=e.style.marginLeft:o[4].value="",e.style.marginTop&&"0px"!=e.style.marginTop?o[5].value=e.style.marginTop:o[5].value="";var n=t.find(".jqx-editor-align"),r=T(e).css("float");"left"==r?n.jqxDropDownList({selectedIndex:1}):"right"==r?n.jqxDropDownList({selectedIndex:2}):n.jqxDropDownList({selectedIndex:0})},_removeHandlers:function(){var e=this;e.editor&&(e.removeHandler(e.editor,"paste.editor"+e.element.id),e.removeHandler(e.editor,"blur.editor"+e.element.id),e.removeHandler(e.editor,"focus.editor"+e.element.id),e.removeHandler(e.editor,"click.editor"+e.element.id),e.removeHandler(e.editor,"mousedown.editor"+e.element.id),e.removeHandler(e.editor,"mouseup.editor"+e.element.id),e.removeHandler(e.editor,"keyup.editor"+e.element.id),e.removeHandler(e.editor,"keydown.editor"+e.element.id),e.removeHandler(e.editor,"beforedeactivate.editor"+e.element.id),e.removeHandler(e.editor,"dblclick.editor"+e.element.id)),e.toolbar&&e.removeHandler(e.toolbar,"mousedown.editor"+e.element.id)},getParentByTag:function(e,t){var t=t.toLowerCase(),o=e;do{if(""==t||o.nodeName.toLowerCase()==t)return o}while(o=o.parentNode);return e},isStyleProperty:function(e,t,o,i){var t=t.toLowerCase(),n=e;do{if(n.nodeName.toLowerCase()==t&&n.style[o]==i)return!0}while(n=n.parentNode);return!1},setStyleProperty:function(e,t){this.style[t]=!1;var o=this.getParentByTag(e,t);o&&o.tagName.toLowerCase()==t&&(this.style[t]=!0),"del"==t&&this.getParentByTag(e,"strike")&&"strike"==this.getParentByTag(e,"strike").tagName.toLowerCase()&&(this.style.del=!0)},updateStyle:function(e){var t,o,i=this;if((e=i.getSelectedElement()?i.getSelectedElement():e)&&i.setStyleProperty)try{window.getComputedStyle?("#text"==e.nodeName.toLowerCase()&&(e=i.editor[0]),t=401==(o=window.getComputedStyle(e,null)).getPropertyValue("font-weight")?700:o.getPropertyValue("font-weight"),i.style={fontStyle:o.getPropertyValue("font-style"),fontSize:o.getPropertyValue("font-size"),textDecoration:o.getPropertyValue("text-decoration"),fontWeight:t,fontFamily:o.getPropertyValue("font-family"),textAlign:o.getPropertyValue("text-align"),color:i._rgbToHex(o.color),backColor:i._rgbToHex(o.backgroundColor)},i.style.fontStyle=o.getPropertyValue("font-style"),i.style.vAlign=o.getPropertyValue("vertical-align"),i.style.del=i.isStyleProperty(e,"span","textDecoration","line-through"),i.style.u=i.isStyleProperty(e,"span","textDecoration","underline"),i.style.backColor||(i.style.backColor=i._rgbToHex(function(e){for(var t="transparent";e&&(window.getComputedStyle(e).backgroundColor==t||"rgba(0, 0, 0, 0)"==window.getComputedStyle(e).backgroundColor);)e=e.parentNode;return e?window.getComputedStyle(e).backgroundColor:t}(e)))):(o=e.currentStyle,i.style={fontStyle:o.fontStyle,fontSize:o.fontSize,textDecoration:o.textDecoration,fontWeight:o.fontWeight,fontFamily:o.fontFamily,textAlign:o.textAlign,color:i._rgbToHex(o.color),backColor:i._rgbToHex(o.backgroundColor)}),i.setStyleProperty(e,"h1"),i.setStyleProperty(e,"h2"),i.setStyleProperty(e,"h3"),i.setStyleProperty(e,"h4"),i.setStyleProperty(e,"h5"),i.setStyleProperty(e,"h6"),i.setStyleProperty(e,"del"),i.setStyleProperty(e,"sub"),i.setStyleProperty(e,"sup"),i.setStyleProperty(e,"u"),"a"==e.nodeName.toLowerCase()&&"underline"==i.style.textDecoration&&(i.style.u=!0),(i.style.h1||i.style.h2||i.style.h3||i.style.h4||i.style.h5||i.style.h6)&&(i.style.heading=!0)}catch(e){return null}},_refreshTools:function(x,y,e){var w=this;if(!w.updating&&((x=w.getSelectedElement()?w.getSelectedElement():x)&&w.setStyleProperty)){w.updateStyle(x);var t=w.readOnly;if(!(w.readOnly=!0)!==w.tools){function o(e){T.each(e,function(e,t){var o=w.commands[this];if(!o)return!0;switch(o.type){case"list":o.widget.jqxDropDownList("clearSelection"),o.widget.jqxDropDownList({disabled:w.disabled});break;case"colorPicker":o.val(o.value),o.widget.jqxDropDownButton({disabled:w.disabled});break;case"toggleButton":o.widget.jqxToggleButton("unCheck"),o.widget.jqxToggleButton({disabled:w.disabled});break;case"button":default:o.widget.jqxButton({disabled:w.disabled})}})}var i=w.tools.split(" "),n=w.tools.split(" | ");if(0==n.length)o(i);else for(var r=0;r<n.length;r++){o(i=n[r].split(" "))}if(w.style){function a(e){T.each(e,function(e,t){var o,i=w.commands[this];if(!i)return!0;if(i.refresh)return i.refresh(i.widget,w.style),!0;switch(i.type){case"list":if("fontname"==i.command){for(var n=-1,r=999,a=0;a<i.value.length;a++){var t=i.value[a].label.toLowerCase(),l=w.style.fontFamily.toLowerCase().indexOf(t);0<=l&&(l<r&&(n=a),r=Math.min(r,l))}i.widget.jqxDropDownList("selectIndex",n)}else if("formatblock"==i.command){t=null;w.style.h1?t="h1":w.style.h2?t="h2":w.style.h3?t="h3":w.style.h4?t="h4":w.style.h5?t="h5":w.style.h6&&(t="h6"),i.widget.jqxDropDownList("selectItem",t)}else if("fontsize"==i.command){var d="xx-small,x-small,small,medium,large,x-large,xx-large".split(","),s=-1;try{-1==(s=x.getAttribute("size")-1)&&(s=w.editorDocument.queryCommandValue(i.command)-1)}catch(e){}var c=d[s];i.widget.val(c)}break;case"colorPicker":var u="number"!=typeof(o=w.editorDocument.queryCommandValue(i.command))?o:"rgb("+(255&o)+", "+((65280&o)>>8)+", "+((16711680&o)>>16)+")";"backcolor"==i.command&&null==w.style.backColor&&(u="#FFFFFF");var g=w._rgbToHex(u);g?i.val(g):"forecolor"==i.command?i.val(w.style.color):"backcolor"==i.command&&i.val(w.style.backColor);break;case"toggleButton":if("viewsource"==i.command)return;if(!i.command)return;var p,h,m,f=!1,b=w.editorDocument.queryCommandState(i.command)&&w.editorDocument.queryCommandEnabled(i.command);"createlink"==i.command&&"a"==x.nodeName.toLowerCase()&&(p=!0,-1==T(x).text().indexOf(w.selection.getText())&&""!=w.selection.getText()&&(p=!1),p&&(w.linkPopup&&w.linkPopup.remove(),b=!0,w.linkPopup=T("<div class='jqx-editor-link-popup' contentEditable='false' style='overflow: hidden; white-space: nowrap; padding: 5px; height: 17px; font-size: 12px; color: #222222; background: #F5F5F5; position: absolute; z-index: 9999;'>"+w.localization["Go to link"]+": <a target='_blank' style='color:#222222;' href='"+x.href+"'>"+x.href+"</a> - <a style='color:#222222;' href='#change'>"+w.localization.Change+"</a> - <a style='color:#222222;' href='#remove'>"+w.localization.Remove+"</a></div>").appendTo(w.editor),m=(h=T(x).coord()).left,h.left+w.linkPopup.width()>w.editor.width()&&(m=w.editor.width()-w.linkPopup.width()-15),w.linkPopup.offset({top:T(x).height()+h.top+5,left:m}),w.addHandler(w.linkPopup,"mousedown",function(e){if(e.target&&e.target.href)switch(T(e.target).index()){case 1:w.editor.focus(),w.selection.selectNode(x,!0),w.commands.link.widget.trigger("click");break;case 2:try{w.editor.focus(),w.selection.selectNode(x),w.execute("unlink"),w.commands.underline.toggled=!1,w.selection.collapse(!1),w._refreshTools()}catch(e){}break;default:window.open(e.target.href,"_blank")}return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}))),"bold"==i.command?(w.style.fontWeight&&(600<=w.style.fontWeight||"bold"==w.style.fontWeight)&&(f=!0),w.selection.isCollapsed()?i.toggled=b:i.toggled=b||f,b=i.toggled):"italic"==i.command?(w.style.fontStyle&&"italic"==w.style.fontStyle&&(f=!0),y?i.toggled=b:b=i.toggled):"underline"==i.command?(w.style.u&&(f=!0),y?i.toggled=b:b=i.toggled):"justifyleft"==i.command?"left"==w.style.textAlign&&(f=!0):"justifyright"==i.command?"right"==w.style.textAlign&&(f=!0):"justifycenter"==i.command?"center"==w.style.textAlign&&(f=!0):"justifyfull"==i.command?"justify"==w.style.textAlign&&(f=!0):T.each(w.style,function(e,t){i.command==e.toLowerCase()&&(f=!0)});var v=b;(f&&-1!=i.command.indexOf("justify")||v||f&&!1===w.range.collapsed||T.jqx.browser.msie&&T.jqx.browser.version<9&&f&&!w.selection.isCollapsed())&&i.widget.jqxToggleButton("check");break;case"button":default:i.refresh&&i.refresh(i.widget,w.style)}})}if(0==n.length)a(i);else for(r=0;r<n.length;r++){a(i=n[r].split(" "))}}}w.readOnly=t}},_rgbToHex:function(e){if(e){if("#"===e.substr(0,1))return 4!=e.length?e:"#"+(o=e.substr(1,1))+o+(i=e.substr(2,1))+i+(n=e.substr(3,1))+n;var t=/(.*?)rgb\((\d+),\s*(\d+),\s*(\d+)\)/i.exec(e);if(!t)return null;var o=parseInt(t[2],10).toString(16),i=parseInt(t[3],10).toString(16),n=parseInt(t[4],10).toString(16);return"#"+((1==o.length?"0"+o:o)+(1==i.length?"0"+i:i)+(1==n.length?"0"+n:n))}return null},_preventDefault:function(e,t){!1!==t&&(0<T(".jqx-editor-dropdownpicker").length&&T(".jqx-editor-dropdownpicker").jqxDropDownButton("close"),0<T(".jqx-editor-dropdownlist").length&&T(".jqx-editor-dropdownlist").jqxDropDownList("close")),e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1},_addCommandHandler:function(e,t,i,o,n){var r,a=this;switch(!i&&n.init&&(i="custom"),i){case"custom":switch(n.type){case"list":r=function(e){"source"!=a._documentMode&&"none"!=e.args.type&&(n.value=T(this).val(),a.execute("custom",n),a.readOnly||a._refreshTools()),a._preventDefault(e,!1)};break;case"colorPicker":r=function(e){var o;return"source"!=a._documentMode&&(T(n.colorPicker).find("td").removeClass("jqx-editor-color-picker-selected-cell"),"div"==e.target.nodeName.toLowerCase()?(o=T(e.target).css("background-color"),T(e.target).parent().addClass("jqx-editor-color-picker-selected-cell")):(o=T(e.target).find("div").css("background-color"),T(e.target).addClass("jqx-editor-color-picker-selected-cell")),T("#bar-"+i).css("background",o),n.widget.val=function(){var e,t="number"!=typeof(e=o)?e:"rgb("+(255&e)+", "+((65280&e)>>8)+", "+((16711680&e)>>16)+")";return a._rgbToHex(t)},n.widget.jqxDropDownButton("close"),a.execute("custom",n)),a._preventDefault(e),!1};break;case"button":case"toggleButton":default:r=function(e){0<T(".jqx-editor-dropdownpicker").length&&T(".jqx-editor-dropdownpicker").jqxDropDownButton("close"),0<T(".jqx-editor-dropdownlist").length&&T(".jqx-editor-dropdownlist").jqxDropDownList("close"),a._preventDefault(e);T(this).attr("data-command");return"source"!=a._documentMode&&(n.toggle&&n.toggle(),a.execute("custom",n),a._refreshTools()),!1}}break;case"formatblock":r=function(e){"source"!=a._documentMode&&"none"!=e.args.type&&(a.execute(T(this).attr("data-command"),"<"+T(this).val()+">",n),a.readOnly||(a.commands.bold.toggled=!1,a._refreshTools())),a._preventDefault(e,!1)};break;case"fontsize":r=function(e){var t,o,i;"source"!=a._documentMode&&"none"!=e.args.type&&(t=T(this).val(),o="xx-small,x-small,small,medium,large,x-large,xx-large".split(","),T(this).jqxDropDownList("getSelectedIndex"),i=1+o.indexOf(t),a.execute(T(this).attr("data-command"),i,n)),a._preventDefault(e,!1)};break;case"fontname":r=function(e){var t;"source"!=a._documentMode&&"none"!=e.args.type&&(t=T(this).val(),a.execute(T(this).attr("data-command"),t,n)),a._preventDefault(e,!1)};break;case"forecolor":case"backcolor":r=function(e){var t;return"source"!=a._documentMode&&(T(n.colorPicker).find("td").removeClass("jqx-editor-color-picker-selected-cell"),"div"==e.target.nodeName.toLowerCase()?(t=T(e.target).css("background-color"),T(e.target).parent().addClass("jqx-editor-color-picker-selected-cell")):(t=T(e.target).find("div").css("background-color"),T(e.target).addClass("jqx-editor-color-picker-selected-cell")),T("#bar-"+i).css("background",t),n.widget.jqxDropDownButton("close"),a.execute(i,t,n)),a._preventDefault(e),!1};break;case"viewsource":r=function(e){return a.linkPopup&&a.linkPopup.remove(),n.toggle(),a.setMode(n.toggled),0<T(".jqx-editor-dropdownpicker").length&&T(".jqx-editor-dropdownpicker").jqxDropDownButton("close"),0<T(".jqx-editor-dropdownlist").length&&T(".jqx-editor-dropdownlist").jqxDropDownList("close"),a._preventDefault(e),!1};break;case"insertimage":r=function(e){a._insertImageAction(e,a,n)};break;case"createlink":r=function(e){a._createLinkAction(e,a,n)};break;default:r=function(e){0<T(".jqx-editor-dropdownpicker").length&&T(".jqx-editor-dropdownpicker").jqxDropDownButton("close"),0<T(".jqx-editor-dropdownlist").length&&T(".jqx-editor-dropdownlist").jqxDropDownList("close"),a._preventDefault(e);var t=T(this).attr("data-command");if("source"!=a._documentMode){if("underline"==t&&a.getSelectedElement()){var o=a.getSelectedElement();if(o&&"a"==o.nodeName.toLowerCase())return n.toggled?T(o).css("text-decoration","none"):T(o).css("text-decoration","underline"),n.toggle(),a._refreshTools(),!1}n.toggle&&n.toggle(),a.execute(t,T(this).val(),n),a._refreshTools()}return!1}}return a.addHandler(e,t,r),!1},_createLinkAction:function(e,n,r){if("source"!=(n=this)._documentMode){n.focused||n.editor.focus(),n.range=n.getRange();var t=n.getSelectedElement();if("a"==t.nodeName.toLowerCase()?n.editLink=t:n.editLink=null,0<T("#linkWindow"+this.element.id).length)return n.editLink&&n.selection.selectNode(t,!0),n._updateLinkWindow(),n._preventDefault(e),!1;var a=T("<div class='jqx-editor-window jqx-editor-link-window'><div>"+n.localization["Insert Link"]+"</div><div><table style='border-collapse: separate; border-spacing: 2px;'><tr><td align='right'>"+n.localization.URL+":</td><td><input style='width: 200px; height: 23px;' value=''/></td><tr/><tr><td align='right'>"+n.localization.Title+":</td><td><input style='width: 200px; height: 23px;' value=''/></td><tr/><tr><td align='right'></td><td><div class='jqx-editor-link-checkbox'>"+n.localization["Open in a new window/tab"]+"</div></td><tr/><tr><td align='right'></td><td align='right'><button>Ok</button><button style='margin-left: 5px;'>Remove</button><button style='margin-left: 5px;'>Cancel</button></td><tr/></table></div></div>");a[0].id="linkWindow"+this.element.id;var o=a.find("input");o.addClass(n.toThemeProperty("jqx-widget")),o.addClass(n.toThemeProperty("jqx-widget-content")),o.addClass(n.toThemeProperty("jqx-input"));var l=a.find(".jqx-editor-link-checkbox").jqxCheckBox({theme:n.theme,height:23,width:180}),i=a.find("button:first").jqxButton({theme:n.theme,disabled:!0}),d=T(a.find("button")[1]).jqxButton({theme:n.theme}),s=a.find("button:last").jqxButton({theme:n.theme});i.val(n.localization.Ok),s.val(n.localization.Cancel),d.val(n.localization.Remove),n.addHandler(s,T.jqx.mobile.isTouchDevice()?T.jqx.mobile.getTouchEventName("touchstart"):"click",function(e){n.editor.focus(),n.selectRange(n.range),n._refreshTools(),n._preventDefault(e)}),n.editLink&&(!n.editLink||n.editLink.href)||d.hide();var c,u=!1;return n.addHandler(T(o[0]),"focus",function(){u=""==o[1].value||o[1].value==o[0].value}),n.addHandler(T(o[1]),"keyup",function(e){e.keyCode&&(13==e.keyCode&&i.trigger("click"),27==e.keyCode&&s.trigger("click"))}),n.addHandler(T(o[0]),"keyup change",function(e){0<o[0].value.length?i.jqxButton({disabled:!1}):i.jqxButton({disabled:!0}),u&&(o[1].value=o[0].value),e.keyCode&&(13==e.keyCode&&i.trigger("click"),27==e.keyCode&&s.trigger("click"))}),n.addHandler(d,T.jqx.mobile.isTouchDevice()?T.jqx.mobile.getTouchEventName("touchstart"):"click",function(e){a.jqxWindow("close");try{n.editor.focus(),n.selection.selectNode(n.editLink),n.execute("unlink"),n.selection.collapse(!1),n.commands.underline.toggled=!1,n._refreshTools()}catch(e){}n._preventDefault(e)}),n.addHandler(i,T.jqx.mobile.isTouchDevice()?T.jqx.mobile.getTouchEventName("touchstart"):"click",function(e){var t=a.find("input"),o=T("<a>"+(t[1].value||t[0].value)+"</a>");l.val()&&o.attr("target","_blank"),o[0].href=T.trim(t[0].value),-1==t[0].value.indexOf("http")&&-1==t[0].value.indexOf("mailto")&&(o[0].href="http://"+T.trim(t[0].value)),n.focused||n.editor.focus(),n.range&&n.selectRange(n.range),n.editLink&&T(n.editLink).remove(),n.execute("insertHTML",o[0].outerHTML+"<span id='INSERTION_MARKER'>&nbsp;</span>",r),n.editor.focus();var i=T(n.editorDocument).find("#INSERTION_MARKER");n.selection.selectNode(i[0],!0),n.getRange().setStartAfter&&n.getRange().setStartAfter(i[0]),i.remove(),n.selection.collapse(!1),n._refreshTools(),n._preventDefault(e)}),n.updating=!0,a.appendTo(document.body),n.addHandler(a,"open",function(){n.updating=!0,setTimeout(function(){n.range=n.getRange(),T(o[0]).focus()},25)}),a.jqxWindow({resizable:!1,width:280,okButton:i,cancelButton:s,theme:n.theme,isModal:!0,position:{center:n.widget}}),n.addHandler(a,"close",function(){n.updating=!1}),n.focused||(n.editor.focus(),n.selectRange(n.range)),n.editLink?(o[0].value=n.editLink.href||"",o[1].value=T(n.editLink).text(),l.val("_blank"==T(n.editLink).attr("target"))):n.selection.isCollapsed()||((c=n.selection.getText()).match(/^(?!:\/\/)([a-zA-Z0-9]+\.)?[a-zA-Z0-9][a-zA-Z0-9-]+\.[a-zA-Z]{2,6}?$/i)?o[0].value=c:o[1].value=c),0<o[0].value.length?i.jqxButton({disabled:!1}):i.jqxButton({disabled:!0}),n._preventDefault(e),!1}n._preventDefault(e)},_insertImageAction:function(e,r,a){if("source"!=r._documentMode){if(r.focused||r.editor.focus(),r.range=r.getRange(),0<T("#imageWindow"+this.element.id).length)return r._updateImageWindow(),r._preventDefault(e),!1;var l=T("<div class='jqx-editor-window jqx-editor-image-window'><div>"+r.localization["Insert Image"]+"</div><div><table style='border-collapse: separate; border-spacing: 2px;'><tr><td align='right'>"+r.localization.URL+":</td><td><input style='width: 180px; height: 23px;' value=''/></td><tr/><tr><td align='right'>"+r.localization["Alt Text"]+":</td><td><input style='width: 180px; height: 23px;' value=''/></td><tr/><tr><td align='right'>"+r.localization.Width+":</td><td><input style='width: 180px; height: 23px;' value=''/></td><tr/><tr><td align='right'>"+r.localization.Height+":</td><td><input style='width: 180px; height: 23px;' value=''/></td><tr/><tr><td align='right'>"+r.localization.HSpace+":</td><td><input style='width: 180px; height: 23px;' class='jqx-editor-hspace'/></td><tr/><tr><td align='right'>"+r.localization.VSpace+":</td><td><input style='width: 180px; height: 23px;' class='jqx-editor-vspace'/></td><tr/><tr><td align='right'>"+r.localization.Align+":</td><td><div class='jqx-editor-align'></div></td><tr/><tr><td align='right'></td><td align='right'><button>Ok</button><button style='margin-left: 5px;'>Remove</button><button style='margin-left: 5px;'>Cancel</button></td><tr/></table></div></div>");l[0].id="imageWindow"+this.element.id;var t=l.find("input");t.addClass(r.toThemeProperty("jqx-widget")),t.addClass(r.toThemeProperty("jqx-widget-content")),t.addClass(r.toThemeProperty("jqx-input")),l.find(".jqx-editor-align").jqxDropDownList({hint:!1,autoDropDownHeight:!0,selectedIndex:0,theme:r.theme,height:23,width:180,source:[r.localization["not set"],r.localization.Left,r.localization.Right]});var o=l.find("button:first").jqxButton({theme:r.theme}),i=l.find("button:last").jqxButton({theme:r.theme}),n=T(l.find("button")[1]).jqxButton({theme:r.theme});return o.val(r.localization.Ok),i.val(r.localization.Cancel),n.val(r.localization.Remove),n.hide(),r.addHandler(n,T.jqx.mobile.isTouchDevice()?T.jqx.mobile.getTouchEventName("touchstart"):"click",function(e){T(r.editImage).removeClass("jqx-editor-focus"),T(r.editImage).remove(),r.editImage=null,r._preventDefault(e),l.jqxWindow("close"),r._raiseEvent("change")}),r.addHandler(i,T.jqx.mobile.isTouchDevice()?T.jqx.mobile.getTouchEventName("touchstart"):"click",function(e){T(r.editImage).removeClass("jqx-editor-focus"),r.editImage=null,r._preventDefault(e)}),r.addHandler(o,T.jqx.mobile.isTouchDevice()?T.jqx.mobile.getTouchEventName("touchstart"):"click",function(e){T(r.editImage).removeClass("jqx-editor-focus");var t=l.find("input"),o=(r.editImage?T(r.editImage):T('<img style="border: 1px solid transparent;">')).attr("src",t[0].value).attr("unselectable","on");t[1].value&&o.attr("alt",t[1].value).attr("title",t[1].value),t[2].value&&!isNaN(parseInt(t[2].value))?o.width(t[2].value):o.css("width","auto"),t[3].value&&!isNaN(parseInt(t[3].value))?o.height(t[3].value):o.css("height","auto"),t[4].value?"auto"==t[4].value.toString()?(o.css("margin-left","auto"),o.css("margin-right","auto")):-1!=t[4].value.toString().indexOf("%")?(o.css("margin-left",parseInt(t[4].value)+"%"),o.css("margin-right",parseInt(t[4].value)+"%")):(o.css("margin-left",parseInt(t[4].value)+"px"),o.css("margin-right",parseInt(t[4].value)+"px")):(o.css("margin-left","0px"),o.css("margin-right","0px")),t[5].value?"auto"==t[5].value.toString()?(o.css("margin-top","auto"),o.css("margin-bottom","auto")):-1!=t[5].value.toString().indexOf("%")?(o.css("margin-top",parseInt(t[5].value)+"%"),o.css("margin-bottom",parseInt(t[5].value)+"%")):(o.css("margin-top",parseInt(t[5].value)+"px"),o.css("margin-bottom",parseInt(t[5].value)+"px")):(o.css("margin-top","0px"),o.css("margin-bottom","0px"));var i,n=l.find(".jqx-editor-align").jqxDropDownList("selectedIndex");1==n?o.css("float","left"):2==n?o.css("float","right"):0==n&&o.css("float","none"),o.css("resize",!1),o[0].oncontrolselect=function(){return!1},o[0].selectstart=function(){return!1},r.editImage||(r.focused||r.editor.focus(),r.range&&r.selectRange(r.range),r.execute("insertHTML",o[0].outerHTML+"<span id='INSERTION_MARKER'>&nbsp;</span>",a),r.editor.focus(),i=T(r.editorDocument).find("#INSERTION_MARKER"),r.selection.selectNode(i[0],!0),r.getRange().setStartAfter&&r.getRange().setStartAfter(i[0]),i.remove(),r.selection.collapse(!1),r._refreshTools(),r._preventDefault(e)),r.editImage=null,r._preventDefault(e)}),l.appendTo(document.body),r.updating=!0,r.addHandler(l,"open",function(){r.updating=!0,setTimeout(function(){r.range=r.getRange(),T(t[0]).focus()},25)}),l.jqxWindow({resizable:!1,width:280,okButton:o,cancelButton:i,theme:r.theme,isModal:!0,position:{center:r.widget}}),r.addHandler(l,"close",function(){r.updating=!1}),r.focused||(r.editor.focus(),r.selectRange(r.range)),r._preventDefault(e),!1}r._preventDefault(e)},editmode:function(e){var t,o,i=this;e||i.readOnly?e&&i.readOnly&&(t=i.editor.find("#sourceText").text(),i.editor.html(t),i.buttons.hasOwnProperty("html")&&i.buttons.html.removeClass("active"),i.editor.attr("contentEditable",!0),i._addHandlers()):(i._removeHandlers(),i.editor.attr("contentEditable",!1),t=document.createTextNode(i.editor.html()),(o=T("<pre>")).html(t).attr({id:"sourceText",contentEditable:!0}).css("height","100%"),i.editor.html(o),i.buttons.hasOwnProperty("html")&&i.buttons.html.addClass("active"),o.focus()),i.readOnly=!e},setMode:function(e){var t=this;t.range||(t.editor.focus(),t.range=t.getRange());var o,i,n,r,a,l=t.editor[0];e?(t._documentMode="source",i=(o=new s).HTMLtoXML(l.innerHTML),i=o.FormatHTML(i),n=document.createTextNode(i),l.innerHTML="",r=document.createElement("pre"),l.contentEditable=!1,r.style.height="100%",r.style.margin="0px",r.style.outline="none",r.style.display="block",r.id="sourceText",r.contentEditable=!0,r.appendChild(n),l.appendChild(r),this.readOnly=!0):(this._documentMode="html",document.all?l.innerHTML=l.innerText:l.textContent?l.innerHTML=l.textContent:((n=document.createRange()).selectNodeContents(l.firstChild),l.innerHTML=n.toString()),l.contentEditable=!0,t.readOnly=!1,t._refreshTools(),t.editor.focus(),t.selection.selectNode(t.editor[0]),t.editor.scrollTop(0),t.selection.collapse(!0)),T.each(this.commands,function(){if(this.widget&&"viewsource"!=this.command)switch(this.type){case"list":this.widget.jqxDropDownList({disabled:e});break;case"colorPicker":this.widget.jqxDropDownButton({disabled:e});break;case"button":this.widget.jqxButton({disabled:e});break;case"toggleButton":this.widget.jqxToggleButton({toggled:!1,disabled:e})}}),t.editor.focus(),T.jqx.browser.mozilla&&(a=T("<a href='#'>anchor</a>"),t.editor.prepend(a),a.focus(),a.remove(),t.selection.collapse(!0)),t.commands.html.widget&&(t.commands.html.widget.jqxToggleButton({toggled:"source"==e||1==e}),t.commands.html.toggled="source"==e||1==e)},execute:function(t,o,e){var i=this;if(!i.readOnly){var n=i.editorDocument;if("source"==i._documentMode)return;i.changeType="mouse",i.linkPopup&&i.linkPopup.remove(),i.editor.focus(),T.jqx.browser.mozilla,T.jqx.mobile.isTouchDevice()&&setTimeout(function(){},25);function r(e){try{if(e.command&&"inserthtml"==e.command.toLowerCase()){var t=i.getRange(),o=e.value;-1==o.toString().indexOf("<")&&(o="<span>"+e.value+"</span>"),i.selection.insertContent(o+"<span id='INSERTION_MARKER'>&nbsp;</span>"),i.selectRange(t),setTimeout(function(){var e=T(i.editorDocument).find("#INSERTION_MARKER");i.selection.selectNode(T(e).prev()[0],!0),e.remove(),i.selection.collapse(!1)},10)}else if(e.command){if(!n.queryCommandEnabled(e.command))return!1;n.execCommand(e.command,!1,e.value)}else{if(!n.queryCommandEnabled(e))return!1;n.execCommand(e,!1,e)}}catch(e){}}var a;if("custom"==t)(a=o.action(o.widget,i.editor))&&r(a);else try{if(e&&e.action)r(a=e.action(e.widget,i.editor));else if(n.queryCommandEnabled(t))n.execCommand(t,!1,o);else{if("insertHTML"!=t)return!1;i.selection.insertContent(o)}}catch(e){if("insertHTML"!=t)return!1;i.selection.insertContent(o)}T.jqx.mobile.isTouchDevice()&&setTimeout(function(){i.iframe&&i.iframe[0].contentWindow.focus()},500),i._raiseEvent("change",{command:t,args:o}),i.changed=!0,i.range=i.getRange()}},destroy:function(){var i=this;i._removeHandlers();var e=i.tools.split(" "),t=i.tools.split(" | ");T.jqx.utilities.resize(this.host,null,!0);function o(e){T.each(e,function(e,t){var o=i.commands[this];if(!o)return!0;switch(o.type){case"list":o.widget.jqxDropDownList("destroy");break;case"colorPicker":o.colorPicker.remove(),o.widget.jqxDropDownButton("destroy");break;case"toggleButton":o.widget.jqxToggleButton("destroy");break;case"custom":i.destroyTool&&i.destroyTool(this);break;case"button":default:o.widget.jqxToggleButton("destroy"),"insertimage"===o.command?0<T("#imageWindow"+i.element.id).length&&(T("#imageWindow"+i.element.id).find(".jqx-editor-align").jqxDropDownList("destroy"),T("#imageWindow"+i.element.id).find("button").jqxButton("destroy")):"createlink"===o.command&&0<T("#linkWindow"+i.element.id).length&&(T("#linkWindow"+i.element.id).find(".jqx-editor-align").jqxDropDownList("destroy"),T("#linkWindow"+i.element.id).find("button").jqxButton("destroy"),T("#linkWindow"+i.element.id).find(".jqx-editor-link-checkbox").jqxCheckBox("destroy"))}})}if(0==t.length)o(e);else for(var n=0;n<t.length;n++){o(e=t[n].split(" "))}var r=T("#linkWindow"+this.element.id),a=T("#imageWindow"+this.element.id);r&&0<r.length&&r.jqxWindow("destroy"),a&&0<a.length&&a.jqxWindow("destroy"),i.inline?i.toolbar.remove():(i.widget.remove(),i.host.remove()),i.iframe.remove(),i.iframe=null,i.selection=null,i.editorDocument=null,i.contentEditableElement=null},val:function(e){if(void 0===e||"source"!==e)return null!=e&&"object"!=typeof e&&this.editor.html(e),"source"===this._documentMode?this.editor.find("pre:first").html():this.editor.html();var t=this.editor[0];"source"===this._documentMode&&(t=this.editor.find("pre:first")[0]);var o=new s,i=o.HTMLtoXML(t.innerHTML);return i=o.FormatHTML(i)},_raiseEvent:function(e,t){if(null==t&&(t={owner:null}),"source"==this._documentMode)return!0;var o=e;t.type=this.changeType,this.changeType=null;var i=t;i.owner=this;var n,r=new T.Event(o);return r.owner=this,r.args=i,n=this._textArea?T(this._textArea).trigger(r):this.host.trigger(r),t=r.args,n}});var d=function(o){var e={initialize:function(e){this.document=e},getSelection:function(){return this.document.getSelection?this.document.getSelection():this.document.selection},getRange:function(){var e=this.getSelection();if(!e)return null;try{return 0<e.rangeCount?e.getRangeAt(0):this.document.createRange?this.document.createRange():this.document.selection.createRange()}catch(e){return this.document.body.createTextRange()}},selectRange:function(e){var t;e.select?e.select():(t=this.getSelection()).addRange&&(t.removeAllRanges(),t.addRange(e))},selectNode:function(e,t){var o=this.getRange(),i=this.getSelection();if(o.moveToElementText)o.moveToElementText(e),o.select();else if(i.addRange)try{t?o.selectNodeContents(e):o.selectNode(e),i.removeAllRanges(),i.addRange(o)}catch(e){}else i.setBaseAndExtent(e,0,e,1);return e},isCollapsed:function(){var e=this.getRange();return!e.item&&(0==e.boundingWidth||this.getSelection().isCollapsed)},collapse:function(e){var t=this.getRange(),o=this.getSelection();t.select?(t.collapse(e),t.select()):e?o.collapseToStart():o.collapseToEnd()},getContent:function(){var e=this.getRange(),t=T("<div>")[0];return this.isCollapsed()?"":(e.cloneContents?t.appendChild(e.cloneContents()):null!=e.item||null!=e.htmlText?T(t).html(e.item?e.item(0).outerHTML:e.htmlText):T(t).html(e.toString()),T(t).html())},getText:function(){var e=this.getRange(),t=this.getSelection();return this.isCollapsed()?"":e.text||(t.toString?t.toString():"")},getNode:function(){var e=this.getRange();if(!T.jqx.browser.msie||9<=T.jqx.browser.version){var t=null;if(e)for(t=e.commonAncestorContainer,e.collapsed||e.startContainer==e.endContainer&&e.startOffset-e.endOffset<2&&e.startContainer.hasChildNodes()&&(t=e.startContainer.childNodes[e.startOffset]);"element"!=typeof t;)t=t.parentNode;return o.id(t)}return o.id(e.item?e.item(0):e.parentElement())},insertContent:function(e){var t,o,i,n=this.getRange();n.pasteHTML?(n.pasteHTML(e),n.collapse(!1),n.select()):n.insertNode&&(n.deleteContents(),n.createContextualFragment?n.insertNode(n.createContextualFragment(e)):(o=(t=this.document).createDocumentFragment(),i=t.createElement("div"),o.appendChild(i),i.outerHTML=e,n.insertNode(o)))}};return e.initialize(o),e},s=function(){var s=/^<([-A-Za-z0-9_]+)((?:\s+\w+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,c=/^<\/([-A-Za-z0-9_]+)[^>]*>/,u=/([-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,g=e("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),p=e("address,applet,blockquote,button,center,dd,del,dir,div,dl,dt,fieldset,form,frameset,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,p,pre,script,table,tbody,td,tfoot,th,thead,tr,ul"),h=e("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),m=e("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),f=e("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),b=e("script,style"),t=this.HTMLParser=function(e,r){var t,o,a=[];for(a.last=function(){return this[this.length-1]};e;){var i,n=!0;a.last()&&b[a.last()]?(e=e.replace(new RegExp("(.*)</"+a.last()+"[^>]*>"),function(e,t){return t=t.replace(/<!--(.*?)-->/g,"$1").replace(/<!\[CDATA\[(.*?)]]>/g,"$1"),r.chars&&r.chars(t),""}),d(0,a.last())):(0==e.indexOf("\x3c!--")?0<=(t=e.indexOf("--\x3e"))&&(r.comment&&r.comment(e.substring(4,t)),e=e.substring(t+3),n=!1):0==e.indexOf("</")?(o=e.match(c))&&(e=e.substring(o[0].length),o[0].replace(c,d),n=!1):0==e.indexOf("<")&&(o=e.match(s))&&(e=e.substring(o[0].length),o[0].replace(s,l),n=!1),n&&(i=(t=e.indexOf("<"))<0?e:e.substring(0,t),e=t<0?"":e.substring(t),r.chars&&r.chars(i))),0}function l(e,t,o,i){if(t=t.toLowerCase(),p[t])for(;a.last()&&h[a.last()];)d(0,a.last());var n;m[t]&&a.last()==t&&d(0,t),(i=g[t]||!!i)||a.push(t),r.start&&(n=[],o.replace(u,function(e,t){var o=arguments[2]?arguments[2]:arguments[3]?arguments[3]:arguments[4]?arguments[4]:f[t]?t:"";n.push({name:t,value:o,escaped:o.replace(/(^|[^\\])"/g,'$1\\"')})}),r.start&&r.start(t,n,i))}function d(e,t){if(t)for(o=a.length-1;0<=o&&a[o].toLowerCase()!=t.toLowerCase();o--);else var o=0;if(0<=o){for(var i=a.length-1;o<=i;i--)r.end&&r.end(a[i]);a.length=o}}d()};function e(e){for(var t={},o=e.split(","),i=0;i<o.length;i++)t[o[i]]=!0;return t}this.HTMLtoXML=function(e){var n="";return e=(e=e.replace(/\r/gi,"")).replace(/\n/gi,""),t(e,{start:function(e,t,o){n+="<"+e;for(var i=0;i<t.length;i++)n+=" "+t[i].name+'="'+t[i].escaped+'"';n+=(o?"/":"")+">"},end:function(e){n+="</"+e+">\r\n"},chars:function(e){n+=e},comment:function(e){n+="\x3c!--"+e+"--\x3e"}}),n},this.FormatHTML=function(e,t){var o,i,n,r,s;for(i=(t=t||{}).indent_size||4,n=t.indent_char||" ",r=t.brace_style||"collapse",s=t.unformatted||["a","span","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"],(o=new function(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.Utils={whitespace:"\n\r\t ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?=".split(","),extra_liners:"head,body,/html".split(","),in_array:function(e,t){for(var o=0;o<t.length;o++)if(e===t[o])return!0;return!1}},this.get_content=function(){for(var e="",t=[],o=!1;"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return t.length?t.join(""):["","TK_EOF"];if(e=this.input.charAt(this.pos),this.pos++,this.line_char_count++,this.Utils.in_array(e,this.Utils.whitespace))t.length&&(o=!0),this.line_char_count--;else{if(o){if(this.line_char_count>=this.max_char){t.push("\n");for(var i=0;i<this.indent_level;i++)t.push(this.indent_string);this.line_char_count=0}else t.push(" "),this.line_char_count++;o=!1}t.push(e)}}return t.length?t.join(""):""},this.get_contents_to=function(e){if(this.pos==this.input.length)return["","TK_EOF"];var t="",o=new RegExp("</"+e+"\\s*>","igm");o.lastIndex=this.pos;var i=o.exec(this.input),n=i?i.index:this.input.length;return this.pos<n&&(t=this.input.substring(this.pos,n),this.pos=n),t},this.record_tag=function(e){this.tags[e+"count"]?this.tags[e+"count"]++:this.tags[e+"count"]=1,this.tags[e+this.tags[e+"count"]]=this.indent_level,this.tags[e+this.tags[e+"count"]+"parent"]=this.tags.parent,this.tags.parent=e+this.tags[e+"count"]},this.retrieve_tag=function(e){if(this.tags[e+"count"]){for(var t=this.tags.parent;t&&e+this.tags[e+"count"]!==t;)t=this.tags[t+"parent"];t&&(this.indent_level=this.tags[e+this.tags[e+"count"]],this.tags.parent=this.tags[t+"parent"]),delete this.tags[e+this.tags[e+"count"]+"parent"],delete this.tags[e+this.tags[e+"count"]],1==this.tags[e+"count"]?delete this.tags[e+"count"]:this.tags[e+"count"]--}},this.get_tag=function(){var e,t,o="",i=[],n=!1;do{if(this.pos>=this.input.length)return i.length?i.join(""):["","TK_EOF"];o=this.input.charAt(this.pos),this.pos++,this.line_char_count++,this.Utils.in_array(o,this.Utils.whitespace)?(n=!0,this.line_char_count--):("'"!==o&&'"'!==o||i[1]&&"!"===i[1]||(o+=this.get_unformatted(o),n=!0),"="===o&&(n=!1),i.length&&"="!==i[i.length-1]&&">"!==o&&n&&(this.line_char_count>=this.max_char?(this.print_newline(!1,i),this.line_char_count=0):(i.push(" "),this.line_char_count++),n=!1),"<"===o&&(e=this.pos-1),i.push(o))}while(">"!==o);var r,a=i.join(""),l=-1!=a.indexOf(" ")?a.indexOf(" "):a.indexOf(">"),d=a.substring(1,l).toLowerCase();return"/"===a.charAt(a.length-2)||this.Utils.in_array(d,this.Utils.single_token)?this.tag_type="SINGLE":"script"===d?(this.record_tag(d),this.tag_type="SCRIPT"):"style"===d?(this.record_tag(d),this.tag_type="STYLE"):this.Utils.in_array(d,s)?(r=this.get_unformatted("</"+d+">",a),i.push(r),0<e&&this.Utils.in_array(this.input.charAt(e-1),this.Utils.whitespace)&&i.splice(0,0,this.input.charAt(e-1)),t=this.pos-1,this.Utils.in_array(this.input.charAt(1+t),this.Utils.whitespace)&&i.push(this.input.charAt(1+t)),this.tag_type="SINGLE"):"!"===d.charAt(0)?-1!=d.indexOf("[if")?(-1!=a.indexOf("!IE")&&(r=this.get_unformatted("--\x3e",a),i.push(r)),this.tag_type="START"):-1!=d.indexOf("[endif")?(this.tag_type="END",this.unindent()):(r=-1!=d.indexOf("[cdata[")?this.get_unformatted("]]>",a):this.get_unformatted("--\x3e",a),i.push(r),this.tag_type="SINGLE"):("/"===d.charAt(0)?(this.retrieve_tag(d.substring(1)),this.tag_type="END"):(this.record_tag(d),this.tag_type="START"),this.Utils.in_array(d,this.Utils.extra_liners)&&this.print_newline(!0,this.output)),i.join("")},this.get_unformatted=function(e,t){if(t&&-1!=t.indexOf(e))return"";var o="",i="",n=!0;do{if(this.pos>=this.input.length)return i;if(o=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(o,this.Utils.whitespace)){if(!n){this.line_char_count--;continue}if("\n"===o||"\r"===o){i+="\n",this.line_char_count=0;continue}}i+=o,this.line_char_count++,n=!0}while(-1==i.indexOf(e));return i},this.get_token=function(){if("TK_TAG_SCRIPT"!==this.last_token&&"TK_TAG_STYLE"!==this.last_token)return"CONTENT"===this.current_mode?"string"!=typeof(e=this.get_content())?e:[e,"TK_CONTENT"]:"TAG"===this.current_mode?"string"!=typeof(e=this.get_tag())?e:[e,"TK_TAG_"+this.tag_type]:void 0;var e,t=this.last_token.substr(7);return"string"!=typeof(e=this.get_contents_to(t))?e:[e,"TK_"+t]},this.get_full_indent=function(e){return(e=this.indent_level+e||0)<1?"":Array(e+1).join(this.indent_string)},this.printer=function(e,t,o,i,n){this.input=e||"",this.output=[],this.indent_character=t,this.indent_string="",this.indent_size=o,this.brace_style=n,this.indent_level=0,this.max_char=i;for(var r=this.line_char_count=0;r<this.indent_size;r++)this.indent_string+=this.indent_character;this.print_newline=function(e,t){if(this.line_char_count=0,t&&t.length){if(!e)for(;this.Utils.in_array(t[t.length-1],this.Utils.whitespace);)t.pop();t.push("\n");for(var o=0;o<this.indent_level;o++)t.push(this.indent_string)}},this.print_token=function(e){this.output.push(e)},this.indent=function(){this.indent_level++},this.unindent=function(){0<this.indent_level&&this.indent_level--}},this}).printer(e,n,i,1/0,r);;){var a,l,d,c,u,g,p,h=o.get_token();if(o.token_text=h[0],o.token_type=h[1],"TK_EOF"===o.token_type)break;switch(o.token_type){case"TK_TAG_START":o.print_newline(!1,o.output),o.print_token(o.token_text),o.indent(),o.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":o.print_newline(!1,o.output),o.print_token(o.token_text),o.current_mode="CONTENT";break;case"TK_TAG_END":"TK_CONTENT"===o.last_token&&""===o.last_text&&(a=o.token_text.match(/\w+/)[0],null!==(l=o.output[o.output.length-1].match(/<\s*(\w+)/))&&l[1]===a||o.print_newline(!0,o.output)),o.print_token(o.token_text),o.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var m=o.token_text.match(/^\s*<([a-z]+)/i);m&&o.Utils.in_array(m[1],s)||o.print_newline(!1,o.output),o.print_token(o.token_text),o.current_mode="CONTENT";break;case"TK_CONTENT":""!==o.token_text&&o.print_token(o.token_text),o.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":""!==o.token_text&&(o.output.push("\n"),p=o.token_text,d="keep"==t.indent_scripts?0:"separate"==t.indent_scripts?-o.indent_level:1,c=o.get_full_indent(d),u=p.match(/^\s*/)[0].match(/[^\n\r]*$/)[0].split(o.indent_string).length-1,g=o.get_full_indent(d-u),(p=p.replace(/^\s*/,c).replace(/\r\n|\r|\n/g,"\n"+g).replace(/\s*$/,""))&&(o.print_token(p),o.print_newline(!0,o.output))),o.current_mode="TAG"}o.last_token=o.token_type,o.last_text=o.token_text}return o.output.join("")}}}(jqxBaseFramework);