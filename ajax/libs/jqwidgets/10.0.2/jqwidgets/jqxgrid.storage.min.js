!function(S){S.extend(S.jqx._jqxGrid.prototype,{savestate:function(i){var s=this.getstate();return void 0===i||S.isEmptyObject(i)||(-1==i.indexOf("sort")&&(delete s.sortcolumn,delete s.sortdirection),-1==i.indexOf("pager")&&(delete s.pagenum,delete s.pagesizeoptions,delete s.pagesize),-1==i.indexOf("selection")&&(delete s.selectedcells,delete s.selectedrowindexes,delete s.selectedrowindex),-1==i.indexOf("grouping")&&delete s.groups,-1==i.indexOf("filter")&&delete s.filters,S.each(this.columns.records,function(e){var t=s.columns[this.datafield];-1==i.indexOf("hidden_columns")&&delete t.hidden,-1==i.indexOf("reorder")&&delete t.index,-1==i.indexOf("columns_width")&&delete t.width,-1==i.indexOf("columns_text")&&delete t.text,-1==i.indexOf("alignment")&&(delete t.align,delete t.cellsalign)})),window.localStorage&&(window.localStorage["jqxGrid"+this.element.id]=this._stringify(s)),this._savedstate=s},loadstate:function(e,t){var i="";if(null!=e&&null!=e.width?i=e:window.localStorage?window.localStorage["jqxGrid"+this.element.id]&&(i=S.parseJSON(window.localStorage["jqxGrid"+this.element.id])):this._savedstate&&(i=this._savedstate),null!=i&&""!==i){(this.virtualmode||this.source._source.url&&""!=this.source._source.url)&&this.source.beginUpdate();var s,r=i;if(void 0!==r.width&&(this.width=r.width),void 0!==r.height&&(this.height=r.height),this.pageable&&(null!=r.pagesize&&(this.pagesize=r.pagesize,this.dataview.pagesize=r.pagesize),null!=r.pagenum&&(this.dataview.pagenum=r.pagenum),null!=r.pagesizeoptions&&(this.pagesizeoptions=r.pagesizeoptions),this.pagesizeoptions)){for(var o=0,l=0;l<this.pagesizeoptions.length;l++)this.pagesize>=this.pagesizeoptions[l]&&(o=l);this.pagershowrowscombo&&this.pagershowrowscombo.jqxDropDownList({selectedIndex:o})}this.sortable&&(this._loading&&(this._loading=!1),r.sortdirection?(r.sortdirection.ascending||r.sortdirection.descending)&&(this.dataview.sortfield=r.sortcolumn,s=r.sortdirection.ascending?"asc":"desc",this.dataview.sortfielddirection=s,this.source.sortcolumn=r.sortcolumn,this.source.sortdirection=s,this.sortby(r.sortcolumn,s)):null==this.dataview.sortfield||"asc"!=this.dataview.sortfielddirection&&"desc"!=this.dataview.sortfielddirection||this.sortby(this.dataview.sortfield,null)),this.groupable&&r.groups&&(this.dataview.groups=r.groups,this.groups=r.groups),this.loadingstate=!0,this.virtualsizeinfo&&this._loadselectionandcolumnwidths(r),this.loadingstate=!1,(this.virtualmode||this.source._source.url&&""!=this.source._source.url)&&(1==t?this.source.endUpdate(!1):(this.source.endUpdate(!1),(this.virtualmode||this.source._source.filter||this.source._source.sort)&&this.updatebounddata("state")))}},_loadselectionandcolumnwidths:function(e){this.loadingstate=!0;var t="";if(null!=e&&null!=e.width?t=e:window.localStorage?window.localStorage["jqxGrid"+this.element.id]&&(t=S.parseJSON(window.localStorage["jqxGrid"+this.element.id])):this._savedstate&&(t=this._savedstate),null!=t&&""!=t){var i=this._loading;this._loading=!1;var s=t,n=this,r=!1,o=[];o.length=0;if(S.each(this.columns.records,function(e){var t=s.columns[this.datafield];if(null!=t){if(this.text!=t.text&&(r=!0),this.hidden!=t.hidden&&(r=!0),void 0!==t.width&&(this.width=t.width,this._width&&(this._width=null),this._percentagewidth&&(this._percentagewidth=null)),void 0!==t.hidden&&(this.hidden=t.hidden),void 0!==t.pinned&&(this.pinned=t.pinned),void 0!==t.groupable&&(this.groupable=t.groupable),void 0!==t.resizable&&(this.resizable=t.resizable),this.draggable=t.draggable,void 0!==t.text&&(this.text=t.text),void 0!==t.align&&(this.align=t.align),void 0!==t.cellsalign&&(this.cellsalign=t.cellsalign),n._columns)for(var i=0;i<n._columns.length;i++)n._columns[i].datafield==this.datafield&&(void 0!==t.hidden&&(n._columns[i].hidden=t.hidden),void 0!==t.width&&(n._columns[i].width=t.width));void 0!==t.index&&(o[this.datafield]=t.index,o.length++)}}),0<o.length){if(this.setcolumnindex){this.rowdetails;this.groupable&&this.groups.length;for(var l=new Array,a=0;a<this.columns.records.length;a++)l.push(this.columns.records[a]);for(var d=0,h=new Array,a=0;a<l.length;a++){var c,u=l[a],f=o[u.datafield];this.groupable&&u.grouped?d++:0==a&&this.rowdetails?d++:(a!==f||this.groupable||this.rowdetails)&&(c=d+f,h.push({column:u,key:c}))}h.sort(function(e,t){return e.key<t.key?-1:e.key>t.key?1:0}),h.reverse(),S.each(h,function(e,t){var i=this.key;n.setcolumnindex(this.column.datafield,i,!1)})}this.prerenderrequired=!0,this.groupable&&this._refreshdataview(),this.rendergridcontent(!0),this._updatefilterrowui&&this.filterable&&this.showfilterrow&&this._updatefilterrowui(),this._renderrows(this.virtualsizeinfo)}if(this.filterable&&void 0!==s.filters){this.clearfilters&&(this._loading=!1,this.clearfilters(!1));for(var g="",p=new S.jqx.filter,a=0;a<s.filters.filterscount;a++){var w=s.filters["filtercondition"+a],v=s.filters["filterdatafield"+a],u=this.getcolumn(v);if(v!=g&&(p=new S.jqx.filter),g=v,u&&u.filterable){var m=s.filters["filtervalue"+a],x=s.filters["filteroperator"+a];if(j="datefilter"==(y=s.filters["filtertype"+a])?p.createfilter(y,m,w,null,u.cellsformat,this.gridlocalization):p.createfilter(y,m,w),p.addfilter(x,j),this.showfilterrow){var _,b,y,j,q,z,D,O=u._filterwidget,k=u._filterwidget.parent();if(null!=O)switch(u.filtertype){case"number":k.find("input").val(m),this.host.jqxDropDownList&&(_=p.getoperatorsbyfiltertype("numericfilter"),O.find(".filter").jqxDropDownList("selectIndex",_.indexOf(w)));break;case"date":this.host.jqxDateTimeInput?S(k.children()[0]).jqxDateTimeInput("setDate",m):O.val(m);break;case"range":this.host.jqxDateTimeInput?(b=s.filters["filtervalue"+(a+1)],y=s.filters["filtertype"+a],j=p.createfilter(y,b,"LESS_THAN_OR_EQUAL"),p.addfilter(x,j),q=new Date(m),z=new Date(b),isNaN(q)&&(q=S.jqx.dataFormat.tryparsedate(m)),isNaN(z)&&(z=S.jqx.dataFormat.tryparsedate(m)),S(k.children()[0]).jqxDateTimeInput("setRange",q,z),a++):O.val(m);break;case"textbox":case"default":O.val(m),n["_oldWriteText"+O[0].id]=m;break;case"list":this.host.jqxDropDownList?(D=S(k.children()[0]).jqxDropDownList("getItems"),f=-1,S.each(D,function(e){if(this.value==m)return f=e,!1}),S(k.children()[0]).jqxDropDownList("selectIndex",f)):O.val(m);break;case"checkedlist":this.host.jqxDropDownList||O.val(m);break;case"bool":case"boolean":this.host.jqxCheckBox?S(k.children()[0]).jqxCheckBox({checked:m}):O.val(m)}}this.addfilter(v,p)}}s.filters&&0<s.filters.filterscount&&(this.applyfilters(),this.showfilterrow&&S.each(this.columns.records,function(){if("checkedlist"==this.filtertype&&this.filterable&&n.host.jqxDropDownList){var e=this,t=e._filterwidget,i=(t.jqxDropDownList("getItems"),t.jqxDropDownList("listBox"));if(i.checkAll(!1),e.filter){i.uncheckAll(!1);for(var s=e.filter.getfilters(),r=0;r<i.items.length;r++){var o=i.items[r].label;S.each(s,function(){if("NOT_EQUAL"==this.condition)return!0;o==this.value&&i.checkIndex(r,!1,!1)})}i._updateCheckedItems();var l=i.getCheckedItems().length;i.items.length!=l&&0<l&&i.host.jqxListBox("indeterminateIndex",0,!0,!1)}}})),this.pageable&&void 0!==s.pagenum&&(this.gotopage&&!this.virtualmode?(this.dataview.pagenum=-1,this.gotopage(s.pagenum)):this.gotopage&&this.virtualmode&&this.gotopage(s.pagenum))}if(s.selectedrowindexes&&s.selectedrowindexes&&0<s.selectedrowindexes.length&&(this.selectedrowindexes=s.selectedrowindexes,this.selectedrowindex=s.selectedrowindex,"checkbox"===this.selectionmode&&this._updatecheckboxselection()),s.selectedcells&&this._applycellselection&&S.each(s.selectedcells,function(){n._applycellselection(this.rowindex,this.datafield,!0,!1)}),this.groupable&&void 0!==s.groups)return this._refreshdataview(),this.render(),this._loading=i,void(this.loadingstate=!1);if(r){if(this.prerenderrequired=!0,this.rendergridcontent(!0),this._loading=i,this.loadingstate=!1,this.updating())return!1}else this._loading=i,this._updatecolumnwidths(),this._updatecellwidths(),this.loadingstate=!1;this.loadingstate=!1,this._loading=i,this._renderrows(this.virtualsizeinfo)}this.loadingstate=!1},getstate:function(){var e,t,i,s=this.getdatainformation(),r={};r.width=this.width,r.height=this.height,r.pagenum=s.paginginformation.pagenum,r.pagesize=s.paginginformation.pagesize,r.pagesizeoptions=this.pagesizeoptions,r.sortcolumn=s.sortinformation.sortcolumn,r.sortdirection=s.sortinformation.sortdirection,null!=this.selectionmode&&this.getselectedcells&&(-1!=this.selectionmode.toString().indexOf("cell")?(e=this.getselectedcells(),t=new Array,S.each(e,function(){t.push({datafield:this.datafield,rowindex:this.rowindex})}),r.selectedcells=t):(i=this.getselectedrowindexes(),r.selectedrowindexes=i,r.selectedrowindex=this.selectedrowindex));var o={},l=0;if(this.dataview.filters)for(var n=0;n<this.dataview.filters.length;n++){var a=this.dataview.filters[n].datafield,d=this.dataview.filters[n].filter,h=d.getfilters();o[a+"operator"]=d.operator;for(var c,u,f=0;f<h.length;f++){h[f].datafield=a,"datefilter"==h[f].type&&h[f].value&&h[f].value.toLocaleString?(c=this.getcolumn(h[f].datafield)).cellsformat?(u=this.source.formatDate(h[f].value,c.cellsformat,this.gridlocalization),o["filtervalue"+l]=u||h[f].value.toLocaleString()):o["filtervalue"+l]=h[f].value.toLocaleString():o["filtervalue"+l]=h[f].value,o["filtercondition"+l]=h[f].condition,o["filteroperator"+l]=h[f].operator,o["filterdatafield"+l]=a,o["filtertype"+l]=h[f].type,l++}}o.filterscount=l,r.filters=o,r.groups=this.groups,r.columns={};var g=0;return this.columns.records&&S.each(this.columns.records,function(e,t){if(!this.datafield)return!0;var i={};i.width=this.width,i.hidden=this.hidden,i.pinned=this.pinned,i.groupable=this.groupable,i.resizable=this.resizable,i.draggable=this.draggable,i.text=this.text,i.align=this.align,i.cellsalign=this.cellsalign,i.index=g++,r.columns[this.datafield]=i}),r},_stringify:function(t){if(window.JSON&&"function"==typeof window.JSON.stringify){var e="";try{e=window.JSON.stringify(t)}catch(e){return this._str("",{"":t})}return e}return e=this._str("",{"":t})},_quote:function(e){var i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return'"'+e.replace(/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,function(e){var t=i[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"'},_stringifyArray:function(e){for(var t=e.length,i=[],s=0;s<t;s++)i.push(this._str(s,e)||"null");return"["+i.join(",")+"]"},_stringifyObject:function(e){var t,i,s=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&(i=this._str(t,e))&&s.push(this._quote(t)+":"+i);return"{"+s.join(",")+"}"},_stringifyReference:function(e){switch(Object.prototype.toString.call(e)){case"[object Array]":return this._stringifyArray(e)}return this._stringifyObject(e)},_stringifyPrimitive:function(e,t){switch(t){case"string":return this._quote(e);case"number":return isFinite(e)?e:"null";case"boolean":return e}return"null"},_str:function(e,t){var i=t[e],s=typeof i;return i&&"object"==typeof i&&"function"==typeof i.toJSON&&(s=typeof(i=i.toJSON(e))),/(number|string|boolean)/.test(s)||!i&&"object"===s?this._stringifyPrimitive(i,s):this._stringifyReference(i)}})}(jqxBaseFramework);