"use strict";function objToNode(e,t,o){var n;return"#text"===e.nodeName?n=o.document.createTextNode(e.data):"#comment"===e.nodeName?n=o.document.createComment(e.data):("svg"===e.nodeName.toLowerCase()||t?(n=o.document.createElementNS("http://www.w3.org/2000/svg",e.nodeName.toLowerCase()),t=!0):n=o.document.createElement(e.nodeName),e.attributes&&Object.entries(e.attributes).forEach(function(e){var t=e[0],o=e[1];return n.setAttribute(t,o)}),e.childNodes&&e.childNodes.forEach(function(e){return n.appendChild(objToNode(e,t,o))}),o.valueDiffing&&(e.value&&(n.value=e.value),e.checked&&(n.checked=e.checked),e.selected&&(n.selected=e.selected))),n}function getFromRoute(e,t){for(t=t.slice();0<t.length;){if(!e.childNodes)return!1;var o=t.splice(0,1)[0];e=e.childNodes[o]}return e}function applyDiff(e,o,n){var t,s,i,a,l=getFromRoute(e,o[n._const.route]),r={diff:o,node:l};if(n.preDiffApply(r))return!0;switch(o[n._const.action]){case n._const.addAttribute:if(!l||!l.setAttribute)return!1;l.setAttribute(o[n._const.name],o[n._const.value]);break;case n._const.modifyAttribute:if(!l||!l.setAttribute)return!1;l.setAttribute(o[n._const.name],o[n._const.newValue]),"INPUT"===l.nodeName&&"value"===o[n._const.name]&&(l.value=o[n._const.newValue]);break;case n._const.removeAttribute:if(!l||!l.removeAttribute)return!1;l.removeAttribute(o[n._const.name]);break;case n._const.modifyTextElement:if(!l||3!==l.nodeType)return!1;n.textDiff(l,l.data,o[n._const.oldValue],o[n._const.newValue]);break;case n._const.modifyValue:if(!l||void 0===l.value)return!1;l.value=o[n._const.newValue];break;case n._const.modifyComment:if(!l||void 0===l.data)return!1;n.textDiff(l,l.data,o[n._const.oldValue],o[n._const.newValue]);break;case n._const.modifyChecked:if(!l||void 0===l.checked)return!1;l.checked=o[n._const.newValue];break;case n._const.modifySelected:if(!l||void 0===l.selected)return!1;l.selected=o[n._const.newValue];break;case n._const.replaceElement:l.parentNode.replaceChild(objToNode(o[n._const.newValue],"http://www.w3.org/2000/svg"===l.namespaceURI,n),l);break;case n._const.relocateGroup:Array.apply(void 0,new Array(o.groupLength)).map(function(){return l.removeChild(l.childNodes[o[n._const.from]])}).forEach(function(e,t){0===t&&(s=l.childNodes[o[n._const.to]]),l.insertBefore(e,s||null)});break;case n._const.removeElement:l.parentNode.removeChild(l);break;case n._const.addElement:a=(i=o[n._const.route].slice()).splice(i.length-1,1)[0],(l=getFromRoute(e,i)).insertBefore(objToNode(o[n._const.element],"http://www.w3.org/2000/svg"===l.namespaceURI,n),l.childNodes[a]||null);break;case n._const.removeTextElement:if(!l||3!==l.nodeType)return!1;l.parentNode.removeChild(l);break;case n._const.addTextElement:if(a=(i=o[n._const.route].slice()).splice(i.length-1,1)[0],t=n.document.createTextNode(o[n._const.value]),!(l=getFromRoute(e,i))||!l.childNodes)return!1;l.insertBefore(t,l.childNodes[a]||null);break;default:console.log("unknown action")}return r.newNode=t,n.postDiffApply(r),!0}function applyDOM(t,e,o){return e.every(function(e){return applyDiff(t,e,o)})}function swap(e,t,o){var n=e[t];e[t]=e[o],e[o]=n}function undoDiff(e,t,o){switch(t[o._const.action]){case o._const.addAttribute:t[o._const.action]=o._const.removeAttribute,applyDiff(e,t,o);break;case o._const.modifyAttribute:swap(t,o._const.oldValue,o._const.newValue),applyDiff(e,t,o);break;case o._const.removeAttribute:t[o._const.action]=o._const.addAttribute,applyDiff(e,t,o);break;case o._const.modifyTextElement:case o._const.modifyValue:case o._const.modifyComment:case o._const.modifyChecked:case o._const.modifySelected:case o._const.replaceElement:swap(t,o._const.oldValue,o._const.newValue),applyDiff(e,t,o);break;case o._const.relocateGroup:swap(t,o._const.from,o._const.to),applyDiff(e,t,o);break;case o._const.removeElement:t[o._const.action]=o._const.addElement,applyDiff(e,t,o);break;case o._const.addElement:t[o._const.action]=o._const.removeElement,applyDiff(e,t,o);break;case o._const.removeTextElement:t[o._const.action]=o._const.addTextElement,applyDiff(e,t,o);break;case o._const.addTextElement:t[o._const.action]=o._const.removeTextElement,applyDiff(e,t,o);break;default:console.log("unknown action")}}function undoDOM(t,e,o){e.length||(e=[e]),(e=e.slice()).reverse(),e.forEach(function(e){undoDiff(t,e,o)})}Object.defineProperty(exports,"__esModule",{value:!0});var Diff=function(e){var n=this;void 0===e&&(e={}),Object.entries(e).forEach(function(e){var t=e[0],o=e[1];return n[t]=o})};function elementDescriptors(e){var t=[];return"#text"!==e.nodeName&&"#comment"!==e.nodeName&&(t.push(e.nodeName),e.attributes&&(e.attributes.class&&t.push(e.nodeName+"."+e.attributes.class.replace(/ /g,".")),e.attributes.id&&t.push(e.nodeName+"#"+e.attributes.id))),t}function findUniqueDescriptors(e){var o={},n={};return e.forEach(function(e){elementDescriptors(e).forEach(function(e){var t=e in o;t||e in n?t&&(delete o[e],n[e]=!0):o[e]=!0})}),o}function uniqueInBoth(e,t){var o=findUniqueDescriptors(e),n=findUniqueDescriptors(t),s={};return Object.keys(o).forEach(function(e){n[e]&&(s[e]=!0)}),s}function removeDone(e){return delete e.outerDone,delete e.innerDone,delete e.valueDone,!e.childNodes||e.childNodes.every(removeDone)}function isEqual(t,o){if(!["nodeName","value","checked","selected","data"].every(function(e){return t[e]===o[e]}))return!1;if(Boolean(t.attributes)!==Boolean(o.attributes))return!1;if(Boolean(t.childNodes)!==Boolean(o.childNodes))return!1;if(t.attributes){var e=Object.keys(t.attributes),n=Object.keys(o.attributes);if(e.length!==n.length)return!1;if(!e.every(function(e){return t.attributes[e]===o.attributes[e]}))return!1}if(t.childNodes){if(t.childNodes.length!==o.childNodes.length)return!1;if(!t.childNodes.every(function(e,t){return isEqual(e,o.childNodes[t])}))return!1}return!0}function roughlyEqual(e,t,o,n,s){if(!e||!t)return!1;if(e.nodeName!==t.nodeName)return!1;if("#text"===e.nodeName)return!!s||e.data===t.data;if(e.nodeName in o)return!0;if(e.attributes&&t.attributes){if(e.attributes.id){if(e.attributes.id!==t.attributes.id)return!1;if(e.nodeName+"#"+e.attributes.id in o)return!0}if(e.attributes.class&&e.attributes.class===t.attributes.class&&e.nodeName+"."+e.attributes.class.replace(/ /g,".")in o)return!0}if(n)return!0;var i=e.childNodes?e.childNodes.slice().reverse():[],a=t.childNodes?t.childNodes.slice().reverse():[];if(i.length!==a.length)return!1;if(s)return i.every(function(e,t){return e.nodeName===a[t].nodeName});var l=uniqueInBoth(i,a);return i.every(function(e,t){return roughlyEqual(e,a[t],l,!0,!0)})}function cloneObj(e){return JSON.parse(JSON.stringify(e))}function findCommonSubsets(e,s,t,o){var n=0,i=[],a=e.length,l=s.length,r=Array.apply(void 0,new Array(a+1)).map(function(){return[]}),c=uniqueInBoth(e,s),u=a===l;u&&e.some(function(e,t){var o=elementDescriptors(e),n=elementDescriptors(s[t]);return o.length!==n.length?!(u=!1):(o.some(function(e,t){if(e!==n[t])return!(u=!1)}),!u||void 0)});for(var d=0;d<a;d++)for(var h=e[d],f=0;f<l;f++){var p=s[f];t[d]||o[f]||!roughlyEqual(h,p,c,u)?r[d+1][f+1]=0:(r[d+1][f+1]=r[d][f]?r[d][f]+1:1,r[d+1][f+1]>=n&&(n=r[d+1][f+1],i=[d+1,f+1]))}return 0!==n&&{oldValue:i[0]-n,newValue:i[1]-n,length:n}}function makeArray(e,t){return Array.apply(void 0,new Array(e)).map(function(){return t})}function getGapInformation(e,t,o){var i=e.childNodes?makeArray(e.childNodes.length,!0):[],a=t.childNodes?makeArray(t.childNodes.length,!0):[],l=0;return o.forEach(function(e){for(var t=e.oldValue+e.length,o=e.newValue+e.length,n=e.oldValue;n<t;n+=1)i[n]=l;for(var s=e.newValue;s<o;s+=1)a[s]=l;l+=1}),{gaps1:i,gaps2:a}}function markSubTrees(e,t){for(var o=e.childNodes?e.childNodes:[],n=t.childNodes?t.childNodes:[],s=makeArray(o.length,!1),i=makeArray(n.length,!1),a=[],l=!0,r=function(){return arguments[1]};l;)(l=findCommonSubsets(o,n,s,i))&&(a.push(l),Array.apply(void 0,new Array(l.length)).map(r).forEach(function(e){return t=e,s[l.oldValue+t]=!0,void(i[l.newValue+t]=!0);var t}));return e.subsets=a,e.subsetsAge=100,a}Diff.prototype.toString=function(){return JSON.stringify(this)},Diff.prototype.setValue=function(e,t){return this[e]=t,this};var DiffTracker=function(){this.list=[]};function getFromVirtualRoute(e,t){var o,n,s=e;for(t=t.slice();0<t.length;){if(!s.childNodes)return!1;n=t.splice(0,1)[0],s=(o=s).childNodes[n]}return{node:s,parentNode:o,nodeIndex:n}}function applyVirtualDiff(e,n,s){var t,o,i,a=getFromVirtualRoute(e,n[s._const.route]),l=a.node,r=a.parentNode,c=a.nodeIndex,u=[],d={diff:n,node:l};if(s.preVirtualDiffApply(d))return!0;switch(n[s._const.action]){case s._const.addAttribute:l.attributes||(l.attributes={}),l.attributes[n[s._const.name]]=n[s._const.value],"checked"===n[s._const.name]?l.checked=!0:"selected"===n[s._const.name]?l.selected=!0:"INPUT"===l.nodeName&&"value"===n[s._const.name]&&(l.value=n[s._const.value]);break;case s._const.modifyAttribute:l.attributes[n[s._const.name]]=n[s._const.newValue];break;case s._const.removeAttribute:delete l.attributes[n[s._const.name]],0===Object.keys(l.attributes).length&&delete l.attributes,"checked"===n[s._const.name]?l.checked=!1:"selected"===n[s._const.name]?delete l.selected:"INPUT"===l.nodeName&&"value"===n[s._const.name]&&delete l.value;break;case s._const.modifyTextElement:l.data=n[s._const.newValue];break;case s._const.modifyValue:l.value=n[s._const.newValue];break;case s._const.modifyComment:l.data=n[s._const.newValue];break;case s._const.modifyChecked:l.checked=n[s._const.newValue];break;case s._const.modifySelected:l.selected=n[s._const.newValue];break;case s._const.replaceElement:(t=cloneObj(n[s._const.newValue])).outerDone=!0,t.innerDone=!0,t.valueDone=!0,r.childNodes[c]=t;break;case s._const.relocateGroup:l.childNodes.splice(n[s._const.from],n.groupLength).reverse().forEach(function(e){return l.childNodes.splice(n[s._const.to],0,e)}),l.subsets&&l.subsets.forEach(function(e){var t,o;n[s._const.from]<n[s._const.to]&&e.oldValue<=n[s._const.to]&&e.oldValue>n[s._const.from]?(e.oldValue-=n.groupLength,0<(t=e.oldValue+e.length-n[s._const.to])&&(u.push({oldValue:n[s._const.to]+n.groupLength,newValue:e.newValue+e.length-t,length:t}),e.length-=t)):n[s._const.from]>n[s._const.to]&&e.oldValue>n[s._const.to]&&e.oldValue<n[s._const.from]?(e.oldValue+=n.groupLength,0<(o=e.oldValue+e.length-n[s._const.to])&&(u.push({oldValue:n[s._const.to]+n.groupLength,newValue:e.newValue+e.length-o,length:o}),e.length-=o)):e.oldValue===n[s._const.from]&&(e.oldValue=n[s._const.to])});break;case s._const.removeElement:r.childNodes.splice(c,1),r.subsets&&r.subsets.forEach(function(e){e.oldValue>c?--e.oldValue:e.oldValue===c?e.delete=!0:e.oldValue<c&&e.oldValue+e.length>c&&(e.oldValue+e.length-1===c?e.length--:(u.push({newValue:e.newValue+c-e.oldValue,oldValue:c,length:e.length-c+e.oldValue-1}),e.length=c-e.oldValue))}),l=r;break;case s._const.addElement:o=n[s._const.route].slice(),i=o.splice(o.length-1,1)[0],l=getFromVirtualRoute(e,o).node,(t=cloneObj(n[s._const.element])).outerDone=!0,t.innerDone=!0,t.valueDone=!0,l.childNodes||(l.childNodes=[]),i>=l.childNodes.length?l.childNodes.push(t):l.childNodes.splice(i,0,t),l.subsets&&l.subsets.forEach(function(e){var t;e.oldValue>=i?e.oldValue+=1:e.oldValue<i&&e.oldValue+e.length>i&&(t=e.oldValue+e.length-i,u.push({newValue:e.newValue+e.length-t,oldValue:i+1,length:t}),e.length-=t)});break;case s._const.removeTextElement:r.childNodes.splice(c,1),"TEXTAREA"===r.nodeName&&delete r.value,r.subsets&&r.subsets.forEach(function(e){e.oldValue>c?--e.oldValue:e.oldValue===c?e.delete=!0:e.oldValue<c&&e.oldValue+e.length>c&&(e.oldValue+e.length-1===c?e.length--:(u.push({newValue:e.newValue+c-e.oldValue,oldValue:c,length:e.length-c+e.oldValue-1}),e.length=c-e.oldValue))}),l=r;break;case s._const.addTextElement:o=n[s._const.route].slice(),i=o.splice(o.length-1,1)[0],(t={}).nodeName="#text",t.data=n[s._const.value],(l=getFromVirtualRoute(e,o).node).childNodes||(l.childNodes=[]),i>=l.childNodes.length?l.childNodes.push(t):l.childNodes.splice(i,0,t),"TEXTAREA"===l.nodeName&&(l.value=n[s._const.newValue]),l.subsets&&l.subsets.forEach(function(e){var t;e.oldValue>=i&&(e.oldValue+=1),e.oldValue<i&&e.oldValue+e.length>i&&(t=e.oldValue+e.length-i,u.push({newValue:e.newValue+e.length-t,oldValue:i+1,length:t}),e.length-=t)});break;default:console.log("unknown action")}l.subsets&&(l.subsets=l.subsets.filter(function(e){return!e.delete&&e.oldValue!==e.newValue}),u.length&&(l.subsets=l.subsets.concat(u))),d.newNode=t,s.postVirtualDiffApply(d)}function applyVirtual(t,e,o){return e.forEach(function(e){applyVirtualDiff(t,e,o)}),!0}function nodeToObj(e,t){void 0===t&&(t={});var o={};return o.nodeName=e.nodeName,"#text"===o.nodeName||"#comment"===o.nodeName?o.data=e.data:(e.attributes&&0<e.attributes.length&&(o.attributes={},Array.prototype.slice.call(e.attributes).forEach(function(e){return o.attributes[e.name]=e.value})),"TEXTAREA"===o.nodeName?o.value=e.value:e.childNodes&&0<e.childNodes.length&&(o.childNodes=[],Array.prototype.slice.call(e.childNodes).forEach(function(e){return o.childNodes.push(nodeToObj(e,t))})),t.valueDiffing&&(void 0!==e.checked&&e.type&&["radio","checkbox"].includes(e.type.toLowerCase())?o.checked=e.checked:void 0!==e.value&&(o.value=e.value),void 0!==e.selected&&(o.selected=e.selected))),o}DiffTracker.prototype.add=function(e){var t;(t=this.list).push.apply(t,e)},DiffTracker.prototype.forEach=function(t){this.list.forEach(function(e){return t(e)})};var tagRE=/<(?:"[^"]*"['"]*|'[^']*'['"]*|[^'">])+>/g,empty=Object.create?Object.create(null):{},attrRE=/\s([^'"\/\s><]+?)[\s\/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function unescape(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}var lookup={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,menuItem:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};function parseTag(e){var t={nodeName:"",attributes:{}},o=e.match(/<\/?([^\s]+?)[\/\s>]/);o&&(t.nodeName=o[1].toUpperCase(),!lookup[o[1].toLowerCase()]&&"/"!==e.charAt(e.length-2)||(t.voidElement=!0));for(var n,s,i=new RegExp(attrRE),a=null,l=!1;!l;){null===(a=i.exec(e))?l=!0:a[0].trim()&&(a[1]?(s=[n=a[1].trim(),""],-1<n.indexOf("=")&&(s=n.split("=")),t.attributes[s[0]]=s[1],i.lastIndex--):a[2]&&(t.attributes[a[2]]=a[3].trim().substring(1,a[3].length-1)))}return t}function parse(r,c){void 0===c&&(c={components:empty});var u,d=[],h=-1,f=[],p={},m=!1;return r.replace(tagRE,function(e,t){if(m){if(e!=="</"+u.nodeName+">")return;m=!1}var o,n,s,i="/"!==e.charAt(1),a=t+e.length,l=r.charAt(a);i&&(h++,"tag"===(u=parseTag(e)).type&&c.components[u.nodeName]&&(u.type="component",m=!0),u.voidElement||m||!l||"<"===l||(u.childNodes||(u.childNodes=[]),u.childNodes.push({nodeName:"#text",data:unescape(r.slice(a,r.indexOf("<",a)))})),p[u.tagName]=u,0===h&&d.push(u),(o=f[h-1])&&(o.childNodes||(o.childNodes=[]),o.childNodes.push(u)),f[h]=u),i&&!u.voidElement||(h--,m||"<"===l||!l)||(o=-1===h?d:f[h].childNodes||[],n=r.indexOf("<",a),s=unescape(r.slice(a,-1===n?void 0:n)),o.push({nodeName:"#text",data:s}))}),d[0]}function cleanObj(e){return delete e.voidElement,e.childNodes&&e.childNodes.forEach(function(e){return cleanObj(e)}),e}function stringToObj(e){return cleanObj(parse(e))}var DiffFinder=function(e,t,o){this.options=o,this.t1=e instanceof HTMLElement?nodeToObj(e,this.options):"string"==typeof e?stringToObj(e,this.options):JSON.parse(JSON.stringify(e)),this.t2=t instanceof HTMLElement?nodeToObj(t,this.options):"string"==typeof t?stringToObj(t,this.options):JSON.parse(JSON.stringify(t)),this.diffcount=0,this.foundAll=!1,this.debug&&(this.t1Orig=nodeToObj(e,this.options),this.t2Orig=nodeToObj(t,this.options)),this.tracker=new DiffTracker};DiffFinder.prototype.init=function(){return this.findDiffs(this.t1,this.t2)},DiffFinder.prototype.findDiffs=function(e,t){var o;do{if(this.options.debug&&(this.diffcount+=1,this.diffcount>this.options.diffcap))throw window.diffError=[this.t1Orig,this.t2Orig],new Error("surpassed diffcap:"+JSON.stringify(this.t1Orig)+" -> "+JSON.stringify(this.t2Orig));0===(o=this.findNextDiff(e,t,[])).length&&(isEqual(e,t)||(this.foundAll?console.error("Could not find remaining diffs!"):(this.foundAll=!0,removeDone(e),o=this.findNextDiff(e,t,[])))),0<o.length&&(this.foundAll=!1,this.tracker.add(o),applyVirtual(e,o,this.options))}while(0<o.length);return this.tracker.list},DiffFinder.prototype.findNextDiff=function(e,t,o){var n,s;if(this.options.maxDepth&&o.length>this.options.maxDepth)return[];if(!e.outerDone){if(n=this.findOuterDiff(e,t,o),this.options.filterOuterDiff&&(s=this.options.filterOuterDiff(e,t,n))&&(n=s),0<n.length)return e.outerDone=!0,n;e.outerDone=!0}if(!e.innerDone){if(0<(n=this.findInnerDiff(e,t,o)).length)return n;e.innerDone=!0}if(this.options.valueDiffing&&!e.valueDone){if(0<(n=this.findValueDiff(e,t,o)).length)return e.valueDone=!0,n;e.valueDone=!0}return[]},DiffFinder.prototype.findOuterDiff=function(e,t,o){var n,s,i,a,l,r,c=[];if(e.nodeName!==t.nodeName){if(!o.length)throw new Error("Top level nodes have to be of the same kind.");return[(new Diff).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,cloneObj(e)).setValue(this.options._const.newValue,cloneObj(t)).setValue(this.options._const.route,o)]}if(o.length&&this.options.maxNodeDiffCount<Math.abs((e.childNodes||[]).length-(t.childNodes||[]).length))return[(new Diff).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,cloneObj(e)).setValue(this.options._const.newValue,cloneObj(t)).setValue(this.options._const.route,o)];if(e.data!==t.data)return"#text"===e.nodeName?[(new Diff).setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,o).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)]:[(new Diff).setValue(this.options._const.action,this.options._const.modifyComment).setValue(this.options._const.route,o).setValue(this.options._const.oldValue,e.data).setValue(this.options._const.newValue,t.data)];for(s=e.attributes?Object.keys(e.attributes).sort():[],i=t.attributes?Object.keys(t.attributes).sort():[],a=s.length,r=0;r<a;r++)n=s[r],-1===(l=i.indexOf(n))?c.push((new Diff).setValue(this.options._const.action,this.options._const.removeAttribute).setValue(this.options._const.route,o).setValue(this.options._const.name,n).setValue(this.options._const.value,e.attributes[n])):(i.splice(l,1),e.attributes[n]!==t.attributes[n]&&c.push((new Diff).setValue(this.options._const.action,this.options._const.modifyAttribute).setValue(this.options._const.route,o).setValue(this.options._const.name,n).setValue(this.options._const.oldValue,e.attributes[n]).setValue(this.options._const.newValue,t.attributes[n])));for(a=i.length,r=0;r<a;r++)n=i[r],c.push((new Diff).setValue(this.options._const.action,this.options._const.addAttribute).setValue(this.options._const.route,o).setValue(this.options._const.name,n).setValue(this.options._const.value,t.attributes[n]));return c},DiffFinder.prototype.findInnerDiff=function(e,t,o){var n=e.childNodes?e.childNodes.slice():[],s=t.childNodes?t.childNodes.slice():[],i=Math.max(n.length,s.length),a=Math.abs(n.length-s.length),l=[],r=0;if(!this.options.maxChildCount||i<this.options.maxChildCount){var c=e.subsets&&e.subsetsAge--?e.subsets:e.childNodes&&t.childNodes?markSubTrees(e,t):[];if(0<c.length&&0<(l=this.attemptGroupRelocation(e,t,c,o)).length)return l}for(var u=0;u<i;u+=1){var d=n[u],h=s[u];a&&(d&&!h?("#text"===d.nodeName?l.push((new Diff).setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,o.concat(r)).setValue(this.options._const.value,d.data)):l.push((new Diff).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,o.concat(r)).setValue(this.options._const.element,cloneObj(d))),--r):h&&!d&&("#text"===h.nodeName?l.push((new Diff).setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,o.concat(r)).setValue(this.options._const.value,h.data)):l.push((new Diff).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,o.concat(r)).setValue(this.options._const.element,cloneObj(h))))),d&&h&&(!this.options.maxChildCount||i<this.options.maxChildCount?l=l.concat(this.findNextDiff(d,h,o.concat(r))):isEqual(d,h)||(n.length>s.length?(l=l.concat([(new Diff).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.element,cloneObj(d)).setValue(this.options._const.route,o.concat(r))]),n.splice(u,1),--r,--a):n.length<s.length?(l=l.concat([(new Diff).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.element,cloneObj(h)).setValue(this.options._const.route,o.concat(r))]),n.splice(u,0,{}),--a):l=l.concat([(new Diff).setValue(this.options._const.action,this.options._const.replaceElement).setValue(this.options._const.oldValue,cloneObj(d)).setValue(this.options._const.newValue,cloneObj(h)).setValue(this.options._const.route,o.concat(r))]))),r+=1}return e.innerDone=!0,l},DiffFinder.prototype.attemptGroupRelocation=function(e,t,o,n){for(var s,i,a,l,r,c,u=getGapInformation(e,t,o),d=u.gaps1,h=u.gaps2,f=Math.min(d.length,h.length),p=[],m=0,_=0;m<f;_+=1,m+=1)if(!0===d[m])if("#text"===(l=e.childNodes[_]).nodeName){if("#text"===t.childNodes[m].nodeName&&l.data!==t.childNodes[m].data){for(c=_;e.childNodes.length>c+1&&"#text"===e.childNodes[c+1].nodeName;)if(c+=1,t.childNodes[m].data===e.childNodes[c].data){r=!0;break}if(!r)return p.push((new Diff).setValue(this.options._const.action,this.options._const.modifyTextElement).setValue(this.options._const.route,n.concat(m)).setValue(this.options._const.oldValue,l.data).setValue(this.options._const.newValue,t.childNodes[m].data)),p}p.push((new Diff).setValue(this.options._const.action,this.options._const.removeTextElement).setValue(this.options._const.route,n.concat(m)).setValue(this.options._const.value,l.data)),d.splice(m,1),f=Math.min(d.length,h.length),--m}else p.push((new Diff).setValue(this.options._const.action,this.options._const.removeElement).setValue(this.options._const.route,n.concat(m)).setValue(this.options._const.element,cloneObj(l))),d.splice(m,1),f=Math.min(d.length,h.length),--m;else if(!0===h[m])f=("#text"===(l=t.childNodes[m]).nodeName?p.push((new Diff).setValue(this.options._const.action,this.options._const.addTextElement).setValue(this.options._const.route,n.concat(m)).setValue(this.options._const.value,l.data)):p.push((new Diff).setValue(this.options._const.action,this.options._const.addElement).setValue(this.options._const.route,n.concat(m)).setValue(this.options._const.element,cloneObj(l))),d.splice(m,0,!0),Math.min(d.length,h.length)),--_;else if(d[m]!==h[m]){if(0<p.length)return p;if(a=o[d[m]],(i=Math.min(a.newValue,e.childNodes.length-a.length))!==a.oldValue){s=!1;for(var g=0;g<a.length;g+=1)roughlyEqual(e.childNodes[i+g],e.childNodes[a.oldValue+g],[],!1,!0)||(s=!0);if(s)return[(new Diff).setValue(this.options._const.action,this.options._const.relocateGroup).setValue("groupLength",a.length).setValue(this.options._const.from,a.oldValue).setValue(this.options._const.to,i).setValue(this.options._const.route,n)]}}return p};var DEFAULT_OPTIONS={debug:!(DiffFinder.prototype.findValueDiff=function(e,t,o){var n=[];return e.selected!==t.selected&&n.push((new Diff).setValue(this.options._const.action,this.options._const.modifySelected).setValue(this.options._const.oldValue,e.selected).setValue(this.options._const.newValue,t.selected).setValue(this.options._const.route,o)),(e.value||t.value)&&e.value!==t.value&&"OPTION"!==e.nodeName&&n.push((new Diff).setValue(this.options._const.action,this.options._const.modifyValue).setValue(this.options._const.oldValue,e.value||"").setValue(this.options._const.newValue,t.value||"").setValue(this.options._const.route,o)),e.checked!==t.checked&&n.push((new Diff).setValue(this.options._const.action,this.options._const.modifyChecked).setValue(this.options._const.oldValue,e.checked).setValue(this.options._const.newValue,t.checked).setValue(this.options._const.route,o)),n}),diffcap:10,maxDepth:!1,maxChildCount:50,valueDiffing:!0,textDiff:function(e,t,o,n){e.data=n},preVirtualDiffApply:function(){},postVirtualDiffApply:function(){},preDiffApply:function(){},postDiffApply:function(){},filterOuterDiff:null,compress:!1,_const:!1,document:!(!window||!window.document)&&window.document},DiffDOM=function(e){var t,n=this;void 0===e&&(e={}),this.options=e,Object.entries(DEFAULT_OPTIONS).forEach(function(e){var t=e[0],o=e[1];Object.prototype.hasOwnProperty.call(n.options,t)||(n.options[t]=o)}),this.options._const||(t=["addAttribute","modifyAttribute","removeAttribute","modifyTextElement","relocateGroup","removeElement","addElement","removeTextElement","addTextElement","replaceElement","modifyValue","modifyChecked","modifySelected","modifyComment","action","route","oldValue","newValue","element","group","from","to","name","value","data","attributes","nodeName","childNodes","checked","selected"],this.options._const={},this.options.compress?t.forEach(function(e,t){return n.options._const[e]=t}):t.forEach(function(e){return n.options._const[e]=e})),this.DiffFinder=DiffFinder};DiffDOM.prototype.apply=function(e,t){return applyDOM(e,t,this.options)},DiffDOM.prototype.undo=function(e,t){return undoDOM(e,t,this.options)},DiffDOM.prototype.diff=function(e,t){return new this.DiffFinder(e,t,this.options).init()};var TraceLogger=function(e){var a=this;void 0===e&&(e={}),this.pad="│   ",this.padding="",this.tick=1,this.messages=[];function t(n,s){var i=n[s];n[s]=function(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];a.fin(s,Array.prototype.slice.call(e));var o=i.apply(n,e);return a.fout(s,o),o}}for(var o in e)"function"==typeof e[o]&&t(e,o);this.log("┌ TRACELOG START")};TraceLogger.prototype.fin=function(e,t){this.padding+=this.pad,this.log("├─> entering "+e,t)},TraceLogger.prototype.fout=function(e,t){this.log("│<──┘ generated return value",t),this.padding=this.padding.substring(0,this.padding.length-this.pad.length)},TraceLogger.prototype.format=function(e,t){return function(e){for(e=""+e;e.length<4;)e="0"+e;return e}(t)+"> "+this.padding+e},TraceLogger.prototype.log=function(){var e=Array.prototype.slice.call(arguments),t=function(e){return e?"string"==typeof e?e:e instanceof HTMLElement?e.outerHTML||"<empty>":e instanceof Array?"["+e.map(t).join(",")+"]":e.toString()||e.valueOf()||"<unknown>":"<falsey>"},e=e.map(t).join(", ");this.messages.push(this.format(e,this.tick++))},TraceLogger.prototype.toString=function(){for(var e="└───";e.length<=this.padding.length+this.pad.length;)e+="×   ";var t=this.padding;return this.padding="",e=this.format(e,this.tick),this.padding=t,this.messages.join("\n")+"\n"+e},exports.DiffDOM=DiffDOM,exports.TraceLogger=TraceLogger,exports.nodeToObj=nodeToObj,exports.stringToObj=stringToObj;