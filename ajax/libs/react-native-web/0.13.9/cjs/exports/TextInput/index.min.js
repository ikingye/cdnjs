"use strict";exports.__esModule=!0,exports.default=void 0;var _react=require("react"),_createElement=_interopRequireDefault(require("../createElement")),_css=_interopRequireDefault(require("../StyleSheet/css")),_pick=_interopRequireDefault(require("../../modules/pick")),_setAndForwardRef=_interopRequireDefault(require("../../modules/setAndForwardRef")),_useElementLayout=_interopRequireDefault(require("../../hooks/useElementLayout")),_useLayoutEffect=_interopRequireDefault(require("../../hooks/useLayoutEffect")),_usePlatformMethods=_interopRequireDefault(require("../../hooks/usePlatformMethods")),_useResponderEvents=_interopRequireDefault(require("../../hooks/useResponderEvents")),_StyleSheet=_interopRequireDefault(require("../StyleSheet")),_TextInputState=_interopRequireDefault(require("../../modules/TextInputState"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var isSelectionStale=function(e,t){var n=e.selectionEnd,o=e.selectionStart,r=t.start,u=t.end;return r!==o||u!==n},setSelection=function(e,t){if(isSelectionStale(e,t)){var n=t.start,o=t.end;try{e.setSelectionRange(n,o||n)}catch(e){}}},forwardPropsList={accessibilityLabel:!0,accessibilityLiveRegion:!0,accessibilityRole:!0,accessibilityState:!0,accessibilityValue:!0,accessible:!0,autoCapitalize:!0,autoComplete:!0,autoCorrect:!0,autoFocus:!0,children:!0,classList:!0,defaultValue:!0,dir:!0,disabled:!0,importantForAccessibility:!0,maxLength:!0,nativeID:!0,onBlur:!0,onChange:!0,onClick:!0,onClickCapture:!0,onContextMenu:!0,onFocus:!0,onScroll:!0,onTouchCancel:!0,onTouchCancelCapture:!0,onTouchEnd:!0,onTouchEndCapture:!0,onTouchMove:!0,onTouchMoveCapture:!0,onTouchStart:!0,onTouchStartCapture:!0,placeholder:!0,pointerEvents:!0,readOnly:!0,ref:!0,rows:!0,spellCheck:!0,style:!0,value:!0,testID:!0,type:!0,dataSet:!0,onMouseDown:!0,onMouseEnter:!0,onMouseLeave:!0,onMouseMove:!0,onMouseOver:!0,onMouseOut:!0,onMouseUp:!0},pickProps=function(e){return(0,_pick.default)(e,forwardPropsList)};function isEventComposing(e){return e.isComposing||229===e.keyCode}var TextInput=(0,_react.forwardRef)(function(e,t){var n,o,r=e.autoCapitalize,u=void 0===r?"sentences":r,a=e.autoComplete,l=e.autoCompleteType,s=e.autoCorrect,i=void 0===s||s,c=e.blurOnSubmit,d=e.clearTextOnFocus,p=e.dir,S=e.editable,f=void 0===S||S,h=e.keyboardType,v=void 0===h?"default":h,R=e.multiline,C=void 0!==R&&R,_=e.numberOfLines,y=void 0===_?1:_,m=e.onBlur,x=e.onChange,g=e.onChangeText,T=e.onContentSizeChange,E=e.onFocus,b=e.onKeyPress,k=e.onLayout,q=e.onMoveShouldSetResponder,M=e.onMoveShouldSetResponderCapture,w=e.onResponderEnd,D=e.onResponderGrant,F=e.onResponderMove,L=e.onResponderReject,I=e.onResponderRelease,P=e.onResponderStart,z=e.onResponderTerminate,O=e.onResponderTerminationRequest,A=e.onScrollShouldSetResponder,K=e.onScrollShouldSetResponderCapture,N=e.onSelectionChange,B=e.onSelectionChangeShouldSetResponder,j=e.onSelectionChangeShouldSetResponderCapture,G=e.onStartShouldSetResponder,V=e.onStartShouldSetResponderCapture,W=e.onSubmitEditing,H=e.placeholderTextColor,U=e.returnKeyType,J=e.secureTextEntry,Q=void 0!==J&&J,X=e.selection,Y=e.selectTextOnFocus,Z=e.spellCheck;switch(v){case"email-address":n="email";break;case"number-pad":case"numeric":o="numeric";break;case"decimal-pad":o="decimal";break;case"phone-pad":n="tel";break;case"search":case"web-search":n="search";break;case"url":n="url";break;default:n="text"}Q&&(n="password");var $=(0,_react.useRef)(null),ee=(0,_react.useRef)({height:null,width:null}),te=(0,_setAndForwardRef.default)({getForwardedRef:function(){return t},setLocalRef:function(e){null!=e&&(e.clear=function(){null!=e&&(e.value="")},e.isFocused=function(){return null!=e&&_TextInputState.default.currentlyFocusedField()===e}),$.current=e,null!=$.current&&ne()}});function ne(){var e,t,n=$.current;C&&T&&null!=n&&(e=n.scrollHeight,t=n.scrollWidth,e===ee.current.height&&t===ee.current.width||(ee.current.height=e,ee.current.width=t,T({nativeEvent:{contentSize:{height:ee.current.height,width:ee.current.width}}})))}(0,_useLayoutEffect.default)(function(){var e=$.current;null!=e&&null!=X&&setSelection(e,X),document.activeElement===e&&(_TextInputState.default._currentlyFocusedNode=e)},[$,X]);var oe=C?"textarea":"input",re=[classes.textinput],ue=_StyleSheet.default.compose(e.style,H&&{placeholderTextColor:H});(0,_useElementLayout.default)($,k),(0,_useResponderEvents.default)($,{onMoveShouldSetResponder:q,onMoveShouldSetResponderCapture:M,onResponderEnd:w,onResponderGrant:D,onResponderMove:F,onResponderReject:L,onResponderRelease:I,onResponderStart:P,onResponderTerminate:z,onResponderTerminationRequest:O,onScrollShouldSetResponder:A,onScrollShouldSetResponderCapture:K,onSelectionChangeShouldSetResponder:B,onSelectionChangeShouldSetResponderCapture:j,onStartShouldSetResponder:G,onStartShouldSetResponderCapture:V});var ae=pickProps(e);return ae.autoCapitalize=u,ae.autoComplete=a||l||"on",ae.autoCorrect=i?"on":"off",ae.classList=re,ae.dir=void 0!==p?p:"auto",ae.enterkeyhint=U,ae.onBlur=function(e){_TextInputState.default._currentlyFocusedNode=null,m&&(e.nativeEvent.text=e.target.value,m(e))},ae.onChange=function(e){var t=e.target.value;e.nativeEvent.text=t,ne(),x&&x(e),g&&g(t)},ae.onFocus=function(e){var t=$.current;null!=t&&(_TextInputState.default._currentlyFocusedNode=t,E&&(e.nativeEvent.text=e.target.value,E(e)),d&&(t.value=""),Y&&t.select())},ae.onKeyDown=function(e){e.stopPropagation();var t=null==c?!C:c,n=e.nativeEvent,o=isEventComposing(n);b&&b(e),"Enter"!==e.key||e.shiftKey||o||e.isDefaultPrevented()||(!c&&C||!W||(e.preventDefault(),n.text=e.target.value,W(e)),t&&null!=$.current&&$.current.blur())},ae.onSelect=function(e){if(N)try{var t=e.target,n=t.selectionStart,o=t.selectionEnd;e.nativeEvent.selection={start:n,end:o},e.nativeEvent.text=e.target.value,N(e)}catch(e){}},ae.readOnly=!f,ae.ref=te,ae.rows=C?y:void 0,ae.spellCheck=null!=Z?Z:i,ae.style=ue,ae.type=C?void 0:n,ae.inputMode=o,(0,_usePlatformMethods.default)($,ae),(0,_createElement.default)(oe,ae)});TextInput.displayName="TextInput",TextInput.State=_TextInputState.default;var classes=_css.default.create({textinput:{MozAppearance:"textfield",WebkitAppearance:"none",backgroundColor:"transparent",border:"0 solid black",borderRadius:0,boxSizing:"border-box",font:"14px System",margin:0,padding:0,resize:"none"}}),_default=TextInput;exports.default=TextInput,module.exports=exports.default;