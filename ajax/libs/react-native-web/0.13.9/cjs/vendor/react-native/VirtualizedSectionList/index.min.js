"use strict";exports.__esModule=!0,exports.default=void 0;var React=_interopRequireWildcard(require("react")),_View=_interopRequireDefault(require("../../../exports/View")),_VirtualizedList=_interopRequireDefault(require("../VirtualizedList")),_invariant=_interopRequireDefault(require("fbjs/lib/invariant"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r,n={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){Object.prototype.hasOwnProperty.call(e,o)&&((r=i?Object.getOwnPropertyDescriptor(e,o):null)&&(r.get||r.set)?Object.defineProperty(n,o,r):n[o]=e[o])}return n.default=e,t&&t.set(e,n),n}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function ownKeys(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}var VirtualizedSectionList=function(r){_inheritsLoose(t,r);var e=t.prototype;function t(e,t){var l=r.call(this,e,t)||this;return l._keyExtractor=function(e,t){var r=l._subExtractor(t);return r&&r.key||String(t)},l._convertViewable=function(e){(0,_invariant.default)(null!=e.index,"Received a broken ViewToken");var t=l._subExtractor(e.index);if(!t)return null;var r=t.section.keyExtractor||l.props.keyExtractor;return _objectSpread({},e,{index:t.index,key:r(e.item,t.index),section:t.section})},l._onViewableItemsChanged=function(e){var t=e.viewableItems,r=e.changed;l.props.onViewableItemsChanged&&l.props.onViewableItemsChanged({viewableItems:t.map(l._convertViewable,_assertThisInitialized(l)).filter(Boolean),changed:r.map(l._convertViewable,_assertThisInitialized(l)).filter(Boolean)})},l._renderItem=function(e){var t=e.item,r=e.index,n=l._subExtractor(r);if(!n)return null;var i=n.index;if(null==i){var o=n.section;if(!0===n.header){var a=l.props.renderSectionHeader;return a?a({section:o}):null}var s=l.props.renderSectionFooter;return s?s({section:o}):null}var c=n.section.renderItem||l.props.renderItem,p=l._getSeparatorComponent(r,n);return(0,_invariant.default)(c,"no renderItem!"),React.createElement(ItemWithSeparator,{SeparatorComponent:p,LeadingSeparatorComponent:0===i?l.props.SectionSeparatorComponent:void 0,cellKey:n.key,index:i,item:t,leadingItem:n.leadingItem,leadingSection:n.leadingSection,onUpdateSeparator:l._onUpdateSeparator,prevCellKey:(l._subExtractor(r-1)||{}).key,ref:function(e){l._cellRefs[n.key]=e},renderItem:c,section:n.section,trailingItem:n.trailingItem,trailingSection:n.trailingSection})},l._onUpdateSeparator=function(e,t){var r=l._cellRefs[e];r&&r.updateSeparatorProps(t)},l._cellRefs={},l._captureRef=function(e){l._listRef=e},l.state=l._computeState(e),l}return e.scrollToLocation=function(e){for(var t=e.itemIndex,r=0;r<e.sectionIndex;r++)t+=this.props.getItemCount(this.props.sections[r].data)+2;var n=0;0<e.itemIndex&&this.props.stickySectionHeadersEnabled&&(n=this._listRef._getFrameMetricsApprox(t-e.itemIndex).length);var i=_objectSpread({},e,{viewOffset:n,index:t});this._listRef.scrollToIndex(i)},e.getListRef=function(){return this._listRef},e.UNSAFE_componentWillReceiveProps=function(e){this.setState(this._computeState(e))},e._computeState=function(r){var n=r.ListHeaderComponent?1:0,i=[],e=r.sections?r.sections.reduce(function(e,t){return i.push(e+n),e+r.getItemCount(t.data)+2},0):0;return{childProps:_objectSpread({},r,{renderItem:this._renderItem,ItemSeparatorComponent:void 0,data:r.sections,getItemCount:function(){return e},getItem:function(e,t){return _getItem(r,e,t)},keyExtractor:this._keyExtractor,onViewableItemsChanged:r.onViewableItemsChanged?this._onViewableItemsChanged:void 0,stickyHeaderIndices:r.stickySectionHeadersEnabled?i:void 0})}},e.render=function(){return React.createElement(_VirtualizedList.default,_extends({},this.state.childProps,{ref:this._captureRef}))},e._subExtractor=function(e){for(var t=e,r=this.props,n=r.getItem,i=r.getItemCount,o=r.keyExtractor,a=r.sections,s=0;s<a.length;s++){var c=a[s],p=c.data,l=c.key||String(s);if(--t>=i(p)+1)t-=i(p)+1;else return-1===t?{section:c,key:l+":header",index:null,header:!0,trailingSection:a[s+1]}:t===i(p)?{section:c,key:l+":footer",index:null,header:!1,trailingSection:a[s+1]}:{section:c,key:l+":"+(c.keyExtractor||o)(n(p,t),t),index:t,leadingItem:n(p,t-1),leadingSection:a[s-1],trailingItem:n(p,t+1),trailingSection:a[s+1]}}},e._getSeparatorComponent=function(e,t){if(!(t=t||this._subExtractor(e)))return null;var r=t.section.ItemSeparatorComponent||this.props.ItemSeparatorComponent,n=this.props.SectionSeparatorComponent,i=e===this.state.childProps.getItemCount()-1,o=t.index===this.props.getItemCount(t.section.data)-1;return n&&o?n:!r||o||i?null:r},t}(React.PureComponent);VirtualizedSectionList.defaultProps=_objectSpread({},_VirtualizedList.default.defaultProps,{data:[]});var ItemWithSeparator=function(n){function e(){for(var a,e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(a=n.call.apply(n,[this].concat(t))||this).state={separatorProps:{highlighted:!1,leadingItem:a.props.item,leadingSection:a.props.leadingSection,section:a.props.section,trailingItem:a.props.trailingItem,trailingSection:a.props.trailingSection},leadingSeparatorProps:{highlighted:!1,leadingItem:a.props.leadingItem,leadingSection:a.props.leadingSection,section:a.props.section,trailingItem:a.props.item,trailingSection:a.props.trailingSection}},a._separators={highlight:function(){["leading","trailing"].forEach(function(e){return a._separators.updateProps(e,{highlighted:!0})})},unhighlight:function(){["leading","trailing"].forEach(function(e){return a._separators.updateProps(e,{highlighted:!1})})},updateProps:function(e,t){var r=a.props,n=r.LeadingSeparatorComponent,i=r.cellKey,o=r.prevCellKey;"leading"===e&&null!=n?a.setState(function(e){return{leadingSeparatorProps:_objectSpread({},e.leadingSeparatorProps,{},t)}}):a.props.onUpdateSeparator("leading"===e&&o||i,t)}},a}_inheritsLoose(e,n),e.getDerivedStateFromProps=function(e,t){return{separatorProps:_objectSpread({},t.separatorProps,{leadingItem:e.item,leadingSection:e.leadingSection,section:e.section,trailingItem:e.trailingItem,trailingSection:e.trailingSection}),leadingSeparatorProps:_objectSpread({},t.leadingSeparatorProps,{leadingItem:e.leadingItem,leadingSection:e.leadingSection,section:e.section,trailingItem:e.item,trailingSection:e.trailingSection})}};var t=e.prototype;return t.updateSeparatorProps=function(t){this.setState(function(e){return{separatorProps:_objectSpread({},e.separatorProps,{},t)}})},t.render=function(){var e=this.props,t=e.LeadingSeparatorComponent,r=e.SeparatorComponent,n=e.item,i=e.index,o=e.section,a=this.props.renderItem({item:n,index:i,section:o,separators:this._separators}),s=t&&React.createElement(t,this.state.leadingSeparatorProps),c=r&&React.createElement(r,this.state.separatorProps);return s||c?React.createElement(_View.default,null,s,a,c):a},e}(React.Component);function _getItem(e,t,r){if(!t)return null;for(var n=r-1,i=0;i<t.length;i++){var o=t[i],a=o.data,s=e.getItemCount(a);if(-1===n||n===s)return o;if(n<s)return e.getItem(a,n);n-=s+2}return null}var _default=VirtualizedSectionList;exports.default=VirtualizedSectionList,module.exports=exports.default;