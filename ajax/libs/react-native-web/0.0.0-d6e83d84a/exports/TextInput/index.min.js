import{forwardRef,useRef}from"react";import createElement from"../createElement";import css from"../StyleSheet/css";import pick from"../../modules/pick";import setAndForwardRef from"../../modules/setAndForwardRef";import useElementLayout from"../../hooks/useElementLayout";import useLayoutEffect from"../../hooks/useLayoutEffect";import usePlatformMethods from"../../hooks/usePlatformMethods";import useResponderEvents from"../../hooks/useResponderEvents";import StyleSheet from"../StyleSheet";import TextInputState from"../../modules/TextInputState";var isSelectionStale=function(e,t){var o=e.selectionEnd,n=e.selectionStart,r=t.start,a=t.end;return r!==n||a!==o},setSelection=function(e,t){if(isSelectionStale(e,t)){var o=t.start,n=t.end;try{e.setSelectionRange(o,n||o)}catch(e){}}},forwardPropsList={accessibilityLabel:!0,accessibilityLiveRegion:!0,accessibilityRole:!0,accessibilityState:!0,accessibilityValue:!0,accessible:!0,autoCapitalize:!0,autoComplete:!0,autoCorrect:!0,autoFocus:!0,children:!0,classList:!0,defaultValue:!0,dir:!0,disabled:!0,importantForAccessibility:!0,maxLength:!0,nativeID:!0,onBlur:!0,onChange:!0,onClick:!0,onClickCapture:!0,onContextMenu:!0,onFocus:!0,onScroll:!0,onTouchCancel:!0,onTouchCancelCapture:!0,onTouchEnd:!0,onTouchEndCapture:!0,onTouchMove:!0,onTouchMoveCapture:!0,onTouchStart:!0,onTouchStartCapture:!0,placeholder:!0,pointerEvents:!0,readOnly:!0,ref:!0,rows:!0,spellCheck:!0,style:!0,value:!0,testID:!0,type:!0,dataSet:!0,onMouseDown:!0,onMouseEnter:!0,onMouseLeave:!0,onMouseMove:!0,onMouseOver:!0,onMouseOut:!0,onMouseUp:!0},pickProps=function(e){return pick(e,forwardPropsList)};function isEventComposing(e){return e.isComposing||229===e.keyCode}var TextInput=forwardRef(function(e,t){var o,n,r=e.autoCapitalize,a=void 0===r?"sentences":r,u=e.autoComplete,s=e.autoCompleteType,l=e.autoCorrect,i=void 0===l||l,c=e.blurOnSubmit,d=e.clearTextOnFocus,p=e.dir,S=e.editable,h=void 0===S||S,v=e.keyboardType,f=void 0===v?"default":v,m=e.multiline,R=void 0!==m&&m,C=e.numberOfLines,y=void 0===C?1:C,g=e.onBlur,x=e.onChange,E=e.onChangeText,T=e.onContentSizeChange,b=e.onFocus,k=e.onKeyPress,M=e.onLayout,w=e.onMoveShouldSetResponder,F=e.onMoveShouldSetResponderCapture,L=e.onResponderEnd,I=e.onResponderGrant,P=e.onResponderMove,z=e.onResponderReject,O=e.onResponderRelease,A=e.onResponderStart,D=e.onResponderTerminate,K=e.onResponderTerminationRequest,N=e.onScrollShouldSetResponder,B=e.onScrollShouldSetResponderCapture,_=e.onSelectionChange,j=e.onSelectionChangeShouldSetResponder,q=e.onSelectionChangeShouldSetResponderCapture,G=e.onStartShouldSetResponder,V=e.onStartShouldSetResponderCapture,W=e.onSubmitEditing,H=e.placeholderTextColor,U=e.returnKeyType,J=e.secureTextEntry,Q=void 0!==J&&J,X=e.selection,Y=e.selectTextOnFocus,Z=e.spellCheck;switch(f){case"email-address":o="email";break;case"number-pad":case"numeric":n="numeric";break;case"decimal-pad":n="decimal";break;case"phone-pad":o="tel";break;case"search":case"web-search":o="search";break;case"url":o="url";break;default:o="text"}Q&&(o="password");var $=useRef(null),ee=useRef({height:null,width:null}),te=setAndForwardRef({getForwardedRef:function(){return t},setLocalRef:function(e){null!=e&&(e.clear=function(){null!=e&&(e.value="")},e.isFocused=function(){return null!=e&&TextInputState.currentlyFocusedField()===e}),$.current=e,null!=$.current&&oe()}});function oe(){var e=$.current;if(R&&T&&null!=e){var t=e.scrollHeight,o=e.scrollWidth;t===ee.current.height&&o===ee.current.width||(ee.current.height=t,ee.current.width=o,T({nativeEvent:{contentSize:{height:ee.current.height,width:ee.current.width}}}))}}useLayoutEffect(function(){var e=$.current;null!=e&&null!=X&&setSelection(e,X),document.activeElement===e&&(TextInputState._currentlyFocusedNode=e)},[$,X]);var ne=R?"textarea":"input",re=[classes.textinput],ae=StyleSheet.compose(e.style,H&&{placeholderTextColor:H});useElementLayout($,M),useResponderEvents($,{onMoveShouldSetResponder:w,onMoveShouldSetResponderCapture:F,onResponderEnd:L,onResponderGrant:I,onResponderMove:P,onResponderReject:z,onResponderRelease:O,onResponderStart:A,onResponderTerminate:D,onResponderTerminationRequest:K,onScrollShouldSetResponder:N,onScrollShouldSetResponderCapture:B,onSelectionChangeShouldSetResponder:j,onSelectionChangeShouldSetResponderCapture:q,onStartShouldSetResponder:G,onStartShouldSetResponderCapture:V});var ue=pickProps(e);return ue.autoCapitalize=a,ue.autoComplete=u||s||"on",ue.autoCorrect=i?"on":"off",ue.classList=re,ue.dir=void 0!==p?p:"auto",ue.enterkeyhint=U,ue.onBlur=function(e){TextInputState._currentlyFocusedNode=null,g&&(e.nativeEvent.text=e.target.value,g(e))},ue.onChange=function(e){var t=e.target.value;e.nativeEvent.text=t,oe(),x&&x(e),E&&E(t)},ue.onFocus=function(e){var t=$.current;null!=t&&(TextInputState._currentlyFocusedNode=t,b&&(e.nativeEvent.text=e.target.value,b(e)),d&&(t.value=""),Y&&t.select())},ue.onKeyDown=function(e){e.stopPropagation();var t=null==c?!R:c,o=e.nativeEvent,n=isEventComposing(o);k&&k(e),"Enter"!==e.key||e.shiftKey||n||e.isDefaultPrevented()||(!c&&R||!W||(e.preventDefault(),o.text=e.target.value,W(e)),t&&null!=$.current&&$.current.blur())},ue.onSelect=function(e){if(_)try{var t=e.target,o=t.selectionStart,n=t.selectionEnd;e.nativeEvent.selection={start:o,end:n},e.nativeEvent.text=e.target.value,_(e)}catch(e){}},ue.readOnly=!h,ue.ref=te,ue.rows=R?y:void 0,ue.spellCheck=null!=Z?Z:i,ue.style=ae,ue.type=R?void 0:o,ue.inputMode=n,usePlatformMethods($,ue),createElement(ne,ue)});TextInput.displayName="TextInput",TextInput.State=TextInputState;var classes=css.create({textinput:{MozAppearance:"textfield",WebkitAppearance:"none",backgroundColor:"transparent",border:"0 solid black",borderRadius:0,boxSizing:"border-box",font:"14px System",margin:0,padding:0,resize:"none"}});export default TextInput;