"use strict";exports.__esModule=!0,exports.default=void 0;var _AnimatedNode=_interopRequireDefault(require("./AnimatedNode")),_AnimatedWithChildren2=_interopRequireDefault(require("./AnimatedWithChildren")),_NativeAnimatedHelper=_interopRequireDefault(require("../NativeAnimatedHelper")),_invariant=_interopRequireDefault(require("fbjs/lib/invariant")),_normalizeCssColor=_interopRequireDefault(require("normalize-css-color"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).__proto__=e}function ownKeys(e,t){var n,r=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)),r}function _objectSpread(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function _defineProperty(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var linear=function(t){return t};function createInterpolation(t){if(t.outputRange&&"string"==typeof t.outputRange[0])return createInterpolationFromStringOutputRange(t);var n=t.outputRange;checkInfiniteRange("outputRange",n);var r=t.inputRange;checkInfiniteRange("inputRange",r),checkValidInputRange(r),(0,_invariant.default)(r.length===n.length,"inputRange ("+r.length+") and outputRange ("+n.length+") must have the same length");var a=t.easing||linear,i="extend";void 0!==t.extrapolateLeft?i=t.extrapolateLeft:void 0!==t.extrapolate&&(i=t.extrapolate);var o="extend";return void 0!==t.extrapolateRight?o=t.extrapolateRight:void 0!==t.extrapolate&&(o=t.extrapolate),function(t){(0,_invariant.default)("number"==typeof t,"Cannot interpolation an input which is not a number");var e=findRange(t,r);return interpolate(t,r[e],r[e+1],n[e],n[e+1],a,i,o)}}function interpolate(t,e,n,r,a,i,o,u){var p=t;if(p<e){if("identity"===o)return p;"clamp"===o&&(p=e)}if(n<p){if("identity"===u)return p;"clamp"===u&&(p=n)}return r===a?r:e===n?t<=e?r:a:(e===-1/0?p=-p:n===1/0?p-=e:p=(p-e)/(n-e),p=i(p),r===-1/0?p=-p:a===1/0?p+=r:p=p*(a-r)+r,p)}function colorToRgba(t){var e=(0,_normalizeCssColor.default)(t);return null===e?t:"rgba("+((4278190080&(e=e||0))>>>24)+", "+((16711680&e)>>>16)+", "+((65280&e)>>>8)+", "+(255&e)/255+")"}var stringShapeRegex=/[+-]?(?:\d+\.?\d*|\.\d+)(?:[eE][+-]?\d+)?/g;function createInterpolationFromStringOutputRange(n){var t=n.outputRange;(0,_invariant.default)(2<=t.length,"Bad output range"),checkPattern(t=t.map(colorToRgba));var r=t[0].match(stringShapeRegex).map(function(){return[]});t.forEach(function(t){t.match(stringShapeRegex).forEach(function(t,e){r[e].push(+t)})});var a=t[0].match(stringShapeRegex).map(function(t,e){return createInterpolation(_objectSpread({},n,{outputRange:r[e]}))}),i=isRgbOrRgba(t[0]);return function(e){var n=0;return t[0].replace(stringShapeRegex,function(){var t=+a[n++](e);return i&&(t=n<4?Math.round(t):Math.round(1e3*t)/1e3),String(t)})}}function isRgbOrRgba(t){return"string"==typeof t&&t.startsWith("rgb")}function checkPattern(t){for(var e=t[0].replace(stringShapeRegex,""),n=1;n<t.length;++n)(0,_invariant.default)(e===t[n].replace(stringShapeRegex,""),"invalid pattern "+t[0]+" and "+t[n])}function findRange(t,e){for(var n=1;n<e.length-1&&!(e[n]>=t);++n);return n-1}function checkValidInputRange(t){(0,_invariant.default)(2<=t.length,"inputRange must have at least 2 elements");for(var e=1;e<t.length;++e)(0,_invariant.default)(t[e]>=t[e-1],"inputRange must be monotonically non-decreasing "+t)}function checkInfiniteRange(t,e){(0,_invariant.default)(2<=e.length,t+" must have at least 2 elements"),(0,_invariant.default)(2!==e.length||e[0]!==-1/0||e[1]!==1/0,t+"cannot be ]-infinity;+infinity[ "+e)}var AnimatedInterpolation=function(r){function e(t,e){var n=r.call(this)||this;return n._parent=t,n._config=e,n._interpolation=createInterpolation(e),n}_inheritsLoose(e,r);var t=e.prototype;return t.__makeNative=function(){this._parent.__makeNative(),r.prototype.__makeNative.call(this)},t.__getValue=function(){var t=this._parent.__getValue();return(0,_invariant.default)("number"==typeof t,"Cannot interpolate an input which is not a number."),this._interpolation(t)},t.interpolate=function(t){return new e(this,t)},t.__attach=function(){this._parent.__addChild(this)},t.__detach=function(){this._parent.__removeChild(this),r.prototype.__detach.call(this)},t.__transformDataType=function(t){return t.map(_NativeAnimatedHelper.default.transformDataType)},t.__getNativeConfig=function(){return"production"!==process.env.NODE_ENV&&_NativeAnimatedHelper.default.validateInterpolation(this._config),{inputRange:this._config.inputRange,outputRange:this.__transformDataType(this._config.outputRange),extrapolateLeft:this._config.extrapolateLeft||this._config.extrapolate||"extend",extrapolateRight:this._config.extrapolateRight||this._config.extrapolate||"extend",type:"interpolation"}},e}(_AnimatedWithChildren2.default);AnimatedInterpolation.__createInterpolation=createInterpolation;var _default=AnimatedInterpolation;exports.default=AnimatedInterpolation,module.exports=exports.default;