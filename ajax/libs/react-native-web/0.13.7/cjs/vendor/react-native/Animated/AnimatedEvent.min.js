"use strict";exports.__esModule=!0,exports.attachNativeEvent=attachNativeEvent,exports.default=exports.AnimatedEvent=void 0;var _AnimatedValue=_interopRequireDefault(require("./nodes/AnimatedValue")),_NativeAnimatedHelper=_interopRequireDefault(require("./NativeAnimatedHelper")),_findNodeHandle=_interopRequireDefault(require("../../../exports/findNodeHandle")),_invariant=_interopRequireDefault(require("fbjs/lib/invariant"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var shouldUseNativeDriver=_NativeAnimatedHelper.default.shouldUseNativeDriver;function attachNativeEvent(e,t,i){var n=[];(0,_invariant.default)(i[0]&&i[0].nativeEvent,"Native driven events only support animated values contained inside `nativeEvent`."),function e(t,i){if(t instanceof _AnimatedValue.default)t.__makeNative(),n.push({nativeEventPath:i,animatedValueTag:t.__getNativeTag()});else if("object"==typeof t)for(var a in t)e(t[a],i.concat(a))}(i[0].nativeEvent,[]);var a=(0,_findNodeHandle.default)(e);return n.forEach(function(e){_NativeAnimatedHelper.default.API.addAnimatedEventToView(a,t,e)}),{detach:function(){n.forEach(function(e){_NativeAnimatedHelper.default.API.removeAnimatedEventFromView(a,t,e.animatedValueTag)})}}}var AnimatedEvent=function(){function e(e,t){void 0===t&&(t={}),this._listeners=[],this._argMapping=e,t.listener&&this.__addListener(t.listener),this._callListeners=this._callListeners.bind(this),this._attachedEvent=null,this.__isNative=shouldUseNativeDriver(t),"production"!==process.env.NODE_ENV&&this._validateMapping()}var t=e.prototype;return t.__addListener=function(e){this._listeners.push(e)},t.__removeListener=function(t){this._listeners=this._listeners.filter(function(e){return e!==t})},t.__attach=function(e,t){(0,_invariant.default)(this.__isNative,"Only native driven events need to be attached."),this._attachedEvent=attachNativeEvent(e,t,this._argMapping)},t.__detach=function(){(0,_invariant.default)(this.__isNative,"Only native driven events need to be detached."),this._attachedEvent&&this._attachedEvent.detach()},t.__getHandler=function(){var a=this;return this.__isNative?this._callListeners:function(){for(var e=arguments.length,i=new Array(e),t=0;t<e;t++)i[t]=arguments[t];a.__isNative||a._argMapping.forEach(function(e,t){!function e(t,i){if("number"==typeof i&&t instanceof _AnimatedValue.default)t.setValue(i);else if("object"==typeof t)for(var a in t)e(t[a],i[a])}(e,i[t])}),a._callListeners.apply(a,i)}},t._callListeners=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this._listeners.forEach(function(e){return e.apply(void 0,t)})},t._validateMapping=function(){},e}(),_default={AnimatedEvent:exports.AnimatedEvent=AnimatedEvent,attachNativeEvent:attachNativeEvent};exports.default=_default;