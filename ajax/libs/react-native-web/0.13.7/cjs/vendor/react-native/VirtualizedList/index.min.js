"use strict";exports.__esModule=!0,exports.default=void 0;var _Batchinator=_interopRequireDefault(require("../Batchinator")),_FillRateHelper=_interopRequireDefault(require("../FillRateHelper")),_propTypes=_interopRequireDefault(require("prop-types")),React=_interopRequireWildcard(require("react")),_RefreshControl=_interopRequireDefault(require("../../../exports/RefreshControl")),_ScrollView=_interopRequireDefault(require("../../../exports/ScrollView")),_StyleSheet=_interopRequireDefault(require("../../../exports/StyleSheet")),_UIManager=_interopRequireDefault(require("../../../exports/UIManager")),_View=_interopRequireDefault(require("../../../exports/View")),_ViewabilityHelper=_interopRequireDefault(require("../ViewabilityHelper")),_findNodeHandle=_interopRequireDefault(require("../../../exports/findNodeHandle")),_infoLog=_interopRequireDefault(require("../infoLog")),_invariant=_interopRequireDefault(require("fbjs/lib/invariant")),_warning=_interopRequireDefault(require("fbjs/lib/warning")),_VirtualizeUtils=require("../VirtualizeUtils");function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var r,i={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e){Object.prototype.hasOwnProperty.call(e,o)&&((r=s?Object.getOwnPropertyDescriptor(e,o):null)&&(r.get||r.set)?Object.defineProperty(i,o,r):i[o]=e[o])}return i.default=e,t&&t.set(e,i),i}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _extends(){return(_extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function ownKeys(t,e){var r,i=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,r)),i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){_defineProperty(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),(e.prototype.constructor=e).__proto__=t}var flattenStyle=_StyleSheet.default.flatten,__DEV__="production"!==process.env.NODE_ENV,_usedIndexForKey=!1,_keylessItemComponentName="",VirtualizedList=function(s){_inheritsLoose(t,s);var e=t.prototype;function t(e,t){var b=s.call(this,e,t)||this;b._getScrollMetrics=function(){return b._scrollMetrics},b._getOutermostParentListRef=function(){return b._isNestedWithSameOrientation()?b.context.virtualizedList.getOutermostParentListRef():_assertThisInitialized(b)},b._getNestedChildState=function(e){var t=b._nestedChildLists.get(e);return t&&t.state},b._registerAsNestedChild=function(e){var t=b._cellKeysToChildListKeys.get(e.cellKey)||new Set;t.add(e.key),b._cellKeysToChildListKeys.set(e.cellKey,t);var r=b._nestedChildLists.get(e.key);r&&null!==r.ref&&console.error("A VirtualizedList contains a cell which itself contains more than one VirtualizedList of the same orientation as the parent list. You must pass a unique listKey prop to each sibling list."),b._nestedChildLists.set(e.key,{ref:e.ref,state:null}),b._hasInteracted&&e.ref.recordInteraction()},b._unregisterAsNestedChild=function(e){b._nestedChildLists.set(e.key,{ref:null,state:e.state})},b._onUpdateSeparators=function(e,r){e.forEach(function(e){var t=null!=e&&b._cellRefs[e];t&&t.updateSeparatorProps(r)})},b._averageCellLength=0,b._cellKeysToChildListKeys=new Map,b._cellRefs={},b._frames={},b._footerLength=0,b._hasDataChangedSinceEndReached=!0,b._hasDoneInitialScroll=!1,b._hasInteracted=!1,b._hasMore=!1,b._hasWarned={},b._headerLength=0,b._hiPriInProgress=!1,b._highestMeasuredFrameIndex=0,b._indicesToKeys=new Map,b._nestedChildLists=new Map,b._offsetFromParentVirtualizedList=0,b._prevParentOffset=0,b._scrollMetrics={contentLength:0,dOffset:0,dt:10,offset:0,timestamp:0,velocity:0,visibleLength:0},b._scrollRef=null,b._sentEndForContentLength=0,b._totalCellLength=0,b._totalCellsMeasured=0,b._viewabilityTuples=[],b._captureScrollRef=function(e){b._scrollRef=e},b._defaultRenderScrollComponent=function(e){var t=e.onRefresh;return b._isNestedWithSameOrientation()?React.createElement(_View.default,e):t?((0,_invariant.default)("boolean"==typeof e.refreshing,"`refreshing` prop must be set as a boolean in order to use `onRefresh`, but got `"+JSON.stringify(e.refreshing)+"`"),React.createElement(_ScrollView.default,_extends({},e,{refreshControl:null==e.refreshControl?React.createElement(_RefreshControl.default,{refreshing:e.refreshing,onRefresh:t,progressViewOffset:e.progressViewOffset}):e.refreshControl}))):React.createElement(_ScrollView.default,e)},b._onCellUnmount=function(e){var t=b._frames[e];t&&(b._frames[e]=_objectSpread({},t,{inLayout:!1}))},b._onLayout=function(e){b._isNestedWithSameOrientation()?b.measureLayoutRelativeToContainingList():b._scrollMetrics.visibleLength=b._selectLength(e.nativeEvent.layout),b.props.onLayout&&b.props.onLayout(e),b._scheduleCellsToRenderUpdate(),b._maybeCallOnEndReached()},b._onLayoutEmpty=function(e){b.props.onLayout&&b.props.onLayout(e)},b._onLayoutFooter=function(e){b._footerLength=b._selectLength(e.nativeEvent.layout)},b._onLayoutHeader=function(e){b._headerLength=b._selectLength(e.nativeEvent.layout)},b._onContentSizeChange=function(e,t){0<e&&0<t&&null!=b.props.initialScrollIndex&&0<b.props.initialScrollIndex&&!b._hasDoneInitialScroll&&(b.scrollToIndex({animated:!1,index:b.props.initialScrollIndex}),b._hasDoneInitialScroll=!0),b.props.onContentSizeChange&&b.props.onContentSizeChange(e,t),b._scrollMetrics.contentLength=b._selectLength({height:t,width:e}),b._scheduleCellsToRenderUpdate(),b._maybeCallOnEndReached()},b._convertParentScrollMetrics=function(e){var t=e.offset-b._offsetFromParentVirtualizedList,r=e.visibleLength,i=t-b._scrollMetrics.offset;return{visibleLength:r,contentLength:b._scrollMetrics.contentLength,offset:t,dOffset:i}},b._onScroll=function(t){b._nestedChildLists.forEach(function(e){e.ref&&e.ref._onScroll(t)}),b.props.onScroll&&b.props.onScroll(t);var e=t.timeStamp,r=b._selectLength(t.nativeEvent.layoutMeasurement),i=b._selectLength(t.nativeEvent.contentSize),s=(n=b._selectOffset(t.nativeEvent.contentOffset))-b._scrollMetrics.offset;if(b._isNestedWithSameOrientation()){if(0===b._scrollMetrics.contentLength)return;var o=b._convertParentScrollMetrics({visibleLength:r,offset:n}),r=o.visibleLength,i=o.contentLength,n=o.offset,s=o.dOffset}var l=b._scrollMetrics.timestamp?Math.max(1,e-b._scrollMetrics.timestamp):1,a=s/l;500<l&&500<b._scrollMetrics.dt&&5*r<i&&!b._hasWarned.perf&&((0,_infoLog.default)("VirtualizedList: You have a large list that is slow to update - make sure your renderItem function renders components that follow React performance best practices like PureComponent, shouldComponentUpdate, etc.",{dt:l,prevDt:b._scrollMetrics.dt,contentLength:i}),b._hasWarned.perf=!0),b._scrollMetrics={contentLength:i,dt:l,dOffset:s,offset:n,timestamp:e,velocity:a,visibleLength:r},b._updateViewableItems(b.props.data),b.props&&(b._maybeCallOnEndReached(),0!=a&&b._fillRateHelper.activate(),b._computeBlankness(),b._scheduleCellsToRenderUpdate())},b._onScrollBeginDrag=function(t){b._nestedChildLists.forEach(function(e){e.ref&&e.ref._onScrollBeginDrag(t)}),b._viewabilityTuples.forEach(function(e){e.viewabilityHelper.recordInteraction()}),b._hasInteracted=!0,b.props.onScrollBeginDrag&&b.props.onScrollBeginDrag(t)},b._onScrollEndDrag=function(e){var t=e.nativeEvent.velocity;t&&(b._scrollMetrics.velocity=b._selectOffset(t)),b._computeBlankness(),b.props.onScrollEndDrag&&b.props.onScrollEndDrag(e)},b._onMomentumScrollEnd=function(e){b._scrollMetrics.velocity=0,b._computeBlankness(),b.props.onMomentumScrollEnd&&b.props.onMomentumScrollEnd(e)},b._updateCellsToRender=function(){var e=b.props,m=e.data,v=e.getItemCount,C=e.onEndReachedThreshold,L=b._isVirtualizationDisabled();b._updateViewableItems(m),m&&b.setState(function(e){var t,r,i,s,o,n;if(L?(r=(t=b._scrollMetrics).contentLength,i=t.offset,o=r-(s=t.visibleLength)-i<C*s?b.props.maxToRenderPerBatch:0,n={first:0,last:Math.min(e.last+o,v(m)-1)}):b._scrollMetrics.visibleLength&&(b.props.initialScrollIndex&&!b._scrollMetrics.offset||(n=(0,_VirtualizeUtils.computeWindowedRenderLimits)(b.props,e,b._getFrameMetricsApprox,b._scrollMetrics))),n&&0<b._nestedChildLists.size)for(var l=n.first,a=n.last,c=l;c<=a;c++){var p=b._indicesToKeys.get(c),h=p&&b._cellKeysToChildListKeys.get(p);if(h){for(var d,u=!1,f=h,_=Array.isArray(f),g=0,f=_?f:f[Symbol.iterator]();;){if(_){if(g>=f.length)break;d=f[g++]}else{if((g=f.next()).done)break;d=g.value}var y=b._nestedChildLists.get(d);if(y&&y.ref&&y.ref.hasMore()){u=!0;break}}if(u){n.last=c;break}}}return n})},b._createViewToken=function(e,t){var r=b.props,i=r.data,s=r.getItem,o=r.keyExtractor,n=s(i,e);return{index:e,item:n,key:o(n,e),isViewable:t}},b._getFrameMetricsApprox=function(e){var t=b._getFrameMetrics(e);if(t&&t.index===e)return t;var r=b.props.getItemLayout;return(0,_invariant.default)(!r,"Should not have to estimate frames when a measurement metrics function is provided"),{length:b._averageCellLength,offset:b._averageCellLength*e}},b._getFrameMetrics=function(e){var t=b.props,r=t.data,i=t.getItem,s=t.getItemCount,o=t.getItemLayout,n=t.keyExtractor;(0,_invariant.default)(s(r)>e,"Tried to get frame for out of range index "+e);var l,a=i(r,e),c=a&&b._frames[n(a,e)];return c&&c.index===e||o&&(c=o(r,e),__DEV__&&(l=_propTypes.default.shape({length:_propTypes.default.number.isRequired,offset:_propTypes.default.number.isRequired,index:_propTypes.default.number.isRequired}).isRequired,_propTypes.default.checkPropTypes({frame:l},{frame:c},"frame","VirtualizedList.getItemLayout"))),c},(0,_invariant.default)(!e.onScroll||!e.onScroll.__isNative,"Components based on VirtualizedList must be wrapped with Animated.createAnimatedComponent to support native onScroll events with useNativeDriver"),(0,_invariant.default)(0<e.windowSize,"VirtualizedList: The windowSize prop must be present and set to a value greater than 0."),b._fillRateHelper=new _FillRateHelper.default(b._getFrameMetrics),b._updateCellsToRenderBatcher=new _Batchinator.default(b._updateCellsToRender,b.props.updateCellsBatchingPeriod),b.props.viewabilityConfigCallbackPairs?b._viewabilityTuples=b.props.viewabilityConfigCallbackPairs.map(function(e){return{viewabilityHelper:new _ViewabilityHelper.default(e.viewabilityConfig),onViewableItemsChanged:e.onViewableItemsChanged}}):b.props.onViewableItemsChanged&&b._viewabilityTuples.push({viewabilityHelper:new _ViewabilityHelper.default(b.props.viewabilityConfig),onViewableItemsChanged:b.props.onViewableItemsChanged});var r,i={first:b.props.initialScrollIndex||0,last:Math.min(b.props.getItemCount(b.props.data),(b.props.initialScrollIndex||0)+b.props.initialNumToRender)-1};return!b._isNestedWithSameOrientation()||(r=b.context.virtualizedList.getNestedChildState(b.props.listKey||b._getCellKey()))&&(i=r,b.state=r,b._frames=r.frames),b.state=i,b}return e.scrollToEnd=function(e){var t=!e||e.animated,r=this.props.getItemCount(this.props.data)-1,i=this._getFrameMetricsApprox(r),s=Math.max(0,i.offset+i.length+this._footerLength-this._scrollMetrics.visibleLength);this._scrollRef.scrollTo(this.props.horizontal?{x:s,animated:t}:{y:s,animated:t})},e.scrollToIndex=function(e){var t=this.props,r=t.data,i=t.horizontal,s=t.getItemCount,o=t.getItemLayout,n=t.onScrollToIndexFailed,l=e.animated,a=e.index,c=e.viewOffset,p=e.viewPosition;if((0,_invariant.default)(0<=a&&a<s(r),"scrollToIndex out of range: "+a+" vs "+(s(r)-1)),!o&&a>this._highestMeasuredFrameIndex)return(0,_invariant.default)(!!n,"scrollToIndex should be used in conjunction with getItemLayout or onScrollToIndexFailed, otherwise there is no way to know the location of offscreen indices or handle failures."),void n({averageItemLength:this._averageCellLength,highestMeasuredFrameIndex:this._highestMeasuredFrameIndex,index:a});var h=this._getFrameMetricsApprox(a),d=Math.max(0,h.offset-(p||0)*(this._scrollMetrics.visibleLength-h.length))-(c||0);this._scrollRef.scrollTo(i?{x:d,animated:l}:{y:d,animated:l})},e.scrollToItem=function(e){for(var t=e.item,r=this.props,i=r.data,s=r.getItem,o=(0,r.getItemCount)(i),n=0;n<o;n++)if(s(i,n)===t){this.scrollToIndex(_objectSpread({},e,{index:n}));break}},e.scrollToOffset=function(e){var t=e.animated,r=e.offset;this._scrollRef.scrollTo(this.props.horizontal?{x:r,animated:t}:{y:r,animated:t})},e.recordInteraction=function(){this._nestedChildLists.forEach(function(e){e.ref&&e.ref.recordInteraction()}),this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.recordInteraction()}),this._updateViewableItems(this.props.data)},e.flashScrollIndicators=function(){this._scrollRef.flashScrollIndicators()},e.getScrollResponder=function(){if(this._scrollRef&&this._scrollRef.getScrollResponder)return this._scrollRef.getScrollResponder()},e.getScrollableNode=function(){return this._scrollRef&&this._scrollRef.getScrollableNode?this._scrollRef.getScrollableNode():(0,_findNodeHandle.default)(this._scrollRef)},e.getScrollRef=function(){return this._scrollRef&&this._scrollRef.getScrollRef?this._scrollRef.getScrollRef():this._scrollRef},e.setNativeProps=function(e){this._scrollRef&&this._scrollRef.setNativeProps(e)},e.getChildContext=function(){return{virtualizedList:{getScrollMetrics:this._getScrollMetrics,horizontal:this.props.horizontal,getOutermostParentListRef:this._getOutermostParentListRef,getNestedChildState:this._getNestedChildState,registerAsNestedChild:this._registerAsNestedChild,unregisterAsNestedChild:this._unregisterAsNestedChild}}},e._getCellKey=function(){return this.context.virtualizedCell&&this.context.virtualizedCell.cellKey||"rootList"},e.hasMore=function(){return this._hasMore},e.componentDidMount=function(){this._isNestedWithSameOrientation()&&this.context.virtualizedList.registerAsNestedChild({cellKey:this._getCellKey(),key:this.props.listKey||this._getCellKey(),ref:this})},e.componentWillUnmount=function(){this._isNestedWithSameOrientation()&&this.context.virtualizedList.unregisterAsNestedChild({key:this.props.listKey||this._getCellKey(),state:{first:this.state.first,last:this.state.last,frames:this._frames}}),this._updateViewableItems(null),this._updateCellsToRenderBatcher.dispose({abort:!0}),this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.dispose()}),this._fillRateHelper.deactivateAndFlush()},t.getDerivedStateFromProps=function(e,t){var r=e.data,i=e.getItemCount,s=e.maxToRenderPerBatch;return{first:Math.max(0,Math.min(t.first,i(r)-1-s)),last:Math.max(0,Math.min(t.last,i(r)-1))}},e._pushCells=function(i,s,o,e,t,n){var l,a=this,r=this.props,c=r.CellRendererComponent,p=r.ItemSeparatorComponent,h=r.data,d=r.getItem,u=r.getItemCount,f=r.horizontal,_=r.keyExtractor,g=this.props.ListHeaderComponent?1:0,y=u(h)-1;t=Math.min(y,t);for(var m=function(t){var e=d(h,t),r=_(e,t);a._indicesToKeys.set(t,r),o.has(t+g)&&s.push(i.length),i.push(React.createElement(CellRenderer,{CellRendererComponent:c,ItemSeparatorComponent:t<y?p:void 0,cellKey:r,fillRateHelper:a._fillRateHelper,horizontal:f,index:t,inversionStyle:n,item:e,key:r,prevCellKey:l,onUpdateSeparators:a._onUpdateSeparators,onLayout:function(e){return a._onCellLayout(e,r,t)},onUnmount:a._onCellUnmount,parentProps:a.props,ref:function(e){a._cellRefs[r]=e}})),l=r},v=e;v<=t;v++)m(v)},e._isVirtualizationDisabled=function(){return this.props.disableVirtualization||!1},e._isNestedWithSameOrientation=function(){var e=this.context.virtualizedList;return!(!e||!!e.horizontal!=!!this.props.horizontal)},e.render=function(){var e,t=this;__DEV__&&(e=flattenStyle(this.props.contentContainerStyle),(0,_warning.default)(null==e||"wrap"!==e.flexWrap,"`flexWrap: `wrap`` is not supported with the `VirtualizedList` components.Consider using `numColumns` with `FlatList` instead."));var r,i=this.props,s=i.ListEmptyComponent,o=i.ListFooterComponent,n=i.ListHeaderComponent,l=this.props,a=l.data,c=l.horizontal,p=this._isVirtualizationDisabled(),h=this.props.inverted?this.props.horizontal?styles.horizontallyInverted:styles.verticallyInverted:null,d=[],u=new Set(this.props.stickyHeaderIndices),f=[];n&&(u.has(0)&&f.push(0),r=React.isValidElement(n)?n:React.createElement(n,null),d.push(React.createElement(VirtualizedCellWrapper,{cellKey:this._getCellKey()+"-header",key:"$header"},React.createElement(_View.default,{onLayout:this._onLayoutHeader,style:_StyleSheet.default.compose(h,this.props.ListHeaderComponentStyle)},r))));var _,g,y=this.props.getItemCount(a);if(0<y){_usedIndexForKey=!1,_keylessItemComponentName="";var m=c?"width":"height",v=this.props.initialScrollIndex?-1:this.props.initialNumToRender-1,C=this.state,L=C.first,b=C.last;this._pushCells(d,f,u,0,v,h);var R,S,w,x,M,I=Math.max(1+v,L);if(!p&&1+v<L){var T,E,O,V=!1;if(0<u.size)for(var z=n?1:0,k=I-1;v<k;k--)if(u.has(k+z)){var P,D,F=this._getFrameMetricsApprox(v),K=this._getFrameMetricsApprox(k),N=K.offset-F.offset-(this.props.initialScrollIndex?0:F.length);d.push(React.createElement(_View.default,{key:"$sticky_lead",style:((P={})[m]=N,P)})),this._pushCells(d,f,u,k,k,h);var q=this._getFrameMetricsApprox(L).offset-(K.offset+K.length);d.push(React.createElement(_View.default,{key:"$sticky_trail",style:((D={})[m]=q,D)})),V=!0;break}V||(E=this._getFrameMetricsApprox(v),O=this._getFrameMetricsApprox(L).offset-(E.offset+E.length),d.push(React.createElement(_View.default,{key:"$lead_spacer",style:((T={})[m]=O,T)})))}this._pushCells(d,f,u,I,b,h),!this._hasWarned.keys&&_usedIndexForKey&&(console.warn("VirtualizedList: missing keys for items, make sure to specify a key or id property on each item or provide a custom keyExtractor.",_keylessItemComponentName),this._hasWarned.keys=!0),!p&&b<y-1&&(S=this._getFrameMetricsApprox(b),w=this.props.getItemLayout?y-1:Math.min(y-1,this._highestMeasuredFrameIndex),M=(x=this._getFrameMetricsApprox(w)).offset+x.length-(S.offset+S.length),d.push(React.createElement(_View.default,{key:"$tail_spacer",style:((R={})[m]=M,R)})))}else{s&&(_=React.isValidElement(s)?s:React.createElement(s,null),d.push(React.cloneElement(_,{key:"$empty",onLayout:function(e){t._onLayoutEmpty(e),_.props.onLayout&&_.props.onLayout(e)},style:_StyleSheet.default.compose(h,_.props.style)})))}o&&(g=React.isValidElement(o)?o:React.createElement(o,null),d.push(React.createElement(VirtualizedCellWrapper,{cellKey:this._getCellKey()+"-footer",key:"$footer"},React.createElement(_View.default,{onLayout:this._onLayoutFooter,style:_StyleSheet.default.compose(h,this.props.ListFooterComponentStyle)},g))));var A=_objectSpread({},this.props,{onContentSizeChange:this._onContentSizeChange,onLayout:this._onLayout,onScroll:this._onScroll,onScrollBeginDrag:this._onScrollBeginDrag,onScrollEndDrag:this._onScrollEndDrag,onMomentumScrollEnd:this._onMomentumScrollEnd,scrollEventThrottle:this.props.scrollEventThrottle,invertStickyHeaders:void 0!==this.props.invertStickyHeaders?this.props.invertStickyHeaders:this.props.inverted,stickyHeaderIndices:f});h&&(A.style=[h,this.props.style]),this._hasMore=this.state.last<this.props.getItemCount(this.props.data)-1;var H=React.cloneElement((this.props.renderScrollComponent||this._defaultRenderScrollComponent)(A),{ref:this._captureScrollRef},d);return this.props.debug?React.createElement(_View.default,{style:styles.debug},H,this._renderDebugOverlay()):H},e.componentDidUpdate=function(e){var t=this.props,r=t.data,i=t.extraData;r===e.data&&i===e.extraData||(this._hasDataChangedSinceEndReached=!0,this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.resetViewableIndices()}));var s=this._hiPriInProgress;this._scheduleCellsToRenderUpdate(),s&&(this._hiPriInProgress=!1)},e._computeBlankness=function(){this._fillRateHelper.computeBlankness(this.props,this.state,this._scrollMetrics)},e._onCellLayout=function(e,t,r){var i=e.nativeEvent.layout,s={offset:this._selectOffset(i),length:this._selectLength(i),index:r,inLayout:!0},o=this._frames[t];o&&s.offset===o.offset&&s.length===o.length&&r===o.index?this._frames[t].inLayout=!0:(this._totalCellLength+=s.length-(o?o.length:0),this._totalCellsMeasured+=o?0:1,this._averageCellLength=this._totalCellLength/this._totalCellsMeasured,this._frames[t]=s,this._highestMeasuredFrameIndex=Math.max(this._highestMeasuredFrameIndex,r),this._scheduleCellsToRenderUpdate());var n=this._cellKeysToChildListKeys.get(t);if(n)for(var l,a=n,c=Array.isArray(a),p=0,a=c?a:a[Symbol.iterator]();;){if(c){if(p>=a.length)break;l=a[p++]}else{if((p=a.next()).done)break;l=p.value}var h=this._nestedChildLists.get(l);h&&h.ref&&h.ref.measureLayoutRelativeToContainingList()}this._computeBlankness(),this._updateViewableItems(this.props.data)},e.measureLayoutRelativeToContainingList=function(){var o=this;try{if(!this._scrollRef)return;this._scrollRef.measureLayout(this.context.virtualizedList.getOutermostParentListRef().getScrollRef().getNativeScrollRef(),function(e,t,r,i){o._offsetFromParentVirtualizedList=o._selectOffset({x:e,y:t}),o._scrollMetrics.contentLength=o._selectLength({width:r,height:i});var s=o._convertParentScrollMetrics(o.context.virtualizedList.getScrollMetrics());o._scrollMetrics.visibleLength=s.visibleLength,o._scrollMetrics.offset=s.offset},function(e){console.warn("VirtualizedList: Encountered an error while measuring a list's offset from its containing VirtualizedList.")})}catch(e){console.warn("measureLayoutRelativeToContainingList threw an error",e.stack)}},e._renderDebugOverlay=function(){for(var r=this._scrollMetrics.visibleLength/(this._scrollMetrics.contentLength||1),e=[],t=this.props.getItemCount(this.props.data),i=0;i<t;i++){var s=this._getFrameMetricsApprox(i);s.inLayout&&e.push(s)}var o=this._getFrameMetricsApprox(this.state.first).offset,n=this._getFrameMetricsApprox(this.state.last),l=n.offset+n.length-o,a=this._scrollMetrics.offset,c=this._scrollMetrics.visibleLength;return React.createElement(_View.default,{style:[styles.debugOverlayBase,styles.debugOverlay]},e.map(function(e,t){return React.createElement(_View.default,{key:"f"+t,style:[styles.debugOverlayBase,styles.debugOverlayFrame,{top:e.offset*r,height:e.length*r}]})}),React.createElement(_View.default,{style:[styles.debugOverlayBase,styles.debugOverlayFrameLast,{top:o*r,height:l*r}]}),React.createElement(_View.default,{style:[styles.debugOverlayBase,styles.debugOverlayFrameVis,{top:a*r,height:c*r}]}))},e._selectLength=function(e){return this.props.horizontal?e.width:e.height},e._selectOffset=function(e){return this.props.horizontal?e.x:e.y},e._maybeCallOnEndReached=function(){var e=this.props,t=e.data,r=e.getItemCount,i=e.onEndReached,s=e.onEndReachedThreshold,o=this._scrollMetrics,n=o.contentLength,l=o.visibleLength,a=n-l-o.offset;i&&this.state.last===r(t)-1&&a<s*l&&(this._hasDataChangedSinceEndReached||this._scrollMetrics.contentLength!==this._sentEndForContentLength)&&(this._hasDataChangedSinceEndReached=!1,this._sentEndForContentLength=this._scrollMetrics.contentLength,i({distanceFromEnd:a}))},e._scheduleCellsToRenderUpdate=function(){var e,t,r=this.state,i=r.first,s=r.last,o=this._scrollMetrics,n=o.offset,l=o.visibleLength,a=o.velocity,c=this.props.getItemCount(this.props.data),p=!1,h=this.props.onEndReachedThreshold*l/2;if(0<i&&(e=n-this._getFrameMetricsApprox(i).offset,p=p||e<0||a<-2&&e<h),s<c-1&&(t=this._getFrameMetricsApprox(s).offset-(n+l),p=p||t<0||2<a&&t<h),p&&(this._averageCellLength||this.props.getItemLayout)&&!this._hiPriInProgress)return this._hiPriInProgress=!0,this._updateCellsToRenderBatcher.dispose({abort:!0}),void this._updateCellsToRender();this._updateCellsToRenderBatcher.schedule()},e._updateViewableItems=function(t){var r=this,i=this.props.getItemCount;this._viewabilityTuples.forEach(function(e){e.viewabilityHelper.onUpdate(i(t),r._scrollMetrics.offset,r._scrollMetrics.visibleLength,r._getFrameMetrics,r._createViewToken,e.onViewableItemsChanged,r.state)})},t}(React.PureComponent);VirtualizedList.defaultProps={disableVirtualization:!1,horizontal:!1,initialNumToRender:10,keyExtractor:function(e,t){return null!=e.key?e.key:null!=e.id?e.id:(_usedIndexForKey=!0,e.type&&e.type.displayName&&(_keylessItemComponentName=e.type.displayName),String(t))},maxToRenderPerBatch:10,onEndReachedThreshold:2,scrollEventThrottle:50,updateCellsBatchingPeriod:50,windowSize:21},VirtualizedList.contextTypes={virtualizedCell:_propTypes.default.shape({cellKey:_propTypes.default.string}),virtualizedList:_propTypes.default.shape({getScrollMetrics:_propTypes.default.func,horizontal:_propTypes.default.bool,getOutermostParentListRef:_propTypes.default.func,getNestedChildState:_propTypes.default.func,registerAsNestedChild:_propTypes.default.func,unregisterAsNestedChild:_propTypes.default.func})},VirtualizedList.childContextTypes={virtualizedList:_propTypes.default.shape({getScrollMetrics:_propTypes.default.func,horizontal:_propTypes.default.bool,getOutermostParentListRef:_propTypes.default.func,getNestedChildState:_propTypes.default.func,registerAsNestedChild:_propTypes.default.func,unregisterAsNestedChild:_propTypes.default.func})};var CellRenderer=function(i){function e(){for(var o,e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return(o=i.call.apply(i,[this].concat(t))||this).state={separatorProps:{highlighted:!1,leadingItem:o.props.item}},o._separators={highlight:function(){var e=o.props,t=e.cellKey,r=e.prevCellKey;o.props.onUpdateSeparators([t,r],{highlighted:!0})},unhighlight:function(){var e=o.props,t=e.cellKey,r=e.prevCellKey;o.props.onUpdateSeparators([t,r],{highlighted:!1})},updateProps:function(e,t){var r=o.props,i=r.cellKey,s=r.prevCellKey;o.props.onUpdateSeparators(["leading"===e?s:i],t)}},o}_inheritsLoose(e,i);var t=e.prototype;return t.getChildContext=function(){return{virtualizedCell:{cellKey:this.props.cellKey}}},t.updateSeparatorProps=function(t){this.setState(function(e){return{separatorProps:_objectSpread({},e.separatorProps,{},t)}})},t.componentWillUnmount=function(){this.props.onUnmount(this.props.cellKey)},t.render=function(){var e=this.props,t=e.CellRendererComponent,r=e.ItemSeparatorComponent,i=e.fillRateHelper,s=e.horizontal,o=e.item,n=e.index,l=e.inversionStyle,a=e.parentProps,c=a.renderItem,p=a.getItemLayout;(0,_invariant.default)(c,"no renderItem!");var h=c({item:o,index:n,separators:this._separators}),d=!p||a.debug||i.enabled()?this.props.onLayout:void 0,u=r&&React.createElement(r,this.state.separatorProps),f=l?s?[styles.rowReverse,l]:[styles.columnReverse,l]:s?[styles.row,l]:l;return t?React.createElement(t,_extends({},this.props,{style:f,onLayout:d}),h,u):React.createElement(_View.default,{style:f,onLayout:d},h,u)},e}(React.Component);CellRenderer.childContextTypes={virtualizedCell:_propTypes.default.shape({cellKey:_propTypes.default.string})};var VirtualizedCellWrapper=function(e){function t(){return e.apply(this,arguments)||this}_inheritsLoose(t,e);var r=t.prototype;return r.getChildContext=function(){return{virtualizedCell:{cellKey:this.props.cellKey}}},r.render=function(){return this.props.children},t}(React.Component);VirtualizedCellWrapper.childContextTypes={virtualizedCell:_propTypes.default.shape({cellKey:_propTypes.default.string})};var styles=_StyleSheet.default.create({verticallyInverted:{transform:[{scaleY:-1}]},horizontallyInverted:{transform:[{scaleX:-1}]},row:{flexDirection:"row"},rowReverse:{flexDirection:"row-reverse"},columnReverse:{flexDirection:"column-reverse"},debug:{flex:1},debugOverlayBase:{position:"absolute",top:0,right:0},debugOverlay:{bottom:0,width:20,borderColor:"blue",borderWidth:1},debugOverlayFrame:{left:0,backgroundColor:"orange"},debugOverlayFrameLast:{left:0,borderColor:"green",borderWidth:2},debugOverlayFrameVis:{left:0,borderColor:"red",borderWidth:2}}),_default=VirtualizedList;exports.default=VirtualizedList,module.exports=exports.default;