"use strict";exports.__esModule=!0,exports.default=void 0;var _react=require("react"),_createElement=_interopRequireDefault(require("../createElement")),_css=_interopRequireDefault(require("../StyleSheet/css")),_pick=_interopRequireDefault(require("../../modules/pick")),_setAndForwardRef=_interopRequireDefault(require("../../modules/setAndForwardRef")),_useElementLayout=_interopRequireDefault(require("../../hooks/useElementLayout")),_useLayoutEffect=_interopRequireDefault(require("../../hooks/useLayoutEffect")),_usePlatformMethods=_interopRequireDefault(require("../../hooks/usePlatformMethods")),_useResponderEvents=_interopRequireDefault(require("../../hooks/useResponderEvents")),_StyleSheet=_interopRequireDefault(require("../StyleSheet")),_TextInputState=_interopRequireDefault(require("../../modules/TextInputState"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var isSelectionStale=function(e,t){var n=e.selectionEnd,o=e.selectionStart,r=t.start,u=t.end;return r!==o||u!==n},setSelection=function(e,t){if(isSelectionStale(e,t)){var n=t.start,o=t.end;try{e.setSelectionRange(n,o||n)}catch(e){}}},forwardPropsList={accessibilityLabel:!0,accessibilityLiveRegion:!0,accessibilityRole:!0,accessibilityState:!0,accessibilityValue:!0,accessible:!0,autoCapitalize:!0,autoComplete:!0,autoCorrect:!0,autoFocus:!0,children:!0,classList:!0,defaultValue:!0,dir:!0,disabled:!0,importantForAccessibility:!0,maxLength:!0,nativeID:!0,onBlur:!0,onChange:!0,onClick:!0,onClickCapture:!0,onContextMenu:!0,onFocus:!0,onScroll:!0,onTouchCancel:!0,onTouchCancelCapture:!0,onTouchEnd:!0,onTouchEndCapture:!0,onTouchMove:!0,onTouchMoveCapture:!0,onTouchStart:!0,onTouchStartCapture:!0,placeholder:!0,pointerEvents:!0,readOnly:!0,ref:!0,rows:!0,spellCheck:!0,style:!0,value:!0,testID:!0,type:!0,dataSet:!0,onMouseDown:!0,onMouseEnter:!0,onMouseLeave:!0,onMouseMove:!0,onMouseOver:!0,onMouseOut:!0,onMouseUp:!0},pickProps=function(e){return(0,_pick.default)(e,forwardPropsList)};function isEventComposing(e){return e.isComposing||229===e.keyCode}var TextInput=(0,_react.forwardRef)(function(e,t){var n,o=e.autoCapitalize,r=void 0===o?"sentences":o,u=e.autoComplete,a=e.autoCompleteType,l=e.autoCorrect,s=void 0===l||l,i=e.blurOnSubmit,c=e.clearTextOnFocus,d=e.dir,p=e.editable,S=void 0===p||p,f=e.keyboardType,h=void 0===f?"default":f,v=e.multiline,R=void 0!==v&&v,C=e.numberOfLines,_=void 0===C?1:C,y=e.onBlur,m=e.onChange,x=e.onChangeText,g=e.onContentSizeChange,T=e.onFocus,E=e.onKeyPress,b=e.onLayout,k=e.onMoveShouldSetResponder,q=e.onMoveShouldSetResponderCapture,M=e.onResponderEnd,w=e.onResponderGrant,D=e.onResponderMove,F=e.onResponderReject,L=e.onResponderRelease,I=e.onResponderStart,P=e.onResponderTerminate,z=e.onResponderTerminationRequest,O=e.onScrollShouldSetResponder,A=e.onScrollShouldSetResponderCapture,K=e.onSelectionChange,N=e.onSelectionChangeShouldSetResponder,B=e.onSelectionChangeShouldSetResponderCapture,j=e.onStartShouldSetResponder,G=e.onStartShouldSetResponderCapture,V=e.onSubmitEditing,W=e.placeholderTextColor,H=e.returnKeyType,U=e.secureTextEntry,J=void 0!==U&&U,Q=e.selection,X=e.selectTextOnFocus,Y=e.spellCheck;switch(h){case"email-address":n="email";break;case"number-pad":case"numeric":n="number";break;case"phone-pad":n="tel";break;case"search":case"web-search":n="search";break;case"url":n="url";break;default:n="text"}J&&(n="password");var Z=(0,_react.useRef)(null),$=(0,_react.useRef)({height:null,width:null}),ee=(0,_setAndForwardRef.default)({getForwardedRef:function(){return t},setLocalRef:function(e){null!=e&&(e.clear=function(){null!=e&&(e.value="")},e.isFocused=function(){return null!=e&&_TextInputState.default.currentlyFocusedField()===e}),Z.current=e,null!=Z.current&&te()}});function te(){var e,t,n=Z.current;R&&g&&null!=n&&(e=n.scrollHeight,t=n.scrollWidth,e===$.current.height&&t===$.current.width||($.current.height=e,$.current.width=t,g({nativeEvent:{contentSize:{height:$.current.height,width:$.current.width}}})))}(0,_useLayoutEffect.default)(function(){var e=Z.current;null!=e&&null!=Q&&setSelection(e,Q),document.activeElement===e&&(_TextInputState.default._currentlyFocusedNode=e)},[Z,Q]);var ne=R?"textarea":"input",oe=[classes.textinput],re=_StyleSheet.default.compose(e.style,W&&{placeholderTextColor:W});(0,_useElementLayout.default)(Z,b),(0,_useResponderEvents.default)(Z,{onMoveShouldSetResponder:k,onMoveShouldSetResponderCapture:q,onResponderEnd:M,onResponderGrant:w,onResponderMove:D,onResponderReject:F,onResponderRelease:L,onResponderStart:I,onResponderTerminate:P,onResponderTerminationRequest:z,onScrollShouldSetResponder:O,onScrollShouldSetResponderCapture:A,onSelectionChangeShouldSetResponder:N,onSelectionChangeShouldSetResponderCapture:B,onStartShouldSetResponder:j,onStartShouldSetResponderCapture:G});var ue=pickProps(e);return ue.autoCapitalize=r,ue.autoComplete=u||a||"on",ue.autoCorrect=s?"on":"off",ue.classList=oe,ue.dir=void 0!==d?d:"auto",ue.enterkeyhint=H,ue.onBlur=function(e){_TextInputState.default._currentlyFocusedNode=null,y&&(e.nativeEvent.text=e.target.value,y(e))},ue.onChange=function(e){var t=e.target.value;e.nativeEvent.text=t,te(),m&&m(e),x&&x(t)},ue.onFocus=function(e){var t=Z.current;null!=t&&(_TextInputState.default._currentlyFocusedNode=t,T&&(e.nativeEvent.text=e.target.value,T(e)),c&&(t.value=""),X&&t.select())},ue.onKeyDown=function(e){e.stopPropagation();var t=null==i?!R:i,n=e.nativeEvent,o=isEventComposing(n);E&&E(e),"Enter"!==e.key||e.shiftKey||o||e.isDefaultPrevented()||(!i&&R||!V||(e.preventDefault(),n.text=e.target.value,V(e)),t&&null!=Z.current&&Z.current.blur())},ue.onSelect=function(e){if(K)try{var t=e.target,n=t.selectionStart,o=t.selectionEnd;e.nativeEvent.selection={start:n,end:o},e.nativeEvent.text=e.target.value,K(e)}catch(e){}},ue.readOnly=!S,ue.ref=ee,ue.rows=R?_:void 0,ue.spellCheck=null!=Y?Y:s,ue.style=re,ue.type=R?void 0:n,(0,_usePlatformMethods.default)(Z,ue),(0,_createElement.default)(ne,ue)});TextInput.displayName="TextInput",TextInput.State=_TextInputState.default;var classes=_css.default.create({textinput:{MozAppearance:"textfield",WebkitAppearance:"none",backgroundColor:"transparent",border:"0 solid black",borderRadius:0,boxSizing:"border-box",font:"14px System",margin:0,padding:0,resize:"none"}}),_default=TextInput;exports.default=TextInput,module.exports=exports.default;