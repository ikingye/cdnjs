"use strict";var DELAY="DELAY",ERROR="ERROR",LONG_PRESS_DETECTED="LONG_PRESS_DETECTED",NOT_RESPONDER="NOT_RESPONDER",RESPONDER_ACTIVE_LONG_PRESS_START="RESPONDER_ACTIVE_LONG_PRESS_START",RESPONDER_ACTIVE_PRESS_START="RESPONDER_ACTIVE_PRESS_START",RESPONDER_INACTIVE_PRESS_START="RESPONDER_INACTIVE_PRESS_START",RESPONDER_GRANT="RESPONDER_GRANT",RESPONDER_RELEASE="RESPONDER_RELEASE",RESPONDER_TERMINATED="RESPONDER_TERMINATED",Transitions=Object.freeze({NOT_RESPONDER:{DELAY:ERROR,RESPONDER_GRANT:RESPONDER_INACTIVE_PRESS_START,RESPONDER_RELEASE:ERROR,RESPONDER_TERMINATED:ERROR,LONG_PRESS_DETECTED:ERROR},RESPONDER_INACTIVE_PRESS_START:{DELAY:RESPONDER_ACTIVE_PRESS_START,RESPONDER_GRANT:ERROR,RESPONDER_RELEASE:NOT_RESPONDER,RESPONDER_TERMINATED:NOT_RESPONDER,LONG_PRESS_DETECTED:ERROR},RESPONDER_ACTIVE_PRESS_START:{DELAY:ERROR,RESPONDER_GRANT:ERROR,RESPONDER_RELEASE:NOT_RESPONDER,RESPONDER_TERMINATED:NOT_RESPONDER,LONG_PRESS_DETECTED:RESPONDER_ACTIVE_LONG_PRESS_START},RESPONDER_ACTIVE_LONG_PRESS_START:{DELAY:ERROR,RESPONDER_GRANT:ERROR,RESPONDER_RELEASE:NOT_RESPONDER,RESPONDER_TERMINATED:NOT_RESPONDER,LONG_PRESS_DETECTED:RESPONDER_ACTIVE_LONG_PRESS_START},ERROR:{DELAY:NOT_RESPONDER,RESPONDER_GRANT:RESPONDER_INACTIVE_PRESS_START,RESPONDER_RELEASE:NOT_RESPONDER,RESPONDER_TERMINATED:NOT_RESPONDER,LONG_PRESS_DETECTED:NOT_RESPONDER}}),isActiveSignal=function(e){return e===RESPONDER_ACTIVE_PRESS_START||e===RESPONDER_ACTIVE_LONG_PRESS_START},isPressStartSignal=function(e){return e===RESPONDER_INACTIVE_PRESS_START||e===RESPONDER_ACTIVE_PRESS_START||e===RESPONDER_ACTIVE_LONG_PRESS_START},isTerminalSignal=function(e){return e===RESPONDER_TERMINATED||e===RESPONDER_RELEASE},isValidKeyPress=function(e){var t=e.key,E=e.currentTarget.getAttribute("role");return"Enter"===t||(" "===t||"Spacebar"===t)&&("button"===E||"menuitem"===E)},DEFAULT_LONG_PRESS_DELAY_MS=450,DEFAULT_PRESS_DELAY_MS=50,PressResponder=function(){function e(e){this._eventHandlers=null,this._isPointerTouch=!1,this._longPressDelayTimeout=null,this._longPressDispatched=!1,this._pressDelayTimeout=null,this._pressOutDelayTimeout=null,this._touchState=NOT_RESPONDER,this.configure(e)}var t=e.prototype;return t.configure=function(e){this._config=e},t.reset=function(){this._cancelLongPressDelayTimeout(),this._cancelPressDelayTimeout(),this._cancelPressOutDelayTimeout()},t.getEventHandlers=function(){return null==this._eventHandlers&&(this._eventHandlers=this._createEventHandlers()),this._eventHandlers},t._createEventHandlers=function(){var e=this,t=function(t,E){t.persist(),e._cancelPressOutDelayTimeout(),e._longPressDispatched=!1,e._responder=t.currentTarget,e._selectionTerminated=!1,e._touchState=NOT_RESPONDER,e._isPointerTouch="touchstart"===t.nativeEvent.type,e._receiveSignal(RESPONDER_GRANT,t);var n=normalizeDelay(e._config.delayPressStart,0,DEFAULT_PRESS_DELAY_MS);!1!==E&&n>0?e._pressDelayTimeout=setTimeout(function(){e._receiveSignal(DELAY,t)},n):e._receiveSignal(DELAY,t);var R=normalizeDelay(e._config.delayLongPress,10,DEFAULT_LONG_PRESS_DELAY_MS);e._longPressDelayTimeout=setTimeout(function(){e._handleLongPress(t)},R+n)},E=function(t){e._receiveSignal(RESPONDER_RELEASE,t)};return{onStartShouldSetResponder:function(){var t=e._config.disabled;return null==t||!t},onKeyDown:function(E){isValidKeyPress(E)&&(e._touchState===NOT_RESPONDER&&t(E,!1),E.stopPropagation())},onKeyUp:function(t){isValidKeyPress(t)&&(e._touchState!==NOT_RESPONDER&&E(t),t.stopPropagation())},onResponderGrant:function(e){return t(e)},onResponderMove:function(t){null!=e._config.onPressMove&&e._config.onPressMove(t);var E=getTouchFromResponderEvent(t);if(null!=e._touchActivatePosition){var n=e._touchActivatePosition.pageX-E.pageX,R=e._touchActivatePosition.pageY-E.pageY;Math.hypot(n,R)>10&&e._cancelLongPressDelayTimeout()}},onResponderRelease:function(e){return E(e)},onResponderTerminate:function(t){"selectionchange"===t.nativeEvent.type&&(e._selectionTerminated=!0),e._receiveSignal(RESPONDER_TERMINATED,t)},onResponderTerminationRequest:function(t){var E=e._config,n=E.cancelable,R=E.disabled,i=E.onLongPress;return!(!R&&null!=i&&e._isPointerTouch&&"contextmenu"===t.nativeEvent.type)&&(null==n||n)},onClick:function(t){var E=e._config,n=E.disabled,R=E.onPress;n||(e._longPressDispatched||e._selectionTerminated?t.preventDefault():null!=R&&!1===t.ctrlKey&&!1===t.altKey&&R(t),t.stopPropagation())},onContextMenu:function(t){var E=e._config,n=E.disabled,R=E.onLongPress;n||null==R||!e._isPointerTouch||t.defaultPrevented||t.preventDefault()}}},t._receiveSignal=function(e,t){var E=this._touchState,n=null;null!=Transitions[E]&&(n=Transitions[E][e]),null==this._responder&&e===RESPONDER_RELEASE||(null==n||n===ERROR?console.error("PressResponder: Invalid signal "+e+" for state "+E+" on responder"):E!==n&&(this._performTransitionSideEffects(E,n,e,t),this._touchState=n))},t._performTransitionSideEffects=function(e,t,E,n){if(isTerminalSignal(E)&&(this._isPointerTouch=!1,this._touchActivatePosition=null,this._cancelLongPressDelayTimeout()),isPressStartSignal(e)&&E===LONG_PRESS_DETECTED){var R=this._config.onLongPress;null!=R&&null==n.nativeEvent.key&&(R(n),this._longPressDispatched=!0)}var i=isActiveSignal(e),s=isActiveSignal(t);if(!i&&s?this._activate(n):i&&!s&&this._deactivate(n),isPressStartSignal(e)&&E===RESPONDER_RELEASE){var _=this._config,o=_.onLongPress;if(null!=_.onPress)null!=o&&e===RESPONDER_ACTIVE_LONG_PRESS_START||s||i||(this._activate(n),this._deactivate(n))}this._cancelPressDelayTimeout()},t._activate=function(e){var t=this._config,E=t.onPressChange,n=t.onPressStart,R=getTouchFromResponderEvent(e);this._touchActivatePosition={pageX:R.pageX,pageY:R.pageY},null!=n&&n(e),null!=E&&E(!0)},t._deactivate=function(e){var t=this._config,E=t.onPressChange,n=t.onPressEnd;function R(){null!=n&&n(e),null!=E&&E(!1)}var i=normalizeDelay(this._config.delayPressEnd);i>0?this._pressOutDelayTimeout=setTimeout(function(){R()},i):R()},t._handleLongPress=function(e){this._touchState!==RESPONDER_ACTIVE_PRESS_START&&this._touchState!==RESPONDER_ACTIVE_LONG_PRESS_START||this._receiveSignal(LONG_PRESS_DETECTED,e)},t._cancelLongPressDelayTimeout=function(){null!=this._longPressDelayTimeout&&(clearTimeout(this._longPressDelayTimeout),this._longPressDelayTimeout=null)},t._cancelPressDelayTimeout=function(){null!=this._pressDelayTimeout&&(clearTimeout(this._pressDelayTimeout),this._pressDelayTimeout=null)},t._cancelPressOutDelayTimeout=function(){null!=this._pressOutDelayTimeout&&(clearTimeout(this._pressOutDelayTimeout),this._pressOutDelayTimeout=null)},e}();export{PressResponder as default};function normalizeDelay(e,t,E){return void 0===t&&(t=0),void 0===E&&(E=0),Math.max(t,null!=e?e:E)}function getTouchFromResponderEvent(e){var t=e.nativeEvent,E=t.changedTouches,n=t.touches;return null!=n&&n.length>0?n[0]:null!=E&&E.length>0?E[0]:e.nativeEvent}