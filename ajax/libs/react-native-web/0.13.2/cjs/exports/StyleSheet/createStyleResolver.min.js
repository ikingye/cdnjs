"use strict";exports.__esModule=!0,exports.default=createStyleResolver;var _ExecutionEnvironment=require("fbjs/lib/ExecutionEnvironment"),_createCSSStyleSheet=_interopRequireDefault(require("./createCSSStyleSheet")),_createCompileableStyle=_interopRequireDefault(require("./createCompileableStyle")),_createOrderedCSSStyleSheet=_interopRequireDefault(require("./createOrderedCSSStyleSheet")),_flattenArray=_interopRequireDefault(require("../../modules/flattenArray")),_flattenStyle=_interopRequireDefault(require("./flattenStyle")),_I18nManager=_interopRequireDefault(require("../I18nManager")),_i18nStyle=_interopRequireDefault(require("./i18nStyle")),_compile=require("./compile"),_initialRules=_interopRequireDefault(require("./initialRules")),_modality=_interopRequireDefault(require("./modality")),_constants=require("./constants");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function createStyleResolver(){function t(){c={css:{},ltr:{},rtl:{},rtlNoSwap:{}},f=(0,_createOrderedCSSStyleSheet.default)((0,_createCSSStyleSheet.default)(_constants.STYLE_ELEMENT_ID)),_={},(0,_modality.default)(function(e){return f.insert(e,_constants.STYLE_GROUPS.modality)}),_initialRules.default.forEach(function(e){f.insert(e,_constants.STYLE_GROUPS.reset)})}var c,f,_,S={css:{},ltr:{},rtl:{},rtlNoSwap:{}};function y(e){var t,o,r=_I18nManager.default.doLeftAndRightSwapInRTL,n=_I18nManager.default.isRTL?r?"rtl":"rtlNoSwap":"ltr";c[n][e]||(t=(0,_createCompileableStyle.default)((0,_i18nStyle.default)((0,_flattenStyle.default)(e))),o=(0,_compile.atomic)(t),Object.keys(o).forEach(function(e){var t,r,n,a=o[e],l=a.identifier,i=a.property,s=a.rules,u=a.value;t=l,n=u,_[r=i]||(_[r]={}),_[r][n]=t,s.forEach(function(e){var t=_constants.STYLE_GROUPS.custom[i]||_constants.STYLE_GROUPS.atomic;f.insert(e,t)})}),c[n][e]=!0)}function p(e,t){var r=_I18nManager.default.doLeftAndRightSwapInRTL,n=_I18nManager.default.isRTL?r?"rtl":"rtlNoSwap":"ltr";if(null!=t&&null!=S[n][t])return S[n][t];var a=(0,_flattenStyle.default)(e),o=(0,_createCompileableStyle.default)((0,_i18nStyle.default)(a)),l=Object.keys(o).sort().reduce(function(a,e){var t,r,l,n,i,s,u=o[e];return null!=u&&(n=e,i=u,s=(0,_compile.stringifyValueWithProperty)(i,n),(t=_[n]&&_[n].hasOwnProperty(s)&&_[n][s])?a.classList.push(t):"animationKeyframes"===e||"placeholderTextColor"===e||"pointerEvents"===e||"scrollbarWidth"===e?(l=(0,_compile.atomic)(((r={})[e]=u,r)),Object.keys(l).forEach(function(e){var t=l[e],r=t.identifier,n=t.rules;a.classList.push(r),n.forEach(function(e){f.insert(e,_constants.STYLE_GROUPS.atomic)})})):(a.style||(a.style={}),a.style[e]=u)),a},{classList:[]});return l.style&&(l.style=(0,_compile.inline)(l.style)),null!=t&&(S[n][t]=l),l}return t(),{getStyleSheet:function(){var e=f.getTextContent();return _ExecutionEnvironment.canUseDOM||t(),{id:_constants.STYLE_ELEMENT_ID,textContent:e}},createCSS:function(t,i){var s={};return Object.keys(t).forEach(function(a){var e=t[a],l=(0,_compile.classic)(e,a);Object.keys(l).forEach(function(e){var t=l[e],r=t.identifier,n=t.rules;S.css[r]={group:i||_constants.STYLE_GROUPS.classic,rules:n},s[a]=r})}),s},resolve:function(e,t){var r=[],n={};if(!e&&!t)return n;if(Array.isArray(t)&&(0,_flattenArray.default)(t).forEach(function(e){var t;e&&(null==c.css[e]&&null!=S.css[e]&&((t=S.css[e]).rules.forEach(function(e){f.insert(e,t.group)}),c.css[e]=!0),r.push(e))}),"number"==typeof e){y(e);n=p(e,createCacheKey(e))}else if(Array.isArray(e)){for(var a=(0,_flattenArray.default)(e),l=!0,i="",s=0;s<a.length;s++){var u=a[s];"number"!=typeof u?l=!1:(l&&(i+=u+"-"),y(u))}n=p(a,l?createCacheKey(i):null)}else n=p(e);r.push.apply(r,n.classList);var o={className:classListToString(r),classList:r};return n.style&&(o.style=n.style),o},sheet:f}}var createCacheKey=function(e){return"rn-"+e},classListToString=function(e){return e.join(" ").trim()};module.exports=exports.default;