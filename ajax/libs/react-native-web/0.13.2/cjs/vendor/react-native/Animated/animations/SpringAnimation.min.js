"use strict";exports.__esModule=!0,exports.default=void 0;var _AnimatedValue=_interopRequireDefault(require("../nodes/AnimatedValue")),_AnimatedValueXY=_interopRequireDefault(require("../nodes/AnimatedValueXY")),_Animation2=_interopRequireDefault(require("./Animation")),_SpringConfig=_interopRequireDefault(require("../SpringConfig")),_invariant=_interopRequireDefault(require("fbjs/lib/invariant")),_NativeAnimatedHelper=require("../NativeAnimatedHelper");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _inheritsLoose(t,i){t.prototype=Object.create(i.prototype),(t.prototype.constructor=t).__proto__=i}var SpringAnimation=function(V){function l(t){var i,e,s,n,a,o,r,l,_,h,d,u,f,m,p,v,c,g=V.call(this)||this;return g._overshootClamping=null!==(i=t.overshootClamping)&&void 0!==i&&i,g._restDisplacementThreshold=null!==(e=t.restDisplacementThreshold)&&void 0!==e?e:.001,g._restSpeedThreshold=null!==(s=t.restSpeedThreshold)&&void 0!==s?s:.001,g._initialVelocity=null!==(n=t.velocity)&&void 0!==n?n:0,g._lastVelocity=null!==(a=t.velocity)&&void 0!==a?a:0,g._toValue=t.toValue,g._delay=null!==(o=t.delay)&&void 0!==o?o:0,g._useNativeDriver=(0,_NativeAnimatedHelper.shouldUseNativeDriver)(t),g.__isInteraction=null!==(r=t.isInteraction)&&void 0!==r?r:!g._useNativeDriver,g.__iterations=null!==(l=t.iterations)&&void 0!==l?l:1,void 0!==t.stiffness||void 0!==t.damping||void 0!==t.mass?((0,_invariant.default)(void 0===t.bounciness&&void 0===t.speed&&void 0===t.tension&&void 0===t.friction,"You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one"),g._stiffness=null!==(_=t.stiffness)&&void 0!==_?_:100,g._damping=null!==(h=t.damping)&&void 0!==h?h:10,g._mass=null!==(d=t.mass)&&void 0!==d?d:1):(void 0!==t.bounciness||void 0!==t.speed?((0,_invariant.default)(void 0===t.tension&&void 0===t.friction&&void 0===t.stiffness&&void 0===t.damping&&void 0===t.mass,"You can define one of bounciness/speed, tension/friction, or stiffness/damping/mass, but not more than one"),m=_SpringConfig.default.fromBouncinessAndSpeed(null!==(u=t.bounciness)&&void 0!==u?u:8,null!==(f=t.speed)&&void 0!==f?f:12),g._stiffness=m.stiffness,g._damping=m.damping):(c=_SpringConfig.default.fromOrigamiTensionAndFriction(null!==(p=t.tension)&&void 0!==p?p:40,null!==(v=t.friction)&&void 0!==v?v:7),g._stiffness=c.stiffness,g._damping=c.damping),g._mass=1),(0,_invariant.default)(0<g._stiffness,"Stiffness value must be greater than 0"),(0,_invariant.default)(0<g._damping,"Damping value must be greater than 0"),(0,_invariant.default)(0<g._mass,"Mass value must be greater than 0"),g}_inheritsLoose(l,V);var t=l.prototype;return t.__getNativeAnimationConfig=function(){var t;return{type:"spring",overshootClamping:this._overshootClamping,restDisplacementThreshold:this._restDisplacementThreshold,restSpeedThreshold:this._restSpeedThreshold,stiffness:this._stiffness,damping:this._damping,mass:this._mass,initialVelocity:null!==(t=this._initialVelocity)&&void 0!==t?t:this._lastVelocity,toValue:this._toValue,iterations:this.__iterations}},t.start=function(t,i,e,s,n){var a,o=this;this.__active=!0,this._startPosition=t,this._lastPosition=this._startPosition,this._onUpdate=i,this.__onEnd=e,this._lastTime=Date.now(),this._frameTime=0,s instanceof l&&(a=s.getInternalState(),this._lastPosition=a.lastPosition,this._lastVelocity=a.lastVelocity,this._initialVelocity=this._lastVelocity,this._lastTime=a.lastTime);function r(){o._useNativeDriver?o.__startNativeAnimation(n):o.onUpdate()}this._delay?this._timeout=setTimeout(r,this._delay):r()},t.getInternalState=function(){return{lastPosition:this._lastPosition,lastVelocity:this._lastVelocity,lastTime:this._lastTime}},t.onUpdate=function(){var t=Date.now();t>this._lastTime+64&&(t=this._lastTime+64);var i=(t-this._lastTime)/1e3;this._frameTime+=i;var e,s,n=this._damping,a=this._mass,o=this._stiffness,r=-this._initialVelocity,l=n/(2*Math.sqrt(o*a)),_=Math.sqrt(o/a),h=_*Math.sqrt(1-l*l),d=this._toValue-this._startPosition,u=0,f=0,m=this._frameTime;if(f=l<1?(e=Math.exp(-l*_*m),u=this._toValue-e*((r+l*_*d)/h*Math.sin(h*m)+d*Math.cos(h*m)),l*_*e*(Math.sin(h*m)*(r+l*_*d)/h+d*Math.cos(h*m))-e*(Math.cos(h*m)*(r+l*_*d)-h*d*Math.sin(h*m))):(s=Math.exp(-_*m),u=this._toValue-s*(d+(r+_*d)*m),s*(r*(m*_-1)+m*d*(_*_))),this._lastTime=t,this._lastPosition=u,this._lastVelocity=f,this._onUpdate(u),this.__active){var p=!1;this._overshootClamping&&0!==this._stiffness&&(p=this._startPosition<this._toValue?u>this._toValue:u<this._toValue);var v=Math.abs(f)<=this._restSpeedThreshold,c=!0;if(0!==this._stiffness&&(c=Math.abs(this._toValue-u)<=this._restDisplacementThreshold),p||v&&c)return 0!==this._stiffness&&(this._lastPosition=this._toValue,this._lastVelocity=0,this._onUpdate(this._toValue)),void this.__debouncedOnEnd({finished:!0});this._animationFrame=requestAnimationFrame(this.onUpdate.bind(this))}},t.stop=function(){V.prototype.stop.call(this),this.__active=!1,clearTimeout(this._timeout),global.cancelAnimationFrame(this._animationFrame),this.__debouncedOnEnd({finished:!1})},l}(_Animation2.default),_default=SpringAnimation;exports.default=SpringAnimation,module.exports=exports.default;