"use strict";exports.__esModule=!0,exports.default=exports.ImageUriCache=void 0;var dataUriPattern=/^data:/,ImageUriCache=function(){function o(){}return o.has=function(e){var a=o._entries;return dataUriPattern.test(e)||Boolean(a[e])},o.add=function(e){var a=o._entries,r=Date.now();a[e]?(a[e].lastUsedTimestamp=r,a[e].refCount+=1):a[e]={lastUsedTimestamp:r,refCount:1}},o.remove=function(e){var a=o._entries;a[e]&&--a[e].refCount,o._cleanUpIfNeeded()},o._cleanUpIfNeeded=function(){var r,t,n=o._entries,e=Object.keys(n);e.length+1>o._maximumEntries&&(e.forEach(function(e){var a=n[e];(!t||a.lastUsedTimestamp<t.lastUsedTimestamp)&&0===a.refCount&&(r=e,t=a)}),r&&delete n[r])},o}();(exports.ImageUriCache=ImageUriCache)._maximumEntries=256,ImageUriCache._entries={};var id=0,requests={},ImageLoader={abort:function(e){var a=requests[""+e];a&&(a.onerror=null,a.onload=null,a=null,delete requests[""+e])},getSize:function(e,t,a){var n=!1,o=setInterval(r,16),i=ImageLoader.load(e,r,function(){"function"==typeof a&&a();ImageLoader.abort(i),clearInterval(o)});function r(){var e,a,r=requests[""+i];r&&(e=r.naturalHeight,a=r.naturalWidth,e&&a&&(t(a,e),n=!0)),n&&(ImageLoader.abort(i),clearInterval(o))}},has:function(e){return ImageUriCache.has(e)},load:function(e,r,a){id+=1;var t=new window.Image;return t.onerror=a,t.onload=function(e){function a(){return r()}"function"==typeof t.decode?t.decode().then(a,a):setTimeout(a,0)},t.src=e,requests[""+id]=t,id},prefetch:function(r){return new Promise(function(e,a){ImageLoader.load(r,function(){ImageUriCache.add(r),ImageUriCache.remove(r),e()},a)})},queryCache:function(e){var a={};return e.forEach(function(e){ImageUriCache.has(e)&&(a[e]="disk/memory")}),Promise.resolve(a)}},_default=ImageLoader;exports.default=ImageLoader;