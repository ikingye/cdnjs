import{forwardRef,useRef}from"react";import createElement from"../createElement";import css from"../StyleSheet/css";import pick from"../../modules/pick";import setAndForwardRef from"../../modules/setAndForwardRef";import useElementLayout from"../../hooks/useElementLayout";import useLayoutEffect from"../../hooks/useLayoutEffect";import usePlatformMethods from"../../hooks/usePlatformMethods";import useResponderEvents from"../../hooks/useResponderEvents";import StyleSheet from"../StyleSheet";import TextInputState from"../../modules/TextInputState";var isSelectionStale=function(e,t){var o=e.selectionEnd,n=e.selectionStart,r=t.start,a=t.end;return r!==n||a!==o},setSelection=function(e,t){if(isSelectionStale(e,t)){var o=t.start,n=t.end;try{e.setSelectionRange(o,n||o)}catch(e){}}},forwardPropsList={accessibilityLabel:!0,accessibilityLiveRegion:!0,accessibilityRole:!0,accessibilityState:!0,accessibilityValue:!0,accessible:!0,autoCapitalize:!0,autoComplete:!0,autoCorrect:!0,autoFocus:!0,children:!0,classList:!0,defaultValue:!0,dir:!0,disabled:!0,importantForAccessibility:!0,maxLength:!0,nativeID:!0,onBlur:!0,onChange:!0,onClick:!0,onClickCapture:!0,onContextMenu:!0,onFocus:!0,onScroll:!0,onTouchCancel:!0,onTouchCancelCapture:!0,onTouchEnd:!0,onTouchEndCapture:!0,onTouchMove:!0,onTouchMoveCapture:!0,onTouchStart:!0,onTouchStartCapture:!0,placeholder:!0,pointerEvents:!0,readOnly:!0,ref:!0,rows:!0,spellCheck:!0,style:!0,value:!0,testID:!0,type:!0,dataSet:!0,onMouseDown:!0,onMouseEnter:!0,onMouseLeave:!0,onMouseMove:!0,onMouseOver:!0,onMouseOut:!0,onMouseUp:!0},pickProps=function(e){return pick(e,forwardPropsList)};function isEventComposing(e){return e.isComposing||229===e.keyCode}var TextInput=forwardRef(function(e,t){var o,n=e.autoCapitalize,r=void 0===n?"sentences":n,a=e.autoComplete,u=e.autoCompleteType,s=e.autoCorrect,l=void 0===s||s,i=e.blurOnSubmit,c=e.clearTextOnFocus,d=e.dir,p=e.editable,S=void 0===p||p,h=e.keyboardType,v=void 0===h?"default":h,f=e.multiline,m=void 0!==f&&f,R=e.numberOfLines,C=void 0===R?1:R,y=e.onBlur,g=e.onChange,x=e.onChangeText,E=e.onContentSizeChange,T=e.onFocus,b=e.onKeyPress,k=e.onLayout,M=e.onMoveShouldSetResponder,w=e.onMoveShouldSetResponderCapture,F=e.onResponderEnd,L=e.onResponderGrant,I=e.onResponderMove,P=e.onResponderReject,z=e.onResponderRelease,O=e.onResponderStart,A=e.onResponderTerminate,D=e.onResponderTerminationRequest,K=e.onScrollShouldSetResponder,N=e.onScrollShouldSetResponderCapture,B=e.onSelectionChange,_=e.onSelectionChangeShouldSetResponder,j=e.onSelectionChangeShouldSetResponderCapture,q=e.onStartShouldSetResponder,G=e.onStartShouldSetResponderCapture,V=e.onSubmitEditing,W=e.placeholderTextColor,H=e.returnKeyType,U=e.secureTextEntry,J=void 0!==U&&U,Q=e.selection,X=e.selectTextOnFocus,Y=e.spellCheck;switch(v){case"email-address":o="email";break;case"number-pad":case"numeric":o="number";break;case"phone-pad":o="tel";break;case"search":case"web-search":o="search";break;case"url":o="url";break;default:o="text"}J&&(o="password");var Z=useRef(null),$=useRef({height:null,width:null}),ee=setAndForwardRef({getForwardedRef:function(){return t},setLocalRef:function(e){null!=e&&(e.clear=function(){null!=e&&(e.value="")},e.isFocused=function(){return null!=e&&TextInputState.currentlyFocusedField()===e}),Z.current=e,null!=Z.current&&te()}});function te(){var e=Z.current;if(m&&E&&null!=e){var t=e.scrollHeight,o=e.scrollWidth;t===$.current.height&&o===$.current.width||($.current.height=t,$.current.width=o,E({nativeEvent:{contentSize:{height:$.current.height,width:$.current.width}}}))}}useLayoutEffect(function(){var e=Z.current;null!=e&&null!=Q&&setSelection(e,Q),document.activeElement===e&&(TextInputState._currentlyFocusedNode=e)},[Z,Q]);var oe=m?"textarea":"input",ne=[classes.textinput],re=StyleSheet.compose(e.style,W&&{placeholderTextColor:W});useElementLayout(Z,k),useResponderEvents(Z,{onMoveShouldSetResponder:M,onMoveShouldSetResponderCapture:w,onResponderEnd:F,onResponderGrant:L,onResponderMove:I,onResponderReject:P,onResponderRelease:z,onResponderStart:O,onResponderTerminate:A,onResponderTerminationRequest:D,onScrollShouldSetResponder:K,onScrollShouldSetResponderCapture:N,onSelectionChangeShouldSetResponder:_,onSelectionChangeShouldSetResponderCapture:j,onStartShouldSetResponder:q,onStartShouldSetResponderCapture:G});var ae=pickProps(e);return ae.autoCapitalize=r,ae.autoComplete=a||u||"on",ae.autoCorrect=l?"on":"off",ae.classList=ne,ae.dir=void 0!==d?d:"auto",ae.enterkeyhint=H,ae.onBlur=function(e){TextInputState._currentlyFocusedNode=null,y&&(e.nativeEvent.text=e.target.value,y(e))},ae.onChange=function(e){var t=e.target.value;e.nativeEvent.text=t,te(),g&&g(e),x&&x(t)},ae.onFocus=function(e){var t=Z.current;null!=t&&(TextInputState._currentlyFocusedNode=t,T&&(e.nativeEvent.text=e.target.value,T(e)),c&&(t.value=""),X&&t.select())},ae.onKeyDown=function(e){e.stopPropagation();var t=null==i?!m:i,o=e.nativeEvent,n=isEventComposing(o);b&&b(e),"Enter"!==e.key||e.shiftKey||n||e.isDefaultPrevented()||(!i&&m||!V||(e.preventDefault(),o.text=e.target.value,V(e)),t&&null!=Z.current&&Z.current.blur())},ae.onSelect=function(e){if(B)try{var t=e.target,o=t.selectionStart,n=t.selectionEnd;e.nativeEvent.selection={start:o,end:n},e.nativeEvent.text=e.target.value,B(e)}catch(e){}},ae.readOnly=!S,ae.ref=ee,ae.rows=m?C:void 0,ae.spellCheck=null!=Y?Y:l,ae.style=re,ae.type=m?void 0:o,usePlatformMethods(Z,ae),createElement(oe,ae)});TextInput.displayName="TextInput",TextInput.State=TextInputState;var classes=css.create({textinput:{MozAppearance:"textfield",WebkitAppearance:"none",backgroundColor:"transparent",border:"0 solid black",borderRadius:0,boxSizing:"border-box",font:"14px System",margin:0,padding:0,resize:"none"}});export default TextInput;